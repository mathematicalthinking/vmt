
export const {
  StudentAnalysis,
  AnalysisContext,
  EMPTY_STUDENT_ID,
  STUDENT_META_RESPONSE_KEY
} = (function (global) {
  
  

  var _exports = (function () {
    var module = undefined;
    var exports = undefined;
    var requirejs,require,define;(function(e){var t,r,n,i,o={},a={},s={},u={},c=Object.prototype.hasOwnProperty,l=[].slice,p=/\.js$/;function f(e,t){return c.call(e,t)}function d(e,t){var r,n,i,o,a,u,c,l,f,d,h,m,y=t&&t.split("/"),g=s.map,v=g&&g["*"]||{};if(e){e=e.split("/");a=e.length-1;if(s.nodeIdCompat&&p.test(e[a])){e[a]=e[a].replace(p,"")}if(e[0].charAt(0)==="."&&y){m=y.slice(0,y.length-1);e=m.concat(e)}for(f=0;f<e.length;f++){h=e[f];if(h==="."){e.splice(f,1);f-=1}else if(h===".."){if(f===0||f===1&&e[2]===".."||e[f-1]===".."){continue}else if(f>0){e.splice(f-1,2);f-=2}}}e=e.join("/")}if((y||v)&&g){r=e.split("/");for(f=r.length;f>0;f-=1){n=r.slice(0,f).join("/");if(y){for(d=y.length;d>0;d-=1){i=g[y.slice(0,d).join("/")];if(i){i=i[n];if(i){o=i;u=f;break}}}}if(o){break}if(!c&&v&&v[n]){c=v[n];l=f}}if(!o&&c){o=c;u=l}if(o){r.splice(0,u,o);e=r.join("/")}}return e}function h(t,n){return function(){var i=l.call(arguments,0);if(typeof i[0]!=="string"&&i.length===1){i.push(null)}return r.apply(e,i.concat([t,n]))}}function m(e){return function(t){return d(t,e)}}function y(e){return function(t){o[e]=t}}function g(r){if(f(a,r)){var n=a[r];delete a[r];u[r]=true;t.apply(e,n)}if(!f(o,r)&&!f(u,r)){throw new Error("No "+r)}return o[r]}function v(e){var t,r=e?e.indexOf("!"):-1;if(r>-1){t=e.substring(0,r);e=e.substring(r+1,e.length)}return[t,e]}function b(e){return e?v(e):[]}n=function(e,t){var r,n=v(e),i=n[0],o=t[1];e=n[1];if(i){i=d(i,o);r=g(i)}if(i){if(r&&r.normalize){e=r.normalize(e,m(o))}else{e=d(e,o)}}else{e=d(e,o);n=v(e);i=n[0];e=n[1];if(i){r=g(i)}}return{f:i?i+"!"+e:e,n:e,pr:i,p:r}};function x(e){return function(){return s&&s.config&&s.config[e]||{}}}i={require:function(e){return h(e)},exports:function(e){var t=o[e];if(typeof t!=="undefined"){return t}else{return o[e]={}}},module:function(e){return{id:e,uri:"",exports:o[e],config:x(e)}}};t=function(t,r,s,c){var l,p,d,m,v,x,_=[],S=typeof s,T;c=c||t;x=b(c);if(S==="undefined"||S==="function"){r=!r.length&&s.length?["require","exports","module"]:r;for(v=0;v<r.length;v+=1){m=n(r[v],x);p=m.f;if(p==="require"){_[v]=i.require(t)}else if(p==="exports"){_[v]=i.exports(t);T=true}else if(p==="module"){l=_[v]=i.module(t)}else if(f(o,p)||f(a,p)||f(u,p)){_[v]=g(p)}else if(m.p){m.p.load(m.n,h(c,true),y(p),{});_[v]=o[p]}else{throw new Error(t+" missing "+p)}}d=s?s.apply(o[t],_):undefined;if(t){if(l&&l.exports!==e&&l.exports!==o[t]){o[t]=l.exports}else if(d!==e||!T){o[t]=d}}}else if(t){o[t]=s}};requirejs=require=r=function(o,a,u,c,l){if(typeof o==="string"){if(i[o]){return i[o](a)}return g(n(o,b(a)).f)}else if(!o.splice){s=o;if(s.deps){r(s.deps,s.callback)}if(!a){return}if(a.splice){o=a;a=u;u=null}else{o=e}}a=a||function(){};if(typeof u==="function"){u=c;c=l}if(c){t(e,o,a,u)}else{setTimeout(function(){t(e,o,a,u)},4)}return r};r.config=function(e){return r(e)};requirejs._defined=o;define=function(e,t,r){if(typeof e!=="string"){throw new Error("See almond README: incorrect module build, no module name")}if(!t.splice){r=t;t=[]}if(!f(o,e)&&!f(a,e)){a[e]=[e,t,r]}};define.amd={jQuery:true}})();define("../vendor/almondv0.3.3",function(){});var __extends;var __assign;var __rest;var __decorate;var __param;var __metadata;var __awaiter;var __generator;var __exportStar;var __values;var __read;var __spread;var __spreadArrays;var __await;var __asyncGenerator;var __asyncDelegator;var __asyncValues;var __makeTemplateObject;var __importStar;var __importDefault;(function(e){var t=typeof global==="object"?global:typeof self==="object"?self:typeof this==="object"?this:{};if(typeof define==="function"&&define.amd){define("tslib",["exports"],function(n){e(r(t,r(n)))})}else if(typeof module==="object"&&typeof module.exports==="object"){e(r(t,r(module.exports)))}else{e(r(t))}function r(e,r){if(e!==t){if(typeof Object.create==="function"){Object.defineProperty(e,"__esModule",{value:true})}else{e.__esModule=true}}return function(t,n){return e[t]=r?r(t,n):n}}})(function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};__extends=function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)};__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};__rest=function(e,t){var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0)r[n]=e[n];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++){if(t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i]))r[n[i]]=e[n[i]]}return r};__decorate=function(e,t,r,n){var i=arguments.length,o=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,a;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(a=e[s])o=(i<3?a(o):i>3?a(t,r,o):a(t,r))||o;return i>3&&o&&Object.defineProperty(t,r,o),o};__param=function(e,t){return function(r,n){t(r,n,e)}};__metadata=function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};__awaiter=function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n["throw"](e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})};__generator=function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return u([e,t])}}function u(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;i=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(o=r.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(a[0]===6&&r.label<o[1]){r.label=o[1];o=a;break}if(o&&r.label<o[2]){r.label=o[2];r.ops.push(a);break}if(o[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e];i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};__exportStar=function(e,t){for(var r in e)if(!t.hasOwnProperty(r))t[r]=e[r]};__values=function(e){var t=typeof Symbol==="function"&&e[Symbol.iterator],r=0;if(t)return t.call(e);return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}}};__read=function(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],a;try{while((t===void 0||t-- >0)&&!(i=n.next()).done)o.push(i.value)}catch(e){a={error:e}}finally{try{if(i&&!i.done&&(r=n["return"]))r.call(n)}finally{if(a)throw a.error}}return o};__spread=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e};__spreadArrays=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n};__await=function(e){return this instanceof __await?(this.v=e,this):new __await(e)};__asyncGenerator=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,o=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(e){if(n[e])i[e]=function(t){return new Promise(function(r,n){o.push([e,t,r,n])>1||s(e,t)})}}function s(e,t){try{u(n[e](t))}catch(e){p(o[0][3],e)}}function u(e){e.value instanceof __await?Promise.resolve(e.value.v).then(c,l):p(o[0][2],e)}function c(e){s("next",e)}function l(e){s("throw",e)}function p(e,t){if(e(t),o.shift(),o.length)s(o[0][0],o[0][1])}};__asyncDelegator=function(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:__await(e[n](t)),done:n==="return"}:i?i(t):t}:i}};__asyncValues=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof __values==="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(t){r[t]=e[t]&&function(r){return new Promise(function(n,o){r=e[t](r),i(n,o,r.done,r.value)})}}function i(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)}};__makeTemplateObject=function(e,t){if(Object.defineProperty){Object.defineProperty(e,"raw",{value:t})}else{e.raw=t}return e};__importStar=function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(Object.hasOwnProperty.call(e,r))t[r]=e[r];t["default"]=e;return t};__importDefault=function(e){return e&&e.__esModule?e:{default:e}};e("__extends",__extends);e("__assign",__assign);e("__rest",__rest);e("__decorate",__decorate);e("__param",__param);e("__metadata",__metadata);e("__awaiter",__awaiter);e("__generator",__generator);e("__exportStar",__exportStar);e("__values",__values);e("__read",__read);e("__spread",__spread);e("__spreadArrays",__spreadArrays);e("__await",__await);e("__asyncGenerator",__asyncGenerator);e("__asyncDelegator",__asyncDelegator);e("__asyncValues",__asyncValues);e("__makeTemplateObject",__makeTemplateObject);e("__importStar",__importStar);e("__importDefault",__importDefault)});define("core/lib/uuid",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0;var r=e==="x"?t:t&3|8;return r.toString(16)})}t.uuid=r});define("core/computation-layer/helpers",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});function r(e){var t=[];var r=e.sinks;for(var n in r){var i=r[n];for(var o=0,a=["exportString","exportNumber","exportNumberList"];o<a.length;o++){var s=a[o];if(i[s]){for(var u=0,c=i[s];u<c.length;u++){var l=c[u];t.push({componentId:n,exportKey:l.params[0],sinkName:s})}}}}return t}t.listExportKeys=r;var n=new WeakMap;function i(e){var t=n.get(e);if(t!=undefined){return t}var r="";var i=0;for(var o=0;o<e.parts.length;o+=1){var a=e.parts[o];if(a==undefined||typeof a=="number"&&isNaN(a)){r+="undefined"}else if(u(a)){if(i%2==1){r+=a.latex}else{r+="`"+a.latex+"`";i+=2}}else{var s=a.toString();for(var c=0,l=s;c<l.length;c++){var p=l[c];if(p=="`"){i+=1}}r+=s}}n.set(e,r);return r}t.synthesizeStringForContent=i;var o=new WeakMap;function a(e){var t=o.get(e);if(t!=undefined){return t}var r="";for(var n=0,i=e.parts;n<i.length;n++){var a=i[n];if(u(a)){r+=a.latex}else if(a==undefined&&typeof a=="number"&&isNaN(a)){r+="undefined"}else{r+=a}}o.set(e,r);return r}t.synthesizeStringInternal=a;function s(e){if(e==undefined){return false}return e.type=="string"}t.isCLStringType=s;function u(e){if(e==undefined){return false}return e.latex!=undefined}t.isCLLatexType=u});define("core/components/action-button/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(){return false},getAssetUrls:function(){return[]}}});(function(){var e=typeof self==="object"&&self.self===self&&self||typeof global==="object"&&global.global===global&&global||this;var t=e._;var r=Array.prototype,n=Object.prototype;var i=r.push,o=r.slice,a=n.toString,s=n.hasOwnProperty;var u=Array.isArray,c=Object.keys,l=Object.create;var p=function(){};var f=function(e){if(e instanceof f)return e;if(!(this instanceof f))return new f(e);this._wrapped=e};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=f}exports._=f}else{e._=f}f.VERSION="1.8.3";var d=function(e,t,r){if(t===void 0)return e;switch(r==null?3:r){case 1:return function(r){return e.call(t,r)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,o){return e.call(t,r,n,i,o)}}return function(){return e.apply(t,arguments)}};var h=function(e,t,r){if(e==null)return f.identity;if(f.isFunction(e))return d(e,t,r);if(f.isObject(e))return f.matcher(e);return f.property(e)};f.iteratee=function(e,t){return h(e,t,Infinity)};var m=function(e,t){t=t==null?e.length-1:+t;return function(){var r=Math.max(arguments.length-t,0);var n=Array(r);for(var i=0;i<r;i++){n[i]=arguments[i+t]}switch(t){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}var o=Array(t+1);for(i=0;i<t;i++){o[i]=arguments[i]}o[t]=n;return e.apply(this,o)}};var y=function(e){if(!f.isObject(e))return{};if(l)return l(e);p.prototype=e;var t=new p;p.prototype=null;return t};var g=function(e){return function(t){return t==null?void 0:t[e]}};var v=Math.pow(2,53)-1;var b=g("length");var x=function(e){var t=b(e);return typeof t=="number"&&t>=0&&t<=v};f.each=f.forEach=function(e,t,r){t=d(t,r);var n,i;if(x(e)){for(n=0,i=e.length;n<i;n++){t(e[n],n,e)}}else{var o=f.keys(e);for(n=0,i=o.length;n<i;n++){t(e[o[n]],o[n],e)}}return e};f.map=f.collect=function(e,t,r){t=h(t,r);var n=!x(e)&&f.keys(e),i=(n||e).length,o=Array(i);for(var a=0;a<i;a++){var s=n?n[a]:a;o[a]=t(e[s],s,e)}return o};var _=function(e){var t=function(t,r,n,i){var o=!x(t)&&f.keys(t),a=(o||t).length,s=e>0?0:a-1;if(!i){n=t[o?o[s]:s];s+=e}for(;s>=0&&s<a;s+=e){var u=o?o[s]:s;n=r(n,t[u],u,t)}return n};return function(e,r,n,i){var o=arguments.length>=3;return t(e,d(r,i,4),n,o)}};f.reduce=f.foldl=f.inject=_(1);f.reduceRight=f.foldr=_(-1);f.find=f.detect=function(e,t,r){var n;if(x(e)){n=f.findIndex(e,t,r)}else{n=f.findKey(e,t,r)}if(n!==void 0&&n!==-1)return e[n]};f.filter=f.select=function(e,t,r){var n=[];t=h(t,r);f.each(e,function(e,r,i){if(t(e,r,i))n.push(e)});return n};f.reject=function(e,t,r){return f.filter(e,f.negate(h(t)),r)};f.every=f.all=function(e,t,r){t=h(t,r);var n=!x(e)&&f.keys(e),i=(n||e).length;for(var o=0;o<i;o++){var a=n?n[o]:o;if(!t(e[a],a,e))return false}return true};f.some=f.any=function(e,t,r){t=h(t,r);var n=!x(e)&&f.keys(e),i=(n||e).length;for(var o=0;o<i;o++){var a=n?n[o]:o;if(t(e[a],a,e))return true}return false};f.contains=f.includes=f.include=function(e,t,r,n){if(!x(e))e=f.values(e);if(typeof r!="number"||n)r=0;return f.indexOf(e,t,r)>=0};f.invoke=m(function(e,t,r){var n=f.isFunction(t);return f.map(e,function(e){var i=n?t:e[t];return i==null?i:i.apply(e,r)})});f.pluck=function(e,t){return f.map(e,f.property(t))};f.where=function(e,t){return f.filter(e,f.matcher(t))};f.findWhere=function(e,t){return f.find(e,f.matcher(t))};f.max=function(e,t,r){var n=-Infinity,i=-Infinity,o,a;if(t==null||typeof t=="number"&&typeof e[0]!="object"&&e!=null){e=x(e)?e:f.values(e);for(var s=0,u=e.length;s<u;s++){o=e[s];if(o>n){n=o}}}else{t=h(t,r);f.each(e,function(e,r,o){a=t(e,r,o);if(a>i||a===-Infinity&&n===-Infinity){n=e;i=a}})}return n};f.min=function(e,t,r){var n=Infinity,i=Infinity,o,a;if(t==null||typeof t=="number"&&typeof e[0]!="object"&&e!=null){e=x(e)?e:f.values(e);for(var s=0,u=e.length;s<u;s++){o=e[s];if(o<n){n=o}}}else{t=h(t,r);f.each(e,function(e,r,o){a=t(e,r,o);if(a<i||a===Infinity&&n===Infinity){n=e;i=a}})}return n};f.shuffle=function(e){return f.sample(e,Infinity)};f.sample=function(e,t,r){if(t==null||r){if(!x(e))e=f.values(e);return e[f.random(e.length-1)]}var n=x(e)?f.clone(e):f.values(e);var i=b(n);t=Math.max(Math.min(t,i),0);var o=i-1;for(var a=0;a<t;a++){var s=f.random(a,o);var u=n[a];n[a]=n[s];n[s]=u}return n.slice(0,t)};f.sortBy=function(e,t,r){t=h(t,r);return f.pluck(f.map(e,function(e,r,n){return{value:e,index:r,criteria:t(e,r,n)}}).sort(function(e,t){var r=e.criteria;var n=t.criteria;if(r!==n){if(r>n||r===void 0)return 1;if(r<n||n===void 0)return-1}return e.index-t.index}),"value")};var S=function(e,t){return function(r,n,i){var o=t?[[],[]]:{};n=h(n,i);f.each(r,function(t,i){var a=n(t,i,r);e(o,t,a)});return o}};f.groupBy=S(function(e,t,r){if(f.has(e,r))e[r].push(t);else e[r]=[t]});f.indexBy=S(function(e,t,r){e[r]=t});f.countBy=S(function(e,t,r){if(f.has(e,r))e[r]++;else e[r]=1});f.toArray=function(e){if(!e)return[];if(f.isArray(e))return o.call(e);if(x(e))return f.map(e,f.identity);return f.values(e)};f.size=function(e){if(e==null)return 0;return x(e)?e.length:f.keys(e).length};f.partition=S(function(e,t,r){e[r?0:1].push(t)},true);f.first=f.head=f.take=function(e,t,r){if(e==null)return void 0;if(t==null||r)return e[0];return f.initial(e,e.length-t)};f.initial=function(e,t,r){return o.call(e,0,Math.max(0,e.length-(t==null||r?1:t)))};f.last=function(e,t,r){if(e==null)return void 0;if(t==null||r)return e[e.length-1];return f.rest(e,Math.max(0,e.length-t))};f.rest=f.tail=f.drop=function(e,t,r){return o.call(e,t==null||r?1:t)};f.compact=function(e){return f.filter(e,f.identity)};var T=function(e,t,r,n){n=n||[];var i=n.length;for(var o=0,a=b(e);o<a;o++){var s=e[o];if(x(s)&&(f.isArray(s)||f.isArguments(s))){if(t){var u=0,c=s.length;while(u<c)n[i++]=s[u++]}else{T(s,t,r,n);i=n.length}}else if(!r){n[i++]=s}}return n};f.flatten=function(e,t){return T(e,t,false)};f.without=m(function(e,t){return f.difference(e,t)});f.uniq=f.unique=function(e,t,r,n){if(!f.isBoolean(t)){n=r;r=t;t=false}if(r!=null)r=h(r,n);var i=[];var o=[];for(var a=0,s=b(e);a<s;a++){var u=e[a],c=r?r(u,a,e):u;if(t){if(!a||o!==c)i.push(u);o=c}else if(r){if(!f.contains(o,c)){o.push(c);i.push(u)}}else if(!f.contains(i,u)){i.push(u)}}return i};f.union=m(function(e){return f.uniq(T(e,true,true))});f.intersection=function(e){var t=[];var r=arguments.length;for(var n=0,i=b(e);n<i;n++){var o=e[n];if(f.contains(t,o))continue;var a;for(a=1;a<r;a++){if(!f.contains(arguments[a],o))break}if(a===r)t.push(o)}return t};f.difference=m(function(e,t){t=T(t,true,true);return f.filter(e,function(e){return!f.contains(t,e)})});f.unzip=function(e){var t=e&&f.max(e,b).length||0;var r=Array(t);for(var n=0;n<t;n++){r[n]=f.pluck(e,n)}return r};f.zip=m(f.unzip);f.object=function(e,t){var r={};for(var n=0,i=b(e);n<i;n++){if(t){r[e[n]]=t[n]}else{r[e[n][0]]=e[n][1]}}return r};var w=function(e){return function(t,r,n){r=h(r,n);var i=b(t);var o=e>0?0:i-1;for(;o>=0&&o<i;o+=e){if(r(t[o],o,t))return o}return-1}};f.findIndex=w(1);f.findLastIndex=w(-1);f.sortedIndex=function(e,t,r,n){r=h(r,n,1);var i=r(t);var o=0,a=b(e);while(o<a){var s=Math.floor((o+a)/2);if(r(e[s])<i)o=s+1;else a=s}return o};var E=function(e,t,r){return function(n,i,a){var s=0,u=b(n);if(typeof a=="number"){if(e>0){s=a>=0?a:Math.max(a+u,s)}else{u=a>=0?Math.min(a+1,u):a+u+1}}else if(r&&a&&u){a=r(n,i);return n[a]===i?a:-1}if(i!==i){a=t(o.call(n,s,u),f.isNaN);return a>=0?a+s:-1}for(a=e>0?s:u-1;a>=0&&a<u;a+=e){if(n[a]===i)return a}return-1}};f.indexOf=E(1,f.findIndex,f.sortedIndex);f.lastIndexOf=E(-1,f.findLastIndex);f.range=function(e,t,r){if(t==null){t=e||0;e=0}r=r||1;var n=Math.max(Math.ceil((t-e)/r),0);var i=Array(n);for(var o=0;o<n;o++,e+=r){i[o]=e}return i};var M=function(e,t,r,n,i){if(!(n instanceof t))return e.apply(r,i);var o=y(e.prototype);var a=e.apply(o,i);if(f.isObject(a))return a;return o};f.bind=m(function(e,t,r){if(!f.isFunction(e))throw new TypeError("Bind must be called on a function");var n=m(function(i){return M(e,n,t,this,r.concat(i))});return n});f.partial=m(function(e,t){var r=f.partial.placeholder;var n=function(){var i=0,o=t.length;var a=Array(o);for(var s=0;s<o;s++){a[s]=t[s]===r?arguments[i++]:t[s]}while(i<arguments.length)a.push(arguments[i++]);return M(e,n,this,this,a)};return n});f.partial.placeholder=f;f.bindAll=m(function(e,t){t=T(t,false,false);var r=t.length;if(r<1)throw new Error("bindAll must be passed function names");while(r--){var n=t[r];e[n]=f.bind(e[n],e)}});f.memoize=function(e,t){var r=function(n){var i=r.cache;var o=""+(t?t.apply(this,arguments):n);if(!f.has(i,o))i[o]=e.apply(this,arguments);return i[o]};r.cache={};return r};f.delay=m(function(e,t,r){return setTimeout(function(){return e.apply(null,r)},t)});f.defer=f.partial(f.delay,f,1);f.throttle=function(e,t,r){var n,i,o;var a=null;var s=0;if(!r)r={};var u=function(){s=r.leading===false?0:f.now();a=null;o=e.apply(n,i);if(!a)n=i=null};return function(){var c=f.now();if(!s&&r.leading===false)s=c;var l=t-(c-s);n=this;i=arguments;if(l<=0||l>t){if(a){clearTimeout(a);a=null}s=c;o=e.apply(n,i);if(!a)n=i=null}else if(!a&&r.trailing!==false){a=setTimeout(u,l)}return o}};f.debounce=function(e,t,r){var n,i,o,a,s;var u=function(){var c=f.now()-a;if(c<t&&c>=0){n=setTimeout(u,t-c)}else{n=null;if(!r){s=e.apply(o,i);if(!n)o=i=null}}};return function(){o=this;i=arguments;a=f.now();var c=r&&!n;if(!n)n=setTimeout(u,t);if(c){s=e.apply(o,i);o=i=null}return s}};f.wrap=function(e,t){return f.partial(t,e)};f.negate=function(e){return function(){return!e.apply(this,arguments)}};f.compose=function(){var e=arguments;var t=e.length-1;return function(){var r=t;var n=e[t].apply(this,arguments);while(r--)n=e[r].call(this,n);return n}};f.after=function(e,t){return function(){if(--e<1){return t.apply(this,arguments)}}};f.before=function(e,t){var r;return function(){if(--e>0){r=t.apply(this,arguments)}if(e<=1)t=null;return r}};f.once=f.partial(f.before,2);f.restArgs=m;var C=!{toString:null}.propertyIsEnumerable("toString");var I=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];var P=function(e,t){var r=I.length;var i=e.constructor;var o=f.isFunction(i)&&i.prototype||n;var a="constructor";if(f.has(e,a)&&!f.contains(t,a))t.push(a);while(r--){a=I[r];if(a in e&&e[a]!==o[a]&&!f.contains(t,a)){t.push(a)}}};f.keys=function(e){if(!f.isObject(e))return[];if(c)return c(e);var t=[];for(var r in e)if(f.has(e,r))t.push(r);if(C)P(e,t);return t};f.allKeys=function(e){if(!f.isObject(e))return[];var t=[];for(var r in e)t.push(r);if(C)P(e,t);return t};f.values=function(e){var t=f.keys(e);var r=t.length;var n=Array(r);for(var i=0;i<r;i++){n[i]=e[t[i]]}return n};f.mapObject=function(e,t,r){t=h(t,r);var n=f.keys(e),i=n.length,o={};for(var a=0;a<i;a++){var s=n[a];o[s]=t(e[s],s,e)}return o};f.pairs=function(e){var t=f.keys(e);var r=t.length;var n=Array(r);for(var i=0;i<r;i++){n[i]=[t[i],e[t[i]]]}return n};f.invert=function(e){var t={};var r=f.keys(e);for(var n=0,i=r.length;n<i;n++){t[e[r[n]]]=r[n]}return t};f.functions=f.methods=function(e){var t=[];for(var r in e){if(f.isFunction(e[r]))t.push(r)}return t.sort()};var k=function(e,t){return function(r){var n=arguments.length;if(n<2||r==null)return r;for(var i=1;i<n;i++){var o=arguments[i],a=e(o),s=a.length;for(var u=0;u<s;u++){var c=a[u];if(!t||r[c]===void 0)r[c]=o[c]}}return r}};f.extend=k(f.allKeys);f.extendOwn=f.assign=k(f.keys);f.findKey=function(e,t,r){t=h(t,r);var n=f.keys(e),i;for(var o=0,a=n.length;o<a;o++){i=n[o];if(t(e[i],i,e))return i}};var O=function(e,t,r){return t in r};f.pick=m(function(e,t){var r={},n=t[0];if(e==null)return r;if(f.isFunction(n)){if(t.length>1)n=d(n,t[1]);t=f.allKeys(e)}else{n=O;t=T(t,false,false);e=Object(e)}for(var i=0,o=t.length;i<o;i++){var a=t[i];var s=e[a];if(n(s,a,e))r[a]=s}return r});f.omit=m(function(e,t){var r=t[0],n;if(f.isFunction(r)){r=f.negate(r);if(t.length>1)n=t[1]}else{t=f.map(T(t,false,false),String);r=function(e,r){return!f.contains(t,r)}}return f.pick(e,r,n)});f.defaults=k(f.allKeys,true);f.create=function(e,t){var r=y(e);if(t)f.extendOwn(r,t);return r};f.clone=function(e){if(!f.isObject(e))return e;return f.isArray(e)?e.slice():f.extend({},e)};f.tap=function(e,t){t(e);return e};f.isMatch=function(e,t){var r=f.keys(t),n=r.length;if(e==null)return!n;var i=Object(e);for(var o=0;o<n;o++){var a=r[o];if(t[a]!==i[a]||!(a in i))return false}return true};var D,N;D=function(e,t,r,n){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return e===t;if(e!==e)return t!==t;var i=typeof e;if(i!=="function"&&i!=="object"&&typeof t!=="object")return false;return N(e,t,r,n)};N=function(e,t,r,n){if(e instanceof f)e=e._wrapped;if(t instanceof f)t=t._wrapped;var i=a.call(e);if(i!==a.call(t))return false;switch(i){case"[object RegExp]":case"[object String]":return""+e===""+t;case"[object Number]":if(+e!==+e)return+t!==+t;return+e===0?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var o=i==="[object Array]";if(!o){if(typeof e!="object"||typeof t!="object")return false;var s=e.constructor,u=t.constructor;if(s!==u&&!(f.isFunction(s)&&s instanceof s&&f.isFunction(u)&&u instanceof u)&&("constructor"in e&&"constructor"in t)){return false}}r=r||[];n=n||[];var c=r.length;while(c--){if(r[c]===e)return n[c]===t}r.push(e);n.push(t);if(o){c=e.length;if(c!==t.length)return false;while(c--){if(!D(e[c],t[c],r,n))return false}}else{var l=f.keys(e),p;c=l.length;if(f.keys(t).length!==c)return false;while(c--){p=l[c];if(!(f.has(t,p)&&D(e[p],t[p],r,n)))return false}}r.pop();n.pop();return true};f.isEqual=function(e,t){return D(e,t)};f.isEmpty=function(e){if(e==null)return true;if(x(e)&&(f.isArray(e)||f.isString(e)||f.isArguments(e)))return e.length===0;return f.keys(e).length===0};f.isElement=function(e){return!!(e&&e.nodeType===1)};f.isArray=u||function(e){return a.call(e)==="[object Array]"};f.isObject=function(e){var t=typeof e;return t==="function"||t==="object"&&!!e};f.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){f["is"+e]=function(t){return a.call(t)==="[object "+e+"]"}});if(!f.isArguments(arguments)){f.isArguments=function(e){return f.has(e,"callee")}}var A=e.document&&e.document.childNodes;if(typeof/./!="function"&&typeof Int8Array!="object"&&typeof A!="function"){f.isFunction=function(e){return typeof e=="function"||false}}f.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))};f.isNaN=function(e){return f.isNumber(e)&&e!==+e};f.isBoolean=function(e){return e===true||e===false||a.call(e)==="[object Boolean]"};f.isNull=function(e){return e===null};f.isUndefined=function(e){return e===void 0};f.has=function(e,t){return e!=null&&s.call(e,t)};f.noConflict=function(){e._=t;return this};f.identity=function(e){return e};f.constant=function(e){return function(){return e}};f.noop=function(){};f.property=g;f.propertyOf=function(e){return e==null?function(){}:function(t){return e[t]}};f.matcher=f.matches=function(e){e=f.extendOwn({},e);return function(t){return f.isMatch(t,e)}};f.times=function(e,t,r){var n=Array(Math.max(0,e));t=d(t,r,1);for(var i=0;i<e;i++)n[i]=t(i);return n};f.random=function(e,t){if(t==null){t=e;e=0}return e+Math.floor(Math.random()*(t-e+1))};f.now=Date.now||function(){return(new Date).getTime()};var L={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var F=f.invert(L);var R=function(e){var t=function(t){return e[t]};var r="(?:"+f.keys(e).join("|")+")";var n=RegExp(r);var i=RegExp(r,"g");return function(e){e=e==null?"":""+e;return n.test(e)?e.replace(i,t):e}};f.escape=R(L);f.unescape=R(F);f.result=function(e,t,r){var n=e==null?void 0:e[t];if(n===void 0){n=r}return f.isFunction(n)?n.call(e):n};var q=0;f.uniqueId=function(e){var t=++q+"";return e?e+t:t};f.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var V=/(.)^/;var z={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var j=/\\|'|\r|\n|\u2028|\u2029/g;var B=function(e){return"\\"+z[e]};f.template=function(e,t,r){if(!t&&r)t=r;t=f.defaults({},t,f.templateSettings);var n=RegExp([(t.escape||V).source,(t.interpolate||V).source,(t.evaluate||V).source].join("|")+"|$","g");var i=0;var o="__p+='";e.replace(n,function(t,r,n,a,s){o+=e.slice(i,s).replace(j,B);i=s+t.length;if(r){o+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"}else if(n){o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"}else if(a){o+="';\n"+a+"\n__p+='"}return t});o+="';\n";if(!t.variable)o="with(obj||{}){\n"+o+"}\n";o="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";var a;try{a=new Function(t.variable||"obj","_",o)}catch(e){e.source=o;throw e}var s=function(e){return a.call(this,e,f)};var u=t.variable||"obj";s.source="function("+u+"){\n"+o+"}";return s};f.chain=function(e){var t=f(e);t._chain=true;return t};var U=function(e,t){return e._chain?f(t).chain():t};f.mixin=function(e){f.each(f.functions(e),function(t){var r=f[t]=e[t];f.prototype[t]=function(){var e=[this._wrapped];i.apply(e,arguments);return U(this,r.apply(f,e))}})};f.mixin(f);f.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];f.prototype[e]=function(){var r=this._wrapped;t.apply(r,arguments);if((e==="shift"||e==="splice")&&r.length===0)delete r[0];return U(this,r)}});f.each(["concat","join","slice"],function(e){var t=r[e];f.prototype[e]=function(){return U(this,t.apply(this._wrapped,arguments))}});f.prototype.value=function(){return this._wrapped};f.prototype.valueOf=f.prototype.toJSON=f.prototype.value;f.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return f})}})();define("core/lib/tools",["require","exports","underscore"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.repeat=function(e,t){return r.range(e).map(function(){return t})};t.contains=function(e,t){return!!(e&&e.indexOf(t)>=0)};t.pluck=function(e,t){return e.map(function(e){return e[t]})};t.flatten=function(e){var t;return(t=[]).concat.apply(t,e)}});define("core/l10n/localization",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e){if(e){this.initialize(e)}}e.prototype.assertContext=function(){if(!this.context){throw new Error("Expected i18n module to be initialized before being used.")}return this.context};e.prototype.ftl=function(){return this.assertContext().getFluentBundleSequence()};e.prototype.locale=function(){return this.assertContext().getLocale()};e.prototype.initialize=function(e){this.context=e};e.prototype.isRTL=function(){return["ar","he"].indexOf(this.locale())>=0};e.prototype.s=function(e,t){if(t===void 0){t={}}return this.ftl().format(e,t)||this.fallback(e)};e.prototype.unpack=function(e){var t=e.key,r=e.variables;return this.ftl().format(t,r)||this.fallback(t)};e.prototype.raw=function(e){return e};e.prototype.num=function(e){return""+e};e.prototype.date=function(e,t){return this.ftl().formatDate(e,t)};e.prototype.time=function(e){return this.ftl().formatTime(e)};e.prototype.fallback=function(e){var r;if(((r=this.context)===null||r===void 0?void 0:r.getEnvironment())==="development"){return e}return t.EMPTY};return e}();t.Localization=r;t.EMPTY=""});define("core/lib/i18n",["require","exports","../l10n/localization"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.EMPTY=r.EMPTY;t.i18n=new r.Localization;function n(e){t.i18n.initialize(e)}t.initialize=n});define("core/components/cardsort/group-tools",["require","exports","underscore","core/lib/tools","core/lib/i18n","../component-helpers"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a="g-";t.initCardGroup=function(e,t,r){var n;var i;if(r!=null){n=r.x;i=r.y}else{n=Math.random()*.9;i=Math.random()*.9}return{id:o.generatePrefixId(a,o.getNextUniqueIdNum(e,a)),cardIds:[t],x:n,y:i}};t.positionInitialCards=function(e){var t=r.keys(e).length;var n=Math.ceil(Math.sqrt(t));var i=Math.pow(n,2);var o=r.shuffle(r.range(i));var a=0;var s={};for(var u in e){var c=o[a];var l=c%n;var p=(c-l)/n;s[u]={x:(l/n+(a+1)*.5/n/t)*.9,y:p/n+(a+1)*.5/n/t};a++}return s};t.addCardGroup=function(e,t){t.groupIds.push(e.id);t.groups[e.id]=e};t.bubbleGroup=function(e,t){var n=r.without(t.groupIds,e);n.push(e);t.groupIds=n};t.getCardGroupForCard=function(e,t){for(var r in t.groups){var n=t.groups[r];if(n.cardIds.indexOf(e)>=0){return r}}return undefined};t.removeGroup=function(e,t){t.groupIds=r.without(t.groupIds,e);delete t.groups[e]};t.pluckCard=function(e,n){var i=t.getCardGroupForCard(e,n);if(!i)return;var o=n.groups[i].cardIds;n.groups[i].cardIds=r.without(o,e);if(n.groups[i].cardIds.length===0){t.removeGroup(i,n)}};t.dropCard=function(e,r,n){var i=e.itemId,o=e.dropZone;t.pluckCard(i,n);if(o&&o.groupId){var a=n.groups[o.groupId].cardIds;var s=o.cardIdAfter?a.indexOf(o.cardIdAfter):-1;a.splice(s+1,0,i);t.bubbleGroup(o.groupId,n)}else{t.addCardGroup(t.initCardGroup(n.groupIds,i,r),n)}};t.joinCardFromKeyboard=function(e,r,n){var i=t.getCardGroupForCard(r,n);if(i&&n.groups[i]){t.pluckCard(e,n);var o=n.groups[i].cardIds;o.push(e);t.bubbleGroup(i,n)}};t.unjoinCardFromKeyboard=function(e,r){var n=t.getCardGroupForCard(e,r);if(n){var i=r.groups[n].cardIds;if(i.length>1){t.pluckCard(e,r);t.addCardGroup(t.initCardGroup(r.groupIds,e),r)}}};t.dropGroup=function(e,r,n){var i=e.itemId;n.groups[i].x=r.x;n.groups[i].y=r.y;t.bubbleGroup(i,n)};t.pairHash=function(e){var t=e[0],r=e[1];if(t<r){return t+"-"+r}else{return r+"-"+t}};t.groupHash=function(e){return r.sortBy(e.cardIds).join(";")};t.getGroupHashes=function(e){return r.filter(r.values(e.groups),function(e){return e.cardIds.length>1}).map(t.groupHash)};t.allPairs=function(e){var t=[];for(var r=0,n=e;r<n.length;r++){var i=n[r];var o=i.cardIds.length;if(o>1){for(var a=0;a<o;a++){for(var s=a;s<o;s++){t.push([i.cardIds[a],i.cardIds[s]])}}}}return t};t.pairsEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]||e[0]===t[1]&&e[1]===t[0]};t.studentFinished=function(e){if((e!=null?e.groups:void 0)==null){return false}return t.numGroupedCards(e)>2*t.numUngroupedCards(e)};t.groupSizes=function(e){return r.values(e.groups).map(function(e){return e.cardIds.length})};t.numGroupedCards=function(e){return r.filter(t.groupSizes(e),function(e){return e>1}).reduce(function(e,t){return e+t},0)};t.numUngroupedCards=function(e){return r.filter(t.groupSizes(e),function(e){return e===1}).reduce(function(e,t){return e+t},0)};t.avgGroupSize=function(e){var t=r.values(e.groups).map(function(e){return e.cardIds.length});if(t.length===0){return 0}return t.reduce(function(e,t){return e+t},0)/t.length};t.anyGrouped=function(e){return r.any(r.values(e.groups),function(e){return e.cardIds.length>1})};t.groupsEqual=function(e,t){return e.cardIds.length===t.cardIds.length&&r.all(e.cardIds,function(e){return t.cardIds.indexOf(e)>=0})};t.isIncorrect=function(e,t){if(!(e.cardIds.length>1)){return false}if(t==null){return false}var n=r.pluck(r.values(t.groups),"cardIds");return r.any(n,function(t){return r.any(e.cardIds,function(n){return t.indexOf(n)>=0&&!r.all(e.cardIds,function(e){return t.indexOf(e)>=0})})})};t.isSubgroup=function(e,t){return e.cardIds.length<t.cardIds.length&&r.all(e.cardIds,function(e){return t.cardIds.indexOf(e)>=0})};t.computeDecCoords=function(e,t){var r=Math.ceil(Math.sqrt(t));return{x:e%r/r,y:Math.floor(e/r)/r}};t.scoreLabeledGroup=function(e){var t=e.labels;var n=r.filter(t,function(e){return e==="correct"}).length;var i;if(n===t.length){i=1e4+t.length}else if(n>0){i=n*100+t.length}else{i=t.length}return-i};function s(e){switch(e){case"card":return i.i18n.s("cardsort-title-card");case"correct":return i.i18n.s("cardsort-title-correct");case"missing":return i.i18n.s("cardsort-title-missing");case"incorrect":return i.i18n.s("cardsort-title-incorrect")}}t.labelName=s;t.labelGroup=function(e,t){var i=e.cardIds;if(t==undefined){return n.repeat(i.length,"card")}var o=function(e){var o=t.groups[e].cardIds;if(r.all(i,function(e){return o.indexOf(e)>=0})){if(i.length==1&&!(o.length==1)){return{value:["card"]}}return{value:n.repeat(i.length,"correct").concat(n.repeat(o.length-i.length,"missing"))}}};for(var a in t.groups){var s=o(a);if(typeof s==="object")return s.value}return n.repeat(i.length,"incorrect")};t.computeCorrectCardCount=function(e,n){var i=t.labelResponse(e,n);var o=0;r.each(i,function(e){r.each(e.labels,function(e){if(e==="correct")o++})});return o};t.responseMatchesKey=function(e,n){if(e&&e.groupIds){var i=t.labelResponse(e,n);var o=r.flatten(r.map(i,function(e){return e.labels}));var a=r.some(o,function(e){return e!=="correct"});return!a}else{return false}};t.labelResponse=function(e,n){var i=r.keys(e.groups).map(function(r){return{groupId:r,labels:t.labelGroup(e.groups[r],n)}});return r.sortBy(i,t.scoreLabeledGroup)};t.aggregateGroups=function(e,n){var i={};for(var o in e){var a=e[o];for(var s=0,u=r.values(a.groups);s<u.length;s++){var c=u[s];if(!(c.cardIds.length>1)){continue}var l=t.groupHash(c);if(i[l]==null){i[l]={id:l,cardIds:c.cardIds,studentIds:[],incorrect:t.isIncorrect(c,n)}}i[l].studentIds.push(o)}}return i};t.aggregateCards=function(e){var t={};for(var r in e){var n=e[r];if(n.incorrect){for(var i=0,o=n.cardIds;i<o.length;i++){var a=o[i];if(t[a]==null){t[a]={id:a,cardIds:[a],studentIds:[]}}t[a].studentIds=t[a].studentIds.concat(n.studentIds)}}}return t};function u(e){var t=[];for(var r=0,n=e.groupIds;r<n.length;r++){var i=n[r];var o=e.groups[i];if(o){t.push({cardIds:o.cardIds,collapsed:!!o.collapsed})}}return t}t.responseToExternalGroups=u});(function(e,t){if(typeof define==="function"&&define.amd){define("core/lib/mathtools",[],t)}else{e.mathtools=t()}})(this,function(){var e,t,r;!function(n){var i,o,a,s,u={},c={},l={},p={},f=Object.prototype.hasOwnProperty,d=[].slice;function h(e,t){return f.call(e,t)}function m(e,t){var r,n,i,o,a,s,u,c,p,f,d=t&&t.split("/"),h=l.map,m=h&&h["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=(d=d.slice(0,d.length-1)).concat(e.split("/")),c=0;c<e.length;c+=1)if("."===(f=e[c]))e.splice(c,1),--c;else if(".."===f){if(1===c&&(".."===e[2]||".."===e[0]))break;0<c&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||m)&&h){for(c=(r=e.split("/")).length;0<c;--c){if(n=r.slice(0,c).join("/"),d)for(p=d.length;0<p;--p)if(i=(i=h[d.slice(0,p).join("/")])&&i[n]){o=i,a=c;break}if(o)break;!s&&m&&m[n]&&(s=m[n],u=c)}!o&&s&&(o=s,a=u),o&&(r.splice(0,a,o),e=r.join("/"))}return e}function y(e,t){return function(){return o.apply(n,d.call(arguments,0).concat([e,t]))}}function g(e){var t;if(h(c,e)&&(t=c[e],delete c[e],p[e]=!0,i.apply(n,t)),!h(u,e)&&!h(p,e))throw new Error("No "+e);return u[e]}function v(e){var t,r=e?e.indexOf("!"):-1;return-1<r&&(t=e.substring(0,r),e=e.substring(r+1,e.length)),[t,e]}a=function(e,t){var r,n,i=v(e),o=i[0];return e=i[1],o&&(r=g(o=m(o,t))),o?e=r&&r.normalize?r.normalize(e,(n=t,function(e){return m(e,n)})):m(e,t):(o=(i=v(e=m(e,t)))[0],e=i[1],o&&(r=g(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:r}},s={require:function(e){return y(e)},exports:function(e){var t=u[e];return void 0!==t?t:u[e]={}},module:function(e){return{id:e,uri:"",exports:u[e],config:(t=e,function(){return l&&l.config&&l.config[t]||{}})};var t}},i=function(e,t,r,i){var o,l,f,d,m,v,b=[];if(i=i||e,"function"==typeof r){for(t=!t.length&&r.length?["require","exports","module"]:t,m=0;m<t.length;m+=1)if("require"===(l=(d=a(t[m],i)).f))b[m]=s.require(e);else if("exports"===l)b[m]=s.exports(e),v=!0;else if("module"===l)o=b[m]=s.module(e);else if(h(u,l)||h(c,l)||h(p,l))b[m]=g(l);else{if(!d.p)throw new Error(e+" missing "+l);d.p.load(d.n,y(i,!0),function(e){return function(t){u[e]=t}}(l),{}),b[m]=u[l]}f=r.apply(u[e],b),e&&(o&&o.exports!==n&&o.exports!==u[e]?u[e]=o.exports:f===n&&v||(u[e]=f))}else e&&(u[e]=r)},e=t=o=function(e,t,r,u,c){return"string"==typeof e?s[e]?s[e](t):g(a(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=r,r=null):e=n),t=t||function(){},"function"==typeof r&&(r=u,u=c),u?i(n,e,t,r):setTimeout(function(){i(n,e,t,r)},4),o)},o.config=function(e){return(l=e).deps&&o(l.deps,l.callback),o},(r=function(e,t,r){t.splice||(r=t,t=[]),h(u,e)||h(c,e)||(c[e]=[e,t,r])}).amd={jQuery:!0}}(),"undefined"!=typeof ALMOND_OVERRIDES&&ALMOND_OVERRIDES&&(r=ALMOND_OVERRIDES.define||r,t=ALMOND_OVERRIDES.require||t,e=ALMOND_OVERRIDES.requirejs||e);r("core/vendor/almond",function(){});r("core/lib/worker-i18n",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.t=void 0,t.t=function(e,t){return{msg:e,vars:t}}});r("pjs",[],function(){var e,t,r;function n(e){return"object"==typeof e}function i(e){return"function"==typeof e}function o(){}return e="prototype",t={}.hasOwnProperty,function a(s,u){function c(){var e=new l;return i(e.init)&&e.init.apply(e,arguments),e}function l(){}u===r&&(u=s,s=Object),c.Bare=l;var p,f=o[e]=s[e],d=l[e]=c[e]=new o;return(d.constructor=c).mixin=function(t){return l[e]=c[e]=a(c,t)[e],c},(c.open=function(e){if(p={},i(e)?p=e.call(c,d,f,c,s):n(e)&&(p=e),n(p))for(var r in p)t.call(p,r)&&(d[r]=p[r]);return i(d.init)||(d.init=s),c})(u)}});r("core/math/mathshim",["require"],function(e){"use strict";var t={};return t.cosh=Math.cosh||function(e){return.5*(Math.exp(e)+Math.exp(-e))},t.sinh=Math.sinh&&0!==Math.sinh(1e-20)?Math.sinh:function(e){var r=0<e?1:-1;return e=0<e?e:-e,.5*-r*Math.exp(e)*t.expm1(-2*e)},t.tanh=Math.tanh&&0!==Math.tanh(1e-20)?Math.tanh:function(e){var r=0<e?1:-1;e=0<e?e:-e;var n=t.expm1(-2*e);return-r*n/(2+n)},t.acosh=Math.acosh||function(e){return e<1?NaN:Math.log(e+t.sqrtxsqm1(e))},t.asinh=Math.asinh&&0!==Math.asinh(1e-20)?Math.asinh:function(e){var r=0<e?1:-1;return 1+(e=0<e?e:-e)*e==1?r*t.log1p(e):r*Math.log(e+t.sqrtxsqp1(e))},t.atanh=Math.atanh&&0!==Math.atanh(1e-20)?Math.atanh:function(e){return.5*(t.log1p(e)-t.log1p(-e))},t.expm1=Math.expm1||function(e){return e+.5*e*e===e?e:Math.exp(e)-1},t.log1p=Math.log1p||function(e){return e-.5*e*e===e?e:Math.log(1+e)},t.sqrtxsqp1=function(e){var t=e*e;return 1+t==1?1:1+t==t?Math.abs(e):Math.sqrt(1+t)},t.sqrtxsqm1=function(e){var t=e*e;return t<1?NaN:t-1==t?Math.abs(e):Math.sqrt(t-1)},t});r("core/math/distance",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.approx=t.pointToSegment=t.closestPointOnSegment=t.pointToSegmentParameter=t.mean=t.hypot=void 0;var r=Math.hypot&&Math.hypot(1/0,NaN)===1/0;function n(e){return e===1/0||e===-1/0}function i(e,r,n,i,o,a,s,u,c){var l=t.hypot(s-i,u-o,c-a);return 0===l?0:(e-i)/l*((s-i)/l)+(r-o)/l*((u-o)/l)+(n-a)/l*((c-a)/l)}function o(e,t,r,n,o,a){var s=i(e,t,0,r,n,0,o,a,0);return s<=0?[r,n]:1<=s?[o,a]:[r+s*(o-r),n+s*(a-n)]}t.hypot=r?Math.hypot:function(e,t,r){if(n(e)||n(t)||void 0!==r&&n(r))return 1/0;if(isNaN(e)||isNaN(t)||void 0!==r&&isNaN(r))return NaN;if(0===e&&0===t&&(void 0===r||0===r))return 0;for(var i=0,o=0,a=0;a<arguments.length;a+=1){var s=Math.abs(Number(arguments[a]));i<s&&(o*=i/s*(i/s),i=s),o+=0===s&&0===i?0:s/i*(s/i)}return i===1/0?1/0:i*Math.sqrt(o)},t.mean=function(e,t){return 0<e==0<t?e+.5*(t-e):.5*(e+t)},t.pointToSegmentParameter=i,t.closestPointOnSegment=o,t.pointToSegment=function(e,r,n,i,a,s){var u=o(e,r,n,i,a,s);return t.hypot(e-u[0],r-u[1])},t.approx=function(e,t,r){if(void 0===r&&(r=1),e===t)return!0;if(!isFinite(e)||!isFinite(t))return!1;if(50<r)throw new Error("Within "+(52-r)+" bits isn't really approximate any more");var n=Math.max(Math.max(Math.abs(e),Math.abs(t)),1);return n===n+(1===r?.5:Math.pow(.5,r))*Math.abs(t-e)}});r("core/math/poi",["require","exports","core/math/distance"],function(e,t,r){"use strict";function n(e,t){var n;t<e&&(n=e,e=t,t=n);var i=0<e,o=0<t,a=.01<Math.abs(e),s=.01<Math.abs(t);if(a||s)return r.mean(e,t);if(0===e)return t*Math.abs(t);if(0===t)return e*Math.abs(e);if(i!=o)return 0;var u=i?Math.sqrt(e*t):-Math.sqrt(e*t);return e<=u&&u<=t?u:r.mean(e,t)}function i(e,t,r,i,s,u,c){var l,p,f,d;if(isFinite(i))return isFinite(t)||(l=o(e,t,r,i,c))&&(e=l[0],t=l[1]),isFinite(u)||(l=o(r,i,s,u,c))&&(s=l[0],u=l[1]),p=t===i?[e,t]:a(e,t,r,i,c,i),f=u===i?[s,u]:a(r,i,s,u,c,i),p&&f&&(d=n(p[0],f[0])),void 0!==d?[d,c(d)]:void 0}function o(e,t,r,i,o){if(isFinite(t)!==isFinite(i))for(;;){var a=n(e,r),s=o(a);if(a===e||a===r)return isFinite(t)?[e,t]:[r,i];isFinite(s)!==isFinite(t)?(r=a,i=s):(e=a,t=s)}}function a(e,t,r,i,o,a){if(t===a!=(i===a))for(;;){var s=n(e,r),u=o(s);if(s===e||s===r)return t===a?[e,t]:[r,i];u===a!=(t===a)?(r=s,i=u):(e=s,t=u)}}function s(e,t){var r=e[0],n=e[1],i=t[0],o=t[1];return(i-r)*(i-r)+(o-n)*(o-n)}function u(e,t,r,i,o,a){var u,c,l,p,f,d,h,m,y,g=a(e),v=a(t),b=a(r),x=s(g,i),_=s(v,i),S=s(b,i);if(!(t<=e||r<=t)&&isFinite(x)&&isFinite(_)&&isFinite(S)&&!(x<=_||S<=_))for(;;){if(Math.abs(b[0]-g[0])<o&&Math.abs(b[1]-g[1])<o)return[e,r];var T=n(e,t),w=a(T),E=s(w,i),M=n(t,r),C=a(M),I=s(C,i);if(!isFinite(E)||!isFinite(I))return;if(T===e||T===t||M===t||M===r)return E<_&&E<I?[T,T]:I<E&&I<_?[M,M]:[t,t];if(!(E!==_&&I!==_||E!==(_=s(v=a(t=.5*(T+t)),i))&&I!==_))return[e,r];E<_&&E<I?(r=(u=[t,T])[0],t=u[1],b=(c=[v,w])[0],v=c[1],S=(l=[_,E])[0],_=l[1]):I<E&&I<_?(e=(p=[t,M])[0],t=p[1],g=(f=[v,C])[0],v=f[1],x=(d=[_,I])[0],_=d[1]):(e=(h=[T,M])[0],r=h[1],g=(m=[w,C])[0],b=m[1],x=(y=[E,I])[0],S=y[1])}}function c(e,t,r){return void 0===t&&(t=-1/0),void 0===r&&(r=1/0),Math.min(r,Math.max(t,e))}function l(e,t,r,n,i,o){var a,l,p,f,d;d=void 0!==n&&void 0!==i?r+.01*(r<.5*(n+i)?i-n:n-i):1<Math.abs(r)?1.00001*r:r+1e-5;var h=e(r),m=e(d),y=s(h,t),g=s(m,t);if(isFinite(y)&&isFinite(g)){if(y===g)return[r,d];for(y<g&&(r=(a=[d,r])[0],d=a[1],l=[m,h],y=(p=[g,y])[0],g=p[1]);isFinite(r)&&isFinite(d)&&r!==d;){if(void 0!==i&&i<d)return[i,i];if(void 0!==n&&d<n)return[n,n];var v=r+3*(d-r),b=s(e(v),t);if(!isFinite(b))return[r,d];if(b===g)return[r,d];if(g<b){var x=r<d?u(r,d,v,t,o,e):u(v,d,r,t,o,e);return x?[c(x[0],n,i),c(x[1],n,i)]:x}r=(f=[d,g,v,b])[0],y=f[1],d=f[2],g=f[3]}return[r,d]}}function p(e,t,r,n){return!r||n&&Math.min(s(e(n[0]),t),s(e(n[1]),t))<Math.min(s(e(r[0]),t),s(e(r[1]),t))}function f(e,t,r,n,i,o,a,s){var u=Math.abs(n-t),c=Math.abs(o-n),l=Math.abs(s-o);return c<u&&l<u?[[e,t],[r,n]]:c<l&&u<l?[[i,o],[a,s]]:[[r,n],[i,o]]}Object.defineProperty(t,"__esModule",{value:!0}),t.bisectJump=t.findLocalClosestPointOnParametric=t.bisectClosestPointOnParametric=t.bisectExtremum=t.bisectFinite=t.flatCenter=t.bisectZero=t.floatMiddle=void 0,t.floatMiddle=n,t.bisectZero=function(e,t,r,o,a){if(!isNaN(t)&&!isNaN(o)&&t<0!=o<0)for(;;){var s=n(e,r),u=a(s);if(!isFinite(u))return;if(s===e||s===r)return Math.abs(t)<=Math.abs(o)?[e,t]:[r,o];if(0===u)return i(e,t,s,u,r,o,a);t<0!=u<0?(r=s,o=u):(e=s,t=u)}},t.flatCenter=i,t.bisectFinite=o,t.bisectExtremum=function(e,t,r,o,a,s,u){if(e<r&&r<a&&isFinite(t)&&isFinite(o)&&isFinite(s)&&t!==o&&o!==s&&t<o==s<o)for(;;){var c=n(e,r),l=u(c),p=n(r,a),f=u(p);if(!isFinite(l)||!isFinite(f))return;if(c===e||c===r||p===r||p===a)return o<l==t<o?[c,l]:o<f==t<o?[p,f]:[r,o];if(l===o||f===o)return i(e,t,r,o,a,s,u);t<l==t<o&&t<l==o<l?(a=r,s=o,r=c,o=l):s<f==s<o&&o<f==s<f?(e=r,t=o,r=p,o=f):(e=c,t=l,a=p,s=f)}},t.bisectClosestPointOnParametric=u,t.findLocalClosestPointOnParametric=function(e,t,r,n,i,o){var a,s,u=l(e,t,r,n,i,o);return void 0===n||p(e,t,u,a=l(e,t,n,n,i,o))&&(u=a),void 0===i||p(e,t,u,s=l(e,t,i,n,i,o))&&(u=s),u},t.bisectJump=function(e,t,i,a,s,u,c,l){if(l=l||0,!((i-e)*(s-i)<=0)&&isFinite(e)&&isFinite(i)&&isFinite(s)&&isFinite(t)&&isFinite(u)){if(!isFinite(a)){var p=o(e,t,i,a,c),d=o(i,a,s,u,c);if(!p||!d)return;return[p,d]}if(!(Math.abs(a-((s-i)*t+(i-e)*u)/(s-e))<l))for(;;){var h=n(e,i),m=c(h),y=n(i,s),g=c(y),v=Math.abs(m-r.mean(t,a)),b=Math.abs(a-r.mean(m,g)),x=Math.abs(g-r.mean(a,u));if(v<=l&&b<=l&&x<=l)return;if(!isFinite(m)){p=o(e,t,h,m,c),d=o(h,m,s,u,c);if(!p||!d)return;return[p,d]}if(!isFinite(g)){p=o(e,t,y,g,c),d=o(y,g,s,u,c);if(!p||!d)return;return[p,d]}if(!(h!==e&&h!==i||y!==i&&y!==s))return Math.abs(a-t)>Math.abs(u-a)?[[e,t],[i,a]]:[[i,a],[s,u]];if(h===e||h===i)return f(e,t,i,a,y,g,s,u);if(y===i||y===s)return f(e,t,h,m,i,a,s,u);x<v&&b<=v?(s=i,u=a,i=h,a=m):v<x&&b<=x?(e=i,t=a,i=y,a=g):(e=h,t=m,s=y,u=g)}}}});r("core/math/quadrature",["require","core/math/mathshim","core/math/poi"],function(e){"use strict";var t=e("core/math/mathshim"),r=e("core/math/poi"),n=r.bisectJump,i=r.bisectFinite,o=Math.pow(2,-13),a=o*o,s=a*a,u=a,c=32,l=[],p=[];!function(e,r){for(var n=c;0<n;n--){var i=3.154019550531224/c*n,o=t.sinh(i),a=t.cosh(Math.PI/2*o),s=1/(Math.exp(Math.PI/2*o)*a),u=t.cosh(i)/(a*a);e.push(s),r.push(u)}}(l,p);for(var f=0,d=0;d<p.length;d++)f+=p[d];var h=1/(1+2*f);function m(e,t,r){return.5*(t*(2-r)+e*r)}function y(e,t,r,n,i){return{x1:e,x2:t,value:r,error:n,minerror:i}}function g(e,t,r){var n=Math.abs(e(m(t,r,a))),i=Math.abs(e(m(t,r,2*a))),o=Math.abs(e(m(t,r,4*a)));return!(n<a||i<a)&&(1.95*i<n&&1.95*o<i)}function v(e,t,r){var n,o,a=m(r,t,l[0]),s=m(t,r,l[0]),f=e(a),d=e(s),v=m(t,r,1),b=e(v);if(isFinite(b)&&!isFinite(f)){if(n=i(a,f,v,b,e),Math.abs((n[0]-t)/(r-t))>u)return y(t,r,NaN,NaN,NaN);t=n[0],f=n[1]}if(isFinite(b)&&!isFinite(d)){if(o=i(v,b,s,d,e),Math.abs((o[0]-r)/(r-t))>u)return y(t,r,NaN,NaN,NaN);r=o[0],d=o[1]}if(isFinite(f)&&isFinite(d)&&!isFinite(b)){if(n=i(a,f,v,b,e),o=i(v,b,s,d,e),Math.abs((o[0]-n[0])/(r-t))>u)return y(t,r,NaN,NaN,NaN);b=.5*(n[1]+o[1])}if(g(e,t,r)||g(e,r,t))return y(t,r,NaN,NaN,NaN);for(var x,_,S=b,T=0,w=0,E=0,M=0,C=0;C<c;C+=4)x=e(m(t,r,l[C])),_=e(m(r,t,l[C])),M=Math.max(M,Math.abs(x),Math.abs(_)),T+=p[C]*(x+_),x=e(m(t,r,l[C+1])),_=e(m(r,t,l[C+1])),M=Math.max(M,Math.abs(x),Math.abs(_)),E+=p[C+1]*(x+_),x=e(m(t,r,l[C+2])),_=e(m(r,t,l[C+2])),M=Math.max(M,Math.abs(x),Math.abs(_)),w+=p[C+2]*(x+_),x=e(m(t,r,l[C+3])),_=e(m(r,t,l[C+3])),M=Math.max(M,Math.abs(x),Math.abs(_)),E+=p[C+3]*(x+_);var I=S+T,P=I+w,k=P+E,O=Math.abs(w-I),D=Math.abs(E-P),N=h*(r-t)*k,A=h*Math.abs(r-t)*M*p[0],L=0===O?h*Math.abs(r-t)*D:h*Math.abs(r-t)*D*(D/O)*(D/O);return y(t,r,N,L=Math.max(L,A),A)}function b(e){for(var t=-1/0,r=-1/0,n=-1,i=0,o=0;o<e.length;o++){var a=e[o];i+=a.value,a.error>t&&(t=a.error,n=o),a.minerror>r&&(r=a.minerror)}return{maxerror:t,maxminerror:r,maxindex:n,totalvalue:i}}return{quad:function e(t,r,i,o){if(void 0===o&&(o=32),isNaN(r)||isNaN(i))return NaN;var a,u=1;if(i<r&&(a=r,r=i,i=a,u=-1),r===1/0&&i===1/0)return NaN;if(r===-1/0&&i===-1/0)return NaN;if(r===-1/0&&i===1/0)return u*e(function(e){return t(e/((1+e)*(1-e)))*(1+e*e)/((1+e)*(1+e)*(1-e)*(1-e))},-1,1,o);if(r===-1/0)return u*e(function(e){return-t(i-e/(1-e))/((1-e)*(1-e))},1,0,o);if(i===1/0)return u*e(function(e){return t(r+e/(1-e))/((1-e)*(1-e))},0,1,o);for(var c,l,p,f,d,h=[v(t,r,i)],y=b(h),g=1;g<o&&!(Math.abs(y.maxerror/y.totalvalue)<=32*s||y.maxerror<=32*s||y.maxerror<=32*y.maxminerror)&&isFinite(y.maxerror)&&isFinite(y.maxminerror);g++){var x=h[h.length-1];h[h.length-1]=h[y.maxindex],h[y.maxindex]=x;var _=h.pop(),S=(c=t,l=m(_.x2,_.x1,.125),p=m(_.x1,_.x2,.125),d=f=void 0,f=.5*(l+p),(d=n(l,c(l),f,c(f),p,c(p),c,0))?.5*(d[0][0]+d[1][0]):f);h.push(v(t,_.x1,S)),h.push(v(t,S,_.x2)),y=b(h)}return isFinite(y.maxerror)&&isFinite(y.maxminerror)?Math.abs(y.totalvalue)<=10*y.maxminerror?0:u*y.totalvalue:NaN}}});r("core/math/tofraction",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===t&&(t=1e6),e===1/0)return{n:1/0,d:1};if(e===-1/0)return{n:-1/0,d:1};if(!isFinite(e))return{n:NaN,d:1};for(var r,n,i,o=0,a=1,s=1,u=0;n=(r=Math.floor(e))*a+o,!(t<(i=r*u+s))&&(o=a,s=u,a=n,u=i,e!==r);)e=1/(e-r);return{n:a,d:u}}});!function(e){"use strict";function t(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function n(e,r,n,i,o,a){return t((s=t(t(r,e),t(i,a)))<<(u=o)|s>>>32-u,n);var s,u}function i(e,t,r,i,o,a,s){return n(t&r|~t&i,e,t,o,a,s)}function o(e,t,r,i,o,a,s){return n(t&i|r&~i,e,t,o,a,s)}function a(e,t,r,i,o,a,s){return n(t^r^i,e,t,o,a,s)}function s(e,t,r,i,o,a,s){return n(r^(t|~i),e,t,o,a,s)}function u(e,r){var n,u,c,l;e[r>>5]|=128<<r%32,e[14+(r+64>>>9<<4)]=r;for(var p=1732584193,f=-271733879,d=-1732584194,h=271733878,m=0;m<e.length;m+=16)p=i(n=p,u=f,c=d,l=h,e[m],7,-680876936),h=i(h,p,f,d,e[m+1],12,-389564586),d=i(d,h,p,f,e[m+2],17,606105819),f=i(f,d,h,p,e[m+3],22,-1044525330),p=i(p,f,d,h,e[m+4],7,-176418897),h=i(h,p,f,d,e[m+5],12,1200080426),d=i(d,h,p,f,e[m+6],17,-1473231341),f=i(f,d,h,p,e[m+7],22,-45705983),p=i(p,f,d,h,e[m+8],7,1770035416),h=i(h,p,f,d,e[m+9],12,-1958414417),d=i(d,h,p,f,e[m+10],17,-42063),f=i(f,d,h,p,e[m+11],22,-1990404162),p=i(p,f,d,h,e[m+12],7,1804603682),h=i(h,p,f,d,e[m+13],12,-40341101),d=i(d,h,p,f,e[m+14],17,-1502002290),p=o(p,f=i(f,d,h,p,e[m+15],22,1236535329),d,h,e[m+1],5,-165796510),h=o(h,p,f,d,e[m+6],9,-1069501632),d=o(d,h,p,f,e[m+11],14,643717713),f=o(f,d,h,p,e[m],20,-373897302),p=o(p,f,d,h,e[m+5],5,-701558691),h=o(h,p,f,d,e[m+10],9,38016083),d=o(d,h,p,f,e[m+15],14,-660478335),f=o(f,d,h,p,e[m+4],20,-405537848),p=o(p,f,d,h,e[m+9],5,568446438),h=o(h,p,f,d,e[m+14],9,-1019803690),d=o(d,h,p,f,e[m+3],14,-187363961),f=o(f,d,h,p,e[m+8],20,1163531501),p=o(p,f,d,h,e[m+13],5,-1444681467),h=o(h,p,f,d,e[m+2],9,-51403784),d=o(d,h,p,f,e[m+7],14,1735328473),p=a(p,f=o(f,d,h,p,e[m+12],20,-1926607734),d,h,e[m+5],4,-378558),h=a(h,p,f,d,e[m+8],11,-2022574463),d=a(d,h,p,f,e[m+11],16,1839030562),f=a(f,d,h,p,e[m+14],23,-35309556),p=a(p,f,d,h,e[m+1],4,-1530992060),h=a(h,p,f,d,e[m+4],11,1272893353),d=a(d,h,p,f,e[m+7],16,-155497632),f=a(f,d,h,p,e[m+10],23,-1094730640),p=a(p,f,d,h,e[m+13],4,681279174),h=a(h,p,f,d,e[m],11,-358537222),d=a(d,h,p,f,e[m+3],16,-722521979),f=a(f,d,h,p,e[m+6],23,76029189),p=a(p,f,d,h,e[m+9],4,-640364487),h=a(h,p,f,d,e[m+12],11,-421815835),d=a(d,h,p,f,e[m+15],16,530742520),p=s(p,f=a(f,d,h,p,e[m+2],23,-995338651),d,h,e[m],6,-198630844),h=s(h,p,f,d,e[m+7],10,1126891415),d=s(d,h,p,f,e[m+14],15,-1416354905),f=s(f,d,h,p,e[m+5],21,-57434055),p=s(p,f,d,h,e[m+12],6,1700485571),h=s(h,p,f,d,e[m+3],10,-1894986606),d=s(d,h,p,f,e[m+10],15,-1051523),f=s(f,d,h,p,e[m+1],21,-2054922799),p=s(p,f,d,h,e[m+8],6,1873313359),h=s(h,p,f,d,e[m+15],10,-30611744),d=s(d,h,p,f,e[m+6],15,-1560198380),f=s(f,d,h,p,e[m+13],21,1309151649),p=s(p,f,d,h,e[m+4],6,-145523070),h=s(h,p,f,d,e[m+11],10,-1120210379),d=s(d,h,p,f,e[m+2],15,718787259),f=s(f,d,h,p,e[m+9],21,-343485551),p=t(p,n),f=t(f,u),d=t(d,c),h=t(h,l);return[p,f,d,h]}function c(e){for(var t="",r=32*e.length,n=0;n<r;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t}function l(e){var t=[];for(t[(e.length>>2)-1]=void 0,n=0;n<t.length;n+=1)t[n]=0;for(var r=8*e.length,n=0;n<r;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t}function p(e){for(var t,r="0123456789abcdef",n="",i=0;i<e.length;i+=1)t=e.charCodeAt(i),n+=r.charAt(t>>>4&15)+r.charAt(15&t);return n}function f(e){return unescape(encodeURIComponent(e))}function d(e){return c(u(l(t=f(e)),8*t.length));var t}function h(e,t){return function(e,t){var r,n,i=l(e),o=[],a=[];for(o[15]=a[15]=void 0,16<i.length&&(i=u(i,8*e.length)),r=0;r<16;r+=1)o[r]=909522486^i[r],a[r]=1549556828^i[r];return n=u(o.concat(l(t)),512+8*t.length),c(u(a.concat(n),640))}(f(e),f(t))}function m(e,t,r){return t?r?h(t,e):p(h(t,e)):r?d(e):p(d(e))}"function"==typeof r&&r.amd?r("core/lib/md5",[],function(){return m}):"object"==typeof module&&module.exports?module.exports=m:e.md5=m}(this);r("core/vendor/d3-color",["require"],function(e){function t(e,t,r){(e.prototype=t.prototype=r).constructor=e}function r(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function n(){}var i=.7,o=1/i,a="\\s*([+-]?\\d+)\\s*",s="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",u="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",c=/^#([0-9a-f]{3,8})$/,l=new RegExp("^rgb\\("+[a,a,a]+"\\)$"),p=new RegExp("^rgb\\("+[u,u,u]+"\\)$"),f=new RegExp("^rgba\\("+[a,a,a,s]+"\\)$"),d=new RegExp("^rgba\\("+[u,u,u,s]+"\\)$"),h=new RegExp("^hsl\\("+[s,u,u]+"\\)$"),m=new RegExp("^hsla\\("+[s,u,u,s]+"\\)$"),y={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function g(){return this.rgb().formatHex()}function v(){return this.rgb().formatRgb()}function b(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=c.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?x(t):3===r?new w(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?_(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?_(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=l.exec(e))?new w(t[1],t[2],t[3],1):(t=p.exec(e))?new w(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=f.exec(e))?_(t[1],t[2],t[3],t[4]):(t=d.exec(e))?_(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=h.exec(e))?I(t[1],t[2]/100,t[3]/100,1):(t=m.exec(e))?I(t[1],t[2]/100,t[3]/100,t[4]):y.hasOwnProperty(e)?x(y[e]):"transparent"===e?new w(NaN,NaN,NaN,0):null}function x(e){return new w(e>>16&255,e>>8&255,255&e,1)}function _(e,t,r,n){return n<=0&&(e=t=r=NaN),new w(e,t,r,n)}function S(e){return e instanceof n||(e=b(e)),e?new w((e=e.rgb()).r,e.g,e.b,e.opacity):new w}function T(e,t,r,n){return 1===arguments.length?S(e):new w(e,t,r,null==n?1:n)}function w(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function E(){return"#"+C(this.r)+C(this.g)+C(this.b)}function M(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function C(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function I(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||1<=r?e=t=NaN:t<=0&&(e=NaN),new O(e,t,r,n)}function P(e){if(e instanceof O)return new O(e.h,e.s,e.l,e.opacity);if(e instanceof n||(e=b(e)),!e)return new O;if(e instanceof O)return e;var t=(e=e.rgb()).r/255,r=e.g/255,i=e.b/255,o=Math.min(t,r,i),a=Math.max(t,r,i),s=NaN,u=a-o,c=(a+o)/2;return u?(s=t===a?(r-i)/u+6*(r<i):r===a?(i-t)/u+2:(t-r)/u+4,u/=c<.5?a+o:2-a-o,s*=60):u=0<c&&c<1?0:s,new O(s,u,c,e.opacity)}function k(e,t,r,n){return 1===arguments.length?P(e):new O(e,t,r,null==n?1:n)}function O(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function D(e,t,r){return 255*(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)}return t(n,b,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:g,formatHex:g,formatHsl:function(){return P(this).formatHsl()},formatRgb:v,toString:v}),t(w,T,r(n,{brighter:function(e){return e=null==e?o:Math.pow(o,e),new w(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?i:Math.pow(i,e),new w(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:E,formatHex:E,formatRgb:M,toString:M})),t(O,k,r(n,{brighter:function(e){return e=null==e?o:Math.pow(o,e),new O(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?i:Math.pow(i,e),new O(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new w(D(240<=e?e-240:120+e,i,n),D(e,i,n),D(e<120?240+e:e-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}})),{Color:n,darker:i,brighter:o,color:b,rgbConvert:S,rgb:T,Rgb:w,hslConvert:P,hsl:k}});r("core/math/builtin",["require","core/math/mathshim","core/math/distance","core/math/quadrature","core/math/tofraction","core/math/poi","core/lib/md5","core/vendor/d3-color"],function(e){"use strict";var t=e("core/math/mathshim"),r=e("core/math/distance"),n=e("core/math/quadrature"),i=e("core/math/tofraction").default,o=e("core/math/poi").floatMiddle,a=e("core/lib/md5"),s=e("core/vendor/d3-color");function u(e,t,r){return Math.max(t,Math.min(r,e))}var c={};c.cosh=t.cosh,c.sinh=t.sinh,c.tanh=t.tanh,c.acosh=t.acosh,c.asinh=t.asinh,c.atanh=t.atanh,c.expm1=t.expm1,c.log1p=t.log1p,c.sqrtxsqp1=t.sqrtxsqp1,c.sqrtxsqm1=t.sqrtxsqm1,c.mod=function(e,t){return e-t*Math.floor(e/t)},c.round=function(e,t){if(void 0===t&&(t=0),0===(t=Math.round(t)))return Math.round(e);var r=Math.pow(10,t);return Math.round(e*r)/r},c.sign=Math.sign||function(e){return 0===e?0:0<e?1:e<0?-1:NaN},c.lcm=function(e,t){e=Math.round(e),t=Math.round(t);var r=c.gcd(e,t);return Math.abs(e/r*t)},c.gcd=function(e,t){var r;if((e=Math.round(e))<0&&(e=-e),(t=Math.round(t))<0&&(t=-t),e<t&&(r=t,t=e,e=r),0===t)return e;for(var n=e%t;0<n;)n=(e=t)%(t=n);return t},c.listGCD=function(e){if(0===e.length)return NaN;for(var t=e[0],r=1;r<e.length;r++)t=c.gcd(t,e[r]);return t},c.listLCM=function(e){if(0===e.length)return NaN;for(var t=e[0],r=1;r<e.length;r++)t=c.lcm(t,e[r]);return t},c.nCr=function(e,t){if((e=Math.round(e))<(t=Math.round(t))||e<0||t<0)return 0;if(t===1/0||e===1/0)return NaN;for(var r=1,n=0;n<t;n++)r*=(e-n)/(n+1);return r},c.nPr=function(e,t){if((e=Math.round(e))<(t=Math.round(t))||e<0||t<0)return 0;if(t===1/0||e===1/0)return NaN;for(var r=1,n=0;n<t;n++)r*=e-n;return r},c.factorial=function(e){return c.gamma(e+1)},c.gamma=function(e){if(e<0)return Math.PI/(c.sin(Math.PI*e)*c.gamma(1-e));if(170<e)return 1/0;var t=Math.round(e)===e,r=e<15?l(e):e<120?p(e):Math.exp(f(e));return t?Math.round(r):r};var l=function(e){var t=1+e*(4.077131788261185+e*(7.024675027156382+e*(6.657107767450176+e*(3.766266976716022+e*(1.2792371666711133+e*(.24304596436338005+.020049769312165774*e)))))),r=1+e*(4.154347453162709+e*(7.270007565107539+e*(6.97805297331391+e*(3.989651532924167+e*(1.367176195613119+e*(.26175627691546965+.021742722739397567*e))))));return Math.E*Math.pow((1+e)/Math.E,1+e)/(e*Math.sqrt(1+e))*(t/r)},p=function(e){var t=e-1;return Math.pow(t,t)*Math.exp(g(t)-t)*Math.sqrt(2*Math.PI*t)},f=function(e){var t=e-1;return t*(Math.log(t)-1)+.5*Math.log(2*Math.PI*t)+g(t)};c.lnGamma=function(e){return e<0?NaN:e<15?Math.log(l(e)):f(e)},c.bernoulliTable=[1/6,-1/30,1/42,-1/30,5/66,-691/2730,7/6,-3617/510,43867/798,-174611/330,854513/138,-236364091/2730,8553103/6,-23749461029/870],c.cotDerivative=function(e,t){if(e!==Math.floor(e))return NaN;if(e<0)return NaN;if(0===e)return 1/c.tan(t);var r=c.sin(t);if(1===e)return-1/(r*r);var n=c.cos(t);if(2===e)return 2*n/(r*r*r);for(var i,o,a,s=[0,2],u=3;u<=e;u++){for(i=[],p=0;p<u;p++)(a=o=0)<p&&(o=(u-p+1)*s[p-1]),p+2<u&&(a=(p+1)*s[p+1]),i.push(-(o+a));s=i}for(var l=0,p=e-1;0<=p;p--)l=i[p]+n*l;return l/Math.pow(r,e+1)},c.polyGamma=function(e,t){if(e<0)return NaN;if(e!==Math.floor(e))return NaN;var r=e%2==0?-1:1;if(t<0)return-r*c.polyGamma(e,1-t)-Math.pow(Math.PI,e+1)*c.cotDerivative(e,Math.PI*t);for(var n=c.factorial(e),i=0,o=Math.pow(t,-(e+1));t<10;)i+=o,t++,o=Math.pow(t,-(e+1));i+=0===e?-Math.log(t):o*t/e,i+=.5*o;for(var a=c.bernoulliTable,s=e+1,u=2,l=o*t*s/u,p=1/(t*t),f=1;f<=14;f++)i+=(l*=p)*a[f-1],l*=++s/++u,l*=++s/++u;return n*r*i},c.toFraction=i,c.log=function(e){var t=Math.log(e);return Math.exp(Math.round(t))===e?Math.round(t):t},c.log_base=function(e,t){if(0===t)return NaN;var r=t===Math.E?Math.log(e):2===t&&Math.log2?Math.log2(e):10===t&&Math.log10?Math.log10(e):Math.log(e)/Math.log(t);return Math.pow(t,Math.round(r))===e?Math.round(r):r},c.common_log=function(e){return c.log_base(e,10)},c.pow=function(e,t){if(!isFinite(e)&&0===t)return NaN;if(0<=e||t===Math.floor(t))return Math.pow(e,t);var n=c.toFraction(t,100);return r.approx(n.n/n.d,t,2)&&n.d%2==1?(n.n%2==0?1:-1)*Math.pow(-e,t):NaN},c.nthroot=function(e,t){return c.pow(e,1/t)};var d=1/Math.PI;function h(e){return!(1e12<e)&&Math.round(d*e)*Math.PI===e}function m(e){if(!(1e12<e)){var t=Math.round(2*d*e);return t%2==1&&t*Math.PI==2*e}}c.sin=function(e){return h(Math.abs(e))?0:Math.sin(e)},c.cos=function(e){return m(Math.abs(e))?0:Math.cos(e)},c.tan=function(e){var t=Math.abs(e);return h(t)?0:m(t)?1/0:Math.tan(e)},c.sec=function(e){return m(Math.abs(e))?1/0:1/Math.cos(e)},c.csc=function(e){return h(Math.abs(e))?1/0:1/Math.sin(e)},c.cot=function(e){var t=Math.abs(e);return h(t)?1/0:m(t)?0:1/Math.tan(e)},c.acot=function(e){return Math.PI/2-Math.atan(e)},c.acsc=function(e){return Math.asin(1/e)},c.asec=function(e){return Math.acos(1/e)},c.sech=function(e){return 1/c.cosh(e)},c.csch=function(e){return 1/c.sinh(e)},c.coth=function(e){return 1/c.tanh(e)},c.asech=function(e){return c.acosh(1/e)},c.acsch=function(e){return c.asinh(1/e)},c.acoth=function(e){return c.atanh(1/e)},c.mean=function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length},c.total=function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t};function y(e){return 50<e?Math.exp(.5*((1-e)*t.log1p(-1/(e-1))-1)+g(.5*(e-1))-g(.5*(e-2)))*Math.sqrt((1-1/e)/(2*Math.PI)):c.gamma((e+1)/2)/(c.gamma(e/2)*Math.sqrt(e*Math.PI))}var g=function(e){var t=e*e;return(.08333333333333333-(.002777777777777778-(.0007936507936507937-(.0005952380952380953-.0008417508417508417/t)/t)/t)/t)/e};c.tpdf=function(e,t){return t<=0?NaN:y(t)*Math.pow(1+e*e/t,-(t+1)/2)};var v=function(e,t){if(0<t)return 1-v(e,-t);if(t===-1/0)return 0;var r=Math.sqrt(2*e/(e+1));if(Math.abs(t/r)<.001)return.5*(1+Math.sqrt(Math.PI)*y(e)*r*c.erf(t/r));if(t/e<-1e3){var n=t*t;return y(e)*Math.pow(e,.5*(e-1))*Math.pow(Math.abs(t),-e)*(1-e*e*(e+1)*(1/(2+e)+e*(e+3)/(4*(4+e)*n))/(2*n))}var i=Math.sqrt(t*t+e);return _((t+i)/(2*i),e/2,e/2)};c.tcdf=function(e,t,r){return r<=0?NaN:e===-1/0?v(r,t):0<e&&0<t?v(r,-e)-v(r,-t):v(r,t)-v(r,e)};function b(e,t,r){return(e-t)/(Math.SQRT2*Math.abs(r))}function x(e){return e<0?.5*Math.exp(-e*e)*c.erfcx(-e):1-.5*Math.exp(-e*e)*c.erfcx(e)}var _=function(e,r,n){if(e<0||1<e)throw new RangeError("First argument must be between 0 and 1.");if(1===r&&1===n)return e;if(0===e)return 0;if(1===e)return 1;if(0===r)return 1;if(0===n)return 0;var i=Math.exp(c.lnGamma(r+n)-c.lnGamma(r)-c.lnGamma(n)+r*Math.log(e)+n*t.log1p(-e));return e<(r+1)/(r+n+2)?i*S(e,r,n)/r:1-i*S(1-e,n,r)/n},S=function(e,t,r){var n,i,o,a,s=1e-30,u=1,c=t+r,l=t+1,p=t-1,f=1,d=1-c*e/l;for(Math.abs(d)<s&&(d=s),a=d=1/d;u<=100&&(d=1+(i=u*(r-u)*e/((p+(n=2*u))*(t+n)))*d,Math.abs(d)<s&&(d=s),f=1+i/f,Math.abs(f)<s&&(f=s),a*=(d=1/d)*f,d=1+(i=-(t+u)*(c+u)*e/((t+n)*(l+n)))*d,Math.abs(d)<s&&(d=s),f=1+i/f,Math.abs(f)<s&&(f=s),a*=o=(d=1/d)*f,!(Math.abs(o-1)<3e-7));u++);return a};c.normalcdf=function(e,t,r,n){var i=b(t,r,n);if(e===-1/0)return x(i);var o=b(e,r,n);return 0<e&&0<t?x(-o)-x(-i):x(i)-x(o)},c.normalpdf=function(e,t,r){return 1/Math.sqrt(2*Math.PI*r*r)*Math.exp(-(e-t)*(e-t)/(2*r*r))},c.random=function(e){var t=a(e);return(4294967296*(2097151&parseInt(t.slice(0,8),16))+parseInt(t.slice(8,16),16))/9007199254740992},c.shuffle=function(e,t){for(var r=t.length-1;0<r;r--){var n=e+"::sc"+r,i=Math.floor(c.random(n)*(r+1)),o=t[r];t[r]=t[i],t[i]=o}},c.randomPerm=function(e,t){for(var r=[],n=0;n<t;n++)r.push(n);return c.shuffle(e,r),r},c.uniformSample=function(e,t,r){return c.random(e)*(r-t)+t},c.normalSample=function(e,t,r){for(var n,i,o,a,s=0;n=e+"::sc"+s,s+=1,i=2*c.uniformSample(n,0,1)-1,n=e+"::sc"+s,s+=1,1<=(a=i*i+(o=2*c.uniformSample(n,0,1)-1)*o)||0===a;);return t+r*i*Math.sqrt(-2*Math.log(a)/a)},c.tSample=function(e,t){if(t<=0)return NaN;for(var r,n,i,o=0;u=e+"::sc"+o,o+=1,r=2*c.uniformSample(u,0,1)-1,u=e+"::sc"+o,o+=1,1<(i=r*r+(n=2*c.uniformSample(u,0,1)-1)*n););var a=r*r/i,s=t*(Math.pow(i,-2/t)-1),u=e+"::sc"+o;return o+=1,(c.uniformSample(u,0,1)<.5?-1:1)*Math.sqrt(a*s)},c.binomSample=function(e,t,r){return(t=u(Math.round(t),0,1/0))===1/0?NaN:(r=u(r,0,1),c.invBinom(c.uniformSample(e,0,1),t,r))},c.poissonSample=function(e,t){return t<=0?NaN:c.invPoisson(c.uniformSample(e,0,1),t)};function T(e,t,r){if(t<=e)return 1;if(e<0)return 0;for(var n=r/(1-r),i=Math.pow(1-r,t),o=i,a=1;a<=Math.min(t,e);a++)o+=i*=(t-a+1)/a*n;return o}c.binomcdf=function(e,t,r,n){return(r=u(Math.round(r),0,1/0))===1/0?NaN:(n=u(n,0,1),t<0?0:(e=Math.ceil(e),t=Math.floor(t),e===-1/0?T(t,r,n):T(t,r,n)-T(e-1,r,n)))},c.binompdf=function(e,t,r){return e=Math.round(e),(t=u(Math.round(t),0,1/0))===1/0?NaN:(r=u(r,0,1),e<0||t<e?0:c.nCr(t,e)*Math.pow(r,e)*Math.pow(1-r,t-e))},c.poissonpdf=function(e,t){return t<=0?NaN:(e=Math.round(e))<0?0:Math.exp(-t+e*Math.log(t)-c.lnGamma(e+1))};function w(e,t){if(e===1/0)return 1;if(e<0)return 0;for(var r=1,n=1,i=1;i<=e;i++){var o=n;if((n+=r*=t/i)===o)break}return Math.exp(-t)*n}c.poissoncdf=function(e,t,r){return r<=0?NaN:(e=Math.ceil(e),(t=Math.floor(t))<0?0:e===-1/0?w(t,r):w(t,r)-w(e-1,r))},c.uniformpdf=function(e,t,r){return r<=t?NaN:e<t||r<e?0:1/(r-t)};function E(e,t,r){return r<=t?NaN:e<t?0:r<e?1:(e-t)/(r-t)}c.uniformcdf=function(e,t,r,n){return E(t,r,n)-E(e,r,n)},c.erf=function(e){var t=-e*e;if(t<-750)return 0<=e?1:-1;if(.065<=e)return 1-Math.exp(t)*c.erfcx(e);if(e<=-.065)return Math.exp(t)*c.erfcx(-e)-1;return e*(1.1283791670955126+t*(.37612638903183754+t*(.11283791670955126+t*(.026866170645131252+.005223977625442188*t))))},c.erfcx=function(e){if(e<0)return e<-6.1?2*Math.exp(e*e):2*Math.exp(e*e)-c.erfcx(-e);if(50<e){var t=.5641895835477563,r=e*e;return 5e7<e?t/e:t*(r*(4.5+r)+2)/(e*(r*(5+r)+3.75))}return(.9999999999999999+e*(2.224574423459406+e*(2.444115549920689+e*(1.7057986861852539+e*(.8257463703357973+e*(.28647031042892007+e*(.07124513844341643+e*(.012296749268608364+e*(.001347817214557592+7263959403471071e-20*e)))))))))/(1+e*(3.352953590554884+e*(5.227518529742423+e*(5.003720878235473+e*(3.266590890998987+e*(1.5255421920765353+e*(.5185887413188858+e*(.12747319185915415+e*(.02185979575963238+e*(.0023889438122503674+.00012875032817508128*e))))))))))},c.invNorm=function(e){var t,r,n;return.5<e?-c.invNorm(1-e):.5===e?0:e<0?NaN:0===e?-1/0:(n=e<.02425?(((((-.00778489400243029*(t=Math.sqrt(-2*Math.log(e)))-.322396458041136)*t-2.40075827716184)*t-2.54973253934373)*t+4.37466414146497)*t+2.93816398269878)/((((.00778469570904146*t+.32246712907004)*t+2.445134137143)*t+3.75440866190742)*t+1):(((((-39.6968302866538*(r=(t=e-.5)*t)+220.946098424521)*r-275.928510446969)*r+138.357751867269)*r-30.6647980661472)*r+2.50662827745924)*t/(((((-54.4760987982241*r+161.585836858041)*r-155.698979859887)*r+66.8013118877197)*r-13.2806815528857)*r+1))-Math.sqrt(2*Math.PI)*(.5*c.erfcx(-n/Math.SQRT2)-Math.exp(.5*n*n)*e)},c.invPoisson=function(e,t){if(t<=0||e<0||1<e)return NaN;if(0===e)return 0;if(1===e)return 1/0;for(var r=1,n=1,i=1;Math.exp(-t)*n<e;){if(n+(r*=t/i)===n)return 1/0;n+=r,i+=1}return i-1},c.invBinom=function(e,t,r){if(t!==Math.round(t))return NaN;if(r<0||1<r)return NaN;if(e<0||1<e)return NaN;if(0===e)return 0;if(1===e)return t;if(0===t)return 0;if(1===r)return t;if(0===r)return 0;for(var n=r/(1-r),i=Math.pow(1-r,t),o=i,a=1;o<e;){if(o+(i*=(t-a+1)/a*n)===o)return t;if(t<a)return t;o+=i,a+=1}return a-1},c.invT=function(e,t){return isNaN(t)||t<=0||e<0||1<e?NaN:0===e?-1/0:1===e?1/0:1===t||2===t||4===t?M(t,e):.5===e?0:.5<e?(r=1<t?c.invNorm(e):M(1,e),n=1<t?M(1,e):Math.pow(c.tpdf(0,t)*Math.pow(t,(t-1)/2)/(1-e),1/t),C(t,e,r,n)):-c.invT(1-e,t);var r,n};var M=function(e,t){var r=4*t*(1-t);switch(e){case 1:return Math.tan(Math.PI*(t-.5));case 2:return 2*(t-.5)*Math.sqrt(2/r);case 4:var n=Math.cos(Math.acos(Math.sqrt(r))/3)/Math.sqrt(r);return 2*Math.sign(t-.5)*Math.sqrt(n-1);default:throw new Error("_invTSimple() must be called with 1, 2, or 4 df.")}},C=function(e,t,r,n){if(!isFinite(r)||!isFinite(n))return NaN;for(var i,a,s=r,u=n;;){if(i=o(s,u),a=v(e,i),i===s||i===u)return t<a?s:u;a<t?s=i:u=i}};function I(e,t,r){return r<0?c.tcdf(-1/0,e,t):0<r?c.tcdf(-1/0,-e,t):2*c.tcdf(-1/0,-Math.abs(e),t)}return c.invUniform=function(e,t,r){return e<0||1<e||r<=t?NaN:0===e?t:1===e?r:t+e*(r-t)},c.tscore=function(e,t){var r=c.stdev(e);return(c.mean(e)-t)*Math.sqrt(e.length)/r},c.itscore=function(e,t){var r=e.length,n=c.mean(e),i=c.stdev(e),o=t.length,a=c.mean(t),s=c.stdev(t);return(n-a)/(Math.sqrt(((r-1)*i*i+(o-1)*s*s)/(r+o-2))*Math.sqrt(1/r+1/o))},c.ttest=function(e,t){1===arguments.length&&(t=0);var r=c.tscore(e,t),n=e.length-1;return{lessThan:I(r,n,-1),greaterThan:I(r,n,1),notEqual:I(r,n,0)}},c.ittest=function(e,t){var r=c.itscore(e,t),n=e.length+t.length-2;return{lessThan:I(r,n,-1),greaterThan:I(r,n,1),notEqual:I(r,n,0)}},c.stats=function(e){return{min:c.listMin(e),q1:c.quartile(e,1),median:c.median(e),q3:c.quartile(e,3),max:c.listMax(e)}},c.length=function(e){return e.length},c.listMin=function(e){if(e.length<1)return NaN;var t=e[0];if(isNaN(t))return NaN;for(var r=1;r<e.length;r++){if(isNaN(e[r]))return NaN;e[r]<t&&(t=e[r])}return t},c.listMax=function(e){if(e.length<1)return NaN;var t=e[0];if(isNaN(t))return NaN;for(var r=1;r<e.length;r++){if(isNaN(e[r]))return NaN;e[r]>=t&&(t=e[r])}return t},c.quantile=function(e,t){if(!isFinite(t)||t<0||1<t)return NaN;if(e.some(isNaN))return NaN;if(0===e.length)return NaN;var r=e.length,n=c.sortPerm(e),i=t*(r-1);return Math.floor(i)===i?e[n[i]]:(Math.ceil(i)-i)*e[n[Math.floor(i)]]+(i-Math.floor(i))*e[n[Math.ceil(i)]]},c.quartile=function(e,t){if(!isFinite(t)||t<0||4<t)return NaN;if(e.some(isNaN))return NaN;var r=c.sortPerm(e),n=c.quartileIndex(e,t),i=Math.floor(n),o=Math.ceil(n);return(e[r[i]]+e[r[o]])/2},c.sortPerm=function(e){for(var t=e.length,r=[],n=0;n<t;n++)r.push(n);return r.sort(function(t,r){return e[t]-e[r]}),r},c.quartileIndex=function(e,t){t=Math.round(t);var r,n=e.length,i=n%2==1;return 1===n?0:(0===t&&(r=0),2===t&&(r=(n-1)/2),4===t&&(r=n-1),1===t&&(r=i?(n+1)/4-1:(n+2)/4-1),3===t&&(r=i?(3*n+3)/4-1:(3*n+2)/4-1),r)},c.upperQuantileIndex=function(e,t){return c.sortPerm(e)[Math.ceil(t*(e.length-1))]+1},c.lowerQuantileIndex=function(e,t){return c.sortPerm(e)[Math.floor(t*(e.length-1))]+1},c.upperQuartileIndex=function(e,t){return c.sortPerm(e)[Math.ceil(c.quartileIndex(e,t))]+1},c.lowerQuartileIndex=function(e,t){return c.sortPerm(e)[Math.floor(c.quartileIndex(e,t))]+1},c.median=function(e){return c.quantile(e,.5)},c.argMin=function(e){if(e.length<1)return 0;var t=e[0];if(isNaN(t))return 0;for(var r=0,n=1;n<e.length;n++){if(isNaN(e[n]))return 0;e[n]<t&&(t=e[r=n])}return r+1},c.argMax=function(e){if(e.length<1)return 0;var t=e[0];if(isNaN(t))return 0;for(var r=0,n=1;n<e.length;n++)if(e[n]>=t){if(isNaN(e[n]))return 0;t=e[r=n]}return r+1},c.varp=function(e){for(var t=c.mean(e),r=0,n=0;n<e.length;n++){var i=e[n]-t;r+=i*i}return r/e.length},c.mad=function(e){for(var t=c.mean(e),r=0,n=0;n<e.length;n++)r+=Math.abs(e[n]-t);return r/e.length},c.var=function(e){var t=e.length;return c.varp(e)*t/(t-1)},c.covp=function(e,t){if(e.length!==t.length)return NaN;for(var r=e.length,n=c.mean(e),i=c.mean(t),o=0,a=0;a<r;a++)o+=(e[a]-n)*(t[a]-i);return o/r},c.cov=function(e,t){if(e.length!==t.length)return NaN;var r=e.length;return c.covp(e,t)*r/(r-1)},c.corr=function(e,t){if(e.length!==t.length)return NaN;for(var r,n,i=e.length,o=c.mean(e),a=c.mean(t),s=0,u=0,l=0,p=0;p<i;p++)s+=(r=e[p]-o)*r,u+=(n=t[p]-a)*n,l+=r*n;return l/Math.sqrt(s*u)},c.rank=function(e){var t=e.length;if(0===t)return[];for(var r=[],n=[],i=0;i<t;i++)n.push([e[i],i]);n.sort(function(e,t){var r=e[0],n=t[0];return r===1/0&&n===1/0||r===-1/0&&n===-1/0?0:r-n}),i=0;for(var o=1;i<t;){for(u=i;u<t-1&&n[u][0]===n[u+1][0];)u+=1;for(var a,s=u-i+1,u=0;u<s;u++)r[a=n[i+u][1]]=isNaN(e[a])?NaN:o+.5*(s-1);o+=s,i+=s}return r},c.spearman=function(e,t){return c.corr(c.rank(e),c.rank(t))},c.stdev=function(e){return Math.sqrt(c.var(e))},c.stdevp=function(e){return Math.sqrt(c.varp(e))},c.quad=n.quad,c.distance=function(e,t){return r.hypot(t[0]-e[0],t[1]-e[1])},c.midpoint=function(e,t){return[.5*(e[0]+t[0]),.5*(e[1]+t[1])]},c.addPoints=function(e,t){return[e[0]+t[0],e[1]+t[1]]},c.subtractPoints=function(e,t){return[e[0]-t[0],e[1]-t[1]]},c.negatePoint=function(e){return[-e[0],-e[1]]},c.multiplyPoint=function(e,t){return[t*e[0],t*e[1]]},c.dividePoint=function(e,t){return[e[0]/t,e[1]/t]},c.rgb=function(e,t,r){return[u(Math.round(e),0,255),u(Math.round(t),0,255),u(Math.round(r),0,255)]},c.hsv=function(e,t,r){e=u(e,0,360),t=u(t,0,1);var n=(r=u(r,0,1))*(1-t/2);t=0==n||1==n?0:(r-n)/Math.min(n,1-n);var i=s.hsl(e,t,n).rgb();return c.rgb(i.r,i.g,i.b)},c});r("core/math/functions",["require","exports","core/math/builtin"],function(e,t,r){"use strict";function n(e){delete e.fn}function i(e){e.fn=o(e.args,e.source)}function o(e,t){var n=e.join(",");return new Function("BuiltIn","return (function("+n+'){"use strict"; '+t+"})")(r)}Object.defineProperty(t,"__esModule",{value:!0}),t.closureFunctionWithBuiltIn=t.createEvaluateFunction=t.rehydrateCompiledFunction=t.dehydrateCompiledFunction=t.rehydrateGraphData=t.dehydrateGraphData=void 0,t.dehydrateGraphData=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t].compiled;i&&n(i)}},t.rehydrateGraphData=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t].compiled;n&&i(n)}},t.dehydrateCompiledFunction=n,t.rehydrateCompiledFunction=i,t.createEvaluateFunction=function(e,t){for(var r=[],n=0;n<t;n++)r.push("values["+n+"]");return o(["values"],"return "+e(r))},t.closureFunctionWithBuiltIn=o});r("core/math/parser/input-span",["require","exports"],function(e,t){"use strict";function r(e,t,r){return{input:e,start:t,end:r}}Object.defineProperty(t,"__esModule",{value:!0}),t.slice=t.joinSpans=t.emptySpanAt=t.Span=void 0,t.Span=r,t.emptySpanAt=function(e,t){return r(e,t,t)},t.joinSpans=function(e,t){if(e.input!==t.input)throw new Error("Programming Error: cannot form a span on different inputs");return r(e.input,e.start,t.end)},t.slice=function(e){return e.input.slice(e.start,e.end)}});r("core/math/policy",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultPolicy=void 0;var r=["Sum","Product","Integral","List","Derivative","Piecewise","Exponent","PercentOf"];t.defaultPolicy={assignmentForbidden:function(e){return!0},graphingEnabled:function(){return!1},isValidSlider:function(e){return!1},sliderVariables:function(e){return[]},ansEnabled:function(){return!1},disabledFeatures:function(){return r}}});r("core/math/parsenode/base",["require","pjs","core/math/functions","core/math/parser/input-span","core/math/policy"],function(e){"use strict";var t=e("pjs"),r=e("core/math/functions"),n=e("core/math/parser/input-span"),i=e("core/math/policy").defaultPolicy;return t(function(e,t,o){e.init=function(){this._dependencies=[],this._dummyDependencies=[],this._exports=[]};var a=e.exportPenalty=0;e.tmpVar=function(){return"tmp"+a++},e.dependencies=function(){return this.getDependencies()},e.evaluateOnce=function(e){void 0===e&&(e={});var t=this.getConcreteTree(i,e).getEvaluationInfo();return t?t[0].val:NaN},e.setInputSpan=function(e){this._inputSpan=e},e.getInputString=function(){return void 0===this._inputSpan?"":n.slice(this._inputSpan)},e.getInputSpan=function(){return this._inputSpan},e.shouldExportAns=function(){return!1},e.getAnsVariable=function(){return this.shouldExportAns()&&this.userData&&this.userData.hasOwnProperty("index")?["ans_"+this.userData.index]:[]},e.addDependency=function(e){this.dependsOn(e)||this._dependencies.push(e)},e.addDependencies=function(e){for(var t=0;t<e.length;t++)this.addDependency(e[t])},e.addDummyDependency=function(e){-1===this._dummyDependencies.indexOf(e)&&this._dummyDependencies.push(e)},e.addDummyDependencies=function(e){for(var t=0;t<e.length;t++)this.addDummyDependency(e[t])},e.mergeDependencies=function(){for(var e=0;e<arguments.length;e++)this.addDependencies(arguments[e].getDependencies()),this.addDummyDependencies(arguments[e].getDummyDependencies())},e.getDependencies=function(){return this._dependencies},e.getDummyDependencies=function(){return this._dummyDependencies},e.removeDependency=function(e){var t=this._dependencies.indexOf(e);0<=t&&this._dependencies.splice(t,1)},e.dependsOn=function(e){return-1<this._dependencies.indexOf(e)},e.getExports=function(){return(this._exports||[]).concat(this.getAnsVariable())},e.getLegalExports=function(e){return this.getExports().filter(function(t){return!e.assignmentForbidden(t)})},e.exportsSymbol=function(e){return-1<this._exports.indexOf(e)},e.exportTo=function(e,t,r){for(var n=this.getLegalExports(e),i=0;i<n.length;i++){var o=n[i];if(r[o])return;r[o]=t.blocksExport?t:this}},e.getOperator=function(){return this.operator||"="},e.isInequality=function(){return!1},e.isShadeBetween=function(){return!1},e.getAllIds=function(){return this.userData?[this.userData.id]:[]},e.getEvaluationInfo=function(){return!1},e.shouldPromoteToSlider=function(e){return!1},e.getSliderVariables=function(e,t){return e.sliderVariables(t.getDependencies())},e.getCompiledFunction=function(e){var t,n,i=this.getEvalStrings(),o=i.statements.join(";")+";return "+i.expression;return void 0!==e||-1!==(t=(e=this.getDependencies()).indexOf("x"))&&(n=e[0],e[0]=e[t],e[t]=n),{args:e,source:o,fn:r.closureFunctionWithBuiltIn(e,o)}},e.getCompiledDerivative=function(){var e=this.getDependencies();return this.takeDerivative(e[0]||"x").getCompiledFunction()},e.asValue=function(){}})});r("core/math/parsenode/error",["require","pjs","./base"],function(e){"use strict";return e("pjs")(e("./base"),function(e,t){e.init=function(e){t.init.call(this),this._msg=e,this._sliderVariables=[],this.blocksExport=!0},e.evaluateOnce=function(e){return this._msg},e.isError=!0,e.getError=function(){return this._msg},e.setDependencies=function(e){return this._dependencies=e,this},e.allowExport=function(){return this.blocksExport=!1,this}})});!function(e,t){var n,i;"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof r&&r.amd?r("underscore",t):(n=e._,i=t(),(e._=i).noConflict=function(){return e._=n,i})}(this,function(){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},t=Array.prototype,r=Object.prototype,n="undefined"!=typeof Symbol?Symbol.prototype:null,i=t.push,o=t.slice,a=r.toString,s=r.hasOwnProperty,u=Array.isArray,c=Object.keys,l=Object.create,p=e.isNaN,f=e.isFinite,d=function(){};function h(e){return e instanceof h?e:this instanceof h?void(this._wrapped=e):new h(e)}h.VERSION="1.10.2";function m(e,t,r){if(void 0===t)return e;switch(null==r?3:r){case 1:return function(r){return e.call(t,r)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,o){return e.call(t,r,n,i,o)}}return function(){return e.apply(t,arguments)}}function y(e,t,r){return null==e?rt:Be(e)?m(e,t,r):(ze(e)&&!Ve(e)?it:nt)(e)}function g(e,t){return y(e,t,1/0)}function v(e,t,r){return h.iteratee!==g?h.iteratee(e,t):y(e,t,r)}function b(e,t){return t=null==t?e.length-1:+t,function(){for(var r=Math.max(arguments.length-t,0),n=Array(r),i=0;i<r;i++)n[i]=arguments[i+t];switch(t){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}for(var o=Array(t+1),i=0;i<t;i++)o[i]=arguments[i];return o[t]=n,e.apply(this,o)}}function x(e){if(!ze(e))return{};if(l)return l(e);d.prototype=e;var t=new d;return d.prototype=null,t}function _(e){return function(t){return null==t?void 0:t[e]}}function S(e,t){return null!=e&&s.call(e,t)}function T(e,t){for(var r=t.length,n=0;n<r;n++){if(null==e)return;e=e[t[n]]}return r?e:void 0}h.iteratee=g;var w=Math.pow(2,53)-1,E=_("length");function M(e){var t=E(e);return"number"==typeof t&&0<=t&&t<=w}function C(e,t,r){if(t=m(t,r),M(e))for(i=0,o=e.length;i<o;i++)t(e[i],i,e);else for(var n=Se(e),i=0,o=n.length;i<o;i++)t(e[n[i]],n[i],e);return e}function I(e,t,r){t=v(t,r);for(var n=!M(e)&&Se(e),i=(n||e).length,o=Array(i),a=0;a<i;a++){var s=n?n[a]:a;o[a]=t(e[s],s,e)}return o}function P(e){return function(t,r,n,i){var o=3<=arguments.length;return function(t,r,n,i){var o=!M(t)&&Se(t),a=(o||t).length,s=0<e?0:a-1;for(i||(n=t[o?o[s]:s],s+=e);0<=s&&s<a;s+=e){var u=o?o[s]:s;n=r(n,t[u],u,t)}return n}(t,m(r,i,4),n,o)}}var k=P(1),O=P(-1);function D(e,t,r){var n=(M(e)?ie:ke)(e,t,r);if(void 0!==n&&-1!==n)return e[n]}function N(e,t,r){var n=[];return t=v(t,r),C(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function A(e,t,r){t=v(t,r);for(var n=!M(e)&&Se(e),i=(n||e).length,o=0;o<i;o++){var a=n?n[o]:o;if(!t(e[a],a,e))return!1}return!0}function L(e,t,r){t=v(t,r);for(var n=!M(e)&&Se(e),i=(n||e).length,o=0;o<i;o++){var a=n?n[o]:o;if(t(e[a],a,e))return!0}return!1}function F(e,t,r,n){return M(e)||(e=we(e)),"number"==typeof r&&!n||(r=0),0<=ue(e,t,r)}var R=b(function(e,t,r){var n,i;return Be(t)?i=t:Ve(t)&&(n=t.slice(0,-1),t=t[t.length-1]),I(e,function(e){var o=i;if(!o){if(n&&n.length&&(e=T(e,n)),null==e)return;o=e[t]}return null==o?o:o.apply(e,r)})});function q(e,t){return I(e,nt(t))}function V(e,t,r){var n,i,o=-1/0,a=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,u=(e=M(e)?e:we(e)).length;s<u;s++)null!=(n=e[s])&&o<n&&(o=n);else t=v(t,r),C(e,function(e,r,n){i=t(e,r,n),(a<i||i===-1/0&&o===-1/0)&&(o=e,a=i)});return o}function z(e,t,r){if(null==t||r)return M(e)||(e=we(e)),e[ot(e.length-1)];var n=(M(e)?Le:we)(e),i=E(n);t=Math.max(Math.min(t,i),0);for(var o=i-1,a=0;a<t;a++){var s=ot(a,o),u=n[a];n[a]=n[s],n[s]=u}return n.slice(0,t)}function j(e,t){return function(r,n,i){var o=t?[[],[]]:{};return n=v(n,i),C(r,function(t,i){var a=n(t,i,r);e(o,t,a)}),o}}var B=j(function(e,t,r){S(e,r)?e[r].push(t):e[r]=[t]}),U=j(function(e,t,r){e[r]=t}),G=j(function(e,t,r){S(e,r)?e[r]++:e[r]=1}),W=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;var J=j(function(e,t,r){e[r?0:1].push(t)},!0);function H(e,t,r){return null==e||e.length<1?null==t?void 0:[]:null==t||r?e[0]:$(e,e.length-t)}function $(e,t,r){return o.call(e,0,Math.max(0,e.length-(null==t||r?1:t)))}function Y(e,t,r){return o.call(e,null==t||r?1:t)}function K(e,t,r,n){for(var i=(n=n||[]).length,o=0,a=E(e);o<a;o++){var s=e[o];if(M(s)&&(Ve(s)||je(s)))if(t)for(var u=0,c=s.length;u<c;)n[i++]=s[u++];else K(s,t,r,n),i=n.length;else r||(n[i++]=s)}return n}var X=b(function(e,t){return ee(e,t)});function Q(e,t,r,n){tt(t)||(n=r,r=t,t=!1),null!=r&&(r=v(r,n));for(var i=[],o=[],a=0,s=E(e);a<s;a++){var u=e[a],c=r?r(u,a,e):u;t&&!r?(a&&o===c||i.push(u),o=c):r?F(o,c)||(o.push(c),i.push(u)):F(i,u)||i.push(u)}return i}var Z=b(function(e){return Q(K(e,!0,!0))});var ee=b(function(e,t){return t=K(t,!0,!0),N(e,function(e){return!F(t,e)})});function te(e){for(var t=e&&V(e,E).length||0,r=Array(t),n=0;n<t;n++)r[n]=q(e,n);return r}var re=b(te);function ne(e){return function(t,r,n){r=v(r,n);for(var i=E(t),o=0<e?0:i-1;0<=o&&o<i;o+=e)if(r(t[o],o,t))return o;return-1}}var ie=ne(1),oe=ne(-1);function ae(e,t,r,n){for(var i=(r=v(r,n,1))(t),o=0,a=E(e);o<a;){var s=Math.floor((o+a)/2);r(e[s])<i?o=s+1:a=s}return o}function se(e,t,r){return function(n,i,a){var s=0,u=E(n);if("number"==typeof a)0<e?s=0<=a?a:Math.max(a+u,s):u=0<=a?Math.min(a+1,u):a+u+1;else if(r&&a&&u)return n[a=r(n,i)]===i?a:-1;if(i!=i)return 0<=(a=t(o.call(n,s,u),et))?a+s:-1;for(a=0<e?s:u-1;0<=a&&a<u;a+=e)if(n[a]===i)return a;return-1}}var ue=se(1,ie,ae),ce=se(-1,oe);function le(e,t,r,n,i){if(!(n instanceof t))return e.apply(r,i);var o=x(e.prototype),a=e.apply(o,i);return ze(a)?a:o}var pe=b(function(e,t,r){if(!Be(e))throw new TypeError("Bind must be called on a function");var n=b(function(i){return le(e,n,t,this,r.concat(i))});return n}),fe=b(function(e,t){var r=fe.placeholder,n=function(){for(var i=0,o=t.length,a=Array(o),s=0;s<o;s++)a[s]=t[s]===r?arguments[i++]:t[s];for(;i<arguments.length;)a.push(arguments[i++]);return le(e,n,this,this,a)};return n});fe.placeholder=h;var de=b(function(e,t){var r=(t=K(t,!1,!1)).length;if(r<1)throw new Error("bindAll must be passed function names");for(;r--;){var n=t[r];e[n]=pe(e[n],e)}});var he=b(function(e,t,r){return setTimeout(function(){return e.apply(null,r)},t)}),me=fe(he,h,1);function ye(e){return function(){return!e.apply(this,arguments)}}function ge(e,t){var r;return function(){return 0<--e&&(r=t.apply(this,arguments)),e<=1&&(t=null),r}}var ve=fe(ge,2),be=!{toString:null}.propertyIsEnumerable("toString"),xe=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function _e(e,t){var n=xe.length,i=e.constructor,o=Be(i)&&i.prototype||r,a="constructor";for(S(e,a)&&!F(t,a)&&t.push(a);n--;)(a=xe[n])in e&&e[a]!==o[a]&&!F(t,a)&&t.push(a)}function Se(e){if(!ze(e))return[];if(c)return c(e);var t=[];for(var r in e)S(e,r)&&t.push(r);return be&&_e(e,t),t}function Te(e){if(!ze(e))return[];var t=[];for(var r in e)t.push(r);return be&&_e(e,t),t}function we(e){for(var t=Se(e),r=t.length,n=Array(r),i=0;i<r;i++)n[i]=e[t[i]];return n}function Ee(e){for(var t={},r=Se(e),n=0,i=r.length;n<i;n++)t[e[r[n]]]=r[n];return t}function Me(e){var t=[];for(var r in e)Be(e[r])&&t.push(r);return t.sort()}function Ce(e,t){return function(r){var n=arguments.length;if(t&&(r=Object(r)),n<2||null==r)return r;for(var i=1;i<n;i++)for(var o=arguments[i],a=e(o),s=a.length,u=0;u<s;u++){var c=a[u];t&&void 0!==r[c]||(r[c]=o[c])}return r}}var Ie=Ce(Te),Pe=Ce(Se);function ke(e,t,r){t=v(t,r);for(var n,i=Se(e),o=0,a=i.length;o<a;o++)if(t(e[n=i[o]],n,e))return n}function Oe(e,t,r){return t in r}var De=b(function(e,t){var r={},n=t[0];if(null==e)return r;Be(n)?(1<t.length&&(n=m(n,t[1])),t=Te(e)):(n=Oe,t=K(t,!1,!1),e=Object(e));for(var i=0,o=t.length;i<o;i++){var a=t[i],s=e[a];n(s,a,e)&&(r[a]=s)}return r}),Ne=b(function(e,t){var r,n=t[0];return Be(n)?(n=ye(n),1<t.length&&(r=t[1])):(t=I(K(t,!1,!1),String),n=function(e,r){return!F(t,r)}),De(e,n,r)}),Ae=Ce(Te,!0);function Le(e){return ze(e)?Ve(e)?e.slice():Ie({},e):e}function Fe(e,t){var r=Se(t),n=r.length;if(null==e)return!n;for(var i=Object(e),o=0;o<n;o++){var a=r[o];if(t[a]!==i[a]||!(a in i))return!1}return!0}function Re(e,t,r,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;return("function"==o||"object"==o||"object"==typeof t)&&function(e,t,r,i){e instanceof h&&(e=e._wrapped);t instanceof h&&(t=t._wrapped);var o=a.call(e);if(o!==a.call(t))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return n.valueOf.call(e)===n.valueOf.call(t)}var s="[object Array]"===o;if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var u=e.constructor,c=t.constructor;if(u!==c&&!(Be(u)&&u instanceof u&&Be(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}i=i||[];var l=(r=r||[]).length;for(;l--;)if(r[l]===e)return i[l]===t;if(r.push(e),i.push(t),s){if((l=e.length)!==t.length)return!1;for(;l--;)if(!Re(e[l],t[l],r,i))return!1}else{var p,f=Se(e);if(l=f.length,Se(t).length!==l)return!1;for(;l--;)if(p=f[l],!S(t,p)||!Re(e[p],t[p],r,i))return!1}return r.pop(),i.pop(),!0}(e,t,r,i)}function qe(e){return function(t){return a.call(t)==="[object "+e+"]"}}var Ve=u||qe("Array");function ze(e){var t=typeof e;return"function"==t||"object"==t&&!!e}var je=qe("Arguments"),Be=qe("Function"),Ue=qe("String"),Ge=qe("Number"),We=qe("Date"),Je=qe("RegExp"),He=qe("Error"),$e=qe("Symbol"),Ye=qe("Map"),Ke=qe("WeakMap"),Xe=qe("Set"),Qe=qe("WeakSet");!function(){je(arguments)||(je=function(e){return S(e,"callee")})}();var Ze=e.document&&e.document.childNodes;function et(e){return Ge(e)&&p(e)}function tt(e){return!0===e||!1===e||"[object Boolean]"===a.call(e)}function rt(e){return e}function nt(e){return Ve(e)?function(t){return T(t,e)}:_(e)}function it(e){return e=Pe({},e),function(t){return Fe(t,e)}}function ot(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof Ze&&(Be=function(e){return"function"==typeof e||!1});var at=Date.now||function(){return(new Date).getTime()},st={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},ut=Ee(st);function ct(e){function t(t){return e[t]}var r="(?:"+Se(e).join("|")+")",n=RegExp(r),i=RegExp(r,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(i,t):e}}var lt=ct(st),pt=ct(ut);var ft=0;function dt(e){return"\\"+yt[e]}var ht=h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},mt=/(.)^/,yt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},gt=/\\|'|\r|\n|\u2028|\u2029/g;function vt(e,t){return e._chain?h(t).chain():t}function bt(e){return C(Me(e),function(t){var r=h[t]=e[t];h.prototype[t]=function(){var e=[this._wrapped];return i.apply(e,arguments),vt(this,r.apply(h,e))}}),h}C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var r=t[e];h.prototype[e]=function(){var t=this._wrapped;return r.apply(t,arguments),"shift"!==e&&"splice"!==e||0!==t.length||delete t[0],vt(this,t)}}),C(["concat","join","slice"],function(e){var r=t[e];h.prototype[e]=function(){return vt(this,r.apply(this._wrapped,arguments))}}),h.prototype.valueOf=h.prototype.toJSON=h.prototype.value=function(){return this._wrapped},h.prototype.toString=function(){return String(this._wrapped)};var xt=bt({default:h,VERSION:"1.10.2",iteratee:g,restArguments:b,each:C,forEach:C,map:I,collect:I,reduce:k,foldl:k,inject:k,reduceRight:O,foldr:O,find:D,detect:D,filter:N,select:N,reject:function(e,t,r){return N(e,ye(v(t)),r)},every:A,all:A,some:L,any:L,contains:F,includes:F,include:F,invoke:R,pluck:q,where:function(e,t){return N(e,it(t))},findWhere:function(e,t){return D(e,it(t))},max:V,min:function(e,t,r){var n,i,o=1/0,a=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,u=(e=M(e)?e:we(e)).length;s<u;s++)null!=(n=e[s])&&n<o&&(o=n);else t=v(t,r),C(e,function(e,r,n){((i=t(e,r,n))<a||i===1/0&&o===1/0)&&(o=e,a=i)});return o},shuffle:function(e){return z(e,1/0)},sample:z,sortBy:function(e,t,r){var n=0;return t=v(t,r),q(I(e,function(e,r,i){return{value:e,index:n++,criteria:t(e,r,i)}}).sort(function(e,t){var r=e.criteria,n=t.criteria;if(r!==n){if(n<r||void 0===r)return 1;if(r<n||void 0===n)return-1}return e.index-t.index}),"value")},groupBy:B,indexBy:U,countBy:G,toArray:function(e){return e?Ve(e)?o.call(e):Ue(e)?e.match(W):M(e)?I(e,rt):we(e):[]},size:function(e){return null==e?0:M(e)?e.length:Se(e).length},partition:J,first:H,head:H,take:H,initial:$,last:function(e,t,r){return null==e||e.length<1?null==t?void 0:[]:null==t||r?e[e.length-1]:Y(e,Math.max(0,e.length-t))},rest:Y,tail:Y,drop:Y,compact:function(e){return N(e,Boolean)},flatten:function(e,t){return K(e,t,!1)},without:X,uniq:Q,unique:Q,union:Z,intersection:function(e){for(var t=[],r=arguments.length,n=0,i=E(e);n<i;n++){var o=e[n];if(!F(t,o)){for(var a=1;a<r&&F(arguments[a],o);a++);a===r&&t.push(o)}}return t},difference:ee,unzip:te,zip:re,object:function(e,t){for(var r={},n=0,i=E(e);n<i;n++)t?r[e[n]]=t[n]:r[e[n][0]]=e[n][1];return r},findIndex:ie,findLastIndex:oe,sortedIndex:ae,indexOf:ue,lastIndexOf:ce,range:function(e,t,r){null==t&&(t=e||0,e=0),r=r||(t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/r),0),i=Array(n),o=0;o<n;o++,e+=r)i[o]=e;return i},chunk:function(e,t){if(null==t||t<1)return[];for(var r=[],n=0,i=e.length;n<i;)r.push(o.call(e,n,n+=t));return r},bind:pe,partial:fe,bindAll:de,memoize:function(e,t){var r=function(n){var i=r.cache,o=""+(t?t.apply(this,arguments):n);return S(i,o)||(i[o]=e.apply(this,arguments)),i[o]};return r.cache={},r},delay:he,defer:me,throttle:function(e,t,r){var n,i,o,a,s=0;function u(){s=!1===r.leading?0:at(),n=null,a=e.apply(i,o),n||(i=o=null)}function c(){var c=at();s||!1!==r.leading||(s=c);var l=t-(c-s);return i=this,o=arguments,l<=0||t<l?(n&&(clearTimeout(n),n=null),s=c,a=e.apply(i,o),n||(i=o=null)):n||!1===r.trailing||(n=setTimeout(u,l)),a}return r=r||{},c.cancel=function(){clearTimeout(n),s=0,n=i=o=null},c},debounce:function(e,t,r){function n(t,r){i=null,r&&(o=e.apply(t,r))}var i,o,a=b(function(a){var s;return i&&clearTimeout(i),r?(s=!i,i=setTimeout(n,t),s&&(o=e.apply(this,a))):i=he(n,t,this,a),o});return a.cancel=function(){clearTimeout(i),i=null},a},wrap:function(e,t){return fe(t,e)},negate:ye,compose:function(){var e=arguments,t=e.length-1;return function(){for(var r=t,n=e[t].apply(this,arguments);r--;)n=e[r].call(this,n);return n}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:ge,once:ve,keys:Se,allKeys:Te,values:we,mapObject:function(e,t,r){t=v(t,r);for(var n=Se(e),i=n.length,o={},a=0;a<i;a++){var s=n[a];o[s]=t(e[s],s,e)}return o},pairs:function(e){for(var t=Se(e),r=t.length,n=Array(r),i=0;i<r;i++)n[i]=[t[i],e[t[i]]];return n},invert:Ee,functions:Me,methods:Me,extend:Ie,extendOwn:Pe,assign:Pe,findKey:ke,pick:De,omit:Ne,defaults:Ae,create:function(e,t){var r=x(e);return t&&Pe(r,t),r},clone:Le,tap:function(e,t){return t(e),e},isMatch:Fe,isEqual:function(e,t){return Re(e,t)},isEmpty:function(e){return null==e||(M(e)&&(Ve(e)||Ue(e)||je(e))?0===e.length:0===Se(e).length)},isElement:function(e){return!(!e||1!==e.nodeType)},isArray:Ve,isObject:ze,isArguments:je,isFunction:Be,isString:Ue,isNumber:Ge,isDate:We,isRegExp:Je,isError:He,isSymbol:$e,isMap:Ye,isWeakMap:Ke,isSet:Xe,isWeakSet:Qe,isFinite:function(e){return!$e(e)&&f(e)&&!p(parseFloat(e))},isNaN:et,isBoolean:tt,isNull:function(e){return null===e},isUndefined:function(e){return void 0===e},has:function(e,t){if(!Ve(t))return S(e,t);for(var r=t.length,n=0;n<r;n++){var i=t[n];if(null==e||!s.call(e,i))return!1;e=e[i]}return!!r},identity:rt,constant:function(e){return function(){return e}},noop:function(){},property:nt,propertyOf:function(e){return null==e?function(){}:function(t){return Ve(t)?T(e,t):e[t]}},matcher:it,matches:it,times:function(e,t,r){var n=Array(Math.max(0,e));t=m(t,r,1);for(var i=0;i<e;i++)n[i]=t(i);return n},random:ot,now:at,escape:lt,unescape:pt,result:function(e,t,r){Ve(t)||(t=[t]);var n=t.length;if(!n)return Be(r)?r.call(e):r;for(var i=0;i<n;i++){var o=null==e?void 0:e[t[i]];void 0===o&&(o=r,i=n),e=Be(o)?o.call(e):o}return e},uniqueId:function(e){var t=++ft+"";return e?e+t:t},templateSettings:ht,template:function(e,t,r){!t&&r&&(t=r),t=Ae({},t,h.templateSettings);var n,i=RegExp([(t.escape||mt).source,(t.interpolate||mt).source,(t.evaluate||mt).source].join("|")+"|$","g"),o=0,a="__p+='";e.replace(i,function(t,r,n,i,s){return a+=e.slice(o,s).replace(gt,dt),o=s+t.length,r?a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":n?a+="'+\n((__t=("+n+"))==null?'':__t)+\n'":i&&(a+="';\n"+i+"\n__p+='"),t}),a+="';\n",t.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(t.variable||"obj","_",a)}catch(t){throw t.source=a,t}function s(e){return n.call(this,e,h)}var u=t.variable||"obj";return s.source="function("+u+"){\n"+a+"}",s},chain:function(e){var t=h(e);return t._chain=!0,t},mixin:bt});return xt._=xt});r("core/lib/label",["require","exports","underscore","core/math/distance","core/math/tofraction"],function(e,t,r,n,i){"use strict";function o(e,t){if(void 0===t&&(t=e),isNaN(e)||!isFinite(e))return{ariaString:"undefined",string:"undefined",value:e};if(0===e)return{ariaString:"0",string:"0",value:e};Math.abs(e)>Math.abs(t)&&(t=e);var r=i.default(e/Math.PI,24);if(m(t)&&n.approx(r.n/r.d*Math.PI,e,3))return{ariaString:p(o=(0===r.n?"0":1===r.n?"":-1===r.n?"-":r.n.toString()+"")+(1===r.d?"":"/"+r.d.toString())),string:o,value:r.n/r.d*Math.PI};if(m(t))return{ariaString:p(o="-0"===(a=d(e.toFixed(y(t))))?"0":a),string:o,value:parseFloat(o)};var o,a,s=h(e.toExponential(y(t/e))).split("e"),u=s[0]+"10",c=s[1].replace("+","");return{ariaString:p(o=h(e.toExponential(y(t/e))).replace("+","")),string:o,mantissa:u,superscript:c,value:parseFloat(o)}}Object.defineProperty(t,"__esModule",{value:!0}),t.trimLatex=t.latexToIdentifier=t.identifierToHTML=t.identifierToLatex=t.formatSymbol=t.truncatedAriaLabel=t.truncatedLatexLabel=t.truncatedPlainmathLabel=t.truncatedHTMLLabel=t.numericLabel=t.canDisplayAsFraction=t.point=t.value=void 0,t.value=o;var a={"[e]":" times 10 to the ","[+]":" plus ","[-]":" minus ","[*]":" times ","[/]":" over ","[]":" pi ","[]":" tau ","[]":" theta ","[]":" phi "},s=new RegExp(Object.keys(a).join("|"),"gi");function u(e){return a["["+e+"]"]}var c=/\.\d+/g;function l(e){return e[0]+e.slice(1).split("").join(" ")}function p(e){return e.replace(c,l).replace(s,u).replace(/ +/gi," ").trim()}t.point=function(e,t,r,n){var i=o(e,t);return[i,o(n(i.value),r)]};var f=/\.?0+$/;function d(e){return-1===e.indexOf(".")?e:e.replace(f,"")}function h(e){return e.replace(/\.?0+e/,"e")}function m(e){return 1e-4<(e=Math.abs(e))&&e<1e7}function y(e){return e=Math.abs(e),e=Math.max(e,1e-16),Math.max(3,Math.floor(4.5-Math.log(e)/Math.LN10))}function g(e){return 1e6/Math.sqrt(Math.abs(e))}function v(e){var t=g(e);if(t<1)return!1;if(1e12<t)return!1;var r=i.default(e,t),n=r.n,o=r.d;return 1!==o&&e===e+Math.pow(2,-3)*Math.abs(n/o-e)}function b(e,t){if(t=t||{},isNaN(e)||!isFinite(e))return{type:"undefined"};if(0===e||t.zeroCutoff&&Math.abs(e)<t.zeroCutoff)return{type:"decimal",value:"0"};var r=t.smallCutoff||.001,n=t.bigCutoff||1e6,o=t.digits||10,a=h(e.toExponential(o-2)).match(/([\d\.\-]+)e\+?([\d\-]+)/);if(!a)return{type:"undefined"};var s=parseInt(a[2],10)>=o,u=v(e);if(Math.abs(e)>n||Math.abs(e)<r||s)return{type:"scientific",mantissa:a[1],exponent:a[2]};if(u&&t.displayAsFraction){var c=i.default(e,g(e));return{type:"fraction",numerator:c.n.toString(),denominator:c.d.toString()}}var l=d(e.toPrecision(o));return e!==Number(l)&&t.addEllipses&&(l+="..."),{type:"decimal",value:l}}function x(e){e=e.replace("\\","");var t={pi:"",tau:"",theta:"",phi:"",div:"",cdot:"",times:"",lt:"<",gt:">",le:"",ge:"",sim:"",ldots:"",prime:"",approx:""};return t.hasOwnProperty(e)?t[e]:e}t.canDisplayAsFraction=v,t.numericLabel=b,t.truncatedHTMLLabel=function(e,t){var r=b(e,t);switch(r.type){case"undefined":return"undefined";case"decimal":return r.value;case"scientific":return r.mantissa+"<span class='dcg-cross'></span>10<sup>"+r.exponent+"</sup>";case"fraction":return"1"===r.denominator?r.numerator:r.numerator+"/"+r.denominator;default:return r}},t.truncatedPlainmathLabel=function(e,t){var r=b(e,t);switch(r.type){case"undefined":return"undefined";case"decimal":return r.value;case"scientific":return r.mantissa+" * 10^"+r.exponent;case"fraction":return"1"===r.denominator?r.numerator:r.numerator+"/"+r.denominator;default:return r}},t.truncatedLatexLabel=function(e,t){var r=b(e,t);switch(r.type){case"undefined":return"undefined";case"decimal":return r.value;case"scientific":return r.mantissa+"\\times10^{"+r.exponent+"}";case"fraction":return"1"===r.denominator?r.numerator:"-"===r.numerator[0]?"-\\frac{"+r.numerator.slice(1)+"}{"+r.denominator+"}":"\\frac{"+r.numerator+"}{"+r.denominator+"}";default:return r}},t.truncatedAriaLabel=function(e,t){var r=b(e,t);switch(r.type){case"undefined":return"undefined";case"decimal":return p(r.value);case"scientific":return p(r.mantissa+"e"+r.exponent);case"fraction":return p(r.numerator+"/"+r.denominator);default:return r}},t.formatSymbol=x,t.identifierToLatex=function(e){var t=e.split("_"),r="";return 1<t[0].length&&(r+="\\"),r+=t[0],t[1]&&(r+="_{"+t[1]+"}"),r},t.identifierToHTML=function(e){if(!e)return"";var t=e.split("_").map(x).map(r.escape),n=t[0];return t[1]&&(n+="<sub>"+t[1]+"</sub>"),n},t.latexToIdentifier=function(e){return(e=e.replace(/\\operatorname\{(.*)\}/,"$1")).replace(/[{}\\]/g,"")},t.trimLatex=function(e){return e.replace(/^(\\ | |\\space)+/,"").replace(/(\\ | |\\space)+$/,"")}});r("core/math/types",["require","core/lib/worker-i18n"],function(e){"use strict";var t=e("core/lib/worker-i18n"),r=0,n=1,i=2,o=3,a=4,s=5,u=6,c=7,l=8,p=9,f=10,d=11,h=12,m=13,y=14;function g(e){switch(e){case r:return"Any";case n:return"Number";case i:return"Bool";case o:return"Point";case a:return"Distribution";case s:return"ListOfAny";case u:return"ListOfNumber";case c:return"ListOfBool";case l:return"ListOfPoint";case p:return"ListOfDistribution";case f:return"EmptyList";case d:return"ErrorType";case h:return"SeedType";case m:return"RGBColor";case y:return"ListOfColor";default:throw new Error("Invalid type")}}return{Any:r,Number:n,Bool:i,Point:o,Distribution:a,ListOfAny:s,ListOfNumber:u,ListOfBool:c,ListOfPoint:l,ListOfDistribution:p,ListOfColor:y,EmptyList:f,ErrorType:d,SeedType:h,RGBColor:m,repr:g,prettyPrint:function(e){switch(e){case r:return t.t("an unknown object");case n:return t.t("a number");case i:return t.t("a true/false value");case o:return t.t("a point");case a:return t.t("a distribution");case s:return t.t("a list of unknown objects");case u:return t.t("a list of numbers");case c:return t.t("a list of true/false values");case l:return t.t("a list of points");case p:return t.t("a list of distributions");case f:return t.t("an empty list");case d:return t.t("an error object");case h:return t.t("a string");case m:return t.t("a color");case y:return t.t("a list of colors");default:throw new Error("Invalid type")}},isList:function(e){switch(e){case s:case u:case c:case l:case p:case y:case f:return!0;default:return!1}},elementType:function(e){switch(e){case f:case u:return n;case c:return i;case l:return o;case p:return a;case y:return m;case s:default:return r}},listType:function(e){switch(e){case r:return s;case n:return u;case i:return c;case o:return l;case a:return p;case m:return y;default:throw new Error("Type "+g(e)+" does not implement listType.")}},hasListType:function(e){switch(e){case r:case n:case i:case o:case a:case m:return!0;default:return!1}},isOneOf:function(e,t){for(var r=0;r<t.length;r++)if(e===t[r])return!0;return!1}}});r("core/math/errormsg",["require","core/lib/worker-i18n","core/math/parsenode/error","core/lib/label","core/math/types"],function(e){"use strict";var t=e("core/lib/worker-i18n"),r=e("core/math/parsenode/error"),n=e("core/lib/label"),i=e("core/math/types");return{parseError:function(){return r(t.t("Sorry, I don't understand this."))},unrecognizedSymbol:function(e){return e=n.formatSymbol(e),r(t.t("Sorry, I don't understand the '__symbol__' symbol.",{symbol:e}))},unexpectedInequality:function(){return r(t.t("Cannot use an inequality here."))},unexpectedSymbol:function(e){return e=n.formatSymbol(e),r(t.t("Sorry, I don't understand the way that '__symbol__' is used here.",{symbol:e}))},addTypeError:function(e){return r(t.t("Cannot add __symbol1__ and __symbol2__.",{symbol1:e[0],symbol2:e[1]})).allowExport()},subtractTypeError:function(e){return r(t.t("Cannot subtract __symbol2__ from __symbol1__.",{symbol1:e[0],symbol2:e[1]})).allowExport()},multiplyTypeError:function(e){return r(t.t("Cannot multiply __symbol1__ by __symbol2__.",{symbol1:e[0],symbol2:e[1]})).allowExport()},divideTypeError:function(e){return r(t.t("Cannot divide __symbol1__ by __symbol2__.",{symbol1:e[0],symbol2:e[1]})).allowExport()},exponentTypeError:function(e){return r(t.t("Cannot raise __symbol1__ to __symbol2__.",{symbol1:e[0],symbol2:e[1]})).allowExport()},negativeTypeError:function(e){return r(t.t("Cannot negate __symbol__.",{symbol:e[0]})).allowExport()},comparatorTypeError:function(e){return r(t.t("Cannot compare __symbol1__ to __symbol2__.",{symbol1:e[0],symbol2:e[1]})).allowExport()},andTypeError:function(e){return r(t.t("Cannot apply __symbol__ to __symbol1__ and __symbol2__.",{symbol:"and",symbol1:e[0],symbol2:e[1]})).allowExport()},listTypeError:function(e){return r(t.t("Cannot store __symbol1__ in a list.",{symbol1:e[0]})).allowExport()},pointTypeError:function(e){return r(t.t("Cannot use __symbol1__ as a coordinate of __symbol2__.",{symbol1:e,symbol2:i.prettyPrint(i.Point)})).allowExport()},indexTypeError:function(e){return r(t.t("Cannot index __symbol1__ with __symbol2__.",{symbol1:e[0],symbol2:e[1]})).allowExport()},orderedPairAccessTypeError:function(e){return r(t.t("Cannot access a coordinate of __symbol__.",{symbol:e[0]})).allowExport()},functionTypeError:function(e,i){switch(i.length){case 1:return r(t.t("Function '__fn__' cannot be applied to __arg__.",{fn:n.formatSymbol(e),arg:i[0]})).allowExport();case 2:return r(t.t("Function '__fn__' cannot be applied to __arg1__ and __arg2__.",{fn:n.formatSymbol(e),arg1:i[0],arg2:i[1]})).allowExport();default:return r(t.t("Function '__fn__' cannot be applied to these arguments.",{fn:n.formatSymbol(e)})).allowExport()}},illegalDotCall:function(e){return r(t.t("Function '__symbol__' cannot be called with dot notation.",{symbol:n.formatSymbol(e)}))},dotLHSTypeError:function(e,i){return r(t.t("Cannot call '__symbol__' on __type__.",{symbol:n.formatSymbol(e),type:i}))},sumLowerBoundTypeError:function(e){return r(t.t("Lower bound of a sum cannot be __symbol__.",{symbol:e[0]})).allowExport()},sumUpperBoundTypeError:function(e){return r(t.t("Upper bound of a sum cannot be __symbol__.",{symbol:e[0]})).allowExport()},sumInfiniteBoundError:function(){return r(t.t("Summation bounds must be finite numbers."))},sumArgumentTypeError:function(e){return r(t.t("Cannot take the sum of __symbol__.",{symbol:e[0]})).allowExport()},productLowerBoundTypeError:function(e){return r(t.t("Lower bound of a product cannot be __symbol__.",{symbol:e[0]})).allowExport()},productUpperBoundTypeError:function(e){return r(t.t("Upper bound of a product cannot be __symbol__.",{symbol:e[0]})).allowExport()},productInfiniteBoundError:function(){return r(t.t("Product bounds must be finite numbers."))},productArgumentTypeError:function(e){return r(t.t("Cannot take the product of __symbol__.",{symbol:e[0]})).allowExport()},integralLowerBoundTypeError:function(e){return r(t.t("Lower bound of an integral cannot be __symbol__.",{symbol:e[0]})).allowExport()},integralUpperBoundTypeError:function(e){return r(t.t("Upper bound of an integral cannot be __symbol__.",{symbol:e[0]})).allowExport()},integralArgumentTypeError:function(e){return r(t.t("Cannot take the integral of __symbol__.",{symbol:e[0]})).allowExport()},derivativeTypeError:function(e){return r(t.t("Cannot take the derivative of __symbol__.",{symbol:e[0]})).allowExport()},derivativeVariableTypeError:function(e,i){return r(t.t("Cannot take derivative with respect to '__symbol1__' because it is __symbol2__.",{symbol1:n.formatSymbol(e),symbol2:i[0]}))},piecewiseConditionTypeError:function(e){return r(t.t("The condition in a piecewise expression must be __symbol1__ but was __symbol2__.",{symbol1:i.prettyPrint(i.Bool),symbol2:e[0]})).allowExport()},piecewiseBranchTypeError:function(e){return r(t.t("Cannot use __symbol1__ and __symbol2__ as the branches in a piecewise. Every branch must have the same type.",{symbol1:e[0],symbol2:e[1]})).allowExport()},piecewiseBranchLengthError:function(e){return r(t.t('When a piecewise condition depends on a free variable (like "__symbol__") and its branches are lists, the lists must have the same length.',{symbol:e})).allowExport()},tableHeaderTypeError:function(e){return r(t.t("Table header cannot be __symbol__.",{symbol:e[0]}))},tableEntryTypeError:function(e){return r(t.t("Table entry cannot be __symbol__.",{symbol:e[0]}))},regressionTypeError:function(e){return r(t.t("Cannot regress __symbol1__ against __symbol2__.",{symbol1:e[0],symbol2:e[1]}))},heterogeneousList:function(){return r(t.t("All elements of a list must have the same type.")).allowExport()},deeplyNested:function(){return r(t.t("Definitions are nested too deeply.")).allowExport()},polygonListTypeError:function(e){return r(t.t("A single argument to polygon should be a point list, not __type__.",{type:e[0]}))},polygonPointArgsError:function(){return r(t.t("Some of your arguments are not points."))},polygonTwoNumbersError:function(){return r(t.t("Cannot make a polygon from two numbers."))},boxplotOffsetInvalid:function(){return r(t.t("Invalid offset. Try using any number."))},boxplotBreadthInvalid:function(){return r(t.t("Invalid height. Try using any number."))},tooManyArguments:function(e,n){return r(t.t("'__symbol__' accepts at most __max__ arguments.",{symbol:e,max:n}))},pdfWrongArity:function(){var e=t.t("For example, try typing: D.pdf(x) where D=normaldist()."),n=t.t("'pdf' should be called on a distribution with a number. __recommendation__",{recommendation:e});return r(n)},cdfRequiresArguments:function(){var e=t.t("For example, try typing: D.cdf(x) where D=normaldist()."),n=t.t("'cdf' should be called on a distribution with at least one number. __recommendation__",{recommendation:e});return r(n)},cdfTooManyArguments:function(){var e=t.t("For example, try typing: D.cdf(-1,1) where D=normaldist()."),n=t.t("'cdf' should be called on a distribution with at most two numbers. __recommendation__",{recommendation:e});return r(n)},tdistWrongArity:function(){return r(t.t("'tdist' requires 1 argument. For example, try typing: tdist(1)."))},randomArity:function(){var e=t.t("'random' should be called with no arguments, or an optional number of samples. For example, try random() or random(10).");return r(e)},randomFromBroadcastDistribution:function(){return r(t.t("Cannot sample from a list of distributions"))},wrongArity:function(e,i,o,a){var s,u;if(e=n.formatSymbol(e),1===i)a=a||e+"(x)",u=t.t("For example, try typing: __recommendation__.",{recommendation:a}),s=1<o?t.t("Function '__dependency__' requires only 1 argument. __supplement__",{dependency:e,supplement:u}):t.t("Function '__dependency__' requires an argument. __supplement__",{dependency:e,supplement:u});else{var c=[];if(!a){for(var l=0;l<i;l++)c[l]=l+1;a=n.formatSymbol(e)+"("+c.join(", ")+")"}u=t.t("For example, try typing: __recommendation__.",{recommendation:a}),s=t.t("Function '__dependency__' requires __assignment_arity__ arguments. __supplement__",{dependency:e,assignment_arity:i,supplement:u})}return r(s)},wrongParametrizedReducerArity:function(e){return r(t.t("Function '__symbol__' requires 2 arguments. For example, try typing: __recommendation__.",{symbol:n.formatSymbol(e),recommendation:n.formatSymbol(e)+"([1,2,3], 1)"}))},wrongDoubleReducerArity:function(e){return r(t.t("Function '__symbol__' requires 2 arguments. For example, try typing: __recommendation__.",{symbol:n.formatSymbol(e),recommendation:n.formatSymbol(e)+"([1,2,3], [3,2,1])"}))},primedFunctionArity:function(){return r(t.t("Prime notation can only be used for functions of a single argument."))},zeroArgReducer:function(e){return r(t.t("Function '__symbol__' requires at least one argument. For example, try typing: __symbol__(1, 2).",{symbol:n.formatSymbol(e)}))},malformedPoint:function(){return r(t.t("Points are written like this: (1, 2)."))},badTupleDimensions:function(e){return r(t.t("Points may only have __symbol__ coordinates.",{symbol:e}))},badImplicitCall:function(e){return e=n.formatSymbol(e),r(t.t("Use parentheses around the argument of '__symbol__'.",{symbol:e}))},adjacentNumbers:function(e,n){return r(t.t("Sorry, I don't know what to do with adjacent numbers '__left__' and '__right__'. Try using parentheses or a '*' symbol.",{left:e,right:n}))},identifierAsFunction:function(e){return e=n.formatSymbol(e),r(t.t("'__symbol__' is a function. Try using parentheses.",{symbol:e}))},binaryOperatorMissingOperand:function(e){return"%"===(e=n.formatSymbol(e))&&(e="% of"),r(t.t("You need something on both sides of the '__symbol__' symbol.",{symbol:e}))},unaryOperatorMissingLeft:function(e){return e=n.formatSymbol(e),r(t.t("You need something before the '__symbol__' symbol.",{symbol:e}))},unaryOperatorMissingRight:function(e){return e=n.formatSymbol(e),r(t.t("You need something after the '__symbol__' symbol.",{symbol:e}))},fractionMissingNumerator:function(){return r(t.t("You need a numerator for the top of your fraction."))},fractionMissingDenominator:function(){return r(t.t("You need a denominator for the bottom of your fraction."))},fractionEmpty:function(){return r(t.t("You need a numerator and denominator for your fraction."))},emptySubscript:function(){return r(t.t("Subscripts cannot be empty."))},emptySuperscript:function(){return r(t.t("Superscripts cannot be empty."))},invalidSubscript:function(e){return e=n.formatSymbol(e),r(t.t("Subscripts may only contain letters and digits. '__symbol__' is not allowed.",{symbol:e}))},invalidOperatorName:function(){return r(t.t("Operator names may only contain letters."))},unexpectedSubscript:function(){return r(t.t("Only functions and variables may have subscripts."))},superscriptWithPrime:function(){return r(t.t("Superscripts and primes cannot be combined."))},unexpectedPrime:function(){return r(t.t("Sorry, I don't understand this use of prime notation."))},primeWithoutParen:function(){return r(t.t("Primed function calls must use parentheses."))},emptyRadical:function(){return r(t.t("Radical cannot be empty."))},emptyRadicalIndex:function(){return r(t.t("Radical index cannot be empty."))},emptyParen:function(){return r(t.t("Parentheses cannot be empty."))},emptySquareBracket:function(){return r(t.t("Square brackets cannot be empty."))},emptyPipe:function(){return r(t.t("Absolute value symbol cannot be empty."))},badTrigExponent:function(e){var n=e+"^2",i=e+"^-1";return r(t.t("Only __form1__ and __form2__ are supported. Otherwise, use parens.",{form1:n,form2:i}))},badLogExponent:function(e){var n=e+"^2";return r(t.t("Only __form__ is supported. Otherwise, use parens.",{form:n}))},inequalityChainTooLong:function(){return r(t.t("Cannot chain more than 2 inequalities."))},piecewiseMissingCondition:function(){return r(t.t("A piecewise expression must have at least one condition."))},piecewisePartMissingCondition:function(){return r(t.t("Every part of a piecewise expression must have a condition except the last."))},colonMissingCondition:function(){return r(t.t("The left side of a ':' must be a condition, like 'x>1'."))},blankExpression:function(){return r(t.t("You haven't written anything yet."))},functionNotDefined:function(e){return e=n.formatSymbol(e),r(t.t("Function '__dependency__' is not defined.",{dependency:e}))},parameterAlreadyDefined:function(e){return e=n.formatSymbol(e),r(t.t("You can't use '__dependency__' as a parameter of this function because '__dependency__' is already defined.",{dependency:e}))},cannotRedefine:function(e,i){return e=n.formatSymbol(e),r(void 0===i?t.t("You can't redefine '__symbol__' because it's already defined.",{symbol:e}):t.t("You can't define '__symbol__' because '__symbolRoot__' is already defined.",{symbol:e,symbolRoot:i}))},cannotSubscript:function(e){return e=n.formatSymbol(e),r(t.t("'__symbol__' cannot have a subscript.",{symbol:e}))},multiplyDefined:function(e){return e=n.formatSymbol(e),r(t.t("You've defined '__dependency__' in more than one place. Try deleting some of the definitions of '__dependency__'.",{dependency:e}))},shadowedIndex:function(e){return e=n.formatSymbol(e),r(t.t("You can't use '__symbol__' as an index because it's already defined.",{symbol:e}))},cycle:function(e){var i=(e=e.map(n.formatSymbol)).pop();return r(t.t("'__symbols__' and '__lastSymbol__' can't be defined in terms of each other.",{symbols:e.join("', '"),lastSymbol:i}))},selfReferentialFunction:function(e){return r(t.t("The definition of function '__symbol__' cannot depend on '__symbol__'.",{symbol:n.formatSymbol(e)}))},simulationFPSNonNegativeNumber:function(){return r(t.t("FPS must evaluate to a non-negative number"))},sliderLimitReferencesExport:function(e){return r(t.t("Slider limits cannot depend on the slider variable '__symbol__'.",{symbol:n.formatSymbol(e)}))},sliderMinInvalid:function(){return r(t.t("Invalid slider min. Try using any number."))},sliderMaxInvalid:function(){return r(t.t("Invalid slider max. Try using any number."))},sliderMaxLessThanMin:function(){return r(t.t("Invalid slider limits. Min should be less than max."))},sliderStepInvalid:function(){return r(t.t("Invalid slider step. Try using any number."))},domainMinInvalid:function(){return r(t.t("Invalid domain min. Try using any number."))},domainMaxInvalid:function(){return r(t.t("Invalid domain max. Try using any number."))},domainMaxLessThanMin:function(){return r(t.t("Invalid domain limits. Min should be less than max."))},cdfMinInvalid:function(){return r(t.t("Invalid cdf min. Try using any number."))},cdfMaxInvalid:function(){return r(t.t("Invalid cdf max. Try using any number."))},cdfMaxLessThanMin:function(){return r(t.t("Invalid cdf limits. Min should be less than max."))},tooManyVariables:function(e){if(0===(e=e.map(n.formatSymbol)).length)return r(t.t("Too many variables, I don't know what to do with this."));var i=e.pop();return 0<e.length?r(t.t("Too many variables. Try defining '__variables__' or '__lastVariable__'.",{variables:e.join("', '"),lastVariable:i})):r(t.t("Too many variables. Try defining '__variable__'.",{variable:i}))},addArgumentsToDefinition:function(e,i,o){e=e.map(n.formatSymbol);var a=(i=n.formatSymbol(i))+"("+(o=o.map(n.formatSymbol)).join(",")+","+e.join(",")+")",s=e.pop(),u={symbols:e.join("', '"),lastSymbol:s,newSignature:a};return e.length?r(t.t("Try including '__symbols__' and '__lastSymbol__' as arguments by defining the function as '__newSignature__'.",u)):r(t.t("Try including '__lastSymbol__' as an argument by defining the function as '__newSignature__'.",u))},invalidLHS:function(e){return e=n.formatSymbol(e),r(t.t("Sorry, you can't graph __symbol__ as a function of anything yet.",{symbol:e}))},unplottablePolarFunction:function(){return r(t.t("We can't plot  as a function of r. Try plotting r() instead."))},invalidInequalityVariables:function(){return r(t.t("We only plot inequalities of x and y, or r and ."))},invalidImplicitVariables:function(){return r(t.t("We only support implicit equations of x and y."))},singleVariableImplicitEquationsDisabled:function(){return r(t.t("Plotting single-variable implicit equations is disabled."))},implicitsDisabled:function(){return r(t.t("Plotting implicit equations and inequalities is disabled."))},inequalitiesDisabled:function(){return r(t.t("Plotting inequalities is disabled."))},complicatedPolarImplicit:function(){return r(t.t("Polar equations must be linear in r."))},invalidDoubleInequalityVariables:function(){return r(t.t("We only plot double inequalities of x and y."))},mismatchedDoubleInequality:function(){return r(t.t("Double inequalities must both go the same way, e.g. __example__.",{example:"1 < y < 2"}))},complicatedDoubleInequality:function(){return r(t.t("We only support solved double inequalities. Try deleting one side of the inequality."))},equationRequired:function(e){return e?(e=n.formatSymbol(e),r(t.t("Try adding '__lhs__' to the beginning of this equation.",{lhs:e+"="}))):r(t.t("Try adding an equals sign to turn this into an equation."))},variableAsFunction:function(e){return e=n.formatSymbol(e),r(t.t("Variable '__dependency__' can't be used as a function.",{dependency:e}))},distributionAsFunction:function(e){return e=n.formatSymbol(e),r(t.t("Cannot call distribution '__symbol__' as a function. Try '__symbol__.pdf(x)'.",{symbol:e}))},invalidTableHeader:function(e){return r(t.t("Table headers must be simple expressions. __supplement__",{supplement:e}))},invalidTableEntry:function(e){return r(t.t("Table entries must be simple expressions. __supplement__",{supplement:e}))},invalidFirstTableColumn:function(){return r(t.t("First column may not be __most__ or __last__.",{most:"'y', 'r',",last:"''"}))},invalidDependentFirstTableColumn:function(){return r(t.t("This column header can't be defined elsewhere in the calculator."))},invalidRegressionParameter:function(e){return r(t.t("'__symbol__' may not be used as a regression parameter. Try using a list.",{symbol:n.formatSymbol(e)}))},optimizationError:function(){return r(t.t("We couldn't find any region where this model is defined."))},nonListDoubleReducer:function(e){return r(t.t("Both arguments of '__symbol__' must be lists. For example, try typing: __recommendation__.",{symbol:n.formatSymbol(e),recommendation:n.formatSymbol(e)+"([1,2,3], [3,2,1])"})).allowExport()},nonListParametrizedReducer:function(e){return r(t.t("The first argument of '__symbol__' must be a list. For example, try typing: __recommendation__.",{symbol:n.formatSymbol(e),recommendation:n.formatSymbol(e)+"([1,2,3], 1)"})).allowExport()},methodRequiresList:function(e){return r(t.t("'__symbol__' requires a list. For example, try typing: __recommendation__.",{symbol:n.formatSymbol(e),recommendation:n.formatSymbol(e)+"([1,2,3])"})).allowExport()},variableRange:function(e){return r(t.t("Range cannot depend on free variable '__symbol__'.",{symbol:n.formatSymbol(e[0])})).setDependencies(e).allowExport()},variableListIndicies:function(e){return r(t.t("List indices cannot depend on free variable '__symbol__'.",{symbol:n.formatSymbol(e[0])})).setDependencies(e).allowExport()},variableFilter:function(e){return r(t.t("List filters cannot depend on free variable '__symbol__'.",{symbol:n.formatSymbol(e[0])})).setDependencies(e).allowExport()},functionFreeVariable:function(e,n){return r(t.t("Function '__functionSymbol__' cannot depend on free variable '__variableSymbol__'.",{functionSymbol:e,variableSymbol:n})).allowExport()},nonArithmeticRange:function(e){return r(t.t("Ranges must be arithmetic sequences.")).allowExport()},invalidHalfEmptyRange:function(){return r(t.t("Range must have an upper and lower bound."))},sumMissingBound:function(){return r(t.t("Sums must have upper and lower bounds."))},productMissingBound:function(){return r(t.t("Products must have upper and lower bounds."))},incorrectSumLowerBound:function(){return r(t.t("Lower bound of a sum must set a variable equal to a number. Try n=1."))},incorrectProductLowerBound:function(){return r(t.t("Lower bound of a product must set a variable equal to a number. Try n=1."))},badSumBoundDependency:function(e){return r(t.t("Summation bounds can't depend on summation index '__symbol__'.",{symbol:n.formatSymbol(e)}))},badProductBoundDependency:function(e){return r(t.t("Product bounds can't depend on product index '__symbol__'.",{symbol:n.formatSymbol(e)}))},integralMissingBound:function(){return r(t.t("Integrals must have upper and lower bounds."))},integralMissingDifferential:function(){return r(t.t("Integrand must end with an integration variable, like dx."))},differentialWithSuperscript:function(){return r(t.t("Integration variable cannot have a superscript."))},sumMissingBody:function(){return r(t.t("What do you want to take the sum of?"))},productMissingBody:function(){return r(t.t("What do you want to take the product of?"))},integralMissingBody:function(){return r(t.t("What do you want to take the integral of?"))},derivativeMissingBody:function(){return r(t.t("What do you want to take the derivative of?"))},mismatchedBraces:function(e,i){return e=n.formatSymbol(e),i=n.formatSymbol(i),r(t.t("Expected '__symbol1__' to match '__symbol2__'.",{symbol1:e,symbol2:i}))},shadowedIntegrationVariable:function(e){return r(t.t("You can't use '__symbol__' as an integration variable because it's already defined.",{symbol:n.formatSymbol(e)}))},badIntegralBoundDependency:function(e){return r(t.t("Integration bounds can't depend on integration variable '__symbol__'.",{symbol:n.formatSymbol(e)}))},percentMissingOf:function(){return r(t.t("'%' must be used with 'of'. Try '25% of 12'."))},illegalBinWidth:function(e){return e=n.formatSymbol(e),r(t.t("The second argument to '__symbol__' must be a positive number.",{symbol:e}))},ttestListTooShort:function(e){return e=n.formatSymbol(e),r(t.t("Lists for '__symbol__' must have at least 2 elements.",{symbol:e}))},badSampleSize:function(){return r(t.t("Sample size must be at least 1."))},variableSampleSize:function(e){return r(t.t("Sample size cannot depend on free variable '__symbol__'.",{symbol:n.formatSymbol(e[0])})).setDependencies(e).allowExport()},variableSeed:function(e){return r(t.t("Random seed cannot depend on free variable '__symbol__'.",{symbol:n.formatSymbol(e[0])})).setDependencies(e).allowExport()},badAnsContext:function(){return r(t.t("You can't use 'ans' in this context."))},ansUndefined:function(){return r(t.t("The previous expression didn't define any value for ans."))},variablesUnsupported:function(e){return r(t.t("This calculator does not support variables like '__variable__'.",{variable:n.formatSymbol(e)}))},functionUnsupported:function(e){return r(t.t("This calculator does not support the '__symbol__' function.",{symbol:n.formatSymbol(e)}))},logbaseUnsupported:function(){return r(t.t("This calculator does not support specifying the base of a logarithm. Try 'log' or 'ln'."))},constantUnsupported:function(e){return r(t.t("This calculator does not support the constant '__symbol__'.",{symbol:n.formatSymbol(e)}))},assignmentsUnsupported:function(){return r(t.t("This calculator does not support defining variables."))},functionDefinitionsUnsupported:function(){return r(t.t("This calculator does not support function definitions."))},equationsUnsupported:function(){return r(t.t("This calculator does not support this type of equation."))},inequalitiesUnsupported:function(){return r(t.t("This calculator does not support inequalities."))},regressionsUnsupported:function(){return r(t.t("This calculator does not support regressions."))},pointsUnsupported:function(){return r(t.t("This calculator does not support points."))},colorsUnsupported:function(){return r(t.t("This calculator does not support colors."))},featureUnavailable:function(){return r(t.t("This feature is not available in the current calculator."))},nonSquareDeterminant:function(){return r(t.t("Only square matrices have a determinant."))},nonSquareTrace:function(){return r(t.t("Only square matrices have a trace."))},nonSquareInverse:function(){return r(t.t("Only square matrices have an inverse."))},singularInverse:function(){return r(t.t("Singular matrices do not have an inverse."))},clickableObjectAssignmentNotDefined:function(e){return r(t.t('"__symbol__" is not defined. Try using a different variable or adding a slider.',{symbol:e}))},clickableObjectAlreadyAssigned:function(e){return r(t.t("You've defined '__dependency__' in more than one place. Try deleting some of the definitions of '__dependency__'.",{dependency:e}))},clickableObjectAssignmentNotIdentifier:function(){return r(t.t("Invalid symbol. Try using a single letter."))},clickableObjectInvalidExpression:function(){return r(t.t("Can't evaluate this. Try a number or simple expression."))},matrixAssignment:function(){return r(t.t("This calculator does not support this type of variable definition. Try using 'New Matrix'."))},matrixAddDimensions:function(){return r(t.t("Cannot add matrices with different dimensions."))},matrixSubtractDimensions:function(){return r(t.t("Cannot subtract matrices with different dimensions."))},matrixMultiplyDimensions:function(){return r(t.t("Cannot multiply matrices with incompatible dimensions."))},matrixFractionalPower:function(){return r(t.t("A matrix can only be raised to integer powers."))},matrixPowerDimensions:function(){return r(t.t("Only square matrices can be raised to a power."))},matrixElementTypeError:function(e){return r(t.t("Cannot use __arg__ as an element of a matrix.",{arg:e[0]}))},matrixInvalidVariable:function(e){return r(t.t("Cannot use '__symbol__' as a variable.",{symbol:n.formatSymbol(e)}))}}});r("core/math/parsenode/expression",["require","pjs","./base","core/math/errormsg","core/math/types"],function(e){"use strict";var t=e("pjs"),r=e("./base"),n=e("core/math/errormsg"),i=e("core/math/types");return t(r,function(e,t){e.init=function(e){if(!Array.isArray(e))throw new TypeError("Argument to expression constructor must be an Array.");t.init.call(this),this.args=e,this.valueType=this._getValueType(e),this.registerDependencies(),this.computeTreeSize()},e._getValueType=function(e){return i.Any},e.shouldExportAns=function(){return!0},e.registerDependencies=function(){for(var e=0;e<this.args.length;e++)this.mergeDependencies(this.args[e])},e.computeTreeSize=function(){for(var e=0,t=0;t<this.args.length;t++)this.args[t].treeSize&&(e+=this.args[t].treeSize);if(this.treeSize=e+1,1e4<e)throw n.deeplyNested()},e.copyWithArgs=function(e){return new this.constructor(e)}})});r("core/math/parsenode/scalarexpression",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){t.init.call(this,e)},e.getEvalStrings=function(){for(var e=[],t=[],r=0;r<this.args.length;r++){var n=this.args[r].getEvalStrings(),e=e.concat(n.statements);t.push(n.expression)}return{statements:e,expression:this.scalarEvalExpression(t)}}})});r("core/math/parsenode/expressionTypes",["require","pjs","./scalarexpression"],function(e){"use strict";var t=e("pjs"),r=e("./scalarexpression"),n={Add:t(r,{}),Subtract:t(r,{}),Multiply:t(r,{}),Divide:t(r,{}),Exponent:t(r,{}),Negative:t(r,{}),And:t(r,{isInequality:function(){return this.args[0].isInequality()&&this.args[1].isInequality()}}),PercentOf:t(r,{})};return n.RawExponent=t(n.Exponent,{}),n});r("core/math/maybe-rational",["require","exports","core/math/builtin"],function(e,t,r){"use strict";function n(e,t){return{n:e,d:t}}function i(e){return"object"==typeof e&&"number"==typeof e.n&&"number"==typeof e.d}Object.defineProperty(t,"__esModule",{value:!0}),t.total=t.mod=t.nthroot=t.sqrt=t.pow=t.div=t.sub=t.mul=t.add=t.reciprocal=t.abs=t.neg=t.maybeRational=t.asFloat=t.fromDecimalString=t.isRational=void 0,t.isRational=i;var o=Math.pow(2,53)-1;function a(e){return i(e)?e.n/e.d:e}function s(e,t){if(!isFinite(e)||!isFinite(t)||0===t||Math.floor(e)!==e||Math.floor(t)!==t||Math.abs(e)>o||Math.abs(t)>o)return e/t;t<0&&(e=-e,t=-t);var i=r.gcd(e,t);return n(e/i,t/i)}function u(e){return i(e)?n(-e.n,e.d):-e}function c(e){return i(e)?0===e.n?e.d/e.n:n(e.n<0?-e.d:e.d,Math.abs(e.n)):1/e}function l(e,t){if(!i(e)||!i(t))return a(e)+a(t);var n=r.gcd(e.d,t.d);return s(e.n*(t.d/n)+t.n*(e.d/n),e.d/n*t.d)}function p(e,t){if(!i(e)||!i(t))return a(e)*a(t);var n=r.gcd(e.n,t.d),o=r.gcd(t.n,e.d);return s(e.n/n*(t.n/o),e.d/o*(t.d/n))}function f(e,t){return l(e,u(t))}function d(e,t){return i(e)&&i(t)?p(e,c(t)):a(e)/a(t)}function h(e,t){if(!i(e)||!i(t))return r.pow(a(e),a(t));var n=function(e,t){var n=e,o=t;if(t.n<0&&(o=u(t),n=c(e)),!i(n)||!i(o))return r.pow(a(e),a(t));if(e=n,1===(t=o).d)return s(Math.pow(e.n,t.n),Math.pow(e.d,t.n));var l=e.n<0;if(l&&t.d%2!=1)return NaN;var p=(l?-1:1)*Math.round(Math.pow(Math.abs(e.n),1/t.d)),f=Math.round(Math.pow(Math.abs(e.d),1/t.d));return Math.pow(p,t.d)!==e.n||Math.pow(f,t.d)!==e.d?r.pow(a(e),a(t)):s(Math.pow(p,t.n),Math.pow(f,t.n))}(e,t);return i(n)?n:r.pow(a(e),a(t))}t.fromDecimalString=function(e){var t=e.match(/^(-)?(\d*)?(?:\.(\d*))?$/);if(!t)return NaN;var r=t[1],n=t[2],i=t[3];if(!n&&!i)return NaN;var a=!!r;if(i){var u=i.replace(/0+$/,""),c=u.length,l=Math.pow(10,c),p=parseInt(n||"0",10)*l+parseInt(u||"0",10);return o<p||o<l?parseFloat(e):s(a?-p:p,l)}return p=parseInt(n,10),o<p?parseFloat(e):s(a?-p:p,1)},t.asFloat=a,t.maybeRational=s,t.neg=u,t.abs=function(e){return i(e)?n(Math.abs(e.n),Math.abs(e.d)):Math.abs(e)},t.reciprocal=c,t.add=l,t.mul=p,t.sub=f,t.div=d,t.pow=h,t.sqrt=function(e){if(!i(e))return Math.sqrt(e);var t=Math.round(Math.sqrt(e.n)),r=Math.round(Math.sqrt(e.d));return t*t!==e.n||r*r!==e.d?Math.sqrt(a(e)):s(t,r)},t.nthroot=function(e,t){return h(e,c(t))},t.mod=function(e,t){if(i(e)&&i(t))return f(e,p(t,n(Math.floor(a(d(e,t))),1)));var r=a(e),o=a(t);return r-o*Math.floor(r/o)},t.total=function(e){for(var t=n(0,1),r=0,i=e;r<i.length;r++)t=l(t,i[r]);return t}});r("core/math/parsenode/constant",["require","pjs","./scalarexpression","core/math/maybe-rational","core/math/types"],function(e){"use strict";var t=e("pjs"),r=e("./scalarexpression"),n=e("core/math/maybe-rational"),i=e("core/math/types");return t(r,function(e,t){e.init=function(e){"number"==typeof e&&(e=n.maybeRational(e,1)),this._constantValue=e,t.init.call(this,[])},e.isConstant=!0,e.getEvalStrings=function(){return{statements:[],expression:this.scalarExprString()}},e.asValue=function(){return"boolean"==typeof this._constantValue?this._constantValue:n.asFloat(this._constantValue)},e.asMaybeRationalValue=function(){return"boolean"==typeof this._constantValue?NaN:this._constantValue},e.scalarExprString=function(){return 0<this.asValue()?String(this.asValue()):"("+String(this.asValue())+")"},e.getEvaluationInfo=function(){return[{val:this.asValue()}]},e.isNaN=function(){return"number"==typeof this.asValue()&&isNaN(this.asValue())},e._getValueType=function(){switch(typeof this.asValue()){case"number":return i.Number;case"boolean":return i.Bool;default:throw new Error("Constant node expects value of type number or boolean, but saw "+typeof value)}}})});r("core/math/parsenode/mixednumber",["require","pjs","./constant"],function(e){"use strict";return e("pjs")(e("./constant"),function(e,t){e.init=function(e){t.init.call(this,e)},e.is_mixed_number=!0})});r("core/math/parsenode/identifier",["require","pjs","./expression","core/lib/label","core/math/parser/input-span"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("core/lib/label"),i=e("core/math/parser/input-span");return t(r,function(e,t,r){e.init=function(e){t.init.call(this,[]),this._symbol=n.latexToIdentifier(e),this.setInputSpan(new i.Span(e,0,e.length)),this.addDependency(this._symbol)},e.evaluate=function(){throw"Cannot evaluate undefined variable "+this._symbol}})});r("core/math/parsenode/ans",["require","pjs","./identifier"],function(e){"use strict";return e("pjs")(e("./identifier"),function(e,t,r){})});r("core/math/parsenode/freevariable",["require","pjs","./scalarexpression"],function(e){"use strict";return e("pjs")(e("./scalarexpression"),function(e,t){e.init=function(e){t.init.call(this,[]),this.addDependency(e),this._symbol=e},e.isFreeVariable=!0,e.scalarEvalExpression=function(e){return this._symbol},e.copyWithArgs=function(e){return this}})});r("core/math/parsenode/dummyindex",["require","pjs","./freevariable"],function(e){"use strict";return e("pjs")(e("./freevariable"),function(){})});r("core/math/parsenode/list",["require","pjs","./expression","core/math/types"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("core/math/types");return t(r,function(e,t,r){e.init=function(e){t.init.call(this,e),this.length=e.length},e.isList=!0,e.getEvalStrings=function(){for(var e=[],t=[],r=0;r<this.args.length;r++){var n=this.args[r].getEvalStrings();Array.prototype.push.apply(e,n.statements),t.push(n.expression)}return{statements:e,expression:"["+t.join(",")+"]"}},e.asValue=function(){for(var e=[],t=0;t<this.args.length;t++)e.push(this.args[t].asValue());return e},e.asMaybeRationalValue=function(){for(var e=[],t=0;t<this.args.length;t++)e.push(this.args[t].asMaybeRationalValue());return e},e.getEvaluationInfo=function(){if(this.args.every(function(e){return e.isConstant}))return[{val:this.args.map(function(e){return e.asValue()})}]},r.eachArgs=function(e,t,r){var i=function(e){for(var t=1/0,r=0;r<e.length;r++)(e[r].isList||e[r].isBroadcast)&&(t=Math.min(t,e[r].length));return t}(t);if(isFinite(i))for(var o=0;o<i;o++){for(var a=[],s=0;s<t.length;s++)a.push(t[s].isList||n.isList(t[s].valueType)?t[s].elementAt(e,o):t[s]);r(a)}else r(t)},r.mapArgs=function(e,t,n){var i=[];return r.eachArgs(e,t,function(e){i.push(n(e))}),i},r.wrap=function(e){return e.isList||n.isList(e.valueType)?e:r([e])}})});r("core/math/parsenode/range",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t,r){e.init=function(e){t.init.call(this,e),this.beginning=e[0],this.end=e[1]},e.isHalfEmpty=function(){return this.end&&this.end.args&&0===this.end.args.length}})});r("core/math/parsenode/broadcast",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t,r){e.init=function(e,r){if(t.init.call(this,r),this._replacedSymbols=e,this._expression=r[0],this._lists=r.slice(1),!e.length)throw new Error("Cannot construct a broadcast node with no replaced symbols");for(var n=0;n<e.length;n++)this.removeDependency(e[n]);for(var i=1/0,o=0;o<this._lists.length;o++){if(!this._lists[o].isList)throw new Error("List arguments of broadcast must be list literals");i=Math.min(i,this._lists[o].length)}this.length=i},e.isBroadcast=!0,e.copyWithArgs=function(e){return new this.constructor(this._replacedSymbols,e)},e.getEvalStrings=function(){var e=[],t=this._expression.getEvalStrings();Array.prototype.push.apply(e,t.statements);for(var r=[],n=[],i=0;i<this._lists.length;i++){var o=this._lists[i].getEvalStrings();Array.prototype.push.apply(e,o.statements);var a=this.tmpVar();n.push(a),r.push("var "+a+" = "+o.expression)}var s=this.tmpVar(),u=this.tmpVar();r.push("var "+s+" = []");var c=[];for(i=0;i<n.length;i++)c.push("var "+this._replacedSymbols[i]+" = "+n[i]+"["+u+"]");return r.push("for (var "+u+" = 0; "+u+" < "+this.length+"; "+u+"++) {\n  "+c.join(";\n  ")+";\n  "+s+".push("+t.expression+");\n}"),{statements:e.concat(r),expression:s}}})});r("core/math/parsenode/listaccess",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){t.init.call(this,e),this.list=e[0],this.index=e[1]},e.getEvalStrings=function(){var e=this.index.getEvalStrings(),t=this.list.getEvalStrings(),r=e.statements.concat(t.statements),n=this.tmpVar();r.push("var "+n+" = "+t.expression);var i=this.tmpVar();return r.push("var "+i+" = Math.floor("+e.expression+") - 1"),{statements:r,expression:"("+i+" >= 0 && "+i+" < "+n+".length ? "+n+"["+i+"] : NaN)"}}})});r("core/math/parsenode/dotaccess",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),{})});r("core/math/parsenode/dotaccessexponent",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),{})});r("core/math/parsenode/orderedpair",["require","pjs","./scalarexpression"],function(e){"use strict";return e("pjs")(e("./scalarexpression"),function(e,t,r){e.asArray=function(){return[+this.args[0].asValue(),+this.args[1].asValue()]},e.asValue=e.asArray,e.getSliderVariables=function(e,t){return e.sliderVariables(t.getDependencies()).filter(function(t){return!e.validParametricVariable(t)})},e.getEvalStrings=function(){for(var e=[],t=[],r=0;r<this.args.length;r++){var n=this.args[r].getEvalStrings(),e=e.concat(n.statements);t.push(n.expression)}return{statements:e,expression:"["+t.join(",")+"]"}}})});r("core/math/parsenode/movablepoint",["require","pjs","./orderedpair"],function(e){"use strict";return e("pjs")(e("./orderedpair"),function(e,t){e.init=function(e,r,n){t.init.call(this,e),this.moveStrategy=r,this.defaultDragMode=n},e.isMovablePoint=!0})});r("core/math/parsenode/orderedpairaccess",["require","pjs","./scalarexpression"],function(e){"use strict";return e("pjs")(e("./scalarexpression"),function(e,t){e.init=function(e){t.init.call(this,e),this.point=e[0],this.index=e[1]},e.getEvalStrings=function(){var e=this.index.getEvalStrings(),t=this.point.getEvalStrings(),r=[];return Array.prototype.push.apply(r,e.statements),Array.prototype.push.apply(r,t.statements),{statements:r,expression:t.expression+"["+e.expression+"-1]"}}})});r("core/math/parsenode/polygon",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){t.init.call(this,e),this._symbol="polygon"}})});r("core/math/comparators",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.get=t.table=void 0,t.table={"<":{inclusive:!1,direction:-1},"!=":{inclusive:!1,direction:0},">":{inclusive:!1,direction:1},"<=":{inclusive:!0,direction:-1},"=":{inclusive:!0,direction:0},">=":{inclusive:!0,direction:1}},t.get=function(e,t){switch(t){case-1:return e?"<=":"<";case 0:return e?"=":"!=";case 1:return e?">=":">";default:throw"Programming error.  Comparators must have a direction of -1, 0, or 1"}}});r("core/math/parsenode/basecomparator",["require","pjs","./scalarexpression","./expressionTypes","core/math/comparators","core/math/functions"],function(e){"use strict";var t=e("pjs"),r=e("./scalarexpression"),n=e("./expressionTypes").Subtract,i=e("core/math/comparators").table,o=e("core/math/functions");return t(r,function(e,r,a){a.create=function(e,r){return r=r||e,t(a,function(t,n){t.operator=e,t.isInequality=function(){return 0!==i[e].direction},t.compiledOperator=r,t.scalarEvalExpression=function(e){return e.join(r)},t.evaluate=o.createEvaluateFunction(t.scalarEvalExpression,2)})},e.init=function(e){r.init.call(this,e),this._difference=-1===i[this.operator].direction?n([e[1],e[0]]):n([e[0],e[1]])}})});r("core/math/parsenode/comparator",["require","core/math/parsenode/basecomparator"],function(e){"use strict";var t=e("core/math/parsenode/basecomparator");return{"<":t.create("<"),">":t.create(">"),"<=":t.create("<="),">=":t.create(">="),"=":t.create("=","===")}});r("core/math/parsenode/doubleinequality",["require","pjs","./base","core/math/comparators","./comparator"],function(e){"use strict";var t=e("pjs"),r=e("./base"),n=e("core/math/comparators"),i=e("./comparator");return t(r,function(e,t){e.init=function(e){t.init.call(this),this.args=e,this._symbol=e[2]._symbol,this._operators=[e[1],e[3]],this._expressions=[e[0],e[4]];var r=n.get(n.table[e[1]].inclusive&&n.table[e[3]].inclusive,n.table[e[1]].direction);this._indicator=i[r]([e[0],e[4]]),this.addDependency(this._symbol),this.mergeDependencies(this._expressions[0],this._expressions[1])},e.isInequality=function(){return!0},e.isShadeBetween=function(){return!0}})});r("core/math/parsenode/repeatedoperator",["require","pjs","./scalarexpression","./dummyindex"],function(e){"use strict";var t=e("pjs"),r=e("./scalarexpression"),n=e("./dummyindex");return t(r,function(e,t){e.init=function(e){t.init.call(this,e),this._index=e[0],this.addDummyDependency(this._index._symbol),this._index instanceof n&&this.removeDependency(this._index._symbol)},e.getEvalStrings=function(){var e=[],t=this.tmpVar(),r=this._index._symbol,n=this.tmpVar(),i=this.tmpVar(),o=this.args[1].getEvalStrings(),a=this.args[2].getEvalStrings(),s=this.args[3].getEvalStrings();Array.prototype.push.apply(e,o.statements),e.push("var "+n+" = Math.round("+o.expression+")"),Array.prototype.push.apply(e,a.statements),e.push("var "+i+" = Math.round("+a.expression+")"),e.push("var "+t+"="+this.starting_value);var u="for (var "+r+"="+n+";"+r+"<="+i+";"+r+"++) {"+s.statements.join(";")+";"+t+this.in_place_operator+s.expression+"};",c="if(!isFinite("+i+"-"+n+")) {"+t+"=("+i+"<"+n+"?"+this.starting_value+":NaN);}else{"+u+"}";return e.push(c),{statements:e,expression:t}},e.evaluate=function(e,t,r){var n=r.getCompiledFunction([this._index._symbol]).fn;if(t=Math.round(t),e=Math.round(e),!isFinite(t-e))return t<e?this.starting_value:NaN;for(var i=this.starting_value,o=e;o<=t;o++)i=this.update(i,n(o));return i}})});r("core/math/parsenode/sum",["require","pjs","./repeatedoperator"],function(e){"use strict";return e("pjs")(e("./repeatedoperator"),function(e,t){e.in_place_operator="+=",e.starting_value=0,e.evaluateConstant=function(e){var t=1+Math.round(e[1])-Math.round(e[0]);return t<=0?this.starting_value:t*e[2]},e.update=function(e,t){return e+t}})});r("core/math/parsenode/product",["require","pjs","./repeatedoperator"],function(e){"use strict";return e("pjs")(e("./repeatedoperator"),function(e,t){e.in_place_operator="*=",e.starting_value=1,e.evaluateConstant=function(e){var t=1+Math.round(e[1])-Math.round(e[0]);return t<=0?this.starting_value:Math.pow(e[2],t)},e.update=function(e,t){return e*t}})});r("core/math/parsenode/integral",["require","pjs","./scalarexpression","./dummyindex","core/math/builtin"],function(e){"use strict";var t=e("pjs"),r=e("./scalarexpression"),n=e("./dummyindex"),i=e("core/math/builtin");return t(r,function(e,t){e.init=function(e){t.init.call(this,e),this._differential=e[0],this.addDummyDependency(this._differential._symbol),this._differential instanceof n&&this.removeDependency(this._differential._symbol)},e.getEvalStrings=function(){var e=this.args[0],t=this.args[1],r=this.args[2],n=this.args[3],i=[],o=this.tmpVar(),a=e._symbol,s=this.tmpVar(),u=this.tmpVar(),c=t.getEvalStrings(),l=r.getEvalStrings(),p=n.getEvalStrings();return Array.prototype.push.apply(i,c.statements),Array.prototype.push.apply(i,l.statements),i.push("var "+s+" = "+c.expression),i.push("var "+u+" = "+l.expression),i.push("var "+o+" = function ("+a+") { "+p.statements.join("; ")+"; return "+p.expression+";}"),{statements:i,expression:"BuiltIn.quad("+[o,s,u].join(", ")+")"}},e.evaluate=function(e,t,r){var n=this.args[0],o=r.getCompiledFunction([n._symbol]).fn;return i.quad(o,e,t)}})});r("core/math/parsenode/functioncall",["require","pjs","./expression","./identifier"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("./identifier");return t(r,function(e,t){e.init=function(e,r){"string"==typeof e&&(e=n(e)),this._identifier=e,this._symbol=e._symbol,t.init.call(this,r),this.addDependency(this._symbol)},e.copyWithArgs=function(e){return new this.constructor(n(this._symbol),e)}})});r("core/math/parsenode/seededfunctioncall",["require","pjs","./functioncall"],function(e){"use strict";return e("pjs")(e("./functioncall"),function(e,t){e.init=function(e,r){t.init.call(this,e,r),this.seed=r[0]}})});r("core/math/parsenode/functionexponent",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){})});r("core/math/parsenode/functionfactorial",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){})});r("core/math/parsenode/prime",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e,r){t.init.call(this,r),this.order=e},e.copyWithArgs=function(e){return new this.constructor(this.order,e)}})});r("core/math/parsenode/piecewise",["require","pjs","./scalarexpression","./constant","core/math/maybe-rational"],function(e){"use strict";var t=e("pjs"),r=e("./scalarexpression"),n=e("./constant"),i=e("core/math/maybe-rational").maybeRational,o=t(r,{});return o.chain=function(e,t){for(var r,n=t;e.length;)r=e.pop(),n=o([r.condition,r.if_expr,n]);return n},o.empty=function(){return o([n(!0),n(i(1,1)),n(NaN)])},o});r("core/math/parsenode/derivative",["require","pjs","./scalarexpression","./identifier"],function(e){"use strict";var t=e("pjs"),r=e("./scalarexpression"),n=e("./identifier");return t(r,function(e,t){e.init=function(e,r){this._symbol=e instanceof n?e._symbol:n(e)._symbol,t.init.call(this,r)}})});r("core/math/parsenode/nativefunction",["require","pjs","./scalarexpression","core/math/functions"],function(e){"use strict";var t=e("pjs"),r=e("./scalarexpression"),n=e("core/math/functions");return t(r,function(e,r,i){e.init=function(e,t){if(e.length>=this._requiredArity)for(;e.length<this._maxArity;)e.push(this._optionalArguments[e.length-this._requiredArity]);this._errorSymbol="logbase"===this._symbol?"log":t||this._symbol,r.init.call(this,e)},e.copyWithArgs=function(e){var t=r.copyWithArgs.call(this,e);return t._errorSymbol=this._errorSymbol,t},e.scalarEvalExpression=function(e){return this.head+"("+e.join(",")+")"},i.create=function(e,r,i,o){return t(this,function(t,a,s){s.isFunction=!0,t._symbol=e,t.head=r,t._requiredArity=i,t._optionalArguments=o||[],t._maxArity=t._requiredArity+t._optionalArguments.length,t.evaluate=n.createEvaluateFunction(t.scalarEvalExpression.bind(t),t._maxArity),s.getConcreteInvocationTree=function(e,t,r,n){return s(r,n).getConcreteTree(e,t)},s.getCacheKeys=function(){return[]}})}})});r("core/math/parsenode/typedfunction",["require","pjs","./nativefunction"],function(e){"use strict";return e("pjs")(e("./nativefunction"),function(e,t,r,n){r.create=function(e,t,r,i){var o=r.length,a=n.create.call(this,e,t,o);return a.prototype._inputTypes=r,a.prototype._outputType=i,a}})});r("core/math/parsenode/trigfunction",["require","pjs","./nativefunction","./expressionTypes","core/math/errormsg"],function(e){"use strict";var t=e("pjs"),r=e("./nativefunction"),n=e("./expressionTypes").Multiply,i=e("core/math/errormsg");return t(r,function(e,t,r,o){r.create=function(e,t){var r=o.create(e,t,1);return r.getConcreteInvocationTree=function(e,t,o,a){if(o.length<1)throw i.wrongArity(a,1,o.length);var s=t.trigAngleMultiplier?[n([o[0],t.trigAngleMultiplier])].concat(o.slice(1)):o;return r(s,a).getConcreteTree(e,t)},r.getCacheKeys=function(){return["trigAngleMultiplier"]},r}})});r("core/math/parsenode/inversetrigfunction",["require","pjs","./nativefunction","./expressionTypes"],function(e){"use strict";var t=e("pjs"),r=e("./nativefunction"),n=e("./expressionTypes").Divide;return t(r,function(e,t,r,i){r.create=function(e,t,r){var o=i.create(e,t,1,r);return o.getConcreteInvocationTree=function(e,t,r,i){var a=o(r,i);return(t.trigAngleMultiplier?n([a,t.trigAngleMultiplier]):a).getConcreteTree(e,t)},o.getCacheKeys=function(){return["trigAngleMultiplier"]},o}})});r("core/math/parsenode/distribution",["require","pjs","./scalarexpression","core/math/errormsg"],function(e){"use strict";var t=e("pjs"),r=e("./scalarexpression"),n=e("core/math/errormsg");return t(r,function(e,r,i){e.init=function(e,t){var i="tdist"===this._symbol;if(e.length<this._requiredArity){if(i)throw n.tdistWrongArity();throw n.wrongArity(t,this._requiredArity,e.length)}if(e.length>this._maxArity){if(i)throw n.tdistWrongArity();throw n.wrongArity(this._symbol,this._maxArity,e.length)}for(;e.length<this._maxArity;)e.push(this._optionalArguments[e.length-this._requiredArity]);r.init.call(this,e)},e.scalarEvalExpression=function(e){return this.head+"("+e.join(",")+")"},i.create=function(e,r,n){return t(this,function(t,i,o){o.isFunction=!0,t._symbol=e,t._requiredArity=r,t._optionalArguments=n||[],t._maxArity=t._requiredArity+t._optionalArguments.length,o.getConcreteInvocationTree=function(e,t,r,n){return o(r,n)},o.getCacheKeys=function(){return[]}})}})});r("core/math/parsenode/reducerfunction",["require","pjs","./expression","core/math/functions","core/math/errormsg","./distribution","core/math/types"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("core/math/functions"),i=e("core/math/errormsg"),o=e("./distribution"),a=e("core/math/types");return t(r,function(e,r,s){e.init=function(e,t){if(0===e.length)throw i.zeroArgReducer(t);if(e[0]instanceof o&&"length"!==this._symbol&&!e[0][this._symbol])throw i.functionTypeError(this._symbol,[a.prettyPrint(this.args[0].valueType)]);r.init.call(this,e)},e.evalExpression=function(e){return this.head+"("+e+")"},e.getEvalStrings=function(){var e=this.args[0].getEvalStrings();return{statements:e.statements,expression:this.evalExpression(e.expression)}},s.create=function(e,r){return t(s,function(t,i,o){t._symbol=e,t.head=r,t._arity=1,o.isFunction=!0,o.allowDotCalls=!0,o.dotMinArity=0,o.dotMaxArity=0,t.evaluate=n.createEvaluateFunction(t.evalExpression.bind(t),t._arity),o.getConcreteInvocationTree=function(e,t,r,n){return o(r,n).getConcreteTree(e,t)},o.getCacheKeys=function(){return[]}})}})});r("core/math/parsenode/doublereducerfunction",["require","pjs","./expression","core/math/functions","core/math/errormsg"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("core/math/functions"),i=e("core/math/errormsg");return t(r,function(e,r,o){e.init=function(e,t){if(r.init.call(this,e),2!==this.args.length)throw i.wrongDoubleReducerArity(t)},e.evalExpression=function(e){return this.head+"("+e.join(",")+")"},e.getEvalStrings=function(){for(var e=[],t=[],r=Math.min(this.args[0].length,this.args[1].length),n=0;n<this.args.length;n++){var i=this.args[n],o=i.getEvalStrings();Array.prototype.push.apply(e,o.statements),t.push(i.length===r?o.expression:o.expression+".slice(0,"+r+")")}return{statements:e,expression:this.evalExpression(t)}},o.create=function(e,r){return t(o,function(t,i,o){t._symbol=e,t.head=r,t._arity=2,o.isFunction=!0,t.evaluate=n.createEvaluateFunction(t.evalExpression.bind(t),t._arity),o.getConcreteInvocationTree=function(e,t,r,n){return o(r,n).getConcreteTree(e,t)},o.getCacheKeys=function(){return[]}})}})});r("core/math/parsenode/parametrizedreducerfunction",["require","pjs","./expression","core/math/functions","core/math/errormsg","./distribution","core/math/types"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("core/math/functions"),i=e("core/math/errormsg"),o=e("./distribution"),a=e("core/math/types");return t(r,function(e,r,s){e.init=function(e,t){if(e.length<2&&void 0!==this._optionalArgument&&e.push(this._optionalArgument),2!==e.length)throw i.wrongParametrizedReducerArity(t);if(e[0]instanceof o&&!e[0][this._symbol])throw i.functionTypeError(t,[a.prettyPrint(this.args[0].valueType)]);r.init.call(this,e)},e.evalExpression=function(e){return this.head+"("+e.join(",")+")"},e.getEvalStrings=function(){var e=[],t=this.args[0].getEvalStrings(),r=this.args[1].getEvalStrings();return Array.prototype.push.apply(e,t.statements),Array.prototype.push.apply(e,r.statements),{statements:e,expression:this.evalExpression([t.expression,r.expression])}},s.create=function(e,r,i){return t(s,function(t,o,a){t._symbol=e,t.head=r,t._optionalArgument=i,t._arity=2,a.isFunction=!0,a.allowDotCalls=!0,a.dotMinArity=void 0===i?1:0,a.dotMaxArity=1,t.evaluate=n.createEvaluateFunction(t.evalExpression.bind(t),t._arity),a.getConcreteInvocationTree=function(e,t,r,n){return a(r,n).getConcreteTree(e,t)},a.getCacheKeys=function(){return[]}})}})});r("core/math/parsenode/toplevelfunction",["require","pjs","./nativefunction","core/math/errormsg"],function(e){"use strict";var t=e("pjs"),r=e("./nativefunction"),n=e("core/math/errormsg");return t(r,function(e,r,i,o){i.create=function(e){return t(i,function(e,t,r){r.isFunction=!0,r.getConcreteInvocationTree=function(e,t,r,i){throw n.unexpectedSymbol(i)},r.getCacheKeys=function(){return[]}})}})});r("core/math/parsenode/builtinfunction",["require","core/math/parsenode/nativefunction","core/math/parsenode/typedfunction","core/math/parsenode/trigfunction","core/math/parsenode/inversetrigfunction","core/math/parsenode/reducerfunction","core/math/parsenode/doublereducerfunction","core/math/parsenode/parametrizedreducerfunction","core/math/parsenode/distribution","core/math/parsenode/toplevelfunction","core/math/types","core/math/maybe-rational","core/math/parsenode/constant"],function(e){"use strict";var t=e("core/math/parsenode/nativefunction"),r=e("core/math/parsenode/typedfunction"),n=e("core/math/parsenode/trigfunction"),i=e("core/math/parsenode/inversetrigfunction"),o=e("core/math/parsenode/reducerfunction"),a=e("core/math/parsenode/doublereducerfunction"),s=e("core/math/parsenode/parametrizedreducerfunction"),u=e("core/math/parsenode/distribution"),c=e("core/math/parsenode/toplevelfunction"),l=e("core/math/types"),p=e("core/math/maybe-rational").maybeRational,f=e("core/math/parsenode/constant"),d=f(p(1,1)),h=f(p(0,1)),m=f(p(1,2));return{sin:n.create("sin","BuiltIn.sin"),cos:n.create("cos","BuiltIn.cos"),tan:n.create("tan","BuiltIn.tan"),cot:n.create("cot","BuiltIn.cot"),sec:n.create("sec","BuiltIn.sec"),csc:n.create("csc","BuiltIn.csc"),arcsin:i.create("arcsin","Math.asin"),arccos:i.create("arccos","Math.acos"),arctan:i.create("arctan","Math.atan2",[d]),arccot:i.create("arccot","BuiltIn.acot"),arcsec:i.create("arcsec","BuiltIn.asec"),arccsc:i.create("arccsc","BuiltIn.acsc"),sinh:t.create("sinh","BuiltIn.sinh",1),cosh:t.create("cosh","BuiltIn.cosh",1),tanh:t.create("tanh","BuiltIn.tanh",1),coth:t.create("coth","BuiltIn.coth",1),sech:t.create("sech","BuiltIn.sech",1),csch:t.create("csch","BuiltIn.csch",1),arcsinh:t.create("arcsinh","BuiltIn.asinh",1),arccosh:t.create("arccosh","BuiltIn.acosh",1),arctanh:t.create("arctanh","BuiltIn.atanh",1),arccoth:t.create("arccoth","BuiltIn.acoth",1),arcsech:t.create("arcsech","BuiltIn.asech",1),arccsch:t.create("arccsch","BuiltIn.acsch",1),sqrt:t.create("sqrt","Math.sqrt",1),rtxsqpone:t.create("rtxsqpone","BuiltIn.sqrtxsqp1",1),rtxsqmone:t.create("rtxsqmone","BuiltIn.sqrtxsqm1",1),nthroot:t.create("nthroot","BuiltIn.nthroot",2),log:t.create("log","BuiltIn.common_log",1),logbase:t.create("logbase","BuiltIn.log_base",2),ln:t.create("ln","BuiltIn.log",1),exp:t.create("exp","Math.exp",1),floor:t.create("floor","Math.floor",1),ceil:t.create("ceil","Math.ceil",1),round:t.create("round","BuiltIn.round",1,[h]),abs:t.create("abs","Math.abs",1),sign:t.create("sign","BuiltIn.sign",1),mod:t.create("mod","BuiltIn.mod",2),nCr:t.create("nCr","BuiltIn.nCr",2),nPr:t.create("nPr","BuiltIn.nPr",2),factorial:t.create("factorial","BuiltIn.factorial",1),polyGamma:t.create("polyGamma","BuiltIn.polyGamma",2),lcm:o.create("lcm","BuiltIn.listLCM"),gcd:o.create("gcd","BuiltIn.listGCD"),mean:o.create("mean","BuiltIn.mean"),total:o.create("total","BuiltIn.total"),stdev:o.create("stdev","BuiltIn.stdev"),stdevp:o.create("stdevp","BuiltIn.stdevp"),mad:o.create("mad","BuiltIn.mad"),length:o.create("length","BuiltIn.length"),min:o.create("min","BuiltIn.listMin"),max:o.create("max","BuiltIn.listMax"),argmin:o.create("argmin","BuiltIn.argMin"),argmax:o.create("argmax","BuiltIn.argMax"),median:o.create("median","BuiltIn.median"),var:o.create("var","BuiltIn.var"),varp:o.create("varp","BuiltIn.varp"),cov:a.create("cov","BuiltIn.cov"),covp:a.create("covp","BuiltIn.covp"),corr:a.create("corr","BuiltIn.corr"),spearman:a.create("spearman","BuiltIn.spearman"),quantile:s.create("quantile","BuiltIn.quantile"),quartile:s.create("quartile","BuiltIn.quartile"),upperQuantileIndex:s.create("upperQuantileIndex","BuiltIn.upperQuantileIndex"),lowerQuantileIndex:s.create("lowerQuantileIndex","BuiltIn.lowerQuantileIndex"),quartileIndex:s.create("quartileIndex","BuiltIn.quartileIndex"),upperQuartileIndex:s.create("upperQuartileIndex","BuiltIn.upperQuartileIndex"),lowerQuartileIndex:s.create("lowerQuartileIndex","BuiltIn.lowerQuartileIndex"),normalcdf:t.create("normalcdf","BuiltIn.normalcdf",2,[h,d]),normalpdf:t.create("normalpdf","BuiltIn.normalpdf",1,[h,d]),normalSample:r.create("normalSample","BuiltIn.normalSample",[l.SeedType,l.Number,l.Number],l.Number),uniformSample:r.create("uniformSample","BuiltIn.uniformSample",[l.SeedType,l.Number,l.Number],l.Number),tSample:r.create("tSample","BuiltIn.tSample",[l.SeedType,l.Number],l.Number),poissonSample:r.create("poissonSample","BuiltIn.poissonSample",[l.SeedType,l.Number],l.Number),binomSample:r.create("binomSample","BuiltIn.binomSample",[l.SeedType,l.Number,l.Number],l.Number),binomcdf:t.create("binomcdf","BuiltIn.binomcdf",3,[m]),binompdf:t.create("binompdf","BuiltIn.binompdf",2,[m]),poissoncdf:t.create("poissoncdf","BuiltIn.poissoncdf",3),poissonpdf:t.create("poissonpdf","BuiltIn.poissonpdf",2),uniformcdf:t.create("uniformcdf","BuiltIn.uniformcdf",2,[h,d]),uniformpdf:t.create("uniformpdf","BuiltIn.uniformpdf",1,[h,d]),invNorm:t.create("invNorm","BuiltIn.invNorm",1),invT:t.create("invT","BuiltIn.invT",2),invPoisson:t.create("invPoisson","BuiltIn.invPoisson",2),invBinom:t.create("invBinom","BuiltIn.invBinom",3),invUniform:t.create("invUniform","BuiltIn.invUniform",3),erf:t.create("erf","BuiltIn.erf",1),tpdf:t.create("tpdf","BuiltIn.tpdf",2),tcdf:t.create("tcdf","BuiltIn.tcdf",3),tscore:s.create("tscore","BuiltIn.tscore",h),distance:r.create("distance","BuiltIn.distance",[l.Point,l.Point],l.Number),midpoint:r.create("midpoint","BuiltIn.midpoint",[l.Point,l.Point],l.Point),addPoints:r.create("addPoints","BuiltIn.addPoints",[l.Point,l.Point],l.Point),subtractPoints:r.create("addPoints","BuiltIn.subtractPoints",[l.Point,l.Point],l.Point),negatePoint:r.create("negatePoint","BuiltIn.negatePoint",[l.Point],l.Point),multiplyPoint:r.create("multiplyPoint","BuiltIn.multiplyPoint",[l.Point,l.Number],l.Point),dividePoint:r.create("dividePoint","BuiltIn.dividePoint",[l.Point,l.Number],l.Point),normaldist:u.create("normaldist",0,[h,d]),tdist:u.create("tdist",1),binomialdist:u.create("binomialdist",1,[m]),poissondist:u.create("poissondist",1),uniformdist:u.create("uniformdist",0,[h,d]),pdf:r.create("pdf","BuiltIn.normpdf",[l.Distribution,[l.Number,l.ListOfNumber,l.EmptyList]],l.Number).open(function(e,t,r){r.allowDotCalls=!0,r.dotMinArity=1,r.dotMaxArity=1}),cdf:r.create("cdf","BuiltIn.normcdf",[l.Distribution,[l.Number,l.ListOfNumber,l.EmptyList],[l.Number,l.ListOfNumber,l.EmptyList]],l.Number).open(function(e,t,r){r.allowDotCalls=!0,r.dotMinArity=1,r.dotMaxArity=2}),random:t.create("random","",2).open(function(e,t,r){r.allowDotCalls=!0,r.dotMinArity=1,r.dotMaxArity=3}),rgb:r.create("rgb","BuiltIn.rgb",[l.Number,l.Number,l.Number],l.RGBColor),hsv:r.create("hsv","BuiltIn.hsv",[l.Number,l.Number,l.Number],l.RGBColor),shuffle:t.create("shuffle","",2).open(function(e,t,r){r.allowDotCalls=!0,r.dotMinArity=1,r.dotMaxArity=2,r.minArityUsageExample="shuffle([1,2,3])",e.minArityUsageExample=r.minArityUsageExample,r.maxArityUsageExample="shuffle([1,2,3],2)",e.maxArityUsageExample=r.maxArityUsageExample,r.dotMaxArityUsageExample=".shuffle(2)"}),sort:t.create("sort","",1).open(function(e,t,r){r.allowDotCalls=!0,r.dotMinArity=0,r.dotMaxArity=1,r.minArityUsageExample="sort([3,2,1])",e.minArityUsageExample=r.minArityUsageExample,r.maxArityUsageExample="sort([1,2,3],[3,2,1])",e.maxArityUsageExample=r.maxArityUsageExample,r.dotMaxArityUsageExample=".sort([3,4])"}),join:t.create("join","",2).open(function(e,t,r){r.allowDotCalls=!0,r.dotMinArity=1,r.dotMaxArity=1/0,r.minArityUsageExample="join([1,2],[3,4])",e.minArityUsageExample=r.minArityUsageExample,r.dotMinArityUsageExample=".join([3,4])"}),polygon:c.create("polygon"),histogram:c.create("histogram"),dotplot:c.create("dotplot"),boxplot:c.create("boxplot"),ttest:c.create("ttest"),ittest:c.create("ittest"),stats:c.create("stats"),det:c.create("det"),inv:c.create("inv"),transpose:c.create("transpose"),rref:c.create("rref"),trace:c.create("trace")}});r("core/math/parsenode/histogram",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){t.init.call(this,e),this._symbol="histogram"}})});r("core/math/parsenode/object3d",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e,r){t.init.call(this,e),this._symbol=r}})});r("core/math/parsenode/dotplot",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){t.init.call(this,e),this._symbol="dotplot"}})});r("core/math/parsenode/boxplot",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){t.init.call(this,e),this._symbol="boxplot"}})});r("core/math/parsenode/ttest",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(){t.init.apply(this,arguments),this._symbol="ttest"}})});r("core/math/parsenode/independent-ttest",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(){t.init.apply(this,arguments),this._symbol="ittest"}})});r("core/math/parsenode/stats",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(){t.init.apply(this,arguments),this._symbol="stats"}})});r("core/math/parsenode/equation",["require","./base","pjs","./expressionTypes","core/math/parsenode/comparator"],function(e){"use strict";var t=e("./base"),r=e("pjs"),n=e("./expressionTypes").Subtract,i=e("core/math/parsenode/comparator");return r(t,function(e,t){e.init=function(e,r){t.init.call(this),this.mergeDependencies(e,r),this._lhs=e,this._rhs=r,this._difference=n([this._lhs,this._rhs])},e.asComparator=function(){return i["="]([this._lhs,this._rhs])}})});r("core/math/parsenode/assignment",["require","./base","./equation","./identifier","pjs"],function(e){"use strict";var t=e("./base"),r=e("./equation"),n=e("./identifier");return e("pjs")(t,function(e,t){e.init=function(e,r){t.init.call(this),e=e._symbol,this.mergeDependencies(r),this._expression=r,this._symbol=e,this._exports=this.computeExports()},e.shouldExportAns=function(){return!0},e.computeExports=function(){for(var e=this._symbol,t=this.getDependencies(),r=0;r<t.length;r++)if(t[r]===e)return[];return[e]},e.isEquation=function(e){return-1!==e.getDependencies().indexOf(this._symbol)},e.asEquation=function(){var e=r(n(this._symbol),this._expression);return e.userData=this.userData,e.metaData=this.metaData,e},e.shouldPromoteToSlider=function(e){return!!this._expression.isConstant&&(!this._expression.is_mixed_number&&("number"==typeof this._expression.asValue()&&(!!isFinite(this._expression.asValue())&&e.isValidSlider(this._symbol))))}})});r("core/math/parsenode/functiondefinition",["require","pjs","./base","core/math/errormsg","./equation","./identifier","./functioncall"],function(e){"use strict";var t=e("pjs"),r=e("./base"),n=e("core/math/errormsg"),i=e("./equation"),o=e("./identifier"),a=e("./functioncall");return t(r,function(e,t){e.init=function(e,r,n){t.init.call(this),e=e._symbol,this._argSymbols=r.map(function(e){return e._symbol}),this._symbol=e,this._exports=[e],this._expression=n,this.addDependencies(this._argSymbols),this.addDummyDependencies(this._argSymbols),this.mergeDependencies(this._expression)},e.isFunction=!0,e.getConcreteInvocationTree=function(e,t,r,i){if(r.length!==this._argSymbols.length)throw n.wrongArity(i,this._argSymbols.length,r.length);for(var o=Object.create(t),a=0;a<this._argSymbols.length;a++)o[this._argSymbols[a]]=r[a];return this._expression.getConcreteTree(e,o)},e.getSliderVariables=function(e,t){var r=this._argSymbols;return e.sliderVariables(t.getDependencies()).filter(function(e){return-1===r.indexOf(e)})},e.asEquation=function(){var e=this._argSymbols.map(function(e){return o(e)}),t=i(a(o(this._symbol),e),this._expression);return t.userData=this.userData,t.metaData=this.metaData,t}})});r("core/math/parsenode/optimizedregression",["require","pjs","./base"],function(e){"use strict";return e("pjs")(e("./base"),function(e,t){e.init=function(e,r,n,i,o){for(var a in t.init.call(this),this.parameters=e,this.residuals=r,this.statistics=n,this.model=i,this.isModelValid=o.isModelValid,this.residualVariable=o.residualVariable,this.residualSuggestionId=o.residualSuggestionId,this.shouldSuggestLogMode=o.shouldSuggestLogMode,this.isLinear=o.isLinear,this.parameterWarning=o.parameterWarning,this._exports=[this.residualVariable],e)e.hasOwnProperty(a)&&this._exports.push(a);this.mergeDependencies(i)},e.getCompiledFunction=function(){return this.model.getCompiledFunction.apply(this.model,arguments)},e.getCompiledDerivative=function(){return this.model.getCompiledDerivative.apply(this.model,arguments)},e.evaluate=function(){return this.model.evaluate.apply(this.model,arguments)}})});r("numeric",[],function(){"use strict";var e="undefined"==typeof exports?function(){}:exports;return"undefined"!=typeof global&&(global.numeric=e),e.version="1.2.6",e._myIndexOf=function(e){for(var t=this.length,r=0;r<t;++r)if(this[r]===e)return r;return-1},e.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:e._myIndexOf,e.precision=4,e.largeArray=50,e.compile=function(){var t=Array.prototype.slice.call(arguments),r=t.pop(),r="return function ("+t.join(",")+") {"+r+"}";return new Function(["numeric"],r)(e)},e._dim=function(e){for(var t=[];"object"==typeof e;)t.push(e.length),e=e[0];return t},e.dim=function(t){var r;return"object"==typeof t?"object"==typeof(r=t[0])?"object"==typeof r[0]?e._dim(t):[t.length,r.length]:[t.length]:[]},e.mapreduce=function(t,r){return e.compile("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+r+';\nif(typeof x === "number") { var xi = x; '+t+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+t+";\n    xi = x[i-1];\n    "+t+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+t+"\n}\nreturn accum;")},e.mapreduce2=function(t,r){return e.compile("x","var n = x.length;\nvar i,xi;\n"+r+"\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+t+"\n}\nreturn accum;")},e.rep=function(t,r,n){void 0===n&&(n=0);var i,o=t[n],a=Array(o);if(n===t.length-1){for(i=o-2;0<=i;i-=2)a[i+1]=r,a[i]=r;return-1===i&&(a[0]=r),a}for(i=o-1;0<=i;i--)a[i]=e.rep(t,r,n+1);return a},e.dotMMsmall=function(e,t){for(var r,n,i,o,a,s,u=e.length,c=t.length,l=t[0].length,p=Array(u),f=u-1;0<=f;f--){for(i=Array(l),o=e[f],n=l-1;0<=n;n--){for(a=o[c-1]*t[c-1][n],r=c-2;1<=r;r-=2)s=r-1,a+=o[r]*t[r][n]+o[s]*t[s][n];0===r&&(a+=o[0]*t[0][n]),i[n]=a}p[f]=i}return p},e._getCol=function(e,t,r){for(var n=e.length-1;0<n;--n)r[n]=e[n][t],r[--n]=e[n][t];0===n&&(r[0]=e[0][t])},e.dotMMbig=function(t,r){var n,i,o,a=e._getCol,s=r.length,u=Array(s),c=t.length,l=r[0].length,p=new Array(c),f=e.dotVV;for(i=--c;-1!==i;--i)p[i]=Array(l);for(i=--l;-1!==i;--i)for(a(r,i,u),o=c;-1!==o;--o)n=t[o],p[o][i]=f(n,u);return p},e.dotMV=function(t,r){for(var n=t.length,i=(r.length,Array(n)),o=e.dotVV,a=n-1;0<=a;a--)i[a]=o(t[a],r);return i},e.dotVM=function(e,t){for(var r,n,i,o=e.length,a=t[0].length,s=Array(a),u=a-1;0<=u;u--){for(n=e[o-1]*t[o-1][u],r=o-2;1<=r;r-=2)i=r-1,n+=e[r]*t[r][u]+e[i]*t[i][u];0===r&&(n+=e[0]*t[0][u]),s[u]=n}return s},e.dotVV=function(e,t){for(var r,n=e.length,i=e[n-1]*t[n-1],o=n-2;1<=o;o-=2)r=o-1,i+=e[o]*t[o]+e[r]*t[r];return 0===o&&(i+=e[0]*t[0]),i},e.dot=function(t,r){var n=e.dim;switch(1e3*n(t).length+n(r).length){case 2002:return r.length<10?e.dotMMsmall(t,r):e.dotMMbig(t,r);case 2001:return e.dotMV(t,r);case 1002:return e.dotVM(t,r);case 1001:return e.dotVV(t,r);case 1e3:return e.mulVS(t,r);case 1:return e.mulSV(t,r);case 0:return t*r;default:throw new Error("numeric.dot only works on vectors and matrices")}},e.diag=function(e){for(var t,r,n,i=e.length,o=Array(i),a=i-1;0<=a;a--){for(n=Array(i),t=a+2,r=i-1;t<=r;r-=2)n[r]=0,n[r-1]=0;for(a<r&&(n[r]=0),n[a]=e[a],r=a-1;1<=r;r-=2)n[r]=0,n[r-1]=0;0===r&&(n[0]=0),o[a]=n}return o},e.getDiag=function(e){for(var t=Math.min(e.length,e[0].length),r=Array(t),n=t-1;1<=n;--n)r[n]=e[n][n],r[--n]=e[n][n];return 0===n&&(r[0]=e[0][0]),r},e.identity=function(t){return e.diag(e.rep([t],1))},e.pointwise=function(t,r,n){void 0===n&&(n="");for(var i,o=[],a=/\[i\]$/,s="",u=!1,c=0;c<t.length;c++)a.test(t[c])?s=i=t[c].substring(0,t[c].length-3):i=t[c],"ret"===i&&(u=!0),o.push(i);return o[t.length]="_s",o[t.length+1]="_k",o[t.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+s+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(u?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+t.join(",")+",_s,_k+1);\n    return ret;\n}\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n    "+r+"\n}\nreturn ret;",e.compile.apply(null,o)},e.pointwise2=function(t,r,n){void 0===n&&(n="");for(var i,o=[],a=/\[i\]$/,s="",u=!1,c=0;c<t.length;c++)a.test(t[c])?s=i=t[c].substring(0,t[c].length-3):i=t[c],"ret"===i&&(u=!0),o.push(i);return o[t.length]="var _n = "+s+".length;\nvar i"+(u?"":", ret = Array(_n)")+";\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n"+r+"\n}\nreturn ret;",e.compile.apply(null,o)},e._biforeach=function e(t,r,n,i,o){if(i!==n.length-1)for(var a=n[i]-1;0<=a;a--)e("object"==typeof t?t[a]:t,"object"==typeof r?r[a]:r,n,i+1,o);else o(t,r)},e._biforeach2=function e(t,r,n,i,o){if(i===n.length-1)return o(t,r);for(var a=n[i],s=Array(a),u=a-1;0<=u;--u)s[u]=e("object"==typeof t?t[u]:t,"object"==typeof r?r[u]:r,n,i+1,o);return s},e._foreach=function e(t,r,n,i){if(n!==r.length-1)for(var o=r[n]-1;0<=o;o--)e(t[o],r,n+1,i);else i(t)},e._foreach2=function e(t,r,n,i){if(n===r.length-1)return i(t);for(var o=r[n],a=Array(o),s=o-1;0<=s;s--)a[s]=e(t[s],r,n+1,i);return a},e.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},e.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},e.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],e.mathfuns2=["atan2","pow","max","min"],e.ops1={neg:"-",not:"!",bnot:"~",clone:""},e.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi);","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){for(var t,r,n,i,o=0;o<e.mathfuns2.length;++o)t=e.mathfuns2[o],e.ops2[t]=t;for(o in e.ops2){e.ops2.hasOwnProperty(o)&&(t=e.ops2[o],n="",i=-1!==e.myIndexOf.call(e.mathfuns2,o)?(n="var "+t+" = Math."+t+";\n",r=function(e,r,n){return e+" = "+t+"("+r+","+n+")"},function(e,r){return e+" = "+t+"("+e+","+r+")"}):(r=function(e,r,n){return e+" = "+r+" "+t+" "+n},e.opseq.hasOwnProperty(o+"eq")?function(e,r){return e+" "+t+"= "+r}:function(e,r){return e+" = "+e+" "+t+" "+r}),e[o+"VV"]=e.pointwise2(["x[i]","y[i]"],r("ret[i]","x[i]","y[i]"),n),e[o+"SV"]=e.pointwise2(["x","y[i]"],r("ret[i]","x","y[i]"),n),e[o+"VS"]=e.pointwise2(["x[i]","y"],r("ret[i]","x[i]","y"),n),e[o]=e.compile("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+o+"VV, VS = numeric."+o+"VS, SV = numeric."+o+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+i("x","y")+"\n}\nreturn x;\n"),e[t]=e[o],e[o+"eqV"]=e.pointwise2(["ret[i]","x[i]"],i("ret[i]","x[i]"),n),e[o+"eqS"]=e.pointwise2(["ret[i]","x"],i("ret[i]","x"),n),e[o+"eq"]=e.compile("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+o+"eqV, S = numeric."+o+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n'))}for(o=0;o<e.mathfuns2.length;++o)t=e.mathfuns2[o],delete e.ops2[t];for(o=0;o<e.mathfuns.length;++o)t=e.mathfuns[o],e.ops1[t]=t;for(o in e.ops1)e.ops1.hasOwnProperty(o)&&(n="",t=e.ops1[o],-1!==e.myIndexOf.call(e.mathfuns,o)&&Math.hasOwnProperty(t)&&(n="var "+t+" = Math."+t+";\n"),e[o+"eqV"]=e.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",n),e[o+"eq"]=e.compile("x",'if(typeof x !== "object") return '+t+"x\nvar i;\nvar V = numeric."+o+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),e[o+"V"]=e.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",n),e[o]=e.compile("x",'if(typeof x !== "object") return '+t+"(x)\nvar i;\nvar V = numeric."+o+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(o=0;o<e.mathfuns.length;++o)t=e.mathfuns[o],delete e.ops1[t];for(o in e.mapreducers)e.mapreducers.hasOwnProperty(o)&&(t=e.mapreducers[o],e[o+"V"]=e.mapreduce2(t[0],t[1]),e[o]=e.compile("x","s","k",t[1]+'if(typeof x !== "object") {    xi = x;\n'+t[0]+'\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+o+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+t[0]+"\n}\nreturn accum;\n"))}(),e.inv=function(t){for(var r,n,i,o,a,s=e.dim(t),u=Math.abs,c=s[0],l=s[1],p=e.clone(t),f=e.identity(c),d=0;d<l;++d){for(var h=-1,m=-1,y=d;y!==c;++y)m<(a=u(p[y][d]))&&(h=y,m=a);for(n=p[h],p[h]=p[d],p[d]=n,o=f[h],f[h]=f[d],f[d]=o,t=n[d],a=d;a!==l;++a)n[a]/=t;for(a=l-1;-1!==a;--a)o[a]/=t;for(y=c-1;-1!==y;--y)if(y!==d){for(r=p[y],i=f[y],t=r[d],a=d+1;a!==l;++a)r[a]-=n[a]*t;for(a=l-1;0<a;--a)i[a]-=o[a]*t,i[--a]-=o[a]*t;0===a&&(i[0]-=o[0]*t)}}return f},e.det=function(t){var r=e.dim(t);if(2!==r.length||r[0]!==r[1])throw new Error("numeric: det() only works on square matrices");for(var n,i,o,a,s,u,c,l=r[0],p=1,f=e.clone(t),d=0;d<l-1;d++){for(n=(i=d)+1;n<l;n++)Math.abs(f[n][d])>Math.abs(f[i][d])&&(i=n);for(i!==d&&(u=f[i],f[i]=f[d],f[d]=u,p*=-1),o=f[d],n=d+1;n<l;n++){for(s=(a=f[n])[d]/o[d],i=d+1;i<l-1;i+=2)c=i+1,a[i]-=o[i]*s,a[c]-=o[c]*s;i!==l&&(a[i]-=o[i]*s)}if(0===o[d])return 0;p*=o[d]}return p*f[d][d]},e.transpose=function(e){for(var t,r,n,i,o=e.length,a=e[0].length,s=Array(a),u=0;u<a;u++)s[u]=Array(o);for(t=o-1;1<=t;t-=2){for(n=e[t],r=e[t-1],u=a-1;1<=u;--u)(i=s[u])[t]=n[u],i[t-1]=r[u],(i=s[--u])[t]=n[u],i[t-1]=r[u];0===u&&((i=s[0])[t]=n[0],i[t-1]=r[0])}if(0===t){for(r=e[0],u=a-1;1<=u;--u)s[u][0]=r[u],s[--u][0]=r[u];0===u&&(s[0][0]=r[0])}return s},e.negtranspose=function(e){for(var t,r,n,i,o=e.length,a=e[0].length,s=Array(a),u=0;u<a;u++)s[u]=Array(o);for(t=o-1;1<=t;t-=2){for(n=e[t],r=e[t-1],u=a-1;1<=u;--u)(i=s[u])[t]=-n[u],i[t-1]=-r[u],(i=s[--u])[t]=-n[u],i[t-1]=-r[u];0===u&&((i=s[0])[t]=-n[0],i[t-1]=-r[0])}if(0===t){for(r=e[0],u=a-1;1<=u;--u)s[u][0]=-r[u],s[--u][0]=-r[u];0===u&&(s[0][0]=-r[0])}return s},e.norm2=function(t){return Math.sqrt(e.norm2Squared(t))},e.linspace=function(e,t,r){if(void 0===r&&(r=Math.max(Math.round(t-e)+1,1)),r<2)return 1===r?[e]:[];for(var n=Array(r),i=--r;0<=i;i--)n[i]=(i*t+(r-i)*e)/r;return n},e.getBlock=function(t,r,n){var i=e.dim(t);return function e(t,o){var a,s=r[o],u=n[o]-s,c=Array(u);if(o===i.length-1){for(a=u;0<=a;a--)c[a]=t[a+s];return c}for(a=u;0<=a;a--)c[a]=e(t[a+s],o+1);return c}(t,0)},e.setBlock=function(t,r,n,i){var o=e.dim(t);return function e(t,i,a){var s,u=r[a],c=n[a]-u;if(a===o.length-1)for(s=c;0<=s;s--)t[s+u]=i[s];for(s=c;0<=s;s--)e(t[s+u],i[s],a+1)}(t,i,0),t},e.getRange=function(e,t,r){for(var n,i,o,a=t.length,s=r.length,u=Array(a),c=a-1;-1!==c;--c)for(u[c]=Array(s),i=u[c],o=e[t[c]],n=s-1;-1!==n;--n)i[n]=o[r[n]];return u},e.blockMatrix=function(t){var r=e.dim(t);if(r.length<4)return e.blockMatrix([t]);for(var n,i,o=r[0],a=r[1],s=0,u=0,c=0;c<o;++c)s+=t[c][0].length;for(n=0;n<a;++n)u+=t[0][n][0].length;var l=Array(s);for(c=0;c<s;++c)l[c]=Array(u);var p,f,d,h,m,y=0;for(c=0;c<o;++c){for(p=u,n=a-1;-1!==n;--n)for(p-=(i=t[c][n])[0].length,d=i.length-1;-1!==d;--d)for(m=i[d],f=l[y+d],h=m.length-1;-1!==h;--h)f[p+h]=m[h];y+=t[c][0].length}return l},e.tensor=function(t,r){if("number"==typeof t||"number"==typeof r)return e.mul(t,r);var n=e.dim(t),i=e.dim(r);if(1!==n.length||1!==i.length)throw new Error("numeric: tensor product is only defined for vectors");for(var o,a,s,u=n[0],c=i[0],l=Array(u),p=u-1;0<=p;p--){for(o=Array(c),s=t[p],a=c-1;3<=a;--a)o[a]=s*r[a],o[--a]=s*r[a],o[--a]=s*r[a],o[--a]=s*r[a];for(;0<=a;)o[a]=s*r[a],--a;l[p]=o}return l},e.epsilon=2.220446049250313e-16,e.LU=function(t,r){r=r||!1;var n,i,o,a,s,u,c,l,p,f=Math.abs,d=t.length,h=d-1,m=new Array(d);for(r||(t=e.clone(t)),o=0;o<d;++o){for(p=f((u=t[c=o])[o]),i=o+1;i<d;++i)p<(a=f(t[i][o]))&&(p=a,c=i);for((m[o]=c)!=o&&(t[o]=t[c],t[c]=u,u=t[o]),s=u[o],n=o+1;n<d;++n)t[n][o]/=s;for(n=o+1;n<d;++n){for(l=t[n],i=o+1;i<h;++i)l[i]-=l[o]*u[i],l[++i]-=l[o]*u[i];i===h&&(l[i]-=l[o]*u[i])}}return{LU:t,P:m}},e.LUsolve=function(t,r){for(var n,i,o,a,s=t.LU,u=s.length,c=e.clone(r),l=t.P,p=u-1;-1!==p;--p)c[p]=r[p];for(p=0;p<u;++p)for(i=l[p],l[p]!==p&&(a=c[p],c[p]=c[i],c[i]=a),o=s[p],n=0;n<p;++n)c[p]-=c[n]*o[n];for(p=u-1;0<=p;--p){for(o=s[p],n=p+1;n<u;++n)c[p]-=c[n]*o[n];c[p]/=o[p]}return c},e.solve=function(t,r,n){return e.LUsolve(e.LU(t,n),r)},e});r("core/math/qr",["require","exports"],function(e,t){"use strict";function r(e,t,r){for(var n=e.reflectors,i=e.r,o=e.p,a=t.slice(),s=0;s<n.length;s++)!function(e,t){for(var r=e.length,n=t.length,i=0,o=0,a=n-r;a<n;a++)i+=e[a+r-n]*t[a],o+=e[a+r-n]*e[a+r-n];for(var s=i/o,a=n-r;a<n;a++)t[a]=2*s*e[a+r-n]-t[a]}(n[s],a);for(s=n.length;s<i[0].length;s++)a[s]=0;a.length=i[0].length;for(var u=Math.pow(2,-52),c=r.regularize?u*Math.abs(i[0][0])*Math.max(i.length,i[0].length):0,s=n.length-1;0<=s;s--){var l=i[s];if(Math.abs(l[s])<=c)a[s]=0;else{for(var p=s+1;p<n.length;p++)a[s]-=a[p]*l[p];a[s]/=l[s]}}for(var f,s=o.length-1;0<=s;s--){o[s]!==s&&(f=a[s],a[s]=a[o[s]],a[o[s]]=f)}return a}function n(e){var t=e.r,r=Math.min(t.length,t[0].length),n=t[0][0],i=t[r-1][r-1];return 0===n?1/0:Math.abs(n/i)}Object.defineProperty(t,"__esModule",{value:!0}),t.isNumericallyFullRank=t.conditionNumber=t.qrSolve=t.qr=void 0,t.qr=function(e,t){if(!t||!t.mutateInput){var r=e;e=Array(e.length);for(var n=0;n<r.length;n++)e[n]=r[n].slice()}for(var i=Math.min(e.length,e[0].length),o=Array(i),a=[],s=0;s<i;s++){for(var u=-1/0,c=s,l=s;l<e[s].length;l++){var p=function(e,t,r){for(var n=0;t<e.length;t++)n+=e[t][r]*e[t][r];return n}(e,s,l);u<p&&(u=p,c=l)}if((o[s]=c)!==s)for(n=0;n<e.length;n++){var f=e[n][c];e[n][c]=e[n][s],e[n][s]=f}for(var d=function(e,t,r,n){var i=Array(e.length-t);if(1===i.length)return i[0]=1,i;if(0===n){for(var o=i[0]=1;o<i.length;o++)i[o]=0;return i}var a=e[t][r]<0?-1:1;i[0]=e[t][r]+a*Math.sqrt(n);for(var s=t+1;s<e.length;s++)i[s-t]=e[s][r];return i}(e,s,s,u),l=s;l<e[s].length;l++)!function(e,t,r){for(var n=e.length,i=t.length,o=0,a=0,s=i-n;s<i;s++)o+=e[s+n-i]*t[s][r],a+=e[s+n-i]*e[s+n-i];for(var u=o/a,s=i-n;s<i;s++)t[s][r]=2*u*e[s+n-i]-t[s][r]}(d,e,l);a.push(d)}return{reflectors:a,r:e,p:o}},t.qrSolve=function(e,t,n){return(Array.isArray(t[0])?function(e,t,n){for(var i=Array(e.r[0].length),o=0;o<i.length;o++)i[o]=Array(t[0].length);for(var a=Array(t.length),s=0;s<t[0].length;s++){for(o=0;o<t.length;o++)a[o]=t[o][s];for(var u=r(e,a,n),o=0;o<u.length;o++)i[o][s]=u[o]}return i}:r)(e,t,n)},t.conditionNumber=n,t.isNumericallyFullRank=function(e){var t=Math.pow(2,-52);return Math.max(e.r.length,e.r[0].length)*t*n(e)<1}});r("core/math/least-squares",["require","exports","numeric","core/math/distance","./qr"],function(e,t,r,n,i){"use strict";function o(e,t){for(var r=[],n=0;n<t;n++)r.push(e);return r}function a(e,t){for(var r=s(e,t),n=0,i=0,o=r;i<o.length;i++){var a=o[i];n+=a*a}return n/r.length}function s(e,t){return e.apply(void 0,t)}function u(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n].apply(void 0,t);r.push(o)}return r}function c(e,t){for(var r=[],n=0;n<e.length;n++)t[n]&&r.push(e[n]);return r}function l(e,t,r){for(var n=[],i=0,o=0;i<e.length;i++){var a=0;r[i]&&(a=t[o],o+=1),n.push(e[i]+a)}return n}function p(e,t,n,p){var f,d=p.maxIterations,h=p.linearSubset||o(!1,n.length),m=r.not(h),y=c(t,h),g=c(t,m),v=n,b=0,x=.001;r.any(h)&&(f={Jv:O=r.transpose(u(y,v)),F:D=i.qr(O)},T=s(e,v),v=l(v,r.neg(i.qrSolve(D,T,{regularize:!0})),h));for(var _=!1,S=a(e,v);b<d&&!_&&isFinite(S);){var T=s(e,v),w=u(g,v),E=r.transpose(w),M=void 0,C=void 0;C=f?(D=f.F,O=f.Jv,M=r.dot(w,r.sub(T,r.dot(O,i.qrSolve(D,T,{regularize:!0})))),r.dot(w,r.sub(E,r.dot(O,i.qrSolve(D,E,{regularize:!0}))))):(M=r.dot(w,T),r.dot(w,E));for(var I=v,P=!1;b<d&&!_&&!P;){b+=1;var k=r.add(C,r.diag(o(x,g.length)));I=l(v,r.neg(r.solve(k,M,!0)),m),_=r.all(r.eq(I,v));var O,D,N,A=void 0;f&&(A={Jv:O=r.transpose(u(y,I)),F:D=i.qr(O)},N=s(e,I),I=l(I,r.neg(i.qrSolve(D,N,{regularize:!0})),h));var L=a(e,I);(P=L<S)?(v=I,S=L,f=A,x*=.1):(x=Math.max(x,1e-64),x*=2)}}return{solution:v,MSE:S}}Object.defineProperty(t,"__esModule",{value:!0}),t.testOnlyExports=t.optimizeNonLinear=t.optimizeLinear=t.tryRoundingSmallParametersToZero=t.evaluateMeanSquare=void 0,t.evaluateMeanSquare=a,t.tryRoundingSmallParametersToZero=function(e,t){var r=t.solution.map(function(e){return Math.abs(e)<1e-6?0:e}),n=a(e,r);return isFinite(t.MSE)&&!isFinite(t.MSE)||n<t.MSE||t.MSE!==t.MSE+Math.pow(.5,8)*(n-t.MSE)?t:{solution:r,MSE:n}},t.optimizeLinear=function(e,t){for(var n=u(t,d=o(0,t.length)),c=i.qr(r.transpose(n),{mutateInput:!0}),l=0;l<2;l++)var p=s(e,d),f=r.neg(i.qrSolve(c,p,{regularize:!1})),d=r.add(d,f);var h=a(e,d);if(i.isNumericallyFullRank(c))return{solution:d,MSE:h};for(var m=o(0,t.length),l=0;l<2;l++)p=s(e,m),f=r.neg(i.qrSolve(c,p,{regularize:!0})),m=r.add(m,f);var y=a(e,m);return.999*y<=h?{solution:m,MSE:y}:{solution:d,MSE:h}};function f(e){for(var t=[],r=0;r<h.length;r++){for(var n=[],i=0;i<e;i++)n[i]=0===r&&1!==e?0:1===r&&1!==e?1:h[503*(r*e+i)%h.length];t.push(n)}return t}function d(e,t,r,n,i){for(var o=[],a=0,s=r;a<s.length;a++){var u=s[a];o.push({soln:p(e,t,u,i),initialGuess:u})}o.sort(function(e,t){return isNaN(e.soln.MSE)?1:isNaN(t.soln.MSE)?-1:e.soln.MSE-t.soln.MSE});for(var c=[],l=0;l<n;l++)c.push(o[l].initialGuess);return c}var h=[18.9,.105,.0113,.089,4.414,.373,.06,.149,1.84,9.26,5,.7,.2,1.13,2.61,1,.007,30,120,1500,4e-4,7.23,-1,-.0081,-.03,-28.6,-1.71,-.4,-6.94,-.777,-500];var m=[3,5,7,11,13,17,19];function y(e,t){for(var r=[],n=0;n<e.length;n++){for(var i=e[n],o=[],a=0;a<i.length;a++){var s=m[a%m.length]*n%e.length;o.push(function(e,t,r,n){if(!t)return e;if("known"!==t.type)return e;var i=t.bounds;return i[0]===-1/0&&i[1]===1/0?e:i[0]===-1/0?i[1]-Math.exp(-e):i[1]===1/0?i[0]+Math.exp(e):r/(n-1)*i[1]+(n-1-r)/(n-1)*i[0]}(i[a],t[a],s,e.length))}r.push(o)}return r}t.optimizeNonLinear=function(e,t,r){var i=(r=r||{}).linearSubset,o=r.bounds,a=r.preferredInitialGuess,s=f(t.length);o&&(s=y(s,o));var u=d(e,t,s,5,{maxIterations:3,linearSubset:i}),c=p(e,t,d(e,t,u,1,{maxIterations:60,linearSubset:i})[0],{maxIterations:250,linearSubset:i});if(!a)return c;var l=p(e,t,a,{maxIterations:100,linearSubset:i});return isFinite(l.MSE)&&(l.MSE<c.MSE||n.approx(l.MSE,c.MSE,8))?l:c},t.testOnlyExports={generateInitialGuesses:f,mapInitialGuesses:y}});r("core/math/builtinconstants",["require","core/math/parsenode/constant","core/math/maybe-rational"],function(e){"use strict";var t=e("core/math/parsenode/constant"),r=e("core/math/maybe-rational").maybeRational;return{pi:t(Math.PI),tau:t(2*Math.PI),e:t(Math.E),trigAngleMultiplier:t(r(1,1)),infty:t(1/0)}});r("core/math/builtinframe",["require","core/math/builtinconstants","core/math/parsenode/builtinfunction"],function(e){"use strict";var t,r=e("core/math/builtinconstants"),n=e("core/math/parsenode/builtinfunction"),i={};for(t in r)r.hasOwnProperty(t)&&(i[t]=r[t]);for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i});!function(){var e,t,n,i,o,a,s,u,c,l,p,f,d,h,m,y,g,v,b,x,_={};!function(e){var t="object"==typeof _?_:"object"==typeof self?self:"object"==typeof this?this:{};function n(e,r){return e!==t&&("function"==typeof Object.create?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(t,n){return e[t]=r?r(t,n):n}}"function"==typeof r&&r.amd?r("tslib",["exports"],function(r){e(n(t,n(r)))}):"object"==typeof module&&"object"==typeof module.exports?e(n(t,n(module.exports))):e(n(t))}(function(r){var _=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};e=function(e,t){function r(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r},i=function(e,t,r,n){var i,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(a=(o<3?i(a):3<o?i(t,r,a):i(t,r))||a);return 3<o&&a&&Object.defineProperty(t,r,a),a},o=function(e,t){return function(r,n){t(r,n,e)}},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(e,t,r,n){return new(r=r||Promise)(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},u=function(e,t){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},c=function(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])},l=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}},p=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},f=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},d=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n},h=function(e){return this instanceof h?(this.v=e,this):new h(e)},m=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i=[],o={};return a("next"),a("throw"),a("return"),o[Symbol.asyncIterator]=function(){return this},o;function a(e){n[e]&&(o[e]=function(t){return new Promise(function(r,n){1<i.push([e,t,r,n])||s(e,t)})})}function s(e,t){try{(r=n[e](t)).value instanceof h?Promise.resolve(r.value.v).then(u,c):l(i[0][2],r)}catch(e){l(i[0][3],e)}var r}function u(e){s("next",e)}function c(e){s("throw",e)}function l(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}},y=function(e){var t,r={};return n("next"),n("throw",function(e){throw e}),n("return"),r[Symbol.iterator]=function(){return this},r;function n(n,i){r[n]=e[n]?function(r){return(t=!t)?{value:h(e[n](r)),done:"return"===n}:i?i(r):r}:i}},g=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=l(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){var o,a,s,u;t=e[r](t),o=n,a=i,s=t.done,u=t.value,Promise.resolve(u).then(function(e){o({value:e,done:s})},a)})}}},v=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},b=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},x=function(e){return e&&e.__esModule?e:{default:e}},r("__extends",e),r("__assign",t),r("__rest",n),r("__decorate",i),r("__param",o),r("__metadata",a),r("__awaiter",s),r("__generator",u),r("__exportStar",c),r("__values",l),r("__read",p),r("__spread",f),r("__spreadArrays",d),r("__await",h),r("__asyncGenerator",m),r("__asyncDelegator",y),r("__asyncValues",g),r("__makeTemplateObject",v),r("__importStar",b),r("__importDefault",x)})}();r("core/math/reparameterization",["require","exports","core/math/parsenode/constant","core/math/builtinframe","tslib","core/math/distance","core/math/policy"],function(e,t,r,n,i,o,a){"use strict";function s(e,t,r){var i=e.getPolynomialCoefficients(t).map(function(e){return e.getConcreteTree(a.defaultPolicy,n)});return(r-i[0].asValue())/i[1].asValue()}function u(e,t){return e.map(function(e){return t[e]?+t[e].asValue():NaN})}Object.defineProperty(t,"__esModule",{value:!0}),t.solveForOriginalParameters=t.mapInitialGuesses=void 0,t.mapInitialGuesses=function(e,t){var i={};for(var o in e)e[o].isConstant&&(i[o]=e[o]);var s,u,c,l,p,f=t.model;switch(f.type){case"trig":for(var d=[(p=[f.amplitudeNode,f.frequencyNode,f.phaseNode].map(function(e){return+e.substitute(i).getConcreteTree(a.defaultPolicy,n).asValue()}))[0]*Math.cos(p[2]),p[0]*Math.sin(p[2]),p[1]],h=0;h<f.newParameterSymbols.length;h++)i[f.newParameterSymbols[h]]=r(d[h]);break;case"exp":if(f.intercept&&(i[f.intercept.newParameterSymbols[0]]=r(Math.log(f.intercept.sign*f.intercept.node.substitute(i).getConcreteTree(a.defaultPolicy,n).asValue()))),f.base&&(i[f.base.newParameterSymbols[0]]=r(Math.log(+f.base.node.substitute(i).getConcreteTree(a.defaultPolicy,n).asValue()))),f.shiftScale)for(var m=f.shiftScale,y=m.mulNode,g=m.addNode,v=m.newParameterSymbols,b=m.stats,d=(s=[y,g].map(function(e){return+e.substitute(i).getConcreteTree(a.defaultPolicy,n).asValue()}),c=(u=b).range,l=u.midrange,[c*s[0],s[1]+l*s[0]]),h=0;h<v.length;h++)i[v[h]]=r(d[h]);break;default:throw new Error("Unexpected model type "+f.type)}for(var o in i)t.expression.dependsOn(o)||delete i[o];return i},t.solveForOriginalParameters=function(e,t,n){e=i.__assign({},e);var a,c,l,p,f,d,h,m,y,g=t.model;switch(g.type){case"trig":for(var v=(y=u(g.newParameterSymbols,e),[o.hypot(y[0],y[1]),y[2],Math.atan2(y[1],y[0])]),b=[g.amplitudeNode,g.frequencyNode,g.phaseNode],x=0;x<b.length;x++){var _=b[x].substitute(e),S=v[x];e[I=_.getDependencies()[0]]=r(s(_,I,S))}break;case"exp":if(g.shiftScale)for(var T=g.shiftScale,w=T.mulNode,E=T.addNode,M=T.stats,C=T.newParameterSymbols,v=(f=u(C,e),h=(d=M).range,m=d.midrange,[f[0]/h,f[1]-m*f[0]/h]),b=[w,E],x=0;x<b.length;x++){_=b[x].substitute(e),S=v[x];e[I=_.getDependencies()[0]]=r(s(_,I,S))}g.intercept&&(a=g.intercept.node.getDependencies()[0],c=s(g.intercept.node,a,g.intercept.sign*Math.exp(+e[g.intercept.newParameterSymbols[0]].asValue())),e[a]=r(c)),g.base&&(l=g.base.node.getDependencies()[0],p=s(g.base.node,l,Math.exp(+e[g.base.newParameterSymbols[0]].asValue())),e[l]=r(p));break;default:throw new Error("Unimplemented model "+g.type)}for(var I,P={},k=0,O=n;k<O.length;k++){P[I=O[k]]=e[I]}return P}});r("core/math/parsenode/regression",["require","pjs","./base","core/math/distance","core/math/builtin","core/lib/label","core/math/errormsg","./error","./optimizedregression","./list","./functioncall","./identifier","./constant","./freevariable","./expressionTypes","core/math/types","core/math/least-squares","core/math/reparameterization"],function(e){"use strict";var t=e("pjs"),r=e("./base"),n=e("core/math/distance"),i=e("core/math/builtin"),o=e("core/lib/label"),a=e("core/math/errormsg"),s=e("./error"),u=e("./optimizedregression"),c=e("./list"),l=e("./functioncall"),p=e("./identifier"),f=e("./constant"),d=e("./freevariable"),h=e("./expressionTypes"),m=e("core/math/types"),y=e("core/math/least-squares"),g=e("core/math/reparameterization"),v=g.solveForOriginalParameters,b=g.mapInitialGuesses,x=y.optimizeLinear,_=y.optimizeNonLinear,S=y.evaluateMeanSquare,T=h.Subtract;return t(r,function(e,t,r){function h(e,t,r,n){var i=t.getDependencies();for(d=0;d<i.length;d++)if(!e.validRegressionParameter(i[d]))throw a.invalidRegressionParameter(i[d]);var s=t.getCompiledFunction(i).fn;if(i.length){for(var u,c,l=t.findLinearSubset(i),p=l.every(function(e){return e}),f=[],d=0;d<i.length;d++)f.push(t.takeDerivative(i[d]).getCompiledFunction(i).fn);p?(c=y.tryRoundingSmallParametersToZero(s,x(s,f))).isLinear=!0:(u={linearSubset:l,bounds:function(e,t){for(var r=[],n=0;n<e.length;n++)r.push(t.boundDomain(e[n]));return r}(i,t),preferredInitialGuess:function(e,t,r){var n=[];t=t||{},r=r||{};for(var i=0;i<e.length;i++){var a=e[i],s=o.identifierToLatex(a);r[a]&&isFinite(r[a].asValue())?n.push(+r[a].asValue()):t.hasOwnProperty(s)&&isFinite(t[s])?n.push(+t[s].asValue()):n.push(1)}return n}(i,r,n)},(c=y.tryRoundingSmallParametersToZero(s,_(s,f,u))).isLinear=!1)}else c={solution:[],MSE:S(s,[]),isLinear:!0};return c}function g(e,t){for(var r={},n=t.getDependencies(),i=0;i<n.length;i++)r[n[i]]=f(e.solution[i]);return r}function w(e,t){var r=e.length,i=e[0],o=t[0],a=e[r-1],s=t[r-1];if(isFinite(i)&&isFinite(a)&&isFinite(o)&&isFinite(s)&&s-o!=0){var u=a-i;if(0!=u){for(var c=1;c<r-1;c++){var l=e[c],p=t[c],f=(s*(l-i)+o*(a-l))/u;if(!n.approx(p,f,5))return}return 1}}}e.init=function(e,r){t.init.call(this),this._lhs=e,this.isLhsSimple=e instanceof p,this._logLhs=l("ln",[e]),this._rhs=r,this._difference=T([e,r]),this._logDifference=T([l("ln",[e]),l("ln",[r])]),this.mergeDependencies(e,r)},e.isRegression=!0,e.chooseResidualVariable=function(e){if(this.userData&&this.userData.residualVariable){var t=o.latexToIdentifier(this.userData.residualVariable);if(!e[t])return t}for(var r,n=this.getDependencies(),i=0;i<n.length;i++){var a=n[i].match(/_(.*)/);if(a&&!e[r="e_"+a[1]])return r}for(var s=1;;){if(!e[r="e_"+s])return r;s++}},e.getRHSModel=function(e,t,r){for(var n,i,o=this._rhs.getDependencies(),a=0;a<o.length;a++){var s=o[a];if(t[s]&&t[s].tryGetConcreteTree){var u=t[s].tryGetConcreteTree(e,t);if(!u.isError&&u.valueType===m.ListOfNumber){if(void 0!==n){n=void 0;break}0===u.getDependencies().length&&(n=s,i=u)}}}var c=Object.create(t);void 0!==n&&(c[n]=d(this.tmpVar()));var l=this._rhs.tryGetConcreteTree(e,c);return{node:l,substituted:l.isError?l:l.substitute(r),listNode:i,isValid:void 0!==n}},e.computeStatistics=function(e,t,r,o,s,u){if(o.getDependencies().length)throw a.optimizationError();var l=C(e,o);if(!isFinite(l))throw a.optimizationError();if(0<t.getDependencies().length)return{RMSE:Math.sqrt(l)};var p=m.isList(t.valueType)?i.varp(t.asValue()):0;if(t.getDependencies().length||!isFinite(p)||p<=0||!this.isLhsSimple)return{RMSE:Math.sqrt(l)};var f,d,h=1-l/p;if(r.isValid){var y=[],g=[],v=s&&(u===E.LINLOG||u===E.LOGLOG);c.eachArgs(e,[r.listNode,t],function(e){y.push(v?Math.log(e[0].asValue()):+e[0].asValue()),g.push(+e[1].asValue())});var b=i.corr(y,g);if(n.approx((f=y,d=g,x(function(e,t){for(var r=[],n=0;n<f.length;n++)r.push(d[n]-(e*f[n]+t));return r},[function(){return f.map(function(e){return-e})},function(){return f.map(function(){return-1})}],[0,0])).MSE,l,8))return{r:b,rsquared:b*b}}return{Rsquared:h}},e.getResidualSuggestionId=function(e,t){var r,n=this._rhs.getDependencies();for(var i in t)if(t.hasOwnProperty(i)&&t[i].concreteTree.isTable&&t[i].concreteTree.columns[0]){var o=t[i].rawTree.columns;if(o&&o.length){var a=o[0].getExports();if(1===a.length&&-1!==n.indexOf(a[0])){for(var s=1;s<o.length;s++)if(-1!==o[s].getDependencies().indexOf(e))return;r=r||i}}}return r||void 0};var E={NONE:0,LOGLIN:1,LOGLOG:2,LINLOG:3};function M(e,t,r,n){var i=Object.create(r);for(var o in n)n.hasOwnProperty(o)&&(i[o]=n[o]);return c.wrap(t.getConcreteTree(e,i))}function C(e,t){var r=0;return t.eachElement(e,function(e){var t=e.asValue();r+=t*t}),r/t.length}function I(e,t,r,n,i){var o=r.reparameterizeRegression();if(!o||0===o.length)return{parameters:g(p=h(e,r=r.deriveRegressionRestrictions(),n,i),r),isLinear:p.isLinear,parameterWarning:!1};for(var a=r.getDependencies(),s=1/0,u={},c=!1,l=0;l<o.length;l++){var p,f=o[l],d=f.expression;if((p=h(e,d=d.deriveRegressionRestrictions(),b(n,f),b(i,f))).MSE<s){var m=g(p,d),y=v(m,f,a),x=C(e,M(e,r.substitute(y),t,y));if(u&&(!isFinite(x)||s<=x)){isFinite(x)||(c=!0);continue}s=p.MSE,u=y}}return{parameters:u,isLinear:!1,parameterWarning:c}}e.linearizingTransformation=function(e,t,r){if(!this.isLhsSimple)return E.NONE;if(!r.isValid)return E.NONE;var n=r.substituted;if(n.isError)return E.NONE;if(n.valueType!==m.Number)return E.NONE;var i=n.getDependencies();if(1!==i.length)return E.NONE;if(isFinite(r.node.polynomialOrder(i[0])))return E.NONE;var o=n.getCompiledFunction(i).fn,a=r.listNode;if(n.valueType!==m.Number)return E.NONE;var s=a.mapElements(e,function(e){return+e.asValue()});if(s.length<3)return E.NONE;s.sort(function(e,t){return e-t});var u=s.map(o),l=u.map(Math.log),p=s.map(Math.log),f=!0;return c.wrap(t).eachElement(e,function(e){isFinite(Math.log(+e.asValue()))||(f=!1)}),w(s,l)&&f?E.LOGLIN:w(p,l)&&f?E.LOGLOG:w(p,u)?E.LINLOG:E.NONE},e.optimize=function(e,t,r,n,i){var a=this._lhs.getConcreteTree(e,t),s=this._rhs.getConcreteTree(e,t);this.typeCheck(e,[a,s]);var l,p,d,h,m=function(e){var t={};for(var r in e)t[r]=f(e[r]);return t}(this.userData.regressionParameters),y=I(e,t,c.wrap(this._difference.getConcreteTree(e,t)),m,n),g=y.parameters,v=y.isLinear,b=this.getRHSModel(e,t,g),x=M(e,this._difference,t,g),_=this.linearizingTransformation(e,a,b);h=!this.userData.isLogModeRegression||_!==E.LOGLIN&&_!==E.LOGLOG?this.computeStatistics(e,a,b,x,this.userData.isLogModeRegression,_):(l=this._logDifference.getConcreteTree(e,t),p=this._logLhs.getConcreteTree(e,t),g=(y=I(e,t,l,m,n)).parameters,v=y.isLinear,b=this.getRHSModel(e,t,g),x=M(e,this._difference,t,g),d=M(e,this._logDifference,t,g),this.computeStatistics(e,p,b,d,this.userData.isLogModeRegression,_));var S=this.chooseResidualVariable(r),T=this.getResidualSuggestionId(S,i);return this.userData.residualVariable=o.identifierToLatex(S),u(g,x,h,b.substituted,{isModelValid:b.isValid,residualVariable:S,residualSuggestionId:T,shouldSuggestLogMode:_!==E.NONE,isLinear:v,parameterWarning:y.parameterWarning})},e.tryOptimize=function(){try{return this.optimize.apply(this,arguments)}catch(e){return e instanceof s?e:a.parseError()}},e.exportTo=function(e,t,r){if(!t.isError){for(var n in t.parameters)t.parameters.hasOwnProperty(n)&&(e.assignmentForbidden(n)||(r[n]=r[n]?a.multiplyDefined(n):t.parameters[n]));e.assignmentForbidden(t.residualVariable)||(r[t.residualVariable]=t.residuals)}},e.getSliderVariables=function(){return[]}})});r("core/math/parsenode/image",["require","pjs","./base"],function(e){"use strict";return e("pjs")(e("./base"),function(e,t,r,n){e.isImage=!0,e.init=function(e,r){t.init.call(this),this.center=e.center,this.radianAngle=e.radianAngle,this.width=e.width,this.height=e.height,this.opacity=e.opacity,this.moveStrategy=r,this.mergeDependencies(this.center,this.radianAngle,this.width,this.height,this.opacity)}})});r("core/math/parsenode/simulation",["require","pjs","./base"],function(e){"use strict";return e("pjs")(e("./base"),function(e,t,r,n){e.isSimulation=!0,e.init=function(e){t.init.call(this),this.fps=e,this.mergeDependencies(this.fps)}})});r("core/math/parsenode/slider",["require","pjs","./assignment","./identifier"],function(e){"use strict";var t=e("pjs"),r=e("./assignment"),n=e("./identifier");return t(r,function(e,t,i,o){e.isSlider=!0,e.init=function(e,r){t.init.call(this,n(e._symbol),e._expression),this.setInputSpan(e._inputSpan),this.sliderAssignment=e,this.sliderMin=r.sliderMin,this.sliderMax=r.sliderMax,this.sliderSoftMin=r.sliderSoftMin,this.sliderSoftMax=r.sliderSoftMax,this.sliderStep=r.sliderStep,this.sliderIsPlayingOnce=r.sliderIsPlayingOnce,this.sliderMin&&this.mergeDependencies(this.sliderMin),this.sliderMax&&this.mergeDependencies(this.sliderMax),this.sliderStep&&this.mergeDependencies(this.sliderStep)},e.shouldPromoteToSlider=function(e){return!1},e.asAssignment=function(){return r(this._symbol,this._expression)}})});r("core/math/parsenode/table",["require","pjs","./base"],function(e){"use strict";return e("pjs")(e("./base"),function(e,t){e.init=function(e){t.init.call(this),this.columns=e,this._exports=[],this.mergeDependencies.apply(this,e);for(var r=0;r<e.length;r++)Array.prototype.push.apply(this._exports,e[r].getExports())},e.exportPenalty=1,e.isTable=!0,e.exportTo=function(e,t,r){for(var n=0;n<this.columns.length;n++){var i,o=this.columns[n].getExports();o.length&&(i=o[0],e.assignmentForbidden(i)||r[i]||(t.isError?r[i]=t:this.columns[n].exportTo(e,t.columns[n],r)))}},e.getAllIds=function(){return this.columns.map(function(e){return e.header.userData.id})}})});r("core/math/parsenode/tablecolumn",["require","pjs","./base","./list","./constant","./identifier"],function(e){"use strict";var t=e("pjs"),r=e("./base"),n=e("./list"),i=e("./constant"),o=e("./identifier");return t(r,function(e,t){function a(e){return e.isError?i(NaN):e}e.init=function(e,r,n){t.init.call(this),this.header=e,this.length=r,this.values=n,this.isIndependent=!1,this.registerDependencies(),this._exports=this.computeExports()},e.registerDependencies=function(){this.mergeDependencies(this.header),this.mergeDependencies.apply(this,this.values)},e.computeExports=function(){return this.header instanceof o?[this.header._symbol]:[]},e.isDiscrete=function(e){return 1!==this.header.getDependencies().length||1!==e.header.getDependencies().length||this.header.getDependencies()[0]!==e.header.getDependencies()[0]},e._exportSymbolsTo=function(e,t,i){if(e.length){var o=e[0];if(t.isError)i[o]=t;else try{i[o]=n(t.values.map(a))}catch(e){if(!(e instanceof r))throw e;i[o]=e}}},e.exportTo=function(e,t,r){var n=this.getLegalExports(e);this._exportSymbolsTo(n,t,r)},e.exportToLocal=function(e,t){this._exportSymbolsTo(this.getExports(),e,t)}})});r("core/math/parsenode/solvedequation",["require","pjs","./base"],function(e){"use strict";return e("pjs")(e("./base"),function(e,t){e.init=function(e,r){t.init.call(this),this._symbol=e,this._expression=r,this.mergeDependencies(r)},e.getCompiledFunction=function(){return this._expression.getCompiledFunction.apply(this._expression,arguments)},e.getCompiledDerivative=function(){return this._expression.getCompiledDerivative.apply(this._expression,arguments)},e.evaluate=function(){return this._expression.evaluate.apply(this._expression,arguments)}})});r("core/math/parsenode/seed",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){"string"!=typeof e&&(e=""+e),this._stringValue=e,t.init.call(this,[])},e.isString=!0,e.getEvalStrings=function(){return{statements:[],expression:"'"+this.asValue()+"'"}},e.asValue=function(){return this._stringValue}})});r("core/math/parsenode/extendseed",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e,r){t.init.call(this,r),this.seed=r[0],this.userSeed=r[1],this.tag=e},e.getEvalStrings=function(){var e=this.seed.getEvalStrings(),t=this.userSeed.getEvalStrings(),r=[];return Array.prototype.push.apply(r,e.statements),Array.prototype.push.apply(r,t.statements),{statements:r,expression:"("+e.expression+") + '::"+this.tag+"' + ("+t.expression+")"}},e.asValue=function(){return this.seed.asValue()+"::"+this.tag+this.userSeed.asValue()},e.copyWithArgs=function(e){return new this.constructor(this.tag,e)}})});r("core/math/parsenode/rgbcolor",["require","pjs","./scalarexpression"],function(e){"use strict";return e("pjs")(e("./scalarexpression"),function(e,t,r){e.asArray=function(){return[+this.args[0].asValue(),+this.args[1].asValue(),+this.args[2].asValue()]},e.asValue=e.asArray,e.getEvalStrings=function(){for(var e=[],t=[],r=0;r<this.args.length;r++){var n=this.args[r].getEvalStrings(),e=e.concat(n.statements);t.push(n.expression)}return{statements:e,expression:"["+t.join(",")+"]"}}})});r("parsenodes",["require","core/math/parsenode/expressionTypes","core/math/parsenode/base","core/math/parsenode/expression","core/math/parsenode/scalarexpression","core/math/parsenode/error","core/math/parsenode/constant","core/math/parsenode/mixednumber","core/math/parsenode/identifier","core/math/parsenode/ans","core/math/parsenode/freevariable","core/math/parsenode/dummyindex","core/math/parsenode/list","core/math/parsenode/range","core/math/parsenode/broadcast","core/math/parsenode/listaccess","core/math/parsenode/dotaccess","core/math/parsenode/dotaccessexponent","core/math/parsenode/orderedpair","core/math/parsenode/movablepoint","core/math/parsenode/orderedpairaccess","core/math/parsenode/polygon","core/math/parsenode/basecomparator","core/math/parsenode/comparator","core/math/parsenode/doubleinequality","core/math/parsenode/repeatedoperator","core/math/parsenode/sum","core/math/parsenode/product","core/math/parsenode/integral","core/math/parsenode/functioncall","core/math/parsenode/seededfunctioncall","core/math/parsenode/functionexponent","core/math/parsenode/functionfactorial","core/math/parsenode/prime","core/math/parsenode/piecewise","core/math/parsenode/derivative","core/math/parsenode/builtinfunction","core/math/parsenode/nativefunction","core/math/parsenode/typedfunction","core/math/parsenode/reducerfunction","core/math/parsenode/parametrizedreducerfunction","core/math/parsenode/doublereducerfunction","core/math/parsenode/toplevelfunction","core/math/parsenode/distribution","core/math/parsenode/histogram","core/math/parsenode/object3d","core/math/parsenode/dotplot","core/math/parsenode/boxplot","core/math/parsenode/ttest","core/math/parsenode/independent-ttest","core/math/parsenode/stats","core/math/parsenode/assignment","core/math/parsenode/functiondefinition","core/math/parsenode/equation","core/math/parsenode/regression","core/math/parsenode/image","core/math/parsenode/simulation","core/math/parsenode/slider","core/math/parsenode/table","core/math/parsenode/tablecolumn","core/math/parsenode/solvedequation","core/math/parsenode/optimizedregression","core/math/parsenode/seed","core/math/parsenode/extendseed","core/math/parsenode/rgbcolor"],function(e){"use strict";var t=e("core/math/parsenode/expressionTypes"),r={Base:e("core/math/parsenode/base"),Expression:e("core/math/parsenode/expression"),ScalarExpression:e("core/math/parsenode/scalarexpression"),Error:e("core/math/parsenode/error"),Constant:e("core/math/parsenode/constant"),MixedNumber:e("core/math/parsenode/mixednumber"),Identifier:e("core/math/parsenode/identifier"),Ans:e("core/math/parsenode/ans"),FreeVariable:e("core/math/parsenode/freevariable"),DummyIndex:e("core/math/parsenode/dummyindex"),List:e("core/math/parsenode/list"),Range:e("core/math/parsenode/range"),Broadcast:e("core/math/parsenode/broadcast"),ListAccess:e("core/math/parsenode/listaccess"),DotAccess:e("core/math/parsenode/dotaccess"),DotAccessExponent:e("core/math/parsenode/dotaccessexponent"),OrderedPair:e("core/math/parsenode/orderedpair"),MovablePoint:e("core/math/parsenode/movablepoint"),OrderedPairAccess:e("core/math/parsenode/orderedpairaccess"),Polygon:e("core/math/parsenode/polygon"),BaseComparator:e("core/math/parsenode/basecomparator"),Comparator:e("core/math/parsenode/comparator"),DoubleInequality:e("core/math/parsenode/doubleinequality"),RepeatedOperator:e("core/math/parsenode/repeatedoperator"),Sum:e("core/math/parsenode/sum"),Product:e("core/math/parsenode/product"),Integral:e("core/math/parsenode/integral"),FunctionCall:e("core/math/parsenode/functioncall"),SeededFunctionCall:e("core/math/parsenode/seededfunctioncall"),FunctionExponent:e("core/math/parsenode/functionexponent"),FunctionFactorial:e("core/math/parsenode/functionfactorial"),Prime:e("core/math/parsenode/prime"),Piecewise:e("core/math/parsenode/piecewise"),Derivative:e("core/math/parsenode/derivative"),BuiltInFunction:e("core/math/parsenode/builtinfunction"),NativeFunction:e("core/math/parsenode/nativefunction"),TypedFunction:e("core/math/parsenode/typedfunction"),ReducerFunction:e("core/math/parsenode/reducerfunction"),ParametrizedReducerFunction:e("core/math/parsenode/parametrizedreducerfunction"),DoubleReducerFunction:e("core/math/parsenode/doublereducerfunction"),TopLevelFunction:e("core/math/parsenode/toplevelfunction"),Distribution:e("core/math/parsenode/distribution"),Histogram:e("core/math/parsenode/histogram"),Object3D:e("core/math/parsenode/object3d"),DotPlot:e("core/math/parsenode/dotplot"),BoxPlot:e("core/math/parsenode/boxplot"),TTest:e("core/math/parsenode/ttest"),IndependentTTest:e("core/math/parsenode/independent-ttest"),Stats:e("core/math/parsenode/stats"),Assignment:e("core/math/parsenode/assignment"),FunctionDefinition:e("core/math/parsenode/functiondefinition"),Equation:e("core/math/parsenode/equation"),Regression:e("core/math/parsenode/regression"),Image:e("core/math/parsenode/image"),Simulation:e("core/math/parsenode/simulation"),Slider:e("core/math/parsenode/slider"),Table:e("core/math/parsenode/table"),TableColumn:e("core/math/parsenode/tablecolumn"),SolvedEquation:e("core/math/parsenode/solvedequation"),OptimizedRegression:e("core/math/parsenode/optimizedregression"),Seed:e("core/math/parsenode/seed"),ExtendSeed:e("core/math/parsenode/extendseed"),RGBColor:e("core/math/parsenode/rgbcolor")};for(var n in t)r[n]=t[n];for(var i in r)r.hasOwnProperty(i)&&"Comparator"!==i&&"BuiltInFunction"!==i&&(r[i].prototype.type=i);for(var o in r.Comparator)r.Comparator.hasOwnProperty(o)&&(r.Comparator[o].prototype.type="Comparator['"+o+"']");for(var a in r.BuiltInFunction)r.BuiltInFunction.hasOwnProperty(a)&&(r.BuiltInFunction[a].prototype.type="BuiltInFunction['"+a+"']");return r});r("core/math/parser/char-codes",["require","exports"],function(e,t){"use strict";function r(e){return 97<=e&&e<=122}function n(e){return 65<=e&&e<=90}Object.defineProperty(t,"__esModule",{value:!0}),t.isWhitespace=t.isSingleQuote=t.isDot=t.isBackslash=t.isLetter=t.isUpperCaseLetter=t.isLowerCaseLetter=t.isDigit=void 0,t.isDigit=function(e){return 48<=e&&e<=57},t.isLowerCaseLetter=r,t.isUpperCaseLetter=n,t.isLetter=function(e){return r(e)||n(e)},t.isBackslash=function(e){return 92===e},t.isDot=function(e){return 46===e},t.isSingleQuote=function(e){return 39===e},t.isWhitespace=function(e){if(9<=e&&e<=13)return!0;if(8192<=e&&e<=8202)return!0;switch(e){case 32:case 160:case 5760:case 8232:case 8233:case 8239:case 8287:case 12288:case 65279:return!0;default:return!1}}});r("core/math/parser/latex-lexer",["require","exports","./char-codes","./input-span"],function(e,t,r,n){"use strict";function i(e,t,r){return{type:e,span:t,val:r}}function o(e,t,o){for(;r.isWhitespace(e.charCodeAt(t));)t+=1;return{input:e,prevSpan:o,pos:t,token:function(e,t){var o=t;if(t>=e.length)return i("End",n.emptySpanAt(e,t),"");var a=e.charCodeAt(t);{if(r.isDigit(a))return i("Digit",s=n.Span(e,o,t+1),e.charAt(o));if(r.isLetter(a))return i("Letter",s=n.Span(e,o,t+1),e.charAt(o));if(r.isBackslash(a)){if(t+=1,r.isLetter(e.charCodeAt(t))){for(;r.isLetter(e.charCodeAt(t));)t+=1;var s=n.Span(e,o,t),l=n.slice(s);return i(u[l]||"Cmd",s,l)}t+=1;s=n.Span(e,o,t),l=n.slice(s);return i("EscapedSymbol",s,l)}if(r.isSingleQuote(a)){for(t+=1;r.isSingleQuote(e.charCodeAt(t));)t+=1;if("^"===e.charAt(t)){t+=1;s=n.Span(e,o,t),l=n.slice(s);return i("Primes^",s,l)}s=n.Span(e,o,t),l=n.slice(s);return i("Primes",s,l)}s=n.Span(e,o,t+1),l=e.charAt(o);return i(c[l]||"Symbol",s,l)}}(e,t)}}function a(e){return o(e.input,e.token.span.end,e.token.span)}function s(e){return e.token}Object.defineProperty(t,"__esModule",{value:!0}),t.isDone=t.isAt=t.eat=t.peek=t.advance=t.lex=t.LatexToken=t.spanStates=void 0,t.spanStates=function(e,t){return n.joinSpans(e.token.span,t.prevSpan)},t.LatexToken=i,t.lex=function(e){return o(e,0,n.emptySpanAt(e,0))},t.advance=a,t.peek=s,t.eat=function(e,t){if(s(e).type!==t)throw"Parse Error: expected "+t+".";return a(e)},t.isAt=function(e,t){return s(e).type===t},t.isDone=function(e){return e.pos>=e.input.length};var u={"\\left":"Left","\\right":"Right","\\sqrt":"Sqrt","\\frac":"Frac","\\operatorname":"OperatorName"},c={"[":"[","]":"]","{":"{","}":"}","^":"^",_:"_"}});r("core/math/parser/latex-node",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Symbol=t.OperatorName=t.LeftRight=t.SupSub=t.Frac=t.Sqrt=t.Group=void 0,t.Group=function(e,t){return{type:"Group",span:e,args:t}},t.Sqrt=function(e,t,r){return{type:"Sqrt",span:e,optArg:t,arg:r}},t.Frac=function(e,t,r){return{type:"Frac",span:e,num:t,den:r}},t.SupSub=function(e,t,r,n){return{type:"SupSub",span:e,sup:t,sub:r,nprimes:n}},t.LeftRight=function(e,t,r,n){return{type:"LeftRight",span:e,left:t,right:r,arg:n}},t.OperatorName=function(e,t){return{type:"OperatorName",span:e,arg:t}},t.Symbol=function(e,t){return{type:"Symbol",span:e,val:t}}});r("core/math/parser/latex-parser",["require","exports","./latex-lexer","./input-span","./latex-node"],function(e,t,r,n,i){"use strict";function o(e){switch(e){case"Frac":return 2;case"^":case"_":case"Primes^":case"Left":case"Frac":case"Sqrt":case"OperatorName":return 1;default:return 0}}function a(e,t){return{state:e,tree:t}}function s(e,t){var n=e,o=[];e:for(;!r.isDone(e);){var s=r.peek(e);switch(s.type){case"Cmd":case"EscapedSymbol":case"Letter":case"Digit":case"Symbol":case"[":case"{":case"^":case"_":case"Primes":case"Primes^":case"Left":case"Frac":case"Sqrt":case"OperatorName":case"]":if("]"===s.type&&t)break e;var c,l;if(e=(l=u(e)).state,"Group"===(c=l.tree).type)for(var p=0,f=c.args;p<f.length;p++){var d=f[p];o.push(d)}else o.push(c);break;case"}":case"Right":case"End":break e;default:throw"Unexpected token type "+s.type+"."}}var h=r.spanStates(n,e);return a(e,i.Group(h,o))}function u(e){var t=r.peek(e);switch(t.type){case"Cmd":case"EscapedSymbol":case"Letter":case"Digit":case"Symbol":return a(e=r.advance(e),t);case"[":case"]":return a(e=r.advance(e),i.Symbol(t.span,t.val));case"{":var n,o;return e=(o=s(e=r.advance(e),!1)).state,n=o.tree,a(e=r.eat(e,"}"),n);case"^":case"_":case"Primes":case"Primes^":return function(e){var t,n,o,s,u,l=e,p=0;e:for(;!r.isDone(e);){var f=r.peek(e);switch(f.type){case"^":if(e=r.advance(e),s)throw"Parse Error: double superscript.";t=c(e,f),e=t.state,s=t.tree;break;case"_":if(e=r.advance(e),u)throw"Parse Error: double subscript.";n=c(e,f),e=n.state,u=n.tree;break;case"Primes":if(e=r.advance(e),0<p)throw"Parse Error: double primes.";p=f.val.length;break;case"Primes^":if(e=r.advance(e),0<p)throw"Parse Error: double primes.";if(s)throw"Parse Error: double superscript";p=f.val.length-1,o=c(e,f),e=o.state,s=o.tree;break;default:break e}}var d=r.spanStates(l,e);return a(e,i.SupSub(d,s,u,p))}(e);case"Left":return function(e){var t,n=e;e=r.eat(e,"Left");var o,u=r.peek(e);e=r.advance(e),t=s(e,!1),e=t.state,o=t.tree,e=r.eat(e,"Right");var c=r.peek(e);e=r.advance(e);var l=r.spanStates(n,e);return a(e,i.LeftRight(l,u,c,o))}(e);case"Frac":return function(e){var t,n,o,s,u=e,l=r.peek(e);e=r.eat(e,"Frac"),t=c(e,l),e=t.state,o=t.tree,n=c(e,l),e=n.state,s=n.tree;var p=r.spanStates(u,e);return a(e,i.Frac(p,o,s))}(e);case"Sqrt":return function(e){var t,n,o,u,l=e,p=r.peek(e);e=r.eat(e,"Sqrt"),r.isAt(e,"[")&&(t=function(e){var t,n;return e=r.eat(e,"["),t=s(e,!0),e=t.state,n=t.tree,a(e=r.eat(e,"]"),n)}(e),e=t.state,o=t.tree);n=c(e,p),e=n.state,u=n.tree;var f=r.spanStates(l,e);return a(e,i.Sqrt(f,o,u))}(e);case"OperatorName":return function(e){var t,n,o=e,s=r.peek(e);e=r.eat(e,"OperatorName"),t=c(e,s),e=t.state,n=t.tree;var u=r.spanStates(o,e);return a(e,i.OperatorName(u,n))}(e);case"}":case"Right":throw"Parse Error: unexpected "+t.val+".";case"End":throw"Parse Error: unexpected end.";default:throw"Unexpected token type "+t.type+"."}}function c(e,t){var s,c,l=o(t.type);if(l<=0)throw new Error("Programming Error: greediness must be greater than 0.");var p=o(r.peek(e).type);if(0<p&&p<=l){var f=n.slice(t.span);throw"Parse Error: can't use "+n.slice(r.peek(e).span)+" as argument of "+f+". Use {}."}return e=(s=u(e)).state,"Group"!==(c=s.tree).type&&(c=i.Group(c.span,[c])),a(e,c)}Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0,t.parse=function(e){var t=s(r.lex(e),!1),i=t.state,o=t.tree;if(!r.isDone(i))throw"Parse error: unexpected "+n.slice(r.peek(i).span)+".";return o}});r("core/math/parser/command-aliases",["require","exports","./char-codes"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.translateCmd=void 0;var n={mcd:"gcd",gcf:"gcd",mcm:"lcm",signum:"sign",stdDevP:"stdevp",stddevp:"stdevp",stdDev:"stdev",stddev:"stdev",variance:"var",TTest:"ttest",TScore:"tscore",IndependentTTest:"ittest",iTTest:"ittest",inverseCdf:"quantile",inversecdf:"quantile",arsinh:"arcsinh",arcosh:"arccosh",artanh:"arctanh",arcsch:"arccsch",arsech:"arcsech",arcoth:"arccoth"};t.translateCmd=function(e){for(var t=0;r.isBackslash(e.charCodeAt(t));)t+=1;return 0<t&&(e=e.slice(t)),n[e]||e}});r("core/math/parser/surface-node",["require","exports","./command-aliases"],function(e,t,r){"use strict";function n(e){if("Subscript"===e.type){if("Alphanumeric"!==e.args[1].type)return!1;e=e.args[0]}switch(e.type){case"Cmd":case"Letter":return!0;default:return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.unwrapSeq=t.isDerivative=t.isSuperscriptedIdentifier=t.isIdentifier=t.MixedNumber=t.Alphanumeric=t.Cmd=t.Decimal=t.Letter=t.Juxt=t.PercentOf=t.Dot=t.Ellipsis=t.Colon=t.EmptyRangeEnd=t.EmptyPiecewise=t.Piecewise=t.Product=t.Sum=t.EmptyIntegral=t.Integral=t.Derivative=t.Frac=t.Nthroot=t.Sqrt=t.Seq=t.Prime=t.Superscript=t.Subscript=t.Pipes=t.List=t.Paren=t.Index=t.ImplicitCall=t.Call=t.Bang=t.Div=t.Mul=t.Sub=t.Add=t.Neg=t.Pos=t.Tilde=t.InequalityChain=t.TrailingInequalityPiece=t.Inequality=t.Equals=void 0,t.Equals=function(e,t){return{type:"Equals",span:e,args:t}},t.Inequality=function(e,t,r){return{type:"Inequality",span:e,symbol:t,args:r}},t.TrailingInequalityPiece=function(e,t,r){return{type:"TrailingInequalityPiece",span:e,symbol:t,args:r}},t.InequalityChain=function(e,t,r){return{type:"InequalityChain",span:e,first:t,chain:r}},t.Tilde=function(e,t){return{type:"Tilde",span:e,args:t}},t.Pos=function(e,t){return{type:"Pos",span:e,args:t}},t.Neg=function(e,t){return{type:"Neg",span:e,args:t}},t.Add=function(e,t){return{type:"Add",span:e,args:t}},t.Sub=function(e,t){return{type:"Sub",span:e,args:t}},t.Mul=function(e,t){return{type:"Mul",span:e,args:t}},t.Div=function(e,t){return{type:"Div",span:e,args:t}},t.Bang=function(e,t){return{type:"Bang",span:e,args:t}},t.Call=function(e,t){return{type:"Call",span:e,args:t}},t.ImplicitCall=function(e,t){return{type:"ImplicitCall",span:e,args:t}},t.Index=function(e,t){return{type:"Index",span:e,args:t}},t.Paren=function(e,t){return{type:"Paren",span:e,args:t}},t.List=function(e,t){return{type:"List",span:e,args:t}},t.Pipes=function(e,t){return{type:"Pipes",span:e,args:t}},t.Subscript=function(e,t){return{type:"Subscript",span:e,args:t}},t.Superscript=function(e,t){return{type:"Superscript",span:e,args:t}},t.Prime=function(e,t,r){return{type:"Prime",span:e,nprimes:t,args:r}},t.Seq=function(e,t){return{type:"Seq",span:e,args:t}},t.Sqrt=function(e,t){return{type:"Sqrt",span:e,args:t}},t.Nthroot=function(e,t){return{type:"Nthroot",span:e,args:t}},t.Frac=function(e,t){return{type:"Frac",span:e,args:t}},t.Derivative=function(e,t){return{type:"Derivative",span:e,args:t}},t.Integral=function(e,t){return{type:"Integral",span:e,args:t}},t.EmptyIntegral=function(e,t){return{type:"EmptyIntegral",span:e,args:t}},t.Sum=function(e,t){return{type:"Sum",span:e,args:t}},t.Product=function(e,t){return{type:"Product",span:e,args:t}},t.Piecewise=function(e,t){return{type:"Piecewise",span:e,args:t}},t.EmptyPiecewise=function(e){return{type:"EmptyPiecewise",span:e}},t.EmptyRangeEnd=function(e){return{type:"EmptyRangeEnd",span:e}},t.Colon=function(e,t){return{type:"Colon",span:e,args:t}},t.Ellipsis=function(e,t){return{type:"Ellipsis",span:e,args:t}},t.Dot=function(e,t){return{type:"Dot",span:e,args:t}},t.PercentOf=function(e,t){return{type:"PercentOf",span:e,args:t}},t.Juxt=function(e,t){return{type:"Juxt",span:e,args:t}},t.Letter=function(e,t){return{type:"Letter",span:e,val:t}},t.Decimal=function(e,t){return{type:"Decimal",span:e,val:t}},t.Cmd=function(e,t){return{type:"Cmd",span:e,val:r.translateCmd(t)}},t.Alphanumeric=function(e,t){return{type:"Alphanumeric",span:e,val:t}},t.MixedNumber=function(e,t,r,n){return{type:"MixedNumber",span:e,whole:t,num:r,den:n}},t.isIdentifier=n,t.isSuperscriptedIdentifier=function(e){return"Superscript"===e.type&&n(e.args[0])},t.isDerivative=function(e,t){if("Letter"!==e.type||"d"!==e.val)return!1;if("Juxt"!==t.type)return!1;var r=t.args,i=r[0],o=r[1];return"Letter"===i.type&&"d"===i.val&&n(o)},t.unwrapSeq=function(e){return"Seq"===e.type?e.args:[e]}});r("core/math/parser/surface-node-error",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdjacentNumbers=t.FractionEmpty=t.FractionMissingDenominator=t.FractionMissingNumerator=t.DifferentialWithSuperscript=t.IntegralMissingDifferential=t.DerivativeMissingBody=t.IntegralMissingBody=t.ProductMissingBody=t.SumMissingBody=t.IntegralMissingBound=t.MissingBound=t.ProductMissingBound=t.SumMissingBound=t.UnexpectedPrime=t.SuperscriptWithPrime=t.PrimeWithoutParen=t.PercentMissingOf=t.FunctionMissingArgument=t.UnexpectedSubscript=t.InvalidSubscript=t.InvalidOperatorName=t.UnrecognizedSymbol=t.UnexpectedDifferential=t.UnexpectedCloseDelimiter=t.MissingCloseDelimiter=t.UnaryOperatorMissingLeft=t.UnaryOperatorMissingRight=t.BinaryOperatorMissingLeft=t.BinaryOperatorMissingRight=t.UnexpectedEnd=t.EmptyRadicalIndex=t.EmptyPipe=t.EmptySquareBracket=t.EmptyRadical=t.EmptySuperscript=t.EmptySubscript=t.EmptyGroup=t.EmptyInput=t.UnexpectedParseError=t.Err=void 0,t.Err=function(e,t){return{type:"Err",span:e,error:t}},t.UnexpectedParseError=function(){return{type:"UnexpectedParseError"}},t.EmptyInput=function(){return{type:"EmptyInput"}},t.EmptyGroup=function(){return{type:"EmptyGroup"}},t.EmptySubscript=function(){return{type:"EmptySubscript"}},t.EmptySuperscript=function(){return{type:"EmptySuperscript"}},t.EmptyRadical=function(){return{type:"EmptyRadical"}},t.EmptySquareBracket=function(){return{type:"EmptySquareBracket"}},t.EmptyPipe=function(){return{type:"EmptyPipe"}},t.EmptyRadicalIndex=function(){return{type:"EmptyRadicalIndex"}},t.UnexpectedEnd=function(){return{type:"UnexpectedEnd"}},t.BinaryOperatorMissingRight=function(e){return{type:"BinaryOperatorMissingRight",val:e}},t.BinaryOperatorMissingLeft=function(e){return{type:"BinaryOperatorMissingLeft",val:e}},t.UnaryOperatorMissingRight=function(e){return{type:"UnaryOperatorMissingRight",val:e}},t.UnaryOperatorMissingLeft=function(e){return{type:"UnaryOperatorMissingLeft",val:e}},t.MissingCloseDelimiter=function(e,t){return{type:"MissingCloseDelimiter",open:e,close:t}},t.UnexpectedCloseDelimiter=function(e,t){return{type:"UnexpectedCloseDelimiter",open:e,close:t}},t.UnexpectedDifferential=function(){return{type:"UnexpectedDifferential"}},t.UnrecognizedSymbol=function(e){return{type:"UnrecognizedSymbol",val:e}},t.InvalidOperatorName=function(e){return{type:"InvalidOperatorName",val:e}},t.InvalidSubscript=function(e){return{type:"InvalidSubscript",val:e}},t.UnexpectedSubscript=function(e){return{type:"UnexpectedSubscript",base:e}},t.FunctionMissingArgument=function(e){return{type:"FunctionMissingArgument",val:e}},t.PercentMissingOf=function(){return{type:"PercentMissingOf"}},t.PrimeWithoutParen=function(){return{type:"PrimeWithoutParen"}},t.SuperscriptWithPrime=function(){return{type:"SuperscriptWithPrime"}},t.UnexpectedPrime=function(){return{type:"UnexpectedPrime"}},t.SumMissingBound=function(){return{type:"SumMissingBound"}},t.ProductMissingBound=function(){return{type:"ProductMissingBound"}},t.MissingBound=function(){return{type:"MissingBound"}},t.IntegralMissingBound=function(){return{type:"IntegralMissingBound"}},t.SumMissingBody=function(){return{type:"SumMissingBody"}},t.ProductMissingBody=function(){return{type:"ProductMissingBody"}},t.IntegralMissingBody=function(){return{type:"IntegralMissingBody"}},t.DerivativeMissingBody=function(){return{type:"DerivativeMissingBody"}},t.IntegralMissingDifferential=function(){return{type:"IntegralMissingDifferential"}},t.DifferentialWithSuperscript=function(){return{type:"DifferentialWithSuperscript"}},t.FractionMissingNumerator=function(){return{type:"FractionMissingNumerator"}},t.FractionMissingDenominator=function(){return{type:"FractionMissingDenominator"}},t.FractionEmpty=function(){return{type:"FractionEmpty"}},t.AdjacentNumbers=function(e){return{type:"AdjacentNumbers",args:e}}});r("core/math/parser/expression-token-tables",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allTokenTypes=t.rightTable=t.leftTable=t.escapedSymbolTable=t.symbolTable=t.commandTable=void 0;t.commandTable={"\\lt":"<","\\gt":">","\\le":"<=","\\ge":">=","\\leq":"<=","\\geq":">=","\\ldots":"...","\\sim":"~","\\cdot":"*","\\times":"*","\\div":"/","\\ln":"Ln","\\log":"Log","\\int":"Int","\\sum":"Sum","\\prod":"Prod","\\backslash":"Err"};for(var r=0,n=["sin","cos","tan","cot","sec","csc"];r<n.length;r++){var i=n[r];t.commandTable["\\"+i]="Trig",t.commandTable["\\"+i+"h"]="Trig",t.commandTable["\\arc"+i]="Trig",t.commandTable["\\arc"+i+"h"]="Trig",t.commandTable["\\ar"+i+"h"]="Trig"}t.symbolTable={"+":"+","-":"-","*":"*","/":"/","!":"!","(":"(",")":")","[":"[","]":"]",",":",","...":"...",":":":","=":"=",">=":">=","<=":"<=",">":">","<":"<","~":"~",".":"."},t.escapedSymbolTable={"\\{":"\\{","\\}":"\\}","\\%":"%"},t.leftTable={"|":"(|","\\{":"\\{","[":"[","(":"("},t.rightTable={"|":"|)","\\}":"\\}","]":"]",")":")"},t.allTokenTypes=Object.keys({"+":!0,"-":!0,"*":!0,"/":!0,"!":!0,"(":!0,")":!0,"\\{":!0,"\\}":!0,"(|":!0,"|)":!0,"[":!0,"]":!0,",":!0,"...":!0,":":!0,"=":!0,">":!0,"<":!0,">=":!0,"<=":!0,"~":!0,"%":!0,".":!0,Letter:!0,Decimal:!0,Cmd:!0,Differential:!0,End:!0,Trig:!0,Ln:!0,Log:!0,Int:!0,Sum:!0,Prod:!0,Err:!0})});r("core/math/parser/expression-lexer",["require","exports","./expression-token-tables","./input-span","./input-span","./surface-node"],function(e,t,r,n,i,o){"use strict";function a(e,t,r,n,i,o,a,s){return{opts:e,input:t,prevSpan:r,startIndex:n,endIndex:i,token:o,mode:a,parent:s}}function s(e,t,r){return{type:e,span:t,val:r}}function u(e,t,i,o,u,l){var y=t.args;if(i>y.length&&l)return c(l,o);var b=function e(t,i,o){var a=t.args;if(i>=a.length){var u=n.emptySpanAt(t.span.input,t.span.end);return d(i,s("End",u,""))}var c=t.args[i];switch(c.type){case"Sqrt":case"Frac":case"SupSub":return d(i,c);case"Letter":if(!o||"integral"!==o.type)return d(i,c);if("d"!=c.val)return d(i,c);var l=e(t,i+1,o),p=l.endIndex,f=l.token;if("Letter"!==f.type&&"Cmd"!==f.type)return d(i,c);var y={type:"Differential",span:n.joinSpans(c.span,f.span),val:f.val};return d(p,y);case"LeftRight":var g=c.left,b=r.leftTable[g.val]||"Err",x=n.joinSpans(c.span,g.span);return d(i,s(b,x,g.val));case"OperatorName":for(var _=[],S=0,T=c.arg.args;S<T.length;S++){var w=T[S];if("Letter"!==w.type)return d(i,s("Err",c.span,n.slice(c.arg.span)));_.push(w.val)}var E="\\"+_.join(""),M=r.commandTable[E]||"Cmd";return d(i,s(M,c.span,E));case"Cmd":var C=r.commandTable[c.val]||"Cmd";return d(i,s(C,c.span,c.val));case"EscapedSymbol":var I=r.escapedSymbolTable[c.val]||"Err";return d(i,s(I,c.span,c.val));case"Symbol":if(v(c))return h(t,i);var P=r.symbolTable[c.val]||"Err";return d(i,s(P,c.span,c.val));case"Digit":return m(t,i);default:var k=c;throw"Unexpected atom "+k.type+"."}}(t,i=g(y,i),u),x=b.token,_=b.endIndex;if("End"===x.type&&l){var S=l.input.args[l.startIndex];if("LeftRight"===S.type){var T=S.right;return a(e,t,o,i,_,s(r.rightTable[T.val]||"Err",T.span,T.val),u,l)}}else"Int"===x.type?u=p(u):"Differential"===x.type&&(u=f(u));return a(e,t,o,i,_,x,u,l)}function c(e,t){var r=e.input,n=e.endIndex,i=e.mode,o=e.parent;return u(e.opts,r,n+1,t,i,o)}function l(e){return e.token}function p(e){return{type:"integral",parent:e}}function f(e){if(!e||"integral"!==e.type)throw new Error("Programming Error: expected lexer to be in integral mode.");return e.parent}function d(e,t){return{token:t,endIndex:e}}function h(e,t){var i=e.args[t];if("Symbol"!==i.type||"."!==i.val)throw new Error("Programming Error: expected '.'");if(t+2<e.args.length&&v(e.args[t+1])&&v(e.args[t+2])){var o=n.joinSpans(i.span,e.args[t+2].span);return d(t+2,s("...",o,n.slice(o)))}var a=g(e.args,t+1);return a<e.args.length&&"Digit"===e.args[a].type?m(e,t):d(t,s(r.symbolTable[i.val]||"Err",i.span,i.val))}function m(e,t){var r=function(e,t){for(var r=e.args,i=r[t].span,a=[];t<r.length;t++){var s=g(r,t);if(s>=r.length)break;if("Digit"!==(v=r[s]).type)break;t=s,a.push(v.val)}if((t=g(r,t))>=r.length)return;var u=r[t];if("Frac"!==u.type)return;for(var c=[],l=[],p=0,f=u.num.args;p<f.length;p++){if(!y(v=f[p])){if("Digit"!==v.type)return;c.push(v.val)}}for(var h=0,m=u.den.args;h<m.length;h++){var v;if(!y(v=m[h])){if("Digit"!==v.type)return;l.push(v.val)}}var b=n.joinSpans(i,u.span);return d(t,o.MixedNumber(b,a.join(""),c.join(""),l.join("")))}(e,t);if(r)return r;for(var i=e.args,a=e.args[t].span,u=[],c=!1,l=!1;t<i.length;t++){var p=g(i,t);if(p>=i.length)break;var f=i[p];if("Digit"===f.type)t=p,c=!0,u.push(f.val);else{if(l||!v(f))break;if(p+1<i.length&&v(e.args[p+1]))break;t=p,l=!0,u.push(".")}}if(!c)throw new Error("Programming Error: decimals must have at least one digit.");return d(t-1,s("Decimal",n.joinSpans(a,e.args[t-1].span),u.join("")))}function y(e){switch(e.type){case"Sqrt":case"Frac":case"SupSub":case"LeftRight":case"OperatorName":case"Symbol":case"Letter":case"Digit":return;case"Cmd":return"\\space"===e.val;case"EscapedSymbol":return"\\ "===e.val||"\\:"===e.val||"\\,"===e.val||"\\;"===e.val;default:throw"Unexpected atom "+e.type+"."}}function g(e,t){for(;t<e.length&&y(e[t]);)t+=1;return t}function v(e){return"Symbol"===e.type&&"."===e.val}Object.defineProperty(t,"__esModule",{value:!0}),t.didAdvance=t.isDone=t.isAt=t.endIntegral=t.beginIntegral=t.peek=t.advance=t.lexAt=t.lex=t.emptySpanAtState=t.joinState=t.spanStates=t.Span=void 0,Object.defineProperty(t,"Span",{enumerable:!0,get:function(){return i.Span}}),t.spanStates=function(e,t){return n.joinSpans(e.token.span,t.prevSpan)},t.joinState=function(e,t){return n.joinSpans(e,t.prevSpan)},t.emptySpanAtState=function(e){return n.emptySpanAt(e.token.span.input,e.token.span.start)},t.lex=function(e,t){return u(t,e,0,n.emptySpanAt(e.span.input,e.span.start),void 0,void 0)},t.lexAt=u,t.advance=function(e){var t=e.input.args[e.startIndex],r=e.token.span;return t&&"LeftRight"===t.type?u(e.opts,t.arg,0,r,e.mode,e):c(e,r)},t.peek=l,t.beginIntegral=p,t.endIntegral=f,t.isAt=function(e,t){return l(e).type===t},t.isDone=function(e){return e.startIndex>=e.input.args.length},t.didAdvance=function(e,t){return t.token.span.start>e.token.span.start}});r("core/math/parser/precspec",["require","exports","./expression-token-tables"],function(e,t,r){"use strict";function n(e,t){for(var n=0,i=r.allTokenTypes;n<i.length;n++){var o=i[n];if(void 0===t[o])throw new Error("Programming Error: token "+o+" must be a assigned a "+e+" precedence")}}function i(e,t,r,n){if(void 0!==t[r])throw new Error("Programming Error: duplicate "+e+" entry for token "+r+".");t[r]=n}Object.defineProperty(t,"__esModule",{value:!0}),t.precSpec=t.ra=t.la=t.r=t.l=t.initial=void 0,t.initial=function(e){return{type:"initial",tokenType:e}},t.l=function(e){return{type:"l",tokenType:e}},t.r=function(e){return{type:"r",tokenType:e}},t.la=function(e){return{type:"la",tokenType:e}},t.ra=function(e){return{type:"ra",tokenType:e}},t.precSpec=function(e){for(var t={},r={},o={},a=0;a<e.length;a++)for(var s=0,u=e[a];s<u.length;s++){var c=u[s],l=c.type,p=c.tokenType;switch(l){case"initial":i("initial",t,p,a);break;case"l":i("left",r,p,a);break;case"r":i("right",o,p,a);break;case"la":i("left",r,p,a),i("right",o,p,a);break;case"ra":i("left",r,p,a),i("right",o,p,a-1)}}function f(e){return o[e]}return n("left",r),n("right",o),{rightPrec:f,leftPrec:function(e){return r[e]},initialPrec:function(e){var r=t[e];return void 0===r?f(e):r}}}});r("core/math/parser/expression-parser",["require","exports","tslib","./surface-node","./surface-node-error","./input-span","./expression-lexer","./precspec"],function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;var u=[[s.initial("("),s.la(")"),s.initial("\\{"),s.la("\\}"),s.r("["),s.la("]"),s.initial("(|"),s.la("|)"),s.la("Differential"),s.la("End")],[s.ra("...")],[s.la(",")],[s.ra(":")],[s.la("="),s.la(">"),s.la("<"),s.la(">="),s.la("<="),s.la("~")],[s.la("+"),s.la("-")],[s.la("*"),s.la("/"),s.la("Decimal"),s.la("MixedNumber"),s.la("Letter"),s.la("Cmd"),s.la("%"),s.r("("),s.la("\\{"),s.la("(|"),s.la("Frac"),s.la("Sqrt"),s.la("Trig"),s.la("Ln"),s.la("Log"),s.ra("Int"),s.ra("Sum"),s.ra("Prod")],[s.initial("+"),s.initial("-")],[s.la("!")],[s.la("SupSub")],[s.l("["),s.la(".")],[s.l("(")],[s.la("Err")]],c=s.precSpec(u),l=c.leftPrec,p=c.rightPrec,f=c.initialPrec,d={trailingComma:!1};function h(e,t){var r=a.lex(e,t);if(a.isDone(r))return i.Err(a.spanStates(r,r),i.EmptyGroup());var n=y(r,0),o=n.state,s=n.tree;return"Err"===s.type||a.isDone(o)?s:M(o).tree}function m(e,t){return{state:e,tree:t}}function y(e,t){var r,o,s=e,u=function(e){var t,r,o,s,u,c,p,d,v,x,C,I,P,k,O,D,N,A,L,F=e,R=a.peek(e),q=f(R.type);switch(R.type){case"+":if(e=a.advance(e),t=y(e,q),e=t.state,"Err"!==(L=t.tree).type)return m(e,n.Pos(a.spanStates(F,e),[L]));if(!g(L.error))return m(e,L);var V=a.spanStates(F,e),z=i.Err(V,i.UnaryOperatorMissingRight(R.val));return m(e,z);case"-":if(e=a.advance(e),r=y(e,q),e=r.state,"Err"!==(L=r.tree).type)return m(e,n.Neg(a.spanStates(F,e),[L]));if(!g(L.error))return m(e,L);V=a.spanStates(F,e),z=i.Err(V,i.UnaryOperatorMissingRight(R.val));return m(e,z);case"(":return T(e);case"\\{":return e=a.advance(e),a.isAt(e,"\\}")?m(e=a.advance(e),n.EmptyPiecewise(a.spanStates(F,e))):(o=y(e,q),e=o.state,L=o.tree,s=E(F,e,L,"\\{","\\}"),e=s.state,"Err"===(L=s.tree).type?m(e,L):m(e,n.Piecewise(a.spanStates(F,e),[L])));case"[":return e=a.advance(e),a.isAt(e,"]")?m(e=a.advance(e),n.List(a.spanStates(F,e),[])):(u=y(e,q),e=u.state,L=u.tree,c=E(F,e,L,"[","]"),e=c.state,"Err"===(L=c.tree).type?m(e,L):m(e,n.List(a.spanStates(F,e),[L])));case"(|":if(e=a.advance(e),a.isAt(e,"|)")){e=a.advance(e);V=a.spanStates(F,e);return m(e,i.Err(V,i.EmptyPipe()))}return p=y(e,q),e=p.state,L=p.tree,d=E(F,e,L,"(|","|)"),e=d.state,"Err"===(L=d.tree).type?m(e,L):m(e,n.Pipes(a.spanStates(F,e),[L]));case"Frac":e=a.advance(e);var j=h(R.num,e.opts),B=h(R.den,e.opts);if("Err"===j.type&&"EmptyGroup"===j.error.type&&"Err"===B.type&&"EmptyGroup"===B.error.type){V=a.spanStates(F,e),z=i.Err(V,i.FractionEmpty());return m(e,z)}if("Err"===j.type&&"EmptyGroup"===j.error.type){V=a.spanStates(F,e),z=i.Err(V,i.FractionMissingNumerator());return m(e,z)}if("Err"===B.type&&"EmptyGroup"===B.error.type){V=a.spanStates(F,e),z=i.Err(V,i.FractionMissingDenominator());return m(e,z)}if("Err"===j.type)return m(e,j);if("Err"===B.type)return m(e,B);if(n.isDerivative(j,B)&&"Juxt"===B.type){var U=B.args[1],G=void 0;if(v=y(e,l("*")-1),e=v.state,"Err"!==(G=v.tree).type)return m(e,n.Derivative(a.spanStates(F,e),[U,G]));if(g(G.error)){V=a.spanStates(F,e);return m(e,i.Err(V,i.DerivativeMissingBody()))}return m(e,G)}return m(e,n.Frac(a.spanStates(F,e),[j,B]));case"Sqrt":if(e=a.advance(e),R.optArg){var W=h(R.optArg,e.opts);return"Err"===W.type?"EmptyGroup"===W.error.type?m(e,i.Err(W.span,i.EmptyRadicalIndex())):m(e,W):"Err"===(J=h(R.arg,e.opts)).type?"EmptyGroup"===J.error.type?m(e,i.Err(J.span,i.EmptyRadical())):m(e,J):m(e,n.Nthroot(a.spanStates(F,e),[W,J]))}var J;return"Err"===(J=h(R.arg,e.opts)).type?"EmptyGroup"===J.error.type?m(e,i.Err(J.span,i.EmptyRadical())):m(e,J):m(e,n.Sqrt(a.spanStates(F,e),[J]));case"Trig":case"Ln":e=a.advance(e);var H=n.Cmd(a.spanStates(F,e),R.val),$=0;if("SupSub"===(ee=a.peek(e)).type){if(e=a.advance(e),ee.sub){V=a.spanStates(F,e),z=i.Err(V,i.UnexpectedSubscript(H.val));return m(e,z)}if(X=_(ee,e.opts)){if("Err"===X.type)return m(e,X);H=n.Superscript(a.spanStates(F,e),[H,X])}$=ee.nprimes}if(Y=a.isAt(e,"(")){if(x=T(e),e=x.state,"Err"===(L=x.tree).type)return m(e,L);L=n.Call(a.spanStates(F,e),[H,L.args[0]])}else{if(C=y(e,q-1),e=C.state,"Err"===(L=C.tree).type)return g(L.error)?m(e,i.Err(a.spanStates(F,e),i.FunctionMissingArgument(R.val))):m(e,L);L=n.ImplicitCall(a.spanStates(F,e),[H,L])}if(0<$){V=a.spanStates(F,e);if(!Y){z=i.Err(V,i.PrimeWithoutParen());return m(e,z)}L=n.Prime(V,$,[L])}return m(e,L);case"Log":e=a.advance(e);var Y,H=n.Cmd(a.spanStates(F,e),R.val),$=0,K=void 0,X=void 0;if("SupSub"===(ee=a.peek(e)).type&&(e=a.advance(e),K=b(ee,e.opts),X=_(ee,e.opts),$=ee.nprimes),K&&"Err"===K.type)return m(e,K);if(X&&"Err"===X.type)return m(e,X);if(Y=a.isAt(e,"(")){if(I=T(e),e=I.state,"Err"===(L=I.tree).type)return m(e,L);L=L.args[0]}else if(P=y(e,q-1),e=P.state,"Err"===(L=P.tree).type)return g(L.error)?m(e,i.Err(a.spanStates(F,e),i.FunctionMissingArgument(R.val))):m(e,L);var Q=K?n.Seq(a.spanStates(F,e),n.unwrapSeq(L).concat(K)):L,Z=K?n.Cmd(a.spanStates(F,e),"\\logbase"):H;if(X&&(Z=n.Superscript(a.spanStates(F,e),[Z,X])),L=Y?n.Call(a.spanStates(F,e),[Z,Q]):n.ImplicitCall(a.spanStates(F,e),[Z,Q]),0<$){V=a.spanStates(F,e);if(!Y){z=i.Err(V,i.PrimeWithoutParen());return m(e,z)}L=n.Prime(V,$,[L])}return m(e,L);case"Int":e=a.advance(e);var ee=a.peek(e);if(e=a.advance(e),"Err"===(re=S(ee,F,e)).type)return"MissingBound"===re.error.type?m(e,i.Err(re.span,i.IntegralMissingBound())):m(e,re);X=re.sup,K=re.sub,U=void 0;if(a.isAt(e,"Differential"))return k=w(e),e=k.state,"Err"===(U=k.tree).type?m(e,U):m(e,n.EmptyIntegral(a.spanStates(F,e),[U,K,X]));if(O=y(e,q),e=O.state,"Err"===(L=O.tree).type)return g(L.error)?m(e,i.Err(L.span,i.IntegralMissingBody())):m(e,L);var te=L;return a.isAt(e,"Differential")?(D=w(e),e=D.state,"Err"===(U=D.tree).type?m(e,U):m(e,n.Integral(a.spanStates(F,e),[U,K,X,te]))):m(e,i.Err(a.spanStates(F,e),i.IntegralMissingDifferential()));case"Sum":e=a.advance(e);ee=a.peek(e);if(e=a.advance(e),"Err"===(re=S(ee,F,e)).type)return"MissingBound"===re.error.type?m(e,i.Err(re.span,i.SumMissingBound())):m(e,re);X=re.sup,K=re.sub;return N=y(e,q),e=N.state,"Err"===(L=N.tree).type?g(L.error)?m(e,i.Err(L.span,i.SumMissingBody())):m(e,L):m(e,n.Sum(a.spanStates(F,e),[L,K,X]));case"Prod":e=a.advance(e);var re,ee=a.peek(e);if(e=a.advance(e),"Err"===(re=S(ee,F,e)).type)return"MissingBound"===re.error.type?m(e,i.Err(re.span,i.ProductMissingBound())):m(e,re);X=re.sup,K=re.sub;return A=y(e,q),e=A.state,"Err"===(L=A.tree).type?g(L.error)?m(e,i.Err(L.span,i.ProductMissingBody())):m(e,L):m(e,n.Product(a.spanStates(F,e),[L,K,X]));case"Cmd":return e=a.advance(e),L=n.Cmd(a.spanStates(F,e),R.val),m(e,L);case"Letter":return e=a.advance(e),L=n.Letter(a.spanStates(F,e),R.val),m(e,L);case"Decimal":e=a.advance(e);var ne=n.Decimal(a.spanStates(F,e),R.val);if("Decimal"!==(ee=e.token).type&&"MixedNumber"!==ee.type)return m(e,ne);var ie=e;e=a.advance(e);var V=a.spanStates(F,e),oe="MixedNumber"===ee.type?ee:n.Decimal(a.spanStates(ie,e),ee.val);return m(e,i.Err(V,i.AdjacentNumbers([ne,oe])));case"MixedNumber":return m(e=a.advance(e),R);case"*":case"/":case",":case"=":case">":case"<":case">=":case"<=":case"~":case":":case"...":case"%":case".":e=a.advance(e);V=a.spanStates(F,e),z=i.Err(V,i.BinaryOperatorMissingLeft(R.val));return m(e,z);case"!":e=a.advance(e);V=a.spanStates(F,e),z=i.Err(V,i.UnaryOperatorMissingLeft(R.val));return m(e,z);case"SupSub":e=a.advance(e);var ae="supsub";R.sub?ae="subscript":R.sup?ae="superscript":0<R.nprimes&&(ae="prime");V=a.spanStates(F,e),z=i.Err(V,i.UnaryOperatorMissingLeft(ae));return m(e,z);case")":case"\\}":case"]":case"|)":case"Differential":return M(e);case"Err":e=a.advance(e);V=a.spanStates(F,e),z=i.Err(V,i.UnrecognizedSymbol(R.val));return m(e,z);case"End":V=a.spanStates(F,e),z=i.Err(V,i.UnexpectedEnd());return m(e,z);default:throw"Unexpected token type "+R.type+"."}}(e);if(e=u.state,"Err"===(r=u.tree).type)return m(e,r);if(!a.didAdvance(s,e))throw new Error("Programming Error: parseInitial did not advance state.");for(;!a.isDone(e);){if((!a.isAt(e,"(")||(o=r,n.isIdentifier(o)||"Prime"===o.type&&n.isIdentifier(o.args[0]))?l(a.peek(e).type):p("("))<=t)break;var c,d=e;if(e=(c=function(e,t){var r,o,s,u,c,f,d,h,b,S,w,C,I,P,k,O=a.peek(e),D=p(O.type);switch(O.type){case"+":case"-":case"*":case"/":case"=":case"~":case":":case".":if(e=a.advance(e),r=y(e,D),e=r.state,"Err"!==(k=r.tree).type)return m(e,function(e,t,r){switch(e){case"+":return n.Add(t,r);case"-":return n.Sub(t,r);case"*":return n.Mul(t,r);case"/":return n.Div(t,r);case"=":return n.Equals(t,r);case"~":return n.Tilde(t,r);case":":return n.Colon(t,r);case".":return n.Dot(t,r);default:throw"Unexpected token type "+e+"."}}(O.type,a.joinState(t.span,e),[t,k]));if(g(k.error)){var N=a.joinState(t.span,e),A=i.Err(N,i.BinaryOperatorMissingRight(O.val));return m(e,A)}return m(e,k);case"%":e=a.advance(e);var L=a.peek(e);if("Cmd"!==L.type||"of"!==L.val&&"\\of"!==L.val){A=i.Err(O.span,i.PercentMissingOf());return m(e,A)}if(e=a.advance(e),o=y(e,D),e=o.state,"Err"!==(k=o.tree).type)return m(e,n.PercentOf(a.joinState(t.span,e),[t,k]));if(g(k.error)){N=a.joinState(t.span,e),A=i.Err(N,i.BinaryOperatorMissingRight(O.val));return m(e,A)}return m(e,k);case">=":case"<=":case">":case"<":var F=O.type;if(e=a.advance(e),s=v(e,F),e=s.state,F=s.symbol,u=y(e,D),e=u.state,"Err"===(k=u.tree).type){if(g(k.error)){N=a.joinState(t.span,e),A=i.Err(N,i.BinaryOperatorMissingRight(O.val));return m(e,A)}return m(e,k)}for(var R=n.Inequality(a.joinState(t.span,e),F,[t,k]),q=[],V=a.peek(e).type;">="===V||"<="===V||">"===V||"<"===V;){var z=e;if(F=V,e=a.advance(e),c=v(e,F),e=c.state,F=c.symbol,f=y(e,D),e=f.state,"Err"===(k=f.tree).type){if(g(k.error)){N=a.joinState(t.span,e),A=i.Err(N,i.BinaryOperatorMissingRight(O.val));return m(e,A)}return m(e,k)}q.push(n.TrailingInequalityPiece(a.spanStates(z,e),F,[k])),V=a.peek(e).type}return q.length?m(e,n.InequalityChain(a.joinState(t.span,e),R,q)):m(e,R);case"!":return m(e=a.advance(e),n.Bang(a.joinState(t.span,e),[t]));case"[":z=e;if(e=a.advance(e),a.isAt(e,"]")){e=a.advance(e);N=a.spanStates(z,e);return m(e,i.Err(N,i.EmptySquareBracket()))}return d=y(e,D),e=d.state,k=d.tree,h=E(z,e,k,"[","]"),e=h.state,"Err"===(k=h.tree).type?m(e,k):m(e,n.Index(a.joinState(t.span,e),[t,k]));case"Sqrt":case"Frac":case"Letter":case"Cmd":case"Trig":case"Ln":case"Log":case"Sum":case"Int":case"Prod":case"Decimal":case"MixedNumber":case"\\{":case"(|":return b=y(e,D),e=b.state,"Err"===(k=b.tree).type?m(e,k):m(e,n.Juxt(a.joinState(t.span,e),[t,k]));case"(":if(n.isIdentifier(t)){if(S=T(e),e=S.state,"Err"===(k=S.tree).type)return m(e,k);N=a.joinState(t.span,e);return m(e,n.Call(N,[t,k.args[0]]))}if("Prime"===t.type&&n.isIdentifier(t.args[0])){if(w=T(e),e=w.state,"Err"===(k=w.tree).type)return m(e,k);N=a.joinState(t.span,e);return m(e,n.Prime(N,t.nprimes,[n.Call(N,[t.args[0],k.args[0]])]))}return C=y(e,D),e=C.state,"Err"===(k=C.tree).type?m(e,k):m(e,n.Juxt(a.joinState(t.span,e),[t,k]));case"SupSub":e=a.advance(e);var j=x(O),B=_(O,e.opts);if(j&&"Err"===j.type)return m(e,j);if(B&&"Err"===B.type)return m(e,B);if(j&&(t=n.Subscript(a.joinState(t.span,e),[t,j])),B&&(t=n.Superscript(a.joinState(t.span,e),[t,B])),0<O.nprimes){N=a.joinState(t.span,e);if(!n.isIdentifier(t)){A=i.Err(N,i.UnexpectedPrime());return m(e,A)}t=n.Prime(N,O.nprimes,[t])}return m(e,t);case",":for(var U=[t];a.isAt(e,",")&&(e=a.advance(e),!a.isAt(e,"..."))&&(!e.opts.trailingComma||!function(e){return a.isAt(e,")")||a.isAt(e,"]")||a.isAt(e,"\\}")}(e));){if(I=y(e,D),e=I.state,"Err"===(k=I.tree).type){if(g(k.error)){N=a.joinState(t.span,e),A=i.Err(N,i.BinaryOperatorMissingRight(O.val));return m(e,A)}return m(e,k)}U.push(k)}return m(e,n.Seq(a.joinState(t.span,e),U));case"...":if(e=a.advance(e),a.isAt(e,",")&&(e=a.advance(e)),D>=l(a.peek(e).type))return m(e,n.Ellipsis(a.joinState(t.span,e),[t,n.EmptyRangeEnd(a.emptySpanAtState(e))]));if(P=y(e,D),e=P.state,"Err"!==(k=P.tree).type)return m(e,n.Ellipsis(a.joinState(t.span,e),[t,k]));if(g(k.error)){N=a.joinState(t.span,e),A=i.Err(N,i.BinaryOperatorMissingRight(O.val));return m(e,A)}return m(e,k);case"]":case")":case"\\}":case"|)":case"Differential":return M(e);case"Err":return y(e,D);case"End":N=a.spanStates(e,e),A=i.Err(N,i.UnexpectedEnd());return m(e,A);default:throw"Unexpected token type "+O.type+"."}}(e,r)).state,"Err"===(r=c.tree).type)return m(e,r);if(!a.didAdvance(d,e))throw new Error("Programming Error: parseSuccessor did not advance state.")}return m(e,r)}function g(e){return"UnexpectedDifferential"===e.type||"UnexpectedCloseDelimiter"===e.type||"UnexpectedEnd"===e.type||"BinaryOperatorMissingLeft"===e.type}function v(e,t){if(!a.isAt(e,"="))return{state:e,symbol:t};switch(t){case">":e=a.advance(e),t=">=";break;case"<":e=a.advance(e),t="<="}return{state:e,symbol:t}}function b(e,t){if(e.sub){var r=h(e.sub,t);return"Err"===r.type&&"EmptyGroup"===r.error.type?i.Err(r.span,i.EmptySubscript()):r}}function x(e){if(e.sub){var t=e.sub;if(0===t.args.length)return i.Err(t.span,i.EmptySubscript());for(var r=[],a=0,s=t.args;a<s.length;a++){var u=s[a];if("Digit"!==u.type&&"Letter"!==u.type){var c=u.span;return i.Err(c,i.InvalidSubscript(o.slice(c)))}r.push(u.val)}return n.Alphanumeric(t.span,r.join(""))}}function _(e,t){if(e.sup){var r=h(e.sup,t);return"Err"===r.type?"EmptyGroup"===r.error.type?i.Err(r.span,i.EmptySuperscript()):r:0<e.nprimes?i.Err(e.span,i.SuperscriptWithPrime()):r}}function S(e,t,r){if("SupSub"!==e.type){var n=a.spanStates(t,r);return i.Err(n,i.MissingBound())}if(0<e.nprimes){n=a.spanStates(t,r);return i.Err(n,i.UnexpectedPrime())}var o=b(e,r.opts),s=_(e,r.opts);if(!o||"Err"===o.type&&"EmptySubscript"===o.error.type||!s||"Err"===s.type&&"EmptySuperscript"===s.error.type){n=a.spanStates(t,r);return i.Err(n,i.MissingBound())}return"Err"===o.type?o:"Err"===s.type?s:{type:"Bounds",sup:s,sub:o}}function T(e){var t,r,i,o=e,s=a.peek(e),u=f(s.type);if(!a.isAt(e,"("))throw new Error("Programming Error: expected '(' at start of parseParen.");if(e=a.advance(e),a.isAt(e,")")){var c=n.Seq(a.emptySpanAtState(e),[]);e=a.advance(e);var l=a.spanStates(o,e);return m(e,n.Paren(l,[c]))}return e=(r=E(o,e=(t=y(e,u)).state,t.tree,"(",")")).state,"Err"===(i=r.tree).type?m(e,i):m(e,n.Paren(a.spanStates(o,e),[i]))}function w(e){var t=e,r=a.peek(e);if("Differential"!==r.type)throw new Error("Programming Error: expected differential");e=a.advance(e);var o=n.Cmd(r.span,r.val),s=a.peek(e);if("SupSub"===s.type){e=a.advance(e);var u=a.spanStates(t,e),c=x(s);if(c){if("Err"===c.type)return m(e,c);o=n.Subscript(u,[o,c])}if(s.sup)return m(e,i.Err(u,i.DifferentialWithSuperscript()));if(0<s.nprimes)return m(e,i.Err(u,i.UnexpectedPrime()))}return m(e,o)}function E(e,t,r,n,o){if("Err"===r.type&&"UnexpectedEnd"!==r.error.type)return m(t,r);if("Err"!==r.type&&a.isAt(t,o))return m(t=a.advance(t),r);var s=a.spanStates(e,t);return m(t,i.Err(s,i.MissingCloseDelimiter(n,o)))}function M(e){var t=e;switch(a.peek(e).type){case")":e=a.advance(e);var r=a.spanStates(t,e);return m(e,i.Err(r,i.UnexpectedCloseDelimiter("(",")")));case"]":e=a.advance(e);r=a.spanStates(t,e);return m(e,i.Err(r,i.UnexpectedCloseDelimiter("[","]")));case"\\}":e=a.advance(e);r=a.spanStates(t,e);return m(e,i.Err(r,i.UnexpectedCloseDelimiter("\\{","\\}")));case"|)":e=a.advance(e);r=a.spanStates(t,e);return m(e,i.Err(r,i.UnexpectedCloseDelimiter("|","|")));case"Differential":e=a.advance(e);r=a.spanStates(t,e);return m(e,i.Err(r,i.UnexpectedDifferential()));default:e=a.advance(e);r=a.spanStates(t,e);return m(e,i.Err(r,i.UnexpectedParseError()))}}t.parse=function(e,t){var n=h(e,t?r.__assign(r.__assign({},d),t):d);return"Err"===n.type&&"EmptyGroup"===n.error.type?i.Err(n.span,i.EmptyInput()):n}});r("core/math/inverses",[],function(){"use strict";var e={};return["sin","cos","tan","cot","sec","csc","sinh","cosh","tanh","coth","sech","csch"].forEach(function(t){e[t]="arc"+t,e["arc"+t]=t}),e});r("core/math/parser/lower",["require","exports","core/math/inverses","core/math/errormsg","tslib","./input-span","./surface-node","../maybe-rational"],function(e,t,r,n,i,o,a,s){"use strict";function u(e,t){for(var r=[],n=0;n<t.length;n++)r.push(l(e,t[n]));return r}function c(e){if("Paren"!==e.type)return!1;var t=e.args[0];return"Seq"===t.type&&2===t.args.length}function l(e,t){return e.setInput(p(e,t),t.span)}function p(e,t){var r=e.nodes;switch(t.type){case"Pos":return p(e,t.args[0]);case"Neg":for(var i=-1,T=t.args[0];;)if("Pos"===T.type||"Paren"===T.type&&!c(T))T=T.args[0];else{if("Neg"!==T.type)break;T=T.args[0],i*=-1}switch(T.type){case"Decimal":var w=g(T);return r.Constant(-1===i?s.neg(w):w);case"MixedNumber":w=v(T);return r.MixedNumber(-1===i?s.neg(w):w);default:return-1===i?r.Negative([l(e,T)]):p(e,T)}case"Add":return r.Add(u(e,t.args));case"Sub":return r.Subtract(u(e,t.args));case"Mul":return r.Multiply(u(e,t.args));case"Div":return r.Divide(u(e,t.args));case"Bang":var E=t.args[0];return"Call"===E.type?r.FunctionFactorial(u(e,E.args)):r.FunctionCall("\\factorial",u(e,t.args));case"PercentOf":return r.PercentOf(u(e,t.args));case"Call":return h(e,t);case"ImplicitCall":return function(e){var t=e.args,r=t[0],i=t[1];"Superscript"===r.type&&(r=r.args[0]);if("Cmd"===r.type&&"logbase"===r.val&&"Seq"===i.type&&2===i.args.length){if(!b(i.args[0]))throw n.badImplicitCall("log")}else if(!b(i)){if("Cmd"===r.type)throw n.badImplicitCall(r.val);throw n.parseError()}}(t),h(e,t);case"Dot":var M=t.args[1],C=u(e,t.args),I=C[0],P=C[1];if(x(M)){var k=o.emptySpanAt(M.span.input,M.span.end),O=e.setInput(_(e),k);P=e.setInput(r.SeededFunctionCall(P,[O]),M.span)}else if("Letter"===M.type)switch(M.val){case"x":return r.OrderedPairAccess([I,r.Constant(1)]);case"y":return r.OrderedPairAccess([I,r.Constant(2)])}return r.DotAccess([I,P]);case"Prime":var D=t.args[0];if("Call"!==D.type)throw"ImplicitCall"===D.type?n.primeWithoutParen():n.unexpectedPrime();var N=D.args,A=N[0],L=N[1],F=a.unwrapSeq(L).length;if("Cmd"===A.type&&"logbase"===A.val){if(2!==F)throw n.primedFunctionArity()}else if(1!==F)throw n.primedFunctionArity();return r.Prime(t.nprimes,u(e,t.args));case"Index":var R=t.args,q=R[0],V=R[1];if("Seq"===V.type)return r.ListAccess([p(e,q),r.List(u(e,V.args))]);if("Ellipsis"!==V.type)return m(V)?r.ListAccess([p(e,q),y(e,V)]):r.ListAccess(u(e,t.args));var z=V.args,j=z[0],B=z[1];return r.ListAccess([p(e,q),r.Range([r.List(u(e,a.unwrapSeq(j))),r.List("EmptyRangeEnd"===B.type?[]:u(e,a.unwrapSeq(B)))])]);case"Paren":var U=t.args[0];return"Seq"===U.type?r.OrderedPair(u(e,U.args)):p(e,U);case"List":if(0===t.args.length)return r.List([]);var G=t.args[0];if("Ellipsis"!==G.type)return r.List(u(e,a.unwrapSeq(G)));var W=G.args,j=W[0],B=W[1];return r.Range([r.List(u(e,a.unwrapSeq(j))),r.List(u(e,a.unwrapSeq(B)))]);case"Pipes":return r.FunctionCall("\\abs",u(e,t.args));case"Subscript":var J=t.args,H=J[0],$=J[1];if(0===$.val.length)throw n.emptySubscript();var Y=void 0;switch(H.type){case"Letter":case"Cmd":Y=H.val;break;default:throw n.unexpectedSubscript()}return r.Identifier(Y+"_"+$.val);case"Superscript":var K=t.args,H=K[0],X=K[1];if("Call"!==H.type||"Seq"===H.args[1].type||function(e){if("Call"!==e.type)return!1;var t=e.args[0];for(;"Superscript"===t.type||"Subscript"===t.type||"Prime"===t.type;)t=t.args[0];return"Cmd"===t.type&&(f(t.val)||d(t.val))}(H)){if("Dot"!==H.type)return r.Exponent(u(e,t.args));var M=H.args[1],Q=u(e,H.args),I=Q[0],P=Q[1],Z=l(e,X);if("Letter"===M.type)switch(M.val){case"x":return r.Exponent([r.OrderedPairAccess([I,r.Constant(1)]),Z]);case"y":return r.Exponent([r.OrderedPairAccess([I,r.Constant(2)]),Z])}else if("Call"===M.type){if("Letter"===(A=M.args[0]).type)switch(A.val){case"x":return r.Multiply([r.OrderedPairAccess([I,r.Constant(1)]),r.Exponent([l(e,M.args[1]),Z])]);case"y":return r.Exponent([r.OrderedPairAccess([I,r.Constant(2)]),r.Exponent([l(e,M.args[1]),Z])])}}return r.DotAccessExponent([I,P,Z])}return r.FunctionExponent(u(e,[H.args[0],H.args[1],X]));case"Sqrt":return r.FunctionCall("sqrt",u(e,t.args));case"Nthroot":return r.FunctionCall("nthroot",u(e,[t.args[1],t.args[0]]));case"Frac":return r.Divide(u(e,t.args));case"Derivative":var ee=u(e,t.args);if(!a.isIdentifier(t.args[0]))throw n.parseError();return r.Derivative(ee[0],[ee[1]]);case"Integral":var te=t.args,ee=u(e,[ne=te[0],te[1],oe=te[2],ae=te[3]]);return r.Integral(ee);case"EmptyIntegral":var re=u(e,t.args),ne=re[0],ie=re[1],oe=re[2],ae=r.Constant(s.maybeRational(1,1));return r.Integral([ne,ie,oe,ae]);case"Sum":var se=t.args,ue=se[0],ce=se[1],oe=se[2];if("Equals"!=ce.type)throw n.incorrectSumLowerBound();if(!a.isIdentifier(ce.args[0]))throw n.incorrectSumLowerBound();var le=l(S(e,(ee=u(e,[ce.args[0],ce.args[1],oe]))[0]),ue);return r.Sum(ee.concat(le));case"Product":var pe=t.args,ue=pe[0],fe=pe[1],oe=pe[2];if("Equals"!=fe.type)throw n.incorrectProductLowerBound();if(!a.isIdentifier(fe.args[0]))throw n.incorrectProductLowerBound();le=l(S(e,(ee=u(e,[fe.args[0],fe.args[1],oe]))[0]),ue);return r.Product(ee.concat(le));case"Juxt":return r.Multiply(u(e,t.args));case"Letter":return r.Identifier(t.val);case"Cmd":var de=t.val;if("ans"===de){if(void 0===e.currentIndex)throw n.badAnsContext();return r.Ans("ans_{"+(e.currentIndex-1)+"}")}if("approx"===de)throw n.unrecognizedSymbol(de);return r.Identifier(de);case"Decimal":return r.Constant(g(t));case"MixedNumber":return r.MixedNumber(v(t));case"Piecewise":return function(e,t){var r,i=e.nodes,o=t.args[0],u=a.unwrapSeq(o),c=[];e:for(r=0;r<u.length;r++){var p=u[r];switch(p.type){case"Colon":var f=p.args,d=f[0],h=f[1];if(!m(d))throw n.colonMissingCondition();c.push({condition:y(e,d),if_expr:l(e,h)});break;case"Equals":case"Inequality":case"InequalityChain":c.push({condition:y(e,p),if_expr:i.Constant(s.maybeRational(1,1))});break;default:break e}}if(0===r)throw n.piecewiseMissingCondition();if(r<u.length-1)throw n.piecewisePartMissingCondition();var g=r===u.length-1?l(e,u[r]):i.Constant(NaN);if(!i.Piecewise.chain)throw n.featureUnavailable();return i.Piecewise.chain(c,g)}(e,t);case"EmptyPiecewise":if(!r.Piecewise.empty)throw n.featureUnavailable();return r.Piecewise.empty();case"Equals":throw n.unexpectedSymbol("=");case"Inequality":case"InequalityChain":throw n.unexpectedInequality();case"Tilde":throw n.unexpectedSymbol("~");case"Seq":throw n.unexpectedSymbol(",");case"Colon":throw n.unexpectedSymbol(":");case"Ellipsis":throw n.unexpectedSymbol("...");case"EmptyRangeEnd":throw n.invalidHalfEmptyRange();case"Err":throw function(e){switch(e.type){case"UnexpectedParseError":case"MissingBound":case"EmptyGroup":case"UnexpectedDifferential":case"UnexpectedEnd":return n.parseError();case"InvalidOperatorName":return n.invalidOperatorName();case"UnexpectedCloseDelimiter":case"MissingCloseDelimiter":return n.mismatchedBraces(e.open,e.close);case"UnrecognizedSymbol":return"."===e.val?n.unexpectedSymbol(e.val):n.unrecognizedSymbol(e.val);case"EmptyInput":return n.blankExpression();case"BinaryOperatorMissingRight":case"BinaryOperatorMissingLeft":return n.binaryOperatorMissingOperand("%"===e.val?"% of":e.val);case"UnaryOperatorMissingLeft":return n.unaryOperatorMissingLeft(e.val);case"UnaryOperatorMissingRight":return n.unaryOperatorMissingRight(e.val);case"UnexpectedSubscript":return n.cannotSubscript(e.base);case"PercentMissingOf":return n.percentMissingOf();case"SumMissingBound":return n.sumMissingBound();case"ProductMissingBound":return n.productMissingBound();case"IntegralMissingBound":return n.integralMissingBound();case"SumMissingBody":return n.sumMissingBody();case"ProductMissingBody":return n.productMissingBody();case"IntegralMissingBody":return n.integralMissingBody();case"DerivativeMissingBody":return n.derivativeMissingBody();case"IntegralMissingDifferential":return n.integralMissingDifferential();case"DifferentialWithSuperscript":return n.differentialWithSuperscript();case"FractionMissingNumerator":return n.fractionMissingNumerator();case"FractionMissingDenominator":return n.fractionMissingDenominator();case"FractionEmpty":return n.fractionEmpty();case"EmptySuperscript":return n.emptySuperscript();case"EmptySubscript":return n.emptySubscript();case"InvalidSubscript":return n.invalidSubscript(e.val);case"SuperscriptWithPrime":return n.superscriptWithPrime();case"PrimeWithoutParen":return n.primeWithoutParen();case"UnexpectedPrime":return n.unexpectedPrime();case"EmptyRadical":return n.emptyRadical();case"EmptyRadicalIndex":return n.emptyRadicalIndex();case"EmptySquareBracket":return n.emptySquareBracket();case"EmptyPipe":return n.emptyPipe();case"FunctionMissingArgument":return n.wrongArity(e.val,1,0);case"AdjacentNumbers":var t=e.args[0].val,r=void 0;switch(e.args[1].type){case"Decimal":r=e.args[1].val;break;case"MixedNumber":r=e.args[1].whole+" "+e.args[1].num+"/"+e.args[1].den;break;default:throw"Unexpected type "+e.args[1].type+" as right member of AdjacentNumbers."}return n.adjacentNumbers(t,r);default:throw"Unexpected surface node "+e.type+"."}}(t.error);default:throw"Unexpected surface node "+t.type+"."}}function f(e){return r.hasOwnProperty(e)}function d(e){return"ln"===e||"log"===e||"logbase"===e}function h(e,t){var i,s,c=e.nodes,p=t.args,h=p[0],m=p[1],y=l(e,h),g=u(e,a.unwrapSeq(m));if(x(h)){var v=o.emptySpanAt(m.span.input,m.span.start),b=e.setInput(_(e),v);return c.SeededFunctionCall(y,[b].concat(g))}if(a.isIdentifier(h))return c.FunctionCall(y,g);if("Superscript"===h.type){var S=h.args,T=S[0],w=S[1];if("Cmd"===T.type){var E=T.val;if(f(E)||d(E)){if("Decimal"===(s=w).type&&"2"===s.val)return c.Exponent([c.FunctionCall(E,g),l(e,w)]);if("Neg"===(i=w).type&&"Decimal"===(i=i.args[0]).type&&"1"===i.val&&void 0!==r[E])return c.FunctionCall(r[E],g);throw f(E)?n.badTrigExponent(E):n.badLogExponent("logbase"===E?"log":E)}}}return c.Multiply([y,l(e,m)])}function m(e){return"Equals"===e.type||"Inequality"===e.type||"InequalityChain"===e.type}function y(e,t){var r=e.nodes;switch(t.type){case"Equals":return r.Comparator["="](u(e,t.args));case"Inequality":return r.Comparator[t.symbol](u(e,t.args));case"InequalityChain":if(1<t.chain.length)throw n.inequalityChainTooLong();var i=t.first,s=i.symbol,c=i.args,l=c[0],p=c[1],f=t.chain[0],d=f.symbol,h=f.args[0],m=o.emptySpanAt(t.span.input,t.span.start);return r.And([y(e,a.Inequality(m,s,[l,p])),y(e,a.Inequality(m,d,[p,h]))]);default:throw n.parseError()}}function g(e){return s.fromDecimalString(e.val)}function v(e){var t=s.fromDecimalString(e.whole),r=s.fromDecimalString(e.num),n=s.fromDecimalString(e.den);return s.add(t,s.div(r,n))}function b(e){switch(e.type){case"Letter":case"Decimal":case"MixedNumber":case"Cmd":case"EmptyPiecewise":return!0;case"Neg":for(var t=e.args[0];;)if("Pos"===t.type||"Paren"===t.type&&!c(t))t=t.args[0];else{if("Neg"!==t.type)break;t=t.args[0]}return"Decimal"===t.type||"MixedNumber"===t.type;case"Pos":case"Paren":return b(e.args[0]);case"Juxt":case"Mul":case"Div":return b(e.args[0])&&b(e.args[1]);case"Subscript":return b(e.args[0]);case"Superscript":case"Frac":case"Add":case"Sub":return b(e.args[0])&&b(e.args[1]);case"Piecewise":return"Equals"===(t=e.args[0]).type||"Inequality"===t.type||"InequalityChain"===t.type;case"Call":var r=e.args,n=r[0],i=r[1];return a.isIdentifier(n)||a.isSuperscriptedIdentifier(n)?!1:b(n)&&b(i);case"Derivative":case"Sqrt":case"Nthroot":case"Pipes":case"Bang":return!1;case"Neg":case"Equals":case"Inequality":case"InequalityChain":case"Tilde":case"ImplicitCall":case"Index":case"List":case"Seq":case"Integral":case"EmptyIntegral":case"Sum":case"Product":case"Colon":case"Ellipsis":case"Dot":case"PercentOf":case"Prime":case"EmptyRangeEnd":return!1;default:throw"Unexpected surface node "+e.type+"."}}function x(e){return"Cmd"===e.type&&("random"===e.val||"shuffle"===e.val)}function _(e){var t=e.nodes.ExtendSeed("",[e.nodes.Identifier("globalRandomSeed"),e.nodes.Seed(e.nextSeed())]);if(!e.seedExtensions)return t;for(var r=0,n=e.seedExtensions;r<n.length;r++)var i=n[r],t=e.nodes.ExtendSeed("ro",[t,i]);return t}function S(e,t){var r=e.seedExtensions||[];return i.__assign(i.__assign({},e),{seedExtensions:r.concat(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.lower=void 0,t.lower=function(e,t){return i=t,(r=e).setInput(function(e,t){var r=e.nodes;switch(t.type){case"Equals":var i=t.args,o=i[0],s=i[1];if("Call"===o.type){var f=o.args,d=f[0],h=f[1],m=a.unwrapSeq(h);if(a.isIdentifier(d)&&m.every(a.isIdentifier))return r.FunctionDefinition(l(e,d),u(e,m),l(e,s))}else if(a.isIdentifier(o))return r.Assignment(l(e,o),l(e,s));return r.Equation(l(e,o),l(e,s));case"Tilde":var g=u(e,t.args),o=g[0],s=g[1];return r.Regression(o,s);case"Inequality":return y(e,t);case"InequalityChain":if(1<t.chain.length)throw n.inequalityChainTooLong();var v=t.first,b=v.symbol,x=v.args,_=x[0],S=x[1],T=t.chain[0],w=T.symbol,E=T.args[0];return a.isIdentifier(S)?r.DoubleInequality([l(e,_),b,l(e,S),w,l(e,E)]):y(e,t);case"Seq":if(!t.args.every(c))throw n.malformedPoint();return r.List(u(e,t.args));case"Call":var M=t.args,C=M[0],I=M[1];if("Cmd"===C.type)switch(C.val){case"polygon":return r.Polygon(u(e,a.unwrapSeq(I)));case"histogram":return r.Histogram(u(e,a.unwrapSeq(I)));case"cube":case"sphere":case"cone":case"dodecahedron":case"octahedron":case"tetrahedron":return r.Object3D(u(e,a.unwrapSeq(I)),C.val);case"dotplot":return r.DotPlot(u(e,a.unwrapSeq(I)));case"boxplot":return r.BoxPlot(u(e,a.unwrapSeq(I)));case"ttest":return r.TTest(u(e,a.unwrapSeq(I)));case"ittest":return r.IndependentTTest(u(e,a.unwrapSeq(I)));case"stats":return r.Stats(u(e,a.unwrapSeq(I)));default:return p(e,t)}return p(e,t);default:return p(e,t)}}(r,i),i.span);var r,i}});r("core/math/baseparser",["require","exports","core/math/errormsg","parsenodes","core/math/parser/latex-parser","core/math/parser/expression-parser","core/math/parser/lower"],function(e,t,r,n,i,o,a){"use strict";function s(){throw r.featureUnavailable()}function u(e,t){return e.setInputSpan(t),e}Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0,t.parse=function(e,t){var c=typeof e;if("string"!=c)throw new Error("Type Error: parse can only be called with strings, got "+JSON.stringify(e)+" of type "+c);var l=n;if((t=t||{}).disabledFeatures){l=Object.create(l);for(var p=0,f=t.disabledFeatures;p<f.length;p++){var d=f[p];if(!l[d])throw new Error("Programming Error: "+d+" cannot be disabled because it is not a parsenode.");l[d]=s}}var h=void 0===t.seedPrefix?"":t.seedPrefix,m=0,y={nodes:l,currentIndex:t.index,setInput:u,nextSeed:function(){var e=h+"::vc"+m;return m+=1,e}},g={};void 0!==t.trailingComma&&(g.trailingComma=t.trailingComma);try{var v=i.parse(e),b=o.parse(v,g);return a.lower(y,b)}catch(e){return e instanceof n.Error?e:"string"==typeof e?n.Error(e):r.parseError()}}});r("core/math/rational-arithmetic-sequence",["require","core/math/distance","core/math/builtin"],function(e){"use strict";var t=e("core/math/distance"),r=e("core/math/builtin");return function(e,n){var i=r.toFraction(e),o=r.toFraction(n);if(t.approx(i.n/i.d,e)&&t.approx(o.n/o.d,n)){var a=r.lcm(i.d,o.d),s=i.n*(a/i.d);return{nstart:s,nstep:o.n*(a/o.d)-s,lcm:a}}}});r("core/math/sliders",["require","exports"],function(e,t){"use strict";function r(e,t){var r=Math.round(1e6*e)/1e6;return Math.abs(r-e)<t?r:e}function n(e){var t,n=e.target,i=e.hardMin,o=e.hardMax,a=e.step,s=1e-10;if(void 0!==i&&void 0!==o&&(s=Math.min(s,Math.abs(o-i)/1e3)),a&&(s=Math.min(s,a/10)),void 0!==i&&(i=r(i,s)),void 0!==o&&(o=r(o,s)),e.forceSliderToMax&&void 0!==o&&(n=o),o<i)return i;if(n<=i)return i;if(o<=n)return o;a&&(t=void 0!==i?i:0,n=a*Math.round((n-t)/a)+t);var u=r(n,s);return!a&&i!==u&&o!==u||(n=u),n<=i?i:o<=n?o:n}Object.defineProperty(t,"__esModule",{value:!0}),t.computeSoftMax=t.constrainSliderValueLikeEvaluator=t.determineWhichLimitsAreCompatibleWithValue=t.roundToReasonableDecimal=void 0,t.roundToReasonableDecimal=r,t.determineWhichLimitsAreCompatibleWithValue=function(e){var t=!0,r=!0,i=!0;return void 0!==e.hardMin&&e.target<e.hardMin&&(t=!1),void 0!==e.hardMax&&e.target>e.hardMax&&(r=!1),e.step&&n({target:e.target,step:e.step,hardMin:t?e.hardMin:void 0,hardMax:r?e.hardMax:void 0})!==e.target&&(i=!1),{min:t,max:r,step:i}},t.constrainSliderValueLikeEvaluator=n,t.computeSoftMax=function(e){var t,r=e.storedMax,i=e.sliderValue,o=e.hardMin,a=e.step,s=10;return s<r&&(s=r),s<i&&(s=i),s<o&&(s=o),a&&(s=s<=(t=n({target:s,hardMin:o,hardMax:void 0,step:a}))?t:t+a),s}});r("core/math/features/getConcreteTree",["require","parsenodes","core/math/errormsg","core/math/types","core/lib/label","core/math/builtin","core/math/distance","core/math/maybe-rational","core/math/rational-arithmetic-sequence","core/math/sliders"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/errormsg"),n=e("core/math/types"),i=e("core/lib/label"),o=e("core/math/builtin"),a=e("core/math/distance"),s=e("core/math/maybe-rational"),u=s.maybeRational,c=e("core/math/rational-arithmetic-sequence"),l=t.List,p=t.Range,f=t.OrderedPair,d=t.ScalarExpression,h=t.Constant,m=t.ExtendSeed,y=t.Multiply,g=t.Identifier,v=t.DummyIndex,b=t.BuiltInFunction,x=e("core/math/sliders");function _(e,t,r){for(var n=[],i=0;i<e.length;i++)n.push(e[i].getConcreteTree(t,r));return n}function S(){return this.getDependencies().concat([this._symbol])}function T(e,t,i,o){var a=o.length-1,s=e[t];if(!s)throw r.unexpectedSymbol(".");if(s.isError)throw s;if(!s.isFunction)throw r.unexpectedSymbol(".");if(!s.allowDotCalls)throw r.illegalDotCall(i);var u,c="random"===t,l="random"===t||"shuffle"===t,p=l?o[1].valueType:o[0].valueType;if((u=p)!==n.Distribution&&!n.isList(u))throw r.dotLHSTypeError("."+i,n.prettyPrint(p));var f=l?1:0;if(a<s.dotMinArity){if(c)throw r.randomArity();throw r.wrongArity("."+i,s.dotMinArity-f,a-f,s.dotMinArityUsageExample)}if(a>s.dotMaxArity){if(c)throw r.randomArity();throw r.wrongArity("."+i,s.dotMaxArity-f,a-f,s.dotMaxArityUsageExample)}}function w(e,t,r,n,i){var o=_(r,n,i);return T(i,e,t,o),i[e].getConcreteInvocationTree(n,i,o,t)}function E(e,t){return!e.isError&&-1===t.indexOf(e.valueType)?r.parseError():e}function M(e,t,r){if(t){var n=t.getDependencies();if(t.isError)r.errors[e]=!0;else if(0<n.length){r.errors[e]=!0;for(var i=0;i<n.length;i++)n[i]===r.exportedSymbol?r.errors.cycle=!0:r.missingVars.push(n[i])}else r.values[e]=+t.asValue();r.valids[e]=isFinite(r.values[e]),r.valids[e]||(r.values[e]=void 0)}else r.valids[e]=!0}function C(e){return e&&e.valueType===n.ListOfNumber&&1===e.length&&e.args?e.args[0]:e}function I(e,t,n,i,o,s){if(i<t.length&&!a.approx(s,t.elementAt(e,i).asValue(),10))throw r.nonArithmeticRange();if(o-i<=n.length&&1<o-i&&!a.approx(s,n.elementAt(e,n.length-o+i).asValue(),10))throw r.nonArithmeticRange()}function P(e,t){for(var r=!1,n=!1,i=!1,o=0;o<e.length;o++){var a=e[o];(a.isList||a.isBroadcast)&&(n=!0,0===a.length&&(i=!0));for(var s=a.getDependencies(),u=0;u<s.length;u++)if(-1!==t.indexOf(s[u])){if(a.isList||a.isBroadcast)return"list"}else r=!0}return n?i?"empty":r?"broadcast":"list":"none"}function k(e){for(var r=[],i=[],o=[],a=0;a<e.length;a++){var s,u=e[a];if(u.isList){for(var c,l=!1,p=0;p<o.length;p++)if(u===o[p]){l=!0,(s=t.DummyIndex(i[p])).valueType=n.elementType(u.valueType),r.push(s);break}l||(c=t.Base.prototype.tmpVar(),i.push(c),o.push(u),(s=t.DummyIndex(c)).valueType=n.elementType(u.valueType),r.push(s))}else u.isBroadcast?(Array.prototype.push.apply(i,u._replacedSymbols),Array.prototype.push.apply(o,u._lists),r.push(u._expression)):r.push(u)}return{replacedArgs:o,concreteArgs:r,replacedSymbols:i}}t.Base.prototype.tryGetConcreteTree=function(){var e;try{e=this.getConcreteTree.apply(this,arguments)}catch(n){e=n instanceof t.Base?n:r.parseError()}return e},t.Base.prototype.getConcreteTree=function(e,t,r){if(this.isConcreteTreeCacheValid(t))return this.__cachedConcreteTree.value;for(var n=this._getConcreteTree(e,t,r),i={},o=this.getCacheKeys().slice();o.length;){var a,s=o.pop();i.hasOwnProperty(s)||(a=t[s],(i[s]=a)&&Array.prototype.push.apply(o,a.getCacheKeys()))}return this.__cachedConcreteTree={keys:i,value:n},n},t.Base.prototype.getCacheKeys=function(){return this.getDependencies()},t.Histogram.prototype.getCacheKeys=S,t.Object3D.prototype.getCacheKeys=S,t.DotPlot.prototype.getCacheKeys=S,t.BoxPlot.prototype.getCacheKeys=S,t.TTest.prototype.getCacheKeys=S,t.IndependentTTest.prototype.getCacheKeys=S,t.Base.prototype.isConcreteTreeCacheValid=function(e){if(!this.__cachedConcreteTree)return!1;for(var t in this.__cachedConcreteTree.keys)if(this.__cachedConcreteTree.keys.hasOwnProperty(t)&&e[t]!==this.__cachedConcreteTree.keys[t])return!1;return!0},t.PercentOf.prototype._getConcreteTree=function(e,r){return t.Divide([t.Multiply(this.args),t.Constant(u(100,1))]).getConcreteTree(e,r)},t.Assignment.prototype._getConcreteTree=function(e,t){return this._expression.getConcreteTree(e,t)},t.Identifier.prototype._getConcreteTree=function(e,n){var o=i.latexToIdentifier(this.getInputString()),a=n[this._symbol];if(a){if(a.isError)throw a;if(a.isFunction)throw r.identifierAsFunction(o);return a.getConcreteTree(e,n)}if(b.hasOwnProperty(this._symbol))throw r.functionUnsupported(o);return t.FreeVariable(this._symbol)},t.Ans.prototype._getConcreteTree=function(e,t){if(void 0===t[this._symbol])throw r.ansUndefined();return g.prototype._getConcreteTree.call(this,e,t)},t.Equation.prototype._getConcreteTree=function(e,t){return this.asComparator().getConcreteTree(e,t)},t.Constant.prototype._getConcreteTree=function(e,t){return new this.constructor(this._constantValue)},t.Seed.prototype._getConcreteTree=function(e,t){return new this.constructor(this._stringValue)},t.Derivative.prototype._getConcreteTree=function(e,i){var o;if(i[this._symbol]){var a=Object.create(i);a[this._symbol]=t.FreeVariable(this._symbol);var s=i[this._symbol].getConcreteTree(e,i);if(s.valueType!==n.Number&&s.valueType!==n.ListOfNumber)throw r.derivativeVariableTypeError(this._symbol,[n.prettyPrint(s.valueType)]);var u={};return u[this._symbol]=s,o=this.args[0].getConcreteTree(e,a),this.typeCheck(e,[o]),o.takeDerivative(this._symbol).substitute(u).getConcreteTree(e,i)}return o=this.args[0].getConcreteTree(e,i),this.typeCheck(e,[o]),o.takeDerivative(this._symbol).getConcreteTree(e,i)},t.DoubleInequality.prototype._getConcreteTree=function(e,r){return new this.constructor([t.Piecewise([this._indicator,this._expressions[0],h(NaN)]).getConcreteTree(e,r),this._operators[0],g(this._symbol),this._operators[1],t.Piecewise([this._indicator,this._expressions[1],h(NaN)]).getConcreteTree(e,r)])},t.Expression.prototype._getConcreteTree=function(e,t){var r=_(this.args,e,t);return this.typeCheck(e,r),this._constantCollapsedCopy(e,r)},t.Add.prototype._getConcreteTree=function(e,r){var i=_(this.args,e,r);return n.isOneOf(i[0].valueType,[n.Point,n.ListOfPoint])&&n.isOneOf(i[1].valueType,[n.Point,n.ListOfPoint])?t.BuiltInFunction.addPoints(this.args).getConcreteTree(e,r):O.call(this,e,r)},t.Subtract.prototype._getConcreteTree=function(e,r){var i=_(this.args,e,r);return n.isOneOf(i[0].valueType,[n.Point,n.ListOfPoint])&&n.isOneOf(i[1].valueType,[n.Point,n.ListOfPoint])?t.BuiltInFunction.subtractPoints(this.args).getConcreteTree(e,r):O.call(this,e,r)},t.Multiply.prototype._getConcreteTree=function(e,r){var i=_(this.args,e,r);return n.isOneOf(i[0].valueType,[n.Point,n.ListOfPoint])&&n.isOneOf(i[1].valueType,[n.Number,n.ListOfNumber])?t.BuiltInFunction.multiplyPoint(this.args).getConcreteTree(e,r):n.isOneOf(i[0].valueType,[n.Number,n.ListOfNumber])&&n.isOneOf(i[1].valueType,[n.Point,n.ListOfPoint])?t.BuiltInFunction.multiplyPoint([this.args[1],this.args[0]]).getConcreteTree(e,r):O.call(this,e,r)},t.Divide.prototype._getConcreteTree=function(e,r){var i=_(this.args,e,r);return n.isOneOf(i[0].valueType,[n.Point,n.ListOfPoint])&&n.isOneOf(i[1].valueType,[n.Number,n.ListOfNumber])?t.BuiltInFunction.dividePoint(this.args).getConcreteTree(e,r):O.call(this,e,r)},t.Negative.prototype._getConcreteTree=function(e,r){var i=_(this.args,e,r);return n.isOneOf(i[0].valueType,[n.Point,n.ListOfPoint])?t.BuiltInFunction.negatePoint(this.args).getConcreteTree(e,r):O.call(this,e,r)},t.Error.prototype._getConcreteTree=function(e,t){return this},t.FreeVariable.prototype._getConcreteTree=function(e,t){return this},t.FunctionCall.prototype._getConcreteTree=function(e,t){var o="logbase"===this._symbol?"log":i.latexToIdentifier(this._identifier.getInputString()),a=t[this._symbol];if(a&&a.isError)throw a;if(!a||!a.isFunction){if(b.hasOwnProperty(this._symbol))throw"logbase"===this._symbol&&t.ln&&t.log?r.logbaseUnsupported():r.functionUnsupported(o);if(a&&a.getConcreteTree(e,t).valueType===n.Distribution)throw r.distributionAsFunction(a._symbol);if(1==this.args.length){var s=[g(this._symbol),this.args[0]];return y(s).getConcreteTree(e,t)}if(a)throw r.variableAsFunction(o);throw r.functionNotDefined(o)}var u=_(this.args,e,t);return a.getConcreteInvocationTree(e,t,u,o)},t.DotAccess.prototype._getConcreteTree=function(e,n){var o,a,s=this.args[0],u=this.args[1];if(u instanceof t.Identifier)return a=i.latexToIdentifier(u.getInputString()),o=[s],w(u._symbol,a,o,e,n);if(u instanceof t.SeededFunctionCall)return a=i.latexToIdentifier(u._identifier.getInputString()),o=[u.seed,s].concat(u.args.slice(1)),w(u._symbol,a,o,e,n);if(u instanceof t.FunctionCall)return"x"===u._symbol&&1===u.args.length?t.Multiply([t.OrderedPairAccess([s,t.Constant(1)]),u.args[0]]).getConcreteTree(e,n):"y"===u._symbol&&1===u.args.length?t.Multiply([t.OrderedPairAccess([s,t.Constant(2)]),u.args[0]]).getConcreteTree(e,n):(a=i.latexToIdentifier(u._identifier.getInputString()),o=[s].concat(u.args),w(u._symbol,a,o,e,n));throw r.unexpectedSymbol(".")},t.DotAccessExponent.prototype._getConcreteTree=function(e,r){return"FunctionCall"!==this.args[1].type||1!==this.args[1].args.length||r[this.args[1]._symbol]&&r[this.args[1]._symbol].isFunction?t.Exponent([t.DotAccess([this.args[0],this.args[1]]),this.args[2]]).getConcreteTree(e,r):t.Multiply([t.DotAccess([this.args[0],t.Identifier(this.args[1]._symbol)]),t.Exponent([this.args[1].args[0],this.args[2]])]).getConcreteTree(e,r)},t.FunctionExponent.prototype._getConcreteTree=function(e,r){var n=this.args[0]._symbol;return r[n]&&r[n].isFunction?t.Exponent([t.FunctionCall(n,[this.args[1]]),this.args[2]]).getConcreteTree(e,r):y([this.args[0],t.Exponent([this.args[1],this.args[2]])]).getConcreteTree(e,r)},t.FunctionFactorial.prototype._getConcreteTree=function(e,r){var n=this.args[0]._symbol;return r[n]&&r[n].isFunction?t.FunctionCall("\\factorial",[t.FunctionCall(n,[this.args[1]])]).getConcreteTree(e,r):y([this.args[0],t.FunctionCall("\\factorial",[this.args[1]])]).getConcreteTree(e,r)},t.FunctionDefinition.prototype._getConcreteTree=function(e,t){for(var n=0;n<this._argSymbols.length;n++){if(t[this._argSymbols[n]])throw r.parameterAlreadyDefined(this._argSymbols[n]);if(this._argSymbols[n]===this._symbol)throw r.parameterAlreadyDefined(this._argSymbols[n])}return this._expression.getConcreteTree(e,t)},t.Image.prototype._getConcreteTree=function(e,r){var i=this.center.tryGetConcreteTree(e,r),o=this.radianAngle.tryGetConcreteTree(e,r),a=this.width.tryGetConcreteTree(e,r),s=this.height.tryGetConcreteTree(e,r),u=this.opacity.tryGetConcreteTree(e,r),c=[n.Point,n.ListOfPoint],l=[n.Number,n.ListOfNumber],i=E(i,c),o=E(o,l),a=E(a,l),s=E(s,l),u=E(u,l);return t.Image({center:i,radianAngle:o,width:a,height:s,opacity:u},this.moveStrategy)},t.Simulation.prototype._getConcreteTree=function(e,r){var n=this.fps.tryGetConcreteTree(e,r);return t.Simulation(n)},t.Slider.prototype._getConcreteTree=function(e,t){var n,i,o,a,u,c,l,p,f,d=this._expression.getConcreteTree(e,t),m=C(this.sliderMin&&this.sliderMin.tryGetConcreteTree(e,t)),y=C(this.sliderMax&&this.sliderMax.tryGetConcreteTree(e,t)),g=C(this.sliderStep&&this.sliderStep.tryGetConcreteTree(e,t)),v={exportedSymbol:this._symbol,errors:{},values:{},valids:{},missingVars:[],errMsg:void 0};return M("min",m,v),M("max",y,v),M("step",g,v),g&&v.valids.step&&(0===v.values.step?delete v.values.step:v.values.step=Math.abs(v.values.step)),v.errors.cycle?d=r.sliderLimitReferencesExport(v.exportedSymbol):(v.errors.min||!v.valids.min?v.errMsg=r.sliderMinInvalid():v.errors.max||!v.valids.max?v.errMsg=r.sliderMaxInvalid():!v.errors.step&&v.valids.step||(v.errMsg=r.sliderStepInvalid()),v.values.min>v.values.max&&(v.valids.min=!1,v.valids.max=!1,v.errMsg||(v.errMsg=r.sliderMaxLessThanMin()))),d.isConstant&&(n=t.initialEvaluation&&t.initialEvaluation.asValue()&&this.sliderIsPlayingOnce,i=v.values.max,o=+d.asValue(),a=v.values.min,u=v.values.step,!n||isFinite(i)||(c=C(this.sliderSoftMax&&this.sliderSoftMax.tryGetConcreteTree(e,t)))&&(i=x.computeSoftMax({storedMax:+c.asValue(),sliderValue:o,step:u,hardMin:a})),l=x.constrainSliderValueLikeEvaluator({target:o,hardMin:a,hardMax:i,step:u,forceSliderToMax:n}),p=s.fromDecimalString(l.toString()),f=isFinite(s.asFloat(p))?p:l,d=h(f)),d.sliderInfo=v,d},t.Integral.prototype._getConcreteTree=function(e,t){if(t[this._differential._symbol])throw r.shadowedIntegrationVariable(this._differential._symbol);var n=this.args[0],i=this.args[1].getConcreteTree(e,t),o=this.args[2].getConcreteTree(e,t);if(i.dependsOn(n._symbol)||o.dependsOn(n._symbol))throw r.badIntegralBoundDependency(n._symbol);var a=Object.create(t);return a[this._differential._symbol]=v(this._differential._symbol),d.prototype._getConcreteTree.call(this,e,a)},t.ListAccess.prototype._getConcreteTree=function(e,t){var i,o=this.list.getConcreteTree(e,t);if(this.index instanceof p&&this.index.isHalfEmpty()){if(i=p([this.index.beginning,l([h(u(o.length,1))])]).getConcreteTree(e,t),Math.round(+i.args[0].asValue())>o.length)return l([])}else i=this.index.getConcreteTree(e,t);var a=[o,i];this.typeCheck(e,a);var s=i.getDependencies();if(s.length){if(i.isList)throw r.variableListIndicies(s);if(i.valueType===n.ListOfBool)throw r.variableFilter(s)}if(i.isList){if(i.valueType===n.EmptyList)return l([]);var c=[],f=0;if(i.valueType===n.ListOfNumber){for(;f<i.length;f++){var d=i.args[f];c.push(o.elementAt(e,d.asValue()-1))}return l(c)}if(i.valueType===n.ListOfBool){for(;f<i.length;f++){i.args[f]._constantValue&&c.push(o.elementAt(e,f))}return l(c)}}return this._constantCollapsedCopy(e,a)},t.List.prototype._getConcreteTree=function(e,t){var r=_(this.args,e,t);return this.typeCheck(e,r),new this.constructor(r)},t.ParametrizedReducerFunction.prototype._getConcreteTree=function(e,r){if(this.args[0]instanceof t.List&&this.args[0].valueType===n.ListOfDistribution)return t.List(t.List.mapArgs(e,[this.args[0]],function(t){return this.copyWithArgs([t[0],this.args[1]]).getConcreteTree(e,r)}.bind(this)));if(this.args[0]instanceof t.Distribution)return this.args[0][this._symbol](this.args.slice(1)).getConcreteTree(e,r);var i=_(this.args,e,r);switch(P([i[1]],this.getDummyDependencies())){case"none":return this.typeCheck(e,i),this._constantCollapsedCopy(e,i);case"empty":return t.List([]);case"list":return t.List(t.List.mapArgs(e,[i[1]],function(t){return t=[i[0]].concat(t),this.typeCheck(e,t),this._constantCollapsedCopy(e,t)}.bind(this)));case"broadcast":var o=k([i[1]]),a=[i[0]].concat(o.concreteArgs);return this.typeCheck(e,a),t.Broadcast(o.replacedSymbols,[this.copyWithArgs(a)].concat(o.replacedArgs))}},t.Prime.prototype._getConcreteTree=function(e,t){var n=this.args[0],i=n.args[0];if(!t[n._symbol])throw r.functionNotDefined(n._symbol);var o,a=this.tmpVar();if("logbase"===n._symbol){if(2!==n.args.length)throw r.primedFunctionArity();o=[g(a),n.args[1]]}else{if(1!==n.args.length)throw r.primedFunctionArity();o=[g(a)]}for(var s=n.copyWithArgs(o).getConcreteTree(e,t),u=0;u<this.order;u++)s=s.takeDerivative(a);var c={};return c[a]=i,s.substitute(c).getConcreteTree(e,t)},t.Range.prototype._getConcreteTree=function(e,t){var n=this.beginning.getConcreteTree(e,t),i=this.end.getConcreteTree(e,t);if(n.getDependencies().length)throw r.variableRange(n.getDependencies());if(i.getDependencies().length)throw r.variableRange(i.getDependencies());if(!n.isList||!i.isList)throw new Error("Programming Error: range bounds must be List nodes.");var o,a,s,p=n.elementAt(e,0).asValue(),f=i.elementAt(e,i.length-1).asValue()-p;s=1===n.length?0<=f?1:-1:(o=n.elementAt(e,1).asValue(),a=c(p,o),n.elementAt(e,1).asValue()-p);var d=Math.round(f/s)+1;if(!isFinite(d)||d<n.length||d<i.length)throw r.nonArithmeticRange();var m,y=[];if(a)for(var g=a.nstart,v=0;v<d;v++)I(e,n,i,v,d,g/a.lcm),y.push(h(u(g,a.lcm))),g+=a.nstep;else for(y.push(h(p)),v=1;v<d;v++)I(e,n,i,v,d,m=p+v*s),y.push(h(u(m,1)));return l(y)},t.ReducerFunction.prototype._getConcreteTree=function(e,r){if(this.args[0]instanceof t.List&&this.args[0].valueType===n.ListOfDistribution&&"length"!==this._symbol)return t.List(t.List.mapArgs(e,this.args,function(t){return this.copyWithArgs(t).getConcreteTree(e,r)}.bind(this)));if(this.args[0]instanceof t.Distribution&&"length"!==this._symbol)return this.args[0][this._symbol]().getConcreteTree(e,r);var i=_(this.args,e,r);if(1===this.args.length)return i=[t.List.wrap(i[0])],this.typeCheck(e,i),this._constantCollapsedCopy(e,i);switch(P(i,this.getDummyDependencies())){case"none":return i=[t.List(i)],this.typeCheck(e,i),this._constantCollapsedCopy(e,i);case"empty":return t.List([]);case"list":return t.List(t.List.mapArgs(e,i,function(r){return r=[t.List(r)],this.typeCheck(e,r),this._constantCollapsedCopy(e,r)}.bind(this)));case"broadcast":var o=k(i),i=[t.List(o.concreteArgs)];return this.typeCheck(e,i),t.Broadcast(o.replacedSymbols,[this.copyWithArgs(i)].concat(o.replacedArgs))}},t.RepeatedOperator.prototype._getConcreteTree=function(e,n){if(n[this._index._symbol])throw r.shadowedIndex(this._index._symbol);var i=this.args[1].getConcreteTree(e,n),o=this.args[2].getConcreteTree(e,n);if(i.dependsOn(this._index._symbol)||o.dependsOn(this._index._symbol))throw this instanceof t.Sum?r.badSumBoundDependency(this._index._symbol):this instanceof t.Product?r.badProductBoundDependency(this._index._symbol):r.parseError();var a=Object.create(n);return a[this._index._symbol]=v(this._index._symbol),d.prototype._getConcreteTree.call(this,e,a)};var O=function(e,r){var n=_(this.args,e,r);switch(P(n,this.getDummyDependencies())){case"none":return this.typeCheck(e,n),this._constantCollapsedCopy(e,n);case"empty":return t.List([]);case"list":return t.List(t.List.mapArgs(e,n,function(t){return this.typeCheck(e,t),this._constantCollapsedCopy(e,t)}.bind(this)));case"broadcast":var i=k(n);return this.typeCheck(e,i.concreteArgs),t.Broadcast(i.replacedSymbols,[this.copyWithArgs(i.concreteArgs)].concat(i.replacedArgs))}};function D(e,i){if(!i[this._symbol])throw r.functionUnsupported(this._symbol);var o=this.args.map(function(t){return t.getConcreteTree(e,i)});if(0<o.length){if(1===o.length&&o.push(t.Constant(1)),o[1].getDependencies().length)throw r.illegalBinWidth(this._symbol).setDependencies(o[1].getDependencies());if(o[1].valueType!==n.Number)throw r.illegalBinWidth(this._symbol);var a=o[1].asValue();if(!isFinite(a)||a<=0)throw r.illegalBinWidth(this._symbol)}return this.typeCheck(e,o),new this.constructor(o)}t.ScalarExpression.prototype._getConcreteTree=O,t.Object3D.prototype._getConcreteTree=O,t.Piecewise.prototype._getConcreteTree=function(e,t){var i=_(this.args,e,t),o=i[0];if(o.isConstant&&o.valueType===n.Bool&&i[1].valueType===i[2].valueType)return o.asValue()?i[1]:i[2];if(o.valueType===n.Bool&&n.isList(i[1].valueType)&&n.isList(i[2].valueType)&&i[1].length!==i[2].length)throw r.piecewiseBranchLengthError(o.getDependencies()[0]);return O.call(this,e,t)},t.Regression.prototype._getConcreteTree=function(e,t){return new this.constructor(this._lhs,this._rhs)},t.Polygon.prototype._getConcreteTree=function(e,t){var i=this.args.map(function(r){return r.getConcreteTree(e,t)});return this.typeCheck(e,i),1===i.length&&i[0].valueType===n.ListOfPoint?new this.constructor(i):i.every(function(e){return e.valueType===n.Point})?new this.constructor([l(i)]):2===i.length?new this.constructor([f(this.args).getConcreteTree(e,t)]):r.parseError()},t.Histogram.prototype._getConcreteTree=D,t.DotPlot.prototype._getConcreteTree=D,t.BoxPlot.prototype._getConcreteTree=function(e,t){if(!t[this._symbol])throw r.functionUnsupported(this._symbol);var i=this.args.map(function(r){return r.getConcreteTree(e,t)});return this.typeCheck(e,i),1!==i.length||i[0].valueType!==n.ListOfNumber&&i[0].valueType!==n.EmptyList?r.parseError():new this.constructor(i)},t.TTest.prototype._getConcreteTree=function(e,t){if(!t[this._symbol])throw r.functionUnsupported(this._symbol);var n=this.args.map(function(r){return r.getConcreteTree(e,t)});return this.typeCheck(e,n),new this.constructor(n)},t.IndependentTTest.prototype._getConcreteTree=function(e,t){if(!t[this._symbol])throw r.functionUnsupported(this._symbol);var n=this.args.map(function(r){return r.getConcreteTree(e,t)});return this.typeCheck(e,n),new this.constructor(n)},t.SolvedEquation.prototype._getConcreteTree=function(e,t){return new this.constructor(this._symbol,this._expression.getConcreteTree(e,t))},t.Table.prototype._getConcreteTree=function(e,t){for(var r=[],n=Object.create(t),i=0;i<this.columns.length;i++){var o=this.columns[i].getConcreteTree(e,n,t);o.isIndependent&&this.columns[i].exportToLocal(o,n),r.push(o)}return new this.constructor(r)},t.TableColumn.prototype._getConcreteTree=function(e,t,i){var o,a,s=this.header.getConcreteTree(e,t);if(s.isFreeVariable){o=[];for(var u,c=0;c<this.values.length;c++){this.values[c].tableError()?o.push(r.invalidTableEntry(this.values[c].tableError())):(u=this.values[c].tryGetConcreteTree(e,t)).isError?o.push(u):u.tableError()?o.push(r.invalidTableEntry(u.tableError())):u.valueType===n.Number?o.push(u):o.push(r.tableEntryTypeError([n.prettyPrint(u.valueType)]))}return(a=new this.constructor(s,this.length,o)).isIndependent=!0,a}if(s.isConstant){for(var l=[],p=0;p<this.length;p++)l.push(s);o=l}else o=s.isList?s.args.slice():[];return(s=this.header.getConcreteTree(e,i)).isError||s.valueType===n.Number||s.valueType===n.ListOfNumber||s.valueType===n.EmptyList||(s=r.tableHeaderTypeError([n.prettyPrint(s.valueType)])),a=new this.constructor(s,this.length,o)},t.BuiltInFunction.pdf.prototype._getConcreteTree=function(e,i){if(this.args[0]instanceof l)return t.List(t.List.mapArgs(e,this.args,function(t){return this.copyWithArgs(t).getConcreteTree(e,i)}.bind(this)));if(this.typeCheck(e,this.args),!(this.args[0]instanceof t.Distribution))throw r.functionTypeError(this._symbol,[n.prettyPrint(this.args[0].valueType)]);return this.args[0].pdf([this.args[1]]).getConcreteTree(e,i)},t.BuiltInFunction.cdf.prototype._getConcreteTree=function(e,i){var o=this.args;if(2===o.length&&(o=[o[0],t.Constant(-1/0),o[1]]),o[0]instanceof t.List)return t.List(t.List.mapArgs(e,o,function(t){return this.copyWithArgs(t).getConcreteTree(e,i)}.bind(this)));if(this.typeCheck(e,o),!(o[0]instanceof t.Distribution))throw r.functionTypeError(this._symbol,[n.prettyPrint(o[0].valueType)]);return o[0].cdf(o.slice(1)).getConcreteTree(e,i)},t.BuiltInFunction.random.prototype._getConcreteTree=function(e,n){var i=this.args;(i.length<=1||!(i[1]instanceof t.Distribution)&&!(i[1]instanceof t.List)&&i.length<4)&&(i=[i[0],b.uniformdist([])].concat(i.slice(1)));var o=i[0],a=i[1],s=i[2],c=i[3];if(this.typeCheck(e,i.slice(1)),s&&s.getDependencies().length)throw r.variableSampleSize(s.getDependencies());if(c&&c.getDependencies().length)throw r.variableSeed(c.getDependencies());if(c&&(o=m("us",[o,c])),s){var p=s.asValue();if(p<1)throw r.badSampleSize();p=Math.round(p);for(var f,d=[],y=0;y<p;y++)f=m("lc",[o,h(u(y,1))]),d.push(a.sample([f]).getConcreteTree(e,n));return l(d)}return a.sample([o]).getConcreteTree(e,n)},t.BuiltInFunction.shuffle.prototype._getConcreteTree=function(e,n){var i=this.args;this.typeCheck(e,i.slice(1));var a,s=i[0],u=i[1],c=i[2];if(c&&c.getDependencies().length)throw r.variableSeed(c.getDependencies());if(c&&(s=m("us",[s,c])),"List"===u.type)return a=u.args.slice(),o.shuffle(s.asValue(),a),l(a);if("Broadcast"!==u.type)throw r.parseError();for(var p=u,f=[p._expression],d=o.randomPerm(s.asValue(),p.length),h=0;h<p._lists.length;h++){a=[];for(var y=0;y<d.length;y++)a.push(p._lists[h].args[d[y]]);f.push(t.List(a))}return p.copyWithArgs(f)},t.BuiltInFunction.sort.prototype._getConcreteTree=function(e,n){var i=this.args;if(1===i.length&&(i=i.concat(i[0])),this.typeCheck(e,i),0!==i[1].getDependencies().length)throw r.functionFreeVariable(this._errorSymbol,i[1].getDependencies()[0]);if("List"!==i[1].type)throw r.parseError();var a,s=i[1].asValue(),u=o.sortPerm(s);if("List"===i[0].type){for(a=[],f=0;f<Math.min(u.length,i[0].args.length);f++)a.push(i[0].args[u[f]]);return t.List(a)}if("Broadcast"!==i[0].type)throw r.parseError();for(var c=[i[0]._expression],l=0;l<i[0]._lists.length;l++){a=[];for(var p=i[0]._lists[l].args,f=0;f<Math.min(u.length,p.length);f++)a.push(p[u[f]]);c.push(t.List(a))}return i[0].copyWithArgs(c)},t.BuiltInFunction.join.prototype._getConcreteTree=function(e,r){var n=this.args;this.typeCheck(e,n);for(var i=[],o=0;o<n.length;o++){var a=n[o];if("Broadcast"===a.type&&(a=a.asList(e)),"List"===a.type)for(var s=0;s<a.args.length;s++)i.push(a.args[s]);else i.push(a)}return t.List(i)}});r("core/math/features/getValueType",["require","parsenodes","core/math/types"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/types");function n(){return r.Number}function i(){return r.Bool}function o(e){for(var t=0;t<e.length;t++)if(e[t].valueType===r.Point)return r.Point;return r.Number}var a={Add:o,Multiply:o,Divide:o,Subtract:o,Exponent:n,Negative:o,And:i,Piecewise:function(e){return e[1].valueType},BaseComparator:i,RepeatedOperator:n,List:function(e){if(0===e.length)return r.EmptyList;for(var t=e[0].valueType,n=1;n<e.length;n++)if(e[n].valueType!==t)return r.ListOfAny;return r.hasListType(t)?r.listType(t):r.ListOfAny},ListAccess:function(e){return r.elementType(e[0].valueType)},Broadcast:function(e){return r.listType(e[0].valueType)},Seed:function(e){return r.SeedType},ExtendSeed:function(e){return r.SeedType},OrderedPairAccess:n,OrderedPair:function(){return r.Point},RGBColor:function(){return r.RGBColor},NativeFunction:n,ReducerFunction:n,DoubleReducerFunction:n,ParametrizedReducerFunction:n,Distribution:function(){return r.Distribution},DummyIndex:n,FreeVariable:n,TypedFunction:function(){return this._outputType},Derivative:n,Integral:n,Identifier:function(){return r.Any}};for(var s in a)t[s].prototype._getValueType=a[s]});r("core/math/features/typeCheck",["require","parsenodes","core/math/types","core/math/errormsg"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/types"),n=e("core/math/errormsg"),i=r.isOneOf;function o(e){for(var t=[],n=0;n<e.length;n++)t.push(r.prettyPrint(e[n].valueType));return t}function a(e,t){return function(r,n){for(var i=0;i<n.length;i++)if(n[i].valueType!==e[i])throw t(o(n))}}function s(e,t){var o=t.length,a=t[0];if(o<2)throw n.methodRequiresList(this._symbol);if(!i(a.valueType,[r.ListOfNumber,r.EmptyList]))throw n.methodRequiresList(this._symbol);if(2<o)throw n.tooManyArguments(this._symbol,2)}var u={Add:a([r.Number,r.Number],n.addTypeError),Multiply:a([r.Number,r.Number],n.multiplyTypeError),Divide:a([r.Number,r.Number],n.divideTypeError),Subtract:a([r.Number,r.Number],n.subtractTypeError),Exponent:a([r.Number,r.Number],n.exponentTypeError),Negative:a([r.Number],n.negativeTypeError),BaseComparator:a([r.Number,r.Number],n.comparatorTypeError),And:a([r.Bool,r.Bool],n.andTypeError),ExtendSeed:function(e,t){if(2!==t.length||t[0].valueType!==r.SeedType||!i(t[1].valueType,[r.SeedType,r.Number]))throw n.functionUnsupported("random")},List:function(e,t){if(0!==t.length){var i=t[0].valueType;if(!r.hasListType(i))throw n.listTypeError([r.prettyPrint(i)]);for(var o=0;o<t.length;o++){var a=t[o].valueType;if(!r.hasListType(a))throw n.listTypeError([r.prettyPrint(a)]);if(a!==i)throw n.heterogeneousList()}}},Broadcast:function(e,t){},Distribution:function(e,t){},RGBColor:function(e,t){},OrderedPair:function(e,t){if(0===t.length)throw n.emptyParen();if(e.dimensions&&t.length!==e.dimensions())throw n.badTupleDimensions(e.dimensions());for(var i=0;i<t.length;i++){var o=t[i].valueType;if(o!==r.Number)throw n.pointTypeError(r.prettyPrint(o))}},Piecewise:function(e,t){if(t[0].valueType!==r.Bool)throw n.piecewiseConditionTypeError(o(t));if(t[1].valueType!==t[2].valueType)throw n.piecewiseBranchTypeError([r.prettyPrint(t[1].valueType),r.prettyPrint(t[2].valueType)])},ListAccess:function(e,t){var i=r.isList(t[0].valueType),a=t[1].valueType,s=a===r.EmptyList||a===r.Number||a===r.ListOfNumber||a===r.ListOfBool;if(!i||!s)throw n.indexTypeError(o(t))},OrderedPairAccess:a([r.Point,r.Number],n.orderedPairAccessTypeError),Sum:function(e,t){if(t[1].valueType!==r.Number)throw n.sumLowerBoundTypeError([r.prettyPrint(t[1].valueType)]);if(t[2].valueType!==r.Number)throw n.sumUpperBoundTypeError([r.prettyPrint(t[2].valueType)]);if(t[3].valueType!==r.Number)throw n.sumArgumentTypeError([r.prettyPrint(t[3].valueType)])},Product:function(e,t){if(t[1].valueType!==r.Number)throw n.productLowerBoundTypeError([r.prettyPrint(t[1].valueType)]);if(t[2].valueType!==r.Number)throw n.productUpperBoundTypeError([r.prettyPrint(t[2].valueType)]);if(t[3].valueType!==r.Number)throw n.productArgumentTypeError([r.prettyPrint(t[3].valueType)])},Integral:function(e,t){if(t[1].valueType!==r.Number)throw n.integralLowerBoundTypeError([r.prettyPrint(t[1].valueType)]);if(t[2].valueType!==r.Number)throw n.integralUpperBoundTypeError([r.prettyPrint(t[2].valueType)]);if(t[3].valueType!==r.Number)throw n.integralArgumentTypeError([r.prettyPrint(t[3].valueType)])},NativeFunction:function(e,t){var i=this._errorSymbol,a=t.length,s="logbase"===this._symbol?1:0;if(a<this._requiredArity)throw n.wrongArity(i,this._requiredArity-s,a-s);if(a>this._maxArity)throw n.wrongArity(i,this._maxArity-s,a-s);for(var u=0;u<t.length;u++){if(t[u].valueType!==r.Number)throw n.functionTypeError(i,o(t))}},ReducerFunction:function(e,t){if(!i(t[0].valueType,[r.ListOfNumber,r.EmptyList]))throw n.functionTypeError(this._symbol,o(t))},DoubleReducerFunction:function(e,t){var a=t[0],s=t[1];if(!r.isList(a.valueType)||!r.isList(s.valueType))throw n.nonListDoubleReducer(this._symbol);if(!i(a.valueType,[r.ListOfNumber,r.EmptyList])||!i(s.valueType,[r.ListOfNumber,r.EmptyList]))throw n.functionTypeError(this._symbol,o(t))},ParametrizedReducerFunction:function(e,t){if(!i(t[0].valueType,[r.ListOfNumber,r.EmptyList]))throw n.nonListParametrizedReducer(this._symbol);if(t[1].valueType!==r.Number)throw n.functionTypeError(this._symbol,o(t))},TypedFunction:function(e,t){var r=this._errorSymbol,a=t.length,s="pdf"===this._symbol,u="cdf"===this._symbol;if(a<this._requiredArity){if(s)throw n.pdfWrongArity();if(u)throw n.cdfRequiresArguments();throw n.wrongArity(r,this._requiredArity,a)}if(a>this._maxArity){if(s)throw n.pdfWrongArity();if(u)throw n.cdfTooManyArguments();throw n.wrongArity(r,this._maxArity,a)}for(var c=0;c<t.length;c++){var l=t[c].valueType,p=this._inputTypes[c],f=Array.isArray(p);if(!f&&l!==p||f&&!i(l,p))throw n.functionTypeError(r,o(t))}},Derivative:function(e,t){if(!i(t[0].valueType,[r.Number,r.ListOfNumber,r.EmptyList,r.Point,r.ListOfPoint]))throw n.derivativeTypeError(o(t))},Regression:function(e,t){if(!i(t[0].valueType,[r.Number,r.ListOfNumber])||!i(t[1].valueType,[r.Number,r.ListOfNumber]))throw n.regressionTypeError(o(t))},Polygon:function(e,t){if(1===t.length&&t[0].valueType!==r.ListOfPoint)throw n.polygonListTypeError(o(t));if(2===t.length&&t[0].valueType===r.Number&&t[1].valueType===r.Number)throw n.polygonTwoNumbersError();if(2<t.length&&!t.every(function(e){return e.valueType===r.Point}))throw n.polygonPointArgsError()},Object3D:function(e,t){if(t.length<3)throw n.wrongArity(this._symbol,3,t.length)},Histogram:s,DotPlot:s,BoxPlot:function(e,t){var o=t.length,a=t[0];if(0===o)throw n.methodRequiresList(this._symbol);if(!i(a.valueType,[r.ListOfNumber,r.EmptyList]))throw n.methodRequiresList(this._symbol);if(1<o)throw n.methodRequiresList(this._symbol)},TTest:function(e,t){var i=this._symbol;if(0===t.length)throw n.methodRequiresList(i);if(t[0].valueType===r.EmptyList)throw n.ttestListTooShort(i);if(t[0].valueType!==r.ListOfNumber)throw n.methodRequiresList(i);if(2<t.length)throw n.tooManyArguments(i,2);if(t[0].length<2)throw n.ttestListTooShort(i);if(t[1]&&t[1].valueType!==r.Number)throw n.functionTypeError(i,o(t))},IndependentTTest:function(e,t){var i=this._symbol;if(2!==t.length)throw n.wrongDoubleReducerArity(i);if(!r.isList(t[0].valueType)||!r.isList(t[1].valueType))throw n.nonListDoubleReducer(i);if(t[0].valueType===r.EmptyList||t[1].valueType===r.EmptyList)throw n.ttestListTooShort("ittest");if(t[0].valueType!==r.ListOfNumber||t[1].valueType!==r.ListOfNumber)throw n.functionTypeError(i,o(t));if(t[0].args.length<2||t[1].args.length<2)throw n.ttestListTooShort("ittest")},Stats:function(e,t){var i=t.length,a=t[0];if(0===i)throw n.methodRequiresList(this._symbol);if(a.valueType===r.EmptyList)throw n.functionTypeError(this._symbol,o(t));if(a.valueType!==r.ListOfNumber)throw n.methodRequiresList(this._symbol);if(1<i)throw n.methodRequiresList(this._symbol)}};for(var c in u)t[c].prototype.typeCheck=u[c];t.BuiltInFunction.random.prototype.typeCheck=function(e,i){var o=i.length,a=i[0],s=i[1],u=i[2];if(3<o)throw n.randomArity();if(!a)throw n.randomArity();if(!(a instanceof t.Distribution||a instanceof t.List))throw n.randomArity();if(a instanceof t.Distribution&&a.args&&(a.args[0]instanceof t.List||a.args[1]instanceof t.List))throw n.randomFromBroadcastDistribution();if(s&&s.valueType!==r.Number)throw n.randomArity();if(u&&u.valueType!==r.Number)throw n.randomArity()},t.BuiltInFunction.shuffle.prototype.typeCheck=function(e,t){var i=t.length;if(i<1)throw n.wrongArity(this._errorSymbol,1,i,this.minArityUsageExample);if(2<i)throw n.wrongArity(this._errorSymbol,2,i,this.maxArityUsageExample);if(!r.isList(t[0].valueType)||2===i&&t[1].valueType!==r.Number)throw n.functionTypeError(this._errorSymbol,o(t))},t.BuiltInFunction.length.prototype.typeCheck=function(e,t){if(1!==t.length||!r.isList(t[0].valueType))throw n.parseError()},t.BuiltInFunction.sort.prototype.typeCheck=function(e,t){var a=t.length;if(a<1)throw n.wrongArity(this._errorSymbol,1,a,this.minArityUsageExample);if(2<a)throw n.wrongArity(this._errorSymbol,2,a,this.maxArityUsageExample);if(!r.isList(t[0].valueType)||!i(t[1].valueType,[r.ListOfNumber,r.EmptyList]))throw n.functionTypeError(this._errorSymbol,o(t))},t.BuiltInFunction.join.prototype.typeCheck=function(e,t){var i=t.length;if(i<this._requiredArity)throw n.wrongArity(this._errorSymbol,this._requiredArity,i,this.minArityUsageExample);var a=t[0].valueType;r.isList(a)||(a=r.listType(a));for(var s=1;s<t.length;s++){var u=t[s].valueType;if(r.isList(u)||(u=r.listType(u)),u!==r.EmptyList&&(a===r.EmptyList&&(a=u),u!==a))throw n.functionTypeError(this._errorSymbol,o(t))}}});r("core/math/features/repr",["require","parsenodes"],function(e){"use strict";function t(e,t,r){r=r||0;var n=Array(r+1).join("  "),i=n+"  ";return"[\n"+i+e.map(function(e){return e.repr(t,r+1)}).join(",\n"+i)+"\n"+n+"]"}function r(e,t){return""+(t=t||"")+e}var n=e("parsenodes");n.Expression.prototype.repr=function(e,n){return r(this.type,e)+"("+t(this.args,e,n)+")"},n.DoubleInequality.prototype.repr=function(e,t){t=t||0;var n=Array(t+1).join("  "),i=n+"  ";return r(this.type,e)+"([\n"+i+this.args[0].repr(e,t+1)+",\n"+i+"'"+this.args[1]+"',\n"+i+this.args[2].repr(e,t+1)+",\n"+i+"'"+this.args[3]+"',\n"+i+this.args[4].repr(e,t+1)+"\n"+n+"])"},n.Identifier.prototype.repr=n.FreeVariable.prototype.repr=function(e){return r(this.type,e)+"('"+this._symbol+"')"},n.Constant.prototype.repr=function(e){return r(this.type,e)+"("+this.asValue()+")"},n.ExtendSeed.prototype.repr=function(e,n){return r(this.type,e)+"('"+this.tag+"', "+t(this.args,e,n)+")"},n.Seed.prototype.repr=function(e){return r(this.type,e)+"("+this.asValue()+")"},n.FunctionCall.prototype.repr=function(e,n){return r(this.type,e)+"('"+this._symbol+"', "+t(this.args,e,n)+")"},n.Assignment.prototype.repr=function(e,t){return r(this.type,e)+"("+n.Identifier(this._symbol).repr(e,t)+", "+this._expression.repr(e,t)+")"},n.Regression.prototype.repr=n.Equation.prototype.repr=function(e,t){return r(this.type,e)+"("+this._lhs.repr(e,t)+", "+this._rhs.repr(e,t)+")"},n.FunctionDefinition.prototype.repr=function(e,i){return r(this.type,e)+"("+n.Identifier(this._symbol).repr(e,i)+", "+t(this._argSymbols.map(function(e){return n.Identifier(e)}),e,i)+", "+this._expression.repr(e,i)+")"},n.Error.prototype.repr=function(e,t){return r(this.type,e)+"('"+this._msg+"')"},n.Derivative.prototype.repr=function(e,n){return r(this.type,e)+"('"+this._symbol+"', "+t(this.args,e,n)+")"},n.SolvedEquation.prototype.repr=function(e,t){return r(this.type,e)+"('"+this._symbol+"', "+this._expression.repr(e,t)+")"},n.OptimizedRegression.prototype.repr=function(e,t){return r(this.type,e)+"("+JSON.stringify(this.parameters)+", "+JSON.stringify(this.residuals)+", "+JSON.stringify(this.statistics)+", "+this.model.repr(e,t+1)+", "+JSON.stringify({isModelValid:this.isModelValid,residualVariable:this.residualVariable,residualSuggestionId:this.residualSuggestionId,shouldSuggestLogMode:this.shouldSuggestLogMode,isLinear:this.isLinear,parameterWarning:this.parameterWarning})+")"},n.Table.prototype.repr=function(e,n){return r(this.type,e)+"("+t(this.columns,e,n)+")"},n.TableColumn.prototype.repr=function(e,n){return r(this.type,e)+"("+this.header.repr(e,n)+", "+this.length+", "+t(this.values,e,n)+")"},n.Image.prototype.repr=function(e,t){var n=Array(t+1).join("  "),i=n+"  ";return r(this.type,e)+"({\n"+i+"center: "+this.center.repr(e,t+1)+",\n"+i+"radianAngle: "+this.radianAngle.repr(e,t+1)+",\n"+i+"width: "+this.width.repr(e,t+1)+",\n"+i+"height: "+this.height.repr(e,t+1)+"},\n"+i+"opacity: "+this.opacity.repr(e,t+1)+",\n"+i+JSON.stringify(this.moveStrategy)+"\n"+n+")"},n.Simulation.prototype.repr=function(e){return r(this.type,e)+"({\n)"},n.Slider.prototype.repr=function(e,t){var n=Array(t+1).join("  "),i=n+"  ";return r(this.type,e)+"({\n"+i+"sliderAssignment: "+this.sliderAssignment.repr(e,t+1)+",\n"+i+"sliderMin: "+(this.sliderMin&&this.sliderMin.repr(e,t+1))+",\n"+i+"sliderMax: "+(this.sliderMax&&this.sliderMax.repr(e,t+1))+",\n"+i+"sliderStep: "+(this.sliderStep&&this.sliderStep.repr(e,t+1))+"},\n"+n+")"},n.Broadcast.prototype.repr=function(e,n){return r(this.type,e)+"(['"+this._replacedSymbols.join("', ")+"'], "+t(this.args,e,n)+")"}});r("core/math/features/scalarEvalExpression",["require","parsenodes","core/math/functions"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/functions"),n={Add:function(e){return"("+e.join("+")+")"},Multiply:function(e){return"("+e.join("*")+")"},Divide:function(e){return"("+e.join("/")+")"},Subtract:function(e){return"("+e.join("-")+")"},Exponent:function(e){return"BuiltIn.pow("+e.join(",")+")"},RawExponent:function(e){return"Math.pow("+e.join(",")+")"},Negative:function(e){return"(-"+e[0]+")"},And:function(e){return e.join("&&")},Piecewise:function(e){return"("+e[0]+"?"+e[1]+":"+e[2]+")"}},i={Add:2,Multiply:2,Divide:2,Subtract:2,Exponent:2,RawExponent:2,Negative:1,And:2,Piecewise:3};for(var o in n){var a=t[o].prototype;a.scalarEvalExpression=n[o],a.evaluate=r.createEvaluateFunction(a.scalarEvalExpression,i[o])}});r("core/math/reconstitute-node",["require","parsenodes","core/math/types"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/types");return function e(n,i){if(r.isList(n)){for(var o=[],a=0;a<i.length;a++)o.push(e(r.elementType(n),i[a]));var s=t.List(o);return s.valueType=n,s}switch(n){case r.Number:case r.Bool:return t.Constant(i);case r.Point:return t.OrderedPair([t.Constant(i[0]),t.Constant(i[1])]);case r.RGBColor:return t.RGBColor([t.Constant(i[0]),t.Constant(i[1]),t.Constant(i[2])]);default:throw new Error("Cannot reconstitute value of a "+r.prettyPrint(n)+".")}}});r("core/math/features/constantcollapsedcopy",["require","parsenodes","core/math/reconstitute-node","core/math/maybe-rational","core/math/errormsg"],function(e){"use strict";var t=e("parsenodes"),r=t.Constant,n=t.Multiply,i=t.Subtract,o=t.Exponent,a=t.RawExponent,s=t.Seed,u=t.BuiltInFunction,c=e("core/math/reconstitute-node"),l=e("core/math/maybe-rational"),p=e("core/math/errormsg");function f(e){if(e.isConstant){var t=e.asValue();return"number"==typeof t&&!isFinite(t)}}var d={Expression:function(e,t){return this.copyWithArgs(t)},FreeVariable:function(e,t){return this},ScalarExpression:function(e,t){for(var n=[],i=0;i<t.length;i++){if(!t[i].isConstant&&!t[i].isString)return this.copyWithArgs(t);n.push(t[i].asValue())}return r(this.evaluate(n))},TypedFunction:function(e,t){for(var r=[],n=0;n<t.length;n++){if(0!==t[n].getDependencies().length)return this.copyWithArgs(t);r.push(t[n].asValue())}return c(this._outputType,this.evaluate(r))},OrderedPair:function(e,t){return this.copyWithArgs(t)},RGBColor:function(e,t){return this.copyWithArgs(t)},Distribution:function(e,t){return this.copyWithArgs(t)},Add:function(e,t){return t[0].isConstant&&t[1].isConstant?r(l.add(t[0].asMaybeRationalValue(),t[1].asMaybeRationalValue())):0===t[0].asValue()?t[1]:0===t[1].asValue()?t[0]:this.copyWithArgs(t)},Multiply:function(e,t){return t[0].isConstant&&t[1].isConstant?r(l.mul(t[0].asMaybeRationalValue(),t[1].asMaybeRationalValue())):1===t[0].asValue()?t[1]:1===t[1].asValue()?t[0]:this.copyWithArgs(t)},Subtract:function(e,n){return n[0].isConstant&&n[1].isConstant?r(l.sub(n[0].asMaybeRationalValue(),n[1].asMaybeRationalValue())):0===n[0].asValue()?t.Negative([n[1]]):0===n[1].asValue()?n[0]:this.copyWithArgs(n)},Divide:function(e,t){return t[0].isConstant&&t[1].isConstant?r(l.div(t[0].asMaybeRationalValue(),t[1].asMaybeRationalValue())):1===t[1].asValue()?t[0]:this.copyWithArgs(t)},Exponent:function(e,t){if(t[0].isConstant&&t[1].isConstant)return r(l.pow(t[0].asMaybeRationalValue(),t[1].asMaybeRationalValue()));if(t[0].isConstant){if(t[0].asValue()===Math.E)return u.exp([t[1]]);if(0<t[0].asValue())return a(t)}if(t[1].isConstant){var i=t[1].asValue();if(1===i)return t[0];if(i===Math.floor(i))return a(t);var o=t[1].asMaybeRationalValue();return l.isRational(o)?o.d%2==1?n([o.n%2==0?r(l.maybeRational(1,1)):u.sign([t[0]]),a([u.abs([t[0]]),t[1]])]):a(t):this.copyWithArgs(t)}return this.copyWithArgs(t)},RawExponent:function(e,t){return t[0].isConstant&&t[1].isConstant?r(l.pow(t[0].asMaybeRationalValue(),t[1].asMaybeRationalValue())):this.copyWithArgs(t)},Negative:function(e,n){return n[0].isConstant?r(l.neg(n[0].asMaybeRationalValue())):n[0]instanceof t.Negative?n[0].args[0]:this.copyWithArgs(n)},And:function(e,t){return t[0].isConstant&&t[1].isConstant?r(t[0].asValue()&&t[1].asValue()):t[0].isConstant&&!0===t[0]?t[1]:t[0].isConstant&&!1===t[0]?r(!1):t[1].isConstant&&!0===t[1]?t[0]:t[1].isConstant&&!1===t[1]?r(!1):this.copyWithArgs(t)},Piecewise:function(e,t){return t[0].isConstant&&!0===t[0].asValue()?t[1]:t[0].isConstant&&!1===t[0].asValue()?t[2]:this.copyWithArgs(t)},Integral:function(e,t){var o=t[0],a=t[1],s=t[2],u=t[3],c=u.getDependencies();if(a.isConstant&&s.isConstant){var l=s.asValue()-a.asValue();if(u.isConstant)return r(u.asValue()*l);if(!u.dependsOn(o._symbol))return n([u,r(l)]);if(1===c.length&&c[0]===o._symbol)return r(this.evaluate(a.asValue(),s.asValue(),u))}else if(!u.dependsOn(o._symbol))return n([u,i([s,a])]);return this.copyWithArgs(t)},ListAccess:function(e,t){return t[1].isConstant?t[0].elementAt(e,t[1].asValue()-1):this.copyWithArgs(t)},OrderedPairAccess:function(e,r){return r[1].isConstant&&r[0]instanceof t.OrderedPair?r[0].elementAt(e,r[1].asValue()-1):this.copyWithArgs(r)},Broadcast:function(e,t){for(var r=t[0].getDependencies(),n=0;n<r.length;n++)if(-1===this._replacedSymbols.indexOf(r[n]))return this.copyWithArgs(t);for(n=1;n<t.length;n++)if(0!==t[n].getDependencies().length)return this.copyWithArgs(t);var i=t[0].getCompiledFunction(this._replacedSymbols).fn,o=t.slice(1).map(function(e){return e.asValue()}),a=[];for(n=0;n<this.length;n++){for(var s=[],u=0;u<o.length;u++)s.push(o[u][n]);a.push(i.apply(void 0,s))}return c(this.valueType,a)},ReducerFunction:function(e,t){return 0===t[0].getDependencies().length?c(this.valueType,this.evaluate([t[0].asValue()])):this.copyWithArgs(t)},DoubleReducerFunction:function(e,t){if(0!==t[0].getDependencies().length||0!==t[1].getDependencies().length)return this.copyWithArgs(t);var r=Math.min(t[0].length,t[1].length);return c(this.valueType,this.evaluate([t[0].asValue().slice(0,r),t[1].asValue().slice(0,r)]))},ParametrizedReducerFunction:function(e,t){var r=t[0],n=t[1];return n.isConstant&&0===r.getDependencies().length?c(this.valueType,this.evaluate([r.asValue(),n.asValue()])):this.copyWithArgs(t)},RepeatedOperator:function(e,t){var n=t[1],i=t[2];if(f(n)||f(i))switch(this.type){case"Sum":throw p.sumInfiniteBoundError();case"Product":throw p.productInfiniteBoundError();default:throw p.parseError()}if(n.isConstant&&i.isConstant){var o=n.asValue(),a=i.asValue(),s=t[3];if(s.isConstant)return r(this.evaluateConstant([o,a,s.asValue()]));var u=s.getDependencies();if(0===u.length||1===u.length&&u[0]===t[0]._symbol)return r(this.evaluate(o,a,s))}return this.copyWithArgs(t)},ExtendSeed:function(e,t){var r=t[0],n=t[1];return 0===r.getDependencies().length&&0===n.getDependencies().length?s(r.asValue()+"::"+this.tag+n.asValue()):this.copyWithArgs(t)}};for(var h in d)t[h].prototype._constantCollapsedCopy=d[h];u.mod.prototype._constantCollapsedCopy=function(e,t){return t[0].isConstant&&t[1].isConstant?r(l.mod(t[0].asMaybeRationalValue(),t[1].asMaybeRationalValue())):this.copyWithArgs(t)},u.sqrt.prototype._constantCollapsedCopy=function(e,t){return t[0].isConstant?r(l.sqrt(t[0].asMaybeRationalValue())):this.copyWithArgs(t)},u.nthroot.prototype._constantCollapsedCopy=function(e,t){var n=t[0],i=t[1];if(i.isConstant){if(n.isConstant)return r(l.nthroot(n.asMaybeRationalValue(),i.asMaybeRationalValue()));var a=[n,r(l.reciprocal(i.asMaybeRationalValue()))];return o(a)._constantCollapsedCopy(e,a)}return this.copyWithArgs(t)},u.abs.prototype._constantCollapsedCopy=function(e,t){return t[0].isConstant?r(l.abs(t[0].asMaybeRationalValue())):this.copyWithArgs(t)},u.total.prototype._constantCollapsedCopy=function(e,t){if(!t[0].isList)return this.copyWithArgs(t);for(var n=t[0].args,i=0;i<n.length;i++)if(!n[i].isConstant)return this.copyWithArgs(t);return r(l.total(t[0].asMaybeRationalValue()))}});r("core/math/features/polynomialorder",["require","parsenodes"],function(e){"use strict";var t,r=e("parsenodes"),n={Expression:"this.dependsOn(symbol) ? Infinity : 0",FreeVariable:"(symbol === this._symbol ? 1 : 0)",Constant:"0",Add:"Math.max(order0, order1)",Subtract:"Math.max(order0, order1)",Multiply:"order0 + order1",Negative:"order0",Divide:"order1 > 0 ? Infinity : order0"};for(var i in n){var o=n[i];r[i].prototype.polynomialOrder=(t=(t=(t=o).replace("order0","this.args[0].polynomialOrder(symbol)")).replace("order1","this.args[1].polynomialOrder(symbol)"),new Function(["symbol"],"return "+t))}r.Exponent.prototype.polynomialOrder=function(e){var t=this.args[0].polynomialOrder(e),r=this.args[1].polynomialOrder(e);if(0===t&&0===r)return 0;var n=this.args[1];return n.isConstant&&n.asValue()===Math.round(n.asValue())&&0<n.asValue()?t*n.asValue():1/0},r.Piecewise.prototype.polynomialOrder=function(e){return this.dependsOn(e)?this.args[2].isConstant&&this.args[2].isNaN()?this.args[1].polynomialOrder(e):1/0:0},r.List.prototype.polynomialOrder=function(e){return 1/0}});r("core/math/features/polynomialcoefficients",["require","parsenodes","core/math/maybe-rational"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/maybe-rational").maybeRational,n=t.Constant(r(0,1)),i=t.Constant(r(1,1));t.FreeVariable.prototype.getPolynomialCoefficients=function(e){return e===this._symbol?[n,i]:[this]},t.Constant.prototype.getPolynomialCoefficients=function(e){return[this]},t.Add.prototype.getPolynomialCoefficients=function(e){for(var r=this.args[0].getPolynomialCoefficients(e),n=this.args[1].getPolynomialCoefficients(e),i=r.length-1,o=n.length-1,a=[],s=0;s<=Math.max(i,o);s++)s<=i&&s<=o?a.push(t.Add([r[s],n[s]])):a.push(o<i?r[s]:n[s]);return a},t.Subtract.prototype.getPolynomialCoefficients=function(e){for(var r=this.args[0].getPolynomialCoefficients(e),n=this.args[1].getPolynomialCoefficients(e),i=r.length-1,o=n.length-1,a=[],s=0;s<=Math.max(i,o);s++)s<=i&&s<=o?a.push(t.Subtract([r[s],n[s]])):a.push(o<i?r[s]:t.Negative([n[s]]));return a},t.Negative.prototype.getPolynomialCoefficients=function(e){for(var r=this.args[0].getPolynomialCoefficients(e),n=[],i=0;i<r.length;i++)n.push(t.Negative([r[i]]));return n},t.Exponent.prototype.getPolynomialCoefficients=function(e){var r=this.args[0].getPolynomialCoefficients(e),i=this.args[1].getPolynomialCoefficients(e),o=r.length-1;if(0<i.length-1)throw"can't solve for variable in exponent";if(0==o)return[t.Exponent([r[0],i[0]])];if(this.args[1].isConstant)switch(this.args[1].asValue()){case 0:return[n];case 1:return r;case 2:return t.Multiply([this.args[0],this.args[0]]).getPolynomialCoefficients(e)}throw"Unable to compile polynomial representation"},t.Multiply.prototype.getPolynomialCoefficients=function(e){for(var r=this.args[0].getPolynomialCoefficients(e),n=this.args[1].getPolynomialCoefficients(e),i=r.length-1,o=n.length-1,a=[],s=0;s<=i;s++)for(var u=0;u<=o;u++){var c=t.Multiply([r[s],n[u]]),l=a[s+u];a[s+u]=void 0===l?c:t.Add([l,c])}return a},t.Divide.prototype.getPolynomialCoefficients=function(e){var r=this.args[0].getPolynomialCoefficients(e),n=this.args[1].getPolynomialCoefficients(e),i=[];if(0<n.length-1)throw"Can't solve for variable in denominator";for(var o=0;o<r.length;o++)i.push(t.Divide([r[o],n[0]]));return i},t.Expression.prototype.getPolynomialCoefficients=function(e){if(this.dependsOn(e))throw"Unimplemented polynomialCoefficient call";return[this]},t.Piecewise.prototype.getPolynomialCoefficients=function(e){return this.dependsOn(e)?this.args[1].getPolynomialCoefficients(e):[this]}});r("core/math/features/extractconditions",["require","parsenodes"],function(e){"use strict";var t=e("parsenodes");t.Expression.prototype.extractConditions=function(e,t){if(!this.dependsOn(e))return t;for(var r=0;r<this.args.length;r++){t=this.args[r].extractConditions(e,t)}return t},t.Piecewise.prototype.extractConditions=function(e,r){if(!this.dependsOn(e))return r;if(!this.args[0].dependsOn(e))return r=this.args[1].extractConditions(e,r),r=this.args[2].extractConditions(e,r);var n={};return n[e]=r,t.Piecewise([this.args[0].substitute(n),r,t.Constant(NaN)])}});r("core/math/features/piecewiseDependsOn",["require","parsenodes"],function(e){"use strict";var t=e("parsenodes");t.Expression.prototype.piecewiseDependsOn=function(e){if(!this.dependsOn(e))return!1;for(var t=0;t<this.args.length;t++){if(this.args[t].piecewiseDependsOn(e))return!0}return!1},t.Piecewise.prototype.piecewiseDependsOn=function(e){return this.dependsOn(e)}});r("core/math/domaintypes",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.intersectDomains=t.allReals=t.knownDomain=t.unknownDomain=t.emptyDomain=void 0,t.emptyDomain=function(){return{type:"empty"}},t.unknownDomain=function(){return{type:"unknown"}},t.knownDomain=function(e){return isNaN(e[0])||isNaN(e[1])||e[1]<e[0]?t.emptyDomain():{type:"known",bounds:e}},t.allReals=function(){return t.knownDomain([-1/0,1/0])},t.intersectDomains=function(e,r){if("empty"===e.type||"empty"===r.type)return t.emptyDomain();if("unknown"===e.type||"unknown"===r.type)return t.unknownDomain();if(e.bounds&&r.bounds){var n=[Math.max(e.bounds[0],r.bounds[0]),Math.min(e.bounds[1],r.bounds[1])];return t.knownDomain(n)}return t.emptyDomain()}});r("core/math/features/bounddomain",["require","parsenodes","core/math/builtinframe","core/math/domaintypes","core/math/comparators","core/math/maybe-rational","core/math/policy"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/builtinframe"),n=e("core/math/domaintypes"),i=e("core/math/comparators").table,o=e("core/math/maybe-rational").maybeRational,a=e("core/math/policy").defaultPolicy,s=t.Constant(o(0,1));t.Base.prototype.boundDomain=function(e){return n.unknownDomain()},t.List.prototype.boundDomain=function(e){if(!this.dependsOn(e))return n.allReals();if(!this.args.length)return n.allReals();var t=this.args[0].boundDomain(e);if("known"!==t.type)return n.unknownDomain();for(var r=0;r<this.args.length;r++){var i=this.args[r].boundDomain(e);if("known"!==i.type)return n.unknownDomain();if(i.bounds[0]!==t.bounds[0]||i.bounds[1]!==t.bounds[1])return n.unknownDomain()}return t},t.Expression.prototype.boundDomain=function(e){for(var t=n.allReals(),r=0;r<this.args.length;r++)t=n.intersectDomains(t,this.args[r].boundDomain(e));return t},t.Constant.prototype.boundDomain=function(e){return this.isNaN()?n.emptyDomain():n.allReals()},t.Piecewise.prototype.boundDomain=function(e){return this.args[2].isConstant&&isNaN(this.args[2].asValue())?n.intersectDomains(this.args[0].boundDomain(e),this.args[1].boundDomain(e)):n.unknownDomain()},t.OrderedPair.prototype.boundDomain=function(e){return n.intersectDomains(this.args[0].boundDomain(e),this.args[1].boundDomain(e))},t.BaseComparator.prototype.boundDomain=function(e){if(!this.dependsOn(e))return n.allReals();if("="===this.operator)return n.unknownDomain();var t=this._difference,o=this._difference.boundDomain(e);if(1<t.polynomialOrder(e))return n.unknownDomain();var u=t.getPolynomialCoefficients(e),c=u[1]?u[1].getConcreteTree(a,r):s,l=u[0]?u[0].getConcreteTree(a,r):s;if(!c.isConstant||!l.isConstant)return n.unknownDomain();if(isNaN(c.asValue())||isNaN(l.asValue()))return n.emptyDomain();if(0===c.asValue())return i[this.operator].inclusive?0<=l.asValue()?o:n.emptyDomain():0<l.asValue()?o:n.emptyDomain();var p=-l.asValue()/c.asValue(),f=c.asValue()<0?[-1/0,p]:[p,1/0];return n.intersectDomains(o,n.knownDomain(f))}});r("core/math/features/derivative",["require","parsenodes","core/math/baseparser","core/math/builtinframe","core/math/parsenode/builtinfunction","core/math/maybe-rational","core/math/policy","core/math/types","core/math/errormsg"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/baseparser"),n=e("core/math/builtinframe"),i=e("core/math/parsenode/builtinfunction"),o=e("core/math/maybe-rational").maybeRational,a=e("core/math/policy").defaultPolicy,s=e("core/math/types"),u=e("core/math/errormsg"),c=t.Constant(o(0,1)),l=t.Constant(o(1,1)),p=t.Constant(o(2,1)),f=t.OrderedPair([c,c]),d={FreeVariable:function(e){return e===this._symbol?l:c},Constant:function(e){return isFinite(this.asValue())?c:t.Constant(this.asValue())},Negative:function(e){return t.Negative([this.args[0].takeDerivative(e)])},Add:function(e){return t.Add([this.args[0].takeDerivative(e),this.args[1].takeDerivative(e)])},Subtract:function(e){return t.Subtract([this.args[0].takeDerivative(e),this.args[1].takeDerivative(e)])},Multiply:function(e){return t.Add([b(e,this.args[0],t.Multiply([this.args[0].takeDerivative(e),this.args[1]])),b(e,this.args[1],t.Multiply([this.args[0],this.args[1].takeDerivative(e)]))])},Divide:function(e){return t.Subtract([b(e,this.args[0],t.Divide([this.args[0].takeDerivative(e),this.args[1]])),b(e,this.args[1],t.Divide([t.Multiply([this.args[0],this.args[1].takeDerivative(e)]),t.Exponent([this.args[1],p])]))])},Exponent:function(e){return t.Add([b(e,this.args[0],t.Multiply([t.Multiply([this.args[1],t.Exponent([this.args[0],t.Subtract([this.args[1],l])])]),this.args[0].takeDerivative(e)])),b(e,this.args[1],t.Multiply([t.Piecewise([t.Comparator["="]([this.args[0],c]),t.Piecewise([t.Comparator[">"]([this.args[1],c]),c,t.Constant(NaN)]),t.Multiply([t.FunctionCall("\\ln",[this.args[0]]),t.Exponent([this.args[0],this.args[1]])])]),this.args[1].takeDerivative(e)]))]).getConcreteTree(a,n)},Sum:function(e){return this.copyWithArgs([this.args[0],this.args[1],this.args[2],this.args[3].takeDerivative(e)])},Product:function(e){var r=t.Sum([this.args[0],this.args[1],this.args[2],t.Piecewise([t.Comparator["="]([c,this.args[3]]),l,c])]),n=t.Multiply([t.Sum([this.args[0],this.args[1],this.args[2],t.Divide([this.args[3].takeDerivative(e),this.args[3]])]),t.Product(this.args)]),i=t.Product([this.args[0],this.args[1],this.args[2],t.Piecewise([t.Comparator["="]([c,this.args[3]]),this.args[3].takeDerivative(e),this.args[3]])]);return t.Piecewise([t.Comparator["="]([c,r]),n,t.Piecewise([t.Comparator["="]([l,r]),i,c])])},Piecewise:function(e){return 2===this.args.length?t.Piecewise([this.args[0],this.args[1].takeDerivative(e)]):3===this.args.length?t.Piecewise([this.args[0],this.args[1].takeDerivative(e),this.args[2].takeDerivative(e)]):void 0},List:function(e){return t.List(this.args.map(function(t){return t.takeDerivative(e)}))},ListAccess:function(e){return new this.constructor([this.args[0].takeDerivative(e),this.args[1]])},OrderedPair:function(e){return new this.constructor([this.args[0].takeDerivative(e),this.args[1].takeDerivative(e)])},OrderedPairAccess:function(e){return new this.constructor([this.args[0].takeDerivative(e),this.args[1]])},Integral:function(e){var r=this.args[0],n=this.args[1],i=this.args[2],o=this.args[3],a={};a[r._symbol]=i;var s={};return s[r._symbol]=n,t.Add([b(e,o,this.copyWithArgs([r,n,i,o.takeDerivative(e)])),t.Subtract([b(e,i,t.Multiply([o.substitute(a),i.takeDerivative(e)])),b(e,n,t.Multiply([o.substitute(s),n.takeDerivative(e)]))])])},SolvedEquation:function(e){return this._expression.takeDerivative(e)},OptimizedRegression:function(e){return this.model.takeDerivative(e)},Broadcast:function(e){for(var r=this._replacedSymbols.slice(),n=this.args.slice(1),i=this._expression.takeDerivative(e),o=0;o<this._replacedSymbols.length;o++){var a,s,u=this._replacedSymbols[o],c=this.args[o+1];c.dependsOn(e)&&(a=this.tmpVar(),s=t.DummyIndex(a),r.push(a),n.push(c.takeDerivative(e)),i=t.Add([i,t.Multiply([this._expression.takeDerivative(u),s])]))}return t.Broadcast(r,[i].concat(n))},Seed:function(e){return t.Constant(NaN)}},h={exp:"\\exp(x)*x_1",ln:"\\{x >= 0: x_1/x \\}",log:"\\{ x >= 0: x_1/(x*\\ln(10)) \\}",sqrt:"x_1/(2*\\sqrt{x})",rtxsqpone:"x*x_1/\\rtxsqpone(x)",rtxsqmone:"x*x_1/\\rtxsqmone(x)",sin:"\\cos(x)*x_1",cos:"-\\sin(x)*x_1",tan:"\\sec(x)^2*x_1",arcsin:"x_1/\\sqrt{1 - x^2}",arccos:"-x_1/\\sqrt{1 - x^2}",sinh:"\\cosh(x)*x_1",cosh:"\\sinh(x)*x_1",tanh:"(\\sech(x))^2*x_1",arcsinh:"x_1/\\sqrt{x^2 + 1}",arccosh:"\\{ x > 0: x_1/\\rtxsqmone(x) \\}",arctanh:"\\{ \\abs(x) < 1: x_1/(1 - x^2) \\}",csc:"-\\cot(x)*\\csc(x)*x_1",sec:"\\tan(x)*\\sec(x)*x_1",cot:"-\\csc(x)^2*x_1",arccsc:"-x_1/(\\abs(x)*\\rtxsqmone(x))",arcsec:"x_1/(\\abs(x)*\\rtxsqmone(x))",arccot:"-x_1/(1+x^2)",csch:"-\\coth(x)*\\csch(x)*x_1",sech:"-\\tanh(x)*\\sech(x)*x_1",coth:"-(\\csch(x))^2*x_1",arccsch:"-x_1/(\\abs(x)*\\rtxsqpone(x))",arcsech:"\\{ x >= 0: -x_1/(x*\\sqrt{1 - x^2}) \\}",arccoth:"\\{ \\abs(x) > 1 : x_1/(1 - x^2) \\}",factorial:"(x)!*\\polyGamma(0, x + 1)*x_1",floor:"\\{ \\mod(x, 1) > 0: 0*x_1 \\}",ceil:"\\{ \\mod(x, 1) > 0: 0*x_1 \\}",abs:"\\{ \\abs(x) > 0: \\sign(x)*x_1 \\}",sign:"\\{ \\abs(x) > 0: 0*x_1 \\}",mean:"\\mean(x_1)",total:"\\total(x_1)",length:"0",var:"2*\\cov(x, x_1)",varp:"2*\\cov(x, x_1)*(\\length(x)-1)/\\length(x)",stdev:"\\cov(x, x_1)/\\stdev(x)",stdevp:"\\covp(x, x_1)/\\stdevp(x)",mad:"\\mean(\\sign(x-\\mean(x))*(x_1 - \\mean(x_1)))",min:"x_1[\\argmin(x)]",max:"x_1[\\argmax(x)]",median:"0.5*(x_1[\\lowerQuantileIndex(x, 0.5)] + x_1[\\upperQuantileIndex(x, 0.5)])",argmin:"0/0",argmax:"0/0",gcd:"0/0",lcm:"0/0",erf:"\\frac{2x_1}{\\sqrt{\\pi }}e^{-x^2}",invNorm:"\\frac{x_1}{\\pdf(\\normaldist(0,1),\\invNorm(x))}",negatePoint:"-x_1"},m={logbase:["\\{x > 0: \\frac{x_1}{x*\\ln(y)}\\}","\\frac{-\\log_{y}(x)*y_1}{y*\\ln(y)}"],nthroot:["x^{1/y - 1}/y*x_1","-\\frac{x^{1/y}*\\ln(x)*y_1}{y^2}"],polyGamma:["0/0","\\polyGamma(1 + x, y)*y_1"],mod:["\\{ \\abs(\\mod(x, y)) > 0: x_1 \\}","\\{ \\mod(x/y, 1) > 0: -\\floor(x/y)*y_1 \\}"],round:["\\{ \\abs(\\mod(x, 1) - 0.5) > 0: 0*x_1 \\}","0/0"],cov:["\\cov(x_1, y)","\\cov(x, y_1)"],covp:["\\covp(x_1, y)","\\covp(x, y_1)"],corr:["(\\cov(x_1, y) - (\\cov(x, y)*\\cov(x, x_1)/\\var(x)))/(\\stdevp(x)\\stdevp(y))","(\\cov(x, y_1) - (\\cov(x, y)*\\cov(y, y_1)/\\var(y)))/(\\stdevp(x)\\stdevp(y))"],spearman:["0/0","0/0"],quantile:["\\{ \\floor(y*(\\length(x)-1)) = y*(\\length(x)-1) :   x_1[\\upperQuantileIndex(x, y)],  (\\ceil(y*(\\length(x)-1)) - y*(\\length(x)-1))*x_1[\\lowerQuantileIndex(x, y)] +   (y*(\\length(x)-1) - \\floor(y*(\\length(x)-1)))*x_1[\\upperQuantileIndex(x, y)]\\}","\\{ \\floor(y*(\\length(x)-1)) < y*(\\length(x)-1) :   (x[\\upperQuantileIndex(x, y)] - x[\\lowerQuantileIndex(x, y)])*y_1\\}"],quartile:["0.5*(x_1[\\lowerQuartileIndex(x, y)] + x_1[\\upperQuartileIndex(x, y)])","0/0"],tscore:["\\frac{\\sqrt{\\length(x)}(\\stdev(x)*\\mean(x_1)-(\\mean(x)-y)*\\frac{\\cov(x,x_1)}{\\stdev(x)})}{\\stdev(x)^2}","-y_1*\\sqrt{\\length(x)}/\\stdev(x)"],quartileIndex:["0/0","0/0"],upperQuartileIndex:["0/0","0/0"],lowerQuartileIndex:["0/0","0/0"],upperQuantileIndex:["0/0","0/0"],lowerQuantileIndex:["0/0","0/0"],nCr:["0/0","0/0"],nPr:["0/0","0/0"],arctan:["x_1*y/(y^2+x^2)","-y_1*x/(y^2+x^2)"],poissonpdf:["0/0","y_1\\frac{e^{-y}(\\floor(x)-y)y^{(\\floor(x)-1)}}{\\floor(x)!}"],invPoisson:["0/0","0/0"],tpdf:["x_1*\\pdf(\\tdist(y),x)*\\frac{-(y+1)*x}{y+x^2}","y_1*\\frac{1}{2}\\pdf(\\tdist(y),x)(  \\frac{x^2-1}{y + x^2} + \\ln(\\frac{y}{y + x^2}) +   \\polyGamma(0, \\frac{1+y}{2}) - \\polyGamma(0, y/2))"],invT:["x_1/\\pdf(\\tdist(y),\\invT(x, y))","0/0"],addPoints:["x_1","y_1"],subtractPoints:["x_1","-y_1"],multiplyPoint:["x_1*y","x*y_1"],dividePoint:["x_1/y","-x*(y_1/y^2)"],midpoint:["x_1/2","y_1/2"],distance:["-((y.x-x.x)*x_1.x+(y.y-x.y)*x_1.y)/\\distance(x,y)","((y.x-x.x)*y_1.x+(y.y-x.y)*y_1.y)/\\distance(x,y)"]},y={tcdf:["-x_1*\\pdf(\\tdist(z),x)","y_1*\\pdf(\\tdist(z),y)","0/0"],poissoncdf:["0/0","0/0","z_1\\sum _{n=\\max(0,\\floor(\\min(x,y)))}^{\\floor(\\max(x,y))}\\frac{e^{-z}(n-z)z^{(n-1)}}{n!}"],normalpdf:["-x_1*\\frac{x-y}{z^2} \\pdf(\\normaldist(y,z),x)","y_1*\\frac{x-y}{z^2} \\pdf(\\normaldist(y,z),x)","z_1*(\\frac{(x-y-z)*(x-y+z)}{z^3}) \\pdf(\\normaldist(y,z),x)"],binompdf:["0/0","0/0","\\{0<=z<=1: z_1*\\pdf(\\binomialdist(y,z),x)*(\\frac{\\round(x)}{z}-\\frac{\\round(y)-\\round(x)}{1-z}), 0 \\}"],invBinom:["0/0","0/0","0/0"],uniformpdf:["0","\\{y<=x: \\frac{y_1}{(z-y)^2}, 0\\}","\\{z>=x: -\\frac{z_1}{(z-y)^2}, 0\\}"],invUniform:["\\{y<=x<=z: x_1*(z-y), 0\\}","\\{y<=x<=z: y_1*(1-x), 0\\}","\\{y<=x<=z: z_1*x, 0\\}"]},g={normalcdf:["-x_1\\pdf(\\normaldist(z,u), x)","y_1\\pdf(\\normaldist(z,u), y)","-z_1*(\\pdf(\\normaldist(z,u), y) - \\pdf(\\normaldist(z,u), x))","u_1*(  \\{\\abs(y)=1/0:0,\\frac{z-y}{u}\\pdf(\\normaldist(z,u),y)\\} -   \\{\\abs(x)=1/0:0,\\frac{z-x}{u}\\pdf(\\normaldist(z,u),x)\\})"],binomcdf:["0/0","0/0","0/0","\\{0<=u<=1: u_1*\\sum _{n=\\max(0,\\round(\\min(x,y)))}^{\\round(\\max(x,y))}(  \\pdf(\\binomialdist(z,u),n)*(\\frac{n}{u}-\\frac{\\round(z)-n}{1-u})), 0 \\}"],uniformcdf:["\\{z>u: 0/0, -x_1\\pdf(\\uniformdist(z,u), x)\\}","\\{z>u: 0/0, y_1\\pdf(\\uniformdist(z,u), y)\\}","\\{z>u: 0/0, z_1*(\\frac{\\{z<x<u:u-x,0\\} + \\{z<y<u:y-u,0\\}}{(u-z)^2})\\}","\\{z>u: 0/0, u_1*(\\frac{\\{z<x<u:x-z,0\\} + \\{z<y<u:z-y,0\\}}{(u-z)^2})\\}"]};for(var v in h)i[v].prototype.takeDerivative=function(e,t){return function(r){var i=this.args,o={x:i[0],x_1:i[0].takeDerivative(r)};return b(r,i[0],e.substitute(o),t).getConcreteTree(a,n)}}(r.parse(h[v]),i[v].prototype._outputType||s.Number);for(v in m)i[v].prototype.takeDerivative=function(e,r,i){return function(o){var s=this.args,u={x:s[0],x_1:s[0].takeDerivative(o),y:s[1],y_1:s[1].takeDerivative(o)};return t.Add([b(o,s[0],e.substitute(u),i),b(o,s[1],r.substitute(u),i)]).getConcreteTree(a,n)}}(r.parse(m[v][0]),r.parse(m[v][1]),i[v].prototype._outputType||s.Number);for(v in y)i[v].prototype.takeDerivative=function(e,r,i,o){return function(s){var u=this.args,c={x:u[0],x_1:u[0].takeDerivative(s),y:u[1],y_1:u[1].takeDerivative(s),z:u[2],z_1:u[2].takeDerivative(s)};return t.Add([t.Add([b(s,u[0],e.substitute(c),o),b(s,u[1],r.substitute(c),o)]),b(s,u[2],i.substitute(c),o)]).getConcreteTree(a,n)}}(r.parse(y[v][0]),r.parse(y[v][1]),r.parse(y[v][2]),i[v].prototype._outputType||s.Number);for(v in g)i[v].prototype.takeDerivative=function(e,r,i,o,s){return function(u){var c=this.args,l={x:c[0],x_1:c[0].takeDerivative(u),y:c[1],y_1:c[1].takeDerivative(u),z:c[2],z_1:c[2].takeDerivative(u),u:c[3],u_1:c[3].takeDerivative(u)};return t.Add([t.Add([b(u,c[0],e.substitute(l),s),b(u,c[1],r.substitute(l),s)]),t.Add([b(u,c[2],i.substitute(l),s),b(u,c[3],o.substitute(l),s)])]).getConcreteTree(a,n)}}(r.parse(g[v][0]),r.parse(g[v][1]),r.parse(g[v][2]),r.parse(g[v][3]),i[v].prototype._outputType||s.Number);var b=function(e,t,r,n){if(void 0===n&&(n=s.Number),t.dependsOn(e))return r;if(n===s.Number)return c;if(n===s.Point)return f;throw u.parseError()};for(var x in d){var _=d[x];t[x].prototype.takeDerivative=_}["tSample","poissonSample","uniformSample","normalSample","binomSample"].forEach(function(e){i[e].prototype.takeDerivative=function(e){for(var r=0;r<this.args.length;r++)if(this.args[r].dependsOn(e))return t.Constant(NaN);return c}})});r("core/math/features/substitute",["require","parsenodes"],function(e){"use strict";var t=e("parsenodes"),r={Identifier:function(e){return e[this._symbol]?e[this._symbol]:this},FreeVariable:function(e){return e[this._symbol]?e[this._symbol]:this},Constant:function(e){return this},Expression:function(e){return this.copyWithArgs(this.args.map(function(t){return t.substitute(e)}))},List:function(e){return t.List(this.args.map(function(t){return t.substitute(e)}))},SolvedEquation:function(e){return new this.constructor(this._symbol,this._expression.substitute(e))},OptimizedRegression:function(e){return new this.constructor(this.model.substitute(e),this.parameters,this.residualVariables,this.residuals,this.statistics)}};for(var n in r)t[n].prototype.substitute=r[n]});r("core/math/features/isImplicit",["require","parsenodes"],function(e){"use strict";var t=e("parsenodes");function r(e){return!(e[0]instanceof t.FreeVariable)||e[1].dependsOn(e[0]._symbol)}t.Base.prototype.isImplicit=function(){return!1},t.Equation.prototype.isImplicit=function(){return r(this.args)},t.BaseComparator.prototype.isImplicit=function(){return r(this.args)},t.Broadcast.prototype.isImplicit=function(){return this._expression.isImplicit()}});r("core/math/workerconfig",[],function(){"use strict";return{pointsOfInterest:!0,plotSingleVariableImplicitEquations:!0,plotImplicits:!0,plotInequalities:!0,sliders:!0}});r("core/math/features/solve",["require","core/math/baseparser","parsenodes","core/math/errormsg","core/math/builtinframe","core/math/workerconfig","core/math/maybe-rational","core/math/policy"],function(e){"use strict";var t=e("core/math/baseparser"),r=e("parsenodes"),n=r.Base,i=r.Constant,o=r.Equation,a=r.SolvedEquation,s=r.BaseComparator,u=r.List,c=e("core/math/errormsg"),l=e("core/math/builtinframe"),p=e("core/math/workerconfig"),f=e("core/math/maybe-rational").maybeRational,d=e("core/math/policy").defaultPolicy,h=i(f(0,1));var m=t.parse("b*b"),y=t.parse("4*a*c"),g=t.parse("(-b+\\sqrt{b*b-4*a*c})/(2*a)"),v=t.parse("(-b-\\sqrt{b*b-4*a*c})/(2*a)"),b=t.parse("[\\{\\abs(b)>0:-c/b\\}]"),x=t.parse("[\\{\\abs(a)>0:-b/(2*a)\\}]"),_=t.parse("[\\{a=0:\\{b<0:-c/b\\},q\\},\\{a=0:\\{b>0:-c/b\\},p\\}]"),S=t.parse("[\\{a=0:\\{b<0:-c/b\\},a>0:q\\},\\{a=0:\\{b=0:\\{c>0:-m\\}\\},a>0:\\{f<g:-m\\},p\\},\\{a=0:\\{b=0:\\{c>0:m\\}\\},a>0:\\{f<g:m\\},q\\},\\{a=0:\\{b>0:-c/b\\},a>0:p\\}]");function T(e,t,r,n){for(var i,o,a,s,c=[],p=[],f=0;f<r.length;f++){var m=r[f],y=0;u.eachArgs(e,[t],function(e){var t=e[0];y=Math.max(y,t.polynomialOrder(m))});var g=2<y,v=1<r.length&&!e.validSolvedVariable(m),b=n&&t.piecewiseDependsOn(m);g||v||b?(p[f]={},c[f]=1/0):(p[f]=[],c[f]=0,u.eachArgs(e,[t],function(e){var t,r,n,i=e[0];t=i.getPolynomialCoefficients(m),(r=Object.create(l)).a=t[2]?t[2].tryGetConcreteTree(d,l):h,r.b=t[1]?t[1].tryGetConcreteTree(d,l):h,r.c=t[0]?t[0].tryGetConcreteTree(d,l):h,o=r,p[f].push(o),c[f]=Math.max(c[f],0===(n=o).a.asValue()?0===n.b.asValue()?0:1:2)}))}return s=1===r.length?(o=p[0],a=r[0],c[0]):(i=0!==c[0]&&(0===c[1]||c[0]<c[1])?0:1,o=p[i],a=r[i],c[i]),{localFrame:o,variableOfInterest:a,effectiveOrder:s}}var w={inequality:function(e){return E(e),S.getConcreteTree(d,e)},generalEquation:function(e){return E(e),e.a.isConstant&&0===e.a.asValue()?b.getConcreteTree(d,e):e.f.isConstant&&e.g.isConstant&&e.f.asValue()-e.g.asValue()==0?x.getConcreteTree(d,e):_.getConcreteTree(d,e)}};function E(e){e.f=m.getConcreteTree(d,e),e.g=y.getConcreteTree(d,e),e.p=g.getConcreteTree(d,e),e.q=v.getConcreteTree(d,e),e.m=i(f(1e305,1))}n.prototype.trySolve=function(e,t){try{return this.solve(e,t)}catch(e){if(e instanceof r.Error)return e;throw e}},o.prototype.solve=function(e,t){return this.asComparator().solve(e,t)},s.prototype.solve=function(e,t){var r=this.tryGetConcreteTree(e,t);if(r.isError)return r;if(r.isConstant)return r;var n="="!==this.getOperator();if(!p.plotImplicits&&r.isImplicit())throw new c.implicitsDisabled;var o=this._difference.tryGetConcreteTree(e,t);o.isBroadcast&&(o=o.asList(e));var s=o.getDependencies();if(0===s.length)return o.isList?u(o.args.map(function(e){return i(0===e.asValue())})):i(0===o.asValue());if(1===s.length&&o.isList&&!n)return o;if(1===s.length&&!n&&!p.plotSingleVariableImplicitEquations)return c.singleVariableImplicitEquationsDisabled();var l=u.wrap(o);if(2<s.length)return c.tooManyVariables(this.getSliderVariables(e,r)).setDependencies(s);if(n&&!e.validInequalityVariables(s))return c.invalidInequalityVariables().setDependencies(s);var f=T(e,l,s,n),d=f.localFrame,h=f.effectiveOrder,m=f.variableOfInterest;if(e.complicatedPolarImplicit(m,h))return c.complicatedPolarImplicit().setDependencies(s);if(!e.validImplicitVariables(s))return c.invalidImplicitVariables();if(2<h)return o;for(var y=n?w.inequality:w.generalEquation,g=[],v=0;v<d.length;v++){var b=y(d[v]);if(b.isError)return b;if(b.isConstant)g.push(b);else for(var x=0;x<b.args.length;x++){var _=b.args[x],S=l.args[v].extractConditions(m,_).getConcreteTree(e,t);g.push(S)}}return a(m,u(g))}});r("core/types/graphmode",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PARAMETRIC_CURVE_3D=t.Z_3D=t.OBJECT3D=t.VISUALIZATION=t.NONE=t.IMPLICIT=t.POLYGONFILL=t.POLAR=t.PARAMETRIC=t.XYPOINT_MOVABLE=t.XYPOINT=t.Y=t.X=void 0,t.X=1,t.Y=2,t.XYPOINT=3,t.XYPOINT_MOVABLE=4,t.PARAMETRIC=5,t.POLAR=6,t.POLYGONFILL=7,t.IMPLICIT=8,t.NONE=10,t.VISUALIZATION=11,t.OBJECT3D=12,t.Z_3D=13,t.PARAMETRIC_CURVE_3D=14});r("core/math/distribution-spec",["require","exports","core/math/baseparser","tslib"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionSpecFromTree=t.parseToplevelFunction=t.DistributionParameterDefaultsMap=void 0,t.DistributionParameterDefaultsMap={normaldist:{type:"distribution",symbol:"normaldist",params:["mean","stdev"],defaults:["0","1"],discrete:!1},tdist:{type:"distribution",symbol:"tdist",params:["dof"],defaults:[void 0],discrete:!1},binomialdist:{type:"distribution",symbol:"binomialdist",params:["trials","probsuccess"],defaults:[void 0,"0.5"],discrete:!0},poissondist:{type:"distribution",symbol:"poissondist",params:["mean"],defaults:[void 0],discrete:!0},uniformdist:{type:"distribution",symbol:"uniformdist",params:["min","max"],defaults:["0","1"],discrete:!1}};var i={Histogram:{type:"visualization",symbol:"histogram",params:["data","binwidth"],defaults:[void 0,"1"]},DotPlot:{type:"visualization",symbol:"dotplot",params:["data","binwidth"],defaults:[void 0,"1"]},BoxPlot:{type:"visualization",symbol:"boxplot",params:["data"],defaults:[void 0]}};function o(e){var r=e,o=i[r.type];if(!o)switch("Assignment"===r.type&&(r=r._expression),r.type){case"FunctionCall":o=t.DistributionParameterDefaultsMap[r._symbol];break;default:return}if(o){for(var a={},s=o.params,u=r.args,c=0;c<s.length;c++){var l=u[c];a[s[c]]=l&&l.getInputString()||""}return n.__assign(n.__assign({},o),{span:r.getInputSpan(),values:a})}}t.parseToplevelFunction=function(e){return o(r.parse(e,{trailingComma:!0}))},t.getFunctionSpecFromTree=o});r("core/math/evaluationstate",["require","exports","core/vendor/d3-color","./types","parsenodes","./errormsg","core/types/graphmode","core/lib/label","core/math/distribution-spec"],function(e,t,r,n,i,o,a,s,u){"use strict";function c(e){return e.isError?e.getError():void 0===e.asValue()?"":+e.asValue()}function l(){return{operator:"=",variables:[]}}function p(e,t,r){var n=e.variables;if(n&&n.length){for(var i={},o=0,a=n;o<a.length;o++){i[s=a[o]]=!0}for(var s in r)i[s]=!0;r=i}e.variables=t.sliderVariables(Object.keys(r))}Object.defineProperty(t,"__esModule",{value:!0}),t.addSliderPrompts=t.EvaluationState=t.defaultEvaluationState=void 0,t.defaultEvaluationState=l,t.EvaluationState=function(e,t,f){if(t.isTable)return function(e,t){for(var r=[],n=0;n<e.columns.length;n++){var i=t.columns[n],o=i.isError?[]:i.values.map(c),a={dependent:!i.isIndependent,discrete:!!i.isIndependent,values:o};i.isError&&(a.error=i.getError()),r.push(a)}return{column_data:r}}(t,f);if(t.isImage)return d=e,h=t,y={variables:[],errorMap:{},dimensions:{}},(m=f).center.isError&&(y.errorMap.center=!0),m.radianAngle.isError&&(y.errorMap.angle=!0),m.width.isError&&(y.errorMap.width=!0),m.height.isError&&(y.errorMap.height=!0),m.opacity.isError&&(y.errorMap.opacity=!0),m.center.isError||m.radianAngle.isError||m.width.isError||m.height.isError||m.opacity.isError?y.variables=h.getSliderVariables(d,m):(y.dimensions.x=[],y.dimensions.y=[],y.dimensions.radianAngle=[],y.dimensions.width=[],y.dimensions.height=[],y.dimensions.opacity=[],i.List.eachArgs(d,[m.center,m.radianAngle,m.width,m.height,m.opacity],function(e){var t=e[0].asValue(),r=+e[1].asValue(),n=Math.atan2(Math.sin(r),Math.cos(r));y.dimensions.x.push(+t[0]),y.dimensions.y.push(+t[1]),y.dimensions.radianAngle.push(n),y.dimensions.width.push(+e[2].asValue()),y.dimensions.height.push(+e[3].asValue()),y.dimensions.opacity.push(Math.max(0,Math.min(1,+e[4].asValue())))}),(d.graphingEnabled()?h.getGraphMode(d,m):a.NONE)!==a.NONE&&(y.is_graphable=!0),m.moveStrategy&&(y.move_strategy=m.moveStrategy)),y;var d,h,m,y;if(t.isSimulation)return function(e,t){var r=t.fps,n=r.asValue(),i=void 0;("number"!=typeof n||n<0)&&(n=0,i=o.simulationFPSNonNegativeNumber().getError());for(var a={},s=0,u=r.getDependencies();s<u.length;s++){a[u[s]]=!0}var c={variables:[],fps:n,fps_error:i};return p(c,e,a),c}(e,f);var g,v=l();if(f.isError&&(!(t instanceof i.FunctionDefinition)||f.blocksExport))return v.error=f.getError(),v.variables=t.getSliderVariables(e,f),v.is_single_identifier=t instanceof i.Identifier,v;f instanceof i.RGBColor&&(g=f.asValue(),v.rgb_value=r.rgb(g[0],g[1],g[2]).formatHex()),f.moveStrategy&&(v.move_strategy=f.moveStrategy,v.default_drag_mode=f.defaultDragMode),t.isInequality()&&(v.is_inequality=!0),v.operator=t.getOperator(),f instanceof i.SolvedEquation?!0!==f._expression.asValue()&&!1!==f._expression.asValue()&&(v.assignment=f._symbol):t instanceof i.Assignment&&(v.assignment=t._symbol);var b,x=e.graphingEnabled()?t.getGraphMode(e,f):a.NONE;x!==a.NONE&&(v.is_graphable=!0,v.expression_type=t.getExpressionType(x,f.valueType),f.isShadeBetween()&&(v.is_shade_between=!0),(b=t.tableInfo(e,f))&&(v.is_tableable=!0,v.table_info=b)),n.isList(f.valueType)&&(v.is_concrete_list=!0),v.variables=v.is_graphable?[]:t.getSliderVariables(e,f),v.is_single_identifier=t instanceof i.Identifier,f.isConstant&&(v.constant_value=f.asValue());var _=f.getEvaluationInfo();if(!_||"="!==v.operator||t.isConstant||t.isFunction||f.valueType===n.Bool||f.valueType===n.ListOfBool||t instanceof i.Equation||t instanceof i.And||(v.is_evaluable=!0,v.zero_values=_),f instanceof i.OptimizedRegression){var S=f,T={};for(var w in S.parameters)S.parameters.hasOwnProperty(w)&&(T[s.identifierToLatex(w)]=+S.parameters[w].asValue());v.is_regression=!0,v.regression={parameters:T,residualVariable:s.identifierToLatex(S.residualVariable),residualSuggestionId:S.residualSuggestionId,shouldSuggestLogMode:S.shouldSuggestLogMode,isLinear:S.isLinear,statistics:S.statistics,parameterWarning:S.parameterWarning}}var E=u.getFunctionSpecFromTree(t);return E&&E.discrete&&(v.is_discrete_distribution=!0),v},t.addSliderPrompts=p});r("core/math/statementanalysis",["require","core/math/evaluationstate","pjs","core/types/graphmode","core/math/workerconfig"],function(e){"use strict";var t=e("core/math/evaluationstate").EvaluationState,r=e("pjs"),n=e("core/types/graphmode"),i=e("core/math/workerconfig");return r(function(e){e.init=function(e,r,n){this.policy=e,this.rawTree=r,this.concreteTree=n,this.evaluationState=t(e,r,n)},e.exportTo=function(e,t){this.rawTree.exportTo(e,this.concreteTree,t)},e.graph=function(e){return this.rawTree.graph(this.policy,this.concreteTree,e)},e.getGraphMode=function(){return this.rawTree.getGraphMode(this.policy,this.concreteTree)},e.getGraphInfo=function(){return this.rawTree.getGraphInfo(this.policy,this.concreteTree)},e.shouldIntersect=function(){if(!this.evaluationState.is_graphable)return!1;if(!this.rawTree.userData.shouldGraph)return!1;if(!i.pointsOfInterest)return!1;var e=this.getGraphMode();return e===n.X||e===n.Y}})});r("core/math/expression-types",["require","exports"],function(e,t){"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.isClickableExpressionType=t.getReconciledExpressionProps=t.EXPRESSION_PROP_DEFAULTS=t.ExpressionType=void 0,(n=r=t.ExpressionType||(t.ExpressionType={})).X_OR_Y="X_OR_Y",n.SINGLE_POINT="SINGLE_POINT",n.POINT_LIST="POINT_LIST",n.PARAMETRIC="PARAMETRIC",n.POLAR="POLAR",n.IMPLICIT="IMPLICIT",n.POLYGON="POLYGON",n.HISTOGRAM="HISTOGRAM",n.DOTPLOT="DOTPLOT",n.BOXPLOT="BOXPLOT",n.TTEST="TTEST",n.STATS="STATS",n.CUBE="CUBE",n.SPHERE="SPHERE",t.EXPRESSION_PROP_DEFAULTS={X_OR_Y:{points:!1,lines:!0,fill:!1},SINGLE_POINT:{points:!0,lines:!1,fill:!1},POINT_LIST:{points:!0,lines:!1,fill:!1},PARAMETRIC:{points:!1,lines:!0,fill:!1},POLAR:{points:!1,lines:!0,fill:!1},IMPLICIT:{points:!1,lines:!0,fill:!1},POLYGON:{points:!1,lines:!0,fill:!0},HISTOGRAM:{points:!1,lines:!0,fill:!0},DOTPLOT:{points:!0,lines:!1,fill:!1},BOXPLOT:{points:!1,lines:!0,fill:!1},TTEST:{points:!1,lines:!1,fill:!1},STATS:{points:!1,lines:!1,fill:!1},CUBE:{points:!1,lines:!1,fill:!0},SPHERE:{points:!1,lines:!1,fill:!0}},t.getReconciledExpressionProps=function(e,n){if(void 0===e)return{points:!1,lines:!1,fill:!1};var i=t.EXPRESSION_PROP_DEFAULTS[e];switch(e){case r.SINGLE_POINT:return{points:!0,lines:!1,fill:!1};case r.POINT_LIST:case r.DOTPLOT:return{points:void 0===n.points?i.points:n.points,lines:void 0===n.lines?i.lines:n.lines,fill:!1};case r.PARAMETRIC:case r.POLYGON:case r.X_OR_Y:case r.POLAR:case r.IMPLICIT:case r.HISTOGRAM:case r.BOXPLOT:case r.TTEST:case r.STATS:case r.CUBE:case r.SPHERE:return{points:!1,lines:void 0===n.lines?i.lines:n.lines,fill:void 0===n.fill?i.fill:n.fill};default:return e}},t.isClickableExpressionType=function(e){if(void 0===e)return!1;switch(e){case r.SINGLE_POINT:case r.POINT_LIST:case r.PARAMETRIC:case r.POLYGON:case r.X_OR_Y:case r.POLAR:case r.IMPLICIT:return!0;case r.HISTOGRAM:case r.BOXPLOT:case r.DOTPLOT:case r.TTEST:case r.STATS:case r.CUBE:case r.SPHERE:return!1;default:return e}}});r("core/math/features/analyze",["require","underscore","parsenodes","core/math/statementanalysis","core/math/builtin","core/math/builtinframe","core/math/parsenode/builtinfunction","core/math/errormsg","core/math/comparators","core/math/types","core/types/graphmode","core/math/expression-types","core/math/distribution-spec","core/math/workerconfig"],function(e){"use strict";var t=e("underscore"),r=e("parsenodes"),n=e("core/math/statementanalysis"),i=e("core/math/builtin"),o=e("core/math/builtinframe"),a=e("core/math/parsenode/builtinfunction"),s=e("core/math/errormsg"),u=e("core/math/comparators"),c=e("core/math/types"),l=e("core/types/graphmode"),p=e("core/math/expression-types").ExpressionType,f=e("core/math/distribution-spec").DistributionParameterDefaultsMap,d=e("core/math/workerconfig");function h(e,t,r,i){if(i.isError)return n(e,r,i);var o=i.getDependencies();switch(i.valueType){case c.Distribution:case c.ListOfDistribution:case c.RGBColor:case c.ListOfColor:case c.EmptyList:return n(e,r,i);case c.Point:case c.ListOfPoint:return o.length?e.validParametricVariables(o)?n(e,r,i):n(e,r,s.tooManyVariables(r.getSliderVariables(e,i)).setDependencies(o)):n(e,r,i);case c.Number:case c.ListOfNumber:return 0===o.length?n(e,r,i):o.length<=e.dimensions()-1?e.validExpressionVariables(o)?n(e,r,i):n(e,r,s.equationRequired(e.implicitDependency(o)).setDependencies(o)):e.validImplicitVariables(o)?n(e,r,s.equationRequired().setDependencies(o)):n(e,r,s.tooManyVariables(r.getSliderVariables(e,i)).setDependencies(o));default:return n(e,r,s.parseError())}}function m(e){return a.pdf([e,r.FreeVariable("x")])}function y(e,t){var r=this.tryGetConcreteTree(e,t),i=r.getDependencies();return i.length?n(e,this,s.tooManyVariables(this.getSliderVariables(e,r)).setDependencies(i)):n(e,this,this.tryGetConcreteTree(e,t))}function g(e){return function(t,r){var i=this.tryGetConcreteTree(t,r),o=i.getDependencies();if(o.length)return n(t,this,s.tooManyVariables(this.getSliderVariables(t,i)).setDependencies(o));var a,u=n(t,this,this.tryGetConcreteTree(t,r));return i.isError||(u.evaluationState.expression_type=p.TTEST,a=i.args.map(function(e){return e.asValue()}),u.evaluationState.ttest_results=e.apply(null,a)),u}}r.Base.prototype.analyze=function(e,t){return n(e,this,this.tryGetConcreteTree(e,t))},r.FunctionCall.prototype.analyze=function(e,t){var r=this.tryGetConcreteTree(e,t);return!r.isError&&f[this._symbol]&&0===r.getDependencies().length&&(r=m(r).tryGetConcreteTree(e,t)),h(e,0,this,r)},r.Expression.prototype.analyze=function(e,t){return h(e,0,this,this.tryGetConcreteTree(e,t))},r.FunctionDefinition.prototype.analyze=function(e,t){if(o[this._symbol])return this.asEquation().analyze(e,t);var r=this._symbol.split("_")[0];if(a[r])return n(e,this,s.cannotRedefine(this._symbol,r));var i=this.tryGetConcreteTree(e,t);if(i.isError)return n(e,this,i);var u=this._argSymbols,c=i.getDependencies();if(-1!==c.indexOf(this._symbol))return n(e,this,s.selfReferentialFunction(this._symbol));var l=c.filter(function(e){return-1===u.indexOf(e)});return e.unplottablePolarFunction(this._symbol,c)?n(e,this,s.unplottablePolarFunction()):l.some(e.assignmentForbidden)?n(e,this,s.addArgumentsToDefinition(l,this._symbol,u).setDependencies(c)):l.length?n(e,this,s.tooManyVariables(this.getSliderVariables(e,i)).setDependencies(c)):n(e,this,i)},r.Assignment.prototype.analyze=function(e,t,i){var a=this._symbol;if(!e.validLHS(a))return n(e,this,s.invalidLHS(a));if(o[a])return this.asEquation().analyze(e,t);var u=this.tryGetConcreteTree(e,t);if(!u.isError&&this._expression instanceof r.FunctionCall&&f[this._expression._symbol]&&0===u.getDependencies().length&&(u=m(u).tryGetConcreteTree(e,t)),u.isError)return n(e,this,u);var c=u.getDependencies();if(this.isEquation(u))return this.asEquation().analyze(e,t);if(1<c.length){var l=this.getSliderVariables(e,u);return l.length?n(e,this,s.tooManyVariables(l).allowExport().setDependencies(c)):n(e,this,u)}var p=this.getMoveStrategy(e,t,u,i,this.userData);if(p){var d=this.getDefaultDragMode(p);return n(e,this,r.MovablePoint(u.args,p,d))}return n(e,this,u)},r.Regression.prototype.analyze=function(e,t,r,i,o){return n(e,this,this.tryOptimize(e,t,r,i,o))},r.Polygon.prototype.analyze=y,r.Histogram.prototype.analyze=y,r.Object3D.prototype.analyze=y,r.DotPlot.prototype.analyze=y,r.BoxPlot.prototype.analyze=y,r.TTest.prototype.analyze=g(i.ttest),r.IndependentTTest.prototype.analyze=g(i.ittest),r.Stats.prototype.analyze=function(e,t){var r=this.tryGetConcreteTree(e,t),o=r.getDependencies();if(o.length)return n(e,this,s.tooManyVariables(this.getSliderVariables(e,r)).setDependencies(o));var a,u=n(e,this,this.tryGetConcreteTree(e,t));return r.isError||(u.evaluationState.expression_type=p.STATS,a=r.args.map(function(e){return e.asValue()}),u.evaluationState.stats_results=i.stats.apply(null,a)),u},r.Equation.prototype.analyze=r.BaseComparator.prototype.analyze=function(e,t){var i="="!==this.getOperator();if(!d.plotInequalities&&i)return n(e,this,s.inequalitiesDisabled());var o=this.trySolve(e,t);if(o.isError)return n(e,this,o);if(o instanceof r.SolvedEquation&&o.getDependencies().length){var a=o.getDependencies().concat(o._symbol);if(!e.validImplicitVariables(a))return n(e,this,s.invalidImplicitVariables().setDependencies(a))}return this.getGraphMode(e,o)!==l.IMPLICIT||e.validImplicitVariables(o.getDependencies())?n(e,this,o):n(e,this,s.invalidImplicitVariables().setDependencies(o.getDependencies()))},r.DoubleInequality.prototype.analyze=function(e,t){if(!d.plotInequalities)return n(e,this,s.inequalitiesDisabled());var r=this.tryGetConcreteTree(e,t);if(r.isError)return n(e,this,r);var i=r.getDependencies();return u.table[this._operators[0]].direction!==u.table[this._operators[1]].direction?n(e,this,s.mismatchedDoubleInequality()):e.validDoubleInequalitySymbol(r._symbol)&&e.validDoubleInequalityVariables(i)?2<i.length?n(e,this,s.tooManyVariables(this.getSliderVariables(e,r)).setDependencies(i)):-1!==r._expressions[0].getDependencies().indexOf(r._symbol)||-1!==r._expressions[1].getDependencies().indexOf(r._symbol)?n(e,this,s.complicatedDoubleInequality().setDependencies(i)):n(e,this,r):n(e,this,s.invalidDoubleInequalityVariables().setDependencies(i))},r.And.prototype.analyze=function(e,t){var r=this.tryGetConcreteTree(e,t);if(r.isError)return n(e,this,r);var i=r.getDependencies();return i.length?e.validDoubleInequalityVariables(i)?n(e,this,s.complicatedDoubleInequality().setDependencies(i)):n(e,this,s.tooManyVariables(this.getSliderVariables(e,r)).setDependencies(i)):n(e,this,r)},r.OrderedPair.prototype.analyze=function(e,t,i){var o=this.tryGetConcreteTree(e,t);if(o.isError)return n(e,this,o);var a=this.getMoveStrategy(e,t,o,i,this.userData);if(a){var s=this.getDefaultDragMode(a);return n(e,this,r.MovablePoint(o.args,a,s))}return h(e,0,this,o)},r.Table.prototype.analyze=function(e,t){for(var i=Object.create(t),o=[],a=0;a<this.columns.length;a++){var u,c=this.columns[a].analyze(e,i,t);0===a&&(c.concreteTree.isIndependent?e.validFirstColumnVariable(c.concreteTree.header._symbol)?c.concreteTree.header._symbol:c=n(e,this.columns[a],s.invalidFirstTableColumn()):c=n(e,this.columns[a],s.invalidDependentFirstTableColumn())),c.concreteTree.isIndependent?c.rawTree.exportToLocal(c.concreteTree,i):c.concreteTree.isError||(u=function(e,t){return e.filter(function(e){return!t[e]})}(c.concreteTree.header.getDependencies(),i)).length&&(c=n(e,this.columns[a],s.tooManyVariables(u).setDependencies(u))),o.push(c.concreteTree)}var l=r.Table(o),p=n(e,this,l);return p.evaluationState.is_graphable=!0,p},r.TableColumn.prototype.analyze=function(e,t,r){var i=this.header.tableError();if(i)return n(e,this,s.invalidTableHeader(i));var o=this.tryGetConcreteTree(e,t,r);if(o.isError)return n(e,this,o);if(o.header.isError)return n(e,this,o.header);if(o.values.isError)return n(e,this,o.values);for(var a,u,c=0;c<o.values.length;c++){o.values[c].isError||((a=this.values[c]&&this.values[c].tableError())?o.values[c]=s.invalidTableEntry(a):(u=o.values[c].getDependencies()).length&&(o.values[c]=s.tooManyVariables(u).setDependencies(u)))}return n(e,this,o)},r.Image.prototype.analyze=function(e,t,i){var o=this.tryGetConcreteTree(e,t);if(o.radianAngle.isError||o.center.isError||o.width.isError||o.height.isError||o.opacity.isError)return n(e,this,o);var a=o.center.getDependencies(),u=o.radianAngle.getDependencies(),c=o.width.getDependencies(),l=o.height.getDependencies(),p=o.opacity.getDependencies();return a.length||u.length||c.length||l.length||p.length?n(e,this,r.Image({center:a.length?s.tooManyVariables(u).setDependencies(a):o.center,radianAngle:u.length?s.tooManyVariables(u).setDependencies(u):o.radianAngle,width:c.length?s.tooManyVariables(c).setDependencies(c):o.width,height:l.length?s.tooManyVariables(l).setDependencies(l):o.height,opacity:p.length?s.tooManyVariables(p).setDependencies(p):o.opacity})):(o.moveStrategy=this.getMoveStrategy(e,t,o,i,this.userData),n(e,this,o))},r.Simulation.prototype.analyze=function(e,t,r){var i=this.tryGetConcreteTree(e,t);return n(e,this,i)},r.Slider.prototype.analyze=function(e,r){var i,o,a,u=this.tryGetConcreteTree(e,r),c=u.sliderInfo,l=(o=c.missingVars.length?(i=t.unique(c.missingVars),n(e,this,s.tooManyVariables(e.sliderVariables(i)).setDependencies(i).allowExport())):n(e,this,u)).evaluationState;return d.sliders&&(l.assignment=c.exportedSymbol,l.slider_min_number=c.values.min,l.slider_max_number=c.values.max,l.slider_step_number=c.values.step,l.slider_min_valid=c.valids.min,l.slider_max_valid=c.valids.max,l.slider_step_valid=c.valids.step,a=l.slider_min_valid&&l.slider_max_valid&&l.slider_step_valid,l.is_slider=!0,l.raw_slider_latex=this.getInputString(),l.is_slidable=a,l.is_animatable=l.is_slidable&&!l.is_graphable,c.errMsg&&(l.error=c.errMsg.getError())),delete l.is_evaluable,delete l.zero_values,o}});r("core/math/features/analyzeFourFunction",["require","parsenodes","core/math/statementanalysis","core/math/errormsg","core/math/parsenode/builtinfunction","core/math/builtinconstants"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/statementanalysis"),n=e("core/math/errormsg"),i=e("core/math/parsenode/builtinfunction"),o=e("core/math/builtinconstants");function a(e,t){return r(e,this,n.inequalitiesUnsupported())}t.Base.prototype.analyzeFourFunction=function(e,t){var i=this.tryGetConcreteTree(e,t);return i.isError?r(e,this,i):r(e,this,n.parseError())},t.Expression.prototype.analyzeFourFunction=function(e,t){var a=this.tryGetConcreteTree(e,t);if(a.isError)return r(e,this,a);var s=a.getDependencies();if(0<s.length){var u=s[0],c=i.hasOwnProperty(u)?n.functionUnsupported(u):o.hasOwnProperty(u)?n.constantUnsupported(u):n.variablesUnsupported(u);return r(e,this,c)}return r(e,this,a)},t.Assignment.prototype.analyzeFourFunction=function(e,t){return r(e,this,n.assignmentsUnsupported())},t.FunctionDefinition.prototype.analyzeFourFunction=function(e,t){return r(e,this,n.functionDefinitionsUnsupported())},t.Equation.prototype.analyzeFourFunction=function(e,t){return r(e,this,n.equationsUnsupported())},t.And.prototype.analyzeFourFunction=a,t.DoubleInequality.prototype.analyzeFourFunction=a,t.BaseComparator.prototype.analyzeFourFunction=a,t.Regression.prototype.analyzeFourFunction=function(e,t){return r(e,this,n.regressionsUnsupported())},t.OrderedPair.prototype.analyzeFourFunction=function(e,t){return r(e,this,n.pointsUnsupported())},t.RGBColor.prototype.analyzeFourFunction=function(e,t){return r(e,this,n.colorsUnsupported())}});r("core/math/features/analyzeScientific",["require","parsenodes","core/math/statementanalysis","core/math/errormsg","core/math/builtinframe"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/statementanalysis"),n=e("core/math/errormsg"),i=e("core/math/builtinframe");function o(e,t){return r(e,this,n.inequalitiesUnsupported())}t.Base.prototype.analyzeScientific=function(e,t){var i=this.tryGetConcreteTree(e,t);return i.isError?r(e,this,i):r(e,this,n.parseError())},t.Expression.prototype.analyzeScientific=function(e,t){var i=this.tryGetConcreteTree(e,t);if(i.isError)return r(e,this,i);var o=i.getDependencies();return 0<o.length?r(e,this,n.tooManyVariables(o)):r(e,this,i)},t.Assignment.prototype.analyzeScientific=function(e,t){var o=this._symbol;if(i[o])return r(e,this,n.cannotRedefine(o));var a=this.tryGetConcreteTree(e,t);if(a.isError)return r(e,this,a);var s=a.getDependencies();return this.isEquation(a)?r(e,this,n.equationsUnsupported()):0<s.length?r(e,this,n.tooManyVariables(s)):r(e,this,a)},t.FunctionDefinition.prototype.analyzeScientific=function(e,t){if(i[this._symbol])return r(e,this,n.cannotRedefine(this._symbol));var o=this.tryGetConcreteTree(e,t);if(o.isError)return r(e,this,o);var a=this._argSymbols,s=o.getDependencies();if(-1!==s.indexOf(this._symbol))return r(e,this,n.selfReferentialFunction(this._symbol));var u=s.filter(function(e){return-1===a.indexOf(e)});return u.length?r(e,this,n.addArgumentsToDefinition(u,this._symbol,a)):r(e,this,o)},t.Equation.prototype.analyzeScientific=function(e,t){return r(e,this,n.equationsUnsupported())},t.And.prototype.analyzeScientific=o,t.DoubleInequality.prototype.analyzeScientific=o,t.BaseComparator.prototype.analyzeScientific=o,t.Regression.prototype.analyzeScientific=function(e,t){return r(e,this,n.regressionsUnsupported())},t.OrderedPair.prototype.analyzeScientific=function(e,t){return r(e,this,n.pointsUnsupported())},t.RGBColor.prototype.analyzeScientific=function(e,t){return r(e,this,n.colorsUnsupported())}});r("core/math/features/analyzeSingleExpressionScientific",["require","parsenodes","core/math/statementanalysis","core/math/errormsg","core/math/parsenode/builtinfunction","core/math/builtinconstants"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/statementanalysis"),n=e("core/math/errormsg"),i=e("core/math/parsenode/builtinfunction"),o=e("core/math/builtinconstants");function a(e,t){return r(e,this,n.inequalitiesUnsupported())}t.Base.prototype.analyzeSingleExpressionScientific=function(e,t){var i=this.tryGetConcreteTree(e,t);return i.isError?r(e,this,i):r(e,this,n.parseError())},t.Expression.prototype.analyzeSingleExpressionScientific=function(e,t){var a=this.tryGetConcreteTree(e,t);if(a.isError)return r(e,this,a);var s=a.getDependencies();if(0<s.length){var u=s[0],c=i.hasOwnProperty(u)?n.functionUnsupported(u):o.hasOwnProperty(u)?n.constantUnsupported(u):n.variablesUnsupported(u);return r(e,this,c)}return r(e,this,a)},t.Assignment.prototype.analyzeSingleExpressionScientific=function(e,t){return r(e,this,n.assignmentsUnsupported())},t.FunctionDefinition.prototype.analyzeSingleExpressionScientific=function(e,t){return r(e,this,n.functionDefinitionsUnsupported())},t.Equation.prototype.analyzeSingleExpressionScientific=function(e,t){return r(e,this,n.equationsUnsupported())},t.And.prototype.analyzeSingleExpressionScientific=a,t.DoubleInequality.prototype.analyzeSingleExpressionScientific=a,t.BaseComparator.prototype.analyzeSingleExpressionScientific=a,t.Regression.prototype.analyzeSingleExpressionScientific=function(e,t){return r(e,this,n.regressionsUnsupported())},t.OrderedPair.prototype.analyzeSingleExpressionScientific=function(e,t){return r(e,this,n.pointsUnsupported())},t.RGBColor.prototype.analyzeSingleExpressionScientific=function(e,t){return r(e,this,n.colorsUnsupported())}});r("core/lib/dragmode",["require","exports"],function(e,t){"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.reconcileDragMode=t.DragMode=void 0,(n=r=t.DragMode||(t.DragMode={})).NONE="NONE",n.X="X",n.Y="Y",n.XY="XY",n.AUTO="AUTO",t.reconcileDragMode=function(e,t){var n,i=!(n=t)||"none"===n[0].type&&"none"===n[1].type?r.NONE:"none"===n[1].type?r.X:"none"===n[0].type?r.Y:r.XY;switch(e){case r.NONE:return r.NONE;case r.AUTO:case r.XY:return i;case r.X:return i===r.X||i===r.XY?r.X:r.NONE;case r.Y:return i===r.Y||i===r.XY?r.Y:r.NONE;default:return r.NONE}}});r("core/math/features/getgraphmode",["require","parsenodes","core/types/graphmode","core/lib/dragmode","core/lib/dragmode","core/math/types"],function(e){"use strict";var t=e("parsenodes"),r=e("core/types/graphmode"),n=e("core/lib/dragmode").reconcileDragMode,i=e("core/lib/dragmode").DragMode,o=e("core/math/types");function a(e,t){var a,s,u,c=t.getDependencies();switch(t.valueType){case o.Point:case o.ListOfPoint:return t.isMovablePoint&&(a=this.userData,s=t,u=!a||!a.hasOwnProperty("dragMode")||a.dragMode===i.AUTO?s.defaultDragMode:a.dragMode,n(u,s.moveStrategy)!==i.NONE)?r.XYPOINT_MOVABLE:0===c.length?r.XYPOINT:e.validParametricVariables(c)?2===e.dimensions()?r.PARAMETRIC:r.PARAMETRIC_CURVE_3D:r.NONE;case o.Number:case o.ListOfNumber:return 2===e.dimensions()&&1===c.length?r.Y:3===e.dimensions()&&2===c.length?r.Z_3D:r.NONE;default:return r.NONE}}function s(e,t){var n=t._expression.getDependencies();if(1<n.length)return r.NONE;if(t._expression.valueType!==o.Number&&t._expression.valueType!==o.ListOfNumber)return r.NONE;var i=t._symbol;return e.graphMode(i,n)}function u(e,t){return t.isError?r.NONE:r.VISUALIZATION}t.Base.prototype.getGraphMode=function(e,t){return r.NONE},t.Expression.prototype.getGraphMode=a,t.Equation.prototype.getGraphMode=t.BaseComparator.prototype.getGraphMode=function(e,n){var i=n.getDependencies();return n.isConstant?r.NONE:n instanceof t.SolvedEquation?0===i.length?e.graphableAsConstant(n._symbol)?e.constantGraphMode(n._symbol):r.NONE:s(e,n):1===i.length||2===i.length?r.IMPLICIT:r.NONE},t.DoubleInequality.prototype.getGraphMode=function(e,t){return e.constantGraphMode(t._symbol)},t.Assignment.prototype.getGraphMode=function(e,n){if(n instanceof t.SolvedEquation)return s(e,n);if(this.isEquation(n))return this.asEquation().getGraphMode(e,n);var i=n.getDependencies();switch(n.valueType){case o.Number:case o.ListOfNumber:case o.EmptyList:switch(i.length){case 0:return e.graphableAsConstant(this._symbol)?e.constantGraphMode(this._symbol):r.NONE;case 1:return n.valueType!==o.ListOfNumber||e.graphableListVariables(this._symbol,i[0])?this.isSlider?r.NONE:e.graphMode(this._symbol,i):r.NONE;case 2:return 3===e.dimensions()&&"z"===this._symbol?r.Z_3D:r.NONE;default:return r.NONE}break;default:return a.call(this,e,n)}},t.FunctionDefinition.prototype.getGraphMode=function(e,t){if(1!==this._argSymbols.length)return r.NONE;var n=e.graphMode(this._symbol,this._argSymbols),i=t.getDependencies();switch(t.valueType){case o.Number:case o.ListOfNumber:switch(i.length){case 0:return n;case 1:return i[0]!==this._argSymbols[0]?r.NONE:n;default:return r.NONE}break;default:return r.NONE}},t.Regression.prototype.getGraphMode=function(e,t){return!this.isLhsSimple||!t.isModelValid||1!==t.model.getDependencies().length?r.NONE:r.Y},t.Polygon.prototype.getGraphMode=function(e,t){return t.isError?r.NONE:r.POLYGONFILL},t.Object3D.prototype.getGraphMode=function(e,t){return t.isError?r.NONE:r.OBJECT3D},t.Histogram.prototype.getGraphMode=u,t.DotPlot.prototype.getGraphMode=u,t.BoxPlot.prototype.getGraphMode=u,t.Image.prototype.getGraphMode=function(e,t){return!this.userData.showPoints||this.center.isError||this.radianAngle.isError||this.width.isError||this.height.isError||this.opacity.isError?r.NONE:r.XYPOINT}});r("core/lib/color-helpers",["require","exports"],function(e,t){"use strict";function r(e){return n(e)?(e.match(/^#([A-Fa-f0-9]{3})$/g)&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),e.toLowerCase()):e}function n(e){return"string"==typeof e&&(e.match(/^#([A-Fa-f0-9]{3})$/g)||e.match(/^#([A-Fa-f0-9]{6})$/g))}Object.defineProperty(t,"__esModule",{value:!0}),t.colors=t.getDisplayColor=t.mutateOpacity=t.parseHex=t.invertColor=t.shadeColor=t.isValidHexColor=t.normalizeColor=void 0,t.normalizeColor=r,t.isValidHexColor=n,t.shadeColor=function(e,t){if(!n(e=r(e)))return e;1<t&&(t=1),t<-1&&(t=-1);var i=parseInt(e.slice(1),16),o=t<0?0:255,a=t<0?-1*t:t,s=i>>16,u=i>>8&255,c=255&i;return"#"+(16777216+65536*(Math.round((o-s)*a)+s)+256*(Math.round((o-u)*a)+u)+(Math.round((o-c)*a)+c)).toString(16).slice(1)},t.invertColor=function(e){if(!n(e=r(e)))return e;var t="0123456789abcdef";return"#"+e.slice(1).split("").map(function(e){return t[15-t.indexOf(e)]}).join("")},t.parseHex=function(e){var t,r,n;return n=3===(e=e.replace(/#/,"")).length?(t=parseInt(e.slice(0,1)+e.slice(0,1),16),r=parseInt(e.slice(1,2)+e.slice(1,2),16),parseInt(e.slice(2,3)+e.slice(2,3),16)):6===e.length?(t=parseInt(e.slice(0,2),16),r=parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)):r=t=0,{r:t,g:r,b:n}},t.mutateOpacity=function(e,t){var r=/(rgba\([\d]+\,\ ?[\d]+\,\ ?[\d]+\,\ ?)[\d.]+(\))/;return e.match(r)?e.replace(r,"$1"+t+"$2"):e},t.getDisplayColor=function(e,t,r){if(t&&t.colorLatexValue){var n=t.colorLatexValue;return Array.isArray(n)&&void 0!==r?n[r]||"#000000":n}return e.color},t.colors={RED:"#c74440",BLUE:"#2d70b3",GREEN:"#388c46",PURPLE:"#6042a6",ORANGE:"#fa7e19",BLACK:"#000000",GRAY:"#aaaaaa"}});r("core/math/features/getgraphinfo",["require","parsenodes","core/math/builtinframe","core/math/domaintypes","core/math/policy","core/lib/color-helpers"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/builtinframe"),n=e("core/math/domaintypes"),i=e("core/math/policy").defaultPolicy,o=e("core/lib/color-helpers").getDisplayColor;t.Base.prototype.getGraphInfo=function(e,t,r){var i,a,s=t.getDependencies();switch(s.length){case 0:i=t.getLinearCoefficients(),a=t.boundDomain("x");break;case 1:"known"===(a=t.boundDomain(s[0])).type&&(i=t.getLinearCoefficients());break;case 2:a=n.unknownDomain()}return{graphMode:this.getGraphMode(e,t),color:o(this.userData,this.metaData,r),pointStyle:this.userData.pointStyle,lineStyle:this.userData.lineStyle,operator:this.getOperator(),isLinear:!!i,linearCoefficients:i,domainBound:a}},t.Base.prototype.getLinearCoefficients=function(){var e=this.getDependencies();switch(e.length){case 0:return[+this.asValue(),0];case 1:if(1<this.polynomialOrder(e[0]))return;var t=this.getPolynomialCoefficients(e[0]);return[t[0]?+t[0].tryGetConcreteTree(i,r).asValue():0,t[1]?+t[1].tryGetConcreteTree(i,r).asValue():0];default:return}},t.OrderedPair.prototype.getLinearCoefficients=function(){var e=this.args[0].getLinearCoefficients(),t=this.args[1].getLinearCoefficients();if(e&&t)return[e,t]}});r("core/math/features/getMoveStrategy",["require","parsenodes","core/math/types","core/math/maybe-rational","core/math/builtinframe","core/math/functions"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/types"),n=e("core/math/maybe-rational").maybeRational,i=e("core/math/builtinframe"),o=e("core/math/functions"),a=t.Constant(n(0,1));function s(e){return{type:"none",inputString:e}}function u(e){return{type:"updateCoordinate",inputString:e}}function c(e,t,r){return{type:"updateSlider",inputString:e,id:t,coefficients:r}}function l(e,t,r,n,o,s){for(var u=t.getDependencies(),c=0;c<u.length;c++)if(o[u[c]])return!1;for(var l=u.length-1;0<=l;l--){var p=u[l];if(!s[p]){var f=n[p];if(void 0!==f){var d=r[p];if(1===d.order){var h=d.tree.getPolynomialCoefficients(p),m=h[1]?h[1].getConcreteTree(e,i):a,y=h[0]?h[0].getConcreteTree(e,i):a;if(y.isConstant&&m.isConstant)if(isFinite(y.asValue())&&isFinite(m.asValue()))if(0!==m.asValue())return{symbol:p,id:f,coefficients:[-y.asValue()/m.asValue(),1/m.asValue()]}}}}}return!1}function p(e,t){var r=function(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return t}(e),n={};for(var i in t){var o=t[i].evaluationState.assignment;t[i].evaluationState.is_slidable&&r[o]&&(n[o]=i)}return n}function f(e,r,n,i){for(var o=[],a=0;a<n.length;a++){var s=n[a],u={};o.push(u);for(var c=0;c<i.length;c++){var l=i[c],p=Object.create(r);p[l]=t.FreeVariable(l);var f=s.tryGetConcreteTree(e,p);f.isError?u[l]={tree:f,order:1/0}:u[l]={tree:f,order:f.polynomialOrder(l)}}}return o}function d(e,t,r){for(var n=0;n<e.length;n++){var i=e[n];0!==t[i].order&&(r[i]=!0)}}t.Base.prototype.getMoveStrategy=function(){},t.Assignment.prototype.getMoveStrategy=function(e,r,n,i,o){if(this._expression instanceof t.OrderedPair)return this._expression.getMoveStrategy(e,r,n,i,o)},t.OrderedPair.prototype.getMoveStrategy=function(e,n,i,a,h){if((!h||!1!==h.shouldGraph)&&i.valueType===r.Point&&0===i.getDependencies().length){for(var m,y,g,v,b=p(this.getDependencies(),a),x=Object.keys(b),_=this.args,S=f(e,n,_,x),T=[],w={},E={},M=0;M<2;M++){var C,I=_[M],P=I.getInputString();I.isConstant?T[M]=u(P):((C=l(e,I,S[M],b,w,E))&&(T[M]=c(P,C.id,C.coefficients),w[C.symbol]=!0,d(x,S[M],E)),T[M]||(T[M]=s(P)))}if("none"!==T[0].type||"none"!==T[1].type)return T;if(1===x.length){var k,O=x[0],D=b[O];try{k=t.OrderedPair([S[0][O].tree,S[1][O].tree]).getCompiledFunction()}catch(e){return}return o.dehydrateCompiledFunction(k),[(m=_[0].getInputString(),g=a[y=D].evaluationState,v=k,{type:"updateSliderNonlinear",inputString:m,id:y,initialValue:g.constant_value,min:g.slider_min_number,max:g.slider_max_number,compiled:v}),s(_[1].getInputString())]}}},t.Image.prototype.getMoveStrategy=function(e,t,r,n,i){if((!i||!1!==i.shouldGraph)&&(!i||!1!==i.showPoints)&&"OrderedPair"===r.center.type&&r.center.args[0].isConstant&&r.center.args[1].isConstant&&r.width.isConstant&&r.height.isConstant&&r.radianAngle.isConstant&&r.opacity.isConstant){var o=p(this.getDependencies(),n),a=Object.keys(o),h=[this.width,this.height];"OrderedPair"===this.center.type&&h.push(this.center.args[0],this.center.args[1]);for(var m=[],y={},g={},v=f(e,t,h,a),b=[2,3,0,1],x=0;x<b.length;x++){var _,S,T=b[x],w=h[T];w?(_=w.getInputString(),w.isConstant?m[T]=u(_):((S=l(e,w,v[T],o,y,g))&&(m[T]=c(_,S.id,S.coefficients),y[S.symbol]=!0,d(a,v[T],g)),m[T]||(m[T]=s(_)))):m[T]=s("")}if("none"!==m[0].type||"none"!==m[1].type||"none"!==m[2].type||"none"!==m[3].type)return m}}});r("core/math/features/getDefaultDragMode",["require","parsenodes","core/lib/dragmode"],function(e){"use strict";var t=e("parsenodes"),r=e("core/lib/dragmode").DragMode;t.Base.prototype.getMoveStrategy=function(){return r.NONE},t.Assignment.prototype.getDefaultDragMode=function(e){return"none"!==e[0].type&&"none"!==e[1].type?r.XY:"none"!==e[0].type?r.X:"none"!==e[1].type?r.Y:r.NONE},t.OrderedPair.prototype.getDefaultDragMode=function(e){return"updateSlider"===e[0].type&&"updateSlider"===e[1].type?r.XY:"updateSlider"===e[0].type?r.X:"updateSlider"===e[1].type?r.Y:r.NONE}});r("core/math/features/tableinfo",["require","parsenodes","core/math/types","core/lib/label","core/math/distribution-spec"],function(e){"use strict";var t=e("parsenodes"),r=t.List,n=e("core/math/types"),i=e("core/lib/label"),o=e("core/math/distribution-spec").getFunctionSpecFromTree;t.Base.prototype.tableInfo=function(e,t){return!1},t.Identifier.prototype.tableInfo=function(e,t){return!!e.validFirstColumnVariable(this._symbol)&&{independent_variable:this._symbol,dependent_column:this.getInputString(),by_reference:!1}},t.Expression.prototype.tableInfo=function(e,t){var i=t.getDependencies();if(o(this))return!1;switch(t.valueType){case n.Point:case n.ListOfPoint:return 0!==i.length?!1:(!t.isMovablePoint||"updateSlider"!==t.moveStrategy[0].type&&"updateSlider"!==t.moveStrategy[1].type)&&{independent_variable:"x",dependent_column:"y",by_reference:!1,values:r.wrap(t).mapElements(e,function(e){return e.asArray()})};case n.Number:if(1!==i.length)return!1;var a=i[0];return e.validFirstColumnVariable(a)?{independent_variable:a,dependent_column:this.getInputString(),by_reference:!1}:!1;default:return!1}},t.Assignment.prototype.tableInfo=function(e,r){if(r instanceof t.SolvedEquation)return!1;if(!this.getInputString().length)return!1;if(o(this))return!1;var n,a=r.getDependencies();if(1<a.length)return!1;if(0===a.length){if(!e.tableableAsConstant(this._symbol))return!1;n=e.implicitIndependent(this._symbol)}else n=a[0];return!!e.validFirstColumnVariable(n)&&{independent_variable:n,dependent_column:e.assignmentForbidden(this._symbol)?i.trimLatex(this.getInputString().replace(/[^=]*=/,"")):i.trimLatex(this.getInputString().split("=")[0]),by_reference:!e.assignmentForbidden(this._symbol)}},t.FunctionDefinition.prototype.tableInfo=function(e,t){if(1!==this._argSymbols.length)return!1;if(!this.getInputString().length)return!1;if(1<t.getDependencies().length)return!1;var r=this._argSymbols[0];if(!e.validFirstColumnVariable(r))return!1;var n=e.assignmentForbidden(this._symbol);return{independent_variable:r,dependent_column:n?i.trimLatex(this.getInputString().replace(/[^=]*=/,"")):i.trimLatex(this.getInputString().split("=")[0]),by_reference:!n}},t.BaseComparator.prototype.tableInfo=function(e,t){return!1},t.DoubleInequality.prototype.tableInfo=function(e,t){return!1},t.Equation.prototype.tableInfo=function(e,t){return!1}});r("core/math/features/tableerror",["require","parsenodes","core/lib/worker-i18n"],function(e){"use strict";var t=e("parsenodes"),r=e("core/lib/worker-i18n");t.Base.prototype.tableError=function(){return this.isInequality()?r.t("Inequalities are not allowed."):!(this instanceof t.Expression)&&r.t("This type of expression is not allowed.")},t.List.prototype.tableError=function(){return r.t("Lists are not allowed.")},t.Equation.prototype.tableError=t.Assignment.prototype.tableError=function(){return r.t("Equations are not allowed.")},t.FunctionDefinition.prototype.tableError=function(){return r.t("Function definitions are not allowed.")},t.Regression.prototype.tableError=function(){return r.t("Regressions are not allowed.")}});r("core/math/curve-accumulator",["require","exports","core/math/distance"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Accumulator=void 0;var n=(i.prototype.colinear=function(e,t,n){this.map&&(e=this.map(e),t=this.map(t),n=this.map(n));var i=r.pointToSegmentParameter(n[0],n[1],n[2]||0,e[0],e[1],e[2]||0,t[0],t[1],t[2]||0);if(i<1)return!1;var o=[e[0]+i*(t[0]-e[0]),e[1]+i*(t[1]-e[1]),3===e.length?e[2]+i*(t[2]-e[2]):0];return Math.abs(n[0]-o[0])<=this.xtolerance&&Math.abs(n[1]-o[1])<=this.ytolerance&&(2===e.length||Math.abs(n[2]-o[2])<=this.ztolerance)},i.prototype.addPoint=function(e){if(this.dimensions=e.length,this.xtolerance<0&&this.ytolerance<0&&(2===this.dimensions||this.ztolerance<0))this.segment.push.apply(this.segment,e);else if(this.segment.length){var t=2===this.dimensions?[this.segment[this.segment.length-2],this.segment[this.segment.length-1]]:[this.segment[this.segment.length-3],this.segment[this.segment.length-2],this.segment[this.segment.length-1]];if(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]){if(!this.pivotPoint||!this.pendingPoint)return this.pivotPoint=e,void(this.pendingPoint=e);(!this.colinear(t,this.pivotPoint,e)||r.hypot(t[0]-e[0],t[1]-e[1],(t[2]||0)-(e[2]||0))<r.hypot(t[0]-this.pendingPoint[0],t[1]-this.pendingPoint[1],(t[2]||0)-(this.pendingPoint[2]||0)))&&(this.flushPending(),this.pivotPoint=e),this.pendingPoint=e}}else this.segment.push.apply(this.segment,e)},i.prototype.flushPending=function(){this.pendingPoint&&(this.segment.push.apply(this.segment,this.pendingPoint),this.pivotPoint=void 0,this.pendingPoint=void 0)},i.prototype.breakSegment=function(){this.flushPending(),this.segment.length>(this.dimensions||2)&&this.segments.push(this.segment),this.segment=[]},i.prototype.getSegments=function(){return this.breakSegment(),this.segments},i.prototype.finish=function(){return{segments:this.getSegments(),resolved:!0}},i);function i(e){e?(this.xtolerance=e.xtolerance||e.tolerance||0,this.ytolerance=e.ytolerance||e.tolerance||0,this.ztolerance=e.ztolerance||e.tolerance||0,this.map=e.map):this.xtolerance=this.ytolerance=this.ztolerance=0,this.segments=[],this.segment=[],this.pivotPoint=void 0,this.pendingPoint=void 0}t.Accumulator=n});r("core/math/implicit-plotter",["require","exports","core/math/distance","./curve-accumulator"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.displayTriangles=t.traceContours=t.triangulate=t.buildQuadTree=t.sampleImplicitDiagnostic=t.sampleImplicit=void 0;var i=5,o=Math.pow(2,14);function a(e,t){var r=Math.pow(2,-i),n=l(t,r),o=l(t,2*r),a=d(e,n,o),s=T(a.root,e,n);return{paddedDomain:n,rootDomain:o,quadTree:a,triangles:s,contours:O(s,e,n)}}function s(e,t,r){return{x:e,y:t,z:r}}function u(e,t,r){return{x:e,y:t,isZero:r}}function c(e,t,r){return{vertices:[e,t,r],visited:!1,next:void 0}}function l(e,t){var r=(1+t)*e.xmin-t*e.xmax,n=(1+t)*e.xmax-t*e.xmin;return{xmin:r,ymin:(1+t)*e.ymin-t*e.ymax,xmax:n,ymax:(1+t)*e.ymax-t*e.ymin,xtolerance:e.xtolerance,ytolerance:e.ytolerance}}function p(e,t){return{depth:e,vertices:t,children:void 0,center:void 0}}function f(e,t,r){e.center=x(e.vertices[0],e.vertices[1],e.vertices[2],e.vertices[3],t,r)}function d(e,t,r){var n,a,s,u,c,l,d=(n=e,s=(a=r).xmin,u=a.xmax,c=a.ymin,l=a.ymax,p(0,[g(s,l,n),g(u,l,n),g(u,c,n),g(s,c,n)])),y=[];(R=[]).push(d);var _,S,T,w,E,M,C,I,P,k,O,D,N=1,A=!0;e:for(;R.length;)for(var L,F=y,y=R,R=F;L=y.pop();)if(function(e,t,r){if(e.depth<i)return!0;if(function(e,t){return e.vertices[0].x<t.xmin||e.vertices[0].y>t.ymax||e.vertices[2].x>t.xmax||e.vertices[2].y<t.ymin}(e,r))return!1;if(function(e,t){if(e.vertices[1].x-e.vertices[0].x<10*t.xtolerance)return!0;if(e.vertices[0].y-e.vertices[3].y<10*t.ytolerance)return!0;return!1}(e,r))return!1;var n=e.vertices[0],o=e.vertices[1],a=e.vertices[2],s=e.vertices[3];if(isNaN(n.z)&&isNaN(o.z)&&isNaN(a.z)&&isNaN(s.z))return!1;if(isNaN(n.z)||isNaN(o.z)||isNaN(a.z)||isNaN(s.z))return!0;var u=x(n,o,a,s,t,r),c=b(n,o,t,r),l=b(o,a,t,r),p=b(a,s,t,r),f=b(s,n,t,r);return m(n,c,t)||m(o,c,t)||m(o,l,t)||m(a,l,t)||m(a,p,t)||m(s,p,t)||m(s,f,t)||m(n,f,t)||h(n,c,u,t,r)||h(c,o,u,t,r)||h(o,l,u,t,r)||h(l,a,u,t,r)||h(a,p,u,t,r)||h(p,s,u,t,r)||h(s,f,u,t,r)||h(f,n,u,t,r)}(L,e,t)){if(S=e,D=O=k=P=I=C=M=E=w=T=void 0,T=(_=L).depth+1,w=_.vertices[0],E=_.vertices[1],M=_.vertices[2],C=_.vertices[3],I=v(w,E,S),P=v(E,M,S),k=v(M,C,S),O=v(C,w,S),D=v(w,M,S),_.children=[p(T,[w,I,D,O]),p(T,[I,E,P,D]),p(T,[D,P,M,k]),p(T,[O,D,k,C])],!L.children){A=!1;break e}if(R.push(L.children[0]),R.push(L.children[1]),R.push(L.children[2]),R.push(L.children[3]),o<=(N+=3)){A=!1;break e}}else f(L,e,t);for(var q=0;q<y.length;q++)f(y[q],e,t);for(q=0;q<R.length;q++)f(R[q],e,t);return{root:d,resolved:A}}function h(e,t,n,i,o){if(0<e.z==0<t.z&&0<t.z==0<n.z)return!1;var a,s,u,c;if(0<e.z==0<t.z){if(0<(a=v(e,t,i)).z!=0<e.z)return!0;s=S(e,n,i,o),u=S(t,n,i,o),c=S(a,n,i,o)}else if(0<t.z==0<n.z){if(0<(a=v(t,n,i)).z!=0<t.z)return!0;s=S(t,e,i,o),u=S(n,e,i,o),c=S(a,e,i,o)}else{if(0<(a=v(n,e,i)).z!=0<n.z)return!0;s=S(n,t,i,o),u=S(e,t,i,o),c=S(a,t,i,o)}var l=o.xtolerance,p=o.ytolerance;return l*p<r.pointToSegment(p*c.x,l*c.y,p*s.x,l*s.y,p*u.x,l*u.y)}function m(e,t,r){if(isNaN(e.z)&&isNaN(t.z))return!1;if(isNaN(e.z)||isNaN(t.z))return 0<e.z||0<t.z;var n=4*v(e,t,r).z-t.z-3*e.z,i=1e-4,o=(r((1-i)*e.x+i*t.x,(1-i)*e.y+i*t.y)-e.z)/i,a=Math.max(Math.abs(e.z),Math.abs(t.z));return Math.abs(n-o)>.125*a}function y(e,t){return e.x<t.xmin||e.x>t.xmax||e.y<t.ymin||e.y>t.ymax}function g(e,t,r){return s(e,t,r(e,t))}function v(e,t,r){return g(.5*(e.x+t.x),.5*(e.y+t.y),r)}function b(e,t,r,n){if(y(e,n)||y(t,n))return v(e,t,r);if(isNaN(e.z)||isNaN(t.z))return function(e,t,r,n){if(isNaN(e.z)===isNaN(t.z))return v(e,t,r);{var i;isNaN(e.z)&&(i=e,e=t,t=i)}var o=e.x,a=t.x,u=e.y,c=t.y,l=e.z,p=n.xtolerance,f=n.ytolerance;for(;Math.abs(o-a)>p||Math.abs(u-c)>f;){var d=.5*(o+a),h=.5*(u+c),m=r(d,h);isNaN(m)===isNaN(l)?(o=d,u=h,l=m):(a=d,c=h)}return s(o,u,l)}(e,t,r,n);if(0<e.z!=0<t.z)return v(e,t,r);var i=.01,o=r(.99*e.x+i*t.x,.99*e.y+i*t.y)-e.z,a=t.z-r(i*e.x+.99*t.x,i*e.y+.99*t.y);return isNaN(o)||isNaN(a)||0<o==0<a?v(e,t,r):_(s(e.x,e.y,o),s(t.x,t.y,a),r)}function x(e,t,r,n,i,o){var a=b(e,r,i,o);return 0<e.z==0<r.z&&0<a.z!=0<e.z?a:(a=b(t,n,i,o),0<t.z==0<n.z&&0<a.z!=0<t.z?a:v(e,r,i))}function _(e,t,r){if(isNaN(e.z))return t;if(isNaN(t.z))return e;if(isFinite(e.z)||isFinite(t.z)){if(isFinite(e.z)){if(isFinite(t.z)){var n=1-e.z/t.z,i=1-t.z/e.z;return g(e.x/n+t.x/i,e.y/n+t.y/i,r)}return e}return t}return v(e,t,r)}function S(e,t,r,n){var i=e.x,o=t.x,a=e.y,c=t.y,l=e.z,p=t.z,f=n.xtolerance,d=n.ytolerance;if(y(e,n)||y(t,n)){var h=v(e,t,r);return u(h.x,h.y,!1)}for(;Math.abs(i-o)>f||Math.abs(a-c)>d;){var m=.5*(i+o),g=.5*(a+c),b=r(m,g);0<b==0<l?(i=m,a=g,l=b):(o=m,c=g,p=b)}if(isNaN(l))return u(o,c,!1);if(isNaN(p))return u(i,a,!1);var x=_(s(i,a,l),s(o,c,p),r),S=0===l||0===p||0===x.z||x.z>=l==p>=x.z&&Math.abs(x.z)<1e250;return u(x.x,x.y,S)}function T(e,t,r){var n={triangles:[],edgeCache:{},domain:r,fn:t};return function e(t,r){if(!t.children)return;e(t.children[0],r);e(t.children[1],r);e(t.children[2],r);e(t.children[3],r);w(t.children[0],t.children[1],r);w(t.children[3],t.children[2],r);E(t.children[1],t.children[2],r);E(t.children[0],t.children[3],r)}(e,n),n.triangles}function w(e,t,r){e.children&&t.children?(w(e.children[1],t.children[0],r),w(e.children[2],t.children[3],r)):e.children?(w(e.children[1],t,r),w(e.children[2],t,r)):t.children?(w(e,t.children[0],r),w(e,t.children[3],r)):function(e,t,r){if(!e.center||!t.center)return;var n,i;i=e.depth>=t.depth?(n=b(e.vertices[1],e.vertices[2],r.fn,r.domain),M(e.vertices[1],t.center,e.vertices[2],e.center,n)):(n=b(t.vertices[0],t.vertices[3],r.fn,r.domain),M(t.vertices[0],t.center,t.vertices[3],e.center,n));P(i,r.edgeCache,r.domain);for(var o=0;o<4;o++)r.triangles.push(i[o])}(e,t,r)}function E(e,t,r){e.children&&t.children?(E(e.children[2],t.children[1],r),E(e.children[3],t.children[0],r)):e.children?(E(e.children[2],t,r),E(e.children[3],t,r)):t.children?(E(e,t.children[1],r),E(e,t.children[0],r)):function(e,t,r){if(!e.center||!t.center)return;var n,i;i=e.depth>=t.depth?(n=b(e.vertices[3],e.vertices[2],r.fn,r.domain),M(e.vertices[2],t.center,e.vertices[3],e.center,n)):(n=b(t.vertices[1],t.vertices[0],r.fn,r.domain),M(t.vertices[1],t.center,t.vertices[0],e.center,n));P(i,r.edgeCache,r.domain);for(var o=0;o<4;o++)r.triangles.push(i[o])}(e,t,r)}function M(e,t,r,n,i){return[c(e,i,t),c(t,i,r),c(r,i,n),c(n,i,e)]}function C(e,t,r){return 0<e.z&&!y(e,r)&&(!(0<t.z)||y(t,r))}function I(e,t){return e.x+","+e.y+","+t.x+","+t.y}function P(e,t,r){k(e[0],e[1],e[2],I(e[1].vertices[2],e[1].vertices[0]),t,r),k(e[1],e[2],e[3],I(e[2].vertices[0],e[2].vertices[2]),t,r),k(e[2],e[3],e[0],I(e[3].vertices[2],e[3].vertices[0]),t,r),k(e[3],e[0],e[1],I(e[0].vertices[0],e[0].vertices[2]),t,r)}function k(e,t,r,n,i,o){var a,s,u,c,l,p,f=t.vertices[0],d=t.vertices[1],h=t.vertices[2];C(d,h,o)&&(t.next=r),C(f,d,o)&&(t.next=e),C(h,f,o)&&(a=t,(u=i)[s=n]?a.next=u[s]:u[s]=a),C(f,h,o)&&(c=t,(p=i)[l=n]?p[l].next=c:p[l]=c)}function O(e,t,r){for(var i={fillAccumulator:new n.Accumulator(r),strokeAccumulator:new n.Accumulator(r),fn:t,domain:r},o=0;o<e.length;o++){var a=e[o];a.next&&!a.visited&&function(e,t){for(;;){var r=e.vertices[0],n=e.vertices[1],i=e.vertices[2];if(D(r,n,t),D(n,i,t),D(i,r,t),e.visited)break;if(!e.next)break;e.visited=!0,e=e.next}t.strokeAccumulator.breakSegment(),t.fillAccumulator.breakSegment()}(a,i)}return{strokeSegments:i.strokeAccumulator.finish().segments,fillSegments:i.fillAccumulator.finish().segments}}function D(e,t,r){var n;C(e,t,r.domain)&&(n=S(e,t,r.fn,r.domain),r.fillAccumulator.addPoint([n.x,n.y]),n.isZero?r.strokeAccumulator.addPoint([n.x,n.y]):r.strokeAccumulator.breakSegment())}t.sampleImplicit=function(e,t){var r=a(e,t);return{segments:r.contours.strokeSegments,fillSegments:r.contours.fillSegments,resolved:r.quadTree.resolved}},t.sampleImplicitDiagnostic=a,t.buildQuadTree=d,t.triangulate=T,t.traceContours=O,t.displayTriangles=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push([n.vertices[0].x,n.vertices[0].y,n.vertices[1].x,n.vertices[1].y,n.vertices[2].x,n.vertices[2].y,n.vertices[0].x,n.vertices[0].y])}return t}});r("core/math/poi-finding-accumulator",["require","exports","core/math/workerconfig","tslib","./curve-accumulator","./poi"],function(e,t,r,n,i,o){"use strict";function a(e){return Math.abs(e)<5e-8}Object.defineProperty(t,"__esModule",{value:!0});var s,u=(s=i.Accumulator,n.__extends(c,s),c.prototype.getPOI=function(){return r.pointsOfInterest?(void 0!==this.fn&&(this.poiData.intercept=this.findIntercept(this.fn)),this.poiData):{zeros:{x:[],y:[]},intercept:{x:[],y:[]},extrema:{x:[],y:[]}}},c.prototype.addLinearZero=function(e){var t=-e[0]/e[1];this.isOutsideDomain(t)||(this.poiData.zeros={x:[t],y:[0]})},c.prototype.addLinearIntercept=function(e){this.isOutsideDomain(0)||(this.poiData.intercept={x:[0],y:[e[0]]})},c.prototype.isOutsideDomain=function(e){return!this.domain||void 0===this.domain.min||void 0===this.domain.max||e<this.domain.min||e>this.domain.max||isNaN(e)},c.prototype.addPoint=function(e){0===this.segment.length&&a(e[1])&&(this.poiData.zeros.x.push(e[0]),this.poiData.zeros.y.push(e[1])),this.updateZeroBuffer(e),this.updateExtremumBuffer(e),s.prototype.addPoint.call(this,e)},c.prototype.updateZeroBuffer=function(e){if(this.fn)if(isFinite(e[0])&&isFinite(e[1]))switch(this.zeroBuffer.length){case 0:if(a(e[1]))return;return void this.zeroBuffer.push(e);case 1:return 0===e[1]||(0<e[1]==0<this.zeroBuffer[0][1]||(t=o.bisectZero(this.zeroBuffer[0][0],this.zeroBuffer[0][1],e[0],e[1],this.fn))&&(this.poiData.zeros.x.push(t[0]),this.poiData.zeros.y.push(t[1])),this.zeroBuffer.length=0),void this.zeroBuffer.push(e);case 2:if(0===e[1])return;return 0<e[1]==0<this.zeroBuffer[0][1]||(t=o.flatCenter(this.zeroBuffer[0][0],this.zeroBuffer[0][1],this.zeroBuffer[1][0],this.zeroBuffer[1][1],e[0],e[1],this.fn))&&(this.poiData.zeros.x.push(t[0]),this.poiData.zeros.y.push(t[1])),this.zeroBuffer.length=0,void this.zeroBuffer.push(e);var t}else this.zeroBuffer.length=0},c.prototype.updateExtremumBuffer=function(e){if(this.fn)if(isFinite(e[0])&&isFinite(e[1]))switch(this.extremumBuffer.length){case 0:return void this.extremumBuffer.push(e);case 1:return e[1]===this.extremumBuffer[0][1]&&(this.extremumBuffer.length=0),void this.extremumBuffer.push(e);case 2:return e[1]===this.extremumBuffer[1][1]||(e[1]>this.extremumBuffer[1][1]==this.extremumBuffer[1][1]>this.extremumBuffer[0][1]||(t=this.bisectExtremumUsingDerivative(this.extremumBuffer[0][0],this.extremumBuffer[0][1],this.extremumBuffer[1][0],this.extremumBuffer[1][1],e[0],e[1]))&&(this.poiData.extrema.x.push(t[0]),this.poiData.extrema.y.push(t[1]),!o.bisectJump(this.extremumBuffer[0][0],this.extremumBuffer[0][1],t[0],t[1],e[0],e[1],this.fn,this.ytolerance)&&t[0]>this.segment[this.segment.length-2]&&(this.pendingPoint=t)),this.extremumBuffer.shift()),void this.extremumBuffer.push(e);case 3:if(e[1]===this.extremumBuffer[1][1])return;if(e[1]>this.extremumBuffer[1][1]==this.extremumBuffer[1][1]>this.extremumBuffer[0][1])return this.extremumBuffer.shift(),this.extremumBuffer.shift(),void this.extremumBuffer.push(e);var t=void 0,r=.5*(this.extremumBuffer[1][0]+this.extremumBuffer[2][0]),n=this.fn(r);return(t=n===this.extremumBuffer[1][1]?o.flatCenter(this.extremumBuffer[0][0],this.extremumBuffer[0][1],this.extremumBuffer[1][0],this.extremumBuffer[1][1],e[0],e[1],this.fn):this.bisectExtremumUsingDerivative(this.extremumBuffer[1][0],this.extremumBuffer[1][1],r,n,this.extremumBuffer[2][0],this.extremumBuffer[2][1]))&&(this.poiData.extrema.x.push(t[0]),this.poiData.extrema.y.push(t[1])),this.extremumBuffer.shift(),this.extremumBuffer.shift(),void this.extremumBuffer.push(e)}else this.zeroBuffer.length=0},c.prototype.bisectExtremumUsingDerivative=function(e,t,r,n,i,a){var s,u,c,l;if(this.fn)return this.derivative&&(u=this.derivative(e),c=this.derivative(i),isNaN(u)||isNaN(c)||u<0==c<0||(l=o.bisectZero(e,u,i,c,this.derivative))&&(s=[l[0],this.fn(l[0])])),s=s||o.bisectExtremum(e,t,r,n,i,a,this.fn)},c.prototype.breakSegment=function(){this.zeroBuffer.length=0,this.extremumBuffer.length=0,this.flushPending(),2<this.segment.length&&(this.segments.push(this.segment),a(this.segment[this.segment.length-1])&&(this.poiData.zeros.x.push(this.segment[this.segment.length-2]),this.poiData.zeros.y.push(this.segment[this.segment.length-1]))),this.segment=[]},c.prototype.findIntercept=function(e){if(!e)return{x:[],y:[]};var t=e(0);return isFinite(t)?{x:[0],y:[e(0)]}:{x:[],y:[]}},c.prototype.finish=function(){return{segments:this.getSegments(),resolved:!0,poi:this.getPOI()}},c);function c(e,t,r){var n=s.call(this,e)||this;return n.domain=e,n.fn=t,n.derivative=r,n.poiData={zeros:{x:[],y:[]},intercept:{x:[],y:[]},extrema:{x:[],y:[]}},n.zeroBuffer=[],n.extremumBuffer=[],n}t.default=u});r("core/math/plotter",["require","exports","tslib","core/math/distance","./poi","./implicit-plotter","./curve-accumulator","./poi-finding-accumulator","core/types/graphmode","./domaintypes"],function(e,t,r,n,i,o,a,s,u,c){"use strict";function l(e,t){var r=new s.default(t),n=e[0]+t.min*e[1],i=e[0]+t.max*e[1];return isFinite(n)&&isFinite(i)&&(r.addPoint([t.min,n]),r.addPoint([t.max,i]),r.addLinearZero(e),r.addLinearIntercept(e)),r.finish()}function p(e,t){var n=e(t);return{segments:[r.__spreadArrays(n,n)],resolved:!0}}function f(e,t,r){var o=r.fn,a=r.jumpTolerance,s=e[0],u=e[1],c=t[0],l=t[1],p=n.mean(s,c),f=o(p);return i.bisectJump(s,u,p,f,c,l,o,a)}Object.defineProperty(t,"__esModule",{value:!0});var d=function(e,t,r){var n=r.fn,i=r.jumpTolerance,o=r.accumulator;if(!isFinite(i)||i<=0)return t;var a=f(e,t,r);if(!a)return t;for(var s=(t[0]-e[0])/10,u=[-s,s],c=t,l=0;l<u.length;l++){var p=e[0]+u[l],d=n(p);isFinite(d)||(p=e[0],d=e[1],p=e[0],d=e[1]);var h=t[0]+u[l],m=n(h);if(isFinite(m)?c=[h,m]:(h=t[0],m=t[1]),f([p,d],[h,m],r)){var y=a[0],g=a[1];return o.addPoint(y),o.breakSegment(),o.addPoint(g),t}}return c},h=function(e,t,r){this.derivative=r,this.accumulator=new s.default(t,e,r),this.fn=e,this.jumpTolerance=t.ytolerance||t.tolerance||0};function m(e,t,r){var n=t,i=e(n);return isFinite(i)||(i=e(n=t+r)),isFinite(i)||(i=e(n=t-r)),[n,i]}function y(e,t,r){var n,o,a,s,u=new h(e,t,r),c=t.step/10,l=t.min,p=m(e,l,c),f=p[0],y=p[1],g=[f,y];isFinite(y)&&u.accumulator.addPoint([f,y]);for(var v=Math.ceil((t.max-t.min)/t.step),b=1;b<=v;b++)f=(n=m(e,(v-b)/v*t.min+b/v*t.max,c))[0],y=n[1],isFinite(y)&&isFinite(g[1])?(f=(o=d(g,[f,y],u))[0],y=o[1],u.accumulator.addPoint([f,y])):isFinite(y)&&!isFinite(g[1])?(s=i.bisectFinite(g[0],g[1],f,y,e))&&(s[0]!==f&&u.accumulator.addPoint(s),f=(a=d(s,[f,y],u))[0],y=a[1],u.accumulator.addPoint([f,y])):!isFinite(y)&&isFinite(g[1])&&(s=i.bisectFinite(g[0],g[1],f,y,e))&&((s=d(g,s,u))[0]!==g[0]&&u.accumulator.addPoint(s),u.accumulator.breakSegment()),g=[f,y];return u.accumulator.finish()}function g(e,t,r,n){var i,o,a,s=t.min,u=t.max-t.min,c=t.xtolerance&&t.ytolerance?Math.min(t.xtolerance,t.ytolerance):t.tolerance?t.tolerance:0,l=Math.floor(u/(Math.PI/r));function p(e,t){var i=t%2==0?1:-1;if(n||-1!=i){for(var o=t*(Math.PI/r),a=[s,s+1,s+2,s+3],u=!1,l=0,p=a.length;l<p;l++){var f=e(a[l]),d=e(a[l]+o);if(isFinite(f)&&isFinite(d)&&(u=!0),isFinite(f)!==isFinite(d)||Math.abs(f-i*d)>c)return}if(u)return 1}}for(i=1;i<=l;i++)if(p(e,i)){for(a=i,o=2;o*i<=l;o++)p(e,o*i)||(a=void 0);if(a)break}return a?a*(Math.PI/r):null}function v(e){return[e[1]*Math.cos(e[0]),e[1]*Math.sin(e[0])]}function b(e,t){return t.map=v,y(e,t)}function x(e,t){if(t.max<t.min)return{segments:[],resolved:!0};var r,n=new a.Accumulator(t),i=t.min,o=e(i);return isFinite(o[0])&&isFinite(o[1])&&n.addPoint(o),function(e,t){for(var r=e.min,n=e.max,i=e.step,o=n-r,a=Math.ceil(o/i),s=o/a,u=0;u<a;u++)t(r+u*s);t(n)}(t,function(t){r=e(t),_(e,i,o,t,r,10,n),i=t,o=r}),n.finish()}function _(e,t,r,i,o,a,s){if(i!==t){var u=s.xtolerance,c=s.ytolerance,l=s.ztolerance,p=n.mean(t,i),f=e(p),d=isFinite(r[0])&&isFinite(r[1])&&(2===r.length||isFinite(r[2])),h=isFinite(o[0])&&isFinite(o[1])&&(2===o.length||isFinite(o[2])),m=isFinite(f[0])&&isFinite(f[1])&&(2===f.length||isFinite(f[2]));if(0===a||p===t||p===i)return s.breakSegment(),void(h&&s.addPoint(o));if(d||h)if(d===h){if(d&&m&&h){var y=n.pointToSegmentParameter(f[0],f[1],f[2]||0,r[0],r[1],r[2]||0,o[0],o[1],o[2]||0);if(.2<y&&y<.8&&Math.abs(f[0]-(r[0]+y*(o[0]-r[0])))<=u&&Math.abs(f[1]-(r[1]+y*(o[1]-r[1])))<=c&&(2===r.length||Math.abs(f[2]-(r[2]+y*(o[2]-r[2])))<=l))return void s.addPoint(o)}r[0]===f[0]&&r[1]===f[1]||_(e,t,r,p,f,a-1,s),o[0]===f[0]&&o[1]===f[1]||_(e,p,f,i,o,a-1,s)}else{for(var g=t,v=i,b=r,x=o;t!==p&&p!==i;)m==d?(t=p,r=f,d=m):(i=p,o=f,h=m),f=e(p=t+(i-t)/2),m=isFinite(f[0])&&isFinite(f[1])&&(2===f.length||isFinite(f[2]));d?(_(e,g,b,t,r,a-1,s),s.breakSegment()):(s.breakSegment(),s.addPoint(o),_(e,i,o,v,x,a-1,s))}}}function S(e,t,r){var n=e.viewport.xmin,i=e.viewport.xmax,o=e.viewport.ymin,a=e.viewport.ymax,s=e.trigAngleMultiplier||1,l=e.oversample||4,p=1/l*(i-n)/e.screen.width,f=1/l*(a-o)/e.screen.height,d=t.domainBound;switch(t.graphMode){case u.X:switch((y=c.intersectDomains(c.knownDomain([o,a]),d)).type){case"empty":return!1;case"known":o=y.bounds[0],a=y.bounds[1]}m={min:o,max:a,xtolerance:f,ytolerance:p,step:f};break;case u.Y:switch((y=c.intersectDomains(c.knownDomain([n,i]),d)).type){case"empty":return!1;case"known":n=y.bounds[0],i=y.bounds[1]}m={min:n,max:i,xtolerance:p,ytolerance:f,step:p};break;case u.POLAR:if(!t.domain)throw new Error("Expected polar graph to have domain");var h,m={min:t.domain.min,max:t.domain.max,step:2*Math.PI/s/1e3,tolerance:Math.min(p,f)};t.domain.isExplicit||(h=g(r,m,s,"="===t.operator))&&(m.max=m.min+h),m.step=Math.max(m.step,(m.max-m.min)/11999);break;case u.PARAMETRIC:case u.PARAMETRIC_CURVE_3D:var y,v=t.domain?t.domain.min:0,b=t.domain?t.domain.max:1,x=t.domain?t.domain.step:.01;switch((y=c.intersectDomains(c.knownDomain([v,b]),d)).type){case"empty":return!1;case"known":v=y.bounds[0],b=y.bounds[1]}m={min:v,max:b,step:x,xtolerance:p,ytolerance:f,ztolerance:Math.min(p,f)};break;case u.IMPLICIT:m={xmin:n,xmax:i,ymin:o,ymax:a,xtolerance:p,ytolerance:f};break;case u.Z_3D:return{xmin:-10,xmax:10,ymin:-10,ymax:10};default:return!1}return m}t.default={sampleXYNaive:function(e,t){for(var r,n=new s.default(t,e),i=t.min;i<=t.max+t.step/2;i+=t.step)r=e(i),isFinite(r)?n.addPoint([i,r]):n.breakSegment();return n.finish()},sampleLinear:l,sampleXY:y,findPiPeriod:g,samplePolar:b,sampleParametricRecursive:x,subsampleParametricRecursive:_,validateViewState:function(e){if(!e)return!1;var t=e.viewport.xmin,r=e.viewport.xmax,n=e.viewport.ymin,i=e.viewport.ymax;return!(!isFinite(t)||!isFinite(r)||r<=t)&&(!(!isFinite(n)||!isFinite(i)||i<=n)&&(!(!isFinite(e.screen.width)||e.screen.width<=0)&&!(!isFinite(e.screen.height)||e.screen.height<=0)))},computeDomain:S,computeGraphData:function(e){var t,r,n,i,a,s,c,f=e.viewState,d=e.graphInfo,h=e.compiled,m=e.derivative,g=e.discrete,v=e.maxOverride,_=h.fn,T=S(f,d,_),w=d.graphMode;if(T){switch(w){case u.X:case u.Y:var E,M,C,I,P=m?m.fn:void 0;I=g?(E=T.min,M=T.max,C=T.step,function(e){for(var t=e.fn,r=e.domain,n=r.min,i=r.max,o=Math.floor(n),a=Math.ceil(i),s=[],u=o;u<=a;u++){var c=t(u);isFinite(u)&&isFinite(c)&&s.push([u,c])}return{segments:s,resolved:!0}}({fn:_,domain:{min:Math.max(E,0),max:void 0!==v?Math.min(v,M):M,step:C}})):d.isLinear?l(d.linearCoefficients,T):y(_,T,P);break;case u.POLAR:I=b(_,T);break;case u.IMPLICIT:I=o.sampleImplicit(_,T);break;case u.PARAMETRIC:T.step||(T.step=(T.max-T.min)/1e3),I=T.max===T.min?p(_,T.min):d.isLinear?(r=d.linearCoefficients,n=T,i=l(r[0],n),a=l(r[1],n),i.segments.length&&a.segments.length&&4===i.segments[0].length&&4===a.segments[0].length?{segments:[[i.segments[0][1],a.segments[0][1],i.segments[0][3],a.segments[0][3]]],resolved:!0}:{segments:[],resolved:!0}):x(_,T);break;case u.PARAMETRIC_CURVE_3D:return T.step||(T.step=(T.max-T.min)/1e3),I=T.max===T.min?p(_,T.min):x(_,T),{graphMode:u.PARAMETRIC_CURVE_3D,segments:I.segments,cacheKey:h.source+":"+JSON.stringify(T),color:d.color,style:"dummy"};case u.Z_3D:return{meshData:function(e,t){for(var r=e.fn,n=t.xmin,i=t.xmax,o=t.ymin,a=(i-n)/30,s=(t.ymax-o)/30,u=[],c=[],l=[],p=a/1e3,f=s/1e3,d=0;d<30;d++)for(var h=0;h<30;h++){var m=n+d*a,y=o+h*s,g=r(m,y);u.push(m,y,g);var v=(r(m+p,y)-g)*f,b=(r(m,y+f)-g)*p,x=-p*f,_=Math.sqrt(v*v+b*b+x*x);c.push(v/_,b/_,x/_)}for(d=0;d<29;d++)for(h=0;h<29;h++){var S=30*h+d,T=30*h+d+1,w=30*(h+1)+d,E=30*(h+1)+d+1;l.push(S,w,T),l.push(w,E,T)}return{cacheKey:e.source+":"+JSON.stringify(t),positions:new Float32Array(u),normals:new Float32Array(c),faces:new Int16Array(l)}}(h,T),color:d.color,graphMode:u.Z_3D,poi:{zeros:{x:[],y:[]},extrema:{x:[],y:[]},intercept:{x:[],y:[]}},compiled:h,style:"dummy"};default:throw new Error("Programming Error: unexpected graphmode "+w)}t=I.poi}else I={segments:[],resolved:!0};if((!t||250<t.zeros.x.length+t.extrema.x.length+t.intercept.x.length)&&(t={zeros:{x:[],y:[]},extrema:{x:[],y:[]},intercept:{x:[],y:[]}}),w===u.X)for(var k in t){t.hasOwnProperty(k)&&(c=t[s=k].y,t[s].y=t[s].x,t[s].x=c)}var O={segments:I.segments,resolved:I.resolved,graphMode:w,color:d.color,style:g?d.pointStyle:d.lineStyle,lineWidth:d.lineWidth,lineOpacity:d.lineOpacity,operator:d.operator,poi:t,compiled:h};return w===u.POLAR&&(O.sampledDomain={min:T.min,max:T.max,step:T.step}),I.fillSegments&&(O.fillSegments=I.fillSegments),O},polygonsFromSegments:function(e,t,r){for(var i=function(e){var t=e[e.length-1];return t[t.length-2]},o=[],a=0,s=0,c=[],l=[],p=-1/0,f=-1/0;;){if(p<=f){if(a>=t.length)break;l.push(t[a++])}if(f<=p){if(s>=e.length)break;c.push(e[s++])}p=i(l),f=i(c),n.approx(p,f,4)&&(o.push(function(e,t,r){var n,i,o,a,s=[],c=null;switch(r){case u.POLAR:c=v;break;case u.X:c=function(e){return[e[1],e[0]]}}for(n=0;n<e.length;n++)for(a=e[n],i=0;i<a.length;i+=2)o=[a[i],a[i+1]],c&&(o=c(o)),s.push(o[0],o[1]);for(n=t.length-1;0<=n;n--)for(i=(a=t[n]).length-2;0<=i;i-=2)o=[a[i],a[i+1]],c&&(o=c(o)),s.push(o[0],o[1]);return s}(c,l,r)),l=[],c=[],f=p=Math.max(p,f))}return o}}});r("core/lib/deepCopy",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){var r=t;if(r&&"function"==typeof r.toJSON&&(r=r.toJSON()),!r)return r;if("object"!=typeof r)return r;if(Array.isArray(r))return r.map(e);var n={};for(var i in r)r.hasOwnProperty(i)&&(n[i]=e(r[i]));return n}});r("core/types/styles",["require","exports"],function(e,t){"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.LineStyle=t.PointStyle=void 0,(r=t.PointStyle||(t.PointStyle={})).POINT="POINT",r.OPEN="OPEN",r.CROSS="CROSS",(n=t.LineStyle||(t.LineStyle={})).SOLID="SOLID",n.DASHED="DASHED",n.DOTTED="DOTTED"});r("core/math/cdf-branches",["require","exports","tslib","core/lib/deepCopy","core/math/plotter","core/math/domaintypes","core/types/styles"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeCDFTopBranches=void 0;function s(e){var t=e.viewState,r=e.graphInfo,s=e.compiled,u=e.derivative,c=e.bounds,l=e.included,p=e.discrete,f=n.default(r),d=o.intersectDomains(r.domainBound,o.knownDomain(c));if("known"===d.type)return f.domainBound=d,p?f.pointStyle=l?a.PointStyle.POINT:a.PointStyle.OPEN:f.lineStyle=a.LineStyle.SOLID,i.default.computeGraphData({graphInfo:f,viewState:t,compiled:s,derivative:u,discrete:p})}t.makeCDFTopBranches=function(e){var t,n,o,a,u,c,l,p,f,d,h=e.viewState,m=e.graphInfo,y=e.compiled,g=e.derivative,v=e.bounds,b=e.discrete,x=e.maxOverride,_=v[0],S=v[1],T=[];return b?(_=Math.ceil(_),S=Math.floor(S),n=void 0!==x?x:1/0,_===-1/0&&n<=S?(t=s({bounds:[_,n],included:!0,viewState:h,graphInfo:m,compiled:y,derivative:g,discrete:b}),T.push(t)):_===-1/0&&S<1/0?(t=s({bounds:[_,S],included:!0,viewState:h,graphInfo:m,compiled:y,derivative:g,discrete:b}),T.push(t),T.push(s({bounds:[S+1,n],included:!1,viewState:h,graphInfo:m,compiled:y,derivative:g,discrete:b}))):-1/0<_&&n<=S?(t=s({bounds:[_,n],included:!0,viewState:h,graphInfo:m,compiled:y,derivative:g,discrete:b}),T.push(s({bounds:[-1/0,_-1],included:!1,viewState:h,graphInfo:m,compiled:y,derivative:g,discrete:b})),T.push(t)):(t=s({bounds:[_,S],included:!0,viewState:h,graphInfo:m,compiled:y,derivative:g,discrete:b}),o=s({bounds:[-1/0,_-1],included:!1,viewState:h,graphInfo:m,compiled:y,derivative:g,discrete:b}),a=s({bounds:[S+1,n],included:!1,viewState:h,graphInfo:m,compiled:y,derivative:g,discrete:b}),T.push(t),u=void 0,o&&a&&(l=a,p=(c=o).segments,f=l.segments,d=r.__spreadArrays(p,f),u=r.__assign(r.__assign({},c),{segments:d}),T.push(u)))):(t=s({bounds:[_,S],included:!0,viewState:h,graphInfo:m,compiled:y,derivative:g,discrete:b}),T.push(i.default.computeGraphData({viewState:h,graphInfo:m,compiled:y,derivative:g}))),{cdfTopBranch:t,topBranches:T}}});r("core/math/copy-defined-pois",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){for(var t=[],r=[],n=e.length,i=0;i<n;i++)t.push(e[i][0]),r.push(e[i][1]);return{defined:{x:t,y:r}}}});r("core/types/opacity",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HIGH=t.DEFAULT=t.LOW=void 0,t.LOW=.2,t.DEFAULT=.4,t.HIGH=.8});r("core/types/slider-loop-modes",["require","exports"],function(e,t){"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.getSliderIcon=t.SliderLoopMode=void 0,(n=r=t.SliderLoopMode||(t.SliderLoopMode={})).LOOP_FORWARD_REVERSE="LOOP_FORWARD_REVERSE",n.LOOP_FORWARD="LOOP_FORWARD",n.PLAY_ONCE="PLAY_ONCE",n.PLAY_INDEFINITELY="PLAY_INDEFINITELY",t.getSliderIcon=function(e){switch(e){case r.LOOP_FORWARD:return"dcg-icon-arrow-one-way";case r.LOOP_FORWARD_REVERSE:return"dcg-icon-arrow-two-way";case r.PLAY_ONCE:return"dcg-icon-arrow-once";case r.PLAY_INDEFINITELY:return"dcg-icon-arrow-infinite"}}});r("core/types/label-sizes",["require","exports"],function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LabelSize=void 0,(r=t.LabelSize||(t.LabelSize={})).SMALL="small",r.MEDIUM="medium",r.LARGE="large"});r("core/types/label-orientations",["require","exports"],function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LabelOrientation=void 0,(r=t.LabelOrientation||(t.LabelOrientation={})).DEFAULT="default",r.LEFT="left",r.RIGHT="right",r.ABOVE="above",r.BELOW="below"});r("core/lib/default-spec",["require","exports","underscore","core/lib/deepCopy"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.populateDefaults=t.stripDefaultsAndMaybeReturnUndefined=t.stripDefaults=void 0,t.stripDefaults=function(e,t){var n={};for(var i in t)t.hasOwnProperty(i)&&(r.isEqual(e[i],t[i])||(n[i]=t[i]));return n},t.stripDefaultsAndMaybeReturnUndefined=function(e,t){var n=void 0,i={};for(var o in t)t.hasOwnProperty(o)&&(r.isEqual(e[o],t[o])||(i[o]=t[o],n=i));return n},t.populateDefaults=function(e,t){t=t||{};var r={};for(var i in e)e.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(r[i]=n.default(e[i]));for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r}});r("core/graphing-calc/json/expression",["require","exports","tslib","core/types/opacity","core/types/styles","core/lib/dragmode","core/types/slider-loop-modes","core/types/label-sizes","core/types/label-orientations","core/lib/default-spec"],function(e,t,r,n,i,o,a,s,u,c){"use strict";var l,p;Object.defineProperty(t,"__esModule",{value:!0}),t.computeParsableState=t.stripDefaults=t.inflateDefaults=t.SLIDER_DEFAULTS=t.DEFAULTS=t.DEFAULT_SLIDER_PERIOD=t.EditableLabelMode=t.CLICKABLEINFO_DEFAULTS=t.VIZ_DEFAULTS=t.CDF_DEFAULTS=void 0,t.CDF_DEFAULTS={show:!1,min:"",max:""},t.VIZ_DEFAULTS={breadth:"",axisOffset:"",alignedAxis:"x",showBoxplotOutliers:!0,binAlignment:"center",dotplotXMode:"exact",dotplotSize:"medium",histogramMode:""},t.CLICKABLEINFO_DEFAULTS={enabled:!1,description:"",rules:[{id:"1",expression:"",assignment:""}]},(p=l=t.EditableLabelMode||(t.EditableLabelMode={})).None="NONE",p.Math="MATH",p.Text="TEXT",t.DEFAULT_SLIDER_PERIOD=4e3,t.DEFAULTS={folderId:"",latex:"",color:"",showLabel:!1,label:"",cdf:t.CDF_DEFAULTS,vizProps:t.VIZ_DEFAULTS,clickableInfo:t.CLICKABLEINFO_DEFAULTS,hidden:!1,secret:!1,dragMode:o.DragMode.AUTO,labelSize:s.LabelSize.MEDIUM,labelOrientation:u.LabelOrientation.DEFAULT,verticalLabel:!1,suppressTextOutline:!1,interactiveLabel:!1,editableLabelMode:l.None,residualVariable:"",isLogModeRegression:!1,pointStyle:i.PointStyle.POINT,lineStyle:i.LineStyle.SOLID,fillOpacity:""+n.DEFAULT,lineOpacity:"",pointOpacity:"",colorLatex:"",lineWidth:"",regressionParameters:{},displayEvaluationAsFraction:!1,slider:{},polarDomain:{min:"",max:""},parametricDomain:{min:"",max:""},points:void 0,lines:void 0,fill:void 0},t.SLIDER_DEFAULTS={hardMin:!1,hardMax:!1,animationPeriod:t.DEFAULT_SLIDER_PERIOD,loopMode:a.SliderLoopMode.LOOP_FORWARD_REVERSE,playDirection:1,isPlaying:!1,min:"-10",max:"10",step:""},t.inflateDefaults=function(e){return r.__assign(r.__assign(r.__assign({},t.DEFAULTS),e),{slider:r.__assign(r.__assign({},t.SLIDER_DEFAULTS),e.slider),cdf:r.__assign(r.__assign({},t.CDF_DEFAULTS),e.cdf),vizProps:r.__assign(r.__assign({},t.VIZ_DEFAULTS),e.vizProps),clickableInfo:r.__assign(r.__assign({},t.CLICKABLEINFO_DEFAULTS),e.clickableInfo)})},t.stripDefaults=function(e){var n=c.stripDefaults(t.DEFAULTS,r.__assign(r.__assign({},e),{slider:c.stripDefaults(t.SLIDER_DEFAULTS,e.slider)})),i=c.stripDefaultsAndMaybeReturnUndefined(t.CDF_DEFAULTS,e.cdf);void 0===i?delete n.cdf:n.cdf=i;var o=c.stripDefaultsAndMaybeReturnUndefined(t.VIZ_DEFAULTS,e.vizProps);void 0===o?delete n.vizProps:n.vizProps=o;var a=c.stripDefaultsAndMaybeReturnUndefined(t.CLICKABLEINFO_DEFAULTS,e.clickableInfo);return void 0===a?delete n.clickableInfo:n.clickableInfo=a,n},t.computeParsableState=function(e){return{type:"statement",id:e.id,latex:e.latex,label:e.label,color:e.color,fill:e.fill,fillOpacity:e.fillOpacity,lineOpacity:e.lineOpacity,pointOpacity:e.pointOpacity,colorLatex:e.colorLatex,lineWidth:e.lineWidth,points:e.points,lines:e.lines,pointStyle:e.pointStyle,lineStyle:e.lineStyle,dragMode:e.dragMode,labelSize:e.labelSize,labelOrientation:e.labelOrientation,verticalLabel:e.verticalLabel,suppressTextOutline:e.suppressTextOutline,interactiveLabel:e.interactiveLabel,editableLabelMode:e.editableLabelMode,residualVariable:e.residualVariable,regressionParameters:e.regressionParameters,isLogModeRegression:e.isLogModeRegression,showLabel:e.showLabel,shouldGraph:e.hidden,slider:{min:e.slider.hardMin?e.slider.min:"",max:e.slider.hardMax?e.slider.max:"",softMin:e.slider.hardMin?"":e.slider.min,softMax:e.slider.hardMax?"":e.slider.max,step:e.slider.step,isPlayingOnce:e.slider.isPlaying&&e.slider.loopMode===a.SliderLoopMode.PLAY_ONCE},parametricDomain:e.parametricDomain,polarDomain:e.polarDomain,cdf:e.cdf,vizProps:e.vizProps,clickableInfo:e.clickableInfo}}});r("core/math/features/graph",["require","underscore","parsenodes","core/math/plotter","core/types/graphmode","core/math/comparators","core/lib/dragmode","core/math/expression-types","core/math/types","core/math/builtin","core/math/cdf-branches","core/math/copy-defined-pois","core/math/distribution-spec","core/graphing-calc/json/expression","core/types/opacity","core/lib/color-helpers","core/types/styles"],function(e){"use strict";var t=e("underscore"),r=e("parsenodes"),n=e("core/math/plotter").default,i=e("core/types/graphmode"),o=e("core/math/comparators"),a=e("core/lib/dragmode").DragMode,s=e("core/math/expression-types").getReconciledExpressionProps,u=e("core/math/types"),c=r.List,l=e("core/math/builtin"),p=e("core/math/cdf-branches").makeCDFTopBranches,f=e("core/math/copy-defined-pois").default,d=e("core/math/distribution-spec").getFunctionSpecFromTree,h=e("core/graphing-calc/json/expression").EditableLabelMode,m=e("core/types/opacity"),y=e("core/lib/color-helpers").getDisplayColor,g=e("core/types/styles").PointStyle;function v(e,t){for(var r=1/0,n=-1/0,i=1/0,o=-1/0,a=0;a<t.length;a++)for(var s=t[a],u=0;u<s.length;u+=2){var c=s[u],l=s[u+1];c<r&&(r=c),n<c&&(n=c),l<i&&(i=l),o<l&&(o=l)}if(isFinite(r)&&isFinite(i))return{type:e,xmin:r,ymin:i,xmax:n,ymax:o}}function b(e,t,r){var n={};r-=.5*t;for(var i=e.length-1;0<=i;i--){var o=e[i],a=Math.floor((o-r)/t);n[a]?n[a].data.push(o):n[a]={id:a,data:[o],min:a*t+r,max:a*t+r+t,center:a*t+r+t/2}}return n}r.Base.prototype._graph=function(e,o,a,m){if(o instanceof r.SolvedEquation)return this._graph(e,o._expression,a,m);function g(e){var t=e.editableLabelMode;return t===h.Text||t===h.Math}var v,b,_,S,T=this,w=o.getExpressionType(m.graphMode,o.valueType),E=s(w,{points:this.userData.points,lines:this.userData.lines,fill:this.userData.fill});switch(m.graphMode){case i.XYPOINT_MOVABLE:return v=[o.asArray()],b=this.userData.shouldGraph&&E.points,S=this.userData.showLabel&&!b,b?[{segments:[v],graphMode:m.graphMode,color:y(this.userData,this.metaData),style:this.userData.pointStyle,showLabel:!!this.userData.showLabel,labelSize:this.userData.labelSize,labelOrientation:this.userData.labelOrientation,pointOpacity:this.metaData.computedPointOpacity,verticalLabel:this.userData.verticalLabel,suppressTextOutline:this.userData.suppressTextOutline,editableLabel:g(this.userData),labels:this.computedLabels||[],poi:f(v)}]:S?[{segments:[v],graphMode:i.XYPOINT,color:y(this.userData,this.metaData),style:this.userData.pointStyle,showLabel:!!this.userData.showLabel,nakedLabel:!0,labelSize:this.userData.labelSize,labelOrientation:this.userData.labelOrientation,pointOpacity:this.metaData.computedPointOpacity,verticalLabel:this.userData.verticalLabel,suppressTextOutline:this.userData.suppressTextOutline,editableLabel:g(this.userData),labels:this.computedLabels||[],poi:f(v)}]:[];case i.XYPOINT:return P=[],v=c.wrap(o).mapElements(e,function(e){return e.asArray()}),b=this.userData.shouldGraph&&E.points,_=this.userData.shouldGraph&&E.lines,S=this.userData.showLabel&&!b&&!_,(this.userData.showLabel||b)&&P.push({segments:[v],graphMode:m.graphMode,color:y(this.userData,this.metaData),style:this.userData.pointStyle,showLabel:!!this.userData.showLabel,showPoint:b,labelSize:this.userData.labelSize,labelOrientation:this.userData.labelOrientation,pointOpacity:this.metaData.computedPointOpacity,verticalLabel:this.userData.verticalLabel,suppressTextOutline:this.userData.suppressTextOutline,interactiveLabel:!!this.userData.interactiveLabel,editableLabel:g(this.userData),nakedLabel:S,labels:this.computedLabels||[],poi:f(v)}),_&&P.push({segments:[v].map(x),graphMode:i.PARAMETRIC,color:y(this.userData,this.metaData),style:this.userData.lineStyle,lineWidth:this.metaData.computedLineWidth,lineOpacity:this.metaData.computedLineOpacity,poi:[]}),P;case i.PARAMETRIC:case i.PARAMETRIC_CURVE_3D:var M=this.userData,C=this.metaData,I=[],P=c.wrap(o).mapElements(e,function(t,r){if(0===t.getDependencies().length)return{segments:[v=[t.asArray()]],graphMode:i.XYPOINT,color:y(M,C),style:M.lineStyle,lineWidth:T.metaData.computedLineWidth,lineOpacity:T.metaData.computedLineOpacity,poi:f(v)};var o=t.getCompiledFunction(),s=T.getGraphInfo(e,t,r);return s.graphMode=m.graphMode,s.domain={min:T.metaData.evaluatedDomainMin,max:T.metaData.evaluatedDomainMax},s.style=T.userData.lineStyle,s.lineWidth=T.metaData.computedLineWidth,s.lineOpacity=T.metaData.computedLineOpacity,n.computeGraphData({viewState:a,graphInfo:s,compiled:o})});if(E.fill){if(P.forEach(function(e){I.push({segments:e.segments,color:y(M,C),fillOpacity:T.metaData.computedFillOpacity,graphMode:i.POLYGONFILL,poi:[]})}),!E.lines)return I;P=P.concat(I)}return P;case i.X:case i.Y:case i.IMPLICIT:case i.POLAR:case i.Z_3D:P=[];var k=o.valueType===u.Number;return c.wrap(o).eachElement(e,function(r,o){var s,u=m.graphMode===i.IMPLICIT||m.graphMode===i.Z_3D?r.getCompiledFunction(["x","y"]):r.getCompiledFunction(),c=d(T),h=c&&c.discrete,g=function(e,t){if(e){var r,n,i,o,a,s,u,c=e.discrete?"discreteDistribution":"continuousDistribution";if("binomialdist"===e.symbol)return r=t.args[1].asValue(),n=2<t.args.length?t.args[2].asValue():.5,{type:c,xmin:0,xmax:r,ymin:0,ymax:p=l.binompdf(n*r,r,n)};if("poissondist"===e.symbol)return{type:c,xmin:0,xmax:2.5*(i=t.args[1].asValue()),ymin:0,ymax:p=Math.max(l.poissonpdf(Math.floor(i),i),l.poissonpdf(Math.ceil(i),i))};if("normaldist"===e.symbol)return i=1<t.args.length?t.args[1].asValue():0,o=2<t.args.length?t.args[2].asValue():1,p=l.normalpdf(i,i,o),{type:c,xmin:i-2*Math.abs(o),xmax:i+2*Math.abs(o),ymin:0,ymax:p};if("uniformdist"===e.symbol)return i=((a=1<t.args.length?t.args[1].asValue():0)+(s=2<t.args.length?t.args[2].asValue():1))/2,{type:c,xmin:a-(u=s-a)/3,xmax:s+u/3,ymin:0,ymax:p=l.uniformpdf(i,a,s)};if("tdist"===e.symbol){var p,f=t.args[1].asValue();return{type:c,xmin:-3,xmax:3,ymin:0,ymax:p=l.tpdf(0,f)}}}}(c,r);try{s=r.getCompiledDerivative()}catch(r){}var v=T.getGraphInfo(e,r,o);v.graphMode=m.graphMode,v.style=T.userData.lineStyle,v.lineWidth=T.metaData.computedLineWidth,v.lineOpacity=T.metaData.computedLineOpacity,m.graphMode===i.POLAR&&(v.domain={min:T.metaData.evaluatedDomainMin,max:T.metaData.evaluatedDomainMax,isExplicit:T.metaData.isExplicitDomain});var b=T.metaData.evaluatedCDFMin,x=T.metaData.evaluatedCDFMax;if(isNaN(b)||isNaN(x)||!k){var _={viewState:a,graphInfo:v,compiled:u,derivative:s,discrete:h};c&&"binomialdist"===c.symbol&&(_.maxOverride=r.args[1].asValue());var S=n.computeGraphData(_);g&&(S.boundingBox=g),S.fillSegments?P.push(t.omit(S,"fillSegments")):h?P.push({graphMode:i.XYPOINT,segments:[S.segments],showPoint:T.userData.shouldGraph,color:y(T.userData,T.metaData),style:S.style,boundingBox:g,poi:f(S.segments)}):P.push(S),v.graphMode===i.IMPLICIT&&"="!==v.operator&&P.push({graphMode:i.POLYGONFILL,segments:S.fillSegments,poi:{}})}else{var w={viewState:a,graphInfo:v,compiled:u,derivative:s,bounds:[b,x],discrete:h};c&&"binomialdist"===c.symbol&&(w.maxOverride=r.args[1].asValue());var E,M=p(w),C=M.cdfTopBranch,I=t.each(M.topBranches,function(e){e&&(e.boundingBox=g)});if(t.every(I,function(e){return void 0!==e}))if(h)P=I.map(function(e){return{graphMode:i.XYPOINT,segments:[e.segments],showPoint:T.userData.shouldGraph,color:y(T.userData,T.metaData),style:e.style,poi:f(e.segments),boundingBox:g}}),C&&C.segments.length&&(E=[],C.segments.forEach(function(e){E.push([e[0],0,e[0],e[1]])}),P.push({graphMode:i.PARAMETRIC,segments:E,boundingBox:g,poi:{}}));else if(P=I,C&&C.segments.length){for(var O,D,N,A,L=0;L<C.segments.length;L++)if(4<=(O=C.segments[L]).length){D=O[0];break}for(L=C.segments.length-1;0<=L;L--)if(4<=(O=C.segments[L]).length){N=O[O.length-2];break}isFinite(D)&&isFinite(N)&&(A=n.polygonsFromSegments(C.segments,[[D,0,N,0]],C.graphMode),P.push({graphMode:i.POLYGONFILL,segments:A,poi:{}}))}}}),P;default:return!1}},r.Base.prototype.graph=function(e,t,r){var n=this.getGraphInfo(e,t);return this._graph(e,t,r,n)},r.BaseComparator.prototype.graph=function(e,t,a){var s=this.getGraphInfo(e,t),u=s.graphMode;if(u===i.IMPLICIT)return this._graph(e,t,a,s);if(u===i.NONE)return!1;if(!(t instanceof r.SolvedEquation))return!1;var c,l=this.getOperator(),p=[],f=[],d=!0;t._expression.eachElement(e,function(e){p.push(e.getCompiledFunction());try{f.push(e.getCompiledDerivative())}catch(e){d=!1}}),d||(f=void 0);for(var h=[],m=[-1,0,0,1],y=p.length,g=0;g<y;g++){var v=this.getGraphInfo(e,t._expression.args[g]);v.graphMode=u,v.style=this.userData.lineStyle,s.graphMode===i.POLAR&&(v.domain={min:this.metaData.evaluatedDomainMin,max:this.metaData.evaluatedDomainMax,isExplicit:this.metaData.isExplicitDomain}),(c=n.computeGraphData({viewState:a,graphInfo:v,compiled:p[g],derivative:f?f[g]:void 0})).operator=o.get(o.table[l].inclusive,m[g%4]),h.push(c)}for(g=0;g<y;g+=4){var b=n.polygonsFromSegments(h[g+1].segments,h[g+2].segments,u);h.push({graphMode:i.POLYGONFILL,segments:b,poi:{}})}return h},r.DoubleInequality.prototype.graph=function(e,t,r){var a=this.getGraphInfo(e,t);if(a.graphMode===i.NONE)return!1;var s=[],u=o.get(o.table[this._operators[0]].inclusive,0),l=o.get(o.table[this._operators[1]].inclusive,0),p=this.userData,f=this.metaData,d=this;return c.eachArgs(e,t._expressions,function(t){var o,c;t[0].userData=t[1].userData=p,t[0].metaData=t[1].metaData=f,(o=d._graph(e,t[0],r,a)[0]).operator=u,s.push(o),(c=d._graph(e,t[1],r,a)[0]).operator=l,s.push(c);var h=n.polygonsFromSegments(o.segments,c.segments,o.graphMode);s.push({graphMode:i.POLYGONFILL,segments:h,poi:{}})}),s},r.Regression.prototype.graph=function(e,t,r){var n=this.getGraphInfo(e,t);return this._graph(e,t.model,r,n)},r.Polygon.prototype.graph=function(e,t,r){for(var n,o=this.getGraphInfo(e,t),a=t.args[0].asValue(),s=[],u=void 0===this.userData.lines||this.userData.lines,c=void 0===this.userData.fill||this.userData.fill,l=[],p=[],f=0;f<a.length;f++){var d=a[f][0],h=a[f][1];isFinite(d)&&isFinite(h)?(u||c)&&p.push([d,h]):(u||c)&&(1<p.length&&l.push(p),p=[])}return(l.length||p.length)&&(p.push([a[0][0],a[0][1]]),l.push(p),n=l.map(x),c&&s.push({segments:n,graphMode:i.POLYGONFILL,poi:[],color:o.color,fillOpacity:this.metaData.computedFillOpacity,style:o.style}),u&&s.push({segments:n,graphMode:i.PARAMETRIC,poi:[],color:o.color,style:this.userData.lineStyle,lineWidth:this.metaData.computedLineWidth,lineOpacity:this.metaData.computedLineOpacity})),s};function x(e){return Array.prototype.concat.apply([],e)}r.Object3D.prototype.graph=function(e,t,r){var n,o,a,s=this.getGraphInfo(e,t);return[{segments:[(n=e,o=t,a=[],c.wrap(o).eachElement(n,function(e){a.push(e.args.map(function(e){return e.asValue()}))}),a)],color:s.color,objectName:this._symbol,poi:[],graphMode:i.OBJECT3D}]},r.Histogram.prototype.graph=function(e,t,r){var n=this.getGraphInfo(e,t),o=t.args[0].asValue(),a=t.args[1].asValue(),s=b(o,a,this.userData.vizProps&&"left"===this.userData.vizProps.binAlignment?a/2:0),u=1;this.userData.vizProps&&"density"===this.userData.vizProps.histogramMode?u=1/(o.length*a):this.userData.vizProps&&"relative"===this.userData.vizProps.histogramMode&&(u=1/o.length);var c=[],l=[];for(var p in s){var f=s[p],d=f.data.length;l.push([f.min,0*u,f.min,d*u,f.max,d*u,f.max,0*u]);var h=0;s[f.id+1]&&(h=s[f.id+1].data.length);var y=[f.min,0*u,f.min,d*u,f.max,d*u];h<d&&y.push(f.max,h*u),c.push(y)}var g=v("histogram",l);return g&&a&&(g.binWidth=a),[{segments:l,graphMode:i.POLYGONFILL,boundingBox:g,poi:[],color:n.color,fillOpacity:m.DEFAULT},{segments:c,graphMode:i.Y,poi:{zeros:{x:[],y:[]},extrema:{x:[],y:[]},intercept:{x:[],y:[]}},color:n.color}]},r.DotPlot.prototype.graph=function(e,t,r){var n,o,a,s,u=this.getGraphInfo(e,t),c=t.args[1].asValue(),l=this.userData.vizProps&&"left"===this.userData.vizProps.binAlignment?c/2:0,p=b(t.args[0].asValue(),c,l),d=!1,h=[];for(o in p)for(var m=(a=p[o]).data.length-1;0<=m;m--)a.center!==a.data[m]&&(d=!0);if(this.userData.vizProps&&"exact"===this.userData.vizProps.dotplotXMode)for(o in p)for((s=(a=p[o]).data).reverse(),n=0;n<s.length;n++)h.push([s[n],n+1]);else for(o in p)for(s=(a=p[o]).data,n=0;n<s.length;n++)h.push([a.center,n+1]);var y=v("dotplot",h);return y&&c&&(y.ymin=0,y.xmin-=.5*c,y.xmax+=.5*c,y.binWidth=c),[{segments:[h],graphMode:i.XYPOINT,boundingBox:y,poi:f(h),color:u.color,style:this.userData.pointStyle,pointSize:this.userData.vizProps&&this.userData.vizProps.dotplotSize,showPoint:!0,needsDotplotXMode:d}]},r.BoxPlot.prototype.graph=function(e,t,r){var n=this.getGraphInfo(e,t),o=this.metaData.evaluatedAxisOffset,a=this.metaData.evaluatedBreadth,s=t.args[0].asValue();if(isNaN(a)||isNaN(o))return{};var u,c,p,d=Math.min.apply(null,s),h=Math.max.apply(null,s),m=l.quartile(s,1),y=l.quartile(s,2),b=l.quartile(s,3),x=o,_=x-a/2,S=x+a/2,T=a/10,w=[];this.userData.vizProps.showBoxplotOutliers&&(c=m-1.5*(u=b-m),p=b+1.5*u,d=1/0,h=-1/0,s.forEach(function(e){c<=e&&e<d&&(d=e),h<e&&e<=p&&(h=e),(e<c||p<e)&&w.push([e,x])}));var E=[[m,_,b,_,b,S,m,S,m,_],[y,_,y,S],[m,x,d,x],[b,x,h,x],[d,x-T,d,x+T],[h,x-T,h,x+T]];if(this.userData.vizProps&&"y"===this.userData.vizProps.alignedAxis){for(var M=0;M<E.length;M++)for(var C=E[M],I=0;I<C.length;I+=2)k=C[I],C[I]=C[I+1],C[I+1]=k;for(M=0;M<w.length;M++){var P=w[M],k=P[0];P[0]=P[1],P[1]=k}}var O=[{segments:E,graphMode:i.PARAMETRIC,boundingBox:v("boxplot",E.concat(w)),poi:[],color:n.color}];return w.length&&O.push({segments:[w],graphMode:i.XYPOINT,color:n.color,style:g.OPEN,showPoint:!0,poi:f(w)}),O},r.Table.prototype.isValueDraggable=function(e,t,r){if(!e.columns[t].isIndependent)return!1;var n=this.columns[t].values,i=n&&n[r];return!(!i||!isFinite(i.asValue())||0!==i._dependencies.length)},r.Table.prototype.graph=function(e,t,r){var n=[];if(t.columns[0].isError)return n;for(var o=t.columns[0],s=o.values,u=1;u<this.columns.length;u++){var c=t.columns[u];if(!c.isError){var l=this.columns[u].header.userData,p=this.columns[u].header.metaData;if(!l.hidden){for(var d=l.dragMode,h=d===a.X||d===a.XY,m=d===a.Y||d===a.XY,g=!!l.points,v=!!l.lines,b=c.isDiscrete(o),_=v&&b,S=v&&!b,T=[],w=[],E=[],M=[],C=[],I=[],P=1/0,k=-1/0,O=1/0,D=-1/0,N=0;N<s.length;N++){var A,L,F,R,q=s[N],V=c.values[N];q&&V&&isFinite(q.asValue())&&isFinite(V.asValue())?(A=q.asValue(),L=V.asValue(),g&&(F=h&&this.isValueDraggable(t,0,N),R=m&&this.isValueDraggable(t,u,N),F||R?(E.push([A,L]),M.push({index:N,dragX:F,dragY:R})):w.push([A,L])),_&&I.push([A,L]),A<P&&(P=A),k<A&&(k=A),L<O&&(O=L),D<L&&(D=L)):_&&(1<I.length&&C.push(I),I=[])}var z,j={type:"table",xmin:P,xmax:k,ymin:O,ymax:D};E.length&&T.push({graphMode:i.XYPOINT_MOVABLE,segments:[E],color:y(l,p),tableId:l.tableId,poi:f(E),movablePointInfo:M,boundingBox:j}),w.length&&T.push({segments:[w],graphMode:i.XYPOINT,showPoint:!0,poi:f(w),color:y(l,p),style:l.pointStyle,tableId:l.tableId,boundingBox:j}),(C.length||I.length)&&(C.push(I),T.push({segments:C.map(x),graphMode:i.PARAMETRIC,poi:[],color:y(l,p),style:l.lineStyle,tableId:l.tableId,boundingBox:j})),!S||(z=this.columns[u].header.graph(e,t.columns[u].header,r)).length&&Array.prototype.push.apply(T,z),T.length&&(n[l.id]=T)}}}return n},r.Image.prototype.graph=function(e,t,r){var n=[];if(!("OrderedPair"===t.center.type&&t.center.args[0].isConstant&&t.center.args[1].isConstant&&t.radianAngle.isConstant&&t.width.isConstant&&t.height.isConstant&&t.opacity.isConstant))return n;for(var o,a,s,u=[],c=[],l=t.width.asValue()/2,p=t.height.asValue()/2,d=t.radianAngle.asValue(),h=-1;h<=1;h++)for(var m=-1;m<=1;m++){var g=[t.center.args[0].asValue()+h*l*Math.cos(d)+m*p*Math.sin(d),t.center.args[1].asValue()-h*l*Math.sin(d)+m*p*Math.cos(d)];(o=t.moveStrategy,a=h,s=m,!!o&&(0===a&&0===s?"none"!==o[2].type||"none"!==o[3].type:0!==a&&0!==s?"none"!==o[0].type&&"none"!==o[1].type:0!==a?"none"!==o[0].type:0!==s&&"none"!==o[1].type))&&(u.push(g),c.push([h,m]))}return n.push({segments:[u],scaleFactors:[c],graphMode:i.XYPOINT_MOVABLE,color:y(this.userData,this.metaData),style:this.userData.style,poi:f(u)}),n}});r("core/math/features/elementAt",["require","parsenodes","core/math/builtinframe"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/builtinframe");function n(e,t){for(var r=0;r<this.length;r++)t(this.elementAt(e,r),r)}function i(e,t){for(var r=[],n=0;n<this.length;n++)r.push(t(this.elementAt(e,n),n));return r}t.List.prototype.elementAt=function(e,r){return 0<=(r=Math.floor(r))&&r<this.args.length?this.args[r]:t.Constant(NaN)},t.Broadcast.prototype.elementAt=function(e,n){if((n=Math.floor(n))<0||n>=this.length)return t.Constant(NaN);for(var i={},o=0;o<this._replacedSymbols.length;o++)i[this._replacedSymbols[o]]=this._lists[o].elementAt(e,n);return this._expression.substitute(i).getConcreteTree(e,r)},t.Broadcast.prototype.asList=function(e){for(var r=[],n=0;n<this.length;n++)r.push(this.elementAt(e,n));return t.List(r)},t.List.prototype.eachElement=n,t.Broadcast.prototype.eachElement=n,t.List.prototype.mapElements=i,t.Broadcast.prototype.mapElements=i,t.OrderedPair.prototype.elementAt=function(e,r){switch(r){case 0:return this.args[0];case 1:return this.args[1];default:return t.Constant(NaN)}},t.RGBColor.prototype.elementAt=function(e,r){switch(r){case 0:return this.args[0];case 1:return this.args[1];case 2:return this.args[2];default:return t.Constant(NaN)}}});r("core/lib/number-to-latex",["require","exports"],function(e,t){"use strict";function r(e){var t,r,n,i,o,a,s=e+"";return/\d+\.?\d*e[\+\-]*\d+/i.test(s)&&(t=String(s).toLowerCase().split("e"),r=parseFloat(t[0]),n=parseInt(t[1],10),i=Math.abs(n),o=Math.abs(r).toString().split("."),s=n<0?"0."+new Array(i).join("0")+o.join(""):((a=o[1])&&(i-=a.length),o.join("")+new Array(i+1).join("0")),r<0&&(s="-"+s)),s}Object.defineProperty(t,"__esModule",{value:!0}),t.numberToStatsConfidenceLatex=t.numberToDecimalString=void 0,t.default=function(e){if("string"==typeof e)return e;if(void 0===e)return"";var t=e+"";return t=(t=t.replace(/1e\+?([-\d]+)/,"10^{$1}")).replace(/([-\d\.]+)e\+?([-\d]+)/,"$1\\cdot 10^{$2}")},t.numberToDecimalString=r,t.numberToStatsConfidenceLatex=function(e,t){void 0===t&&(t=2);var n,i=r(e),o=i.indexOf(".");if(-1===o)return i;for(var a=o+1;a<i.length;a++)if(n){if(i[a]!==n)break}else{if("0"!==i[a]&&"9"!==i[a])break;n=i[a]}return i.substr(0,Math.max(o+5,a+t))}});r("core/math/features/printLatex",["require","parsenodes","core/lib/label","core/lib/number-to-latex"],function(e){"use strict";var t=e("parsenodes"),r=e("core/lib/label"),n=e("core/lib/number-to-latex").default;function i(){return r.identifierToLatex(this._symbol)+" "}function o(e){switch(e){case">":return"\\gt ";case"<":return"\\lt ";case">=":return"\\ge ";case"<=":return"\\le ";case"=":return"="}}function a(e){return e.printLatex()}function s(){switch(this._symbol){case"sqrt":return"\\sqrt{"+this.args[0].printLatex()+"}";case"nthroot":return"\\sqrt["+this.args[1].printLatex()+"]{"+this.args[0].printLatex()+"}";case"logbase":return"\\log_{"+this.args[1].printLatex()+"}\\left("+this.args[0].printLatex()+"\\right)";default:return r.identifierToLatex(this._symbol)+"\\left("+this.args.map(a).join(", ")+"\\right)"}}function u(e){return e.isConstant&&!0===e.asValue()}t.Identifier.prototype.printLatex=i,t.FreeVariable.prototype.printLatex=i,t.Constant.prototype.printLatex=function(){return n(this.asValue())},t.Negative.prototype.printLatex=function(){return"-\\left("+this.args[0].printLatex()+"\\right)"},t.Add.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)+\\left("+this.args[1].printLatex()+"\\right)"},t.PercentOf.prototype.printLatex=function(){return this.args[0].printLatex()+" \\% \\operatorname{of} "+this.args[1].printLatex()},t.Subtract.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)-\\left("+this.args[1].printLatex()+"\\right)"},t.Multiply.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)*\\left("+this.args[1].printLatex()+"\\right)"},t.Divide.prototype.printLatex=function(){return"\\frac{"+this.args[0].printLatex()+"}{"+this.args[1].printLatex()+"}"},t.Exponent.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)^{"+this.args[1].printLatex()+"}"},t.Assignment.prototype.printLatex=function(){return r.identifierToLatex(this._symbol)+"="+this._expression.printLatex()},t.Equation.prototype.printLatex=function(){return this._lhs.printLatex()+"="+this._rhs.printLatex()},t.BaseComparator.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)"+o(this.operator)+"\\left("+this.args[1].printLatex()+"\\right)"},t.DoubleInequality.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)"+o(this.args[1])+this.args[2].printLatex()+o(this.args[3])+"\\left("+this.args[4].printLatex()+"\\right)"},t.And.prototype.printLatex=function(){if(!(this.args[0]instanceof t.BaseComparator&&this.args[1]instanceof t.BaseComparator))throw new Error("Not implemented");if(this.args[0].args[1].printLatex()!==this.args[1].args[0].printLatex())throw new Error("Not implemented");return"\\left("+this.args[0].args[0].printLatex()+"\\right)"+o(this.args[0].operator)+"\\left("+this.args[0].args[1].printLatex()+"\\right)"+o(this.args[1].operator)+"\\left("+this.args[1].args[1].printLatex()+"\\right)"},t.NativeFunction.prototype.printLatex=s,t.TypedFunction.prototype.printLatex=s,t.ReducerFunction.prototype.printLatex=s,t.ParametrizedReducerFunction.prototype.printLatex=s,t.DoubleReducerFunction.prototype.printLatex=s,t.FunctionCall.prototype.printLatex=s,t.Distribution.prototype.printLatex=s,t.SeededFunctionCall.prototype.printLatex=function(){return r.identifierToLatex(this._symbol)+"\\left("+this.args.slice(1).map(a).join(", ")+"\\right)"},t.DotAccess.prototype.printLatex=function(){return"("+this.args[0].printLatex()+").("+this.args[1].printLatex()+")"},t.DotAccessExponent.prototype.printLatex=function(){return"("+this.args[0].printLatex()+").("+this.args[1].printLatex()+")^{"+this.args[2].printLatex()+"}"},t.Prime.prototype.printLatex=function(){switch(this.args[0]._symbol){case"logbase":return"\\log_{"+this.args[0].args[1].printLatex()+"}"+Array(this.order+1).join("'")+"\\left("+this.args[0].args[0].printLatex()+"\\right)";default:return r.identifierToLatex(this.args[0]._symbol)+Array(this.order+1).join("'")+"\\left("+this.args[0].args.map(a).join(", ")+"\\right)"}},t.List.prototype.printLatex=function(){return"\\left["+this.args.map(a).join(", ")+"\\right]"},t.Range.prototype.printLatex=function(){return"\\left["+this.args[0].args.map(a).join(", ")+" ... "+this.args[1].args.map(a).join(", ")+"\\right]"},t.ListAccess.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)\\left["+this.args[1].printLatex()+"\\right]"},t.OrderedPair.prototype.printLatex=function(){return"\\left("+this.args.map(a).join(", ")+"\\right)"},t.Sum.prototype.printLatex=function(){return"\\sum_{"+this.args[0].printLatex()+"="+this.args[1].printLatex()+"}^{"+this.args[2].printLatex()+"}\\left("+this.args[3].printLatex()+"\\right)"},t.Product.prototype.printLatex=function(){return"\\prod_{"+this.args[0].printLatex()+"="+this.args[1].printLatex()+"}^{"+this.args[2].printLatex()+"}\\left("+this.args[3].printLatex()+"\\right)"},t.Integral.prototype.printLatex=function(){return"\\int_{"+this.args[1].printLatex()+"}^{"+this.args[2].printLatex()+"}\\left("+this.args[3].printLatex()+"\\right)d"+this.args[0].printLatex()},t.FunctionExponent.prototype.printLatex=function(){return this.args[0].printLatex()+"\\left("+this.args[1].printLatex()+"\\right)^{"+this.args[2].printLatex()+"}"},t.FunctionFactorial.prototype.printLatex=function(){return this.args[0].printLatex()+"\\left("+this.args[1].printLatex()+"\\right)!"},t.Piecewise.prototype.printLatex=function(){var e=this;if(u(e.args[0]))return e.args[1].printLatex();for(var r,n=["\\left\\{"];;){if(u(e.args[0])){n.push(e.args[1].printLatex());break}if(n.push(e.args[0].printLatex(),": "),(r=e.args[2]).isConstant&&r.isNaN()){n.push(e.args[1].printLatex());break}if(n.push(e.args[1].printLatex(),", "),!(e.args[2]instanceof t.Piecewise)){n.push(e.args[2].printLatex());break}e=e.args[2]}return n.push("\\right\\}"),n.join("")},t.FunctionDefinition.prototype.printLatex=function(){return r.identifierToLatex(this._symbol)+"\\left("+this._argSymbols.map(r.identifierToLatex).join(", ")+"\\right) = "+this._expression.printLatex()},t.Derivative.prototype.printLatex=function(){return"\\frac{d}{d"+r.identifierToLatex(this._symbol)+"}\\left("+this.args[0].printLatex()+"\\right)"},t.Regression.prototype.printLatex=function(){return"\\left("+this._lhs.printLatex()+"\\right)\\sim\\left("+this._rhs.printLatex()+"\\right)"},t.Polygon.prototype.printLatex=function(){return"\\polygon\\left("+this.args.map(a).join(", ")+"\\right)"},t.Histogram.prototype.printLatex=function(){return"\\histogram\\left("+this.args.map(a).join(", ")+"\\right)"},t.Object3D.prototype.printLatex=function(){return"\\"+this._symbol+"\\left("+this.args.map(a).join(", ")+"\\right)"},t.DotPlot.prototype.printLatex=function(){return"\\dotplot\\left("+this.args.map(a).join(", ")+"\\right)"},t.BoxPlot.prototype.printLatex=function(){return"\\boxplot\\left("+this.args.map(a).join(", ")+"\\right)"},t.TTest.prototype.printLatex=function(){return"\\TTest\\left("+this.args.map(a).join(", ")+"\\right)"},t.IndependentTTest.prototype.printLatex=function(){return"\\IndependentTTest\\left("+this.args.map(a).join(", ")+"\\right)"},t.Stats.prototype.printLatex=function(){return"\\Stats\\left("+this.args.map(a).join(", ")+"\\right)"}});r("core/math/features/statistics",["require","parsenodes","core/math/maybe-rational"],function(e){"use strict";var t=e("parsenodes"),r=t.BuiltInFunction,n=e("core/math/maybe-rational").maybeRational,i=t.Constant(n(0,1)),o=t.Constant(n(1,1)),a=t.Constant(n(2,1)),s=t.Constant(n(1,2)),u=t.Constant(-1/0);r.normaldist.prototype.pdf=function(e){return r.normalpdf([e[0],this.args[0],this.args[1]])},r.normaldist.prototype.cdf=function(e){var t,n=1===e.length?(t=u,e[0]):(t=e[0],e[1]);return r.normalcdf([t,n,this.args[0],this.args[1]])},r.normaldist.prototype.mean=function(){return this.args[0]},r.normaldist.prototype.median=function(){return this.args[0]},r.normaldist.prototype.stdev=function(){return r.abs([this.args[1]])},r.normaldist.prototype.var=function(){return t.Exponent([this.args[1],a])},r.normaldist.prototype.quantile=function(e){return t.Add([t.Multiply([r.invNorm(e),this.stdev()]),this.mean()])},r.normaldist.prototype.sample=function(e){return r.normalSample([e[0],this.args[0],this.args[1]])},r.tdist.prototype.pdf=function(e){return r.tpdf([e[0],this.args[0]])},r.tdist.prototype.cdf=function(e){var t,n=1===e.length?(t=u,e[0]):(t=e[0],e[1]);return r.tcdf([t,n,this.args[0]])},r.tdist.prototype.mean=function(){return i},r.tdist.prototype.median=function(){return i},r.tdist.prototype.quantile=function(e){return r.invT([e[0],this.args[0]])},r.tdist.prototype.sample=function(e){return r.tSample([e[0],this.args[0]])},r.tdist.prototype.stdev=function(){return r.sqrt([this.var()])},r.tdist.prototype.var=function(){var e=this.args[0];return t.Piecewise([t.Comparator[">="]([e,a]),t.Divide([e,t.Subtract([e,a])]),t.Constant(NaN)])},r.poissondist.prototype.pdf=function(e){return r.poissonpdf([e[0],this.args[0]])},r.poissondist.prototype.cdf=function(e){var t,n=1===e.length?(t=u,e[0]):(t=e[0],e[1]);return r.poissoncdf([t,n,this.args[0]])},r.poissondist.prototype.mean=function(){return this.args[0]},r.poissondist.prototype.median=function(){return r.invPoisson([s,this.args[0]])},r.poissondist.prototype.stdev=function(){return r.sqrt([this.args[0]])},r.poissondist.prototype.var=function(){return this.args[0]},r.poissondist.prototype.quantile=function(e){return r.invPoisson([e[0],this.args[0]])},r.poissondist.prototype.sample=function(e){return r.poissonSample([e[0],this.args[0]])},r.binomialdist.prototype.pdf=function(e){return r.binompdf([e[0],this.args[0],this.args[1]])},r.binomialdist.prototype.cdf=function(e){var t,n=1===e.length?(t=u,e[0]):(t=e[0],e[1]);return r.binomcdf([t,n,this.args[0],this.args[1]])},r.binomialdist.prototype.mean=function(){return t.Multiply([this.args[0],this.args[1]])},r.binomialdist.prototype.median=function(){return r.invBinom([s,this.args[0],this.args[1]])},r.binomialdist.prototype.stdev=function(){return r.sqrt([this.var()])},r.binomialdist.prototype.var=function(){var e=this.args[0],r=this.args[1];return t.Multiply([e,t.Multiply([r,t.Subtract([o,r])])])},r.binomialdist.prototype.quantile=function(e){return r.invBinom([e[0],this.args[0],this.args[1]])},r.binomialdist.prototype.sample=function(e){return r.binomSample([e[0],this.args[0],this.args[1]])},r.uniformdist.prototype.pdf=function(e){return r.uniformpdf([e[0],this.args[0],this.args[1]])},r.uniformdist.prototype.cdf=function(e){var t,n=1===e.length?(t=u,e[0]):(t=e[0],e[1]);return r.uniformcdf([t,n,this.args[0],this.args[1]])},r.uniformdist.prototype.mean=function(){return t.Divide([t.Add([this.args[0],this.args[1]]),a])},r.uniformdist.prototype.median=function(){return t.Divide([t.Add([this.args[0],this.args[1]]),a])},r.uniformdist.prototype.stdev=function(){return r.sqrt([this.var()])},r.uniformdist.prototype.var=function(){return t.Divide([t.Exponent([t.Subtract([this.args[1],this.args[0]]),a]),t.Constant(n(12,1))])},r.uniformdist.prototype.quantile=function(e){return r.invUniform([e[0],this.args[0],this.args[1]])},r.uniformdist.prototype.sample=function(e){return r.uniformSample([e[0],this.args[0],this.args[1]])},t.List.prototype.sample=function(e){return t.ListAccess([this,t.Add([r.floor([t.Multiply([r.uniformSample([e[0],i,o]),t.Constant(n(this.length,1))])]),o])])}});r("core/math/features/getExpressionType",["require","parsenodes","core/types/graphmode","core/math/expression-types","core/math/types"],function(e){"use strict";var t=e("parsenodes"),r=e("core/types/graphmode"),n=e("core/math/expression-types").ExpressionType,i=e("core/math/types");t.Base.prototype.getExpressionType=function(e,t){return e===r.X||e===r.Y?n.X_OR_Y:e===r.XYPOINT||e===r.XYPOINT_MOVABLE?t===i.Point?n.SINGLE_POINT:n.POINT_LIST:e===r.PARAMETRIC||e===r.PARAMETRIC_CURVE_3D?n.PARAMETRIC:e===r.POLAR?n.POLAR:e===r.IMPLICIT?n.IMPLICIT:n.X_OR_Y},t.Polygon.prototype.getExpressionType=function(e,t){return n.POLYGON},t.Histogram.prototype.getExpressionType=function(e,t){return n.HISTOGRAM},t.Object3D.prototype.getExpressionType=function(e,t){return n.CUBE},t.DotPlot.prototype.getExpressionType=function(e,t){return n.DOTPLOT},t.BoxPlot.prototype.getExpressionType=function(e,t){return n.BOXPLOT}});r("core/math/features/findLinearSubset",["require","parsenodes","core/math/maybe-rational"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/maybe-rational").maybeRational,n=t.Constant(r(0,1)),i=t.Constant(r(-1,0));t.Expression.prototype.findLinearSubset=function(e){for(var t=[],r=0;r<e.length;r++)t.push(!this.dependsOn(e[r]));return t},t.FreeVariable.prototype.findLinearSubset=function(e){for(var t=[],r=0;r<e.length;r++)t.push(!0);return t},t.Add.prototype.findLinearSubset=function(e){for(var t=[],r=this.args[0].findLinearSubset(e),n=this.args[1].findLinearSubset(e),i=0;i<e.length;i++)t.push(r[i]&&n[i]);return t},t.Subtract.prototype.findLinearSubset=t.Add.prototype.findLinearSubset,t.Negative.prototype.findLinearSubset=function(e){return this.args[0].findLinearSubset(e)},t.Multiply.prototype.findLinearSubset=function(e){for(var t=this.args[0].findLinearSubset(e).slice(),r=this.args[1].findLinearSubset(e).slice(),n=0,i=0,o=0;o<e.length;o++)t[o]=t[o]&&!this.args[1].dependsOn(e[o]),t[o]&&(n+=1),r[o]=r[o]&&!this.args[0].dependsOn(e[o]),r[o]&&(i+=1);return i<=n?t:r},t.Divide.prototype.findLinearSubset=function(e){for(var t=this.args[0].findLinearSubset(e),r=[],n=0;n<e.length;n++)r.push(t[n]&&!this.args[1].dependsOn(e[n]));return r},t.List.prototype.findLinearSubset=function(e){var t=[];for(i=0;i<e.length;i++)t.push(!0);for(var r=0;r<this.args.length;r++)for(var n=this.args[r].findLinearSubset(e),i=0;i<e.length;i++)t[i]=t[i]&&n[i];return t},t.Broadcast.prototype.findLinearSubset=function(e){for(var r=this._replacedSymbols,o=this._expression,a=this._lists,s={},u=0;u<a.length;u++){for(var c=a[u].findLinearSubset(e),l=n,p=0;p<e.length;p++)c[p]?a[u].dependsOn(e[p])&&(l=t.Add([l,t.FreeVariable(e[p])])):l=t.Add([l,t.Exponent([t.FreeVariable(e[p]),i])]);s[r[u]]=l}return o.substitute(s).findLinearSubset(e)},t.Piecewise.prototype.findLinearSubset=function(e){for(var t=this.args[0],r=this.args[1].findLinearSubset(e),n=this.args[2].findLinearSubset(e),i=[],o=0;o<e.length;o++)i.push(!t.dependsOn(e[o])&&r[o]&&n[o]);return i}});r("core/math/features/deriveRegressionRestrictions",["require","parsenodes","core/math/types","core/math/domaintypes"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/types"),n=e("core/math/domaintypes");function i(e){for(var r,n=this.args[0],i=this.getDependencies(),o={},a=0;a<i.length;a++)if(e.listStatistics.hasOwnProperty(i[a])){if(void 0!==r)return{};r=i[a]}if(void 0===r)return{};if(1!==n.polynomialOrder(r))return{};var s=n.getPolynomialCoefficients(r),u=s[1],c=s[1].getDependencies();if(1!==c.length)return{};var l=c[0];if(1!==u.polynomialOrder(l))return{};var p=e.listStatistics[r],f=(p.max-p.min)/Math.min(p.length-1,31),d=Math.PI/f;return!isFinite(d)||d<=0?{}:(o[l]=t.Piecewise([t.And([t.Comparator["<="]([t.Constant(0),u]),t.Comparator["<"]([u,t.Constant(d)])]),t.Constant(1),t.Constant(NaN)]).boundDomain(l),o)}t.Base.prototype.deriveRegressionRestrictions=function(){return this},t.Broadcast.prototype.deriveRegressionRestrictions=function(){for(var e=this._replacedSymbols,n=this._expression,i=this._lists,o={},a=0;a<e.length;a++)0===i[a].getDependencies().length&&i[a].valueType===r.ListOfNumber&&(o[e[a]]=function(e){for(var t=1/0,r=-1/0,n=e.length,i=0;i<e.length;i++)t=Math.min(t,e[i]),r=Math.max(r,e[i]);return{min:t,max:r,length:n}}(i[a].asValue()));var s,u=n._deriveRegressionRestrictions({listStatistics:o});for(s in u)if("known"!==u[s].type)return this;var c=n;for(s in u)c=function(e,r,n){if("known"!==n.type)return e;var i=t.And([t.Comparator["<="]([t.Constant(n.bounds[0]),t.FreeVariable(r)]),t.Comparator["<="]([t.FreeVariable(r),t.Constant(n.bounds[1])])]);return t.Multiply([e,t.Piecewise([i,t.Constant(1),t.Constant(NaN)])])}(c,s,u[s]);return t.Broadcast(e,[c].concat(i))},t.Base.prototype._deriveRegressionRestrictions=function(e){return{}},t.Expression.prototype._deriveRegressionRestrictions=function(e){for(var t={},r=0;r<this.args.length;r++){var i=this.args[r]._deriveRegressionRestrictions(e);for(var o in i)t[o]=t[o]?n.intersectDomains(t[o],i[o]):i[o]}return t},t.BuiltInFunction.sin.prototype._deriveRegressionRestrictions=i,t.BuiltInFunction.cos.prototype._deriveRegressionRestrictions=i,t.Exponent.prototype._deriveRegressionRestrictions=function(e){for(var r=this.args[0],n=this.args[1],i=r.getDependencies(),o=n.getDependencies(),a={},s=!1,u=0;u<o.length;u++)if(e.listStatistics.hasOwnProperty(o[u])){s=!0;break}if(!s)return{};if(1!==i.length)return{};var c=i[0];return e.listStatistics.hasOwnProperty(c)||1!==r.polynomialOrder(c)?{}:(a[c]=t.Piecewise([t.Comparator[">="]([r,t.Constant(0)]),t.Constant(1),t.Constant(NaN)]).boundDomain(c),a)},t.Piecewise.prototype._deriveRegressionRestrictions=function(e){for(var t={},r=this.getDependencies(),i=0;i<r.length;i++)t[r[i]]=n.unknownDomain();return t}});r("core/math/features/reparameterizeRegression",["require","parsenodes","core/math/types"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/types");function n(e,t){for(var r,n=e.getDependencies(),i=0;i<n.length;i++)if(t.hasOwnProperty(n[i])){if(void 0!==r)return;r=n[i]}return r}function i(e,t){if(1===e.polynomialOrder(t)){var r=e.getPolynomialCoefficients(t),n=r[1],i=r[0],o=n.getDependencies();if(1===o.length){var a=o[0];if(1===n.polynomialOrder(a)){var s=i.getDependencies().filter(function(e){return e!==a});if(1===s.length){var u=s[0];if(1===i.polynomialOrder(u))return[i,n]}}}}}function o(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(void 0!==r)for(var n=r.getDependencies(),i=0;i<n.length;i++){var o=n[i];-1===e.indexOf(o)&&e.push(o)}}return e}function a(e,t,r){for(var n=0;n<e.length;n++)if(n!==r)for(var i=e[n],o=0;o<t.length;o++)for(var a=t[o].model.replacedDependencies,s=0;s<a.length;s++)if(i.dependsOn(a[s]))return 1}function s(e){var t,r;for(o=0;o<this.args.length;o++){var n=this.args[o]._reparameterizeRegression(e);if(n){if(void 0!==r)return;t=n,r=o}}if(void 0!==r&&!a(this.args,t,r)){for(var i=[],o=0;o<t.length;o++){var s=t[o];i.push({model:s.model,expression:this.copyWithArgs([].concat(this.args.slice(0,r),s.expression,this.args.slice(r+1)))})}return i}}function u(e,r){var a=e.model;if("exp"!==a.type)return e;if(a.shiftScale)return e;var s=e.expression,u="Negative"===s.type;if(u&&(s=s.args[0]),"BuiltInFunction['exp']"!==s.type)return e;var c=s.args[0],l=n(c,r.listStatistics);if(void 0===l)return e;var p=i(c,l);if(!p)return e;var f=p[0],d=p[1],h=[c.tmpVar(),c.tmpVar()],m=r.listStatistics[l].max-r.listStatistics[l].min,y=.5*(r.listStatistics[l].max+r.listStatistics[l].min),g=t.BuiltInFunction.exp([t.Add([t.Multiply([t.FreeVariable(h[0]),t.Divide([t.Subtract([t.DummyIndex(l),t.Constant(y)]),t.Constant(m)])]),t.FreeVariable(h[1])])]);return u&&(g=t.Negative([g])),{model:{type:"exp",shiftScale:{mulNode:d,addNode:f,newParameterSymbols:h,stats:{range:m,midrange:y}},base:a.base,intercept:a.intercept,replacedDependencies:o(d,f,a.base&&a.base.node,a.intercept&&a.intercept.node)},expression:g}}function c(e,r,a){var s=e._symbol,u=e.args[0],c=n(u,a.listStatistics);if(void 0!==c){var l=i(u,c);if(l){var p=l[0],f=l[1],d=r.getDependencies();if(1===d.length){var h=d[0];if(!u.dependsOn(h)&&1===r.polynomialOrder(h)){var m,y,g,v,b,x,_,S=[e.tmpVar(),e.tmpVar(),e.tmpVar()];return[{model:{type:"trig",amplitudeNode:r,frequencyNode:f,phaseNode:p,newParameterSymbols:S,replacedDependencies:o(r,f,p)},expression:(y=c,g=S,v="cos"===(m=s)?g[0]:g[1],b="cos"===m?g[1]:g[0],x=g[2],_=t.Multiply([t.FreeVariable(x),t.DummyIndex(y)]),("sin"===m?t.Add:t.Subtract)([t.Multiply([t.FreeVariable(v),t.BuiltInFunction.cos([_])]),t.Multiply([t.FreeVariable(b),t.BuiltInFunction.sin([_])])]))}]}}}}}t.Base.prototype.reparameterizeRegression=function(){},t.Broadcast.prototype.reparameterizeRegression=function(){for(var e=this._replacedSymbols,t=this._lists,n={},i=0;i<e.length;i++)0===t[i].getDependencies().length&&t[i].valueType===r.ListOfNumber&&(n[e[i]]=function(e){for(var t=1/0,r=-1/0,n=e.length,i=0;i<e.length;i++)t=Math.min(t,e[i]),r=Math.max(r,e[i]);return{min:t,max:r,length:n}}(t[i].asValue()));return this._reparameterizeRegression({listStatistics:n})},t.Base.prototype._reparameterizeRegression=function(e){},t.Expression.prototype._reparameterizeRegression=s,t.Exponent.prototype._reparameterizeRegression=function(e){var r=this.args[0],n=this.args[1],i=n.getDependencies(),o=r.getDependencies();if(function(e,t){for(var r=e.getDependencies(),n=0;n<r.length;n++)if(t[r[n]])return 1}(n,e.listStatistics)){if(0===o.length){if(r.asValue()<0)return;return[{model:{type:"exp",replacedDependencies:[]},expression:t.BuiltInFunction.exp([t.Multiply([t.BuiltInFunction.ln([r]),n])])}]}if(1===o.length&&!e.listStatistics.hasOwnProperty(o[0])&&-1===i.indexOf(o[0])&&1===r.polynomialOrder(o[0])){var a=this.tmpVar();return[u({model:{type:"exp",base:{node:r,newParameterSymbols:[a]},replacedDependencies:r.getDependencies()},expression:t.BuiltInFunction.exp([t.Multiply([t.FreeVariable(a),n])])},e)]}}},t.BuiltInFunction.exp.prototype._reparameterizeRegression=function(e){if(void 0!==n(this.args[0],e.listStatistics))return[u({model:{type:"exp",replacedDependencies:[]},expression:this},e)]},t.Multiply.prototype._reparameterizeRegression=function(e){var r,n,i;if("BuiltInFunction['sin']"===this.args[0].type||"BuiltInFunction['cos']"===this.args[0].type)return c(this.args[0],this.args[1],e);if("BuiltInFunction['sin']"===this.args[1].type||"BuiltInFunction['cos']"===this.args[1].type)return c(this.args[1],this.args[0],e);for(i=0;i<this.args.length;i++){var l=this.args[i]._reparameterizeRegression(e);if(l){if(void 0!==n)return;r=l,n=i}}if(void 0!==n&&!a(this.args,r,n)){var p=1===n?0:1,f=this.args[p];if(1!==r.length)return s.call(this,e);var d=r[0],h=d.model;if("exp"!==h.type||"BuiltInFunction['exp']"!==d.expression.type||d.model.shiftScale)return s.call(this,e);var m=f.getDependencies();if(1!==m.length||1!==f.polynomialOrder(m[0])||e.listStatistics.hasOwnProperty(m[0]))return s.call(this,e);var y=this.tmpVar();return[{model:{type:"exp",replacedDependencies:[]},expression:this},u({model:{type:"exp",base:h.base,intercept:{node:f,newParameterSymbols:[y],sign:1},replacedDependencies:o(h.base&&h.base.node,f)},expression:t.BuiltInFunction.exp([t.Add([d.expression.args[0],t.FreeVariable(y)])])},e),u({model:{type:"exp",base:h.base,intercept:{node:f,newParameterSymbols:[y],sign:-1},replacedDependencies:o(h.base&&h.base.node,f)},expression:t.Negative([t.BuiltInFunction.exp([t.Add([d.expression.args[0],t.FreeVariable(y)])])])},e)]}}});r("parser",["require","core/math/baseparser","core/math/features/getConcreteTree","core/math/features/getValueType","core/math/features/typeCheck","core/math/features/repr","core/math/features/scalarEvalExpression","core/math/features/constantcollapsedcopy","core/math/features/polynomialorder","core/math/features/polynomialcoefficients","core/math/features/extractconditions","core/math/features/piecewiseDependsOn","core/math/features/bounddomain","core/math/features/derivative","core/math/features/substitute","core/math/features/isImplicit","core/math/features/solve","core/math/features/analyze","core/math/features/analyzeFourFunction","core/math/features/analyzeScientific","core/math/features/analyzeSingleExpressionScientific","core/math/features/getgraphmode","core/math/features/getgraphinfo","core/math/features/getMoveStrategy","core/math/features/getDefaultDragMode","core/math/features/tableinfo","core/math/features/tableerror","core/math/features/graph","core/math/features/elementAt","core/math/features/printLatex","core/math/features/statistics","core/math/features/getExpressionType","core/math/features/findLinearSubset","core/math/features/deriveRegressionRestrictions","core/math/features/reparameterizeRegression"],function(e){"use strict";var t=e("core/math/baseparser");return e("core/math/features/getConcreteTree"),e("core/math/features/getValueType"),e("core/math/features/typeCheck"),e("core/math/features/repr"),e("core/math/features/scalarEvalExpression"),e("core/math/features/constantcollapsedcopy"),e("core/math/features/polynomialorder"),e("core/math/features/polynomialcoefficients"),e("core/math/features/extractconditions"),e("core/math/features/piecewiseDependsOn"),e("core/math/features/bounddomain"),e("core/math/features/derivative"),e("core/math/features/substitute"),e("core/math/features/isImplicit"),e("core/math/features/solve"),e("core/math/features/analyze"),e("core/math/features/analyzeFourFunction"),e("core/math/features/analyzeScientific"),e("core/math/features/analyzeSingleExpressionScientific"),e("core/math/features/getgraphmode"),e("core/math/features/getgraphinfo"),e("core/math/features/getMoveStrategy"),e("core/math/features/getDefaultDragMode"),e("core/math/features/tableinfo"),e("core/math/features/tableerror"),e("core/math/features/graph"),e("core/math/features/elementAt"),e("core/math/features/printLatex"),e("core/math/features/statistics"),e("core/math/features/getExpressionType"),e("core/math/features/findLinearSubset"),e("core/math/features/deriveRegressionRestrictions"),e("core/math/features/reparameterizeRegression"),t});r("core/math/finddependencyorder",["require","core/math/builtinframe","underscore"],function(e){"use strict";var t=e("core/math/builtinframe"),r=e("underscore");return function(e,n,i){var o,a,s,u=[],c={},l={},p={},f={},d=0,h=[],m=[];if(!i)for(o in i=[],n)n.hasOwnProperty(o)&&i.push(o);for(o in n)if(n.hasOwnProperty(o)){for(s=n[o].exportPenalty||0;u.length<s+1;)u.push([]);u[s].push(o)}for(s=0;s<u.length;s++){for(var y={},g=0;g<u[s].length;g++){o=u[s][g];for(var v=n[o].getLegalExports(e),b=0;b<v.length;b++)a=v[b],t[a]||c[a]||(y[a]=y[a]||[],y[a].push(o),1<y[a].length&&(l[a]=!0))}for(a in y)c[a]=y[a]}for(g=0;g<i.length;g++)f.hasOwnProperty(i[g])||!function e(t){f[t]=f[t]||{};var r=f[t];var i;r.id=t;r.index=d;r.lowlink=d;h.push(r);r.instack=!0;d++;var o=n[t].getDependencies();for(var a=0;a<o.length;a++){var s=o[a];if(c.hasOwnProperty(s))for(var u=c[s],l=0;l<u.length;l++){var p=u[l];f.hasOwnProperty(p)?(i=f[p]).instack&&(r.lowlink=Math.min(r.lowlink,i.index)):(e(p),i=f[p],r.lowlink=Math.min(r.lowlink,i.lowlink))}}if(r.lowlink===r.index)if((i=h.pop()).instack=!1,i===r)g=r,m.push(g.id);else{for(var y=[i];(i=h.pop()).instack=!1,y.push(i),i!==r;);x(y)}var g}(i[g]);function x(t){for(var i,o=[],a=t.length-1;0<=a;a--){i=t[a];var s=n[i.id].getLegalExports(e);Array.prototype.push.apply(o,s),o.push(s[0]),m.push(i.id)}for((o=r.unique(o)).sort(),a=0;a<o.length;a++)p[o[a]]=o}return{resolved:m,multiplyDefined:l,cyclicallyDefined:p}}});r("core/math/findIntersections",["require","core/types/graphmode","./plotter","parsenodes","core/math/distance"],function(e){"use strict";var t=e("core/types/graphmode"),r=e("./plotter").default,n=e("parsenodes"),i=e("core/math/distance");function o(e){for(var t=[],r=0;r<e;r++)t[r]={x:[],y:[],intersects:[]};return t}function a(e,t){t instanceof n.SolvedEquation?t=t._expression:t instanceof n.OptimizedRegression&&(t=t.model);var r=[],i=[];return t instanceof n.DoubleInequality?n.List.eachArgs(e,t._expressions,function(e){r.push(e[0].getCompiledFunction()),i.push(e[0].isConstant&&e[1].isNaN()),r.push(e[1].getCompiledFunction()),i.push(e[1].isConstant&&e[1].isNaN())}):n.List.wrap(t).eachElement(e,function(e){r.push(e.getCompiledFunction()),i.push(e.isConstant&&e.isNaN())}),{functions:r,skipIntersecting:i}}function s(e,t,n){for(var o=r.sampleXY(e,t),a=o.poi.zeros,s=o.poi.extrema,u=[],c=0,l=0,c=0;c<a.x.length;c++){for(;l<s.x.length&&s.x[l]<a.x[c];l++)i.approx(s.y[l],0)&&u.push(s.x[l]);u.push(a.x[c])}for(;l<s.x.length;l++)i.approx(s.y[l],0)&&u.push(s.x[l]);return{x:u,y:u.map(n)}}return{findIntersections:function(e,n,i){var u=e[i],c=u.getGraphInfo(),l=u.getGraphMode(),p=a(u.policy,u.concreteTree),f=o(p.functions.length),d=function(e,t){var r,n,i=[];for(var o in e){e.hasOwnProperty(o)&&String(o)!==String(t)&&e[o].shouldIntersect()&&(n=a((r=e[o]).policy,r.concreteTree),i.push({id:o,graphMode:r.getGraphMode(),functions:n.functions,skipIntersecting:n.skipIntersecting}))}return i}(e,i);if(!d)return f;for(var h,m,y,g,v=0,b=0;b<d.length;b++)for(var x=d[b],_=0;_<p.functions.length;_++)if(!p.skipIntersecting[_])for(var S=p.functions[_].fn,T=r.computeDomain(n,c,S),w=0;w<x.functions.length;w++)if(!d[b].skipIntersecting[w]){var E=function(e,r,n,i){return n===t.X&&i===t.X||n===t.Y&&i===t.Y?function(t){return r(t)-e(t)}:(n===t.X&&i===t.Y||n===t.Y&&i===t.X)&&function(t){return t-r(e(t))}}(S,x.functions[w].fn,l,x.graphMode);if(E){var M=s(E,T,S);if(100<(v+=M.x.length))return o(p.functions.length);!function(e,t){e.intersects=Array(e.x.length);for(var r=0;r<e.x.length;r++)e.intersects[r]=t}(M,x.id),y=M,g=void 0,l===t.X&&(g=y.y,y.y=y.x,y.x=g),h=f[_],m=M,Array.prototype.push.apply(h.x,m.x),Array.prototype.push.apply(h.y,m.y),Array.prototype.push.apply(h.intersects,m.intersects)}}return f},findIndicatorZeros:s}});r("core/math/policyFourFunction",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolicySingleExpressionFourFunction=t.PolicyFourFunction=void 0;var r=(n.prototype.assignmentForbidden=function(e){return"ans"!==e.slice(0,3)},n.prototype.isValidSlider=function(e){return!1},n.prototype.sliderVariables=function(){return[]},n.prototype.graphingEnabled=function(){return!1},n.prototype.ansEnabled=function(){return!this.singleExpression},n.prototype.disabledFeatures=function(){return["Sum","Product","Integral","List","Derivative","Piecewise","Exponent","PercentOf"]},n);function n(e){this.singleExpression=e.singleExpression}t.PolicyFourFunction=new r({singleExpression:!1}),t.PolicySingleExpressionFourFunction=new r({singleExpression:!0})});r("core/math/policyScientific",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolicySingleExpressionScientific=t.PolicyScientific=void 0;var r=(n.prototype.assignmentForbidden=function(e){return this.singleExpression?"ans"!==e.slice(0,3):"tmp"===e.slice(0,3)},n.prototype.isValidSlider=function(e){return!1},n.prototype.sliderVariables=function(){return[]},n.prototype.graphingEnabled=function(){return!1},n.prototype.ansEnabled=function(){return!this.singleExpression},n.prototype.disabledFeatures=function(){return this.singleExpression?["Sum","Product","Integral","Derivative","Piecewise","PercentOf"]:["Sum","Product","Integral","Derivative","Piecewise"]},n);function n(e){this.singleExpression=e.singleExpression}t.PolicyScientific=new r({singleExpression:!1}),t.PolicySingleExpressionScientific=new r({singleExpression:!0})});r("core/math/policyGraphing",["require","exports","./builtinframe","core/types/graphmode"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolicyGraphing3D=t.PolicyGraphing=void 0;var i=(o.prototype.dimensions=function(){return 2},o.prototype.assignmentForbidden=function(e){return"x"===e||"y"===e||"theta"===e||"tmp"===e.slice(0,3)||r.hasOwnProperty(e)},o.prototype.isValidSlider=function(e){return"x"===e||"y"===e||"ans"!==e.slice(0,3)&&!this.assignmentForbidden(e)},o.prototype.sliderVariables=function(e){var t=this;return-1!==e.indexOf("theta")&&(e=e.filter(function(e){return"r"!==e})),e.filter(function(e){return!t.assignmentForbidden(e)&&"ans"!==e.slice(0,3)})},o.prototype.graphingEnabled=function(){return!0},o.prototype.ansEnabled=function(){return!1},o.prototype.validRegressionParameter=function(e){return"x"!==e&&"y"!==e},o.prototype.validLHS=function(e){return"theta"!==e},o.prototype.unplottablePolarFunction=function(e,t){return"theta"===e&&-1!==t.indexOf("r")},o.prototype.validDoubleInequalitySymbol=function(e){return"x"===e||"y"===e},o.prototype.validDoubleInequalityVariables=function(e){return!(2<e.length)&&e.every(this.validDoubleInequalitySymbol)},o.prototype.validExpressionVariables=function(e){return 1===e.length&&"x"===e[0]},o.prototype.validSolvedVariable=function(e){return"x"===e||"y"===e||"r"===e},o.prototype.validImplicitVariables=function(e){switch(e.length){case 0:return!0;case 1:return"x"===e[0]||"y"===e[0]||"r"===e[0];case 2:return"x"===e[0]&&"y"===e[1]||"y"===e[0]&&"x"===e[1]||"r"===e[0]&&"theta"===e[1]||"theta"===e[0]&&"r"===e[1];default:return!1}},o.prototype.graphableListVariables=function(e,t){return"x"===e||"y"===e||"r"===e||"x"===t||"y"===t},o.prototype.validParametricVariable=function(e){return"t"===e},o.prototype.validParametricVariables=function(e){return 1===e.length&&this.validParametricVariable(e[0])},o.prototype.validInequalityVariables=function(e){switch(e.length){case 1:return"x"===e[0]||"y"===e[0]||"r"===e[0];case 2:return this.validImplicitVariables(e);default:return!1}},o.prototype.validFirstColumnVariable=function(e){return"y"!==e&&"r"!==e&&"theta"!==e&&!e.match(/y_(\d+)/)},o.prototype.complicatedPolarImplicit=function(e,t){return"theta"===e||"r"===e&&1!==t},o.prototype.constantGraphMode=function(e){return"x"===e?n.X:"r"===e?n.POLAR:n.Y},o.prototype.graphMode=function(e,t){var r=t[0];return"y"===r||"x"===e?n.X:"r"===e&&"theta"===r?n.POLAR:n.Y},o.prototype.tableableAsConstant=function(e){return"x"!==e&&"r"!==e&&"theta"!==e},o.prototype.implicitIndependent=function(e){return"x"},o.prototype.implicitDependency=function(e){return 1!==e.length?"y":"y"===e[0]?"x":"theta"===e[0]?"r":"y"},o.prototype.graphableAsConstant=function(e){return"y"===e||"x"===e||"r"===e},o.prototype.disabledFeatures=function(){return[]},o);function o(){}var a=(s.prototype.dimensions=function(){return 3},s.prototype.assignmentForbidden=function(e){return"x"===e||"y"===e||"z"===e||"tmp"===e.slice(0,3)||r.hasOwnProperty(e)},s.prototype.isValidSlider=function(e){return"x"===e||"y"===e||"z"===e||"ans"!==e.slice(0,3)&&!this.assignmentForbidden(e)},s.prototype.sliderVariables=function(e){var t=this;return e.filter(function(e){return!t.assignmentForbidden(e)&&"ans"!==e.slice(0,3)})},s.prototype.graphingEnabled=function(){return!0},s.prototype.ansEnabled=function(){return!1},s.prototype.validRegressionParameter=function(e){return!1},s.prototype.validLHS=function(e){return!0},s.prototype.unplottablePolarFunction=function(e,t){return!1},s.prototype.validDoubleInequalitySymbol=function(e){return!1},s.prototype.validDoubleInequalityVariables=function(e){return!1},s.prototype.validExpressionVariables=function(e){var t=e.join("");return"x"===t||"y"===t||"xy"===t||"yx"===t},s.prototype.validSolvedVariable=function(e){return"x"===e||"y"===e||"z"===e},s.prototype.validImplicitVariables=function(e){return!1},s.prototype.graphableListVariables=function(e,t){return"x"===e||"y"===e||"x"===t||"y"===t},s.prototype.validParametricVariable=function(e){return"t"===e},s.prototype.validParametricVariables=function(e){return 1===e.length&&this.validParametricVariable(e[0])},s.prototype.validInequalityVariables=function(e){return!1},s.prototype.validFirstColumnVariable=function(e){return!1},s.prototype.complicatedPolarImplicit=function(e,t){return!1},s.prototype.constantGraphMode=function(e){return n.Z_3D},s.prototype.graphMode=function(e,t){return"z"===e&&this.validExpressionVariables(t)?n.Z_3D:n.NONE},s.prototype.tableableAsConstant=function(e){return"x"!==e&&"r"!==e},s.prototype.implicitIndependent=function(e){return"x"},s.prototype.implicitDependency=function(e){if(2!==e.length)return"z";var t=e[0]<e[1]?e[0]+e[1]:e[1]+e[0];return"xy"===t?"z":"xz"===t?"y":"yz"===t?"x":"z"},s.prototype.graphableAsConstant=function(e){return"z"===e},s.prototype.disabledFeatures=function(){return[]},s);function s(){}t.PolicyGraphing=new i,t.PolicyGraphing3D=new a});r("core/math/frameFourFunction",["require","core/math/parsenode/builtinfunction"],function(e){"use strict";var t=e("core/math/parsenode/builtinfunction");return{getFrame:function(e){var r={};return e.additionalFunctions&&-1!==e.additionalFunctions.indexOf("sqrt")&&(r.sqrt=t.sqrt),r}}});r("core/math/frameScientific",["require","core/math/builtinconstants","core/math/parsenode/builtinfunction"],function(e){"use strict";var t=e("core/math/builtinconstants"),r=e("core/math/parsenode/builtinfunction"),n=["pi","e","trigAngleMultiplier"],i=["sqrt","nthroot","abs","ln","sin","cos","tan","log","arcsin","arccos","arctan","mean","round","stdev","stdevp","nCr","nPr","exp","factorial"];function o(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(!t.hasOwnProperty(n))throw new Error("Programming Error: key '"+n+"' does not exist in table. Must be one of:\n"+Object.keys(t).join("\n"))}}return o(n,t),o(i,r),{getFrame:function(e){var o={};return n.forEach(function(e){o[e]=t[e]}),i.forEach(function(t){e.replaceRoundWithReciprocal&&"round"===t||(o[t]=r[t])}),e.trigAngleMultiplier&&(o.trigAngleMultiplier=e.trigAngleMultiplier),o}}});r("core/math/frameSingleExpressionScientific",["require","core/math/builtinconstants","core/math/parsenode/builtinfunction"],function(e){"use strict";var t=e("core/math/builtinconstants"),r=e("core/math/parsenode/builtinfunction"),n=["pi","e","trigAngleMultiplier"],i=["sqrt","nthroot","abs","ln","sin","cos","tan","log","arcsin","arccos","arctan","exp","factorial"];function o(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(!t.hasOwnProperty(n))throw new Error("Programming Error: key '"+n+"' does not exist in table. Must be one of:\n"+Object.keys(t).join("\n"))}}return o(n,t),o(i,r),{getFrame:function(e){var o={};return n.forEach(function(e){o[e]=t[e]}),i.forEach(function(e){o[e]=r[e]}),e.trigAngleMultiplier&&(o.trigAngleMultiplier=e.trigAngleMultiplier),o}}});r("core/math/frameGraphing",["require","core/math/builtinconstants","core/math/parsenode/builtinfunction"],function(e){"use strict";var t=e("core/math/builtinconstants"),r=e("core/math/parsenode/builtinfunction"),n=["csc","sec","cot","arccsc","arcsec","arccot","csch","sech","coth","arccsch","arcsech","arccoth","mad","cov","distance","midpoint"],i=["erf","ttest","tscore","ittest","normaldist","tdist","poissondist","binomialdist","pdf","cdf","random","histogram","dotplot","boxplot"],o=["distance","midpoint"],a=["det","inv","transpose","rref","trace"];function s(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(!t.hasOwnProperty(n))throw new Error("Programming Error: key '"+n+"' does not exist in table. Must be one of:\n"+Object.keys(t).join("\n"))}}return s(n,r),s(i,r),{getFrame:function(e){var s,u={};for(s in t)t.hasOwnProperty(s)&&(u[s]=t[s]);for(s in r)r.hasOwnProperty(s)&&(!0!==e.restrictedFunctions||-1===n.indexOf(s)||!0===e.forceEnableGeometryFunctions&&-1!==o.indexOf(s))&&(!1===e.distributions&&-1!==i.indexOf(s)||-1===a.indexOf(s)&&(u[s]=r[s]));return e.trigAngleMultiplier&&(u.trigAngleMultiplier=e.trigAngleMultiplier),e.globalRandomSeed&&(u.globalRandomSeed=e.globalRandomSeed),e.initialEvaluation&&(u.initialEvaluation=e.initialEvaluation),u}}});r("core/math/interpolatedlabel",["require","exports","parsenodes","core/math/types","core/lib/label","./policy"],function(e,t,r,n,i,o){"use strict";function a(e){if(e.length<2)return"text";var t=e.split("`").length-1;return t<2?"text":2==t&&"`"===e[0]&&"`"===e[e.length-1]?"latex":"mixed"}function s(e){if(0===e.length)return[""];for(var t=[],r=e.split(/(`)/),n=!1,i="",o=0;o<r.length;o++){var a=r[o];a.length&&("`"===a?(i+="`",(n=!n)||(t.push(i),i="")):(i+=a,n||(t.push(i),i="")))}return i.length&&t.push(i),t}function u(e){for(var t,r,n="\\$({"+["[a-zA-Z][0-9]*","[a-zA-Z]_[a-zA-Z0-9]+","[a-zA-Z]_\\{[a-zA-Z0-9]+\\}"].join("})|\\$({")+"})",i=new RegExp(n,"g"),o=[],a=0;r=i.exec(e);){a<(t=r.index)&&o.push(e.substr(a,t-a));var s=r[0],u=s.replace(/[{}\$]/g,"").replace(/^([a-zA-Z])([0-9]+)$/,"$1_$2");o.push({symbol:u,str:s}),a=r.index+s.length}return a<e.length&&o.push(e.substr(a)),{raw:e,parts:o}}function c(e,t){return t?"{"+i.truncatedLatexLabel(e,{bigCutoff:1e7,digits:8})+"}":i.truncatedPlainmathLabel(e,{bigCutoff:1e7,digits:8})}Object.defineProperty(t,"__esModule",{value:!0}),t.interpolate=t.parse=t.chunkLabel=t.classifyLabelText=void 0,t.classifyLabelText=a,t.chunkLabel=s,t.parse=function(e){return s(e).map(u)},t.interpolate=function(e,t,i){return e.map(function(e){return function(e,t,i){for(var s=[],u="latex"===a(e.raw),l=0,p=e.parts;l<p.length;l++){var f=p[l];if("string"==typeof f)s.push(f);else{var d,h=r.Identifier(f.symbol).tryGetConcreteTree(o.defaultPolicy,t);if(h.valueType===n.Number){if("number"==typeof(d=h.asValue())){s.push(c(d,u));continue}}else if(h.valueType===n.ListOfNumber&&h.args[i]){if("number"==typeof(d=h.args[i].asValue())){s.push(c(d,u));continue}}u?s.push("{?}"):s.push("?")}}return s.join("")}(e,t,i)}).join("")}});r("core/math/getCLSymbolMap",["require","exports","underscore","core/lib/label"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCLSymbolMap=void 0,t.getCLSymbolMap=function(){var e={},t={},i={},o=[];for(var a in this.statements){if(this.statements.hasOwnProperty(a))switch((d=this.statements[a]).type){case"Error":break;case"Regression":i[a]=[],o.push(a);break;default:var s=d.getLegalExports(this.policy);if(s){for(var u=0,c=s;u<c.length;u++){var l=c[u];0<d.exportPenalty?t[l]=a:e[l]=a}i[a]=r.difference(d.getDependencies(),d.getDummyDependencies(),s)}}}for(var p=0,f=o;p<f.length;p++){var a=f[p],d=this.statements[a],h=n.latexToIdentifier(d.userData.residualVariable);h&&(t[h]=a);for(var m,y=d.getDependencies().slice(),g={},l=void 0;l=y.pop();){g[l]||(g[l]=!0,(m=e[l]||t[l])?(y.push.apply(y,i[m]),i[a].push(l)):t[l]=a)}}return{exportMap:e,weakExportMap:t,dependencyMap:i}}});r("core/types/line-width",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.THICK=t.DEFAULT=t.THIN=void 0,t.THIN=1,t.DEFAULT=2.5,t.THICK=5});r("core/types/point-opacity",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT=void 0,t.DEFAULT=.9});r("core/math/context",["require","exports","parser","parsenodes","./finddependencyorder","./errormsg","./workerconfig","./findIntersections","./types","core/vendor/d3-color","./policyFourFunction","./policyScientific","./policyGraphing","./frameFourFunction","./frameScientific","./frameSingleExpressionScientific","./frameGraphing","tslib","underscore","./plotter","core/types/graphmode","./interpolatedlabel","./expression-types","./getCLSymbolMap","./distribution-spec","./maybe-rational","core/lib/number-to-latex","core/lib/label","./functions","core/types/line-width","./evaluationstate","core/types/point-opacity"],function(e,t,r,n,i,o,a,s,u,c,l,p,f,d,h,m,y,g,v,b,x,_,S,T,w,E,M,C,I,P,k,O){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var D=n.Constant,N=n.Seed,A=n.FunctionCall,L=n.Image,F=n.Simulation,R=n.Slider,q=n.Table,V=n.TableColumn,z=n.FreeVariable,j=s.findIntersections,B={fourFunction:l.PolicyFourFunction,scientific:p.PolicyScientific,singleExpressionScientific:p.PolicySingleExpressionScientific,singleExpressionFourFunction:l.PolicySingleExpressionFourFunction,graphing:f.PolicyGraphing,graphing_3d:f.PolicyGraphing3D},U={fourFunction:d,singleExpressionFourFunction:d,scientific:h,singleExpressionScientific:m,graphing:y,graphing_3d:y};function G(e,t){for(var r="id"+e,n=0,i=t||[];n<i.length;n++){var o=i[n];r+="::"+o[0]+o[1]}return r}var W=D(E.maybeRational(0,1)),J=D(E.maybeRational(1,1)),H=D(NaN);function $(e,t){return e?"0"===e?W:"1"===e?J:r.parse(e,t):H}function Y(e,t){if(e)return r.parse(e,t)}function K(e){return"ans"!==e.slice(0,3)}function X(e,t){var r=e.multiplyDefined,n=e.cyclicallyDefined;for(var i in r)r.hasOwnProperty(i)&&(t[i]=o.multiplyDefined(i));for(var i in n)n.hasOwnProperty(i)&&(t[i]=o.cycle(n[i].filter(K)))}function Q(e,t,r){for(var n=0,i=r;n<i.length;n++){var o=i[n];e[o]||(e[o]=[]),e[o].push(t)}}function Z(e,t,r){if(r.polarDomainMin&&Q(e,t,r.polarDomainMin.getDependencies()),r.polarDomainMax&&Q(e,t,r.polarDomainMax.getDependencies()),r.parametricDomainMin&&Q(e,t,r.parametricDomainMin.getDependencies()),r.parametricDomainMax&&Q(e,t,r.parametricDomainMax.getDependencies()),r.vizBinWidth&&Q(e,t,r.vizBinWidth.getDependencies()),r.vizBinCenter&&Q(e,t,r.vizBinCenter.getDependencies()),r.vizAxisOffset&&Q(e,t,r.vizAxisOffset.getDependencies()),r.vizBreadth&&Q(e,t,r.vizBreadth.getDependencies()),r.cdfMin&&Q(e,t,r.cdfMin.getDependencies()),r.cdfMax&&Q(e,t,r.cdfMax.getDependencies()),r.lineWidth&&Q(e,t,r.lineWidth.getDependencies()),r.fillOpacity&&Q(e,t,r.fillOpacity.getDependencies()),r.lineOpacity&&Q(e,t,r.lineOpacity.getDependencies()),r.pointOpacity&&Q(e,t,r.pointOpacity.getDependencies()),r.colorLatex&&Q(e,t,r.colorLatex.getDependencies()),r.clickableRules)for(var n=0,i=r.clickableRules;n<i.length;n++){var o=i[n];o.assignment&&Q(e,t,o.assignment.getDependencies()),o.expression&&Q(e,t,o.expression.getDependencies())}}function ee(e,t,r,n){var i={},o=!0,a=NaN;if(r)for(var s=r.tryGetConcreteTree(e,t),a=+s.asValue(),u=0,c=s.getDependencies();u<c.length;u++){i[c[u]]=!0}return isFinite(a)||(o=!1,a=NaN),r||(o=!0,void 0!==n&&(a=n)),{value:a,valid:o,missingVarsMap:i}}function te(e){return c.rgb(e[0],e[1],e[2]).formatHex()}function re(e,t,r,n,i){var o;if(e){for(var a,s=e.tryGetConcreteTree(n,i),c=s.asValue(),l={},p=0,f=s.getDependencies();p<f.length;p++){l[f[p]]=!0}k.addSliderPrompts(r,n,l),(o=!(!c||s.valueType!==u.RGBColor))&&(a=s&&s.valueType===u.RGBColor?te(c):c.map(te),t.colorLatexValue=a,r.color_latex_value=a)}else o=!0;r.color_latex_valid=o}var ne=(ie.prototype.invalidate=function(){for(var e in this.statements)this.statements.hasOwnProperty(e)&&this.markAsDirtyRoot(e);this.currentStatus={},this.analysis={},this.parent_frame=U[this.evaluationMode].getFrame({restrictedFunctions:this.restrictedFunctions,forceEnableGeometryFunctions:this.forceEnableGeometryFunctions,replaceRoundWithReciprocal:this.replaceRoundWithReciprocal,distributions:this.distributions,additionalFunctions:this.additionalFunctions,trigAngleMultiplier:D(this.use_degrees?Math.PI/180:E.maybeRational(1,1)),initialEvaluation:D(this.initialEvaluation?1:0),globalRandomSeed:N(this.globalRandomSeedString||"")}),this.frame=Object.create(this.parent_frame),this.lastFrame=Object.create(this.parent_frame),this.regressionFrame=Object.create(this.parent_frame)},ie.prototype.processChangeSet=function(e){var t={intersections:{},graphs:{}};e.isCompleteState&&(this.invalidate(),this.statements={},this.currentLabel={});var r=!!e.isCompleteState&&!e.isUndoRedoState;r!==this.initialEvaluation&&(this.initialEvaluation=r,this.invalidate()),e.viewState&&this.setViewState(e.viewState),e.hasOwnProperty("degreeMode")&&this.setDegreeMode(e.degreeMode),e.hasOwnProperty("globalRandomSeed")&&this.setGlobalRandomSeed(e.globalRandomSeed),e.hasOwnProperty("evaluationMode")&&this.setEvaluationMode(e.evaluationMode),e.hasOwnProperty("additionalFunctions")&&this.setAdditionalFunctions(e.additionalFunctions),e.hasOwnProperty("restrictedFunctions")&&this.setRestrictedFunctions(e.restrictedFunctions),e.hasOwnProperty("forceEnableGeometryFunctions")&&this.setForceEnableGeometryFunctions(e.forceEnableGeometryFunctions),e.hasOwnProperty("distributions")&&this.setDistributions(e.distributions),e.hasOwnProperty("functionDefinition")&&this.setFunctionDefinition(e.functionDefinition),e.hasOwnProperty("replaceRoundWithReciprocal")&&this.setReplaceRoundWithReciprocal(e.replaceRoundWithReciprocal),e.hasOwnProperty("pointsOfInterest")&&this.setWorkerConfigProperty("pointsOfInterest",e.pointsOfInterest),e.hasOwnProperty("plotSingleVariableImplicitEquations")&&this.setWorkerConfigProperty("plotSingleVariableImplicitEquations",e.plotSingleVariableImplicitEquations),e.hasOwnProperty("plotImplicits")&&this.setWorkerConfigProperty("plotImplicits",e.plotImplicits),e.hasOwnProperty("plotInequalities")&&this.setWorkerConfigProperty("plotInequalities",e.plotInequalities),e.hasOwnProperty("sliders")&&this.setWorkerConfigProperty("sliders",e.sliders),e.hasOwnProperty("intersectId")&&(this.intersectId=e.intersectId),this.processStatements(e,t),this.updateAnalysis(),e.hasOwnProperty("intersectId")&&this._updateIntersections(e.intersectId,t);var n=this._publishAllStatuses();return this._computeAllLabels(),this._graphAllChanged(t),this.unpublishedIds={},{syncId:e.syncId,isCompleteState:e.isCompleteState,intersectionChanges:t.intersections,statusChanges:n,graphChanges:t.graphs}},ie.prototype.processStatements=function(e,t){if(e.statements)for(var r in e.statements){var n=e.statements[r];if(null===n){var i=void 0;if(!e.isCompleteState&&this.statements.hasOwnProperty(r)&&(i=this.statements[r].getAllIds()),this.removeStatement(r,t),!e.isCompleteState&&i)for(var o=0,a=i;o<a.length;o++){var s=a[o];t.graphs[s]=void 0}}else this.addStatement(n,t)}},ie.prototype.setViewState=function(e){if(!v.isEqual(e,this.viewState))for(var t in this.viewState=e,this.statements)this.statements.hasOwnProperty(t)&&(this.unpublishedIds[t]=!0)},ie.prototype.getViewState=function(){if(this.viewState){var e=Object.create(this.viewState);return this.parent_frame&&this.parent_frame.trigAngleMultiplier?e.trigAngleMultiplier=this.parent_frame.trigAngleMultiplier.asValue():e.trigAngleMultiplier=1,e}},ie.prototype.setDegreeMode=function(e){this.use_degrees=e,this.invalidate()},ie.prototype.setGlobalRandomSeed=function(e){this.globalRandomSeedString=e,this.parent_frame.globalRandomSeed=N(e),this.dirtyExportedSymbolRoots.globalRandomSeed=!0},ie.prototype.setEvaluationMode=function(e){this.evaluationMode=e,this.policy=B[e],this.invalidate()},ie.prototype.setAdditionalFunctions=function(e){this.additionalFunctions=e,this.invalidate()},ie.prototype.setRestrictedFunctions=function(e){this.restrictedFunctions=e,this.invalidate()},ie.prototype.setForceEnableGeometryFunctions=function(e){this.forceEnableGeometryFunctions=e,this.invalidate()},ie.prototype.setDistributions=function(e){this.distributions=e,this.invalidate()},ie.prototype.setFunctionDefinition=function(e){this.functionDefinition=e,this.invalidate()},ie.prototype.setReplaceRoundWithReciprocal=function(e){this.replaceRoundWithReciprocal=e,this.invalidate()},ie.prototype.setWorkerConfigProperty=function(e,t){t!==a[e]&&(a[e]=t,this.invalidate())},ie.prototype._publishAllStatuses=function(){var e,t={},r=this.currentStatus;for(var n in this.currentStatus={},this.unpublishedIds)this.analysis.hasOwnProperty(n)&&(e=this.analysis[n].evaluationState,JSON.stringify(e)!==JSON.stringify(r[n])&&(t[n]=e),this.currentStatus[n]=e);return t},ie.prototype._computeAllLabels=function(){for(var e in this.currentLabel){var t=this.statements[e];if(t){var r=t.tryGetConcreteTree(this.policy,this.frame),n=1;r.valueType===u.ListOfPoint&&(n=r.args.length);for(var i=[],o=0;o<n;o++)i.push(_.interpolate(this.currentLabel[e],this.frame,o));v.isEqual(i,t.computedLabels)||(t.computedLabels=i,this.unpublishedIds[e]=!0)}}},ie.prototype._graphAllChanged=function(e){var t=this.getViewState(),r=!1;if(b.default.validateViewState(t)){for(var n in this.unpublishedIds)if(this.analysis.hasOwnProperty(n)){var i=this.analysis[n],o=i.evaluationState.expression_type,a=o===S.ExpressionType.SINGLE_POINT||o===S.ExpressionType.POINT_LIST;if(i.rawTree.isTable)for(var s=i.graph(t),u=0,c=i.rawTree.getAllIds();u<c.length;u++){var l=c[u];s[l]?this._notifyGraphComputed(l,s[l],e):this._notifyGraphRemoved(l,e)}else i.evaluationState.is_graphable&&(i.rawTree.userData.shouldGraph||i.rawTree.userData.showLabel&&a)?(this._notifyGraphComputed(n,i.graph(t),e),this.intersectId===n&&(r=!0)):this._notifyGraphRemoved(n,e)}v.keys(this.unpublishedIds).length&&void 0!==this.intersectId&&(this.unpublishedIds.hasOwnProperty(this.intersectId)||(r=!0)),r&&this._updateIntersections(this.intersectId,e)}},ie.prototype._notifyGraphRemoved=function(e,t){t.graphs[e]=void 0},ie.prototype._notifyGraphComputed=function(e,t,r){I.dehydrateGraphData(t),r.graphs[e]=t},ie.prototype._updateIntersections=function(e,t){var r;this.viewState&&(this.analysis[e]&&this.analysis[e].shouldIntersect()?(r=j(this.analysis,this.viewState,e),t.intersections[e]=r):t.intersections[e]=[])},ie.prototype.getDisabledFeatures=function(){var e=this.policy.disabledFeatures(),t=!1===this.functionDefinition?e.concat("FunctionDefinition"):e,r=this.additionalFunctions||[];return t=t.filter(function(e){return!("Exponent"===e&&-1!==r.indexOf("exponent")||"PercentOf"===e&&-1!==r.indexOf("percent"))})},ie.prototype.addStatement=function(e,t){var n=this;if(e){var i=e.id;this.markExportsDirty(i),this.markAsDirtyRoot(i);var o,a,s,u,c,l,p,f,d={index:this.policy.ansEnabled()?e.index:void 0,disabledFeatures:this.getDisabledFeatures(),seedPrefix:G(i)},h={};switch(e.type){case"table":var m=[];this.statements.hasOwnProperty(i)&&(m=this.statements[i].getAllIds()),e.shouldGraph=!0;for(var y=e.columns,v=[],b=0,x=0,S=y;x<S.length;x++)var T=S[x],b=Math.max(T.values.length,b);for(var E=0;E<y.length;E++){for(var M=void 0,C=void 0,T=y[E],I=r.parse(T.latex,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["tr",0],["tc",E]])})),M=[],P=-1,k=0;k<y[E].values.length;k++)T.values[k].replace(/\\space/g,"").match(/\S/)?(M.push(r.parse(T.values[k],g.__assign(g.__assign({},d),{seedPrefix:G(i,[["tr",k+1],["tc",E]])}))),P=k):M.push(D(NaN));M=M.slice(0,P+1),(C=V(I,b,M)).id=T.id,C.header&&(C.header.userData=T,C.header.metaData={},T.colorLatex&&(C.header.metaData.colorLatex=r.parse(T.colorLatex,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["tr",0],["tc",E],["cl",E]])})))),v.push(C)}this.statements[i]=q(v);var O=this.statements[i].getAllIds();m.forEach(function(e){-1===O.indexOf(e)&&n._notifyGraphRemoved(e,t)});break;case"image":var N="-\\trigAngleMultiplier*("+e.angle+")",A=r.parse(e.center,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["ic",i]])})),z=r.parse(N,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["ia",i]])})),j=r.parse(e.width,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["iw",i]])})),B=r.parse(e.height,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["ih",i]])})),U=r.parse(e.opacity,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["io",i]])}));this.statements[i]=L({center:A,radianAngle:z,width:j,height:B,opacity:U});break;case"simulation":var W=r.parse(e.fps||"60",g.__assign(g.__assign({},d),{seedPrefix:G(i,[["fps",i]])}));this.statements[i]=F(W);break;default:this.statements[i]=r.parse(e.latex,d),this.statements[i].shouldPromoteToSlider(this.policy)?(a=!(!(o=e.slider)||!o.isPlayingOnce),s=Y(o&&o.softMin,d),u=Y(o&&o.softMax,d),c=Y(o&&o.min,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["lm",i]])})),l=Y(o&&o.max,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["lM",i]])})),p=Y(o&&o.step,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["ls",i]])})),e.lineWidth&&(h.lineWidth=Y(e.lineWidth,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["lw",i]])}))),e.lineOpacity&&(h.lineOpacity=Y(e.lineOpacity,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["lo",i]])}))),e.pointOpacity&&(h.pointOpacity=Y(e.pointOpacity,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["po",i]])}))),e.colorLatex&&(h.colorLatex=Y(e.colorLatex,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["ac",i]])}))),this.statements[i]=R(this.statements[i],{sliderMin:c,sliderMax:l,sliderStep:p,sliderIsPlayingOnce:a,sliderSoftMin:s,sliderSoftMax:u})):(e.polarDomain&&e.polarDomain.min&&(h.polarDomainMin=$(e.polarDomain.min,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["lm",i]])}))),e.polarDomain&&e.polarDomain.max&&(h.polarDomainMax=$(e.polarDomain.max,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["lM",i]])}))),e.parametricDomain&&e.parametricDomain.min&&(h.parametricDomainMin=$(e.parametricDomain.min,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["lm",i]])}))),e.parametricDomain&&e.parametricDomain.max&&(h.parametricDomainMax=$(e.parametricDomain.max,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["lM",i]])}))),e.vizProps&&(e.vizProps.axisOffset&&(h.vizAxisOffset=$(e.vizProps.axisOffset,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["vo",i]])}))),e.vizProps.breadth&&(h.vizBreadth=$(e.vizProps.breadth,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["vb",i]])})))),e.lineWidth&&(h.lineWidth=Y(e.lineWidth,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["lw",i]])}))),e.fillOpacity&&(h.fillOpacity=Y(e.fillOpacity,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["fo",i]])}))),e.lineOpacity&&(h.lineOpacity=Y(e.lineOpacity,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["lo",i]])}))),e.pointOpacity&&(h.pointOpacity=Y(e.pointOpacity,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["po",i]])}))),e.colorLatex&&(h.colorLatex=Y(e.colorLatex,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["cl",i]])}))),e.cdf&&e.cdf.show&&(f=w.parseToplevelFunction(e.latex))&&"distribution"===f.type&&(h.distributionSpec=f,h.cdfMin=Y(e.cdf.min,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["lm",i]])})),h.cdfMax=Y(e.cdf.max,g.__assign(g.__assign({},d),{seedPrefix:G(i,[["lM",i]])}))))}var J=e.clickableInfo;J&&J.enabled&&(h.clickableRules=(J.rules||[]).map(function(e){return{ruleId:e.id,assignment:Y(e.assignment,d),expression:Y(e.expression,d)}})),this.statements[i].userData=e,this.statements[i].metaData=h;var H,K=e.label;K?(H=this.currentLabel[i])&&H.raw===K||(this.currentLabel[i]=_.parse(K)):delete this.currentLabel[i]}},ie.prototype.removeStatement=function(e,t){var r,n=this.statements[e];n&&(this.markExportsDirty(e),n.isTable?(r=this,n.getAllIds().forEach(function(e){r._notifyGraphRemoved(e,t)})):this._notifyGraphRemoved(e,t),delete this.currentLabel[e],delete this.statements[e],delete this.analysis[e])},ie.prototype.markExportsDirty=function(e){if(this.statements[e]){this.statements[e].isRegression&&(this.markedRegressionDirty=!0);for(var t=0,r=this.statements[e].getLegalExports(this.policy);t<r.length;t++){var n=r[t];this.dirtyExportedSymbolRoots[n]=!0}}},ie.prototype.markAsDirtyRoot=function(e){this.dirtyStatementRoots[e]=!0},ie.prototype.getFrame=function(){return this.updateAnalysis(),this.frame},ie.prototype.getAnalysis=function(){return this.updateAnalysis(),this.analysis},ie.prototype.getEvaluationState=function(e){if(this.updateAnalysis(),this.analysis[e])return this.analysis[e].evaluationState},ie.prototype._updateRegressions=function(e){var t=this.frame,r=this.lastFrame,n=this.regressionFrame,o=[];for(var a in e)e.hasOwnProperty(a)&&e[a].isRegression&&o.push(a);var s=this;o.sort(function(e,t){var r=s.statements[e].userData&&s.statements[e].userData.residualVariable,n=s.statements[t].userData&&s.statements[t].userData.residualVariable;return r&&!n?-1:n&&!r?1:0});var u=i(this.policy,e,o);X(u,n);for(var c={},l=0,p=u.resolved;l<p.length;l++){var f,a=p[l];this.statements[a].isRegression?(this.analysis[a]=e[a].analyze(this.policy,n,t,r,c),this.analysis[a].exportTo(this.policy,t),delete e[a]):(f=e[a].tryGetConcreteTree(this.policy,n),e[a].exportTo(this.policy,f,n),c[a]={rawTree:e[a],concreteTree:f})}},ie.prototype.buildSymbolToExpressionDirtyMap=function(){var e={};for(var t in this.statements)if(this.statements.hasOwnProperty(t)){var r=this.statements[t],n=r.metaData;if(Q(e,t,r.getDependencies()),Q(e,t,r.getLegalExports(this.policy)),r.isRegression&&r.userData&&r.userData.residualVariable&&Q(e,t,[C.latexToIdentifier(r.userData.residualVariable)]),Z(e,t,n),r.isTable&&r.columns)for(var i=0;i<r.columns.length;i++){var o=r.columns[i];o.header&&o.header.metaData&&Z(e,t,o.header.metaData)}}return e},ie.prototype.getDirtyIdsAndSymbols=function(e){var t={},r={},n=this.markedRegressionDirty,i=[],o=[];for(var a in this.dirtyStatementRoots)this.dirtyStatementRoots[a]&&(r[a]=!0,i.push(a));for(var s in this.dirtyExportedSymbolRoots)this.dirtyExportedSymbolRoots[s]&&(t[s]=!0,o.push(s));for(;i.length||o.length;){for(;i.length;){var a=i.pop(),u=this.statements[a];if(u){u.isRegression&&(n=!0);for(var c=0,l=u.getLegalExports(this.policy);c<l.length;c++)t[s=l[c]]||(t[s]=!0,o.push(s))}}for(;o.length;){var p=e[s=o.pop()];if(p)for(var f=0,d=p;f<d.length;f++)r[a=d[f]]||(r[a]=!0,i.push(a))}}return{ids:r,symbols:t,hasDirtyRegression:n}},ie.prototype.updateAnalysis=function(){var e=this.buildSymbolToExpressionDirtyMap(),t=this.getDirtyIdsAndSymbols(e),r={};if(t.hasDirtyRegression){for(var n in this.statements)this.statements[n]&&(r[n]=this.statements[n]);this.frame=Object.create(this.parent_frame),this.regressionFrame=Object.create(this.parent_frame)}else{var a=t.ids;for(var n in a)this.statements[n]&&(r[n]=this.statements[n]);var s=t.symbols;for(var c in s)s[c]&&(delete this.frame[c],delete this.regressionFrame[c])}for(var n in r)r[n]&&(this.unpublishedIds[n]=!0);this.markedRegressionDirty=!1,this.dirtyExportedSymbolRoots={},this.dirtyStatementRoots={};var l=this.analysis,p=this.frame;"graphing"===this.evaluationMode&&this._updateRegressions(r);var f=i(this.policy,r);X(f,p);for(var d,h,m,y,g,v,b,_,T,w,E,I,N,L,F,R,q,V,j,B,U,G,W,J,H,$,Y,K,Q,Z,te=f.resolved,ne=0,ie=te;ne<ie.length;ne++)switch(n=ie[ne],this.evaluationMode){case"fourFunction":case"singleExpressionFourFunction":l[n]=this.statements[n].analyzeFourFunction(this.policy,p,l),l[n].exportTo(this.policy,p);break;case"scientific":l[n]=this.statements[n].analyzeScientific(this.policy,p,l),l[n].exportTo(this.policy,p);break;case"singleExpressionScientific":l[n]=this.statements[n].analyzeSingleExpressionScientific(this.policy,p,l),l[n].exportTo(this.policy,p);break;case"graphing":case"graphing_3d":if(p.r){var oe=Object.create(p);if(oe.r=z("r"),l[n]=this.statements[n].analyze(this.policy,oe,l),l[n].getGraphMode()===x.POLAR){l[n].exportTo(this.policy,p);continue}}l[n]=this.statements[n].analyze(this.policy,p,l),l[n].exportTo(this.policy,p)}if("graphing"===this.evaluationMode||"graphing_3d"===this.evaluationMode)for(var ae=0,se=te;ae<se.length;ae++){var n=se[ae],ue=l[n],ce=ue.evaluationState.expression_type;H=ue,$=this.policy,Y=p,Z=Q=K=void 0,K=H.evaluationState,Q=H.rawTree.metaData,Z=ee($,Y,Q.lineWidth,P.DEFAULT),Q.computedLineWidth=Z.value,K.line_width_valid=Z.valid,k.addSliderPrompts(K,$,Z.missingVarsMap),j=ue,B=this.policy,U=p,J=W=G=void 0,G=j.evaluationState,W=j.rawTree.metaData,J=ee(B,U,W.lineOpacity),W.computedLineOpacity=J.value,G.line_opacity_valid=J.valid,k.addSliderPrompts(G,B,J.missingVarsMap),w=ue,E=this.policy,I=p,V=q=R=F=L=N=void 0,N=w.evaluationState,L=w.rawTree,F=w.concreteTree,R=L.metaData,q=L.getGraphMode(E,F)===x.XYPOINT_MOVABLE,V=ee(E,I,R.pointOpacity,q?1:O.DEFAULT),R.computedPointOpacity=V.value,N.point_opacity_valid=V.valid,k.addSliderPrompts(N,E,V.missingVarsMap),function(e,t,r){var n,i;if(e.rawTree.isTable&&e.evaluationState.column_data&&e.rawTree.columns)for(var o=0;o<e.evaluationState.column_data.length;o++)n=e.evaluationState.column_data[o],re((i=e.rawTree.columns[o].header.metaData).colorLatex,i,n,t,r);else n=e.evaluationState,re((i=e.rawTree.metaData).colorLatex,i,n,t,r)}(ue,this.policy,p),ce!==S.ExpressionType.POLYGON&&ce!==S.ExpressionType.PARAMETRIC||(y=ue,g=this.policy,v=p,T=_=b=void 0,b=y.evaluationState,_=y.rawTree.metaData,T=ee(g,v,_.fillOpacity),_.computedFillOpacity=T.value,b.fill_opacity_valid=T.valid,k.addSliderPrompts(b,g,T.missingVarsMap)),function(e){var t=e.evaluationState.expression_type,r=e.rawTree.userData;if(r.clickableInfo&&r.clickableInfo.enabled){if(e.rawTree.isImage)return 1;if(e.rawTree.isSimulation)return 1;if(e.getGraphMode()!==x.XYPOINT_MOVABLE)return S.isClickableExpressionType(t)}}(ue)&&function(e,t,r){var n=e.evaluationState,i=e.rawTree,a={},s={};n.clickableinfo_data={},i.metaData.clickableRules.forEach(function(e){var i,c,l,p,f,d,h,m,y=e.assignment,g=e.expression,v={};if(n.clickableinfo_data[e.ruleId]=v,y){"Identifier"===y.type?"Slider"===(h=(d=r[(f=y)._symbol])&&d.type)||"Assignment"===h?(i=f._symbol,(m=s[i])?(l=o.clickableObjectAlreadyAssigned(i).getError(),!0!==m&&(delete m.identifier,delete m.latex,m.error=o.clickableObjectAlreadyAssigned(i).getError(),s[i]=!0)):s[i]=v):l=o.clickableObjectAssignmentNotDefined(f._symbol).getError():l=o.clickableObjectAssignmentNotIdentifier().getError();for(var b=0,x=y.tryGetConcreteTree(t,r).getDependencies();b<x.length;b++){var _=x[b];a[_]=!0}}if(g){var S=g.tryGetConcreteTree(t,r);if(S.valueType===u.Number){var T=+S.asValue();isNaN(T)||(c=M.default(T))}else if(S.valueType===u.ListOfNumber){for(var w=[],E=!0,I=0,P=S.args;I<P.length;I++){if((V=P[I]).valueType!==u.Number){E=!1;break}var k=+V.asValue();w.push(M.default(k)),isNaN(k)&&(E=!1)}E&&(c="\\left["+w.join(",")+"\\right]")}else if(S.valueType===u.Point){for(var O=[],D=!0,N=0,A=S.args;N<A.length;N++){if((V=A[N]).valueType!==u.Number){D=!1;break}if(k=+V.asValue(),isNaN(k)){D=!1;break}O.push(M.default(k))}D&&(c="\\left("+O.join(",")+"\\right)")}else if(S.valueType===u.ListOfPoint){for(var E=!0,L=[],F=0,R=S.args;F<R.length;F++){var q=R[F];if(q.valueType!==u.Point){E=!1;break}for(var V,O=[],D=!0,z=0,j=q.args;z<j.length;z++){if((V=j[z]).valueType!==u.Number){D=!1;break}if(k=+V.asValue(),isNaN(k)){D=!1;break}O.push(M.default(k))}if(!D){E=!1;break}L.push("\\left("+O.join(",")+"\\right)")}E&&(c="\\left["+L.join(",")+"\\right]")}else S.valueType===u.EmptyList&&(c="\\left[\\right]");c||(p=o.clickableObjectInvalidExpression().getError());for(var B=0,U=S.getDependencies();B<U.length;B++)_=U[B],a[_]=!0}l?v.error=l:p?v.error=p:i&&c&&(v.identifier=i,v.latex=C.identifierToLatex(i)+"="+c)}),k.addSliderPrompts(n,t,a)}(ue,this.policy,p),ce===S.ExpressionType.PARAMETRIC||ce===S.ExpressionType.POLAR?function(e,t,r){var n=e.evaluationState,i=e.rawTree,a=n.expression_type===S.ExpressionType.POLAR?i.metaData.polarDomainMin:i.metaData.parametricDomainMin,s=n.expression_type===S.ExpressionType.POLAR?i.metaData.polarDomainMax:i.metaData.parametricDomainMax,u={},c=NaN,l=NaN,p=!1;if(a){p=!0;var f=a.tryGetConcreteTree(t,r);f.isConstant&&(c=+f.asValue());for(var d=0,h=f.getDependencies();d<h.length;d++)u[h[d]]=!0}else c=0;if(s){p=!0;var m=s.tryGetConcreteTree(t,r);m.isConstant&&(l=+m.asValue());for(var y=0,g=m.getDependencies();y<g.length;y++)u[g[y]]=!0}else n.expression_type===S.ExpressionType.PARAMETRIC?l=1:n.expression_type===S.ExpressionType.POLAR&&(l=12*Math.PI/r.trigAngleMultiplier.asValue());var v=!0,b=!0;isFinite(c)||(v=!1,c=NaN),isFinite(l)||(b=!1,l=NaN),v?b?l<c&&(b=v=!1,n.error=o.domainMaxLessThanMin().getError()):n.error=o.domainMaxInvalid().getError():n.error=o.domainMinInvalid().getError(),i.metaData.evaluatedDomainMin=c,i.metaData.evaluatedDomainMax=l,n.expression_type===S.ExpressionType.POLAR&&(i.metaData.isExplicitDomain=p),n.domain_min_number=c,n.domain_max_number=l,n.domain_min_valid=v,n.domain_max_valid=b,n.expression_type===S.ExpressionType.PARAMETRIC&&(delete u.t,k.addSliderPrompts(n,t,u))}(ue,this.policy,p):ce===S.ExpressionType.BOXPLOT?function(e,t,r){var n=e.evaluationState,i=e.rawTree,a=i.metaData.vizAxisOffset,s=i.metaData.vizBreadth,u={},c=NaN,l=NaN;if(a){var p=a.tryGetConcreteTree(t,r);p.isConstant&&(c=+p.asValue());for(var f=0,d=p.getDependencies();f<d.length;f++)u[d[f]]=!0}else c=1;if(s){var h=s.tryGetConcreteTree(t,r);h.isConstant&&(l=+h.asValue());for(var m=0,y=h.getDependencies();m<y.length;m++)u[y[m]]=!0}else l=1;var g=!0,v=!0;isFinite(c)||(g=!1,c=NaN),isFinite(l)||(v=!1,l=NaN),g?v||(n.error=o.boxplotBreadthInvalid().getError()):n.error=o.boxplotOffsetInvalid().getError(),i.metaData.evaluatedAxisOffset=c,i.metaData.evaluatedBreadth=l,n.viz_values={axisOffset:c,breadth:l},n.viz_valids={axisOffset:g,breadth:v},k.addSliderPrompts(n,t,u)}(ue,this.policy,p):(m=h=void 0,h=(d=ue).rawTree.userData,m=d.rawTree.metaData,h.cdf&&h.cdf.show&&m.distributionSpec&&function(e,t,r){var n=e.evaluationState,i=e.rawTree,a=i.metaData.cdfMin,s=i.metaData.cdfMax,u={},c=NaN,l=NaN,p="Assignment"===i.type?i._expression:i,f=p&&p.metaData&&p.metaData.distributionSpec;if(a){var d=a.tryGetConcreteTree(t,r);d.isConstant&&(c=+d.asValue());for(var h=0,m=d.getDependencies();h<m.length;h++)u[m[h]]=!0}else c=-1/0;if(s){var y=s.tryGetConcreteTree(t,r);y.isConstant&&(l=+y.asValue());for(var g=0,v=y.getDependencies();g<v.length;g++)u[v[g]]=!0}else l=1/0;var b,x=!0,_=!0;isNaN(c)&&(x=!1,c=NaN),isNaN(l)&&(_=!1,l=NaN),x?_?l<c&&(_=x=!1,n.error=o.cdfMaxLessThanMin().getError()):n.error=o.cdfMaxInvalid().getError():n.error=o.cdfMinInvalid().getError(),x&&_&&(b=A("cdf",[p,D(c),D(l)]),n.cdf_evaluation=+b.tryGetConcreteTree(t,r).asValue());var S,T=-1/0,w=1/0;f&&(f.discrete&&(T=0),"binomialdist"===f.symbol&&p.args&&p.args[0]&&(S=+p.args[0].asValue(),isFinite(S)&&(w=S))),i.metaData.evaluatedCDFMin=c,i.metaData.evaluatedCDFMax=l,n.cdf_min_valid=x,n.cdf_max_valid=_,n.cdf_min_default=T,n.cdf_max_default=w,n.is_single_identifier=!1,k.addSliderPrompts(n,t,u)}(ue,this.policy,p))}for(var c in(e.globalRandomSeed||[]).forEach(function(e){l[e].evaluationState.depends_on_random_seed=!0}),this.lastFrame=Object.create(this.parent_frame),p)p.hasOwnProperty(c)&&(this.lastFrame[c]=p[c])},ie);function ie(){this.getCLSymbolMap=T.getCLSymbolMap,this.statements={},this.analysis={},this.currentStatus={},this.currentLabel={},this.unpublishedIds={},this.intersectId=void 0,this.dirtyExportedSymbolRoots={},this.dirtyStatementRoots={},this.markedRegressionDirty=!1,this.use_degrees=!1,this.initialEvaluation=!1,this.setEvaluationMode("graphing"),this.setRestrictedFunctions(!1),this.setForceEnableGeometryFunctions(!1),this.setFunctionDefinition(!0),this.setReplaceRoundWithReciprocal(!1),this.setDistributions(!0),this.invalidate()}t.Context=ne});r("core/graphing-calc/migrations/0",["require"],function(e){"use strict";var t={expression:!0,table:!0,image:!0,folder:!0,text:!0};function r(e){return e.replace(/\\(total|length|mean|median|quantile|stdev|stddev|stdDev|stdevp|stddevp|stdDevP|var|variance|cov|corr|ceil|floor|round|abs|mod|lcm|mcm|mcd|nCr|nPr|signum|sign|arcsinh|arccosh|arctanh|arccsch|arcsech|arccoth|arccsc|arcsec|arccot)/g,"\\operatorname{$1}")}function n(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]="latex"===n?r(e[n]):"values"===n?e[n].map(r):e[n]);return t}function i(e){var i,o=function(e){if(e.type){if(t.hasOwnProperty(e.type))return e.type;throw new Error("Invalid item type: '"+e.type+"'.")}return void 0!==e.text?"text":void 0!==e.columns||void 0!==e.headings?"table":"expression"}(e),a={};switch(o){case"expression":for(i in e)e.hasOwnProperty(i)&&(a[i]="latex"===i?r(e[i]):e[i]);return a.type=o,a;case"table":for(i in e)e.hasOwnProperty(i)&&(a[i]="columns"===i?e[i].map(n):e[i]);return a.type=o,a;case"image":for(i in e)e.hasOwnProperty(i)&&(a[i]="width"===i||"height"===i||"x"===i||"y"===i?r(e[i]):e[i]);return a.type=o,a;case"text":case"folder":for(i in e)e.hasOwnProperty(i)&&(a[i]=e[i]);return a.type=o,a}}var o={none:"NONE",both:"BOTH",positive:"POSITIVE"};return function(e){if(e.version)throw new Error("Unexpected version: "+e.version);var t={};return t.graph=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&"xAxisArrows"!==r&&"yAxisArrows"!==r&&(t[r]=e[r]);return t.xAxisArrowMode=o[e.xAxisArrows||"none"],t.yAxisArrowMode=o[e.yAxisArrows||"none"],t}(e.graph),t.expressions={list:e.expressions.list.map(i)},t.version=0,t}});r("core/graphing-calc/migrations/1",["require"],function(e){"use strict";function t(e){return e.replace(/\\(sech|csch)/g,"\\operatorname{$1}")}function r(e){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]="latex"===n?t(e[n]):"values"===n?e[n].map(t):e[n]);return r}function n(e){var n,i=e.type,o={};switch(i){case"expression":for(n in e)e.hasOwnProperty(n)&&(o[n]="latex"===n?t(e[n]):e[n]);return o;case"table":for(n in e)e.hasOwnProperty(n)&&(o[n]="columns"===n?e[n].map(r):e[n]);return o;case"image":for(n in e)e.hasOwnProperty(n)&&(o[n]="width"===n||"height"===n||"x"===n||"y"===n?t(e[n]):e[n]);return o;case"text":case"folder":for(n in e)e.hasOwnProperty(n)&&(o[n]=e[n]);return o;default:throw new Error("Unexpected expression type: "+i)}}return function(e){if(e.version)throw new Error("Unexpected version: "+e.version);var t={};return t.graph=e.graph,t.expressions={list:e.expressions.list.map(n)},t.version=1,t}});r("core/graphing-calc/migrations/2",["require","core/lib/color-helpers"],function(e){"use strict";var t=e("core/lib/color-helpers").colors,r="#C0504D",n="#4F81BD",i="#9BBB59",o="#8064A2",a="#F79646",s="#000000";function u(e){switch(e){case r:return t.RED;case n:return t.BLUE;case i:return t.GREEN;case o:return t.PURPLE;case a:return t.ORANGE;case s:return t.BLACK;default:return e}}function c(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]="color"===r?u(e[r]):e[r]);return t}function l(e){var t,r=e.type,n={};switch(r){case"expression":for(t in e)e.hasOwnProperty(t)&&(n[t]="color"===t?u(e[t]):e[t]);return n;case"table":for(t in e)e.hasOwnProperty(t)&&(n[t]="columns"===t?e[t].map(c):e[t]);return n;case"image":case"text":case"folder":for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n;default:throw new Error("Unexpected expression type: "+r)}}return function(e){if(1<e.version)throw new Error("Unexpected version: "+e.version);var t={};return t.graph=e.graph,t.expressions={list:e.expressions.list.map(l)},t.version=2,t}});r("core/graphing-calc/migrations/3",["require"],function(e){"use strict";function t(e){if("string"==typeof e)return e;if(void 0===e)return"";var t=e+"";return t=(t=t.replace(/1e\+?([-\d]+)/,"10^{$1}")).replace(/([-\d\.]+)e\+?([-\d]+)/,"$1\\cdot 10^{$2}")}function r(e){var r,n=e.type,i={};switch(n){case"expression":for(r in e)e.hasOwnProperty(r)&&(i[r]="sliderMax"===r||"sliderMin"===r||"sliderInterval"===r?t(e[r]):"domain"===r?{max:t(e[r].max),min:t(e[r].min)}:e[r]);return i.hasOwnProperty("sliderMin")&&void 0===i.sliderInterval&&(i.sliderInterval=""),i;case"image":case"table":case"text":case"folder":for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);return i;default:throw new Error("Unexpected expression type: "+n)}}return function(e){if(2<e.version)throw new Error("Unexpected version: "+e.version);var t={};return t.graph=e.graph,t.expressions={list:e.expressions.list.map(r)},t.version=3,t}});r("core/graphing-calc/migrations/4",["require"],function(e){"use strict";function t(e){switch(e){case"point":return"POINT";case"cross":return"CROSS";case"open":return"OPEN";case"normal":return"SOLID";case"dashed":return"DASHED";case"dotted":return"DOTTED";default:return e}}function r(e){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]="style"===n?t(e[n]):e[n]);return r}function n(e){var n,i=e.type,o={};switch(i){case"expression":for(n in e)e.hasOwnProperty(n)&&(o[n]="style"===n?t(e[n]):e[n]);return o;case"table":for(n in e)e.hasOwnProperty(n)&&(o[n]="columns"===n?e[n].map(r):e[n]);return o;case"image":case"text":case"folder":for(n in e)e.hasOwnProperty(n)&&(o[n]=e[n]);return o;default:throw new Error("Unexpected expression type: "+i)}}return function(e){if(3!==e.version)throw new Error("Unexpected version: "+e.version);var t={};return t.graph=e.graph,t.expressions={list:e.expressions.list.map(n)},t.version=4,t}});r("core/graphing-calc/validate-state",["require","exports","core/lib/deepCopy"],function(e,t,r){"use strict";function n(e){for(var t,r,n,o,a=function(e){for(var t=0,r=0,n=e;r<n.length;r++){var o=n[r];if(t=i(t,o.id),"table"===o.type)for(var a=0,s=o.columns;a<s.length;a++){var u=s[a];i(t,u.id)}}return t}(e)+1,s={},u=0,c=e;u<c.length;u++){var l=c[u];if(o=void 0,(n=l).slider&&("number"==typeof(o=n.slider).min&&(o.min=""+o.min),"number"==typeof o.max&&(o.max=""+o.max),"number"==typeof o.step&&(o.step=""+o.step)),"string"!=typeof n.id&&(n.id=""+n.id),"folder"===l.type)t=l.id,s[l.id]&&(l.id=""+a,a+=1),r=l.id,s[l.id]=!0,l.hasOwnProperty("folderId")&&delete l.folderId;else{if(void 0!==t&&l.folderId===t?l.folderId=r:(l.folderId&&(l.folderId=""),r=t=void 0),"table"===l.type)for(var p=0,f=l.columns;p<f.length;p++){var d=f[p];s[d.id]&&(d.id=""+a,a+=1),s[d.id]=!0}s[l.id]&&(l.id=""+a,a+=1),s[l.id]=!0}}}function i(e,t){var r=parseFloat(t);return r!==Math.floor(r)?e:Math.max(e,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.validateState=void 0,t.validateState=function(e){var t=r.default(e);return n(t.expressions.list),t}});r("core/graphing-calc/migrations/back-migration",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(9!==e.version)throw new Error("Unexpected version: "+e.version);var t=e.expressions.list.map(function(e){return e});return{version:8,graph:e.graph,randomSeed:e.randomSeed,expressions:{list:t}}}});r("core/graphing-calc/migrations/5",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.migrateState=void 0;function r(e){var t={};for(var r in e)e.hasOwnProperty(r)&&"showPoints"!==r&&"showLine"!==r&&(t[r]=e[r]);return void 0===e.showPoints&&void 0===e.showLine||(e.showPoints&&e.showLine?t.columnMode="POINTS_AND_LINES":e.showPoints?t.columnMode="POINTS":e.showLine?t.columnMode="LINES":(t.hidden=!0,t.columnMode="POINTS")),t}function n(e){var t,n=e.type,i={};switch(n){case"expression":for(t in void 0===e.hidden?e.hasOwnProperty("graphed")?i.hidden=!e.graphed:e.hasOwnProperty("userRequestedGraphing")?i.hidden="never"===e.userRequestedGraphing:i.hidden=!1:i.hidden=e.hidden,e)e.hasOwnProperty(t)&&"graphed"!==t&&"userRequestedGraphing"!==t&&"hidden"!==t&&"slider"!==t&&("color"!==t?"style"!==t?"sliderInterval"!==t?i[t]=e[t]:i.sliderInterval="undefined"===e.sliderInterval?"":e.sliderInterval:i.style="normal"===e.style?"SOLID":e.style:"object"==typeof e.color?i.color=e.color.value:i.color=e.color);return i;case"table":if(e.headings||e.columns){var o=e.headings?e.headings:e.columns;if(i.columns=o.map(r),e.rows)for(var a=0;a<i.columns.length;a++){var s=i.columns[a];s.values=[];for(var u=0;u<e.rows.length;u++)s.values.push(e.rows[u][a])}}for(t in e)e.hasOwnProperty(t)&&"rows"!==t&&"headings"!==t&&"columns"!==t&&(i[t]=e[t]);return i;case"image":case"text":case"folder":for(t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i;default:throw new Error("Unexpected expression type: "+n)}}t.migrateState=function(e){if(4!==e.version)throw new Error("Unexpected version: "+e.version);return{version:5,graph:function(e){var t,r={};for(var n in e)if(e.hasOwnProperty(n))switch(t=e[n],n){case"showAxes":r.showXAxis=t,r.showYAxis=t;break;case"showLabels":r.xAxisNumbers=t,r.yAxisNumbers=t,r.polarNumbers=t;break;case"labelXMode":r.xAxisStep="pi"===t?Math.PI:0;break;case"labelYMode":r.yAxisStep="pi"===t?Math.PI:0;break;default:r[n]=t}return r}(e.graph),expressions:{list:e.expressions.list.map(n)}}}});r("core/math/evaluate-single-expression",["require","exports","parser","core/math/builtinframe","core/math/parsenode/constant","core/math/policy"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(/^\s*(\-|\+)?([0-9]+(\.[0-9]+)?)\s*$/.test(e))return parseFloat(e);var a=Object.create(n);return a.trigAngleMultiplier=i(t?Math.PI/180:1),+r.parse(e).tryGetConcreteTree(o.defaultPolicy,a).asValue()}});r("core/graphing-calc/migrations/6",["require","exports","core/lib/deepCopy","underscore","core/math/sliders","core/math/evaluate-single-expression"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.migrateState=void 0;function a(e){var t={};for(var r in e)if(e.hasOwnProperty(r)&&"style"!==r)if("values"===r&&(t[r]=e[r].map(function(e){return e?""+e:""})),"columnMode"!==r||e.hasOwnProperty("points")||e.hasOwnProperty("lines"))t[r]=e[r];else switch(e[r]){case"LINES":t.points=!1,t.lines=!0;break;case"POINTS_AND_LINES":t.points=!0,t.lines=!0;break;default:t.points=!0,t.lines=!1}return t.hasOwnProperty("pointStyle")||(t.pointStyle="POINT"),t.hasOwnProperty("lineStyle")||(t.lineStyle="SOLID"),t.id=""+t.id,t}var s={sliderMin:"min",sliderMax:"max",sliderInterval:"step",sliderHardMin:"hardMin",sliderHardMax:"hardMax",sliderAnimationPeriod:"animationPeriod",sliderLoopMode:"loopMode",sliderPlayDirection:"playDirection",sliderIsPlaying:"isPlaying"};function u(e){var t=function(e){if(!((t=e).length<2)&&"`"===t[0]&&"`"===t[t.length-1])return{raw:e,parts:[e]};for(var t,r,n,i="({"+["[a-zA-Z][0-9]*","[a-zA-Z]_[a-zA-Z0-9]+","[a-zA-Z]_\\{[a-zA-Z0-9]+\\}"].join("})|({")+"})",o=new RegExp(i,"g"),a=[],s=0;n=o.exec(e);){s<(r=n.index)&&a.push(e.substr(s,r-s));var u=n[0],c=u.replace(/[{}\$]/g,"").replace(/^([a-zA-Z])([0-9]+)$/,"$1_$2");a.push({symbol:c,str:u}),s=n.index+u.length}return s<e.length&&a.push(e.substr(s)),{raw:e,parts:a}}(e),r="";return n.each(t.parts,function(e){r+="object"==typeof e&&e.str?"$"+e.str:e}),r}function c(e,t,r,c){var l,p,f,d,h,m,y,g,v,b,x,_=e.type,S={};switch(_){case"folder":for(l in e)e.hasOwnProperty(l)&&("memberIds"===l||(S[l]=e[l]));break;case"expression":for(l in e){e.hasOwnProperty(l)&&("style"!==l||e.hasOwnProperty("pointStyle")||e.hasOwnProperty("lineStyle")?(s.hasOwnProperty(l)?(S.slider=S.slider||{},S.slider[s[l]]=e[l]):S[l]=e[l],e.label&&(S.label=u(e.label))):(p=e[l],n.contains(["POINT","OPEN","CROSS"],p)?(S.pointStyle=p,S.lineStyle="SOLID"):n.contains(["SOLID","DASHED","DOTTED"],p)?(S.pointStyle="POINT",S.lineStyle=p):(S.pointStyle="POINT",S.lineStyle="SOLID")))}S.latex&&S.slider&&!S.slider.isPlaying&&(d=c,2===(b=(f=S).latex.split("=")).length&&(h=o.default(b[1],d),isFinite(h)&&(m=f.slider.hardMin?o.default(f.slider.min||"-10",d):void 0,y=f.slider.hardMax?o.default(f.slider.max||"10",d):void 0,g=f.slider.step?o.default(f.slider.step,d):void 0,(v=i.determineWhichLimitsAreCompatibleWithValue({target:h,step:g,hardMin:m,hardMax:y})).min||(delete f.slider.hardMin,delete f.slider.min),v.max||(delete f.slider.hardMax,delete f.slider.max),v.step||delete f.slider.step))),S.hasOwnProperty("fillOpacity")||(S.fillOpacity=.4),!1===S.label&&(S.label=""),S.labelSize||(S.labelSize="medium"),S.labelOrientation||(S.labelOrientation="default"),S.verticalLabel||(S.verticalLabel=!1),S.interactiveLabel||(S.interactiveLabel=!1);break;case"image":for(l in e)e.hasOwnProperty(l)&&"x"!==l&&"y"!==l&&(S[l]=e[l]);S.center="\\left("+(e.x||"0")+","+(e.y||"0")+"\\right)",S.angle=e.angle||"0",S.foreground=!!S.foreground;break;case"text":for(l in e)e.hasOwnProperty(l)&&(S[l]=e[l]);break;case"table":for(l in e)e.hasOwnProperty(l)&&(S[l]="columns"===l?e[l].map(a):e[l]);break;default:throw new Error("Unexpected expression type: "+_)}return S.id=""+S.id,"folder"===e.type?(t.folderId=S.id,t.memberIds=e.memberIds,S.folderId=""):(x=r[S.id],t.memberIds&&t.memberIds[x]?S.folderId=t.folderId:(S.folderId="",t.folderId=void 0,t.memberIds=void 0)),S}t.migrateState=function(e){if(5!==e.version)throw new Error("Unexpected version: "+e.version);var t=!(!e.graph||!e.graph.degreeMode),n=e.expressions.list,i=-1,o={},a={},s={};return{version:6,graph:e.graph,expressions:{list:n.map(function(e){return o[e.id]?(-1===i&&(i=function(e){for(var t=0,r=/^[0-9]+$/,n=e.length-1;0<=n;n--){var i,o=e[n],a=o.id;if(r.test(a)&&t<(i=parseInt(a,10))&&(t=i),"table"===o.type&&o.columns)for(var s=o.columns.length-1;0<=s;s--)a=o.columns[s].id,r.test(a)&&t<(i=parseInt(a,10))&&(t=i)}return t+1}(n)),a[i]=e.id,(e=r.default(e)).id=i+"",i+=1):a[e.id]=e.id,o[e.id]=!0,c(e,s,a,t)})}}}});r("core/graphing-calc/migrations/7",["require","exports","tslib"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(6!==e.version)throw new Error("Unexpected version: "+e.version);var t=e.expressions.list.map(function(e){if("expression"===e.type&&e.domain){var t=r.__assign(r.__assign({},e),{parametricDomain:{min:e.domain.min,max:e.domain.max}});return delete t.domain,t}return e});return{version:7,randomSeed:e.randomSeed,graph:e.graph,expressions:{list:t}}}});r("core/lib/random-seed",["require","exports","core/lib/md5"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=new Uint8Array(16);if("undefined"!=typeof crypto)crypto.getRandomValues(e);else{if("undefined"==typeof msCrypto)return r(Date.now().toString());msCrypto.getRandomValues(e)}return Array.prototype.slice.call(e).map(function(e){return 1===(t=e.toString(16)).length?"0"+t:t;var t}).join("")}});r("core/graphing-calc/migrations/8",["require","exports","tslib","core/lib/random-seed","core/lib/deepCopy"],function(e,t,r,n,i){"use strict";function o(e){var t=e.split("_");return 2===t.length&&t[1]&&1===t[1].length?t[0]+"_{"+t[1]+"}":e}function a(e){return(e=i.default(e)).rules||!e.assignment&&!e.expression||(e.rules=[{id:"1",assignment:e.assignment||"",expression:e.expression||""}]),delete e.assignment,delete e.expression,e}function s(e){return e.replace(/\\operatorname(?:\{stdev\}p|\{stddev\}p|\{stdDev\}P|\{var\}iance)/g,function(e){switch(e){case"\\operatorname{stdev}p":return"\\operatorname{stdevp}";case"\\operatorname{stddev}p":return"\\operatorname{stddevp}";case"\\operatorname{stdDev}P":return"\\operatorname{stdDevP}";case"\\operatorname{var}iance":return"\\operatorname{variance}";default:return""}})}function u(e){var t=e.latex,n=e.values,i=r.__assign({},e);return t&&(i.latex=s(t),i.latex=o(i.latex)),n&&(i.values=n.map(function(e){return e?s(e):""})),i}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(7!==e.version)throw new Error("Unexpected version: "+e.version);var t=e.expressions.list.map(function(e){if("image"===e.type){var t,n=r.__assign(r.__assign({},e),{opacity:""});for(var c in e.hasOwnProperty("stringOpacity")?n.opacity=e.stringOpacity:e.hasOwnProperty("opacity")?n.opacity=e.opacity+"":delete n.opacity,e.clickableInfo&&(n.clickableInfo=a(e.clickableInfo)),delete n.stringOpacity,e){"x"!==c&&"y"!==c&&"width"!==c&&"height"!==c||(t=e[c])&&(n[c]=s(t))}return n}if("expression"!==e.type)return"table"===e.type?(l=e).columns?r.__assign(r.__assign({},l),{columns:l.columns.map(u)}):l:e;var l,n=r.__assign(r.__assign({},e),{fillOpacity:"",lineStyle:"SOLID"});if("SINGLE_PIXEL"===e.lineStyle?n.lineWidth="1":e.hasOwnProperty("lineStyle")?n.lineStyle=e.lineStyle:delete n.lineStyle,n.hasOwnProperty("lineWidth")||(n.lineWidth=""),n.hasOwnProperty("lineOpacity")||(n.lineOpacity=""),n.hasOwnProperty("pointOpacity")||(n.pointOpacity=""),n.hasOwnProperty("colorLatex")||(n.colorLatex=""),"string"==typeof e.latex&&(n.latex=s(e.latex)),e.latex&&(n.latex=s(e.latex)),e.hasOwnProperty("stringFillOpacity")?n.fillOpacity=e.stringFillOpacity:e.hasOwnProperty("fillOpacity")?n.fillOpacity=e.fillOpacity+"":delete n.fillOpacity,n.slider&&e.slider&&e.slider.newLoopMode&&(n.slider=i.default(n.slider),n.slider.loopMode=e.slider.newLoopMode,delete n.slider.newLoopMode),n.residualVariable&&(n.residualVariable=o(n.residualVariable)),n.regressionParameters)for(var p in n.regressionParameters={},e.regressionParameters){var f=o(p),d=e.regressionParameters[p];n.regressionParameters[f]=d}return e.clickableInfo&&(n.clickableInfo=a(e.clickableInfo)),n});return{version:8,randomSeed:e.randomSeed||n.default(),graph:e.graph,expressions:{list:t}}}});r("core/graphing-calc/migrations/9",["require","exports","core/lib/random-seed"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(8!==e.version)throw new Error("Unexpected version: "+e.version);var t=e.expressions.list.map(function(e){return e});return{version:9,randomSeed:e.randomSeed||r.default(),graph:e.graph,expressions:{list:t}}}});r("core/graphing-calc/migrate-state",["require","exports","./migrations/0","./migrations/1","./migrations/2","./migrations/3","./migrations/4","core/graphing-calc/validate-state","./migrations/back-migration","./migrations/5","./migrations/6","./migrations/7","./migrations/8","./migrations/9"],function(e,t,r,n,i,o,a,s,u,c,l,p,f,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.migrateToPersisted=t.migrateToLatest=t.currentVersion=t.persistedVersion=void 0;var h=[r,n,i,o,a,c.migrateState,l.migrateState,p.default,f.default,d.default];function m(e){if(e.version>t.currentVersion)return"undefined"!=typeof console&&console.warn&&console.warn("Loading saved state with version "+e.version+" but last known version is "+t.currentVersion+". States saved in a newer version of the calculator may not load correctly in an older version of the calculator."),s.validateState(e);if(e.hasOwnProperty("version")&&!h[e.version])return"undefined"!=typeof console&&console.warn&&console.warn("State has invalid version "+e.version+". If a version is present, it should be a non-negative integer less than or equal to "+t.currentVersion+"."),s.validateState(e);for(e.hasOwnProperty("version")||(e=h[0](e));e.version<t.currentVersion;)e=h[e.version+1](e);return s.validateState(e)}t.persistedVersion=8,t.currentVersion=9,t.migrateToLatest=m,t.migrateToPersisted=function(e){return u.default(m(e))}});r("core/graphing-calc/json/table",["require","exports","tslib","core/lib/default-spec","core/types/styles","core/lib/dragmode"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeParsableState=t.stripDefaults=t.inflateDefaults=t.COLUMN_DEFAULTS=t.DEFAULTS=void 0,t.DEFAULTS={folderId:"",secret:!1,columns:[]},t.COLUMN_DEFAULTS={latex:"",color:"",hidden:!1,values:[],points:!0,lines:!1,dragMode:o.DragMode.NONE,pointStyle:i.PointStyle.POINT,lineStyle:i.LineStyle.SOLID,colorLatex:""},t.inflateDefaults=function(e){var n=r.__assign(r.__assign({},t.DEFAULTS),e);return n.columns=n.columns.map(function(e){return r.__assign(r.__assign({},t.COLUMN_DEFAULTS),e)}),n},t.stripDefaults=function(e){return e=r.__assign(r.__assign({},e),{columns:e.columns.map(function(e){return n.stripDefaults(t.COLUMN_DEFAULTS,e)})}),n.stripDefaults(t.DEFAULTS,e)},t.computeParsableState=function(e){return{type:"table",id:e.id,columns:e.columns.map(function(t){return r.__assign(r.__assign({},t),{tableId:e.id})})}}});r("core/graphing-calc/json/simulation",["require","exports","tslib","core/lib/default-spec"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeParsableState=t.stripDefaults=t.inflateDefaults=t.DEFAULTS=t.CLICKABLEINFO_DEFAULTS=void 0,t.CLICKABLEINFO_DEFAULTS={enabled:!0,description:"",rules:[{id:"1",expression:"",assignment:""}]},t.DEFAULTS={folderId:"",secret:!1,clickableInfo:t.CLICKABLEINFO_DEFAULTS,isPlaying:!1,fps:""},t.inflateDefaults=function(e){return r.__assign(r.__assign(r.__assign({},t.DEFAULTS),e),{clickableInfo:r.__assign(r.__assign({},t.CLICKABLEINFO_DEFAULTS),e.clickableInfo)})},t.stripDefaults=function(e){var r=n.stripDefaults(t.DEFAULTS,e),i=n.stripDefaultsAndMaybeReturnUndefined(t.CLICKABLEINFO_DEFAULTS,e.clickableInfo);return void 0===i?delete r.clickableInfo:r.clickableInfo=i,r},t.computeParsableState=function(e){return{type:"simulation",id:e.id,clickableInfo:e.clickableInfo,fps:e.fps,guid:"",index:0}}});r("core/cl-calculator",["require","exports","core/graphing-calc/migrate-state","core/graphing-calc/json/expression","core/graphing-calc/json/table","core/graphing-calc/json/simulation"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLCalculator=void 0,t.CLCalculator=function(e){var t=r.migrateToLatest(e),a={},s=t.graph.degreeMode,u=t.randomSeed;function c(e){switch(e.type){case void 0:case"expression":var t=n.computeParsableState(n.inflateDefaults(e));a[t.id]=t;break;case"table":var r=i.computeParsableState(i.inflateDefaults(e));a[r.id]=r;break;case"simulation":var s=o.computeParsableState(o.inflateDefaults(e));a[s.id]=s;break;case"folder":case"text":case"image":break;default:return e}}for(var l=0,p=t.expressions.list;l<p.length;l++){c(p[l])}return{setExpression:function(e){c(e)},getChangeSet:function(){return{statements:a,isCompleteState:!0,degreeMode:s,globalRandomSeed:u}}}}});r("core/math/tree-queries/count-numbers",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countNumbers=void 0,t.countNumbers=function e(t,r){switch(t.type){case"Mul":case"Div":case"Prime":case"Call":case"ImplicitCall":case"Dot":case"Pipes":case"Sqrt":case"Nthroot":case"Frac":case"Derivative":case"Integral":case"EmptyIntegral":case"Sum":case"Product":case"Piecewise":case"Paren":case"Juxt":case"Superscript":case"Bang":case"Index":case"Equals":case"Inequality":case"Tilde":case"Pos":case"Neg":case"Add":case"Sub":case"List":case"Seq":case"Colon":case"Ellipsis":case"PercentOf":for(var n=0,i=0,o=t.args;i<o.length;i++)n+=e(o[i],r);return n;case"Decimal":return void 0===r||parseFloat(t.val)===r?1:0;case"MixedNumber":return void 0===r?3:(n=0,parseFloat(t.whole)===r&&(n+=1),parseFloat(t.num)===r&&(n+=1),parseFloat(t.den)===r&&(n+=1),n);case"Letter":case"EmptyPiecewise":case"Cmd":case"EmptyRangeEnd":return 0;case"Subscript":return e(t.args[0],r);case"InequalityChain":n=0,n+=e(t.first,r);for(var a=0,s=t.chain;a<s.length;a++)n+=e(s[a].args[0],r);return n;default:throw"Unexpected surface node "+t.type+"."}}});r("core/graphing-calc/diffs/longest-subsequence",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findLongestSubsequence=void 0,t.findLongestSubsequence=function(e){for(var t=e.length,r=new Array(t),n=new Array(t+1),i=0,o=0;o<t;o++){var a=void 0;if(e[n[i]]<e[o])a=i+1;else{for(var s=1,u=i-1;s<=u;){var c=Math.ceil((s+u)/2);e[n[c]]<e[o]?s=c+1:u=c-1}a=s}r[o]=n[a-1],n[a]=o,i<a&&(i=a)}for(var l=new Array(i),p=n[i],o=i-1;0<=o;o--)l[o]=e[p],p=r[p];return l}});r("core/graphing-calc/diffs/calculate-diff",["require","exports","underscore","./longest-subsequence"],function(e,t,r,n){"use strict";var i,o;function a(e,t,o){var u,c={};for(var l in e){e.hasOwnProperty(l)&&(t.hasOwnProperty(l)?(u=function(e,t,o,u){if(r.isArray(e)&&r.isArray(t)){if(o===i.EXPRESSIONS&&"list"===u||o===i.TABLE_EXPRESSION&&"columns"===u)return function(e,t){for(var o={},u={},c=0;c<e.length;c++){if(void 0!==u[e[c].id])return{s:t};u[e[c].id]=c}for(var l={},c=0;c<t.length;c++){if(void 0!==l[t[c].id])return{s:t};l[t[c].id]=c}for(var p=function(e,t,r){for(var i={},o=t.filter(function(e){return void 0!==r[e.id]}).map(function(e){return r[e.id]}),a=n.findLongestSubsequence(o),s=0,u=a;s<u.length;s++){var c=u[s];i[e[c].id]=!0}return i}(e,t,u),f=0,d=0;d<e.length;d++){var h,m,y,g,v=e[d];p[v.id]?(h=l[v.id],m=t[h],y={},f!==h&&(y.a=t.slice(f,h).map(function(t){return s(e,u,t)})),r.isEqual(v,m)||(g="table"===v.type&&"table"===m.type,y.e=a(v,m,g?i.TABLE_EXPRESSION:i.OTHER)),r.isEmpty(y)||(o[d]=y),f=h+1):o[d]={d:1}}f<t.length&&(o[e.length]={a:t.slice(f,t.length).map(function(t){return s(e,u,t)})});if(r.isEmpty(o))return;return{l:o}}(e,t);if(!r.isEqual(e,t))return{s:t}}else if(r.isObject(e)&&r.isObject(t)){var c=a(e,t,function(e,t){return e===i.ROOT&&"expressions"===t?i.EXPRESSIONS:i.OTHER}(o,u));if(!r.isEmpty(c))return{e:c}}else if(!r.isEqual(e,t))return{s:t};return}(e[l],t[l],o,l))&&(c[l]=u):c[l]={d:1})}for(var l in t)t.hasOwnProperty(l)&&!e.hasOwnProperty(l)&&(c[l]={s:t[l]});return c}function s(e,t,n){if(t[n.id]){var o=e[t[n.id]],s={f:t[n.id]};return r.isEqual(o,n)||(s.e=a(o,n,i.OTHER)),{m:s}}return{s:n}}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateDiff=void 0,(o=i=i||{})[o.ROOT=0]="ROOT",o[o.EXPRESSIONS=1]="EXPRESSIONS",o[o.TABLE_EXPRESSION=2]="TABLE_EXPRESSION",o[o.OTHER=3]="OTHER",t.calculateDiff=function(e,t){return a(e,t,i.ROOT)}});r("core/graphing-calc/diffs/apply-diff",["require","exports","underscore","../../lib/deepCopy"],function(e,t,r,n){"use strict";function i(e,t){for(var n=0,a=r.keys(t);n<a.length;n++){var s=a[n],u=t[s];u.hasOwnProperty("s")?e[s]=u.s:u.hasOwnProperty("d")?delete e[s]:u.hasOwnProperty("l")?e[s]=function(e,t){for(var r=[],n=0;n<e.length;n++){var a=t[n];a&&a.a&&r.push.apply(r,o(e,a.a)),a&&a.e?r.push(i(e[n],a.e)):a&&a.d||r.push(e[n])}var s=t[e.length];s&&s.a&&r.push.apply(r,o(e,s.a));return r}(e[s],u.l):u.hasOwnProperty("e")&&(e[s]=i(e[s],u.e))}return e}function o(e,t){for(var r=[],n=0,o=t;n<o.length;n++){var a,s=o[n];s.hasOwnProperty("s")?r.push(s.s):s.hasOwnProperty("m")&&(a=e[s.m.f],s.m.e?r.push(i(a,s.m.e)):r.push(a))}return r}Object.defineProperty(t,"__esModule",{value:!0}),t.applyDiff=void 0,t.applyDiff=function(e,t){return i(n.default(e),t)}});r("core/mathtools",["require","exports","parser","core/math/builtinframe","core/math/types","parsenodes","core/math/context","core/cl-calculator","core/math/parser/latex-parser","core/math/parser/expression-parser","core/math/tree-queries/count-numbers","core/lib/color-helpers","core/math/policyGraphing","core/math/policyScientific","core/math/policyFourFunction","core/lib/label","core/graphing-calc/diffs/calculate-diff","core/graphing-calc/diffs/apply-diff","core/graphing-calc/migrate-state"],function(e,t,r,n,i,o,a,s,u,c,l,p,f,d,h,m,y,g,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.migrateToLatest=t.applyDiff=t.calculateDiff=t.CLCalculator=t.colorHelpers=t.policies=t.parseNodes=t.types=t.builtInFrame=t.context=t.treeQueries=t.expressionParser=t.parser=t.Label=void 0,Object.defineProperty(t,"CLCalculator",{enumerable:!0,get:function(){return s.CLCalculator}}),t.colorHelpers=p,t.Label=m,Object.defineProperty(t,"calculateDiff",{enumerable:!0,get:function(){return y.calculateDiff}}),Object.defineProperty(t,"applyDiff",{enumerable:!0,get:function(){return g.applyDiff}}),Object.defineProperty(t,"migrateToLatest",{enumerable:!0,get:function(){return v.migrateToLatest}}),t.parser={parse:function(e,t){return null==e&&(e=""),r.parse(e,t)}},t.expressionParser={parse:function(e){if(null!=e)return c.parse(u.parse(e))}},t.treeQueries={countNumbers:l.countNumbers},t.context=a.Context,t.builtInFrame=n,t.types=i,t.parseNodes=o,t.policies={graphing:f.PolicyGraphing,scientific:d.PolicyScientific,fourFunction:h.PolicyFourFunction}});return t("core/mathtools")});define("core/components/shared/calculator-state-helpers",["require","exports","core/lib/mathtools"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function n(e){var t=[];var n=r.migrateToLatest(e);var i=n.expressions.list||[];for(var o=0,a=i;o<a.length;o++){var s=a[o];if(s&&s.type==="image"&&!!s.image_url){t.push(s.image_url)}}return t}t.getGraphAssetUrls=n});define("core/components/cardsort/index",["require","exports","./group-tools","../shared/calculator-state-helpers"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(e){var t=e.config.answerKey;if(t){if(e.response&&e.response.groupIds){return r.responseMatchesKey(e.response,t)?"correct":"incorrect"}else{return"incomplete"}}else{return"ungraded"}},getComponentState:function(e){var t=e.response,r=e.config;var n=t&&t.groupIds||[];var i=t&&t.groups||{};return{groupIds:n,groups:i,answerKey:r.answerKey}},hasResponse:function(e){return!!e&&!!e.groupIds},getAssetUrls:function(e){var t=[];for(var r=0,i=Object.keys(e.cards);r<i.length;r++){var o=i[r];var a=e.cards[o];if(a.type==="image"&&a.img){t.push(a.img)}else if(a.type==="graph"){if(a.img){t.push(a.img)}if(a.calculatorState){t.push.apply(t,n.getGraphAssetUrls(a.calculatorState))}}}return t}}});define("core/components/image-exhibit/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(){return false},getAssetUrls:function(e){if(e.img){return[e.img]}return[]}}});define("core/prosemirror/prosemirror-helpers",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.splitOnRegex=function(e,t){var r=[];var n=0;var i;while(i=t.exec(e)){var o=i.index;var a=o+i[0].length;if(o>n){r.push({matched:false,text:e.substr(n,o-n),start:n,end:o})}r.push({matched:true,text:e.substr(o,a-o),start:o,end:a});n=a}if(n<e.length){r.push({matched:false,text:e.substr(n),start:n,end:e.length})}return r};function r(e){var t=-1;var r=e.content.size;var n="\n\n";var i="";var o=true;e.content.descendants(function(e,a){if(e.isText){i+=e.text.slice(Math.max(t,a)-a,r-a)}else{switch(e.type.name){case"paragraph":if(!o){i+=n}o=false;break;case"mq":case"interp":i+=e.type.spec.toDOM(e).toString();return false}}return true});return i}t.clipboardTextSerializer=r});define("orderedmap",["require","exports","module"],function(e,t,r){function n(e){this.content=e}n.prototype={constructor:n,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return t==-1?undefined:this.content[t+1]},update:function(e,t,r){var i=r&&r!=e?this.remove(r):this;var o=i.find(e),a=i.content.slice();if(o==-1){a.push(r||e,t)}else{a[o+1]=t;if(r)a[o]=r}return new n(a)},remove:function(e){var t=this.find(e);if(t==-1)return this;var r=this.content.slice();r.splice(t,2);return new n(r)},addToStart:function(e,t){return new n([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var r=this.remove(e).content.slice();r.push(e,t);return new n(r)},addBefore:function(e,t,r){var i=this.remove(t),o=i.content.slice();var a=i.find(e);o.splice(a==-1?o.length:a,0,t,r);return new n(o)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){e=n.from(e);if(!e.size)return this;return new n(e.content.concat(this.subtract(e).content))},append:function(e){e=n.from(e);if(!e.size)return this;return new n(this.subtract(e).content.concat(e.content))},subtract:function(e){var t=this;e=n.from(e);for(var r=0;r<e.content.length;r+=2)t=t.remove(e.content[r]);return t},get size(){return this.content.length>>1}};n.from=function(e){if(e instanceof n)return e;var t=[];if(e)for(var r in e)t.push(r,e[r]);return new n(t)};r.exports=n});define("prosemirror-model/index",["require","exports","module","orderedmap"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function n(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var i=n(e("orderedmap"));function o(e,t,r){for(var n=0;;n++){if(n==e.childCount||n==t.childCount){return e.childCount==t.childCount?null:r}var i=e.child(n),a=t.child(n);if(i==a){r+=i.nodeSize;continue}if(!i.sameMarkup(a)){return r}if(i.isText&&i.text!=a.text){for(var s=0;i.text[s]==a.text[s];s++){r++}return r}if(i.content.size||a.content.size){var u=o(i.content,a.content,r+1);if(u!=null){return u}}r+=i.nodeSize}}function a(e,t,r,n){for(var i=e.childCount,o=t.childCount;;){if(i==0||o==0){return i==o?null:{a:r,b:n}}var s=e.child(--i),u=t.child(--o),c=s.nodeSize;if(s==u){r-=c;n-=c;continue}if(!s.sameMarkup(u)){return{a:r,b:n}}if(s.isText&&s.text!=u.text){var l=0,p=Math.min(s.text.length,u.text.length);while(l<p&&s.text[s.text.length-l-1]==u.text[u.text.length-l-1]){l++;r--;n--}return{a:r,b:n}}if(s.content.size||u.content.size){var f=a(s.content,u.content,r-1,n-1);if(f){return f}}r-=c;n-=c}}var s=function e(t,r){this.content=t;this.size=r||0;if(r==null){for(var n=0;n<t.length;n++){this.size+=t[n].nodeSize}}};var u={firstChild:{configurable:true},lastChild:{configurable:true},childCount:{configurable:true}};s.prototype.nodesBetween=function e(t,r,n,i,o){if(i===void 0)i=0;for(var a=0,s=0;s<r;a++){var u=this.content[a],c=s+u.nodeSize;if(c>t&&n(u,i+s,o,a)!==false&&u.content.size){var l=s+1;u.nodesBetween(Math.max(0,t-l),Math.min(u.content.size,r-l),n,i+l)}s=c}};s.prototype.descendants=function e(t){this.nodesBetween(0,this.size,t)};s.prototype.textBetween=function e(t,r,n,i){var o="",a=true;this.nodesBetween(t,r,function(e,s){if(e.isText){o+=e.text.slice(Math.max(t,s)-s,r-s);a=!n}else if(e.isLeaf&&i){o+=i;a=!n}else if(!a&&e.isBlock){o+=n;a=true}},0);return o};s.prototype.append=function e(t){if(!t.size){return this}if(!this.size){return t}var r=this.lastChild,n=t.firstChild,i=this.content.slice(),o=0;if(r.isText&&r.sameMarkup(n)){i[i.length-1]=r.withText(r.text+n.text);o=1}for(;o<t.content.length;o++){i.push(t.content[o])}return new s(i,this.size+t.size)};s.prototype.cut=function e(t,r){if(r==null){r=this.size}if(t==0&&r==this.size){return this}var n=[],i=0;if(r>t){for(var o=0,a=0;a<r;o++){var u=this.content[o],c=a+u.nodeSize;if(c>t){if(a<t||c>r){if(u.isText){u=u.cut(Math.max(0,t-a),Math.min(u.text.length,r-a))}else{u=u.cut(Math.max(0,t-a-1),Math.min(u.content.size,r-a-1))}}n.push(u);i+=u.nodeSize}a=c}}return new s(n,i)};s.prototype.cutByIndex=function e(t,r){if(t==r){return s.empty}if(t==0&&r==this.content.length){return this}return new s(this.content.slice(t,r))};s.prototype.replaceChild=function e(t,r){var n=this.content[t];if(n==r){return this}var i=this.content.slice();var o=this.size+r.nodeSize-n.nodeSize;i[t]=r;return new s(i,o)};s.prototype.addToStart=function e(t){return new s([t].concat(this.content),this.size+t.nodeSize)};s.prototype.addToEnd=function e(t){return new s(this.content.concat(t),this.size+t.nodeSize)};s.prototype.eq=function e(t){if(this.content.length!=t.content.length){return false}for(var r=0;r<this.content.length;r++){if(!this.content[r].eq(t.content[r])){return false}}return true};u.firstChild.get=function(){return this.content.length?this.content[0]:null};u.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};u.childCount.get=function(){return this.content.length};s.prototype.child=function e(t){var r=this.content[t];if(!r){throw new RangeError("Index "+t+" out of range for "+this)}return r};s.prototype.maybeChild=function e(t){return this.content[t]};s.prototype.forEach=function e(t){for(var r=0,n=0;r<this.content.length;r++){var i=this.content[r];t(i,n,r);n+=i.nodeSize}};s.prototype.findDiffStart=function e(t,r){if(r===void 0)r=0;return o(this,t,r)};s.prototype.findDiffEnd=function e(t,r,n){if(r===void 0)r=this.size;if(n===void 0)n=t.size;return a(this,t,r,n)};s.prototype.findIndex=function e(t,r){if(r===void 0)r=-1;if(t==0){return l(0,t)}if(t==this.size){return l(this.content.length,t)}if(t>this.size||t<0){throw new RangeError("Position "+t+" outside of fragment ("+this+")")}for(var n=0,i=0;;n++){var o=this.child(n),a=i+o.nodeSize;if(a>=t){if(a==t||r>0){return l(n+1,a)}return l(n,i)}i=a}};s.prototype.toString=function e(){return"<"+this.toStringInner()+">"};s.prototype.toStringInner=function e(){return this.content.join(", ")};s.prototype.toJSON=function e(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null};s.fromJSON=function e(t,r){if(!r){return s.empty}if(!Array.isArray(r)){throw new RangeError("Invalid input for Fragment.fromJSON")}return new s(r.map(t.nodeFromJSON))};s.fromArray=function e(t){if(!t.length){return s.empty}var r,n=0;for(var i=0;i<t.length;i++){var o=t[i];n+=o.nodeSize;if(i&&o.isText&&t[i-1].sameMarkup(o)){if(!r){r=t.slice(0,i)}r[r.length-1]=o.withText(r[r.length-1].text+o.text)}else if(r){r.push(o)}}return new s(r||t,n)};s.from=function e(t){if(!t){return s.empty}if(t instanceof s){return t}if(Array.isArray(t)){return this.fromArray(t)}if(t.attrs){return new s([t],t.nodeSize)}throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(s.prototype,u);var c={index:0,offset:0};function l(e,t){c.index=e;c.offset=t;return c}s.empty=new s([],0);function p(e,t){if(e===t){return true}if(!(e&&typeof e=="object")||!(t&&typeof t=="object")){return false}var r=Array.isArray(e);if(Array.isArray(t)!=r){return false}if(r){if(e.length!=t.length){return false}for(var n=0;n<e.length;n++){if(!p(e[n],t[n])){return false}}}else{for(var i in e){if(!(i in t)||!p(e[i],t[i])){return false}}for(var o in t){if(!(o in e)){return false}}}return true}var f=function e(t,r){this.type=t;this.attrs=r};f.prototype.addToSet=function e(t){var r,n=false;for(var i=0;i<t.length;i++){var o=t[i];if(this.eq(o)){return t}if(this.type.excludes(o.type)){if(!r){r=t.slice(0,i)}}else if(o.type.excludes(this.type)){return t}else{if(!n&&o.type.rank>this.type.rank){if(!r){r=t.slice(0,i)}r.push(this);n=true}if(r){r.push(o)}}}if(!r){r=t.slice()}if(!n){r.push(this)}return r};f.prototype.removeFromSet=function e(t){for(var r=0;r<t.length;r++){if(this.eq(t[r])){return t.slice(0,r).concat(t.slice(r+1))}}return t};f.prototype.isInSet=function e(t){for(var r=0;r<t.length;r++){if(this.eq(t[r])){return true}}return false};f.prototype.eq=function e(t){return this==t||this.type==t.type&&p(this.attrs,t.attrs)};f.prototype.toJSON=function e(){var t={type:this.type.name};for(var r in this.attrs){t.attrs=this.attrs;break}return t};f.fromJSON=function e(t,r){if(!r){throw new RangeError("Invalid input for Mark.fromJSON")}var n=t.marks[r.type];if(!n){throw new RangeError("There is no mark type "+r.type+" in this schema")}return n.create(r.attrs)};f.sameSet=function e(t,r){if(t==r){return true}if(t.length!=r.length){return false}for(var n=0;n<t.length;n++){if(!t[n].eq(r[n])){return false}}return true};f.setFrom=function e(t){if(!t||t.length==0){return f.none}if(t instanceof f){return[t]}var r=t.slice();r.sort(function(e,t){return e.type.rank-t.type.rank});return r};f.none=[];function d(e){var t=Error.call(this,e);t.__proto__=d.prototype;return t}d.prototype=Object.create(Error.prototype);d.prototype.constructor=d;d.prototype.name="ReplaceError";var h=function e(t,r,n){this.content=t;this.openStart=r;this.openEnd=n};var m={size:{configurable:true}};m.size.get=function(){return this.content.size-this.openStart-this.openEnd};h.prototype.insertAt=function e(t,r){var n=g(this.content,t+this.openStart,r,null);return n&&new h(n,this.openStart,this.openEnd)};h.prototype.removeBetween=function e(t,r){return new h(y(this.content,t+this.openStart,r+this.openStart),this.openStart,this.openEnd)};h.prototype.eq=function e(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd};h.prototype.toString=function e(){return this.content+"("+this.openStart+","+this.openEnd+")"};h.prototype.toJSON=function e(){if(!this.content.size){return null}var t={content:this.content.toJSON()};if(this.openStart>0){t.openStart=this.openStart}if(this.openEnd>0){t.openEnd=this.openEnd}return t};h.fromJSON=function e(t,r){if(!r){return h.empty}var n=r.openStart||0,i=r.openEnd||0;if(typeof n!="number"||typeof i!="number"){throw new RangeError("Invalid input for Slice.fromJSON")}return new h(s.fromJSON(t,r.content),r.openStart||0,r.openEnd||0)};h.maxOpen=function e(t,r){if(r===void 0)r=true;var n=0,i=0;for(var o=t.firstChild;o&&!o.isLeaf&&(r||!o.type.spec.isolating);o=o.firstChild){n++}for(var a=t.lastChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.lastChild){i++}return new h(t,n,i)};Object.defineProperties(h.prototype,m);function y(e,t,r){var n=e.findIndex(t);var i=n.index;var o=n.offset;var a=e.maybeChild(i);var s=e.findIndex(r);var u=s.index;var c=s.offset;if(o==t||a.isText){if(c!=r&&!e.child(u).isText){throw new RangeError("Removing non-flat range")}return e.cut(0,t).append(e.cut(r))}if(i!=u){throw new RangeError("Removing non-flat range")}return e.replaceChild(i,a.copy(y(a.content,t-o-1,r-o-1)))}function g(e,t,r,n){var i=e.findIndex(t);var o=i.index;var a=i.offset;var s=e.maybeChild(o);if(a==t||s.isText){if(n&&!n.canReplace(o,o,r)){return null}return e.cut(0,t).append(r).append(e.cut(t))}var u=g(s.content,t-a-1,r);return u&&e.replaceChild(o,s.copy(u))}h.empty=new h(s.empty,0,0);function v(e,t,r){if(r.openStart>e.depth){throw new d("Inserted content deeper than insertion position")}if(e.depth-r.openStart!=t.depth-r.openEnd){throw new d("Inconsistent open depths")}return b(e,t,r,0)}function b(e,t,r,n){var i=e.index(n),o=e.node(n);if(i==t.index(n)&&n<e.depth-r.openStart){var a=b(e,t,r,n+1);return o.copy(o.content.replaceChild(i,a))}else if(!r.content.size){return w(o,M(e,t,n))}else if(!r.openStart&&!r.openEnd&&e.depth==n&&t.depth==n){var s=e.parent,u=s.content;return w(s,u.cut(0,e.parentOffset).append(r.content).append(u.cut(t.parentOffset)))}else{var c=C(r,e);var l=c.start;var p=c.end;return w(o,E(e,l,p,t,n))}}function x(e,t){if(!t.type.compatibleContent(e.type)){throw new d("Cannot join "+t.type.name+" onto "+e.type.name)}}function _(e,t,r){var n=e.node(r);x(n,t.node(r));return n}function S(e,t){var r=t.length-1;if(r>=0&&e.isText&&e.sameMarkup(t[r])){t[r]=e.withText(t[r].text+e.text)}else{t.push(e)}}function T(e,t,r,n){var i=(t||e).node(r);var o=0,a=t?t.index(r):i.childCount;if(e){o=e.index(r);if(e.depth>r){o++}else if(e.textOffset){S(e.nodeAfter,n);o++}}for(var s=o;s<a;s++){S(i.child(s),n)}if(t&&t.depth==r&&t.textOffset){S(t.nodeBefore,n)}}function w(e,t){if(!e.type.validContent(t)){throw new d("Invalid content for node "+e.type.name)}return e.copy(t)}function E(e,t,r,n,i){var o=e.depth>i&&_(e,t,i+1);var a=n.depth>i&&_(r,n,i+1);var u=[];T(null,e,i,u);if(o&&a&&t.index(i)==r.index(i)){x(o,a);S(w(o,E(e,t,r,n,i+1)),u)}else{if(o){S(w(o,M(e,t,i+1)),u)}T(t,r,i,u);if(a){S(w(a,M(r,n,i+1)),u)}}T(n,null,i,u);return new s(u)}function M(e,t,r){var n=[];T(null,e,r,n);if(e.depth>r){var i=_(e,t,r+1);S(w(i,M(e,t,r+1)),n)}T(t,null,r,n);return new s(n)}function C(e,t){var r=t.depth-e.openStart,n=t.node(r);var i=n.copy(e.content);for(var o=r-1;o>=0;o--){i=t.node(o).copy(s.from(i))}return{start:i.resolveNoCache(e.openStart+r),end:i.resolveNoCache(i.content.size-e.openEnd-r)}}var I=function e(t,r,n){this.pos=t;this.path=r;this.depth=r.length/3-1;this.parentOffset=n};var P={parent:{configurable:true},doc:{configurable:true},textOffset:{configurable:true},nodeAfter:{configurable:true},nodeBefore:{configurable:true}};I.prototype.resolveDepth=function e(t){if(t==null){return this.depth}if(t<0){return this.depth+t}return t};P.parent.get=function(){return this.node(this.depth)};P.doc.get=function(){return this.node(0)};I.prototype.node=function e(t){return this.path[this.resolveDepth(t)*3]};I.prototype.index=function e(t){return this.path[this.resolveDepth(t)*3+1]};I.prototype.indexAfter=function e(t){t=this.resolveDepth(t);return this.index(t)+(t==this.depth&&!this.textOffset?0:1)};I.prototype.start=function e(t){t=this.resolveDepth(t);return t==0?0:this.path[t*3-1]+1};I.prototype.end=function e(t){t=this.resolveDepth(t);return this.start(t)+this.node(t).content.size};I.prototype.before=function e(t){t=this.resolveDepth(t);if(!t){throw new RangeError("There is no position before the top-level node")}return t==this.depth+1?this.pos:this.path[t*3-1]};I.prototype.after=function e(t){t=this.resolveDepth(t);if(!t){throw new RangeError("There is no position after the top-level node")}return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize};P.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};P.nodeAfter.get=function(){var e=this.parent,t=this.index(this.depth);if(t==e.childCount){return null}var r=this.pos-this.path[this.path.length-1],n=e.child(t);return r?e.child(t).cut(r):n};P.nodeBefore.get=function(){var e=this.index(this.depth);var t=this.pos-this.path[this.path.length-1];if(t){return this.parent.child(e).cut(0,t)}return e==0?null:this.parent.child(e-1)};I.prototype.marks=function e(){var t=this.parent,r=this.index();if(t.content.size==0){return f.none}if(this.textOffset){return t.child(r).marks}var n=t.maybeChild(r-1),i=t.maybeChild(r);if(!n){var o=n;n=i;i=o}var e=n.marks;for(var a=0;a<e.length;a++){if(e[a].type.spec.inclusive===false&&(!i||!e[a].isInSet(i.marks))){e=e[a--].removeFromSet(e)}}return e};I.prototype.marksAcross=function e(t){var r=this.parent.maybeChild(this.index());if(!r||!r.isInline){return null}var n=r.marks,i=t.parent.maybeChild(t.index());for(var o=0;o<n.length;o++){if(n[o].type.spec.inclusive===false&&(!i||!n[o].isInSet(i.marks))){n=n[o--].removeFromSet(n)}}return n};I.prototype.sharedDepth=function e(t){for(var r=this.depth;r>0;r--){if(this.start(r)<=t&&this.end(r)>=t){return r}}return 0};I.prototype.blockRange=function e(t,r){if(t===void 0)t=this;if(t.pos<this.pos){return t.blockRange(this)}for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--){if(t.pos<=this.end(n)&&(!r||r(this.node(n)))){return new N(this,t,n)}}};I.prototype.sameParent=function e(t){return this.pos-this.parentOffset==t.pos-t.parentOffset};I.prototype.max=function e(t){return t.pos>this.pos?t:this};I.prototype.min=function e(t){return t.pos<this.pos?t:this};I.prototype.toString=function e(){var t="";for(var r=1;r<=this.depth;r++){t+=(t?"/":"")+this.node(r).type.name+"_"+this.index(r-1)}return t+":"+this.parentOffset};I.resolve=function e(t,r){if(!(r>=0&&r<=t.content.size)){throw new RangeError("Position "+r+" out of range")}var n=[];var i=0,o=r;for(var a=t;;){var s=a.content.findIndex(o);var u=s.index;var c=s.offset;var l=o-c;n.push(a,u,i+c);if(!l){break}a=a.child(u);if(a.isText){break}o=l-1;i+=c+1}return new I(r,n,o)};I.resolveCached=function e(t,r){for(var n=0;n<k.length;n++){var i=k[n];if(i.pos==r&&i.doc==t){return i}}var o=k[O]=I.resolve(t,r);O=(O+1)%D;return o};Object.defineProperties(I.prototype,P);var k=[],O=0,D=12;var N=function e(t,r,n){this.$from=t;this.$to=r;this.depth=n};var A={start:{configurable:true},end:{configurable:true},parent:{configurable:true},startIndex:{configurable:true},endIndex:{configurable:true}};A.start.get=function(){return this.$from.before(this.depth+1)};A.end.get=function(){return this.$to.after(this.depth+1)};A.parent.get=function(){return this.$from.node(this.depth)};A.startIndex.get=function(){return this.$from.index(this.depth)};A.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(N.prototype,A);var L=Object.create(null);var F=function e(t,r,n,i){this.type=t;this.attrs=r;this.content=n||s.empty;this.marks=i||f.none};var R={nodeSize:{configurable:true},childCount:{configurable:true},textContent:{configurable:true},firstChild:{configurable:true},lastChild:{configurable:true},isBlock:{configurable:true},isTextblock:{configurable:true},inlineContent:{configurable:true},isInline:{configurable:true},isText:{configurable:true},isLeaf:{configurable:true},isAtom:{configurable:true}};R.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};R.childCount.get=function(){return this.content.childCount};F.prototype.child=function e(t){return this.content.child(t)};F.prototype.maybeChild=function e(t){return this.content.maybeChild(t)};F.prototype.forEach=function e(t){this.content.forEach(t)};F.prototype.nodesBetween=function e(t,r,n,i){if(i===void 0)i=0;this.content.nodesBetween(t,r,n,i,this)};F.prototype.descendants=function e(t){this.nodesBetween(0,this.content.size,t)};R.textContent.get=function(){return this.textBetween(0,this.content.size,"")};F.prototype.textBetween=function e(t,r,n,i){return this.content.textBetween(t,r,n,i)};R.firstChild.get=function(){return this.content.firstChild};R.lastChild.get=function(){return this.content.lastChild};F.prototype.eq=function e(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)};F.prototype.sameMarkup=function e(t){return this.hasMarkup(t.type,t.attrs,t.marks)};F.prototype.hasMarkup=function e(t,r,n){return this.type==t&&p(this.attrs,r||t.defaultAttrs||L)&&f.sameSet(this.marks,n||f.none)};F.prototype.copy=function e(t){if(t===void 0)t=null;if(t==this.content){return this}return new this.constructor(this.type,this.attrs,t,this.marks)};F.prototype.mark=function e(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)};F.prototype.cut=function e(t,r){if(t==0&&r==this.content.size){return this}return this.copy(this.content.cut(t,r))};F.prototype.slice=function e(t,r,n){if(r===void 0)r=this.content.size;if(n===void 0)n=false;if(t==r){return h.empty}var i=this.resolve(t),o=this.resolve(r);var a=n?0:i.sharedDepth(r);var s=i.start(a),u=i.node(a);var c=u.content.cut(i.pos-s,o.pos-s);return new h(c,i.depth-a,o.depth-a)};F.prototype.replace=function e(t,r,n){return v(this.resolve(t),this.resolve(r),n)};F.prototype.nodeAt=function e(t){for(var r=this;;){var n=r.content.findIndex(t);var i=n.index;var o=n.offset;r=r.maybeChild(i);if(!r){return null}if(o==t||r.isText){return r}t-=o+1}};F.prototype.childAfter=function e(t){var r=this.content.findIndex(t);var n=r.index;var i=r.offset;return{node:this.content.maybeChild(n),index:n,offset:i}};F.prototype.childBefore=function e(t){if(t==0){return{node:null,index:0,offset:0}}var r=this.content.findIndex(t);var n=r.index;var i=r.offset;if(i<t){return{node:this.content.child(n),index:n,offset:i}}var o=this.content.child(n-1);return{node:o,index:n-1,offset:i-o.nodeSize}};F.prototype.resolve=function e(t){return I.resolveCached(this,t)};F.prototype.resolveNoCache=function e(t){return I.resolve(this,t)};F.prototype.rangeHasMark=function e(t,r,n){var i=false;if(r>t){this.nodesBetween(t,r,function(e){if(n.isInSet(e.marks)){i=true}return!i})}return i};R.isBlock.get=function(){return this.type.isBlock};R.isTextblock.get=function(){return this.type.isTextblock};R.inlineContent.get=function(){return this.type.inlineContent};R.isInline.get=function(){return this.type.isInline};R.isText.get=function(){return this.type.isText};R.isLeaf.get=function(){return this.type.isLeaf};R.isAtom.get=function(){return this.type.isAtom};F.prototype.toString=function e(){if(this.type.spec.toDebugString){return this.type.spec.toDebugString(this)}var t=this.type.name;if(this.content.size){t+="("+this.content.toStringInner()+")"}return V(this.marks,t)};F.prototype.contentMatchAt=function e(t){var r=this.type.contentMatch.matchFragment(this.content,0,t);if(!r){throw new Error("Called contentMatchAt on a node with invalid content")}return r};F.prototype.canReplace=function e(t,r,n,i,o){if(n===void 0)n=s.empty;if(i===void 0)i=0;if(o===void 0)o=n.childCount;var a=this.contentMatchAt(t).matchFragment(n,i,o);var u=a&&a.matchFragment(this.content,r);if(!u||!u.validEnd){return false}for(var c=i;c<o;c++){if(!this.type.allowsMarks(n.child(c).marks)){return false}}return true};F.prototype.canReplaceWith=function e(t,r,n,i){if(i&&!this.type.allowsMarks(i)){return false}var o=this.contentMatchAt(t).matchType(n);var a=o&&o.matchFragment(this.content,r);return a?a.validEnd:false};F.prototype.canAppend=function e(t){if(t.content.size){return this.canReplace(this.childCount,this.childCount,t.content)}else{return this.type.compatibleContent(t.type)}};F.prototype.check=function e(){if(!this.type.validContent(this.content)){throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50))}this.content.forEach(function(e){return e.check()})};F.prototype.toJSON=function e(){var t={type:this.type.name};for(var r in this.attrs){t.attrs=this.attrs;break}if(this.content.size){t.content=this.content.toJSON()}if(this.marks.length){t.marks=this.marks.map(function(e){return e.toJSON()})}return t};F.fromJSON=function e(t,r){if(!r){throw new RangeError("Invalid input for Node.fromJSON")}var n=null;if(r.marks){if(!Array.isArray(r.marks)){throw new RangeError("Invalid mark data for Node.fromJSON")}n=r.marks.map(t.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string"){throw new RangeError("Invalid text node in JSON")}return t.text(r.text,n)}var i=s.fromJSON(t,r.content);return t.nodeType(r.type).create(r.attrs,i,n)};Object.defineProperties(F.prototype,R);var q=function(e){function t(t,r,n,i){e.call(this,t,r,null,i);if(!n){throw new RangeError("Empty text nodes are not allowed")}this.text=n}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={textContent:{configurable:true},nodeSize:{configurable:true}};t.prototype.toString=function e(){if(this.type.spec.toDebugString){return this.type.spec.toDebugString(this)}return V(this.marks,JSON.stringify(this.text))};r.textContent.get=function(){return this.text};t.prototype.textBetween=function e(t,r){return this.text.slice(t,r)};r.nodeSize.get=function(){return this.text.length};t.prototype.mark=function e(r){return r==this.marks?this:new t(this.type,this.attrs,this.text,r)};t.prototype.withText=function e(r){if(r==this.text){return this}return new t(this.type,this.attrs,r,this.marks)};t.prototype.cut=function e(t,r){if(t===void 0)t=0;if(r===void 0)r=this.text.length;if(t==0&&r==this.text.length){return this}return this.withText(this.text.slice(t,r))};t.prototype.eq=function e(t){return this.sameMarkup(t)&&this.text==t.text};t.prototype.toJSON=function t(){var r=e.prototype.toJSON.call(this);r.text=this.text;return r};Object.defineProperties(t.prototype,r);return t}(F);function V(e,t){for(var r=e.length-1;r>=0;r--){t=e[r].type.name+"("+t+")"}return t}var z=function e(t){this.validEnd=t;this.next=[];this.wrapCache=[]};var j={inlineContent:{configurable:true},defaultType:{configurable:true},edgeCount:{configurable:true}};z.parse=function e(t,r){var n=new B(t,r);if(n.next==null){return z.empty}var i=G(n);if(n.next){n.err("Unexpected trailing text")}var o=ee(X(i));te(o,n);return o};z.prototype.matchType=function e(t){for(var r=0;r<this.next.length;r+=2){if(this.next[r]==t){return this.next[r+1]}}return null};z.prototype.matchFragment=function e(t,r,n){if(r===void 0)r=0;if(n===void 0)n=t.childCount;var i=this;for(var o=r;i&&o<n;o++){i=i.matchType(t.child(o).type)}return i};j.inlineContent.get=function(){var e=this.next[0];return e?e.isInline:false};j.defaultType.get=function(){for(var e=0;e<this.next.length;e+=2){var t=this.next[e];if(!(t.isText||t.hasRequiredAttrs())){return t}}};z.prototype.compatible=function e(t){for(var r=0;r<this.next.length;r+=2){for(var n=0;n<t.next.length;n+=2){if(this.next[r]==t.next[n]){return true}}}return false};z.prototype.fillBefore=function e(t,r,n){if(r===void 0)r=false;if(n===void 0)n=0;var i=[this];function o(e,a){var u=e.matchFragment(t,n);if(u&&(!r||u.validEnd)){return s.from(a.map(function(e){return e.createAndFill()}))}for(var c=0;c<e.next.length;c+=2){var l=e.next[c],p=e.next[c+1];if(!(l.isText||l.hasRequiredAttrs())&&i.indexOf(p)==-1){i.push(p);var f=o(p,a.concat(l));if(f){return f}}}}return o(this,[])};z.prototype.findWrapping=function e(t){for(var r=0;r<this.wrapCache.length;r+=2){if(this.wrapCache[r]==t){return this.wrapCache[r+1]}}var n=this.computeWrapping(t);this.wrapCache.push(t,n);return n};z.prototype.computeWrapping=function e(t){var r=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var i=n.shift(),o=i.match;if(o.matchType(t)){var a=[];for(var s=i;s.type;s=s.via){a.push(s.type)}return a.reverse()}for(var u=0;u<o.next.length;u+=2){var c=o.next[u];if(!c.isLeaf&&!c.hasRequiredAttrs()&&!(c.name in r)&&(!i.type||o.next[u+1].validEnd)){n.push({match:c.contentMatch,type:c,via:i});r[c.name]=true}}}};j.edgeCount.get=function(){return this.next.length>>1};z.prototype.edge=function e(t){var r=t<<1;if(r>=this.next.length){throw new RangeError("There's no "+t+"th edge in this content match")}return{type:this.next[r],next:this.next[r+1]}};z.prototype.toString=function e(){var t=[];function r(e){t.push(e);for(var n=1;n<e.next.length;n+=2){if(t.indexOf(e.next[n])==-1){r(e.next[n])}}}r(this);return t.map(function(e,r){var n=r+(e.validEnd?"*":" ")+" ";for(var i=0;i<e.next.length;i+=2){n+=(i?", ":"")+e.next[i].name+"->"+t.indexOf(e.next[i+1])}return n}).join("\n")};Object.defineProperties(z.prototype,j);z.empty=new z(true);var B=function e(t,r){this.string=t;this.nodeTypes=r;this.inline=null;this.pos=0;this.tokens=t.split(/\s*(?=\b|\W|$)/);if(this.tokens[this.tokens.length-1]==""){this.tokens.pop()}if(this.tokens[0]==""){this.tokens.unshift()}};var U={next:{configurable:true}};U.next.get=function(){return this.tokens[this.pos]};B.prototype.eat=function e(t){return this.next==t&&(this.pos++||true)};B.prototype.err=function e(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")};Object.defineProperties(B.prototype,U);function G(e){var t=[];do{t.push(W(e))}while(e.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function W(e){var t=[];do{t.push(J(e))}while(e.next&&e.next!=")"&&e.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function J(e){var t=K(e);for(;;){if(e.eat("+")){t={type:"plus",expr:t}}else if(e.eat("*")){t={type:"star",expr:t}}else if(e.eat("?")){t={type:"opt",expr:t}}else if(e.eat("{")){t=$(e,t)}else{break}}return t}function H(e){if(/\D/.test(e.next)){e.err("Expected number, got '"+e.next+"'")}var t=Number(e.next);e.pos++;return t}function $(e,t){var r=H(e),n=r;if(e.eat(",")){if(e.next!="}"){n=H(e)}else{n=-1}}if(!e.eat("}")){e.err("Unclosed braced range")}return{type:"range",min:r,max:n,expr:t}}function Y(e,t){var r=e.nodeTypes,n=r[t];if(n){return[n]}var i=[];for(var o in r){var a=r[o];if(a.groups.indexOf(t)>-1){i.push(a)}}if(i.length==0){e.err("No node type or group '"+t+"' found")}return i}function K(e){if(e.eat("(")){var t=G(e);if(!e.eat(")")){e.err("Missing closing paren")}return t}else if(!/\W/.test(e.next)){var r=Y(e,e.next).map(function(t){if(e.inline==null){e.inline=t.isInline}else if(e.inline!=t.isInline){e.err("Mixing inline and block content")}return{type:"name",value:t}});e.pos++;return r.length==1?r[0]:{type:"choice",exprs:r}}else{e.err("Unexpected token '"+e.next+"'")}}function X(e){var t=[[]];i(o(e,0),r());return t;function r(){return t.push([])-1}function n(e,r,n){var i={term:n,to:r};t[e].push(i);return i}function i(e,t){e.forEach(function(e){return e.to=t})}function o(e,t){if(e.type=="choice"){return e.exprs.reduce(function(e,r){return e.concat(o(r,t))},[])}else if(e.type=="seq"){for(var a=0;;a++){var s=o(e.exprs[a],t);if(a==e.exprs.length-1){return s}i(s,t=r())}}else if(e.type=="star"){var u=r();n(t,u);i(o(e.expr,u),u);return[n(u)]}else if(e.type=="plus"){var c=r();i(o(e.expr,t),c);i(o(e.expr,c),c);return[n(c)]}else if(e.type=="opt"){return[n(t)].concat(o(e.expr,t))}else if(e.type=="range"){var l=t;for(var p=0;p<e.min;p++){var f=r();i(o(e.expr,l),f);l=f}if(e.max==-1){i(o(e.expr,l),l)}else{for(var d=e.min;d<e.max;d++){var h=r();n(l,h);i(o(e.expr,l),h);l=h}}return[n(l)]}else if(e.type=="name"){return[n(t,null,e.value)]}}}function Q(e,t){return t-e}function Z(e,t){var r=[];n(t);return r.sort(Q);function n(t){var i=e[t];if(i.length==1&&!i[0].term){return n(i[0].to)}r.push(t);for(var o=0;o<i.length;o++){var a=i[o];var s=a.term;var u=a.to;if(!s&&r.indexOf(u)==-1){n(u)}}}}function ee(e){var t=Object.create(null);return r(Z(e,0));function r(n){var i=[];n.forEach(function(t){e[t].forEach(function(t){var r=t.term;var n=t.to;if(!r){return}var o=i.indexOf(r),a=o>-1&&i[o+1];Z(e,n).forEach(function(e){if(!a){i.push(r,a=[])}if(a.indexOf(e)==-1){a.push(e)}})})});var o=t[n.join(",")]=new z(n.indexOf(e.length-1)>-1);for(var a=0;a<i.length;a+=2){var s=i[a+1].sort(Q);o.next.push(i[a],t[s.join(",")]||r(s))}return o}}function te(e,t){for(var r=0,n=[e];r<n.length;r++){var i=n[r],o=!i.validEnd,a=[];for(var s=0;s<i.next.length;s+=2){var u=i.next[s],c=i.next[s+1];a.push(u.name);if(o&&!(u.isText||u.hasRequiredAttrs())){o=false}if(n.indexOf(c)==-1){n.push(c)}}if(o){t.err("Only non-generatable nodes ("+a.join(", ")+") in a required position")}}}function re(e){var t=Object.create(null);for(var r in e){var n=e[r];if(!n.hasDefault){return null}t[r]=n.default}return t}function ne(e,t){var r=Object.create(null);for(var n in e){var i=t&&t[n];if(i===undefined){var o=e[n];if(o.hasDefault){i=o.default}else{throw new RangeError("No value supplied for attribute "+n)}}r[n]=i}return r}function ie(e){var t=Object.create(null);if(e){for(var r in e){t[r]=new se(e[r])}}return t}var oe=function e(t,r,n){this.name=t;this.schema=r;this.spec=n;this.groups=n.group?n.group.split(" "):[];this.attrs=ie(n.attrs);this.defaultAttrs=re(this.attrs);this.contentMatch=null;this.markSet=null;this.inlineContent=null;this.isBlock=!(n.inline||t=="text");this.isText=t=="text"};var ae={isInline:{configurable:true},isTextblock:{configurable:true},isLeaf:{configurable:true},isAtom:{configurable:true}};ae.isInline.get=function(){return!this.isBlock};ae.isTextblock.get=function(){return this.isBlock&&this.inlineContent};ae.isLeaf.get=function(){return this.contentMatch==z.empty};ae.isAtom.get=function(){return this.isLeaf||this.spec.atom};oe.prototype.hasRequiredAttrs=function e(){for(var t in this.attrs){if(this.attrs[t].isRequired){return true}}return false};oe.prototype.compatibleContent=function e(t){return this==t||this.contentMatch.compatible(t.contentMatch)};oe.prototype.computeAttrs=function e(t){if(!t&&this.defaultAttrs){return this.defaultAttrs}else{return ne(this.attrs,t)}};oe.prototype.create=function e(t,r,n){if(this.isText){throw new Error("NodeType.create can't construct text nodes")}return new F(this,this.computeAttrs(t),s.from(r),f.setFrom(n))};oe.prototype.createChecked=function e(t,r,n){r=s.from(r);if(!this.validContent(r)){throw new RangeError("Invalid content for node "+this.name)}return new F(this,this.computeAttrs(t),r,f.setFrom(n))};oe.prototype.createAndFill=function e(t,r,n){t=this.computeAttrs(t);r=s.from(r);if(r.size){var i=this.contentMatch.fillBefore(r);if(!i){return null}r=i.append(r)}var o=this.contentMatch.matchFragment(r).fillBefore(s.empty,true);if(!o){return null}return new F(this,t,r.append(o),f.setFrom(n))};oe.prototype.validContent=function e(t){var r=this.contentMatch.matchFragment(t);if(!r||!r.validEnd){return false}for(var n=0;n<t.childCount;n++){if(!this.allowsMarks(t.child(n).marks)){return false}}return true};oe.prototype.allowsMarkType=function e(t){return this.markSet==null||this.markSet.indexOf(t)>-1};oe.prototype.allowsMarks=function e(t){if(this.markSet==null){return true}for(var r=0;r<t.length;r++){if(!this.allowsMarkType(t[r].type)){return false}}return true};oe.prototype.allowedMarks=function e(t){if(this.markSet==null){return t}var r;for(var n=0;n<t.length;n++){if(!this.allowsMarkType(t[n].type)){if(!r){r=t.slice(0,n)}}else if(r){r.push(t[n])}}return!r?t:r.length?r:f.empty};oe.compile=function e(t,r){var n=Object.create(null);t.forEach(function(e,t){return n[e]=new oe(e,r,t)});var i=r.spec.topNode||"doc";if(!n[i]){throw new RangeError("Schema is missing its top node type ('"+i+"')")}if(!n.text){throw new RangeError("Every schema needs a 'text' type")}for(var o in n.text.attrs){throw new RangeError("The text node type should not have attributes")}return n};Object.defineProperties(oe.prototype,ae);var se=function e(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default");this.default=t.default};var ue={isRequired:{configurable:true}};ue.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(se.prototype,ue);var ce=function e(t,r,n,i){this.name=t;this.schema=n;this.spec=i;this.attrs=ie(i.attrs);this.rank=r;this.excluded=null;var o=re(this.attrs);this.instance=o&&new f(this,o)};ce.prototype.create=function e(t){if(!t&&this.instance){return this.instance}return new f(this,ne(this.attrs,t))};ce.compile=function e(t,r){var n=Object.create(null),i=0;t.forEach(function(e,t){return n[e]=new ce(e,i++,r,t)});return n};ce.prototype.removeFromSet=function e(t){for(var r=0;r<t.length;r++){if(t[r].type==this){return t.slice(0,r).concat(t.slice(r+1))}}return t};ce.prototype.isInSet=function e(t){for(var r=0;r<t.length;r++){if(t[r].type==this){return t[r]}}};ce.prototype.excludes=function e(t){return this.excluded.indexOf(t)>-1};var le=function e(t){this.spec={};for(var r in t){this.spec[r]=t[r]}this.spec.nodes=i.from(t.nodes);this.spec.marks=i.from(t.marks);this.nodes=oe.compile(this.spec.nodes,this);this.marks=ce.compile(this.spec.marks,this);var n=Object.create(null);for(var o in this.nodes){if(o in this.marks){throw new RangeError(o+" can not be both a node and a mark")}var a=this.nodes[o],s=a.spec.content||"",u=a.spec.marks;a.contentMatch=n[s]||(n[s]=z.parse(s,this.nodes));a.inlineContent=a.contentMatch.inlineContent;a.markSet=u=="_"?null:u?pe(this,u.split(" ")):u==""||!a.inlineContent?[]:null}for(var c in this.marks){var l=this.marks[c],p=l.spec.excludes;l.excluded=p==null?[l]:p==""?[]:pe(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this);this.markFromJSON=this.markFromJSON.bind(this);this.topNodeType=this.nodes[this.spec.topNode||"doc"];this.cached=Object.create(null);this.cached.wrappings=Object.create(null)};le.prototype.node=function e(t,r,n,i){if(typeof t=="string"){t=this.nodeType(t)}else if(!(t instanceof oe)){throw new RangeError("Invalid node type: "+t)}else if(t.schema!=this){throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(r,n,i)};le.prototype.text=function e(t,r){var n=this.nodes.text;return new q(n,n.defaultAttrs,t,f.setFrom(r))};le.prototype.mark=function e(t,r){if(typeof t=="string"){t=this.marks[t]}return t.create(r)};le.prototype.nodeFromJSON=function e(t){return F.fromJSON(this,t)};le.prototype.markFromJSON=function e(t){return f.fromJSON(this,t)};le.prototype.nodeType=function e(t){var r=this.nodes[t];if(!r){throw new RangeError("Unknown node type: "+t)}return r};function pe(e,t){var r=[];for(var n=0;n<t.length;n++){var i=t[n],o=e.marks[i],a=o;if(o){r.push(o)}else{for(var s in e.marks){var u=e.marks[s];if(i=="_"||u.spec.group&&u.spec.group.split(" ").indexOf(i)>-1){r.push(a=u)}}}if(!a){throw new SyntaxError("Unknown mark type: '"+t[n]+"'")}}return r}var fe=function e(t,r){var n=this;this.schema=t;this.rules=r;this.tags=[];this.styles=[];r.forEach(function(e){if(e.tag){n.tags.push(e)}else if(e.style){n.styles.push(e)}})};fe.prototype.parse=function e(t,r){if(r===void 0)r={};var n=new _e(this,r,false);n.addAll(t,null,r.from,r.to);return n.finish()};fe.prototype.parseSlice=function e(t,r){if(r===void 0)r={};var n=new _e(this,r,true);n.addAll(t,null,r.from,r.to);return h.maxOpen(n.finish())};fe.prototype.matchTag=function e(t,r){for(var n=0;n<this.tags.length;n++){var i=this.tags[n];if(we(t,i.tag)&&(i.namespace===undefined||t.namespaceURI==i.namespace)&&(!i.context||r.matchesContext(i.context))){if(i.getAttrs){var o=i.getAttrs(t);if(o===false){continue}i.attrs=o}return i}}};fe.prototype.matchStyle=function e(t,r,n){for(var i=0;i<this.styles.length;i++){var o=this.styles[i];if(o.style.indexOf(t)!=0||o.context&&!n.matchesContext(o.context)||o.style.length>t.length&&(o.style.charCodeAt(t.length)!=61||o.style.slice(t.length+1)!=r)){continue}if(o.getAttrs){var a=o.getAttrs(r);if(a===false){continue}o.attrs=a}return o}};fe.schemaRules=function e(t){var r=[];function n(e){var t=e.priority==null?50:e.priority,n=0;for(;n<r.length;n++){var i=r[n],o=i.priority==null?50:i.priority;if(o<t){break}}r.splice(n,0,e)}var i=function(e){var r=t.marks[e].spec.parseDOM;if(r){r.forEach(function(t){n(t=Me(t));t.mark=e})}};for(var o in t.marks)i(o);var a=function(e){var r=t.nodes[s].spec.parseDOM;if(r){r.forEach(function(e){n(e=Me(e));e.node=s})}};for(var s in t.nodes)a();return r};fe.fromSchema=function e(t){return t.cached.domParser||(t.cached.domParser=new fe(t,fe.schemaRules(t)))};var de={address:true,article:true,aside:true,blockquote:true,canvas:true,dd:true,div:true,dl:true,fieldset:true,figcaption:true,figure:true,footer:true,form:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,header:true,hgroup:true,hr:true,li:true,noscript:true,ol:true,output:true,p:true,pre:true,section:true,table:true,tfoot:true,ul:true};var he={head:true,noscript:true,object:true,script:true,style:true,title:true};var me={ol:true,ul:true};var ye=1,ge=2,ve=4;function be(e){return(e?ye:0)|(e==="full"?ge:0)}var xe=function e(t,r,n,i,o,a,s){this.type=t;this.attrs=r;this.solid=o;this.match=a||(s&ve?null:t.contentMatch);this.options=s;this.content=[];this.marks=n;this.activeMarks=f.none;this.pendingMarks=i};xe.prototype.findWrapping=function e(t){if(!this.match){if(!this.type){return[]}var r=this.type.contentMatch.fillBefore(s.from(t));if(r){this.match=this.type.contentMatch.matchFragment(r)}else{var n=this.type.contentMatch,i;if(i=n.findWrapping(t.type)){this.match=n;return i}else{return null}}}return this.match.findWrapping(t.type)};xe.prototype.finish=function e(t){if(!(this.options&ye)){var r=this.content[this.content.length-1],n;if(r&&r.isText&&(n=/[ \t\r\n\u000c]+$/.exec(r.text))){if(r.text.length==n[0].length){this.content.pop()}else{this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-n[0].length))}}}var i=s.from(this.content);if(!t&&this.match){i=i.append(this.match.fillBefore(s.empty,true))}return this.type?this.type.create(this.attrs,i,this.marks):i};xe.prototype.applyPending=function e(t){for(var r=0,n=this.pendingMarks;r<n.length;r++){var i=n[r];if((this.type?this.type.allowsMarkType(i.type):Ce(i.type,t))&&!i.isInSet(this.activeMarks)){this.activeMarks=i.addToSet(this.activeMarks);this.pendingMarks=i.removeFromSet(this.pendingMarks)}}};var _e=function e(t,r,n){this.parser=t;this.options=r;this.isOpen=n;var i=r.topNode,o;var a=be(r.preserveWhitespace)|(n?ve:0);if(i){o=new xe(i.type,i.attrs,f.none,f.none,true,r.topMatch||i.type.contentMatch,a)}else if(n){o=new xe(null,null,f.none,f.none,true,null,a)}else{o=new xe(t.schema.topNodeType,null,f.none,f.none,true,null,a)}this.nodes=[o];this.open=0;this.find=r.findPositions;this.needsBlock=false};var Se={top:{configurable:true},currentPos:{configurable:true}};Se.top.get=function(){return this.nodes[this.open]};_e.prototype.addDOM=function e(t){if(t.nodeType==3){this.addTextNode(t)}else if(t.nodeType==1){var r=t.getAttribute("style");var n=r?this.readStyles(Ee(r)):null,i=this.top;if(n!=null){for(var o=0;o<n.length;o++){this.addPendingMark(n[o])}}this.addElement(t);if(n!=null){for(var a=0;a<n.length;a++){this.removePendingMark(n[a],i)}}}};_e.prototype.addTextNode=function e(t){var r=t.nodeValue;var n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(r)){if(!(n.options&ye)){r=r.replace(/[ \t\r\n\u000c]+/g," ");if(/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){var i=n.content[n.content.length-1];var o=t.previousSibling;if(!i||o&&o.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text)){r=r.slice(1)}}}else if(!(n.options&ge)){r=r.replace(/\r?\n|\r/g," ")}if(r){this.insertNode(this.parser.schema.text(r))}this.findInText(t)}else{this.findInside(t)}};_e.prototype.addElement=function e(t){var r=t.nodeName.toLowerCase();if(me.hasOwnProperty(r)){Te(t)}var n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||this.parser.matchTag(t,this);if(n?n.ignore:he.hasOwnProperty(r)){this.findInside(t)}else if(!n||n.skip){if(n&&n.skip.nodeType){t=n.skip}var i,o=this.top,a=this.needsBlock;if(de.hasOwnProperty(r)){i=true;if(!o.type){this.needsBlock=true}}else if(!t.firstChild){this.leafFallback(t);return}this.addAll(t);if(i){this.sync(o)}this.needsBlock=a}else{this.addElementByRule(t,n)}};_e.prototype.leafFallback=function e(t){if(t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent){this.addTextNode(t.ownerDocument.createTextNode("\n"))}};_e.prototype.readStyles=function e(t){var r=f.none;for(var n=0;n<t.length;n+=2){var i=this.parser.matchStyle(t[n],t[n+1],this);if(!i){continue}if(i.ignore){return null}r=this.parser.schema.marks[i.mark].create(i.attrs).addToSet(r)}return r};_e.prototype.addElementByRule=function e(t,r){var n=this;var i,o,a,s;if(r.node){o=this.parser.schema.nodes[r.node];if(!o.isLeaf){i=this.enter(o,r.attrs,r.preserveWhitespace)}else if(!this.insertNode(o.create(r.attrs))){this.leafFallback(t)}}else{a=this.parser.schema.marks[r.mark];s=a.create(r.attrs);this.addPendingMark(s)}var u=this.top;if(o&&o.isLeaf){this.findInside(t)}else if(r.getContent){this.findInside(t);r.getContent(t,this.parser.schema).forEach(function(e){return n.insertNode(e)})}else{var c=r.contentElement;if(typeof c=="string"){c=t.querySelector(c)}else if(typeof c=="function"){c=c(t)}if(!c){c=t}this.findAround(t,c,true);this.addAll(c,i)}if(i){this.sync(u);this.open--}if(s){this.removePendingMark(s,u)}};_e.prototype.addAll=function e(t,r,n,i){var o=n||0;for(var a=n?t.childNodes[n]:t.firstChild,s=i==null?null:t.childNodes[i];a!=s;a=a.nextSibling,++o){this.findAtPoint(t,o);this.addDOM(a);if(r&&de.hasOwnProperty(a.nodeName.toLowerCase())){this.sync(r)}}this.findAtPoint(t,o)};_e.prototype.findPlace=function e(t){var r,n;for(var i=this.open;i>=0;i--){var o=this.nodes[i];var a=o.findWrapping(t);if(a&&(!r||r.length>a.length)){r=a;n=o;if(!a.length){break}}if(o.solid){break}}if(!r){return false}this.sync(n);for(var s=0;s<r.length;s++){this.enterInner(r[s],null,false)}return true};_e.prototype.insertNode=function e(t){if(t.isInline&&this.needsBlock&&!this.top.type){var r=this.textblockFromContext();if(r){this.enterInner(r)}}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type);if(n.match){n.match=n.match.matchType(t.type)}var i=n.activeMarks;for(var o=0;o<t.marks.length;o++){if(!n.type||n.type.allowsMarkType(t.marks[o].type)){i=t.marks[o].addToSet(i)}}n.content.push(t.mark(i));return true}return false};_e.prototype.enter=function e(t,r,n){var i=this.findPlace(t.create(r));if(i){this.enterInner(t,r,true,n)}return i};_e.prototype.enterInner=function e(t,r,n,i){this.closeExtra();var o=this.top;o.applyPending(t);o.match=o.match&&o.match.matchType(t,r);var a=i==null?o.options&~ve:be(i);if(o.options&ve&&o.content.length==0){a|=ve}this.nodes.push(new xe(t,r,o.activeMarks,o.pendingMarks,n,null,a));this.open++};_e.prototype.closeExtra=function e(t){var r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--){this.nodes[r-1].content.push(this.nodes[r].finish(t))}this.nodes.length=this.open+1}};_e.prototype.finish=function e(){this.open=0;this.closeExtra(this.isOpen);return this.nodes[0].finish(this.isOpen||this.options.topOpen)};_e.prototype.sync=function e(t){for(var r=this.open;r>=0;r--){if(this.nodes[r]==t){this.open=r;return}}};Se.currentPos.get=function(){this.closeExtra();var e=0;for(var t=this.open;t>=0;t--){var r=this.nodes[t].content;for(var n=r.length-1;n>=0;n--){e+=r[n].nodeSize}if(t){e++}}return e};_e.prototype.findAtPoint=function e(t,r){if(this.find){for(var n=0;n<this.find.length;n++){if(this.find[n].node==t&&this.find[n].offset==r){this.find[n].pos=this.currentPos}}}};_e.prototype.findInside=function e(t){if(this.find){for(var r=0;r<this.find.length;r++){if(this.find[r].pos==null&&t.nodeType==1&&t.contains(this.find[r].node)){this.find[r].pos=this.currentPos}}}};_e.prototype.findAround=function e(t,r,n){if(t!=r&&this.find){for(var i=0;i<this.find.length;i++){if(this.find[i].pos==null&&t.nodeType==1&&t.contains(this.find[i].node)){var o=r.compareDocumentPosition(this.find[i].node);if(o&(n?2:4)){this.find[i].pos=this.currentPos}}}}};_e.prototype.findInText=function e(t){if(this.find){for(var r=0;r<this.find.length;r++){if(this.find[r].node==t){this.find[r].pos=this.currentPos-(t.nodeValue.length-this.find[r].offset)}}}};_e.prototype.matchesContext=function e(t){var r=this;if(t.indexOf("|")>-1){return t.split(/\s*\|\s*/).some(this.matchesContext,this)}var n=t.split("/");var i=this.options.context;var o=!this.isOpen&&(!i||i.parent.type==this.nodes[0].type);var a=-(i?i.depth+1:0)+(o?0:1);var s=function(e,t){for(;e>=0;e--){var u=n[e];if(u==""){if(e==n.length-1||e==0){continue}for(;t>=a;t--){if(s(e-1,t)){return true}}return false}else{var c=t>0||t==0&&o?r.nodes[t].type:i&&t>=a?i.node(t-a).type:null;if(!c||c.name!=u&&c.groups.indexOf(u)==-1){return false}t--}}return true};return s(n.length-1,this.open)};_e.prototype.textblockFromContext=function e(){var t=this.options.context;if(t){for(var r=t.depth;r>=0;r--){var n=t.node(r).contentMatchAt(t.indexAfter(r)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs){return n}}}for(var i in this.parser.schema.nodes){var o=this.parser.schema.nodes[i];if(o.isTextblock&&o.defaultAttrs){return o}}};_e.prototype.addPendingMark=function e(t){this.top.pendingMarks=t.addToSet(this.top.pendingMarks)};_e.prototype.removePendingMark=function e(t,r){for(var n=this.open;n>=0;n--){var i=this.nodes[n];var o=i.pendingMarks.lastIndexOf(t);if(o>-1){i.pendingMarks=t.removeFromSet(i.pendingMarks)}else{i.activeMarks=t.removeFromSet(i.activeMarks)}if(i==r){break}}};Object.defineProperties(_e.prototype,Se);function Te(e){for(var t=e.firstChild,r=null;t;t=t.nextSibling){var n=t.nodeType==1?t.nodeName.toLowerCase():null;if(n&&me.hasOwnProperty(n)&&r){r.appendChild(t);t=r}else if(n=="li"){r=t}else if(n){r=null}}}function we(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function Ee(e){var t=/\s*([\w-]+)\s*:\s*([^;]+)/g,r,n=[];while(r=t.exec(e)){n.push(r[1],r[2].trim())}return n}function Me(e){var t={};for(var r in e){t[r]=e[r]}return t}function Ce(e,t){var r=t.schema.nodes;var n=function(n){var i=r[n];if(!i.allowsMarkType(e)){return}var o=[],a=function(e){o.push(e);for(var r=0;r<e.edgeCount;r++){var n=e.edge(r);var i=n.type;var s=n.next;if(i==t){return true}if(o.indexOf(s)<0&&a(s)){return true}}};if(a(i.contentMatch)){return{v:true}}};for(var i in r){var o=n(i);if(o)return o.v}}var Ie=function e(t,r){this.nodes=t||{};this.marks=r||{}};Ie.prototype.serializeFragment=function e(t,r,n){var i=this;if(r===void 0)r={};if(!n){n=ke(r).createDocumentFragment()}var o=n,a=null;t.forEach(function(e){if(a||e.marks.length){if(!a){a=[]}var t=0,n=0;while(t<a.length&&n<e.marks.length){var s=e.marks[n];if(!i.marks[s.type.name]){n++;continue}if(!s.eq(a[t])||s.type.spec.spanning===false){break}t+=2;n++}while(t<a.length){o=a.pop();a.pop()}while(n<e.marks.length){var u=e.marks[n++];var c=i.serializeMark(u,e.isInline,r);if(c){a.push(u,o);o.appendChild(c.dom);o=c.contentDOM||c.dom}}}o.appendChild(i.serializeNode(e,r))});return n};Ie.prototype.serializeNode=function e(t,r){if(r===void 0)r={};var n=Ie.renderSpec(ke(r),this.nodes[t.type.name](t));var i=n.dom;var o=n.contentDOM;if(o){if(t.isLeaf){throw new RangeError("Content hole not allowed in a leaf node spec")}if(r.onContent){r.onContent(t,o,r)}else{this.serializeFragment(t.content,r,o)}}return i};Ie.prototype.serializeNodeAndMarks=function e(t,r){if(r===void 0)r={};var n=this.serializeNode(t,r);for(var i=t.marks.length-1;i>=0;i--){var o=this.serializeMark(t.marks[i],t.isInline,r);if(o){(o.contentDOM||o.dom).appendChild(n);n=o.dom}}return n};Ie.prototype.serializeMark=function e(t,r,n){if(n===void 0)n={};var i=this.marks[t.type.name];return i&&Ie.renderSpec(ke(n),i(t,r))};Ie.renderSpec=function e(t,r,n){if(n===void 0)n=null;if(typeof r=="string"){return{dom:t.createTextNode(r)}}if(r.nodeType!=null){return{dom:r}}var i=r[0],o=i.indexOf(" ");if(o>0){n=i.slice(0,o);i=i.slice(o+1)}var a=null,s=n?t.createElementNS(n,i):t.createElement(i);var u=r[1],c=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){c=2;for(var l in u){if(u[l]!=null){var p=l.indexOf(" ");if(p>0){s.setAttributeNS(l.slice(0,p),l.slice(p+1),u[l])}else{s.setAttribute(l,u[l])}}}}for(var f=c;f<r.length;f++){var d=r[f];if(d===0){if(f<r.length-1||f>c){throw new RangeError("Content hole must be the only child of its parent node")}return{dom:s,contentDOM:s}}else{var h=Ie.renderSpec(t,d,n);var m=h.dom;var y=h.contentDOM;s.appendChild(m);if(y){if(a){throw new RangeError("Multiple content holes")}a=y}}}return{dom:s,contentDOM:a}};Ie.fromSchema=function e(t){return t.cached.domSerializer||(t.cached.domSerializer=new Ie(this.nodesFromSchema(t),this.marksFromSchema(t)))};Ie.nodesFromSchema=function e(t){var r=Pe(t.nodes);if(!r.text){r.text=function(e){return e.text}}return r};Ie.marksFromSchema=function e(t){return Pe(t.marks)};function Pe(e){var t={};for(var r in e){var n=e[r].spec.toDOM;if(n){t[r]=n}}return t}function ke(e){return e.document||window.document}t.ContentMatch=z;t.DOMParser=fe;t.DOMSerializer=Ie;t.Fragment=s;t.Mark=f;t.MarkType=ce;t.Node=F;t.NodeRange=N;t.NodeType=oe;t.ReplaceError=d;t.ResolvedPos=I;t.Schema=le;t.Slice=h});define("prosemirror-model",["prosemirror-model/index"],function(e){return e});define("core/prosemirror/prosemirror-serialize",["require","exports","./prosemirror-helpers","prosemirror-model"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.MQ_REGEX=/`[^`]*`/gi;t.INTERP_REGEX=/\$\{[^\}]*\}/gi;t.RAW_LINK_REGEX=/(\bhttps?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|])/gi;t.MD_LINK_REGEX=/\[([^\[\]]+)\]\((https?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|])\)/gi;function i(e){if(e.text&&e.text.trim().length>0)return true;if(e.isLeaf)return false;for(var t=0;t<e.childCount;t++){if(i(e.child(t)))return true}return false}t.hasNonWhitespaceContent=i;function o(e){if(e.text&&e.text.trim().length>0)return true;if(!e.content)return false;for(var t=0;t<e.content.length;t++){var r=e.content[t];if(r&&o(r))return true}return false}t.hasNonWhitespaceContentJSON=o;t.nodeToString=function(e){if(e.isLeaf){return e.textContent}else{var r=[];e.content.forEach(function(e){r.push(t.nodeToString(e))});var n=void 0;if(e.type.name=="doc"){n=r.join("\n")}else{n=r.join("")}if(e.type.name=="mq"&&n.length){n="`"+n+"`"}return n}};t.serializedNodeToString=function(e){if(e.text){return e.text}else{var r=[];if(!e.content)return"";e.content.forEach(function(e){r.push(t.serializedNodeToString(e))});var n=void 0;if(e.type=="doc"){n=r.join("\n")}else{n=r.join("")}if(e.type=="mq"&&n.length){n="`"+n+"`"}return n}};t.stringToSerializedNode=function(e){var n=e.split("\n").map(function(e){var n=[];r.splitOnRegex(e,t.MQ_REGEX).forEach(function(e){if(e.matched){var t=void 0;if(e.text.length>2){t={type:"text",text:e.text.substr(1,e.text.length-2)};n.push({type:"mq",content:[t]})}}else{n.push({type:"text",text:e.text})}});return{type:"paragraph",content:n}});return{type:"doc",content:n}};t.stringToNode=function(e,r){return n.Node.fromJSON(r,t.stringToSerializedNode(e))};function a(e,t,n){var i=[[]];var o=0;e.forEach(function(e){if(e.isText&&e.text.indexOf("\n")!==-1){r.splitOnRegex(e.text,/\n/g).forEach(function(e){if(e.matched){i.push([]);o++}else{i[o].push(t.text(e.text))}})}else{i[o].push(e)}});var a=[];for(var s=0,u=i;s<u.length;s++){var c=u[s];var l=n?n.type:"paragraph";var p=t.nodes[l].create(undefined,c);if(n){p.attrs=n.attrs}a.push(p)}return a}function s(e,t){var r;if(e.length>2){r=t.text(e.substr(1,e.length-2))}return t.nodes.mq.create(undefined,r)}function u(e,t){var r=e.slice(2,e.length-1);return t.nodes.interp.create({interpExpr:r})}function c(e,t){var r=e.split("](");var n=r[0].slice(1);var i=r[1].slice(0,-1);var o=t.marks["link"].create({href:i});return t.text(n).mark([o])}function l(e,t){var r=t.marks["link"].create({href:e});return t.text(e).mark([r])}t.stringToNodes=function(e,n,i){if(!i){i=n}var o=[{name:"mq",regex:t.MQ_REGEX,create:s}];if(i.nodes.interp){o.push({name:"interp",regex:t.INTERP_REGEX,create:u})}if(!!i.marks["link"]){o.push({name:"link",regex:t.MD_LINK_REGEX,create:c});o.push({name:"link",regex:t.RAW_LINK_REGEX,create:l})}function a(e,t){if(t===void 0){t=0}var i=[];r.splitOnRegex(e,o[t].regex).forEach(function(e){if(e.matched){try{i.push(o[t].create(e.text,n))}catch(e){throw new Error("Could not serialize "+o[t].name+" as it is not on the outputSchema")}}else{if(t+1<o.length){i=i.concat(a(e.text,t+1))}else{i.push(n.text(e.text))}}});return i}return a(e)};t.stringToBlockNodes=function(e,r,n,i){var o=t.stringToNodes(e,r,n);return a(o,r,i)}});define("core/components/text-exhibit/index",["require","exports","core/computation-layer/helpers","core/prosemirror/prosemirror-serialize"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(e){var t=e.config,i=e.sinks;var o;var a=i.content&&i.content[0];if(a){o=n.stringToSerializedNode(a.value?r.synthesizeStringForContent(a.value):"")}else if(t.doc){o=JSON.parse(t.doc)}else if(t.text){o=n.stringToSerializedNode(t.text)}else{o=n.stringToSerializedNode("")}return{content:o}},hasResponse:function(){return false},getAssetUrls:function(){return[]}}});define("core/components/geometry/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(e){return!!(e&&e.imgData)},getAssetUrls:function(){return[]}}});define("core/components/expression-input/index",["require","exports","../component-helpers"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(e){if(e.clCorrectness===undefined||e.clCorrectness&&!!e.config.explainResponse){return"ungraded"}if(!n(e.response)){return"incomplete"}if(e.clCorrectness){return"correct"}return"incorrect"},getComponentState:function(e){var t=e.response,n=e.config,i=e.sinks;var o,a;var s=t!=undefined?t.latex:undefined;var u=i.initialLatex;var c=s!=undefined?s:u&&((a=(o=u[0])===null||o===void 0?void 0:o.value)===null||a===void 0?void 0:a.latex)||"";var l={content:c};if(!n.explainResponse){return l}var p=t!=undefined?t.explainText:undefined;l.explainContent=r.getResponseOrInitialText(p,i.initialText);return l},hasResponse:n,getAssetUrls:function(){return[]}};function n(e){if(!e)return false;for(var t in e["expression-history"]){if(e["expression-history"][t].length)return true}for(var t in e.history){if(e.history[t].length)return true}return!!(e.latex&&e.latex.trim().length)}});define("core/components/graph-input/index",["require","exports","../shared/calculator-state-helpers"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(e){if(e.clCorrectness===undefined)return"ungraded";if(!e.response||!e.response.calculatorState)return"incomplete";if(e.clCorrectness)return"correct";return"incorrect"},getComponentState:function(){return{}},hasResponse:function(e){return!!e&&(!!e.calculatorState||!!e.calculatorStateDiff)},getAssetUrls:function(e){var t=[];if(e.img){t.push(e.img)}if(e.calculatorState){t.push.apply(t,r.getGraphAssetUrls(e.calculatorState))}return t}}});define("core/components/text-input/has-response",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});function r(e){if(e!=undefined&&e.response!=undefined){return e.response.trim().length>0}else{return false}}t.hasResponse=r});define("core/components/text-input/index",["require","exports","../component-helpers","./has-response"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(e){var t=e.response,n=e.sinks;var i=t!=undefined?t.response:undefined;var o=r.getResponseOrInitialText(i,n.initialText);return{content:o}},hasResponse:n.hasResponse,getAssetUrls:function(){return[]}}});define("core/components/marbleslides/index",["require","exports","../shared/calculator-state-helpers"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(e){if(!e.response||!e.response.calculatorState){return"incomplete"}if(e.config.stars.length===0)return"correct";if(e.response.score!==undefined&&e.config.stars.length===e.response.score){return"correct"}return"incorrect"},getComponentState:function(){},hasResponse:function(e){return!!e&&!!e.calculatorState},getAssetUrls:function(e){var t=[];if(e.img){t.push(e.img)}if(e.calculatorState){t.push.apply(t,r.getGraphAssetUrls(e.calculatorState))}return t}}});define("core/components/multiple-choice/helpers",["require","exports","core/computation-layer/helpers"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.types={MULTI:"multi",SIMPLE:"simple",EXPLAIN:"explain"};function n(e){return e.multipleChoiceType===t.types.EXPLAIN||e.multipleChoiceType===t.types.SIMPLE&&!!e.showExplanation}t.isSimpleWithExplanation=n;function i(e,t,n){if(n===void 0){n=[]}var i={};for(var o=0,a=n;o<a.length;o++){var s=a[o];var u=s.params[0]-1;i[e.choiceIds[u]]=s.value?r.synthesizeStringForContent(s.value):""}var c=[];var l=e.answerKey;var p=undefined;var f=t&&t.selection;var d=[];e.choiceIds.forEach(function(t,r){var n=e.choices[t];if(n.card){c.push({type:"image",src:n.card.img})}else{c.push({type:"text",content:i[t]||n.text})}if(l!=undefined&&!!l.choiceIds[t]){if(!p){p=[]}p.push(r)}if(f!=undefined&&!!f.choiceIds[t]){d.push(r)}});return{answerKey:p,selectedOptions:d,options:c}}t.getMultipleChoiceOptionsState=i});define("core/components/multiple-choice/index",["require","exports","./helpers","underscore","../component-helpers","../shared/calculator-state-helpers"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(e){if((e.config.answerKey===undefined||e.config.answerKey===null)&&e.clCorrectness===undefined)return"ungraded";var t=!!(e.response&&e.response.selection&&n.isEqual(e.config.answerKey,e.response.selection))||e.clCorrectness;if(r.isSimpleWithExplanation(e.config)&&t){return"ungraded"}if(!e.response||!e.response.selection||n.isEmpty(e.response.selection.choiceIds)){return"incomplete"}if(t)return"correct";return"incorrect"},getComponentState:function(e){var t=e.response,n=e.config,o=e.sinks;var a=r.getMultipleChoiceOptionsState(n,t,o.choiceContent),s=a.answerKey,u=a.selectedOptions,c=a.options;var l={multiSelect:n.multipleChoiceType==="multi",options:c,selectedOptions:u};if(s!=undefined){l.answerKey=s}if(n.showExplanation){var p=t!=undefined?t.explainText:undefined;l.explainContent=i.getResponseOrInitialText(p,o.initialText)}return l},hasResponse:function(e){return!!(e&&e.selection&&!n.isEmpty(e.selection.choiceIds))},getAssetUrls:function(e){var t=[];for(var r=0,n=Object.keys(e.choices);r<n.length;r++){var i=n[r];var a=e.choices[i];if(a.card){if(a.card.img){t.push(a.card.img)}if(a.card.type==="graph"&&a.card.calculatorState){t.push.apply(t,o.getGraphAssetUrls(a.card.calculatorState))}}}return t}}});define("core/components/penny-dragging-widget/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(){return false},getAssetUrls:function(){return[]}}});define("core/components/reorder/helpers",["require","exports","underscore"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function n(e,t){var n=t.value;if(!n)return e;return r.sortBy(e,function(e,t){return n[t]!==undefined?n[t]:Infinity})}t.getItemIdsFromInitialOrder=n;function i(e,t,r){if(t&&t.order)return t.order;if(r){return n(e.itemIds,r)}if(t&&t.randomizedItemIds)return t.randomizedItemIds;return e.itemIds}t.getResponseOrder=i;function o(e){return!!e.hasAnswerKey||!!e.randomize}t.shouldRandomize=o;function a(e){return!!e.hasAnswerKey&&e.itemIds.length>2}t.hasAnswerKey=a});define("core/components/reorder/index",["require","exports","./helpers","underscore"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(e){if(e.clCorrectness===undefined){if(r.hasAnswerKey(e.config)){if(!e.response||!e.response.order)return"incomplete";return n.isEqual(e.response.order,e.config.itemIds)?"correct":"incorrect"}return"ungraded"}if(e.clCorrectness)return"correct";return"incorrect"},getComponentState:function(){},hasResponse:function(e){return!!(e&&e.order)},getAssetUrls:function(){return[]}}});define("core/components/sketch/index",["require","exports","../shared/calculator-state-helpers"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(e){if(e.clCorrectness===undefined){return"ungraded"}if(!e.response||!e.response.sketchData){return"incomplete"}if(e.clCorrectness)return"correct";return"incorrect"},getComponentState:function(){return{}},hasResponse:function(e){return!!(e&&e.sketchData)},getAssetUrls:function(e){var t;var n=[];if(e.img){n.push(e.img)}switch((t=e.background)===null||t===void 0?void 0:t.type){case"image":case"pattern":if(e.background.img){n.push(e.background.img)}break;case"graph":if(e.calculatorState){n.push.apply(n,r.getGraphAssetUrls(e.calculatorState))}break;default:break}return n}}});define("core/lib/simpleevaluator",["require","exports","underscore","core/lib/mathtools"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(){this.cache={};this.context=new n.context}e.prototype.analyze=function(e,t){if(t===void 0){t={}}var r=this.cacheKey(e,t);if(!!this.cache[r]){return this.cache[r]}var n={};var i=0;var o=typeof e=="string"?e:"";n[""+i]={id:""+i,latex:o};i++;for(var a in t){if(t.hasOwnProperty(a)){n[""+i]={id:""+i,latex:a+" = "+t[a]};i++}}var s=this.context.processChangeSet({isCompleteState:true,statements:n});var u=s.statusChanges[0];if(!u){u={error:"Unable to analyze."}}this.cache[r]=u;return u};e.prototype.cacheKey=function(e,t){return JSON.stringify(t)+e};e.prototype.evaluate=function(e,t){var n=this.analyze(e,t);if(n.error){return new Error(n.error)}else if(r.isNumber(n.constant_value)){return n.constant_value}else{return new Error("unknown error")}};e.prototype.isEvaluable=function(e,t){return!!this.analyze(e,t).is_evaluable};return e}();t.SimpleEvaluator=i});define("core/lib/log",["require","exports","tslib"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n;var i;var o;function a(e,t,r){n=e;i=t;o=r}t.init=a;function s(e,t){if(n){n(e,t)}}t.warn=s;function u(e,t){if(i){i(e,t)}}t.err=u;function c(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}if(o){o.apply(void 0,r.__spreadArrays([e],t))}}t.log=c});define("core/lib/evaluator-helpers",["require","exports","./simpleevaluator","./log"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(e){e=e.replace(/(.*?)([\\ ]*)$/,"$1");e=e.replace(/(.*?)([a-z]+)([\\ ]*)$/,"$1");e=e.replace(/(.*?)([a-z]+)\^([\d\-\.]+)$/,"$1");e=e.replace(/(.*?)\\frac\{([a-z]+)\}\{([a-z]+)\}$/,"$1");e=e.replace(/^\\\$/,"");return e};t.evaluateRawLatex=function(e,t){if(e&&typeof e!="string"){n.err("evaluateRawLatex","Expected latex to be string | undefined but it was "+typeof e)}if(!e||typeof e!="string"){return undefined}var r=t.evaluate(e);if(typeof r!="number"||!isFinite(r)){e=i(e);r=t.evaluate(e)}if(typeof r!="number"||!isFinite(r)){e=i(e);if(e.match(/^-?\d{1,3}(,\d\d\d)*(\.\d+)?$/)){e=e.replace(/,/g,"")}r=t.evaluate(e)}if(typeof r!="number"||!isFinite(r)){return undefined}return r};var o=undefined;function a(e){if(e===undefined)return NaN;o=o||new r.SimpleEvaluator;var n=t.evaluateRawLatex(e,o);return n==null?NaN:n}t.computeNumericValueFromLatex=a});define("core/components/table/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true})});define("core/components/table/helpers",["require","exports","tslib","core/lib/simpleevaluator","core/computation-layer/helpers","core/lib/evaluator-helpers","underscore","core/lib/log","core/components/table/types","../component-helpers"],function(e,t,r,n,i,o,a,s,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ColumnType=u.ColumnType;t.TableStructure=u.TableStructure;t.CellData=u.CellData;t.TableCellContent=u.TableCellContent;t.TableData=u.TableData;var l=new n.SimpleEvaluator;t.columnTypes={MATH:0,TEXT:1};function p(e,t){return O(e)?t:t-1}t.rowIdx=p;function f(e,t){return D(e)?t:t-1}t.cellIdx=f;function d(e){return e+"-"}function h(e,t){var r=d(e);return""+r+t}function m(e,t,r,n){return g(e,p(e,t),r,n)}t.addNewRow=m;function y(e,t){var r=g(e,0,t);e.columnHeaders=true;return r}t.addColumnHeaderRow=y;function g(e,t,r,n){var i=e.rows;var o=e.cells;if(n===undefined){var a=e.rows[e.rowIds[0]];n=a?a.length:0}var s=[];for(var u=0;u<n;u++){var c=h(r,u);s.push(c);o[c]={content:""}}i[r]=s;e.rowIds.splice(t,0,r);return r}function v(e){b(e,0);e.rowHeaders=true}t.addRowHeaderColumn=v;t.addNewColumn=function(e,t){return b(e,f(e,t))};function b(e,r){var n=e.rowIds;var i=e.rows;var o=e.cells;for(var u=0;u<n.length;u++){var l=n[u];var p=d(l);var f=c.getNextUniqueIdNum(i[l],p);var m=h(l,f);i[l].splice(r,0,m);o[m]={content:""}}if(!e.columnTypes){s.err("TableDataInvariantViolation",'Missing "columnTypes" in table data.');e.columnTypes=a.range(T(e)).map(function(){return t.columnTypes.MATH})}else{e.columnTypes.splice(r,0,t.columnTypes.MATH)}e.rows=i;e.cells=o}function x(e,t){if(S(e)>t){var n=p(e,t)+1;return r.__assign(r.__assign({},e),{rowIds:e.rowIds.slice(0,n)})}else{return e}}t.getDataTruncatedToRowCoordinate=x;function _(e,t){var r=[];var n=f(e,t);for(var i=0,o=e.rowIds;i<o.length;i++){var s=o[i];var u=e.rows[s];var c=u[n];e.rows[s]=a.without(u,c);r.push(c)}e.cells=a.omit(e.cells,r);return r}t.removeColumn=_;function S(e){return O(e)?e.rowIds.length-1:e.rowIds.length}t.getLastRowCoordinate=S;function T(e){var t=e.rowIds[0];var r=e.rows[t];if(!r)return 0;return r.length}t.getColumnCount=T;function w(e){var t=e.rowIds[0];var r=e.rows[t];if(!r)return-1;return D(e)?r.length-1:r.length}t.getLastColumnCoordinate=w;function E(e,t){var r=e.rowIds.indexOf(t);if(r<0)return-1;return O(e)?r:r+1}t.getRowCoordinateForId=E;function M(e,t,r){var n=e.rows[t];if(!n)return-1;var i=n.indexOf(r);if(i<0)return-1;return D(e)?i:i+1}t.getColumnCoordinateForId=M;function C(e,t){for(var r in e.rows){var n=M(e,r,t);if(n>-1){return{row:E(e,r),column:n}}}return undefined}t.findCoordinatesForCellId=C;function I(e,r){var n=e.columnTypes?e.columnTypes[f(e,r)]:undefined;if(typeof n!=="number")return t.columnTypes.MATH;return n}t.getColumnType=I;function P(e,t){return e.rowIds[p(e,t)]}t.getRowIdForCoordinate=P;t.changeColumnType=function(e,r,n){if(!e.columnTypes){s.err("TableDataInvariantViolation",'Missing "columnTypes" in table data.');e.columnTypes=a.range(T(e)).map(function(){return t.columnTypes.MATH})}e.columnTypes[f(e,r)]=n};function k(e,t,r){var n=e.rowIds[p(e,t)];if(!n)return undefined;return e.rows[n][f(e,r)]}t.getCellIdFromCoordinates=k;function O(e){var t=e.columnHeaders;if(t!==undefined)return t;return true}t.hasColumnHeaders=O;function D(e){var t=e.rowHeaders;if(t!==undefined)return t;return false}t.hasRowHeaders=D;function N(e){var r=e.cellContentSink,n=e.initialCellContentSink,a=e.cellEditableSink,s=e.cellErrorMessageSink,u=e.cellDisableEvaluationSink,c=e.cellSuffixSink,p=e.configurationData,f=e.studentData,d=e.columnType,h=e.fullyEditable,m=e.isHeader;if(d===undefined)d=t.columnTypes.MATH;var y=L(p)||"";var g=L(f);var v;if(a){v=!!a.value}else if(m){v=!r&&y===""}else{v=!r&&(h||y===""||!!n)}var b;if(r&&!v){var x=r.value;if(x){b=x.latex!=undefined?x.latex:i.synthesizeStringForContent(x)}else{b=undefined}}else if(g!==undefined){b=g}else if(n){var x=n.value;if(x){b=x.latex!=undefined?x.latex:i.synthesizeStringForContent(x)}else{b=undefined}}else{b=y}return{content:b||"",cellType:F(m,d,v),numericValue:o.evaluateRawLatex(b,l),allowStudentEditing:v,cellErrorMessage:s&&s.value?i.synthesizeStringForContent(s.value):"",disableEvaluation:u?!!u.value:false,cellSuffix:c&&c.value?i.synthesizeStringForContent(c.value):""}}t.getStudentCellContent=N;function A(e){var r=e.hasCellContentSink,n=e.hasInitialCellContentSink,i=e.configurationData,o=e.columnType,a=e.fullyEditable,s=e.isHeader;if(o===undefined)o=t.columnTypes.MATH;if(r)return{content:"cellContent",cellType:"cl-override-warning",allowStudentEditing:false,cellErrorMessage:"",disableEvaluation:false,cellSuffix:""};if(n)return{content:"initialCellContent",cellType:"cl-override-warning",allowStudentEditing:true,cellErrorMessage:"",disableEvaluation:false,cellSuffix:""};var u=L(i)||"";var c=s&&u==="";var l=s?c:a||u==="";return{content:u,cellType:F(s,o,true),allowStudentEditing:l,cellErrorMessage:"",disableEvaluation:false,cellSuffix:""}}t.getEditorCellContent=A;function L(e){if(!e)return undefined;if(e.content!==undefined)return e.content;if(e.latex!==undefined)return e.latex;if(e.text!==undefined)return e.text;return undefined}function F(e,r,n){if(e){r=t.columnTypes.TEXT}if(r===t.columnTypes.TEXT)return n?"editable-text":"readonly-text";if(r===t.columnTypes.MATH)return n?"editable-math":"readonly-math";throw new Error("Unexpected column type")}t.getCellType=F;function R(e,t){var r={};for(var n=0,i=["cellContent","initialCellContent","cellEditable","cellSuffix","cellErrorMessage","cellDisableEvaluation"];n<i.length;n++){var o=i[n];var a=t[o];if(!a)continue;for(var s=0,u=a;s<u.length;s++){var c=u[s];var l=c.params,p=l[0],f=l[1];var d=k(e,p,f);if(!d)continue;if(!r[d])r[d]={};r[d][o]=c}}return r}t.getTableSinkMap=R;function q(e,r,n){if(e==0||r==0){return t.columnTypes.TEXT}return I(n,r)}t.getTableCellType=q;function V(e,t,n,i){var o=r.__assign(r.__assign({},n),i);var a=C(o,e);if(!a){throw new Error("Unable to find cell with id "+e+" in table.")}var s=t[e]||{};var u=I(n,a.column);var c={cellContentSink:s["cellContent"],initialCellContentSink:s["initialCellContent"],cellEditableSink:s["cellEditable"],cellErrorMessageSink:s["cellErrorMessage"],cellDisableEvaluationSink:s["cellDisableEvaluation"],cellSuffixSink:s["cellSuffix"],configurationData:n.cells[e],studentData:!!i&&i.cells?i.cells[e]:undefined,columnType:u,fullyEditable:n.fullyEditable,isHeader:a.row===0||a.column===0};var l=N(c);var p=l.content,f=l.numericValue,d=l.allowStudentEditing,h=l.cellErrorMessage,m=l.cellSuffix;var y={content:p,studentEditable:d,warning:h,suffixContent:m,columnType:u,coords:a};if(f!==undefined){y.numericValue=f}return y}t.getTableCellState=V});define("core/components/table/index",["require","exports","tslib","./helpers"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(e){if(e.clCorrectness===undefined){return"ungraded"}if(!e.response||!e.response.updated){return"incomplete"}if(e.clCorrectness)return"correct";return"incorrect"},getComponentState:function(e){var t=e.response,i=e.config,o=e.sinks;var a=t!=undefined?r.__assign(r.__assign({},i),t):i;var s=n.getTableSinkMap(a,o);var u=o.maxRows&&o.maxRows[0];var c=u&&u.value!=undefined?u.value:Infinity;var l=n.getDataTruncatedToRowCoordinate(a,c);var p=l.rowIds.map(function(e){var r=a.rows[e];return r.map(function(e){return n.getTableCellState(e,s,i,t)})});return{cellContent:p,rowHeaders:!!i.rowHeaders,columnHeaders:i.columnHeaders===undefined?true:i.columnHeaders,rowIds:l.rowIds}},hasResponse:function(e){return!!(e&&e.updated)},getAssetUrls:function(){return[]}}});define("core/components/transform/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(e){var t=!!e.response&&!!e.response.transforms&&e.response.transforms.length>0;var r=!!e.response&&!!e.response.unsubmittedTransform;if(!(e.response&&(t||r))){return"incomplete"}if(!!e.response){if(!!e.response.hitTarget)return"correct";return"incorrect"}return"ungraded"},getComponentState:function(){},hasResponse:function(e){return!!(e&&(e.transforms&&e.transforms.length||!!e.unsubmittedTransform))},getAssetUrls:function(){return[]}}});define("core/components/video/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(){return false},getAssetUrls:function(e){var t=[];if(e.videoConfig){if(e.videoConfig.thumb){t.push(e.videoConfig.thumb)}for(var r=0,n=e.videoConfig.sources||[];r<n.length;r++){var i=n[r];t.push(i.url)}}return t}}});define("core/components/challenge/index",["require","exports","underscore","core/components/component-helpers","../index"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(e){return!!(e&&(e.challenges&&e.challenges.length>0||e.responses&&r.values(e.responses).length>0))},getAssetUrls:function(e){var t=[];for(var r=0,o=e.activityConfig.steps;r<o.length;r++){var a=o[r];n.forEachComponent(a,function(e){var r=n.componentKey(e);var o=n.traverseComponentKey(e);var a=i.nameToComponent(r);t.push.apply(t,a.getAssetUrls(o))})}return t}}});define("core/components/student-survey/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index={checkCorrectness:function(e){if(!!e.response){if(e.response.survey_understanding!=undefined&&e.response.survey_feeling!=undefined){return"correct"}}return"incomplete"},getComponentState:function(){},hasResponse:function(e){return!!(e&&(e.survey_feeling!=undefined||e.survey_understanding!=undefined))},getAssetUrls:function(){return[]}}});define("core/components/index",["require","exports","./action-button/index","./cardsort/index","./image-exhibit/index","./text-exhibit/index","./geometry/index","./expression-input/index","./graph-input/index","./text-input/index","./marbleslides/index","./multiple-choice/index","./penny-dragging-widget/index","./reorder/index","./sketch/index","./table/index","./transform/index","./video/index","./challenge/index","./student-survey/index"],function(e,t,r,n,i,o,a,s,u,c,l,p,f,d,h,m,y,g,v,b){"use strict";Object.defineProperty(t,"__esModule",{value:true});var x={"action-button":r.index,cardsort:n.index,challenge:v.index,"exhibit/image":i.index,"exhibit/text":o.index,geometry:a.index,"input/expression":s.index,"input/graph":u.index,"input/text":c.index,marbleslides:l.index,"multiple-choice":p.index,"penny-dragging-widget":f.index,sketch:h.index,table:m.index,transform:y.index,video:g.index,"student-survey":b.index,reorder:d.index};t.COMPONENT_NAMES=Object.keys(x);function _(e){return x[e]}t.nameToComponent=_});define("core/components/component-helpers",["require","exports","core/lib/uuid","core/computation-layer/helpers","core/components/index"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.componentKey=function(e){var t;for(var r in e){if(t)throw new Error("Expected to get a component with a single key, but got "+JSON.stringify(e));t=r}if(!t)throw new Error("Expected to get a component with a single key, but got {}");return t};t.traverseComponentKey=function(e){return e[t.componentKey(e)]};t.componentsForStep=function(e){var t=[];o(e,function(e){return t.push(e)});return t};function o(e,t){for(var r=0,n=e.root.linearlayout.components;r<n.length;r++){var i=n[r];for(var o=0,a=i.linearlayout.components;o<a.length;o++){var s=a[o];t(s)}}}t.forEachComponent=o;function a(e){var r=[];return r.concat.apply(r,e.steps.map(t.componentsForStep))}t.componentsForLesson=a;t.newScreen=function(){return{type:"two-column",id:r.uuid(),teacherTips:{},root:{linearlayout:{mainType:"columns",components:[]}}}};function s(e,t){var r=t.root.linearlayout.components;for(var n=0,i=r;n<i.length;n++){var o=i[n];var a=o.linearlayout.components;for(var s=0,u=a;s<u.length;s++){var c=u[s];if(c[e]){return c[e]}}}return undefined}t.findFirstComponentByType=s;function u(e){return s("challenge",e)}t.getSubscreenParentConfig=u;function c(e,t){if(t===void 0){t=[]}if(e!=undefined){return e}else if(t[0]&&t[0].value){return n.synthesizeStringForContent(t[0].value)}return""}t.getResponseOrInitialText=c;function l(e,t){var r=-1;for(var n=0,i=e;n<i.length;n++){var o=i[n];var a=o.indexOf(t)===0?parseInt(o.replace(t,"")):-1;if(!isNaN(a)&&a>r){r=a}}return r+1}t.getNextUniqueIdNum=l;function p(e,t){return""+e+t}t.generatePrefixId=p;function f(e){return!!i.nameToComponent(e)}t.isComponentKey=f});define("core/lib/assert-unreachable",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.assertUnreachable=function(e,t){if(!t){t="Exhaustive case failed! "+JSON.stringify(e)}throw new Error(t)}});define("core/computation-layer/runtime-node",["require","exports","underscore","core/lib/assert-unreachable"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e){this.blockedOn=[];this.runtime=e.runtime;this.analysis=e.analysis;this.nodeId=e.nodeId;this.dependents=[];switch(this.analysis.type){case"constant":this.value=this.analysis.value}this.blockedOn=this.getDependencies()}e.prototype.registerDependent=function(e){if(r.contains(this.dependents,e)){return}this.dependents.push(e)};e.prototype.resolveDependency=function(e){this.blockedOn=r.without(this.blockedOn,e);if(this.blockedOn.length===0){this.compute()}};e.prototype.blockOn=function(e){if(r.contains(this.blockedOn,e)){return}this.blockedOn.push(e);if(this.blockedOn.length==1){this.blockDependents()}};e.prototype.blockDependents=function(){for(var e=0,t=this.dependents;e<t.length;e++){var r=t[e];this.runtime.nodes[r].blockOn(this.nodeId)}};e.prototype.resolveValue=function(e){this.value=e;for(var t=0,r=this.dependents;t<r.length;t++){var n=r[t];this.runtime.nodes[n].resolveDependency(this.nodeId)}};e.prototype.getDependencies=function(){switch(this.analysis.type){case"constant":case"controllerSource":case"responseSource":case"component":case"component-script":case"importNumber":case"importString":case"importNumberList":return[];case"function":return this.analysis.dependencies;default:return n.assertUnreachable(this.analysis)}};e.prototype.compute=function(){var e;var t=this;if(this.analysis.type!="function")return;var r=this.analysis.dependencies.map(function(e){return t.runtime.nodes[e].value});this.resolveValue((e=this.analysis).fn.apply(e,r))};return e}();t.RuntimeNode=i});define("core/computation-layer/parser/context",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r={componentId:"",stepId:""};function n(){return r}t.getContext=n;function i(e){r=e}t.setContext=i});define("core/computation-layer/parser/helpers",["require","exports","./context"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function n(e,t){var n=r.getContext();if(t){return{componentId:n.componentId,stepId:n.stepId,first_line:e.line,last_line:t.line,first_column:e.first_column,last_column:t.last_column}}else{return{componentId:n.componentId,stepId:n.stepId,first_line:e.line,last_line:e.line,first_column:e.first_column,last_column:e.last_column}}}t.token2pos=n;function i(e,t){return{componentId:e.componentId,stepId:e.stepId,first_line:e.first_line,last_line:t.last_line,first_column:e.first_column,last_column:t.last_column}}t.join=i;var o=function(){function e(e,t){this.message=e;this.pos=t}return e}();t.ParseError=o});define("core/computation-layer/string-stream",["require"],function(e){var t=function(e,t,r){this.pos=this.start=0;this.string=e;this.tabSize=t||8;this.lastColumnPos=this.lastColumnValue=0;this.lineStart=0;this.lineOracle=r};t.prototype.eol=function(){return this.pos>=this.string.length};t.prototype.sol=function(){return this.pos==this.lineStart};t.prototype.peek=function(){return this.string.charAt(this.pos)||undefined};t.prototype.next=function(){if(this.pos<this.string.length){return this.string.charAt(this.pos++)}};t.prototype.eat=function(e){var t=this.string.charAt(this.pos);var r;if(typeof e=="string"){r=t==e}else{r=t&&(e.test?e.test(t):e(t))}if(r){++this.pos;return t}};t.prototype.eatWhile=function(e){var t=this.pos;while(this.eat(e)){}return this.pos>t};t.prototype.eatSpace=function(){var e=this;var t=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++e.pos}return this.pos>t};t.prototype.skipToEnd=function(){this.pos=this.string.length};t.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1){this.pos=t;return true}};t.prototype.backUp=function(e){this.pos-=e};t.prototype.column=function(){if(this.lastColumnPos<this.start){this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue);this.lastColumnPos=this.start}return this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)};t.prototype.indentation=function(){return countColumn(this.string,null,this.tabSize)-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)};t.prototype.match=function(e,t,r){if(typeof e=="string"){var n=function(e){return r?e.toLowerCase():e};var i=this.string.substr(this.pos,e.length);if(n(i)==n(e)){if(t!==false){this.pos+=e.length}return true}}else{var o=this.string.slice(this.pos).match(e);if(o&&o.index>0){return null}if(o&&t!==false){this.pos+=o[0].length}return o}};t.prototype.current=function(){return this.string.slice(this.start,this.pos)};t.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}};t.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)};t.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)};return{StringStream:t}});define("core/computation-layer/lexer",["require","exports","./string-stream"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function n(e){var t=[];var n={line:1,stack:["default"]};for(var o=0,a=e.split("\n");o<a.length;o++){var s=a[o];var u=new r.StringStream(s);while(!u.eol()){var c=i(u,n);if(c!=undefined){t.push(c)}if(u.start==u.pos){throw new Error("getToken failed to advance stream at position "+u.pos+" in string "+u.string)}u.start=u.pos}if(n.stack[n.stack.length-1]=="string"){t.push({type:"STRING_CHARACTERS",line:n.line,first_column:u.start,last_column:u.pos,text:"\n"})}n.line+=1}return t}t.getTokens=n;t.keywords=["WHEN","OTHERWISE","AND","OR","TRUE","FALSE"];function i(e,t){switch(t.stack[t.stack.length-1]){case"latex":return s(e,t);case"string":return u(e,t);case"stringInterpolation":return c(e,t);case"latexInterpolation":return l(e,t);default:return a(e,t)}}t.getToken=i;function o(e,t){return function r(n){return{type:n,first_column:e.start,last_column:e.pos,line:t.line,text:e.current()}}}function a(e,r){var n=o(e,r);if(e.eatSpace()){return undefined}if(e.match(/\(/)){return n("(")}if(e.match(/\)/)){return n(")")}if(e.match(/\./)){return n(".")}if(e.match(/:/)){return n(":")}if(e.match(/=/)){return n("=")}if(e.match(/,/)){return n(",")}if(e.match(/>=/)){return n(">=")}if(e.match(/<=/)){return n("<=")}if(e.match(/>/)){return n(">")}if(e.match(/</)){return n("<")}if(e.match(/[a-zA-Z_][a-zA-Z0-9_]*/)){for(var i=0,a=t.keywords;i<a.length;i++){var s=a[i];if(e.current()==s||e.current()==s.toLowerCase()){return n(s)}}return n("IDENTIFIER")}if(e.match(/-?[0-9]+(\.[0-9]+)?/)){return n("NUMBER")}if(e.match(/"/)){r.stack.push("string");return n("BEGIN_STRING")}if(e.match(/`/)){r.stack.push("latex");return n("BEGIN_LATEX")}if(e.match(/#/)){if(!e.match(/\n/)){e.match(/.*/)}return n("COMMENT")}e.next();return n("ERROR")}function s(e,t){var r=o(e,t);if(e.match(/\${/)){t.stack.push("latexInterpolation");return r("BEGIN_LATEX_INTERPOLATION")}if(e.match(/`/)){t.stack.pop();return r("END_LATEX")}e.next();var n=e.peek();if(n){return r("LATEX_CHARACTERS")}else{t.stack.pop();return r("UNEXPECTED_EOL")}}function u(e,t){var r=o(e,t);if(e.match(/\${/)){t.stack.push("stringInterpolation");return r("BEGIN_STRING_INTERPOLATION")}if(e.match(/"/)){t.stack.pop();return r("END_STRING")}if(e.match(/\\n/)){if(e.match(/(u|e|eq|parallel)(?![a-zA-Z])/)){var n=r("STRING_CHARACTERS");return n}var i=r("STRING_CHARACTERS");i.text="\n";return i}if(e.match(/\\([{}% ]|[a-z]{2,})/)){var i=r("STRING_CHARACTERS");return i}if(e.match(/\\./)){var i=r("STRING_CHARACTERS");i.text=i.text[1];return i}if(e.match(/./)){return r("STRING_CHARACTERS")}e.next();return r("ERROR")}function c(e,t){var r=o(e,t);if(e.match(/}/)){t.stack.pop();return r("END_STRING_INTERPOLATION")}return a(e,t)}function l(e,t){var r=o(e,t);if(e.match(/}/)){t.stack.pop();return r("END_LATEX_INTERPOLATION")}return a(e,t)}});define("core/computation-layer/parser/token-stream",["require","exports","../lexer","./helpers"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(e){this.pos=0;this.tokens=r.getTokens(e).filter(function(e){return e.type!="COMMENT"})}e.prototype.consume=function(){var e=this.tokens[this.pos];if(e){this.pos+=1}return e};e.prototype.peek=function(){return this.tokens[this.pos]};e.prototype.last=function(){return this.tokens[this.pos-1]};e.prototype.expectToken=function(e){var t=this.consume();if(!t){throw new n.ParseError("Expected _"+e+"_ token but found none.",n.token2pos(this.last()))}if(t.type!=e){throw new n.ParseError("Expected _"+e+"_ token but found _"+t.type+"_.",n.token2pos(t))}return t};return e}();t.TokenStream=i});define("core/computation-layer/cl-types",["require","exports","tslib"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function n(e){return s.create(e)}t.makeDummyNamedTypeForTestsOnly=n;function i(e){if(!e){return true}return Object.keys(e).length==0}function o(e){var r=e.type,n=e.params;if(t.Types.hasOwnProperty(r)&&i(n))return t.Types[r];if(r=="function"){return c(n)}if(r=="component"){return p(n)}if(r=="componentScript"){return d(n)}throw new Error("Asked to inflate unexpected type "+r+" with params "+JSON.stringify(n))}t.reinflateType=o;function a(e){var t={};for(var n in e){t[n]=[];for(var i=0,a=e[n];i<a.length;i++){var s=a[i];t[n].push(r.__assign(r.__assign({},s),{valueType:o(s.valueType)}))}}return t}t.reinflateSinkTypes=a;var s=function(){function e(e){this.type=e}e.prototype.matches=function(t){if(t==undefined)throw new Error("Cannot type-check against undefined");if(!(t instanceof e))throw new Error("Cannot type-check against non CLType object"+JSON.stringify(t,null,2));return this===t};e.prototype.toString=function(){if(this.params==undefined)return this.type;return this.type+"<"+JSON.stringify(this.params)+">"};e.create=function(t){if(!this.typeCache[t]){this.typeCache[t]=new e(t)}return this.typeCache[t]};e.typeCache={};return e}();t.CLType=s;var u=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"function")||this;r.params=t;return r}t.get=function(e){var r=e.numVars;if(this.functionTypeCache[r]==undefined){this.functionTypeCache[r]=new t(e)}return this.functionTypeCache[r]};t.functionTypeCache={1:new t({numVars:1}),2:new t({numVars:2})};return t}(s);t.FunctionType=u;function c(e){return u.get(e)}t.getFunctionType=c;var l=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"component")||this;r.params=t;return r}t.get=function(e){var r=e.componentId;if(this.componentTypeCache[r]==undefined){this.componentTypeCache[r]=new t(e)}return this.componentTypeCache[r]};t.componentTypeCache={};return t}(s);t.ComponentType=l;function p(e){return l.get(e)}t.getComponentType=p;var f=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"componentScript")||this;r.params=t;return r}t.get=function(e){var r=e.componentId;if(this.componentScriptTypeCache[r]==undefined){this.componentScriptTypeCache[r]=new t(e)}return this.componentScriptTypeCache[r]};t.componentScriptTypeCache={};return t}(s);t.ComponentScriptType=f;function d(e){return f.get(e)}t.getComponentScriptType=d;t.Types={number:s.create("number"),string:s.create("string"),latex:s.create("latex"),bounds:s.create("bounds"),boundsStrategy:s.create("boundsStrategy"),layer:s.create("layer"),xyLine:s.create("xyLine"),orderedPair:s.create("orderedPair"),equation:s.create("equation"),inequality:s.create("inequality"),boolean:s.create("boolean"),color:s.create("color"),colorPalette:s.create("colorPalette"),colorList:s.create("colorList"),sketch:s.create("sketch"),numberList:s.create("numberList"),function1:c({numVars:1}),function2:c({numVars:2}),calculatorStateWithSinkValues:s.create("calculatorStateWithSinkValues"),randomGenerator:s.create("randomGenerator"),response:s.create("response"),sketchTool:s.create("sketchTool"),sketchTools:s.create("sketchTools"),buttonStyle:s.create("buttonStyle"),buttonStyles:s.create("buttonStyles"),patternLibrary:s.create("patternLibrary"),numberPattern:s.create("numberPattern"),numberPatternMatch:s.create("numberPatternMatch"),mixedNumberPattern:s.create("mixedNumberPattern"),mixedNumberPatternMatch:s.create("mixedNumberPatternMatch"),literalPattern:s.create("literalPattern"),literalPatternMatch:s.create("literalPatternMatch"),expressionPattern:s.create("expressionPattern"),expressionPatternMatch:s.create("expressionPatternMatch"),orPattern:s.create("orPattern"),orPatternMatch:s.create("orPatternMatch"),scientificPattern:s.create("scientificPattern"),scientificPatternMatch:s.create("scientificPatternMatch")};function h(e,t,r){if(e.matches(t))return;throw new Error(r||"Expected "+e.toString()+", but got "+t.toString())}t.assertType=h});define("core/computation-layer/parser/ast",["require","exports","tslib","core/computation-layer/cl-types"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=function(){function e(){}return e}();var o=function(e){r.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.getChildren=function(){return[]};return t}(i);t.ConstantNode=o;var a=function(e){r.__extends(t,e);function t(t,r){var i=e.call(this)||this;i.value=t;i.pos=r;i.type="Number";i.valueType=n.Types.number;return i}return t}(o);t.NumberNode=a;var s=function(e){r.__extends(t,e);function t(t,r){var i=e.call(this)||this;i.value=t;i.pos=r;i.type="Boolean";i.valueType=n.Types.boolean;return i}return t}(o);t.BooleanNode=s;var u=function(e){r.__extends(t,e);function t(t,r){var i=e.call(this)||this;i.pos=r;i.type="String";i.valueType=n.Types.string;i.value={type:"string",parts:[t]};return i}return t}(o);t.StringNode=u;var c=function(e){r.__extends(t,e);function t(t,r){var i=e.call(this)||this;i.value=t;i.pos=r;i.type="Latex";i.valueType=n.Types.latex;return i}return t}(o);t.LatexNode=c;var l=function(e){r.__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.left=t;i.right=r;i.pos=n;i.type="SinkAssignment";return i}t.prototype.getChildren=function(){return[this.left,this.right]};return t}(i);t.SinkAssignmentNode=l;var p=function(e){r.__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.left=t;i.right=r;i.pos=n;i.type="VariableAssignment";return i}t.prototype.getChildren=function(){return[this.left,this.right]};return t}(i);t.VariableAssignmentNode=p;var f=function(e){r.__extends(t,e);function t(t,r){var n=e.call(this)||this;n.value=t;n.pos=r;n.type="Identifier";return n}t.prototype.getChildren=function(){return[]};return t}(i);t.IdentifierNode=f;var d=function(e){r.__extends(t,e);function t(t,r,n,i){var o=e.call(this)||this;o.operator=t;o.left=r;o.right=n;o.pos=i;o.type="BinaryOperation";return o}t.prototype.getChildren=function(){return[this.left,this.right]};return t}(i);t.BinaryOperationNode=d;var h=function(e){r.__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.cases=t;i.otherwise=r;i.pos=n;i.type="Choose";return i}t.prototype.getChildren=function(){var e=[];for(var t=0,r=this.cases;t<r.length;t++){var n=r[t],i=n.predicate,o=n.consequent;e.push(i);e.push(o)}e.push(this.otherwise);return e};return t}(i);t.ChooseNode=h;var m=function(e){r.__extends(t,e);function t(t,r){var n=e.call(this)||this;n.args=t;n.pos=r;n.type="Function";return n}t.prototype.getChildren=function(){return this.args};return t}(i);t.FunctionNode=m;var y=function(e){r.__extends(t,e);function t(t,r){var n=e.call(this)||this;n.componentId=t;n.pos=r;n.type="CalculatorReference";return n}t.prototype.getChildren=function(){return[]};return t}(i);t.CalculatorReferenceNode=y});define("core/computation-layer/parser/parselet",["require","exports","tslib","./ast","./helpers"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=function(){function e(e,t){this.tokenType=e;this.associativity=t}return e}();t.InfixParselet=o;var a=function(){function e(){}e.prototype.parse=function(e,t,r){return new n.IdentifierNode(r.text,i.token2pos(r))};return e}();t.IdentifierParselet=a;var s=function(){function e(){}e.prototype.parse=function(e,t,r){return new n.NumberNode(parseFloat(r.text),i.token2pos(r))};return e}();t.NumberParselet=s;var u=function(){function e(e){this.value=e}e.prototype.parse=function(e,t,r){return new n.BooleanNode(this.value,i.token2pos(r))};return e}();t.BooleanParselet=u;var c=function(){function e(){}e.prototype.parse=function(e,t,r){var o=[];var a={text:"",start:r};while(true){var s=t.consume();if(!s){throw new i.ParseError("Unterminated latex.",i.token2pos(t.last()))}if(s.type=="LATEX_CHARACTERS"){a.text=a.text+s.text;continue}if(s.type=="END_LATEX"){if(o.length){if(a.text.length){o.push(new n.LatexNode({latex:a.text},i.token2pos(a.start,s)))}return new n.FunctionNode([new n.IdentifierNode("latexConcat",i.token2pos(r))].concat(o),i.token2pos(r,s))}else{if(a.text.length){return new n.LatexNode({latex:a.text},i.token2pos(a.start,s))}else{return new n.LatexNode({latex:""},i.token2pos(a.start,s))}}}if(s.type=="BEGIN_LATEX_INTERPOLATION"){if(a.text.length){o.push(new n.LatexNode({latex:a.text},i.token2pos(a.start,s)))}o.push(e.parseTokenStream(t,0));var u=t.expectToken("END_LATEX_INTERPOLATION");a={text:"",start:u};continue}throw new i.ParseError("Expected latex characters or interpolation, but found "+s.type,i.token2pos(s))}};return e}();t.LatexParselet=c;var l=function(){function e(){}e.prototype.parse=function(e,t,r){var o=[];var a={text:"",start:r};while(true){var s=t.consume();if(!s){throw new i.ParseError("Unterminated string.",i.token2pos(t.last()))}if(s.type=="STRING_CHARACTERS"){a.text=a.text+s.text;continue}if(s.type=="END_STRING"){if(o.length){if(a.text.length){o.push(new n.StringNode(a.text,i.token2pos(a.start,s)))}return new n.FunctionNode([new n.IdentifierNode("stringConcat",i.token2pos(r))].concat(o),i.token2pos(r,s))}else{if(a.text.length){return new n.StringNode(a.text,i.token2pos(a.start,s))}else{return new n.StringNode("",i.token2pos(a.start,s))}}}if(s.type=="BEGIN_STRING_INTERPOLATION"){if(a.text.length){o.push(new n.StringNode(a.text,i.token2pos(a.start,s)))}o.push(e.parseTokenStream(t,0));var u=t.expectToken("END_STRING_INTERPOLATION");a={text:"",start:u};continue}throw new i.ParseError("Expected a string or interpolation, but found "+s.text,i.token2pos(s))}};return e}();t.StringParselet=l;var p=function(){function e(){}e.prototype.parse=function(e,t,r){var n=e.parseTokenStream(t,0);t.expectToken(")");return n};return e}();t.BracketParselet=p;var f=function(){function e(){}e.prototype.parse=function(e,t,r){var o=[];while(true){var a=e.parseTokenStream(t,0);var s=e.parseTokenStream(t,0);o.push({predicate:a,consequent:s});var u=t.peek();if(!(u&&u.type=="WHEN")){break}t.consume()}t.expectToken("OTHERWISE");var c=e.parseTokenStream(t,0);return new n.ChooseNode(o,c,i.token2pos(r,t.last()))};return e}();t.WhenParselet=f;var d=function(e){r.__extends(t,e);function t(t,r){var n=e.call(this,t,r)||this;n.tokenType=t;return n}t.prototype.parse=function(e,t,r,o){var a=e.bindingPower(this.tokenType);if(!t.peek()&&this.tokenType=="."){e.partialExpressions.push(new n.BinaryOperationNode(this.tokenType,r,new n.IdentifierNode("",{componentId:r.pos.componentId,stepId:r.pos.stepId,first_line:r.pos.last_line,last_line:o.line,first_column:o.last_column,last_column:o.last_column}),i.join(r.pos,i.token2pos(o))))}var s=e.parseTokenStream(t,this.associativity=="left"?a:a-1);return new n.BinaryOperationNode(this.tokenType,r,s,i.join(r.pos,i.token2pos(t.last())))};return t}(o);t.BinaryOperatorParselet=d;var h=function(e){r.__extends(t,e);function t(){return e.call(this,"(","left")||this}t.prototype.parse=function(e,t,r,o){var a=[r];var s=t.peek();if(s&&s.type==")"){t.consume();return new n.FunctionNode(a,i.join(r.pos,i.token2pos(t.last())))}while(true){a.push(e.parseTokenStream(t,0));var u=t.consume();if(!u){throw new i.ParseError("Unterminated function invocation.",i.token2pos(t.last()))}if(u.type==","){continue}if(u.type==")"){break}throw new i.ParseError('Expected ")" or "," but got '+u.text,i.token2pos(u))}return new n.FunctionNode(a,i.join(r.pos,i.token2pos(t.last())))};return t}(o);t.FunctionParselet=h});define("core/computation-layer/parser/parser",["require","exports","tslib","./parselet","./ast","./helpers"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=function(){function e(){this.partialExpressions=[];this.bindingPowers={};var e=this.bindingClasses();for(var t=0;t<e.length;t++){for(var r=0,n=e[t];r<n.length;r++){var i=n[r];this.bindingPowers[i]=10*t+9}}for(var o=0,a=Object.keys(this.infixMap);o<a.length;o++){var i=a[o];if(this.bindingPowers[i]==undefined){throw new Error("Token "+i+" defined in infixMap has no associated binding power.\n          Make sure it is also listed in bindingClasses.")}}}e.prototype.bindingPower=function(e){if(this.bindingPowers[e]!=undefined){return this.bindingPowers[e]}else{throw new Error("Tried to parse token type "+e+" with a parser that does not have it defined.")}};e.prototype.parseTokenStream=function(e,t){var r=e.consume();if(!r){throw new o.ParseError("Unexpected end of tokens.",o.token2pos(e.last()))}var n=this.prefixMap()[r.type];if(!n){throw new o.ParseError('Unexpected token "'+r.text+'".',o.token2pos(r))}var i=n.parse(this,e,r);while(true){var a=e.peek();if(!a){break}if(a.type=="("&&a.first_column!=e.last().last_column){break}var s=this.infixMap()[a.type];if(!s){break}if(t>=this.bindingPower(a.type)){break}e.consume();try{i=s.parse(this,e,i,a)}catch(e){this.partialExpressions.push(i);throw e}}this.partialExpressions.push(i);return i};return e}();t.Parser=a;var s={IDENTIFIER:new n.IdentifierParselet,NUMBER:new n.NumberParselet,TRUE:new n.BooleanParselet(true),FALSE:new n.BooleanParselet(false),WHEN:new n.WhenParselet,BEGIN_STRING:new n.StringParselet,BEGIN_LATEX:new n.LatexParselet,"(":new n.BracketParselet};var u={"=":new n.BinaryOperatorParselet("=","left"),">":new n.BinaryOperatorParselet(">","left"),"<":new n.BinaryOperatorParselet("<","left"),">=":new n.BinaryOperatorParselet(">=","left"),"<=":new n.BinaryOperatorParselet("<=","left"),AND:new n.BinaryOperatorParselet("AND","left"),OR:new n.BinaryOperatorParselet("OR","left"),"(":new n.FunctionParselet,".":new n.BinaryOperatorParselet(".","left")};var c=[["AND","OR"],["="],[">","<",">=","<="],["("],["."]];var l=function(e){r.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.prefixMap=function(){return s};t.prototype.infixMap=function(){return u};t.prototype.bindingClasses=function(){return c};return t}(a);t.ExpressionParser=l;var p={"(":new n.FunctionParselet,".":new n.BinaryOperatorParselet(".","left")};var f=[["("],["."]];var d=function(e){r.__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.expressionParser=new l;return t}t.prototype.prefixMap=function(){return s};t.prototype.infixMap=function(){return p};t.prototype.bindingClasses=function(){return f};t.prototype.parse=function(e){var t=e.consume();if(!t){throw new o.ParseError("Unexpected end of tokens.",o.token2pos(e.last()))}var r=this.prefixMap()[t.type];if(!r){throw new o.ParseError('Unexpected token "'+t.text+'".',o.token2pos(t))}var n=r.parse(this,e,t);while(true){var a=e.peek();if(!a){break}if(a.type=="("&&a.first_column!=e.last().last_column){break}if(a.type==":"){e.consume();var s=this.expressionParser.parseTokenStream(e,0);return new i.SinkAssignmentNode(n,s,o.join(n.pos,o.token2pos(e.last())))}if(a.type=="="){e.consume();var s=this.expressionParser.parseTokenStream(e,0);return new i.VariableAssignmentNode(n,s,o.join(n.pos,o.token2pos(e.last())))}var u=this.infixMap()[a.type];if(!u){break}e.consume();n=u.parse(this,e,n,a)}throw new o.ParseError("Toplevel declarations must be variable or sink assignments.",o.token2pos(e.last()))};return t}(a);t.TopLevelParser=d});define("core/computation-layer/parser/main",["require","exports","./helpers","./context","./token-stream","./parser"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});function a(e,t){var a=n.getContext();n.setContext(t);var s=[];var u=new i.TokenStream(e);var c=new o.TopLevelParser;while(u.peek()){try{s.push(c.parse(u))}catch(e){if(e instanceof r.ParseError){return{nodes:s,errors:[{msg:"Syntax Error: "+e.message,componentId:t.componentId,pos:e.pos}]}}else{var l=u.last();var p=l?{first_line:l.line,last_line:l.line,first_column:l.first_column,last_column:l.last_column,componentId:t.componentId}:{first_line:1,last_line:1,first_column:0,last_column:0,componentId:t.componentId};return{nodes:s,errors:[{msg:"Unexpected error: "+e.message,componentId:t.componentId,pos:p}]}}}}n.setContext(a);return{nodes:s,errors:[]}}t.parse=a;function s(e,t){return(e.first_line<t.first_line||e.first_line==t.first_line&&e.first_column<=t.first_column)&&(e.last_line>t.last_line||e.last_line==t.last_line&&e.last_column>=t.last_column)}function u(e,t){if(!s(e.pos,t)){return undefined}if(e.type=="BinaryOperation"&&e.operator=="."){return e}for(var r=0,n=e.getChildren();r<n.length;r++){var i=n[r];var o=u(i,t);if(o){return o}}return undefined}function c(e,t){var r;for(var n=0,i=e;n<i.length;n++){var o=i[n];var a=u(o,t);if(a&&(!r||s(a.pos,r.pos))){r=a}}return r}function l(e,t){var r=n.getContext();n.setContext(t);var a=[];var s=new i.TokenStream(e);var u=new o.ExpressionParser;while(s.peek()){try{a.push(u.parseTokenStream(s,0))}catch(e){a.push.apply(a,u.partialExpressions)}}n.setContext(r);var l=e.split("\n");var p=l.length-1;var f=l[p].length-1;return c(a,{componentId:t.componentId,stepId:t.stepId,first_line:p+1,last_line:p+1,first_column:f,last_column:f})}t.parseExpressionForHint=l});define("core/computation-layer/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e,t,r,n,i,o){this.name=e;this.analyzeValueType=t;this.params=r;this.description=n;this.deprecated=i;this.internal=o}return e}();t.NewSinkSpec=r;var n=function(){function e(){this.sinkMap={}}e.prototype.registerSinkSpec=function(e){this.sinkMap[e.name]=e;return this};e.prototype.registerSinksFrom=function(e){for(var t in e.sinkMap){this.registerSinkSpec(e.sinkMap[t])}return this};e.prototype.getSinkSpec=function(e){return this.sinkMap[e]};e.prototype.getAvailableSinksMessage=function(){var e=this.getAvailableSinks();return e.length==0?"There's no way to control this component with CL yet.":"Valid sinks: "+e.join(", ")};e.prototype.getAvailableSinks=function(){return Object.keys(this.sinkMap)};return e}();t.ComponentSinkSpecification=n;function i(e){var t=new n;for(var i in e){var o=e[i];t.registerSinkSpec(new r(i,o.analyzeValueType.type=="concrete"?{type:"concrete",validator:o.analyzeValueType.valueType}:o.analyzeValueType,o.params||[],o.description,o.deprecated,o.internal))}return t}t.convertSinkList=i});define("core/computation-layer/analyze/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(){this.isError=true}return e}();t.ErrorRecorded=r;var n=function(){function e(e,t){this.message=e;this.errRef=t;this.isError=true}return e}();t.StatementError=n;var i=function(){function e(e){this.errRef=e;this.isError=true;this.message="This statement is part of a circular dependency"}return e}();t.CircularDependencyError=i;var o=function(){function e(e,t){this.message=e;this.componentId=t;this.isError=true}return e}();t.ComponentError=o});define("core/computation-layer/mangle",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});function r(e){return JSON.stringify({componentId:e.componentId,symbol:e.symbol})}t.mangleVariableSymbol=r;function n(e){return JSON.stringify({componentId:e.componentId,sinkName:e.sinkName,params:e.params})}t.mangleSinkSymbol=n;function i(e){return JSON.stringify({componentId:e.componentId,sourceName:e.sourceName,params:e.params})}t.mangleSourceSymbol=i;function o(e){return JSON.stringify({componentId:e.componentId,statementIndex:e.statementIndex})}t.mangleStatementReference=o;function a(e){return JSON.parse(e)}t.unmangle=a});define("core/computation-layer/analyze/exports",["require","exports","../parser/ast","../mangle","core/lib/assert-unreachable","./types","../helpers"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});function s(e){var t={};var r=[];var i={};for(var a in e){var s=e[a];for(var c=0;c<s.length;c++){var l={componentId:a,statementIndex:c};var p=s[c];try{var f=u(p);if(!f){r.push(l)}else{if(!t[f])t[f]=[];t[f].push(l)}}catch(e){if(e instanceof o.StatementError){i[n.mangleStatementReference(l)]=e}else{throw e}}}}var d={};for(var f in t){var h=t[f];if(h.length==1){var m=h[0];d[f]=m;r.push(m)}else{for(var y=0,g=h;y<g.length;y++){var l=g[y];var v=n.unmangle(f);var b=e[l.componentId][l.statementIndex];if(v.symbol){i[n.mangleStatementReference(l)]=new o.StatementError("You can't define "+v.symbol+" in two places",b)}else{i[n.mangleStatementReference(l)]=new o.StatementError("Duplicate definition",b)}}}}return{validExportMap:d,validStatements:r,invalidStatements:i}}t.analyzeExports=s;function u(e){if(e.type=="VariableAssignment"){var t=e.left;if(t.type=="Identifier"){return n.mangleVariableSymbol({componentId:t.pos.componentId,symbol:t.value})}return undefined}if(e.type=="SinkAssignment"){var s=e.left;switch(s.type){case"Identifier":return n.mangleSinkSymbol({componentId:s.pos.componentId,sinkName:s.value,params:[]});case"Function":var u=s.args,c=u[0],l=u.slice(1);if(c.type!="Identifier")throw new o.StatementError("Expected identifier",e);var p=l.map(function(t){if(!(t instanceof r.ConstantNode)){throw new o.StatementError("All function parameters must be constants.",e)}return a.isCLStringType(t.value)?a.synthesizeStringInternal(t.value):a.isCLLatexType(t.value)?t.value.latex:t.value});return n.mangleSinkSymbol({componentId:s.pos.componentId,sinkName:c.value,params:p});default:throw new o.StatementError("Unhandled sink type",e)}}return i.assertUnreachable(e)}});define("core/computation-layer/library/patterns.matching",["require","exports","tslib","core/lib/assert-unreachable","core/lib/mathtools","core/lib/evaluator-helpers"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});function a(e,t,r){if(!e||!t){return undefined}if(t.type=="Err"){return undefined}var i=O(r,e);var o=s(t.span);while(t.type=="Paren"){if(i.rejectParens)return undefined;t=t.args[0]}switch(e.type){case"number":return b(e,o,t);case"sum":return h(e,o,t,i);case"exponent":return x(e,o,t,i);case"fraction":return _(e,o,t,i);case"negative":return T(e,o,t,i);case"radical":return S(e,o,t,i);case"difference":return w(e,o,t,i);case"product":return m(e,o,t,i);case"contains":return y(e,o,t,i);case"literal":return M(e,o,t);case"expression":return C(e,o,t);case"or":return v(e,o,t,i);case"scientific":return k(e,o,t);case"mixedNumber":return P(e,o,t);default:throw n.assertUnreachable(e)}}t.matchPattern=a;function s(e){return e.input.slice(e.start,e.end)}function u(e,t){var r=JSON.stringify(e,function(e,t){return e=="span"?undefined:t});var n=JSON.stringify(t,function(e,t){return e=="span"?undefined:t});return r==n}function c(e,t,r){var n=[];for(var i=0;i<t.length;i++){var o=t[i];if(o.type=="repeated"){var s={type:"repeated",matches:[]};var u=o.min||0;var c=o.max||Infinity;for(var l=0;l<e.length;l++){var p=e[l];var f=a(o.pattern,p,r);if(f){e.splice(l,1);l--;s.matches.push(f);if(s.matches.length>=c){break}}else if(r.strictOrder){break}}if(s.matches.length<u)return undefined;n.push(s)}else{var d=false;for(var l=0;l<e.length;l++){var p=e[l];var f=a(o,p,r);if(f){d=true;e.splice(l,1);n.push(f);break}if(r.strictOrder)break}if(!d)return undefined}}if(e.length>0){return undefined}return n}function l(e,t){if(e.type=="Paren"&&!t.rejectParens){return l(e.args[0],t)}if(e.type=="Add"){return r.__spreadArrays(l(e.args[0],t),l(e.args[1],t))}return[e]}function p(e){var t=[];for(var r=0,n=A(e.terms)||[];r<n.length;r++){var i=n[r];if(i.type=="sum"){t.push.apply(t,p(i))}else{t.push(i)}}return t}function f(e){if(e.type=="Paren"){return f(e.args[0])}if(e.type=="Mul"){return r.__spreadArrays(f(e.args[0]),f(e.args[1]))}if(e.type=="Juxt"){return r.__spreadArrays(f(e.args[0]),f(e.args[1]))}return[e]}function d(e){var t=[];for(var r=0,n=e.terms||[];r<n.length;r++){var i=n[r];if(i.type=="product"){t.push.apply(t,d(i))}else{t.push(i)}}return t}function h(e,t,n,i){if(!n)return undefined;var o=c(l(n,i),p(e),r.__assign(r.__assign({},i),{strictOrder:!!e.strictOrder}));return o?{type:"sum",latex:t,terms:N(o)}:undefined}function m(e,t,n,i){if(!n)return undefined;var o=c(f(n),d(e),r.__assign(r.__assign({},i),{strictOrder:!!e.strictOrder}));return o?{type:"product",latex:t,terms:N(o)}:undefined}function y(e,t,r,n){var i=g(L(e.terms[0]),r,n);return i?{type:"contains",latex:t,terms:[D(i)]}:undefined}function g(e,t,r){if(t==undefined)return undefined;var n=a(e,t,r);if(n)return n;if(t.type=="Letter"||t.type=="Decimal"||t.type=="MixedNumber"||t.type==="EmptyRangeEnd"){return}if(t.type=="InequalityChain"||t.type=="EmptyPiecewise"||t.type=="Cmd"){return}else{for(var i=0,o=t.args||[];i<o.length;i++){var s=o[i];if(s.type=="Alphanumeric")return;var u=g(e,s,r);if(u)return u}}return undefined}function v(e,t,r,n){for(var i=0,o=e.options;i<o.length;i++){var s=o[i];if(a(L(s),r,n)){return{type:"or",latex:t}}}return undefined}function b(e,t,r){if(r.type=="Neg"){r=r.args[0]}if(r.type=="Decimal"||r.type=="MixedNumber"){if(e.integerOnly||e.conditions){var n=o.computeNumericValueFromLatex(t);if(e.integerOnly&&n%1!=0)return undefined;if(e.conditions){for(var a=0,s=e.conditions;a<s.length;a++){var u=s[a];var c=new i.context;c.processChangeSet({statements:[{id:"condition",latex:"f(x)=\\{"+u+"\\}"}]});var l=i.parser.parse("f("+t+")");var p=l.tryGetConcreteTree(i.policies.graphing,c.frame);var f=p.asValue();if(f!=1)return undefined}}}return{type:"number",latex:t}}return undefined}function x(e,t,r,n){if(r.type=="Superscript"){var i=a(L(e.base),r.args[0],n);var o=a(L(e.power),r.args[1],n);return i&&o?{type:"exponent",base:D(i),power:D(o),latex:t}:undefined}return undefined}function _(e,t,r,n){if(r.type=="Frac"){var i=a(L(e.numerator),r.args[0],n);var o=a(L(e.denominator),r.args[1],n);return i&&o?{type:"fraction",numerator:D(i),denominator:D(o),latex:t}:undefined}return undefined}function S(e,t,r,n){if(e.degree){if(r.type!="Nthroot")return undefined;var i=a(L(e.degree),r.args[0],n);var o=a(L(e.radicand),r.args[1],n);return o&&i?{type:"radical",latex:t,radicand:D(o),degree:D(i)}:undefined}else{if(r.type!="Sqrt")return undefined;var o=a(L(e.radicand),r.args[0],n);return o?{type:"radical",latex:t,radicand:D(o)}:undefined}}function T(e,t,r,n){if(r.type!="Neg")return undefined;var i=a(L(e.negated),r.args[0],n);return i?{type:"negative",latex:t,negated:D(i)}:undefined}function w(e,t,r,n){if(r.type=="Sub"){var i=a(L(e.minuend),r.args[0],n);var o=a(L(e.subtrahend),r.args[1],n);return o&&i?{type:"difference",subtrahend:D(o),minuend:D(i),latex:t}:undefined}return undefined}function E(e,t){var r=i.expressionParser.parse(e);var n=i.expressionParser.parse(t);if(r.type=="Err"||n.type=="Err"){return false}return u(r,n)}t.latexEqual=E;function M(e,t,r){var n=i.expressionParser.parse(e.text);if(n.type=="Err"){return undefined}if(u(n,r)){return{type:"literal",latex:t}}return undefined}function C(e,t,r){if(r.type=="Err")return undefined;return{type:"expression",latex:t}}function I(e){var t=1;if(e.type=="Neg"){e=e.args[0];t=-1}if(e.type!="Decimal")return undefined;var r=parseFloat(s(e.span));if(r<1)return undefined;if(r>=10)return undefined;return r*t}function P(e,t,r){if(r.type!="MixedNumber")return undefined;return{type:"mixedNumber",latex:t,whole:+r.whole,numerator:+r.num,denominator:+r.den}}function k(e,t,r){if(r.type!="Mul")return undefined;var n=r.args[1];if(n.type!="Superscript")return undefined;var i=I(r.args[0]);if(i==undefined)return undefined;var o=n.args[0];if(o.type!="Decimal")return undefined;if(parseFloat(s(o.span))!=10)return undefined;var a=n.args[1];var u=1;if(a.type=="Neg"){u=-1;a=a.args[0]}if(a.type!="Decimal")return undefined;var c=parseFloat(s(a.span));if(c!=Math.round(c))return undefined;return{type:"scientific",latex:t,coefficient:i,exponent:c*u}}function O(e,t){var n={};if("rejectParens"in t){n.rejectParens=!!t.rejectParens}if("strictOrder"in t){n.strictOrder=!!t.strictOrder}return r.__assign(r.__assign({},e),n)}function D(e){return e}function N(e){return e}function A(e){return e}function L(e){return e}});define("core/computation-layer/library/builtin",["require","exports","underscore","core/lib/i18n","../helpers","./patterns.matching","core/computation-layer/cl-types"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.library={functions:{copy:{internal:true,version:"v2",description:function(){return n.EMPTY},lookup:function(e){if(e.length!==1){throw Error("Copy function only accepts one argument")}return{valueType:e[0].type,body:function(e){return e}}}},stringConcat:{internal:true,description:function(){return n.EMPTY},version:"v2",lookup:function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if(!(a.Types.string.matches(n.type)||a.Types.number.matches(n.type)||a.Types.latex.matches(n.type))){throw Error("Unexpected type in string: "+n.type)}}return{valueType:a.Types.string,body:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=[];for(var n=0,o=e;n<o.length;n++){var a=o[n];if(i.isCLStringType(a)){r.push.apply(r,a.parts)}else{r.push(a)}}return{type:"string",parts:r}}}}},latexConcat:{internal:true,description:function(){return n.EMPTY},version:"v2",lookup:function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if(!(a.Types.number.matches(n.type)||a.Types.latex.matches(n.type))){throw Error("Unexpected type in latex interpolation: "+n.type)}}return{valueType:a.Types.latex,body:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r="";for(var n=0,o=e;n<o.length;n++){var a=o[n];if(a==undefined||typeof a=="number"&&isNaN(a)){r+="undefined"}else if(i.isCLStringType(a)){r+=i.synthesizeStringInternal(a)}else if(i.isCLLatexType(a)){r+=a.latex}else{r+=a}}return{latex:r}}}}},choose:{internal:true,version:"v2",description:function(){return n.EMPTY},lookup:function(e){var t;if(e.length<3)throw new Error("Incomplete when/otherwise clause");var n=(t=r.partition(e,function(t,r){return!!(r%2)||r+1===e.length}),t[0]),i=t[1];for(var o=0,s=i;o<s.length;o++){var u=s[o];if(!a.Types.boolean.matches(u.type)){throw new Error("Every 'when' must be followed by a boolean condition")}}var c=n[0].type;if(c.matches(a.Types.latex)&&r.any(n,function(e){return e.type.matches(a.Types.string)})){c=a.Types.string}var l=[];for(var p=0,f=n;p<f.length;p++){var d=f[p];if(!c.matches(d.type)){if(c.matches(a.Types.string)&&d.type.matches(a.Types.latex)){}else{throw Error("Mismatched types in choose - "+c.toString()+" and "+d.toString()+" differ")}}}return{valueType:c,warnings:l,desiredArgTypes:r.range(e.length).map(function(t){if(!!(t%2)||t+1==e.length){return c}else{return a.Types.boolean}}),body:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r,n,i,o,a;a=e.slice(0,-1);for(n=i=0,o=a.length;i<o;n=i+=2){r=a[n];if(r){return e[n+1]}}return e[e.length-1]}}}},and:{version:"v3",internal:true,description:function(){return n.i18n.s("cl-docs-description-lib-and")},argTypes:[a.Types.boolean,a.Types.boolean],outputType:a.Types.boolean,value:function(e,t){return e&&t}},or:{version:"v3",internal:true,description:function(){return n.i18n.s("cl-docs-description-lib-or")},argTypes:[a.Types.boolean,a.Types.boolean],outputType:a.Types.boolean,value:function(e,t){return e||t}},not:{version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-not")},argTypes:[a.Types.boolean],outputType:a.Types.boolean,noUndefinedArgs:true,value:function(e){return!e}},isDefined:{version:"v2",description:function(){return n.i18n.s("cl-docs-description-lib-is-defined")},lookup:function(e){if(e.length!==1){throw Error("isDefined takes a 1 argument.  I got "+e.length)}return{valueType:a.Types.boolean,body:function(e){return e!=null&&!r.isNaN(e)}}}},isUndefined:{version:"v2",description:function(){return n.i18n.s("cl-docs-description-lib-is-undefined")},lookup:function(e){if(e.length!==1){throw Error("isUndefined takes a 1 argument.  I got "+e.length)}return{valueType:a.Types.boolean,body:function(e){return!(e!=null)||r.isNaN(e)}}}},firstDefinedValue:{version:"v2",description:function(){return n.i18n.s("cl-docs-description-lib-first-defined-value")},lookup:function(e){if(e.length==0){throw new Error("firstDefinedValue requires at least one argument.")}var t=e[0].type;if(r.any(e,function(e){return e.type.matches(a.Types.string)})){t=a.Types.string}var n=[];for(var i=0,o=e;i<o.length;i++){var s=o[i];if(!t.matches(s.type)){if(t.matches(a.Types.string)&&s.type.matches(a.Types.latex)){}else{throw new Error("All arguments to firstDefinedValue must be the same type"+(t.type+" doesn't match "+s.type.type))}}}return{valueType:t,warnings:n,desiredArgTypes:r.range(e.length).map(function(){return t}),body:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n,i,o;for(n=0,i=e.length;n<i;n++){o=e[n];if(o!=null&&!r.isNaN(o)){return o}}return void 0}}}},eq:{version:"v2",description:function(){return n.EMPTY},internal:true,lookup:function(e){var t,r;if(e.length!==2){throw Error("Equality test requires two objects.  I got "+e.length)}t=e[0].type,r=e[1].type;var n=t;if(!(t.matches(a.Types.number)||t.matches(a.Types.string)||t.matches(a.Types.latex))){throw Error("Equality checks only work for numbers, strings and latex right now")}if(n.matches(a.Types.latex)){n=a.Types.string}var s=[];for(var u=0,c=e;u<c.length;u++){var l=c[u];var p=l.type;if(!p.matches(n)){if(p.matches(a.Types.latex)&&n.matches(a.Types.string)){}else{throw Error("Objects of different types are never equal (in this case "+t+" and "+r)}}}return{valueType:a.Types.boolean,warnings:s,desiredArgTypes:[t,r],body:function(e,t){if(e==undefined||t==undefined){return false}if(i.isCLLatexType(e)&&i.isCLLatexType(t)){return o.latexEqual(e.latex,t.latex)}var r=i.isCLStringType(e)?i.synthesizeStringInternal(e):i.isCLLatexType(e)?e.latex:e;var n=i.isCLStringType(t)?i.synthesizeStringInternal(t):i.isCLLatexType(t)?t.latex:t;return r===n}}}},isBlank:{version:"v2",description:function(){return n.i18n.s("cl-docs-description-lib-is-blank")},lookup:function(e){if(e.length!=1){throw new Error("isBlank expects a single parameter")}if(!(a.Types.string.matches(e[0].type)||a.Types.latex.matches(e[0].type))){throw new Error("isBlank accepts a string or latex, but got "+e[0].type)}return{valueType:a.Types.boolean,body:function(e){if(e==undefined){return true}var t;if(i.isCLLatexType(e)){t=e.latex.trim()}else if(i.isCLStringType(e)){t=i.synthesizeStringInternal(e).trim()}else{throw new Error("Internal error. isBlank expected argument of string or latex type but got "+e)}return t.length==0}}}}},types:{},constants:{}};function s(e,r,i){t.library.functions[e]={internal:true,version:"v2",description:function(){return n.EMPTY},lookup:function(e){if(e.length!==2){throw Error(r+" operator requires two objects.  I got "+e.length)}var t=e[0].type;var n=e[1].type;if(!(a.Types.number.matches(t)&&a.Types.number.matches(n))){throw Error(r+" operator can only compare numbers. I see '"+t+" "+r+" "+n+"'")}return{valueType:a.Types.boolean,body:i}}}}s("gt",">",function(e,t){return e>t});s("gte",">=",function(e,t){return e>=t});s("lt","<",function(e,t){return e<t});s("lte","<=",function(e,t){return e<=t});function u(e){return e?{type:"string",parts:[e]}:undefined}t.castLatexToString=u;function c(e){return e?{latex:i.synthesizeStringInternal(e)}:undefined}t.castStringToLatex=c});define("core/computation-layer/analyze/helpers",["require","exports","underscore","../parser/ast","./types","../cl-types","../helpers"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});function s(e,t,r,s){if(e.length>t.length){s({msg:"Expected "+t.length+" parameters but got "+e.length+'"',componentId:r.pos.componentId,pos:r.pos,warning:true})}var u=[];for(var c=0;c<t.length;c++){var l=e[c];var p=t[c];if(l==null){if(p.default!=null){if(a.isCLStringType(p.default)){u.push(a.synthesizeStringInternal(p.default))}else{u.push(p.default)}continue}else{throw new i.StatementError("Missing required parameter "+(c+1)+" ("+p.name+":"+p.type+")",r)}}if(!(l instanceof n.ConstantNode)){throw new i.StatementError("Parameters to sinks and sources must be constants",l)}var f=void 0;if(l.valueType.matches(p.type)){f=l.value}else{if(o.Types.string.matches(l.valueType)&&o.Types.number.matches(p.type)&&a.synthesizeStringInternal(l.value).match("^[0-9]+$")){s({msg:"The "+p.name+" parameter should be a number, not a string (no quotes)",componentId:l.pos.componentId,pos:l.pos,warning:true});f=parseInt(a.synthesizeStringInternal(l.value))}else if(o.Types.string.matches(p.type)&&o.Types.latex.matches(l.valueType)){f={type:"string",parts:[l.value.latex]}}else if(o.Types.latex.matches(p.type)&&o.Types.string.matches(l.valueType)){f={latex:a.synthesizeStringInternal(l.value)}}else{throw new i.StatementError('Expected parameter "'+p.name+'" to be a '+p.type+", but got "+l.valueType,l)}}if(p.validate){var d=void 0;switch(p.type){case o.Types.boolean:d=p.validate(f);break;case o.Types.number:d=p.validate(f);break;case o.Types.string:d=p.validate(f);break;case o.Types.latex:d=p.validate(f);break;default:throw new Error("Unexpected type")}switch(d.result){case"ok":break;case"warn":s({msg:d.msg,componentId:l.pos.componentId,pos:l.pos,warning:true});break;case"error":throw new i.StatementError(d.msg,l)}}if(a.isCLStringType(f)){u.push(a.synthesizeStringInternal(f))}else{u.push(f)}}return u}t.analyzeParams=s;function u(e){return e.type=="BinaryOperation"&&e.operator=="."}t.isMemberAccess=u;function c(e){return function(){var t=[];for(var n=0;n<arguments.length;n++){t[n]=arguments[n]}if(r.any(t,function(e){return e==undefined})){return undefined}return e.apply(void 0,t)}}t.enforceNoUndefinedArgs=c});define("core/computation-layer/analyze/sinks",["require","exports","../parser/ast","../cl-types","./types","./helpers","core/lib/log"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});function s(e,t,n){var o=[];for(var s in e){var c=e[s];for(var l=0;l<c.length;l++){var p={componentId:s,statementIndex:l};var f=c[l];if(f instanceof r.SinkAssignmentNode){try{var d=u(f.left,t,p,n);o.push(d)}catch(e){if(e instanceof i.StatementError){a.log("Ignoring error in analyzeSinks"+JSON.stringify(e))}else{throw e}}}}}return o}t.analyzeSinks=s;function u(e,t,r,n){var a;var s=[];var u;switch(e.type){case"Function":var c=void 0;a=e.args,c=a[0],s=a.slice(1);if(c.type!="Identifier")throw new i.StatementError("Couldn't understand this sink declaration",e);u=c.value;break;case"Identifier":u=e.value;break;default:throw new i.StatementError("Couldn't understand this sink declaration",e)}var l=e.pos.componentId;var p=t[l];if(!p){throw{msg:"Internal CL Error.  Could not find component '"+l+"'",componentId:l}}if(!p.sinks){throw new i.StatementError("There's no way to control this component with CL yet",e)}var f=p.sinks.getSinkSpec(u);if(f==null){throw new i.StatementError('Could not find sink "'+u+'". '+p.sinks.getAvailableSinksMessage(),e)}var d=f.params||[];var h=o.analyzeParams(s,d,e,n);return{componentId:l,sinkName:u,paramValues:h,ref:r,sinkSpec:f}}function c(e,t,r){var a;var s;var u=r.nodes[t];if(!u){throw new Error("Internal error - node "+t+" not found")}var c=[];switch(e.type){case"Function":var p=void 0;a=e.args,p=a[0],c=a.slice(1);if(p.type!="Identifier"){throw new i.StatementError("Couldn't understand this sink declaration",e)}s=p.value;break;case"Identifier":s=e.value;break;default:throw new i.StatementError("Couldn't understand this sink declaration",e)}var f=r.components[e.pos.componentId];if(!f){throw new i.ComponentError("Internal CL Error.  Could not find component '"+e.pos.componentId+"'",e.pos.componentId)}if(!f.sinks){throw new i.StatementError("There's no way to control this component with CL yet",e)}var d=f.sinks.getSinkSpec(s);if(d==null){throw new i.StatementError('Could not find sink "'+s+'". '+f.sinks.getAvailableSinksMessage(),e)}var h=d.params||[];var m=o.analyzeParams(c,h,e,function(e){return r.error(e)});var y=t;var g=l(d,m,f.config||{});if(!g.matches(u.valueType)){if(g.matches(n.Types.latex)&&n.Types.string.matches(u.valueType)){y=r.castStringToLatex(t)}else if(g.matches(n.Types.string)&&n.Types.latex.matches(u.valueType)){y=r.castLatexToString(t)}else{throw new i.StatementError('Sink "'+d.name+'" expects a '+g+" but got a "+u.valueType,e)}}var v=r.sinks[e.pos.componentId];if(!v){v=r.sinks[e.pos.componentId]={}}var b=v[s];if(!b){b=v[s]=[]}b.push({componentId:e.pos.componentId,sinkName:s,validator:g,params:m,dependencies:[y]});return}t.analyzeSink=c;function l(e,t,r){if(e.analyzeValueType.type=="concrete"){return e.analyzeValueType.validator}else{return e.analyzeValueType.analyze(t,r).valueType}}});define("core/random-seed",["require","exports","tslib"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e){this.seed=e}e.prototype.toString=function(){return this.seed};e.fromString=function(t){return new e(t)};return e}();t.RandomSeed=n;function i(e,t){if(!e){return undefined}var n=e.randomSeed;var i=t.toString();if(n&&n.substr(n.length-i.length)==i){throw new Error("Attempted to repeatedly apply random seed.")}return r.__assign(r.__assign({},e),{randomSeed:n+":"+i})}t.populateRandomSeed=i;function o(e){return e}t.bypassRandomSeed=o});define("core/computation-layer/analyze/source",["require","exports","tslib","./types","./helpers","core/random-seed","underscore","../cl-types","../helpers"],function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});function c(e,t,r,o){if(t.type!="Identifier"){throw new n.StatementError("The value after the dot must be the name of a source - this looks more complicated",t)}var s=t.value;var u=o.components[e];var c=u&&u.alias;if(e==null){var h=a.keys(o.componentAliasMap);var m=h.length===0?"To refer to data from other components, you need to give them\n    a name.  You haven't named any components yet.":"The components you've named so far are\n    "+JSON.stringify(h)+".";throw new n.StatementError('Could not find component "'+c+'". '+m,t)}var g=o.components[e];if(g==null){throw new n.StatementError("Internal CL error- could not find component for id",t)}var b=g.sources&&g.sources[s];if(b==null){var x=y(g);var _=x.length===0?"It actually doesn't have any sources at all.  Sorry about that.":"Your options are "+JSON.stringify(x)+".";throw new n.StatementError('Component "'+c+'" has no source "'+s+'".  '+_,t)}var S=i.analyzeParams(r,b.params||[],t,function(e){return o.error(e)});var T=f(b,S,e,o);var w=b.computeFromResponse,E=b.analyzeSinkSourceDependencies;var M=b.publishedBy&&o.env.publishersAvailable.indexOf(b.publishedBy)>=0;if(w&&!M){return l({componentId:e,sourceName:s,sourceComponent:g,valueType:T,paramValues:S,sourceSpec:b,analysis:o})}else if(E&&!M){return p({componentId:e,sourceName:s,sourceNode:t,paramValues:S,sourceSpec:b,analysis:o,valueType:T})}else{if(E){d({componentId:e,sourceSpec:b,sourceNode:t,paramValues:S,analysis:o,valueType:T})}return v({type:"controllerSource",sourceName:s,componentId:e,params:S,valueType:T},o)}}t.analyzeSource=c;function l(e){var t=e.analysis,r=e.componentId,n=e.paramValues,i=e.sourceComponent,a=e.sourceName,s=e.sourceSpec,c=e.valueType;var l=m(r,a,t);var p=i.config||{};return t.registerNode({type:"function",name:a+JSON.stringify(n),fn:function(e,t){return s.computeFromResponse(t,{config:p,params:n,valueType:c,randomSeed:o.RandomSeed.fromString(u.synthesizeStringInternal(e))})},valueType:c,dependencies:["randomSeedNodeId",l]})}function p(e){var t=e.analysis,n=e.componentId,i=e.paramValues,a=e.sourceName,s=e.sourceNode,c=e.sourceSpec,l=e.valueType;var p=m(n,a,t);var f=d({componentId:n,sourceSpec:c,sourceNode:s,paramValues:i,analysis:t,valueType:l}),h=f.sinkDependencies,y=f.sourceFunction,g=f.sinkNodeIds;return t.registerNode({type:"function",name:a+JSON.stringify(i),fn:function(e,r){var n=[];for(var i=2;i<arguments.length;i++){n[i-2]=arguments[i]}var a={};for(var s=0;s<h.length;s++){var c=h[s];var l=n[s];var p=c.sinkName;if(a[p]==undefined)a[p]=[];a[p].push({value:l,params:c.paramValues,valueType:t.nodes[g[s]].valueType})}return y({randomSeed:o.RandomSeed.fromString(u.synthesizeStringInternal(e)),response:r,sinks:a})},valueType:l,dependencies:r.__spreadArrays(["randomSeedNodeId",p],g)})}function f(e,t,r,n){if(e.analyzeValueType.type=="concrete"){return e.analyzeValueType.valueType}else{var i=n.components[r];var o=e.analyzeValueType.analyze(t,i.config||{});return o.valueType}}function d(e){var t=e.analysis,r=e.componentId,i=e.sourceSpec,o=e.sourceNode,s=e.paramValues,u=e.valueType;var c=[];var l=t.sinkSummaries.filter(function(e){return e.componentId==r}).map(function(e){return{name:e.sinkName,params:e.paramValues,registerDependency:function(){c.push(e)}}});var p=t.components[r];var f=i.analyzeSinkSourceDependencies;if(!f){throw new Error("analyzeSourceNoController called with a source that does not define analyzeSinkSourceDependencies")}var d=f({sinks:l,params:s,config:p.config||{},valueType:u,warn:function(e){return t.error({msg:e,componentId:o.pos.componentId,pos:o.pos,warning:true})}});for(var h=0,m=c;h<m.length;h++){var y=m[h];try{t.analyzeStatement(y.ref)}catch(e){}}var g=[];for(var v=0,b=c;v<b.length;v++){var x=b[v];var _=false;var S=t.sinks[x.componentId];if(S){var T=S[x.sinkName];if(T){for(var w=0,E=T;w<E.length;w++){var M=E[w];if(a.isEqual(M.params,x.paramValues)){g.push(M.dependencies[0]);_=true}}}}if(!_){var C=void 0;if(x.paramValues.length>1)C=x.sinkName+"("+x.paramValues.map(function(e){return JSON.stringify(e)}).join(", ")+")";else C=x.sinkName;throw new n.StatementError("This source depends on sink "+C+", which has an error",o)}}return{sourceFunction:d,sinkDependencies:c,sinkNodeIds:g}}function h(e,t){var r=e.componentId;var i=t.components[r];if(i==undefined){throw new n.StatementError("Unable to find component "+r+" from rawSource",e)}var o="calculatorState";var a=i.sources&&i.sources[o];if(a==undefined)throw new n.StatementError("Unable to find source "+o+" from rawSource",e);return p({componentId:r,sourceName:o,sourceNode:e,paramValues:[],valueType:s.Types.calculatorStateWithSinkValues,sourceSpec:a,analysis:t})}t.analyzeCalculatorReference=h;function m(e,t,r){var n=r.responseSources[e];if(n)return n;var i=r.registerNode({type:"responseSource",componentId:e,valueType:s.Types.response});r.responseSources[e]=i;g(e,t,r);return i}function y(e){var t=[];if(e.sources==undefined)return t;for(var r in e.sources){if(e.sources[r].internal)continue;t.push(r)}return t}function g(e,t,r){if(!r.sourcesUsed[e]){r.sourcesUsed[e]={}}r.sourcesUsed[e][t]=true}function v(e,t){for(var r=0,n=t.controllerSources;r<n.length;r++){var i=n[r];if(a.isEqual(t.nodes[i],e)){return i}}var o=t.registerNode(e);t.controllerSources.push(o);g(e.componentId,e.sourceName,t);return o}t.registerControllerSource=v});define("core/computation-layer/aggregator",["require","exports","./types","./cl-types","core/lib/i18n"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSources={aggregateSource:{description:function(){return i.i18n.raw("Internal implementation of aggregation")},publishedBy:"aggregate",params:[{name:"key",type:n.Types.string}],analyzeValueType:{type:"concrete",valueType:n.Types.numberList}}};t.listSinks=r.convertSinkList({aggregateSink:{description:function(){return i.i18n.raw("Internal implementation of aggregation")},analyzeValueType:{type:"concrete",valueType:n.Types.number}}});function o(e){return"aggregate-"+e.componentId+"-"+e.first_line+"-"+e.first_column}t.generateAggregateId=o;function a(e){return/aggregate-.*/.test(e)}t.isAggregateId=a});define("core/computation-layer/analyze/expression",["require","exports","tslib","../parser/ast","./source","../cl-types","./types","../aggregator","../helpers","underscore","core/lib/assert-unreachable","./helpers"],function(e,t,r,n,i,o,a,s,u,c,l,p){"use strict";Object.defineProperty(t,"__esModule",{value:true});function f(e,t){switch(e.type){case"Number":case"Boolean":case"String":case"Latex":return d(e,t);case"BinaryOperation":return v(e,t);case"Identifier":return S(e,t);case"Function":return w(e,t);case"Choose":return h(e,t);case"CalculatorReference":return i.analyzeCalculatorReference(e,t);default:return l.assertUnreachable(e)}}t.analyzeExpression=f;function d(e,t){if(e.type=="Latex"){var n=void 0;var i=/\\\\/g;while((n=i.exec(e.value.latex))!=undefined){t.error({msg:"Escaping slashes in latex string literals is no longer necessary or supported.",componentId:e.pos.componentId,pos:r.__assign(r.__assign({},e.pos),{first_column:e.pos.first_column+n.index+1,last_column:e.pos.first_column+n.index+3}),warning:true})}}return t.registerNode({type:"constant",valueType:e.valueType,value:e.value})}function h(e,t){var r=t.library.functions["choose"];if(r==null){throw new a.StatementError("CL error - choose not found in standard library",e)}var n=[];for(var i=0,o=e.cases;i<o.length;i++){var s=o[i],u=s.predicate,c=s.consequent;n.push(u,c)}n.push(e.otherwise);return x("choose",e,r,n,t)}function m(e,t){if(e.args.length!=2){throw new a.StatementError("Aggregations require a single argument.",e)}var r=f(e.args[1],t);var n=t.nodes[r];var u=n.valueType;if(!o.Types.number.matches(u)){throw new a.StatementError("Right now we can only aggregate numbers",e)}var c=s.generateAggregateId(e.pos);var l=t.sinks["aggregate"];if(!l){l=t.sinks["aggregate"]={}}var p=l["aggregateSink"];if(!p){p=l["aggregateSink"]=[]}p.push({componentId:"aggregate",sinkName:"aggregateSink",validator:o.Types.numberList,params:[c],dependencies:[r]});return i.registerControllerSource({type:"controllerSource",componentId:"aggregate",sourceName:"aggregateSource",valueType:o.Types.numberList,params:[c]},t)}function y(e,t,r){if(e.args.length!=2){throw new a.StatementError("imports require a single argument.",e)}var i=e.args[1];if(!i){throw new a.StatementError("Missing required import key.",e)}if(!(i instanceof n.ConstantNode&&o.Types.string.matches(i.valueType))){throw new a.StatementError("imports require an importKey parameter that is a contstant string",i)}var s=u.synthesizeStringInternal(i.value);var c=t.importSources[s];if(c){var p=t.nodes[c];if(r!=p.type){throw new a.StatementError("importKey "+s+" was used to import different types of values.",i)}return c}var f;switch(r){case"importNumber":f=t.registerNode({type:"importNumber",importKey:s,valueType:o.Types.number});break;case"importString":f=t.registerNode({type:"importString",importKey:s,valueType:o.Types.string});break;case"importNumberList":f=t.registerNode({type:"importNumberList",importKey:s,valueType:o.Types.numberList});break;default:return l.assertUnreachable(r)}t.importSources[s]=f;return f}var g={".":undefined,"=":"eq","<":"lt",">":"gt","<=":"lte",">=":"gte",AND:"and",OR:"or"};function v(e,t){if(e.operator=="."){var r=f(e.left,t);return b(r,e.right,[],t)}var n=g[e.operator];var i=n&&t.library.functions[n];if(!i||!n){throw new a.StatementError("Operator "+e.operator+" is not mapped to a library function.",e)}return x(n,e,i,[e.left,e.right],t)}function b(e,t,r,n){if(t.type!="Identifier"){throw new a.StatementError('Only identifiers can follow a ".", this looks more complicated',t)}var o=n.nodes[e];if(!o){throw new Error("Unexpected nodeId "+e)}if(o.valueType.type=="component"){var s=o.valueType.params.componentId;if(t.value=="script"){if(r.length>0){throw new a.StatementError("The .script call doesn't take any arguments.",t)}return n.resolveComponentScript(s)}return i.analyzeSource(s,t,r,n)}if(o.valueType.type=="componentScript"){var s=o.valueType.params.componentId;var u=n.resolveVariable(t.value,s,t);if(!u){var c=n.components[s];var l=c&&c.alias;throw new a.StatementError("Unable to find variable "+t.value+(l?" in component "+l:""),t)}else{return u}}var p=n.library.types[o.valueType.type];if(p==null){throw new a.StatementError("There are no supported members of type "+o.valueType,t)}var f=p[t.value];if(f==null){throw new a.StatementError("Type "+o.valueType+" has no member "+t.value,t)}var d=[e];d.push.apply(d,r);return x(t.value,t,f,d,n,true)}function x(e,t,n,i,s,u){var c=[];var d=[];for(var h=0,m=i;h<m.length;h++){var y=m[h];var g=void 0;if(typeof y=="string"){g=y}else{g=f(y,s)}c.push(g);var v=s.nodes[g];d.push(v.valueType)}switch(n.version){case undefined:case"v3":try{if(n.argTypes.length!=d.length){throw new Error("Expected "+n.argTypes.length+" arguments but got "+d.length+".")}for(var b=0;b<n.argTypes.length;b++){var x=n.argTypes[b];var S=d[b];if(!x.matches(S)){if(x.matches(o.Types.latex)&&S.matches(o.Types.string)){}else if(x.matches(o.Types.string)&&S.matches(o.Types.latex)){}else{if(u){if(b==0){throw new Error("Expected this method to be called on "+n.argTypes[0]+", but got "+d[0])}else{var T=n.argTypes.slice(1).join(", ");var w=d.slice(1).join(", ");throw Error("Expected "+(n.argTypes.length-1)+" arguments of types ["+T+"], got ["+w+"]")}}else{var T=n.argTypes.join(", ");var w=d.join(", ");throw Error("Expected "+n.argTypes.length+" arguments of types ["+T+"], got ["+w+"]")}}}}}catch(e){throw new a.StatementError(e.message,t)}return s.registerNode({type:"function",name:e,fn:n.noUndefinedArgs?p.enforceNoUndefinedArgs(n.value):n.value,valueType:n.outputType,dependencies:_(c,n.argTypes,s)});case"v2":var E=[];for(var b=0;b<i.length;b++){var y=i[b];E.push({type:d[b],pos:typeof y=="string"?t.pos:y.pos})}var M=t.pos.componentId+":"+t.pos.first_line+":"+t.pos.first_column;var C={locationIdentifier:M};var I=void 0;try{I=n.lookup(E,C)}catch(e){throw new a.StatementError(e.message,t)}if(I.warnings){for(var P=0,k=I.warnings;P<k.length;P++){var O=k[P];s.error(O)}}var D=c;if(I.prependGlobalConstants){D=r.__spreadArrays(I.prependGlobalConstants,D)}if(I.desiredArgTypes){D=_(D,I.desiredArgTypes,s)}return s.registerNode({type:"function",name:e,fn:n.noUndefinedArgs?p.enforceNoUndefinedArgs(I.body):I.body,valueType:I.valueType,dependencies:D});default:return l.assertUnreachable(n,"Expected function to have version but it was "+n.version)}}function _(e,t,r){if(e.length!=t.length){throw new Error("Expected the args & expected types to have the same length.")}var n=[];for(var i=0;i<e.length;i++){var a=e[i];var s=t[i];var u=r.nodes[a];if(!u){throw new Error("Expected analysis to contain node with id "+a)}var c=u.valueType;if(s.matches(c)){n.push(a)}else{if(s.matches(o.Types.latex)&&c.matches(o.Types.string)){n.push(r.castStringToLatex(a))}else if(s.matches(o.Types.string)&&c.matches(o.Types.latex)){n.push(r.castLatexToString(a))}else{throw new Error("Expected to be able to cast type "+c+" to type "+s)}}}return n}function S(e,t){var r=e.value;var n=e.pos.componentId;var i=t.resolveVariable(r,n,e);if(i)return i;var o=t.resolveComponent(r,e);if(o.result=="error")throw o.error;if(o.result=="resolved")return o.nodeId;var a=t.resolveConstant(r);if(a)return a;return T(t,e)}function T(e,t){var r=c.keys(e.componentAliasMap.aliases);if(r.length){throw new a.StatementError("Unable to find component or variable "+t.value+". The components you've named so far are "+JSON.stringify(r)+".",t)}else{throw new a.StatementError("Unable to find component or variable "+t.value+". To refer to data from other components, you need to give them a name.\nYou haven't named any components yet",t)}}function w(e,t){var r=e.args,n=r[0],i=r.slice(1);if(n.type=="Identifier"){if(n.value=="aggregate"){return m(e,t)}if(n.value=="importNumber"||n.value=="importString"||n.value==="importNumberList"){return y(e,t,n.value)}var o=t.library.functions[n.value];if(o==null){throw new a.StatementError("Unknown function '"+n.value+"'",e)}return x(n.value,e,o,i,t)}if(p.isMemberAccess(n)){var s=f(n.left,t);return b(s,n.right,i,t)}throw new a.StatementError("Attempt to call unknown type of function or source",n)}});define("core/computation-layer/analyze/main",["require","exports","tslib","core/lib/i18n","../parser/main","core/lib/assert-unreachable","../parser/ast","../types","../cl-types","./types","./exports","../library/builtin","./sinks","./expression","../mangle","underscore"],function(e,t,r,n,i,o,a,s,u,c,l,p,f,d,h,m){"use strict";Object.defineProperty(t,"__esModule",{value:true});var y=function(){function e(e,t,n){var i=this;this.components=e;this.library=t;this.env=n;this.errors=[];this.sinks={};this.controllerSources=[];this.responseSources={};this.importSources={};this.nodes={};this.variables={};this.constants={};this.componentNodes={};this.componentScriptNodes={};this.dependencyMap={};this.sourcesUsed={};this.stringToLatexCasts={};this.latexToStringCasts={};this.resolvedStatements={};this.pendingStatements={};this.invalidStatements={};this.componentAliasMap=this.computeAliasMap();this.ast=this.computeAST();if(n.insertThumbnailComponent){this.insertThumbnailComponent()}var o=this.ast;var a=l.analyzeExports(o),s=a.validExportMap,u=a.validStatements,c=a.invalidStatements;this.invalidStatements=r.__assign(r.__assign({},this.invalidStatements),c);for(var p=0,d=m.values(c);p<d.length;p++){var h=d[p];this.errors.push({msg:h.message,componentId:h.errRef.pos.componentId,pos:h.errRef.pos})}this.declarations=s;this.sinkSummaries=f.analyzeSinks(o,this.components,function(e){return i.error(e)});var y=function(e){g.tryAndRecord(function(){i.analyzeStatement(e)})};var g=this;for(var v=0,b=u;v<b.length;v++){var x=b[v];y(x)}}e.prototype.analyzeStatement=function(e){var t=h.mangleStatementReference(e);if(this.resolvedStatements[t]){return}var r=this.ast[e.componentId];var n=r&&r[e.statementIndex];if(!n){throw new Error("Expected "+JSON.stringify(e)+" to resolve to a top node but it did not.")}var i=this.invalidStatements[t];if(!!i){throw i}if(this.pendingStatements[t]){for(var a in this.pendingStatements){var s=h.unmangle(a);var u=this.ast[s.componentId];var l=u&&u[s.statementIndex];if(!l){throw new Error("Expected "+JSON.stringify(e)+" to resolve to a top node but it did not.")}this.invalidStatements[a]=new c.CircularDependencyError(l)}throw this.invalidStatements[t]}this.pendingStatements[t]=true;try{switch(n.type){case"VariableAssignment":var p=n.left;if(p.type=="Identifier"){var m=d.analyzeExpression(n.right,this);this.registerVariable(p.value,p.pos.componentId,m)}else{throw new c.StatementError("The left side of an assignment (=) must be an identifier. This looks different.Did you mean to use a sink (:) instead?",p)}break;case"SinkAssignment":var y=d.analyzeExpression(n.right,this);f.analyzeSink(n.left,y,this);break;default:return o.assertUnreachable(n)}}catch(e){delete this.pendingStatements[t];if(!this.invalidStatements[t]){this.invalidStatements[t]=e}throw this.invalidStatements[t]}delete this.pendingStatements[t];this.resolvedStatements[t]=true};e.prototype.analyzeExpressionForHint=function(e){return d.analyzeExpression(e,this)};e.prototype.insertThumbnailComponent=function(){var e={stepId:"thumbnail",sinks:s.convertSinkList({thumbnail:{description:function(){return n.i18n.raw("internal use only")},analyzeValueType:{type:"concrete",valueType:u.Types.calculatorStateWithSinkValues},params:[{name:"componentId",type:u.Types.string}]}})};var t=[];for(var r in this.components){var i=this.components[r];if(i.sources&&i.sources.calculatorState){var o={first_line:1,last_line:1,first_column:0,last_column:0,componentId:"thumbnail",stepId:"thumbnail"};var c=new a.FunctionNode([new a.IdentifierNode("thumbnail",o),new a.StringNode(r,o)],o);var l=new a.CalculatorReferenceNode(r,o);t.push(new a.SinkAssignmentNode(c,l,o))}}this.ast["thumbnail"]=t;this.components["thumbnail"]=e};e.prototype.getNodes=function(){return this.nodes};e.prototype.castStringToLatex=function(e){if(!this.stringToLatexCasts[e]){this.stringToLatexCasts[e]=this.registerNode({type:"function",name:"castStringToLatex",valueType:u.Types.latex,dependencies:[e],fn:p.castStringToLatex})}return this.stringToLatexCasts[e]};e.prototype.castLatexToString=function(e){if(!this.latexToStringCasts[e]){this.latexToStringCasts[e]=this.registerNode({type:"function",name:"castLatexToString",valueType:u.Types.string,dependencies:[e],fn:p.castLatexToString})}return this.latexToStringCasts[e]};e.prototype.computeAliasMap=function(){var e={};for(var t in this.components){var r=this.components[t];var n=r.alias;if(!n){continue}if(!e[n]){e[n]={}}if(!e[n][r.stepId]){e[n][r.stepId]=[]}e[n][r.stepId].push(t)}var i={aliases:{},duplicates:{}};for(var n in e){var o=i.aliases[n]={};for(var a in e[n]){var s=e[n][a];if(s.length===1){o[a]=s[0]}else{if(!i.duplicates[a]){i.duplicates[a]={}}for(var u=0,c=s;u<c.length;u++){var t=c[u];i.duplicates[a][n]=true;this.errors.push({msg:"Naming Collision - "+s.length+' components on this screen are named "'+n+'"',componentId:t})}}}}return i};e.prototype.computeAST=function(){var e=this;var t={};for(var r in this.components){var n=this.components[r];if(n.script!=null){var o=i.parse(n.script,{componentId:r,stepId:n.stepId}),a=o.nodes,s=o.errors;s.forEach(function(t){return e.errors.push(t)});t[r]=a}}return t};e.prototype.registerVariable=function(e,t,r){if(this.variables[t]==null){this.variables[t]={}}return this.variables[t][e]=r};e.prototype.resolveConstant=function(e){if(this.constants[e]){return this.constants[e]}var t=this.library.constants[e];if(!t){return undefined}var r=t.valueType,n=t.value;var i=this.registerNode({type:"constant",valueType:r,value:n});return this.constants[e]=i};e.prototype.resolveComponent=function(e,t){var r=this.componentAliasMap.aliases[e];var n=this.componentAliasMap.duplicates[t.pos.stepId];if(n&&n[e]){return{result:"error",error:new c.StatementError('Multiple components on this screen are named "'+e+'".',t)}}var i;if(r){if(r[t.pos.stepId]){i=r[t.pos.stepId]}else if(Object.keys(r).length==1){i=r[Object.keys(r)[0]]}else{return{result:"error",error:new c.StatementError("Naming Collision - there are "+Object.keys(r).length+' components in this activity named "'+e+'".',t)}}}if(e=="this"&&!i){i=t.pos.componentId}if(!i){return{result:"not-found"}}var o=this.componentNodes[i];if(o){return{result:"resolved",nodeId:o,componentId:i}}else{var a=this.componentNodes[i]=this.registerNode({type:"component",valueType:u.getComponentType({componentId:i})});return{result:"resolved",nodeId:a,componentId:i}}};e.prototype.resolveComponentScript=function(e){var t=this.componentScriptNodes[e];if(t){return t}else{var r=this.componentScriptNodes[e]=this.registerNode({type:"component-script",valueType:u.getComponentScriptType({componentId:e})});return r}};e.prototype.registerNode=function(e){var t=e.type==="function"?e.name:e.type||"node";var r=m.uniqueId(t);this.nodes[r]=e;return r};e.prototype.resolveVariable=function(e,t,r){var n=this.variables[t];var i=n&&n[e];if(i){return i}var o=this.declarations[h.mangleVariableSymbol({componentId:t,symbol:e})];if(o){try{this.analyzeStatement(o)}catch(n){var a=this.components[t];var s=a&&a.alias;throw new c.StatementError("The statement defining variable "+e+(s?" in component "+s:"")+" has an error.",r)}var u=this.variables[t];var l=u&&u[e];if(l){return l}else{throw new Error("Expected analyzing statement "+JSON.stringify(o)+" to declare variable "+e+" but it did not.")}}else{return undefined}};e.prototype.error=function(e){if(!m.find(this.errors,e)){this.errors.push(e)}};e.prototype.tryAndRecord=function(e){try{e()}catch(e){if(e instanceof c.StatementError){this.errors.push({msg:e.message,componentId:e.errRef.pos.componentId,pos:e.errRef.pos})}else if(e instanceof c.ComponentError){this.errors.push({msg:e.message,componentId:e.componentId})}else if(e instanceof c.CircularDependencyError){this.errors.push({msg:e.message,componentId:e.errRef.pos.componentId,pos:e.errRef.pos})}else{throw e}}};return e}();t.Analysis=y});define("core/computation-layer/runtime",["require","exports","./runtime-node","./analyze/main","./cl-types","core/lib/assert-unreachable","core/lib/log","underscore"],function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});var u=function(){function e(e){var t=this;this.pendingValues={};this.sinks={};this.sources={};this.nodes={};this.updatePending=false;this.processPendingValues=function(){var e=Date.now();if(!t.updatePending){return}t.updatePending=false;var r=t.pendingValues;t.pendingValues={};t.pendingValues={};for(var n in r){t.nodes[n].blockDependents()}for(var n in r){var i=r[n];t.nodes[n].resolveValue(i)}var o=Date.now();try{t.computationDidUpdate()}catch(e){a.log("computationDidUpdate",e)}finally{var s=Date.now();var u=o-e;var c=s-o;if(u>500)a.log("Slow CL computation, "+u+"ms");if(c>500)a.log("Slow dispatch, "+c+"ms")}};if(!e.dryRun){if(e.randomSeed==null)throw new Error("No random seed passed to CL runtime")}this.randomSeed=e.randomSeed;if(e.doNextTick)this.doNextTick=e.doNextTick;this.components=e.components;this.publishersAvailable=e.publishersAvailable;this.computationDidUpdate=e.computationDidUpdate;this.subscribePureSource=e.subscribePureSource;if(e.reuseAnalysisFrom!=undefined){this.analysis=e.reuseAnalysisFrom.analysis}else{this.analysis=new n.Analysis(this.components,e.library,{publishersAvailable:e.publishersAvailable,insertThumbnailComponent:!!e.insertThumbnailComponent});if(!e.dryRun)this.reportErrors(this.analysis.errors)}if(e.dryRun){return}this.pendingValues={};this.allocateNodes();this.registerSinks();this.registerSources();this.registerResponseSources();this.resolveConstants();this.scheduleProcessPendingValues()}e.prototype.doNextTick=function(e){setTimeout(e,0)};e.prototype.scheduleProcessPendingValues=function(){if(this.updatePending){return}this.updatePending=true;this.doNextTick(this.processPendingValues)};e.prototype.getErrors=function(){return this.analysis.errors};e.prototype.getNodeFromVariable=function(e,t){var r;var n=(r=this.analysis.variables[e])===null||r===void 0?void 0:r[t];if(n===undefined)return;return this.nodes[n]};e.prototype.getSinks=function(e,t){if(t==null){throw new Error("sink name required")}var r=this.sinks[e];if(r){var n=r[t];if(n){return n}}return[]};e.prototype.getSinkValue=function(e,t,r){var n=this.getSinks(e,t);if(n.length>1)throw new Error("Multiple "+t+" sinks.  Inappropriate use of getSinkValue");var i=n[0];return i?i.value:r};e.prototype.getComponentSinks=function(e){var t=this.sinks[e];if(t){return t}else{return{}}};e.prototype.getSources=function(e,t){var r=this.sources[e];if(r){var n=r[t];if(n){return n}}return[]};e.prototype.getComponentSources=function(e){var t=this.sources[e];if(t){return t}else{return{}}};e.prototype.doesComponentUseSource=function(e,t){return!!(this.analysis.sourcesUsed[e]&&this.analysis.sourcesUsed[e][t])};e.prototype.reportErrors=function(e){if(!(e.length>0)){return}a.log("Computation layer running despite "+e.length+" errors",e)};e.prototype.allocateNodes=function(){this.nodes={};this.nodes["randomSeedNodeId"]=new r.RuntimeNode({nodeId:"randomSeedNodeId",runtime:this,analysis:{type:"constant",valueType:i.Types.string,value:{type:"string",parts:[this.randomSeed.toString()]}}});for(var e in this.analysis.nodes){var t=this.analysis.nodes[e];this.nodes[e]=new r.RuntimeNode({nodeId:e,runtime:this,analysis:t})}for(var e in this.nodes){for(var n=0,o=this.nodes[e].getDependencies();n<o.length;n++){var a=o[n];this.nodes[a].registerDependent(e)}}};e.prototype.registerSinks=function(){for(var e in this.analysis.sinks){var t=this.analysis.sinks[e];for(var r in t){var n=function(e){var t=i.nodes[e.dependencies[0]];var r={params:e.params,valueType:t.analysis.valueType,get value(){return t.value}};if(t.analysis.type==="constant"){r.isConstant=true}var n=e.componentId,o=e.sinkName;if(i.sinks[n]==null){i.sinks[n]={}}if(i.sinks[n][o]==null){i.sinks[n][o]=[]}i.sinks[n][o].push(r)};var i=this;for(var o=0,a=t[r];o<a.length;o++){var s=a[o];n(s)}}}};e.prototype.registerResponseSources=function(){var e=this;var t=function(t){var n=r.analysis.responseSources[t];r.subscribePureSource(t,function(t){e.updateSourceValue(n,t,{skipEqualityChecks:true})})};var r=this;for(var n in this.analysis.responseSources){t(n)}};e.prototype.registerSources=function(){var e=this;var t=function(t){var n=r.analysis.nodes[t];var i={params:n.params,valueType:n.valueType,getValue:function(){return e.getSourceValue(t)},setValue:function(r){return e.updateSourceValue(t,r)}};var o=n.componentId,a=n.sourceName;if(r.sources[o]==null){r.sources[o]={}}if(r.sources[o][a]==null){r.sources[o][a]=[]}r.sources[o][a].push(i)};var r=this;for(var n=0,i=this.analysis.controllerSources;n<i.length;n++){var o=i[n];t(o)}};e.prototype.resolveConstants=function(){for(var e in this.nodes){var t=this.nodes[e];if(t.analysis.type=="constant"){t.resolveValue(t.value)}if(t.analysis.type=="function"&&t.analysis.dependencies.length==0){t.compute()}}};e.prototype.getSourceValue=function(e){return this.nodes[e].value};e.prototype.updateSourceValue=function(e,t,r){if(r===void 0){r={}}if(!r.skipEqualityChecks&&!this.updatePending){var n=this.pendingValues.hasOwnProperty(e);var i=this.nodes[e].hasOwnProperty("value");if(!n&&i&&s.isEqual(this.getSourceValue(e),t))return}this.pendingValues[e]=t;this.scheduleProcessPendingValues()};e.prototype.listImportSourceKeys=function(){var e=[];for(var t in this.analysis.importSources){var r=this.analysis.importSources[t];var n=this.analysis.nodes[r];e.push({importKey:t,type:n.type})}return e};e.prototype.updateImportSourceValue=function(e,t){var r=this.analysis.importSources[e];if(!r){throw new Error("No node is registered for import key "+e)}var n=this.nodes[r];var i=n.analysis;var a=t;switch(i.type){case"importNumber":if(typeof t!=="number"){throw new Error("Import key "+e+" expects a number but we got a "+typeof t)}break;case"importString":if(typeof t!=="string"){throw new Error("Import key "+e+" expects a string but we got a "+typeof t)}a={type:"string",parts:[t]};break;case"importNumberList":if(!Array.isArray(t)){throw new Error("Import key "+e+" expects an array, but we got a "+typeof t)}if(t.some(function(e){return typeof e!=="number"})){throw new Error("Import key "+e+" expects an array of numbers, but we got an array containing a non-numeric value")}break;default:o.assertUnreachable(i)}this.updateSourceValue(r,a)};return e}();t.Runtime=u});define("core/computation-layer/step-component",["require","exports","core/computation-layer/types","core/computation-layer/cl-types","core/lib/i18n"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=r.convertSinkList({title:{description:function(){return i.i18n.s("cl-docs-description-step-title")},analyzeValueType:{type:"concrete",valueType:n.Types.string}},subtitle:{description:function(){return i.i18n.s("cl-docs-description-step-subtitle")},analyzeValueType:{type:"concrete",valueType:n.Types.string}},coverText:{description:function(){return i.i18n.raw("Covers the screen with the text provided. The cover is dismissable.")},analyzeValueType:{type:"concrete",valueType:n.Types.string}},coverButtonLabel:{description:function(){return i.i18n.raw("Use in conjunction with coverText to change the button text from the default ('Ok').\n    If set to an empty string, the cover won't be dismissable.")},analyzeValueType:{type:"concrete",valueType:n.Types.string}},export:{description:function(){return i.i18n.raw("Data to include in CSV export to summarize this screen")},analyzeValueType:{type:"concrete",valueType:n.Types.string},internal:true,params:[{name:"heading",type:n.Types.string}]},disableCalculatorReason:{description:function(){return i.i18n.raw("If provided, disables the calculator tool.")},analyzeValueType:{type:"concrete",valueType:n.Types.string}}});t.stepComponent={listSinks:o}});define("core/computation-layer/library/colors",["require","exports","core/computation-layer/cl-types","core/lib/mathtools","core/lib/i18n"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});function o(e){if(e===undefined)return 0;if(e>=0&&e<=255)return Math.round(e);if(e>255)return 255;return 0}function a(e){if(e===undefined)return 1;if(e>=0&&e<=1)return e;if(e<0)return 0;return 1}function s(e){if(e===undefined)return"black";var t=o(e.r);var r=o(e.g);var n=o(e.b);var i=a(e.a);return"rgba("+t+", "+r+", "+n+", "+i+")"}t.colorToString=s;function u(e){if(e.match(/^#[A-Fa-f0-9]{6}$/)){return p(e)}else if(e.match(/^#[A-Fa-f0-9]{3}$/)){var t=e[1];var r=e[2];var n=e[3];var i="#"+t+t+r+r+n+n;return p(i)}else if(e.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*\.*\d+)\)$/)){return l(e)}else{return undefined}}t.stringToColor=u;function c(e,t){return{version:"v3",description:function(){return i.i18n.s("cl-docs-description-lib-palette-color-getter",{name:i.i18n.raw(t)})},argTypes:[r.Types.colorPalette],outputType:r.Types.color,value:function(){return e}}}function l(e){var t=e.replace("rgba(","").replace(")","").split(",");var r=parseInt(t[0]);var n=parseInt(t[1]);var i=parseInt(t[2]);var o=parseFloat(t[3]);return{r:r,g:n,b:i,a:o}}t.rgbaStringToRGBA=l;function p(e,t){if(t===void 0){t=1}var r=o(parseInt(e.slice(1,3),16));var n=o(parseInt(e.slice(3,5),16));var i=o(parseInt(e.slice(5,7),16));return{r:r,g:n,b:i,a:t}}t.hexToRGBA=p;t.library={functions:{rgb:{version:"v3",description:function(){return i.i18n.s("cl-docs-description-lib-rgb")},argTypes:[r.Types.number,r.Types.number,r.Types.number],outputType:r.Types.color,value:function(e,t,r){return{r:o(e),g:o(t),b:o(r)}}}},types:{color:{setOpacity:{version:"v3",description:function(){return i.i18n.s("cl-docs-description-lib-set-opacity")},argTypes:[r.Types.color,r.Types.number],outputType:r.Types.color,value:function(e,t){if(e===undefined)e={r:0,g:0,b:0};return{a:a(t),r:o(e.r),g:o(e.g),b:o(e.b)}}}},colorPalette:{red:c(p(n.colorHelpers.colors.RED),"red"),blue:c(p(n.colorHelpers.colors.BLUE),"blue"),green:c(p(n.colorHelpers.colors.GREEN),"green"),purple:c(p(n.colorHelpers.colors.PURPLE),"purple"),orange:c(p(n.colorHelpers.colors.ORANGE),"orange"),black:c(p(n.colorHelpers.colors.BLACK),"black"),list:{version:"v2",description:function(){return i.i18n.s("cl-docs-description-lib-color-list")},noUndefinedArgs:true,lookup:function(e){var t=e[0],n=e.slice(1);if(n.length<1)throw new Error("Must include at least one color");for(var i=0,o=n;i<o.length;i++){var a=o[i];if(!r.Types.color.matches(a.type)){throw new Error("Expected all arguments to be colors, but got a "+a.type.type)}}return{body:function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}return t},valueType:r.Types.colorList}}}}},constants:{colors:{valueType:r.Types.colorPalette,value:{},description:function(){return i.i18n.s("cl-docs-description-lib-palette-colors")}}}}});define("core/lib/distance",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.hypot=function(e,t){if(e===0&&t===0){return 0}if(Math.abs(e)>Math.abs(t)){return Math.abs(e)*Math.sqrt(t/e*(t/e)+1)}else{return Math.abs(t)*Math.sqrt(e/t*(e/t)+1)}};t.mean=function(e,t){return e>0===t>0?e+.5*(t-e):.5*(e+t)};t.dot=function(e,t,r,n){return e*r+t*n};t.pointToSegmentParameter=function(e,r,n,i,o,a){var s=t.hypot(o-n,a-i);if(s===0)return 0;var u=t.dot((e-n)/s,(r-i)/s,(o-n)/s,(a-i)/s);return u};t.closestPointOnSegment=function(e,r,n,i,o,a){var s=t.pointToSegmentParameter(e,r,n,i,o,a);if(s<=0)return[n,i];if(s>=1)return[o,a];return[n+s*(o-n),i+s*(a-i)]};t.pointToSegment=function(e,r,n,i,o,a){var s=t.closestPointOnSegment(e,r,n,i,o,a);return t.hypot(e-s[0],r-s[1])}});define("core/lib/copydata",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});function r(e){if(e===undefined){return undefined}return JSON.parse(JSON.stringify(e))}t.copydata=r});define("core/lib/colors",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.strokeColors={pink:"#db5375",purple:"#9068be",orange:"#fa824c",blue:"#4781b9",green:"#1aad57",red:"#c54e4b",mediumBlue:"#27AAE1",teal:"#15b097",lightTeal:"#87CBAC",ruby:"#db3a4d",lightYellow:"#ffe37b",navy:"#336699",aqua:"#6ed3cf",lightGray:"#DDDDDD",mediumGray:"#AAAAAA"};t.backgroundColors={blue:"#32C7C7",pink:"#DB4D70",gold:"#F7A745",purple:"#9068BE",red:"#DB3A4D",orange:"#FA7639",green:"#14B363"};t.colors=Object.keys(t.strokeColors);function r(e,t){if(!e.match(/^#([A-Fa-f0-9]{6})$/g))return e;if(t>1)t=1;if(t<-1)t=-1;var r=parseInt(e.slice(1),16);var n=t<0?0:255;var i=t<0?t*-1:t;var o=r>>16;var a=r>>8&255;var s=r&255;return"#"+(16777216+(Math.round((n-o)*i)+o)*65536+(Math.round((n-a)*i)+a)*256+(Math.round((n-s)*i)+s)).toString(16).slice(1)}t.shadeColor=r;function n(e,t){e=e.replace(/#/,"");var r=0;var n=0;var i=0;if(e.length==3){r=parseInt(e.slice(0,1)+e.slice(0,1),16);n=parseInt(e.slice(1,2)+e.slice(1,2),16);i=parseInt(e.slice(2,3)+e.slice(2,3),16)}else if(e.length==6){r=parseInt(e.slice(0,2),16);n=parseInt(e.slice(2,4),16);i=parseInt(e.slice(4,6),16)}return"rgba("+r+","+n+","+i+","+t+")"}t.hexToRGBA=n});define("core/lib/calculator-helpers",["require","exports","tslib","underscore","core/lib/copydata","core/lib/mathtools","core/lib/colors","core/lib/log","core/computation-layer/helpers"],function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});function c(e){if(e.version==="opaque")throw new Error("Opaque state version should never actually be used.");return e}t.makeStateReadable=c;t.filterImages=function(e){var t=i.copydata(c(e));for(var r=0,n=t.expressions.list;r<n.length;r++){var o=n[r];if(o.type==="image"&&o.image_url.slice(0,5)==="data:"){o.image_url=""}}return t};t.mergeImages=function(e,t){var r=t?c(t):undefined;var n=i.copydata(c(e));for(var o=0,a=n.expressions.list;o<a.length;o++){var u=a[o];if(u.type==="image"&&u.image_url===""){if(!r){s.warn("MergeImagesError","No screenstate provided, but needed to repopulate image URLs");return n}var l=false;for(var p=0,f=r.expressions.list;p<f.length;p++){var d=f[p];if(d.id===u.id&&d.type==="image"){u.image_url=d.image_url;l=true;break}}if(!l){s.warn("MergeImagesError","Image "+u.id+" needed, but not found in screenstate")}}}return n};t.expressionsEqual=function(e,t){if(e==undefined||t==undefined){return e==t}return n.isEqual(c(e).expressions.list,c(t).expressions.list)};function l(e,t){var n=c(e);var i=r.__assign(r.__assign({},n),{expressions:{list:[]}});var o=i.expressions.list;for(var a=0,s=n.expressions.list;a<s.length;a++){var u=s[a];if(t[u.id]){o[o.length]=u}}return i}t.filterListToIds=l;function p(e){return c(e).graph.viewport}t.extractViewport=p;function f(e){var t=c(e);if(t.graph.squareAxes===undefined){return true}else{return!!t.graph.squareAxes}}t.areAxesSquare=f;function d(e){var t=c(e);for(var r=0,n=t.expressions.list;r<n.length;r++){var i=n[r];if(i.type==="image"&&!i.image_url)return true}return false}t.areAnyImageUrlsMissing=d;function h(e){return r.__assign(r.__assign({},c(e)),{expressions:{list:[]}})}t.clearExpressions=h;function m(e){return r.__assign(r.__assign({},c(e)),{graph:{}})}t.clearGraphSettingsForHeadlessCalc=m;function y(e,t){var r=c(e).expressions.list;r[r.length]={id:t.id,color:t.color,latex:"\\left("+t.x+","+t.y+"\\right)",type:"expression"}}t.pushPointIntoState=y;function g(e){return!!c(e).graph.degreeMode}t.isDegreeMode=g;function v(e,t){var r=i.copydata(c(e));for(var n=0,o=r.expressions.list;n<o.length;n++){var s=o[n];if(s.type=="expression"){s.showLabel=false;if(s.color!=undefined){s.color=a.hexToRGBA(s.color,t)}}else if(s.type=="table"){if(s.columns){for(var u=0,l=s.columns;u<l.length;u++){var p=l[u];p.color=a.hexToRGBA(p.color,t)}}}}if(r.version===8||r.version===9){for(var f=0,d=r.expressions.list;f<d.length;f++){var s=d[f];if(s.type=="image"){if(s.opacity!==undefined){s.opacity="("+s.opacity+") * "+t}else{s.opacity=t+""}}}}else if(r.version===7){for(var h=0,m=r.expressions.list;h<m.length;h++){var s=m[h];if(s.type=="image"){if(s.opacity!==undefined){s.opacity=s.opacity*t}else{s.opacity=t}if(s.stringOpacity!==undefined){s.stringOpacity="("+s.stringOpacity+") * "+t}}}}else{for(var y=0,g=r.expressions.list;y<g.length;y++){var s=g[y];if(s.type=="image"){if(s.opacity!=undefined){s.opacity=s.opacity*t}else{s.opacity=t}}}}return r}t.multiplyOpacitiesByAlpha=v;t.statesEqual=function(e,t){return n.isEqual(e,t)};t.numberAsLatex=function(e){var t,r;if(n.isFinite(e)){r=e.toString();t=r.split("e");if(t.length===1){return t[0]}return t[0]+"*10^{0"+t[1]+"}"}if(e===Infinity){return"1/0"}if(e===-Infinity){return"-1/0"}return"0/0"};function b(e,t){for(var r=0,n=c(e).expressions.list;r<n.length;r++){var i=n[r];var a=i;if(a.latex&&o.parser.parse(a.latex).getExports()[0]===t){return i.id}}return null}t.getIdFromIdentifier=b;function x(e,t){for(var r=0,n=c(e).expressions.list;r<n.length;r++){var i=n[r];var a=i;if(a.latex&&o.parser.parse(a.latex).getExports()[0]===t){return a.label}}return undefined}t.getLabelValueFromIdentifier=x;var _=new WeakMap;function S(e){if(e==undefined){return{exportMap:{},dependencyMap:{},weakExportMap:{}}}var t=c(e);var r=_.get(t.expressions.list);if(r)return r;var n=o.CLCalculator(t);var i=new o.context;var a=n.getChangeSet().statements;for(var s in a){i.addStatement(a[s])}var u=i.getCLSymbolMap();_.set(t.expressions.list,u);return u}t.getExportAndDependencyMapFromState=S;function T(e,t){var r=i.copydata(c(e));if(t.length==0||!(r&&r.expressions&&r.expressions.list)){return e}t=t.map(function(e){return e.replace(/[{}]/g,"")});var n=[];for(var a=0,s=r.expressions.list;a<s.length;a++){var u=s[a];var l=u;if(l.latex){var p=o.parser.parse(l.latex).getExports()[0];if(t.indexOf(p)>=0)continue}n[n.length]=u}r.expressions.list=n;return r}t.calcStateWithoutDefinitions=T;function w(e){return M(e.latex)}t.validLatexIdentifierPreferred=w;function E(e){return M(u.synthesizeStringInternal(e))}t.validStringIdentifierPreferred=E;function M(e){if(e.match(/^[a-zA-Z]$/))return{result:"ok"};if(e.match(/^[a-zA-Z]_[a-zA-Z0-9]$/))return{result:"ok"};if(e.match(/^[a-zA-Z]_{[a-zA-Z0-9]+}$/))return{result:"ok"};return{result:"warn",msg:'Invalid identifier "'+e+"\" won't get reliable dependency handling."}}function C(e){var t=o.parser.parse(e.latex);if(t.isError)return{result:"error",msg:'Could not parse "'+e.latex+'" as latex'};return{result:"ok"}}t.validLatexRequired=C;function I(e){if(e.latex.match(/^[a-zA-Z]$/))return{result:"ok"};if(e.latex.match(/^[a-zA-Z]_[a-zA-Z0-9]$/))return{result:"ok"};if(e.latex.match(/^[a-zA-Z]_{[a-zA-Z0-9]+}$/))return{result:"ok"};return{result:"error",msg:'Invalid identifier "'+e.latex+'" won\'t work here.  Try "x", "x_1", or "x_{abc}"'}}t.validLatexIdentifierRequired=I;function P(e){var t=u.synthesizeStringInternal(e);if(t.match(/^[a-zA-Z]$/))return{result:"ok"};if(t.match(/^[a-zA-Z]_[a-zA-Z0-9]+$/))return{result:"ok"};return{result:"error",msg:'Point name "'+t+"\" won't work here.  Try `x`, `x_1`, or `x_abc`"}}t.validStrippedIdentifierRequired=P;function k(){return{expressions:{list:[]},graph:{viewport:{xmin:-10,xmax:10,ymin:-10,ymax:10},degreeMode:false}}}t.getDefaultState=k;function O(){return{expressions:{list:[]},graph:{viewport:{xmin:-10,xmax:10,ymin:-10,ymax:10},degreeMode:false,showGrid:false,showXAxis:false,showYAxis:false}}}t.getDefaultStateWithNoGrid=O;function D(e,t){if(t.calculatorStateDiff&&e){return o.applyDiff(e,t.calculatorStateDiff)}return t.calculatorState}t.getRehydratedCalculatorState=D});define("core/computation-layer/library/bounds",["require","exports","tslib","core/lib/assert-unreachable","../cl-types","core/lib/i18n"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=function(e){return{version:"v3",description:function(){return o.i18n.s("cl-docs-description-lib-bounds-getter",{name:o.i18n.raw(e)})},argTypes:[i.Types.bounds],outputType:i.Types.number,noUndefinedArgs:true,value:function(t){return t[e]}}};t.applyStrategy=function(e,t,i){var o=i.width/i.height;var a=e.height*o;var s=e.width/o;switch(t){case"stretch":return e;case"bottom":return r.__assign(r.__assign({},e),{height:s});case"top":return r.__assign(r.__assign({},e),{bottom:e.bottom+e.height-s,height:s});case"centeredVertical":return r.__assign(r.__assign({},e),{bottom:e.bottom+e.height/2-s/2,height:s});case"left":return r.__assign(r.__assign({},e),{width:a});case"right":return r.__assign(r.__assign({},e),{left:e.left+e.width-a,width:e.height*o});case"centeredHorizontal":return r.__assign(r.__assign({},e),{left:e.left+e.width/2-a/2,width:a});default:return n.assertUnreachable(t)}};t.getMathBounds=function(e,r){var n=e["bounds"];if(n&&n[0]){var i=n[0].value;if(r.width<=0)r.width=1;if(r.height<=0)r.height=1;var o=t.applyStrategy(i,i.strategy,r);return{top:o.bottom+o.height,left:o.left,bottom:o.bottom,right:o.left+o.width}}return undefined};var s=function(){return o.i18n.s("cl-docs-warning-bounds-strategy-deprecation-notice")};var u=function(e){return{version:"v3",deprecated:s,description:function(){switch(e){case"stretch":return o.i18n.raw("Bounds strategy stretch. Use this in conjunction with bounds.setStrategy to control how these\n        bounds will behave when placed into different-sized containers.\n\n        stretch: Stretch the object so that the bounds match up with the edges of the container exactly.");case"left":return o.i18n.raw("Bounds strategy left. Use this in conjunction with bounds.setStrategy to control how these\n        bounds will behave when placed into different-sized containers.\n\n        left: Preserve the left edge and vertical bounds while adjusting the right to make the axes square.");case"right":return o.i18n.raw("Bounds strategy right. Use this in conjunction with bounds.setStrategy to control how these\n          bounds will behave when placed into different-sized containers.\n\n          right: Preserve the right edge and vertical bounds while adjusting the left to make the axes square.");case"centeredHorizontal":return o.i18n.raw("Bounds strategy centeredHorizontal. Use this in conjunction with bounds.setStrategy to control how these\n        bounds will behave when placed into different-sized containers.\n\n        centeredHorizontal: Preserve the center and vertical bounds while scaling horizontally to make the axes square.");case"bottom":return o.i18n.raw("Bounds strategy bottom. Use this in conjunction with bounds.setStrategy to control how these\n        bounds will behave when placed into different-sized containers.\n\n        bottom: Preserve the bottom edge and horizontal bounds while adjusting the top to make the axes square.");case"top":return o.i18n.raw("Bounds strategy top. Use this in conjunction with bounds.setStrategy to control how these\n        bounds will behave when placed into different-sized containers.\n\n        top: Preserve the top edge and horizontal bounds while adjusting the bottomto make the axes square.");case"centeredVertical":return o.i18n.raw("Bounds strategy centeredVertical. Use this in conjunction with bounds.setStrategy to control how these\n        bounds will behave when placed into different-sized containers.\n\n        centeredVertical: Preserve the center and horizontal bounds while scaling vertically to make the axes square.");default:return n.assertUnreachable(e)}},argTypes:[],outputType:i.Types.boundsStrategy,value:function(){return e}}};var c={stretch:u("stretch"),left:u("left"),right:u("right"),centeredHorizontal:u("centeredHorizontal"),bottom:u("bottom"),top:u("top"),centeredVertical:u("centeredVertical")};function l(e){return{version:"v3",description:function(){return o.i18n.s("cl-docs-description-lib-bounds-square")},argTypes:[i.Types.bounds],outputType:i.Types.bounds,noUndefinedArgs:true,value:function(t){return r.__assign(r.__assign({},t),{strategy:e})}}}t.library={functions:r.__assign({makeBounds:{version:"v3",description:function(){return o.i18n.s("cl-docs-description-lib-make-bounds")},argTypes:[i.Types.number,i.Types.number,i.Types.number,i.Types.number],outputType:i.Types.bounds,noUndefinedArgs:true,value:function(e,t,r,n){return{left:e,bottom:r,width:t-e,height:n-r,strategy:"stretch"}}}},c),types:{bounds:{left:a("left"),bottom:a("bottom"),height:a("height"),width:a("width"),top:{version:"v3",description:function(){return o.i18n.s("cl-docs-description-lib-bounds-top")},argTypes:[i.Types.bounds],outputType:i.Types.number,noUndefinedArgs:true,value:function(e){return e.bottom+e.height}},right:{version:"v3",description:function(){return o.i18n.s("cl-docs-description-lib-bounds-right")},argTypes:[i.Types.bounds],outputType:i.Types.number,noUndefinedArgs:true,value:function(e){return e.left+e.width}},setStrategy:{version:"v3",description:function(){return o.i18n.raw("Change these bounds to be square")},deprecated:s,argTypes:[i.Types.bounds,i.Types.boundsStrategy],outputType:i.Types.bounds,noUndefinedArgs:true,value:function(e,t){return r.__assign(r.__assign({},e),{strategy:t})}},stretch:{version:"v3",description:function(){return o.i18n.s("cl-docs-description-lib-bounds-stretch")},argTypes:[i.Types.bounds],outputType:i.Types.bounds,noUndefinedArgs:true,value:function(e){return r.__assign(r.__assign({},e),{strategy:"stretch"})}},squareLeft:l("left"),squareRight:l("right"),squareCenterHorizontal:l("centeredHorizontal"),squareBottom:l("bottom"),squareTop:l("top"),squareCenterVertical:l("centeredVertical")}},constants:{}}});define("core/components/shared/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ASPECT_RATIO={SOLO:1.333,DEFAULT:1}});define("core/components/shared/sketch/sketch",["require","exports","core/lib/distance","core/computation-layer/library/colors","core/lib/calculator-helpers","core/computation-layer/library/bounds","../constants"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var s=-10;var u=20;function c(e){if(e.color!=undefined){return e.coords}else{return e}}t.normalize=c;function l(e){if(e.color){return e.color}return undefined}t.getColor=l;t.getTotalStrokeLength=function(e){if(e==undefined)return 0;var t=0;for(var n=0,i=e.strokes;n<i.length;n++){var o=i[n];var a=c(o);for(var s=0;s<a.length-1;s++){var u=a[s];var l=a[s+1];t+=r.hypot(u.x-l.x,u.y-l.y)}}return t};t.getValuesAt=function(e,t){var r=[];for(var n=0,i=e.strokes;n<i.length;n++){var o=i[n];var a=c(o);for(var s=0;s<a.length;s++){var u=a[s];if(u.x==t){r.push(u.y)}else{if(s<a.length-1){var l=a[s+1];if((u.x-t)*(l.x-t)<0){r.push(u.y+(t-u.x)/(l.x-u.x)*(l.y-u.y))}}}}}return r};t.getXValuesAt=function(e,t){var r=[];for(var n=0,i=e.strokes;n<i.length;n++){var o=i[n];var a=c(o);for(var s=0;s<a.length;s++){var u=a[s];if(u.y==t){r.push(u.x)}else{if(s<a.length-1){var l=a[s+1];if((u.y-t)*(l.y-t)<0){r.push(u.x+(t-u.y)/(l.y-u.y)*(l.x-u.x))}}}}}return r};function p(e,t){return{strokes:e.strokes.map(function(e){return{color:t,coords:c(e)}}),points:e.points.map(function(e){return{color:t,coords:c(e)}}),bounds:e.bounds}}t.replaceAllColors=p;t.getPointCoords=function(e){return(e.points||[]).map(function(e){return c(e)})};function f(e,t){return{strokes:e.strokes.map(function(e){var r=c(e).map(t);var n=l(e);return n?{color:n,coords:r}:r}),points:e.points.map(function(e){var r=t(c(e));var n=l(e);return n?{color:n,coords:r}:r}),bounds:e.bounds}}t.transformCoordinates=f;function d(e,t){var r=l(e);if(!r){return e}var i=n.stringToColor(r);if(!i){throw new Error("Unexpected sketch color format")}i.a=t;return{color:n.colorToString(i),coords:c(e)}}function h(e,t){var r=l(e);var i=r&&n.stringToColor(r);return!!i&&i.r===t.r&&i.g===t.g&&i.b===t.b}function m(e,t){return{strokes:e.strokes.map(function(e){return d(e,t)}),points:e.points.map(function(e){return d(e,t)}),bounds:e.bounds}}t.replaceAllOpacity=m;function y(e,t){return{strokes:e.strokes.filter(function(e){return h(e,t)}),points:e.points.filter(function(e){return h(e,t)}),bounds:e.bounds}}t.filterByRgbColor=y;function g(e){return e?a.ASPECT_RATIO.DEFAULT:a.ASPECT_RATIO.SOLO}t.getAspectRatio=g;function v(e){var t=g(e.exhibitMode);var r=e.sketchConfig.calculatorState;if(r){var n=i.extractViewport(r);var o=n.xmin;var a=n.xmax-o;var c=void 0;var l=void 0;if(i.areAxesSquare(r)){l=a/t;c=(n.ymax+n.ymin)/2-l/2}else{c=n.ymin;l=n.ymax-c}return{left:o,width:a,height:l,bottom:c}}else{var l=u/t;return{left:s,width:u,height:l,bottom:-l/2}}}function b(e){if(e.sketchConfig.version==2){var t=g(e.exhibitMode);if(e.bounds!=undefined){var r=e.bounds.width;var n=r/t;return o.applyStrategy(e.bounds,e.bounds.strategy,{width:r,height:n})}if(e.sketchConfig.background.type=="graph"){return v({exhibitMode:e.exhibitMode,sketchConfig:e.sketchConfig})}else{var n=2/t;return{left:-1,width:2,bottom:-n/2,height:n}}}else{return{left:0,bottom:0,width:1,height:1}}}t.getSketchBounds=b});define("core/computation-layer/library/math",["require","exports","tslib","underscore","core/lib/mathtools","core/lib/calculator-helpers","../cl-types","core/lib/evaluator-helpers","core/lib/i18n"],function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});function c(e){return e.input.slice(e.start,e.end)}t.generateFunctionProxyVariables=n.memoize(function(e){var t=[];for(var r=1;r<=e;r++){t.push("\\tmp_{cl"+r+"}")}return t});var l=function(e){if(e.length<2){throw new Error("You must specify the independent variables you want to use for analysis")}var r=[];for(var o=1;o<e.length;o++){if(!(a.Types.string.matches(e[o].type)||a.Types.latex.matches(e[o].type))){throw new Error("Independent variables must be latex, but argument "+o+" is a "+e[o].type.type)}if(!a.Types.latex.matches(e[o].type)){}}var s=[e[0].type];for(var o=1;o<e.length;o++){s.push(a.Types.latex)}return{valueType:a.getFunctionType({numVars:e.length-1}),warnings:r,desiredArgTypes:s,body:function(e){var r=[];for(var o=1;o<arguments.length;o++){r[o-1]=arguments[o]}var a=r;var s=a.map(function(e){return e.latex.toLowerCase()});var u="lhsGreater"in e&&!e.lhsGreater?"("+e.rhs+")-("+e.lhs+")":"("+e.lhs+")-("+e.rhs+")";var c=i.parser.parse(u);if(c.isError){return undefined}var l=n.filter(c.getDependencies(),function(e){return!i.builtInFrame.hasOwnProperty(e)});var p=Object.create(i.builtInFrame);var f={};var d=t.generateFunctionProxyVariables(a.length);for(var h=0,m=l;h<m.length;h++){var y=m[h];var g=y.toLowerCase();var v=s.indexOf(g);if(v==-1){return undefined}if(f[v])return undefined;f[v]=true;p[y]=i.parser.parse(d[v])}var b=c.tryGetConcreteTree(i.policies.graphing,p);if(b.isList)return undefined;if(b.valueType!==i.types.Number)return undefined;if(b)return b.printLatex();return undefined}}};var p={version:"v3",argTypes:[a.Types.xyLine],outputType:a.Types.number,description:function(){return u.i18n.s("cl-docs-description-lib-angle-of-line")},value:function(e){if(e==undefined){return 0/0}if(e.B>0){return Math.atan2(-e.A,e.B)}else{return Math.atan2(e.A,-e.B)}}};var f={version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-slope-of-line")},argTypes:[a.Types.xyLine],outputType:a.Types.number,value:function(e){if(e==undefined){return 0/0}return-e.A/e.B}};var d={version:"v3",argTypes:[a.Types.xyLine],outputType:a.Types.number,description:function(){return u.i18n.s("cl-docs-description-lib-y-intercept-of-line")},value:function(e){if(e==undefined){return 0/0}return-e.C/e.B}};var h={version:"v3",argTypes:[a.Types.xyLine],outputType:a.Types.number,description:function(){return u.i18n.s("cl-docs-description-lib-x-intercept-of-line")},value:function(e){if(e==undefined){return 0/0}return-e.C/e.A}};var m={version:"v3",argTypes:[a.Types.xyLine],outputType:a.Types.boolean,description:function(){return u.i18n.s("cl-docs-description-lib-is-line-horizontal")},value:function(e){return e!=undefined&&e.A===0}};var y={version:"v3",argTypes:[a.Types.xyLine],outputType:a.Types.boolean,description:function(){return u.i18n.s("cl-docs-description-lib-is-line-vertical")},value:function(e){return e!=undefined&&e.B===0}};t.library={functions:{numericValue:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-numeric-value")},argTypes:[a.Types.latex],outputType:a.Types.number,noUndefinedArgs:true,value:function(e){return s.computeNumericValueFromLatex(e.latex)}},simpleFunction:{version:"v2",description:function(){return u.i18n.s("cl-docs-description-lib-simple-function")},noUndefinedArgs:true,lookup:function(e){if(e.length<1){throw new Error("simpleFunction requires a latex string as a first argument")}var r=[];for(var o=0,s=e;o<s.length;o++){var u=s[o];if(!a.Types.latex.matches(u.type)){if(a.Types.string.matches(u.type)){}else{throw new Error("Function body and identifier must be latex or strings. I got ["+e.join(", ")+"].")}}}var c=Math.max(1,e.length-1);return{valueType:a.getFunctionType({numVars:c}),desiredArgTypes:n.range(e.length).map(function(){return a.Types.latex}),warnings:r,body:function(e){var r=[];for(var o=1;o<arguments.length;o++){r[o-1]=arguments[o]}var a;var s=r.map(function(e){return e.latex.toLowerCase()});if(s.length==0){s=["x"]}var u=i.parser.parse(e.latex);if(u.isError){return undefined}var c=n.filter(u.getDependencies(),function(e){return!i.builtInFrame.hasOwnProperty(e)});if(u.type==="FunctionDefinition"){if(n.any(u._argSymbols,function(e){return s.indexOf(e.toLowerCase())==-1})){return undefined}if(n.any(c,function(e){return u._argSymbols.indexOf(e)==-1})){return undefined}a=u._expression}else if(u.type==="Assignment"){if(c.indexOf(u._symbol)>=0){return undefined}if(s.indexOf(u._symbol.toLowerCase())>=0){return undefined}a=u._expression}else{a=u}var l=Object.create(i.builtInFrame);var p={};var f=t.generateFunctionProxyVariables(s.length);for(var d=0,h=c;d<h.length;d++){var m=h[d];var y=m.toLowerCase();var g=s.indexOf(y);if(g==-1){return undefined}if(p[g])return undefined;p[g]=true;l[m]=i.parser.parse(f[g])}var v=a.tryGetConcreteTree(i.policies.graphing,l);if(v.isList)return undefined;if(v.valueType!==i.types.Number)return undefined;if(v)return v.printLatex();return undefined}}}},xyLine:{version:"v2",description:function(){return u.i18n.s("cl-docs-description-lib-xy-line")},lookup:function(e){if(e.length!==1&&e.length!==3){throw Error("xyLine takes 1 or 3 arguments but got "+e.length)}var t=[];for(var r=0,o=e;r<o.length;r++){var s=o[r];if(!(a.Types.string.matches(s.type)||a.Types.latex.matches(s.type))){throw Error("Function body and identifiers must be strings or latex. I got ["+e.join(", ")+"].")}if(!a.Types.latex.matches(s.type)){}}return{valueType:a.Types.xyLine,desiredArgTypes:n.range(e.length).map(function(){return a.Types.latex}),warnings:t,body:function(e,t,r){try{var o=void 0;var a=void 0;var s=void 0;var u=void 0;var c=void 0;var l=void 0;var p=void 0;var f=void 0;var d=void 0;var h=void 0;var m=t?t.latex:"x";var y=r?r.latex:"y";if(!e){return void 0}h=i.parser.parse(e.latex);if(h.isError){return void 0}switch(h.type){case"Assignment":p=i.parseNodes.Subtract([i.parseNodes.Identifier(h._symbol),h._expression]);break;case"Equation":p=h._difference;break;case"FunctionDefinition":p=i.parseNodes.Subtract([i.parser.parse(h.getInputString().split("=")[0]),h._expression]);break;default:l=h.getConcreteTree(i.policies.graphing,i.builtInFrame);d=l.getDependencies();if(d.length!==1){return void 0}if(d[0].toLowerCase()!==m.toLowerCase()){return void 0}if(l.valueType!==i.types.Number){return void 0}p=i.parseNodes.Subtract([h,i.parseNodes.Identifier(y)])}l=p.getConcreteTree(i.policies.graphing,i.builtInFrame);if(l.isError){return void 0}if(l.valueType!==i.types.Number){return void 0}d=l.getDependencies();if(d.length>2){return void 0}for(var g=0,v=d;g<v.length;g++){var b=v[g];if(b.toLowerCase()===m.toLowerCase()){m=b}else if(b.toLowerCase()===y.toLowerCase()){y=b}else return void 0}u=l.getPolynomialCoefficients(m);if(u.length>2){return void 0}c=u[0].getPolynomialCoefficients(y);if(c.length>2){return void 0}f=function(e){if(e==null){return 0}if(e.dependencies.length!==0){return void 0}return e.evaluateOnce()};o=f(u[1]);a=f(c[1]);s=f(c[0]);if(!(n.isFinite(o)&&n.isFinite(a)&&n.isFinite(s))){return void 0}if(o===0&&a===0){return void 0}return{A:o,B:a,C:s}}catch(e){return void 0}}}}},angleOfLine:r.__assign(r.__assign({},p),{deprecated:function(){return u.i18n.s("cl-docs-warning-deprecation-angle-of-line")}}),slopeOfLine:r.__assign(r.__assign({},f),{deprecated:function(){return u.i18n.s("cl-docs-warning-deprecation-slope-of-line")}}),yInterceptOfLine:r.__assign(r.__assign({},d),{deprecated:function(){return u.i18n.s("cl-docs-warning-deprecation-y-intercept-of-line")}}),xInterceptOfLine:r.__assign(r.__assign({},h),{deprecated:function(){return u.i18n.s("cl-docs-warning-deprecation-x-intercept-of-line")}}),isLineHorizontal:r.__assign(r.__assign({},m),{deprecated:function(){return u.i18n.s("cl-docs-warning-deprecation-is-line-horizontal")}}),isLineVertical:r.__assign(r.__assign({},y),{deprecated:function(){return u.i18n.s("cl-docs-warning-deprecation-is-line-vertical")}}),parseOrderedPair:{version:"v3",argTypes:[a.Types.latex],outputType:a.Types.orderedPair,description:function(){return u.i18n.s("cl-docs-description-lib-parse-ordered-pair")},noUndefinedArgs:true,value:function(e){var t=i.parser.parse(e.latex);if(t.isError)return undefined;if(t.type!=="OrderedPair")return undefined;if(!t.args||t.args.length!==2)return undefined;return{x:t.elementAt(i.policies.graphing,0).getInputString(),y:t.elementAt(i.policies.graphing,1).getInputString()}}},parseEquation:{version:"v3",argTypes:[a.Types.latex],outputType:a.Types.equation,description:function(){return u.i18n.s("cl-docs-description-lib-parse-equation")},noUndefinedArgs:true,value:function(e){var t=i.expressionParser.parse(e.latex);if(t.type=="Equals"){return{lhs:c(t.args[0].span),rhs:c(t.args[1].span)}}return undefined}},parseInequality:{version:"v3",argTypes:[a.Types.latex],outputType:a.Types.inequality,description:function(){return u.i18n.s("cl-docs-description-lib-parse-inequality")},noUndefinedArgs:true,value:function(e){var t=i.expressionParser.parse(e.latex);if(t.type=="Inequality"){return{lhs:c(t.args[0].span),rhs:c(t.args[1].span),lhsGreater:t.symbol==">"||t.symbol==">=",strict:t.symbol==">"||t.symbol=="<"}}return undefined}},countNumberUsage:{version:"v2",description:function(){return u.i18n.s("cl-docs-description-lib-count-number-usage")},lookup:function(e){if(e.length==0){throw new Error("Must provide at least one argument")}if(!(a.Types.latex.matches(e[0].type)||a.Types.string.matches(e[0].type))){throw new Error("First argument must be a string. This is a "+e[0].type)}var t=[];if(!a.Types.latex.matches(e[0].type)){}if(e[1]&&!a.Types.number.matches(e[1].type)){throw new Error("Second argument, the number to match, must be a number.  This is a\n                "+e[1])}if(e.length>2){throw new Error("This function accepts a maximum of 2 arguments")}var r=[a.Types.latex];if(e[1]){r.push(a.Types.number)}return{valueType:a.Types.number,desiredArgTypes:r,warnings:t,body:function(e,t){if(e===undefined)return undefined;var r=i.expressionParser.parse(e.latex);if(r.type=="Err")return undefined;return i.treeQueries.countNumbers(r,t)}}}}},types:{function:{evaluateAt:{version:"v2",description:function(){return u.i18n.s("cl-docs-description-lib-function")},lookup:function(e){var r;var s=(r=e.map(function(e){return e.type}),r[0]),u=r.slice(1);if(s.type!="function")throw new Error("EvaluateAt can only be called on a function");var c=s;if(u.length!=c.params.numVars){throw new Error("This function expects "+c.params.numVars+" arguments. "+("you can't evaluate with "+u.length+" arguments"))}for(var l=0,p=u;l<p.length;l++){var f=p[l];if(!a.Types.number.matches(f))throw new Error("All arguments to evaluateAt must be numbers")}return{valueType:a.Types.number,body:function(e){var r=[];for(var a=1;a<arguments.length;a++){r[a-1]=arguments[a]}if(e==undefined||n.any(r,function(e){return e==undefined})){return NaN}var s=r;var u=t.generateFunctionProxyVariables(s.length);var c=new i.context;c.processChangeSet({statements:[{id:"definition",latex:"f("+u.join(",")+")="+e}],isCompleteState:true,degreeMode:false});var l=i.parser.parse("f("+s.map(o.numberAsLatex).join(",")+")");var p=l.tryGetConcreteTree(i.policies.graphing,c.frame);var f=p.asValue();return typeof f==="number"?f:NaN}}}}},orderedPair:{x:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-ordered-pair-x")},argTypes:[a.Types.orderedPair],outputType:a.Types.latex,noUndefinedArgs:true,value:function(e){return e.x!=undefined?{latex:e.x}:undefined}},y:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-ordered-pair-y")},argTypes:[a.Types.orderedPair],outputType:a.Types.latex,noUndefinedArgs:true,value:function(e){return e.y!=undefined?{latex:e.y}:undefined}}},inequality:{rhs:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-inequality-rhs")},argTypes:[a.Types.inequality],outputType:a.Types.latex,noUndefinedArgs:true,value:function(e){return e.rhs!=undefined?{latex:e.rhs}:undefined}},lhs:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-inequality-lhs")},argTypes:[a.Types.inequality],outputType:a.Types.latex,noUndefinedArgs:true,value:function(e){return e.lhs!=undefined?{latex:e.lhs}:undefined}},isStrict:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-inequality-isStrict")},argTypes:[a.Types.inequality],outputType:a.Types.boolean,noUndefinedArgs:true,value:function(e){return e.strict}},isLeftGreater:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-inequality-is-left-greater")},argTypes:[a.Types.inequality],outputType:a.Types.boolean,noUndefinedArgs:true,value:function(e){return e.lhsGreater}},differenceFunction:{version:"v2",description:function(){return u.i18n.s("cl-docs-description-lib-inequality-difference-function")},noUndefinedArgs:true,lookup:l}},equation:{rhs:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-equation-rhs")},argTypes:[a.Types.equation],outputType:a.Types.latex,noUndefinedArgs:true,value:function(e){return e.rhs!=undefined?{latex:e.rhs}:undefined}},lhs:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-equation-lhs")},argTypes:[a.Types.equation],outputType:a.Types.latex,noUndefinedArgs:true,value:function(e){return e.lhs!=undefined?{latex:e.lhs}:undefined}},differenceFunction:{version:"v2",description:function(){return u.i18n.s("cl-docs-description-lib-difference-function")},noUndefinedArgs:true,lookup:l}},xyLine:{angle:p,slope:f,yIntercept:d,xIntercept:h,isHorizontal:m,isVertical:y}},constants:{}}});define("core/computation-layer/library/sketch",["require","exports","tslib","./colors","underscore","core/components/shared/sketch/sketch","core/computation-layer/cl-types","core/lib/mathtools","core/computation-layer/library/math","core/lib/i18n","core/lib/assert-unreachable"],function(e,t,r,n,i,o,a,s,u,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});var p={version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-point-count")},noUndefinedArgs:true,value:function(e){if(!e.points)return;return e.points.length},argTypes:[a.Types.sketch],outputType:a.Types.number};var f={version:"v3",description:function(){return c.i18n.raw("Returns the x coordinates of points in the sketch as a list")},noUndefinedArgs:true,value:function(e){return o.getPointCoords(e).map(function(e){return e.x})},argTypes:[a.Types.sketch],outputType:a.Types.numberList};var d={version:"v3",description:function(){return c.i18n.raw("Returns the y coordinates of points in the sketch as a list")},noUndefinedArgs:true,value:function(e){return o.getPointCoords(e).map(function(e){return e.y})},argTypes:[a.Types.sketch],outputType:a.Types.numberList};var h={version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-stroke-count")},value:function(e){if(!e)return 0;if(!e.strokes)return 0;return e.strokes.length},argTypes:[a.Types.sketch],outputType:a.Types.number};var m={version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-total-stroke-length")},argTypes:[a.Types.sketch],outputType:a.Types.number,value:o.getTotalStrokeLength};var y={version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-y-values")},noUndefinedArgs:true,argTypes:[a.Types.sketch,a.Types.number],outputType:a.Types.numberList,value:o.getValuesAt};var g={version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-x-values")},argTypes:[a.Types.sketch,a.Types.number],outputType:a.Types.numberList,noUndefinedArgs:true,value:o.getXValuesAt};function v(e){var t;switch(e){case"eraser":t=function(){return c.i18n.s("cl-docs-description-lib-sketch-tool-eraser")};break;case"line":t=function(){return c.i18n.s("cl-docs-description-lib-sketch-tool-line")};break;case"pencil":t=function(){return c.i18n.s("cl-docs-description-lib-sketch-tool-pencil")};break;default:t=l.assertUnreachable(e)}return{version:"v3",description:t,argTypes:[a.Types.sketchTools],outputType:a.Types.sketchTool,value:function(){return e}}}function b(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(e.length<2){throw Error("Expected at least 2 sketches.")}if(i.any(e,function(e){return e!==a.Types.sketch}))throw Error("Expected all arguments to be sketches. Got ["+e.join(", ")+"].");return a.Types.sketch}t.library={functions:{sketchStrokeCount:r.__assign(r.__assign({},h),{deprecated:function(){return c.i18n.s("cl-docs-warning-sketch-stroke-count-deprecation")}}),sketchPointCount:r.__assign(r.__assign({},p),{deprecated:function(){return c.i18n.s("cl-docs-warning-sketch-stroke-point-deprecation")}}),sketchTotalStrokeLength:r.__assign(r.__assign({},m),{deprecated:function(){return c.i18n.s("cl-docs-warning-sketch-stroke-total-stroke-length-deprecation")}}),sketchYValues:r.__assign(r.__assign({},y),{deprecated:function(){return c.i18n.s("cl-docs-warning-sketch-y-values-deprecation")}}),sketchXValues:r.__assign(r.__assign({},g),{deprecated:function(){return c.i18n.s("cl-docs-warning-sketch-x-values-deprecation")}}),mergeSketches:{version:"v2",description:function(){return c.i18n.s("cl-docs-description-lib-merge-sketches")},lookup:function(e){var t=b.apply(void 0,e.map(function(e){return e.type}));return{valueType:t,body:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r={strokes:[],points:[]};for(var n=0,i=e;n<i.length;n++){var o=i[n];if(!o)continue;for(var a=0,s=o.strokes;a<s.length;a++){var u=s[a];r.strokes.push(u)}for(var c=0,l=o.points;c<l.length;c++){var p=l[c];r.points.push(p)}if(o.bounds&&!r.bounds){r.bounds=o.bounds}}return r}}}}},types:{sketch:{filterByColor:{version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-filter-by-color")},argTypes:[a.Types.sketch,a.Types.color],outputType:a.Types.sketch,noUndefinedArgs:true,value:function(e,t){return o.filterByRgbColor(e,t)}},setColor:{version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-set-color")},argTypes:[a.Types.sketch,a.Types.color],outputType:a.Types.sketch,noUndefinedArgs:true,value:function(e,t){return o.replaceAllColors(e,n.colorToString(t))}},setOpacity:{version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-set-opacity")},argTypes:[a.Types.sketch,a.Types.number],outputType:a.Types.sketch,noUndefinedArgs:true,value:function(e,t){return o.replaceAllOpacity(e,t)}},pointCount:p,strokeCount:h,totalStrokeLength:m,yValuesAt:y,xValuesAt:g,pointXValues:f,pointYValues:d,transform:{version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-transform")},argTypes:[a.Types.sketch,a.Types.function2,a.Types.function2],outputType:a.Types.sketch,noUndefinedArgs:true,value:function(e,t,r){try{var n=new s.context;var i=u.generateFunctionProxyVariables(2);n.processChangeSet({statements:[{id:"X",latex:"f("+i.join(",")+")="+t},{id:"Y",latex:"g("+i.join(",")+")="+r}]});var a=function(e){e=e.replace(/\\operatorname\{(.*)\}/,"$1");return e.replace(/[{}\\]/g,"")};var c=i.map(function(e){return a(e)});var l=n.analysis.X.concreteTree.getCompiledFunction(c).fn;var p=n.analysis.Y.concreteTree.getCompiledFunction(c).fn;var f=function(e){return{x:l(e.x,e.y),y:p(e.x,e.y)}};return o.transformCoordinates(e,f)}catch(e){return undefined}}}},sketchTools:{pencil:v("pencil"),line:v("line"),eraser:v("eraser")}},constants:{sketchTools:{valueType:a.Types.sketchTools,value:{},description:function(){return c.i18n.s("cl-docs-description-lib-sketch-tools")}}}}});define("core/computation-layer/library/button-styles",["require","exports","core/computation-layer/cl-types","core/lib/i18n"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e){return{version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-style-getter",{styleName:n.i18n.raw(e)})},argTypes:[r.Types.buttonStyles],outputType:r.Types.buttonStyle,value:function(){return e}}}t.library={functions:{},types:{buttonStyles:{red:i("red"),default:i("default"),link:i("link")}},constants:{buttonStyles:{valueType:r.Types.buttonStyles,value:{},description:function(){return n.i18n.s("cl-docs-description-lib-button-styles")}}}}});define("core/computation-layer/library/lists",["require","exports","../cl-types","core/lib/i18n"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i={version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-length")},argTypes:[r.Types.numberList],outputType:r.Types.number,noUndefinedArgs:true,value:function(e){return e.length}};var o={version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-elementAt")},argTypes:[r.Types.numberList,r.Types.number],outputType:r.Types.number,noUndefinedArgs:true,value:function(e,t){return e[t-1]}};t.library={functions:{max:{version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-max")},argTypes:[r.Types.numberList],outputType:r.Types.number,noUndefinedArgs:true,value:function(e){return Math.max.apply(Math,e)}},min:{version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-min")},argTypes:[r.Types.numberList],outputType:r.Types.number,noUndefinedArgs:true,value:function(e){return Math.min.apply(Math,e)}},length:i},types:{numberList:{length:i,elementAt:o}},constants:{}}});define("core/computation-layer/pattern-cl-types",["require","exports","tslib","./cl-types","core/lib/assert-unreachable"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});var o=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"sumPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.sumTypeCache[r]==undefined){this.sumTypeCache[r]=new t(e)}return this.sumTypeCache[r]};t.sumTypeCache={};return t}(n.CLType);t.SumPatternType=o;var a=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"productPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.productTypeCache[r]==undefined){this.productTypeCache[r]=new t(e)}return this.productTypeCache[r]};t.productTypeCache={};return t}(n.CLType);t.ProductPatternType=a;var s=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"containsPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.containsTypeCache[r]==undefined){this.containsTypeCache[r]=new t(e)}return this.containsTypeCache[r]};t.containsTypeCache={};return t}(n.CLType);t.ContainsPatternType=s;var u=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"exponentPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.exponentTypeCache[r]==undefined){this.exponentTypeCache[r]=new t(e)}return this.exponentTypeCache[r]};t.exponentTypeCache={};return t}(n.CLType);t.ExponentPatternType=u;var c=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"fractionPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.fractionTypeCache[r]==undefined){this.fractionTypeCache[r]=new t(e)}return this.fractionTypeCache[r]};t.fractionTypeCache={};return t}(n.CLType);t.FractionPatternType=c;var l=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"negativePattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.negativeTypeCache[r]==undefined){this.negativeTypeCache[r]=new t(e)}return this.negativeTypeCache[r]};t.negativeTypeCache={};return t}(n.CLType);t.NegativePatternType=l;var p=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"radicalPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.radicalTypeCache[r]==undefined){this.radicalTypeCache[r]=new t(e)}return this.radicalTypeCache[r]};t.radicalTypeCache={};return t}(n.CLType);t.RadicalPatternType=p;var f=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"differencePattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.differenceTypeCache[r]==undefined){this.differenceTypeCache[r]=new t(e)}return this.differenceTypeCache[r]};t.differenceTypeCache={};return t}(n.CLType);t.DifferencePatternType=f;var d=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"repeatedPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.repeatedTypeCache[r]==undefined){this.repeatedTypeCache[r]=new t(e)}return this.repeatedTypeCache[r]};t.repeatedTypeCache={};return t}(n.CLType);t.RepeatedTermType=d;var h=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"sumPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.sumMatchTypeCache[r]==undefined){this.sumMatchTypeCache[r]=new t(e)}return this.sumMatchTypeCache[r]};t.sumMatchTypeCache={};return t}(n.CLType);var m=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"productPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.productMatchTypeCache[r]==undefined){this.productMatchTypeCache[r]=new t(e)}return this.productMatchTypeCache[r]};t.productMatchTypeCache={};return t}(n.CLType);var y=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"exponentPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.exponentMatchTypeCache[r]==undefined){this.exponentMatchTypeCache[r]=new t(e)}return this.exponentMatchTypeCache[r]};t.exponentMatchTypeCache={};return t}(n.CLType);var g=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"containsPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.containsMatchTypeCache[r]==undefined){this.containsMatchTypeCache[r]=new t(e)}return this.containsMatchTypeCache[r]};t.containsMatchTypeCache={};return t}(n.CLType);var v=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"fractionPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.fractionMatchTypeCache[r]==undefined){this.fractionMatchTypeCache[r]=new t(e)}return this.fractionMatchTypeCache[r]};t.fractionMatchTypeCache={};return t}(n.CLType);var b=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"negativePatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.negativeMatchTypeCache[r]==undefined){this.negativeMatchTypeCache[r]=new t(e)}return this.negativeMatchTypeCache[r]};t.negativeMatchTypeCache={};return t}(n.CLType);var x=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"radicalPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.radicalMatchTypeCache[r]==undefined){this.radicalMatchTypeCache[r]=new t(e)}return this.radicalMatchTypeCache[r]};t.radicalMatchTypeCache={};return t}(n.CLType);var _=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"differencePatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.differenceMatchTypeCache[r]==undefined){this.differenceMatchTypeCache[r]=new t(e)}return this.differenceMatchTypeCache[r]};t.differenceMatchTypeCache={};return t}(n.CLType);var S=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"repeatedPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.repeatedMatchTypeCache[r]==undefined){this.repeatedMatchTypeCache[r]=new t(e)}return this.repeatedMatchTypeCache[r]};t.repeatedMatchTypeCache={};return t}(n.CLType);function T(e){switch(e.type){case"sum":return o.get(e);case"product":return a.get(e);case"exponent":return u.get(e);case"fraction":return c.get(e);case"difference":return f.get(e);case"negative":return l.get(e);case"radical":return p.get(e);case"contains":return s.get(e);case"repeated":return d.get(e);case"number":return n.Types.numberPattern;case"mixedNumber":return n.Types.mixedNumberPattern;case"literal":return n.Types.literalPattern;case"expression":return n.Types.expressionPattern;case"or":return n.Types.orPattern;case"scientific":return n.Types.scientificPattern;default:return i.assertUnreachable(e)}}t.getPatternTypeFromSpec=T;function w(e){switch(e.type){case"sum":return h.get(e);case"product":return m.get(e);case"exponent":return y.get(e);case"fraction":return v.get(e);case"difference":return _.get(e);case"negative":return b.get(e);case"radical":return x.get(e);case"repeated":return S.get(e);case"contains":return g.get(e);case"literal":return n.Types.literalPatternMatch;case"number":return n.Types.numberPatternMatch;case"mixedNumber":return n.Types.mixedNumberPatternMatch;case"expression":return n.Types.expressionPatternMatch;case"or":return n.Types.orPatternMatch;case"scientific":return n.Types.scientificPatternMatch;default:return i.assertUnreachable(e)}}t.getPatternMatchTypeFromSpec=w;function E(e){if(!t.patternValidator.matches(e)){throw new Error("Expected "+t.patternValidator+", but got "+e)}switch(e.type){case"exponentPattern":case"fractionPattern":case"differencePattern":case"radicalPattern":case"sumPattern":case"productPattern":case"containsPattern":case"negativePattern":return e.params;case"numberPattern":return{type:"number"};case"mixedNumberPattern":return{type:"mixedNumber"};case"literalPattern":return{type:"literal"};case"expressionPattern":return{type:"expression"};case"orPattern":return{type:"or"};case"scientificPattern":return{type:"scientific"};default:return i.assertUnreachable(e)}}t.patternParamsFromType=E;function M(e){if(e instanceof d){return e.params}return E(e)}t.termParamsFromType=M;t.patternValidator={matches:function(e){return e.type=="numberPattern"||e.type=="mixedNumberPattern"||e.type=="sumPattern"||e.type=="productPattern"||e.type=="exponentPattern"||e.type=="literalPattern"||e.type=="orPattern"||e.type=="expressionPattern"||e.type=="scientificPattern"||e.type=="fractionPattern"||e.type=="negativePattern"||e.type=="differencePattern"||e.type=="radicalPattern"||e.type=="containsPattern"},toString:function(){return"A pattern of some type"}}});define("core/computation-layer/library/patterns",["require","exports","tslib","core/lib/mathtools","../cl-types","./patterns.matching","core/computation-layer/pattern-cl-types","core/lib/i18n","core/lib/evaluator-helpers"],function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});var c={latex:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-match-latex")},noUndefinedArgs:true,lookup:function(e){if(e.length!=1)throw new Error("Expected no arguments");return{valueType:i.Types.latex,body:function(e){return e.latex!=undefined?{latex:e.latex}:undefined}}}}};function l(e){var t={};var r=function(r){var n=r+1;var i=r;t["term"+n]={version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-term-n",{termNumber:n})},validForType:function(t){var r=t.params;return r.terms&&r.terms.length>=e},noUndefinedArgs:true,lookup:function(e){if(e.length!=1)throw new Error("No arguments expected");var t=e[0].type;return{body:function(e){return e.terms[i]},valueType:a.getPatternMatchTypeFromSpec(g(t.params.terms[i]))}}}};for(var n=0;n<e;n++){r(n)}return t}function p(e,t){return{version:"v2",description:t,noUndefinedArgs:true,lookup:function(t){if(t.length!=1){throw new Error("No arguments expected")}var r=t[0].type;return{body:function(t){return t[e]},valueType:a.getPatternMatchTypeFromSpec(r.params[e])}}}}function f(){return{strictOrder:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-strict-order")},noUndefinedArgs:true,lookup:function(e){if(e.length!=1){throw new Error("strictOrder doesn't accept any arguments")}return{body:function(e){return r.__assign(r.__assign({},e),{strictOrder:true})},valueType:e[0].type}}}}}var d={rejectParens:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-reject-parens")},noUndefinedArgs:true,lookup:function(e){if(e.length!=1){throw new Error("rejectParens doesn't accept any arguments")}return{body:function(e){return r.__assign(r.__assign({},e),{rejectParens:true})},valueType:e[0].type}}},allowParens:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-allow-parens")},noUndefinedArgs:true,lookup:function(e){if(e.length!=1){throw new Error("rejectParens doesn't accept any arguments")}return{body:function(e){return r.__assign(r.__assign({},e),{rejectParens:false})},valueType:e[0].type}}}};function h(e){return{parse:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-parse")},lookup:function(t){if(t.length!=2)throw new Error("Expected latex string as only argument");var r=t[0],a=t[1];var s=[];if(!(i.Types.string.matches(a.type)||i.Types.latex.matches(a.type))){throw new Error("Expected latex, got "+a.type)}if(!i.Types.latex.matches(a.type)){}return{valueType:e(r.type),warnings:s,desiredArgTypes:[r.type,i.Types.latex],body:function(e,t){if(!e){return undefined}var r=t?n.expressionParser.parse(t.latex):undefined;var i={rejectParens:false,strictOrder:false};return o.matchPattern(e,r,i)}}}},matches:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-matches")},lookup:function(e){if(e.length!=2){throw new Error("Expected a single latex argument.")}if(!a.patternValidator.matches(e[0].type)){throw new Error("Internal error. Matches called on unexpected pattern type")}if(!(i.Types.latex.matches(e[1].type)||i.Types.string.matches(e[1].type))){throw new Error("Expected argument to be latex, but got "+e[1].type.type)}var t=[];if(!i.Types.latex.matches(e[1].type)){}return{valueType:i.Types.boolean,warnings:t,desiredArgTypes:[e[0].type,i.Types.latex],body:function(e,t){if(!e){return undefined}var r=t?n.expressionParser.parse(t.latex):undefined;var i={rejectParens:false,strictOrder:false};return!!o.matchPattern(e,r,i)}}}}}}t.library={functions:{},types:{patternLibrary:{number:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-number")},argTypes:[i.Types.patternLibrary],outputType:i.Types.numberPattern,value:function(){return{type:"number"}}},integer:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-integer")},argTypes:[i.Types.patternLibrary],outputType:i.Types.numberPattern,value:function(){return{type:"number",integerOnly:true}}},mixedNumber:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-mixed-number")},argTypes:[i.Types.patternLibrary],outputType:i.Types.mixedNumberPattern,value:function(){return{type:"mixedNumber"}}},scientific:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-scientific")},argTypes:[i.Types.patternLibrary],outputType:i.Types.scientificPattern,value:function(){return{type:"scientific"}}},literal:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-literal")},argTypes:[i.Types.patternLibrary,i.Types.latex],outputType:i.Types.literalPattern,noUndefinedArgs:true,value:function(e,t){return{type:"literal",text:t.latex}}},expression:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-expression")},argTypes:[i.Types.patternLibrary],outputType:i.Types.expressionPattern,value:function(e){return{type:"expression"}}},anyOf:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-any-of")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e.slice(1);i.assertType(i.Types.patternLibrary,t.type);for(var n=0,o=r;n<o.length;n++){var s=o[n];var u=a.patternParamsFromType(s.type);if(u.type=="or"){throw new Error("Instead of nesting or terms, just put all terms in a single or()")}}return{body:function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}return{type:"or",options:t}},valueType:i.Types.orPattern}}},sum:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-sum")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e.slice(1);i.assertType(i.Types.patternLibrary,t.type);var n=r.map(function(e){var t=a.termParamsFromType(e.type);if(t.type=="sum"){throw new Error("Instead of nesting sums, just put all terms in a single sum()")}return t});return{body:function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}return{type:"sum",terms:t}},valueType:a.getPatternTypeFromSpec({type:"sum",terms:m(n)})}}},contains:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-contains")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e.slice(1);i.assertType(i.Types.patternLibrary,t.type);if(r.length!=1){throw new Error("Current implementation only accepts a single term")}return{body:function(e,t){return{type:"contains",terms:[t]}},valueType:a.getPatternTypeFromSpec({type:"contains",terms:m([a.termParamsFromType(r[0].type)])})}}},product:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-product")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e.slice(1);i.assertType(i.Types.patternLibrary,t.type);var n=r.map(function(e){var t=a.termParamsFromType(e.type);if(t.type=="product"){throw new Error("Instead of nesting products, just put all terms in a single product()")}return t});return{body:function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}return{type:"product",terms:t}},valueType:a.getPatternTypeFromSpec({type:"product",terms:m(n)})}}},exponent:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-exponent")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1],n=e[2];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t,r){return{type:"exponent",base:t,power:r}},valueType:a.getPatternTypeFromSpec({type:"exponent",base:y(a.patternParamsFromType(r.type)),power:y(a.patternParamsFromType(n.type))})}}},fraction:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-fraction")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1],n=e[2];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t,r){return{type:"fraction",numerator:t,denominator:r}},valueType:a.getPatternTypeFromSpec({type:"fraction",numerator:y(a.patternParamsFromType(r.type)),denominator:y(a.patternParamsFromType(n.type))})}}},radical:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-radical")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1],n=e[2];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t,r){return{type:"radical",radicand:t,degree:r}},valueType:a.getPatternTypeFromSpec({type:"radical",radicand:y(a.patternParamsFromType(r.type)),degree:n?y(a.patternParamsFromType(n.type)):undefined})}}},negative:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-negative")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t){return{type:"negative",negated:t}},valueType:a.getPatternTypeFromSpec({type:"negative",negated:y(a.patternParamsFromType(r.type))})}}},difference:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-difference")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1],n=e[2];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t,r){return{type:"difference",subtrahend:r,minuend:t}},valueType:a.getPatternTypeFromSpec({type:"difference",subtrahend:y(a.patternParamsFromType(n.type)),minuend:y(a.patternParamsFromType(r.type))})}}},repeat:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-repeat")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t){return{type:"repeated",pattern:t}},valueType:a.RepeatedTermType.get({type:"repeated",pattern:a.patternParamsFromType(r.type)})}}},optional:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-optional")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t){return{type:"repeated",min:0,max:1,pattern:t}},valueType:a.RepeatedTermType.get({type:"repeated",pattern:a.patternParamsFromType(r.type)})}}}},numberPattern:r.__assign(r.__assign(r.__assign({},h(function(){return i.Types.numberPatternMatch})),d),{satisfies:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-satisfies")},noUndefinedArgs:true,lookup:function(e){if(e.length!=2||!(i.Types.string.matches(e[1].type)||i.Types.latex.matches(e[1].type))){throw new Error("number.satisfies() requires one argument - latex like `x>0`")}var t=[];if(!i.Types.latex.matches(e[1].type)){}return{valueType:e[0].type,warnings:t,desiredArgTypes:[e[0].type,i.Types.latex],body:function(e,t){return r.__assign(r.__assign({},e),{conditions:r.__spreadArrays(e.conditions||[],[t.latex])})}}}}}),scientificPattern:r.__assign({},h(function(){return i.Types.scientificPatternMatch})),mixedNumberPattern:r.__assign({},h(function(){return i.Types.mixedNumberPatternMatch})),exponentPattern:r.__assign(r.__assign({},h(function(e){return a.getPatternMatchTypeFromSpec(e.params)})),d),fractionPattern:r.__assign(r.__assign({},h(function(e){return a.getPatternMatchTypeFromSpec(e.params)})),d),negativePattern:r.__assign(r.__assign({},h(function(e){return a.getPatternMatchTypeFromSpec(e.params)})),d),radicalPattern:r.__assign(r.__assign({},h(function(e){return a.getPatternMatchTypeFromSpec(e.params)})),d),differencePattern:r.__assign(r.__assign({},h(function(e){return a.getPatternMatchTypeFromSpec(e.params)})),d),sumPattern:r.__assign(r.__assign(r.__assign({},h(function(e){return a.getPatternMatchTypeFromSpec(e.params)})),f()),d),productPattern:r.__assign(r.__assign(r.__assign({},h(function(e){return a.getPatternMatchTypeFromSpec(e.params)})),f()),d),containsPattern:r.__assign({},h(function(e){return a.getPatternMatchTypeFromSpec(e.params)})),literalPattern:r.__assign(r.__assign({},h(function(){return i.Types.literalPatternMatch})),d),expressionPattern:r.__assign(r.__assign({},h(function(){return i.Types.expressionPatternMatch})),d),orPattern:r.__assign({},h(function(){return i.Types.orPatternMatch})),sumPatternMatch:r.__assign(r.__assign({},c),l(10)),productPatternMatch:r.__assign(r.__assign({},c),l(10)),containsPatternMatch:r.__assign(r.__assign({},c),l(1)),expressionPatternMatch:r.__assign({},c),exponentPatternMatch:r.__assign(r.__assign({},c),{base:p("base",function(){return s.i18n.s("cl-docs-description-lib-pattern-base")}),exponent:p("power",function(){return s.i18n.s("cl-docs-description-lib-pattern-power")})}),fractionPatternMatch:r.__assign(r.__assign({},c),{numerator:p("numerator",function(){return s.i18n.s("cl-docs-description-lib-pattern-numerator")}),denominator:p("denominator",function(){return s.i18n.s("cl-docs-description-lib-pattern-denominator")})}),negativePatternMatch:r.__assign(r.__assign({},c),{negated:p("negated",function(){return s.i18n.s("cl-docs-description-lib-pattern-negated")})}),radicalPatternMatch:r.__assign(r.__assign({},c),{radicand:p("radicand",function(){return s.i18n.s("cl-docs-description-lib-pattern-radicand")}),degree:r.__assign(r.__assign({},p("degree",function(){return s.i18n.s("cl-docs-description-lib-pattern-degree")})),{validForType:function(e){return e.type=="radicalPatternMatch"&&!!e.params.degree}})}),differencePatternMatch:r.__assign(r.__assign({},c),{subtrahend:p("subtrahend",function(){return s.i18n.s("cl-docs-description-lib-pattern-subtrahend")}),minuend:p("minuend",function(){return s.i18n.s("cl-docs-description-lib-pattern-minuend")})}),literalPatternMatch:r.__assign({},c),repeatedPatternMatch:{n:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-repeated-n")},noUndefinedArgs:true,lookup:function(e){if(e.length!=1)throw new Error("No arguments expected");return{valueType:i.Types.number,body:function(e){return e&&e.matches.length}}}},nth:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-repeated-nth")},noUndefinedArgs:true,lookup:function(e){if(e.length!=2){throw new Error("Expected a single number as an argument")}var t=e[0],r=e[1];if(!i.Types.number.matches(r.type)){throw new Error("Expected "+i.Types.number+", got "+e[1].type)}return{body:function(e,t){return e.matches[t-1]},valueType:a.getPatternMatchTypeFromSpec(t.type.params.pattern)}}}},numberPatternMatch:r.__assign(r.__assign({},c),{numericValue:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-number-numeric-value")},argTypes:[i.Types.numberPatternMatch],outputType:i.Types.number,value:function(e){return e?u.computeNumericValueFromLatex(e.latex):NaN}}}),scientificPatternMatch:r.__assign(r.__assign({},c),{numericValue:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-scientific-numeric-value")},argTypes:[i.Types.scientificPatternMatch],outputType:i.Types.number,value:function(e){return e?u.computeNumericValueFromLatex(e.latex):NaN}},coefficient:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-scientific-coefficient")},argTypes:[i.Types.scientificPatternMatch],outputType:i.Types.number,value:function(e){return e&&e.coefficient}},exponent:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-scientific-exponent")},argTypes:[i.Types.scientificPatternMatch],outputType:i.Types.number,value:function(e){return e&&e.exponent}}}),mixedNumberPatternMatch:r.__assign(r.__assign({},c),{whole:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-mixed-number-whole")},argTypes:[i.Types.mixedNumberPatternMatch],outputType:i.Types.number,value:function(e){return e&&e.whole}},numerator:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-mixed-number-numerator")},argTypes:[i.Types.mixedNumberPatternMatch],outputType:i.Types.number,value:function(e){return e&&e.numerator}},denominator:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-mixed-number-denominator")},argTypes:[i.Types.mixedNumberPatternMatch],outputType:i.Types.number,value:function(e){return e&&e.denominator}},numericValue:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-mixed-number-numeric-value")},argTypes:[i.Types.mixedNumberPatternMatch],outputType:i.Types.number,value:function(e){return e?u.computeNumericValueFromLatex(e.latex):NaN}}})},constants:{patterns:{valueType:i.Types.patternLibrary,value:{},description:function(){return s.i18n.s("cl-docs-description-lib-patterns")},internal:true}}};function m(e){return e}function y(e){return e}function g(e){return e}});(function(e){"use strict";function t(e,t){var r=(e&65535)+(t&65535);var n=(e>>16)+(t>>16)+(r>>16);return n<<16|r&65535}function r(e,t){return e<<t|e>>>32-t}function n(e,n,i,o,a,s){return t(r(t(t(n,e),t(o,s)),a),i)}function i(e,t,r,i,o,a,s){return n(t&r|~t&i,e,t,o,a,s)}function o(e,t,r,i,o,a,s){return n(t&i|r&~i,e,t,o,a,s)}function a(e,t,r,i,o,a,s){return n(t^r^i,e,t,o,a,s)}function s(e,t,r,i,o,a,s){return n(r^(t|~i),e,t,o,a,s)}function u(e,r){e[r>>5]|=128<<r%32;e[(r+64>>>9<<4)+14]=r;var n;var u;var c;var l;var p;var f=1732584193;var d=-271733879;var h=-1732584194;var m=271733878;for(n=0;n<e.length;n+=16){u=f;c=d;l=h;p=m;f=i(f,d,h,m,e[n],7,-680876936);m=i(m,f,d,h,e[n+1],12,-389564586);h=i(h,m,f,d,e[n+2],17,606105819);d=i(d,h,m,f,e[n+3],22,-1044525330);f=i(f,d,h,m,e[n+4],7,-176418897);m=i(m,f,d,h,e[n+5],12,1200080426);h=i(h,m,f,d,e[n+6],17,-1473231341);d=i(d,h,m,f,e[n+7],22,-45705983);f=i(f,d,h,m,e[n+8],7,1770035416);m=i(m,f,d,h,e[n+9],12,-1958414417);h=i(h,m,f,d,e[n+10],17,-42063);d=i(d,h,m,f,e[n+11],22,-1990404162);f=i(f,d,h,m,e[n+12],7,1804603682);m=i(m,f,d,h,e[n+13],12,-40341101);h=i(h,m,f,d,e[n+14],17,-1502002290);d=i(d,h,m,f,e[n+15],22,1236535329);f=o(f,d,h,m,e[n+1],5,-165796510);m=o(m,f,d,h,e[n+6],9,-1069501632);h=o(h,m,f,d,e[n+11],14,643717713);d=o(d,h,m,f,e[n],20,-373897302);f=o(f,d,h,m,e[n+5],5,-701558691);m=o(m,f,d,h,e[n+10],9,38016083);h=o(h,m,f,d,e[n+15],14,-660478335);d=o(d,h,m,f,e[n+4],20,-405537848);f=o(f,d,h,m,e[n+9],5,568446438);m=o(m,f,d,h,e[n+14],9,-1019803690);h=o(h,m,f,d,e[n+3],14,-187363961);d=o(d,h,m,f,e[n+8],20,1163531501);f=o(f,d,h,m,e[n+13],5,-1444681467);m=o(m,f,d,h,e[n+2],9,-51403784);h=o(h,m,f,d,e[n+7],14,1735328473);d=o(d,h,m,f,e[n+12],20,-1926607734);f=a(f,d,h,m,e[n+5],4,-378558);m=a(m,f,d,h,e[n+8],11,-2022574463);h=a(h,m,f,d,e[n+11],16,1839030562);d=a(d,h,m,f,e[n+14],23,-35309556);f=a(f,d,h,m,e[n+1],4,-1530992060);m=a(m,f,d,h,e[n+4],11,1272893353);h=a(h,m,f,d,e[n+7],16,-155497632);d=a(d,h,m,f,e[n+10],23,-1094730640);f=a(f,d,h,m,e[n+13],4,681279174);m=a(m,f,d,h,e[n],11,-358537222);h=a(h,m,f,d,e[n+3],16,-722521979);d=a(d,h,m,f,e[n+6],23,76029189);f=a(f,d,h,m,e[n+9],4,-640364487);m=a(m,f,d,h,e[n+12],11,-421815835);h=a(h,m,f,d,e[n+15],16,530742520);d=a(d,h,m,f,e[n+2],23,-995338651);f=s(f,d,h,m,e[n],6,-198630844);m=s(m,f,d,h,e[n+7],10,1126891415);h=s(h,m,f,d,e[n+14],15,-1416354905);d=s(d,h,m,f,e[n+5],21,-57434055);f=s(f,d,h,m,e[n+12],6,1700485571);m=s(m,f,d,h,e[n+3],10,-1894986606);h=s(h,m,f,d,e[n+10],15,-1051523);d=s(d,h,m,f,e[n+1],21,-2054922799);f=s(f,d,h,m,e[n+8],6,1873313359);m=s(m,f,d,h,e[n+15],10,-30611744);h=s(h,m,f,d,e[n+6],15,-1560198380);d=s(d,h,m,f,e[n+13],21,1309151649);f=s(f,d,h,m,e[n+4],6,-145523070);m=s(m,f,d,h,e[n+11],10,-1120210379);h=s(h,m,f,d,e[n+2],15,718787259);d=s(d,h,m,f,e[n+9],21,-343485551);f=t(f,u);d=t(d,c);h=t(h,l);m=t(m,p)}return[f,d,h,m]}function c(e){var t;var r="";var n=e.length*32;for(t=0;t<n;t+=8){r+=String.fromCharCode(e[t>>5]>>>t%32&255)}return r}function l(e){var t;var r=[];r[(e.length>>2)-1]=undefined;for(t=0;t<r.length;t+=1){r[t]=0}var n=e.length*8;for(t=0;t<n;t+=8){r[t>>5]|=(e.charCodeAt(t/8)&255)<<t%32}return r}function p(e){return c(u(l(e),e.length*8))}function f(e,t){var r;var n=l(e);var i=[];var o=[];var a;i[15]=o[15]=undefined;if(n.length>16){n=u(n,e.length*8)}for(r=0;r<16;r+=1){i[r]=n[r]^909522486;o[r]=n[r]^1549556828}a=u(i.concat(l(t)),512+t.length*8);return c(u(o.concat(a),512+128))}function d(e){var t="0123456789abcdef";var r="";var n;var i;for(i=0;i<e.length;i+=1){n=e.charCodeAt(i);r+=t.charAt(n>>>4&15)+t.charAt(n&15)}return r}function h(e){return unescape(encodeURIComponent(e))}function m(e){return p(h(e))}function y(e){return d(m(e))}function g(e,t){return f(h(e),h(t))}function v(e,t){return d(g(e,t))}function b(e,t,r){if(!t){if(!r){return y(e)}return m(e)}if(!r){return v(t,e)}return g(t,e)}if(typeof define==="function"&&define.amd){define("vendor/md5",[],function(){return b})}else if(typeof module==="object"&&module.exports){module.exports=b}else{e.md5=b}})(this);define("core/computation-layer/library/random",["require","exports","vendor/md5","underscore","../cl-types","../helpers","core/lib/i18n"],function(e,t,r,n,i,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.Generator=i.Generator;var s={version:"v2",description:function(){return a.i18n.s("cl-docs-description-lib-random-generator")},lookup:function(e,t){var r=e.slice(0);for(var n=0,a=r;n<a.length;n++){var s=a[n];if(s.type!=i.Types.number){throw new Error("All seeds to randomGenerator must be numbers")}}return{valueType:i.Types.randomGenerator,prependGlobalConstants:["randomSeedNodeId"],body:function(e){var r=[];for(var n=1;n<arguments.length;n++){r[n-1]=arguments[n]}if(!o.isCLStringType(e)){throw new Error("Internal CL Error: Expected a CL String randomSeedCLValue prepended to argument list.")}return{locationIdentifier:t.locationIdentifier,seeds:r,studentId:o.synthesizeStringInternal(e),plaintextBase:o.synthesizeStringInternal(e)+"::"+t.locationIdentifier+"::"+r.join(":")}}}}};var u={version:"v2",description:function(){return a.i18n.s("cl-docs-description-lib-random-int")},lookup:function(e,t){if(e.length!=3)throw new Error("int expects 2 arguments");if(e[1].type!=i.Types.number||e[2].type!=i.Types.number){throw new Error("Both arguments to int must be numbers")}return{valueType:i.Types.number,body:function(e,n,i){var o;if(n==undefined||i==undefined){return NaN}n=Math.round(n);i=Math.round(i);if(n>i)o=[i,n],n=o[0],i=o[1];if(n==i)return n;if(!(n>-2147483648))return NaN;if(!(i<2147483648))return NaN;var a=e.plaintextBase+"::"+t.locationIdentifier;var s=0;var u=0;var c=i-n+1;var l=c*Math.floor(4294967296/c);do{var p=a+"::"+s++;var f=r(p);u=parseInt(f.slice(0,8),16)}while(u>=l);var d=u%c;return n+d}}}};var c={version:"v2",description:function(){return a.i18n.s("cl-docs-description-lib-random-float")},lookup:function(e,t){if(e.length!=3)throw new Error("int expects 2 arguments");if(e[1].type!=i.Types.number||e[2].type!=i.Types.number){throw new Error("Both arguments to int must be numbers")}return{valueType:i.Types.number,body:function(e,i,o){var a;if(i==undefined||!n.isFinite(i))return NaN;if(o==undefined||!n.isFinite(o))return NaN;if(i==o)return i;if(i>o)a=[o,i],i=a[0],o=a[1];var s=e.plaintextBase+"::"+t.locationIdentifier;var u=r(s);var c=parseInt(u.slice(0,8),16)&2097151;var l=parseInt(u.slice(8,16),16);var p=(c*4294967296+l)/9007199254740992;return i+p*(o-i)}}}};t.library={functions:{randomGenerator:s},types:{randomGenerator:{int:u,float:c}},constants:{}}});define("core/computation-layer/library/layer",["require","exports","../cl-types","core/lib/i18n"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(e.length<2){throw Error("Expected at least 2 layers.")}for(var n=0;n<e.length;n++){if(e[n]!==r.Types.layer){throw Error("Expected all arguments to be layers. Got ["+e.join(", ")+"].")}}return r.Types.layer}t.library={functions:{sketchLayer:{version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-skech-layer")},argTypes:[r.Types.sketch],outputType:r.Types.layer,noUndefinedArgs:true,value:function(e){return{type:"sketch",sketch:e}}},layerStack:{version:"v2",description:function(){return n.i18n.s("cl-docs-description-lib-layer-stack")},lookup:function(e){var t=i.apply(void 0,e.map(function(e){return e.type}));return{valueType:t,body:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return{type:"stack",layers:e.filter(function(e){return e!=undefined})}}}}},graphLayer:{version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-graph-layer")},argTypes:[r.Types.calculatorStateWithSinkValues],outputType:r.Types.layer,noUndefinedArgs:true,value:function(e){return{type:"graph",calculatorStateWithSinkValues:e}}}},types:{},constants:{}}});define("core/computation-layer/library/index",["require","exports","./builtin","./sketch","./button-styles","./colors","./lists","core/computation-layer/library/math","./patterns","./random","core/computation-layer/library/bounds","./layer"],function(e,t,r,n,i,o,a,s,u,c,l,p){"use strict";var f={functions:{},types:{},constants:{}};var d=function(e){if(e.functions){for(var t in e.functions){if(f.functions[t]){throw new Error("Duplicate library function declaration "+t)}f.functions[t]=e.functions[t]}}if(e.types){for(var r in e.types){if(f.types[r]){throw new Error("Duplicate library function declaration "+r)}f.types[r]=e.types[r]}}if(e.constants){for(var n in e.constants){if(f.constants[n]){throw new Error("Duplicate library constant declaration "+n)}f.constants[n]=e.constants[n]}}};d(r.library);d(n.library);d(i.library);d(o.library);d(a.library);d(s.library);d(u.library);d(c.library);d(l.library);d(p.library);return f});define("core/components/shared/button-sources",["require","exports","core/lib/i18n","core/computation-layer/cl-types"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.fieldNames={"action-button":{submitCount:"action-submit-count",history:"action-history"},"input/expression":{submitCount:"expression-submit-count",history:"expression-history"},table:{submitCount:"table-submit-count",history:"table-history"},legacy:{submitCount:"submitCount",history:"history"}};function i(e){return{history:{description:function(){return r.i18n.s("cl-docs-description-button-history")},analyzeValueType:{type:"concrete",valueType:n.Types.numberList},params:[{name:"key",type:n.Types.string}],computeFromResponse:function(r,n){var i=n.params;var o=i[0];var a=r[t.fieldNames[e].history];if(a==undefined){a=r.history}if(a==undefined)return[];var s=a[o];if(s==undefined)return[];return s||[]}},lastValue:{description:function(){return r.i18n.s("cl-docs-description-button-last-value")},analyzeValueType:{type:"concrete",valueType:n.Types.number},params:[{name:"key",type:n.Types.string}],computeFromResponse:function(r,n){var i=n.params;var o=i[0];var a=r[t.fieldNames[e].history];if(a==undefined){a=r.history}if(a==undefined)return NaN;var s=a[o];if(s==undefined)return NaN;var u=s[s.length-1];return u==undefined?NaN:u}},submitCount:{description:function(){return r.i18n.s("cl-docs-description-button-submit-count")},analyzeValueType:{type:"concrete",valueType:n.Types.number},computeFromResponse:function(r){var n=r[t.fieldNames[e].submitCount];if(n==undefined)n=r.submitCount;return n==undefined?0:n}}}}t.ButtonSources=i});define("core/components/shared/hidden-sink",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.hiddenSink=n.convertSinkList({hidden:{description:function(){return r.i18n.s("cl-docs-description-hidden")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean}}})});define("core/components/shared/reset-on-change-sink",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.resetOnChangeSink=n.convertSinkList({resetOnChange:{description:function(){return r.i18n.s("cl-docs-description-reset-on-change")},analyzeValueType:{type:"concrete",valueType:i.Types.string}}})});define("core/components/action-button/cl-spec",["require","exports","tslib","core/lib/i18n","core/computation-layer/types","core/components/shared/button-sources","core/computation-layer/cl-types","core/components/shared/hidden-sink","core/components/shared/reset-on-change-sink"],function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});var c=o.ButtonSources("action-button");var l={description:function(){return n.i18n.s("cl-docs-description-action-button-time-since-press")},analyzeValueType:{type:"concrete",valueType:a.Types.number},publishedBy:"playgroundController",computeFromResponse:function(e,t){var r=t.params;return e.buttonPressed?r[0]:0},params:[{name:"maxTime",type:a.Types.number,default:10}]};var p=c.history;var f=c.lastValue;var d=r.__assign(r.__assign({},c.submitCount),{description:function(){return n.i18n.s("cl-docs-description-action-button-press-count")}});t.listSources={timeSincePress:l,history:p,lastValue:f,pressCount:d};t.listSinks=i.convertSinkList({capture:{description:function(){return n.i18n.s("cl-docs-description-action-button-capture")},analyzeValueType:{type:"concrete",valueType:a.Types.number},params:[{name:"key",type:a.Types.string}]},label:{description:function(){return n.i18n.s("cl-docs-description-action-button-label")},analyzeValueType:{type:"concrete",valueType:a.Types.string}},resetLabel:{description:function(){return n.i18n.s("cl-docs-description-action-button-reset-label")},analyzeValueType:{type:"concrete",valueType:a.Types.string}},disabled:{description:function(){return n.i18n.s("cl-docs-description-action-button-disabled")},analyzeValueType:{type:"concrete",valueType:a.Types.boolean}},style:{description:function(){return n.i18n.s("cl-docs-description-action-button-style")},analyzeValueType:{type:"concrete",valueType:a.Types.buttonStyle}}}).registerSinksFrom(s.hiddenSink).registerSinksFrom(u.resetOnChangeSink)});define("core/components/challenge/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSources={};t.listSinks=n.convertSinkList({preventSubmissionReason:{description:function(){return r.i18n.s("cl-docs-description-challenge-prevent-submission-reason")},params:[],analyzeValueType:{type:"concrete",valueType:i.Types.string}},preventChallengeCreationReason:{description:function(){return r.i18n.s("cl-docs-description-challenge-prevent-challenge-creation-reason")},params:[],analyzeValueType:{type:"concrete",valueType:i.Types.string}},challengeText:{description:function(){return r.i18n.s("cl-docs-description-challenge-text")},params:[],analyzeValueType:{type:"concrete",valueType:i.Types.string}},challengeBackground:{description:function(){return r.i18n.s("cl-docs-description-challenge-background")},params:[],analyzeValueType:{type:"concrete",valueType:i.Types.layer}},challengeBounds:{description:function(){return r.i18n.s("cl-docs-description-challenge-bounds")},analyzeValueType:{type:"concrete",valueType:i.Types.bounds}},responseText:{description:function(){return r.i18n.s("cl-docs-description-challenge-response-text")},params:[],analyzeValueType:{type:"concrete",valueType:i.Types.string}},responseBackground:{description:function(){return r.i18n.s("cl-docs-description-challenge-response-background")},params:[],analyzeValueType:{type:"concrete",valueType:i.Types.layer}},responseBounds:{description:function(){return r.i18n.s("cl-docs-description-challenge-repsonse-bounds")},analyzeValueType:{type:"concrete",valueType:i.Types.bounds}}})});define("core/components/shared/correctness-sinks",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.correctnessSinks=n.convertSinkList({correct:{description:function(){return r.i18n.s("cl-docs-description-correctness-correct")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean}},warning:{description:function(){return r.i18n.s("cl-docs-description-correctness-warning")},analyzeValueType:{type:"concrete",valueType:i.Types.string}},readOnly:{description:function(){return r.i18n.s("cl-docs-description-correctness-read-only")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean}},export:{description:function(){return r.i18n.raw("Data to include in CSV export to summarize this component")},analyzeValueType:{type:"concrete",valueType:i.Types.string},internal:true,params:[{name:"heading",type:i.Types.string}]}})});define("core/components/expression-input/helpers",["require","exports","core/lib/evaluator-helpers","core/lib/simpleevaluator"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});var i=new n.SimpleEvaluator;function o(e,t){var n=a(e,t);if(!n)return NaN;var o=r.evaluateRawLatex(n,i);if(o===undefined)return NaN;return o}t.getNumericValue=o;function a(e,t){if(e&&e.hasOwnProperty("latex"))return e.latex||"";if(t&&t.value)return t.value.latex;return""}t.getLatex=a;function s(e){return i.isEvaluable(e)}t.shouldShowEvaluation=s});define("core/components/expression-input/cl-spec",["require","exports","tslib","core/lib/i18n","core/computation-layer/types","core/components/shared/button-sources","core/components/shared/correctness-sinks","core/components/shared/hidden-sink","core/computation-layer/cl-types","./helpers","core/components/shared/reset-on-change-sink"],function(e,t,r,n,i,o,a,s,u,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});var p=o.ButtonSources("input/expression");var f={description:function(){return n.i18n.s("cl-docs-description-expression-input-latex")},analyzeValueType:{type:"concrete",valueType:u.Types.latex},analyzeSinkSourceDependencies:function(e){var t=e.sinks;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i.name=="initialLatex"){i.registerDependency()}}return function e(t){var r=t.response,n=t.sinks;var i=n.initialLatex&&n.initialLatex[0];return{latex:c.getLatex(r,i)}}}};var d={description:function(){return n.i18n.s("cl-docs-description-expression-input-numeric-value")},analyzeValueType:{type:"concrete",valueType:u.Types.number},analyzeSinkSourceDependencies:function(e){var t=e.sinks;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i.name=="initialLatex"){i.registerDependency()}}return function e(t){var r=t.response,n=t.sinks;var i=n.initialLatex&&n.initialLatex[0];return c.getNumericValue(r,i)}}};var h={description:function(){return n.i18n.s("cl-docs-description-expression-input-time-since-submit")},analyzeValueType:{type:"concrete",valueType:u.Types.number},publishedBy:"playgroundController",computeFromResponse:function(e,t){var r=t.params;return e.submitted?r[0]:0},params:[{name:"maxTime",type:u.Types.number,default:10}]};var m={description:function(){return n.i18n.s("cl-docs-description-expression-input-submitted")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean},computeFromResponse:function(e){return!!e.submitted}};var y={description:function(){return n.i18n.s("cl-docs-description-expression-input-explain-content")},analyzeValueType:{type:"concrete",valueType:u.Types.string},computeFromResponse:function(e){return{type:"string",parts:e.explainText?[e.explainText]:[]}}};t.listSources=r.__assign({latex:f,numericValue:d,timeSinceSubmit:h,submitted:m,explainContent:y},p);t.listSinks=i.convertSinkList({initialLatex:{description:function(){return n.i18n.s("cl-docs-description-expression-input-initial-latex")},analyzeValueType:{type:"concrete",valueType:u.Types.latex}},disableEvaluation:{description:function(){return n.i18n.s("cl-docs-description-expression-input-disable-evaluation")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean}},errorMessage:{description:function(){return n.i18n.s("cl-docs-description-expression-input-error-message")},analyzeValueType:{type:"concrete",valueType:u.Types.string}},suffix:{description:function(){return n.i18n.s("cl-docs-description-expression-input-suffix")},analyzeValueType:{type:"concrete",valueType:u.Types.string}},capture:{description:function(){return n.i18n.s("cl-docs-description-expression-input-capture")},analyzeValueType:{type:"concrete",valueType:u.Types.number},params:[{name:"key",type:u.Types.string}]},submitLabel:{description:function(){return n.i18n.s("cl-docs-description-expression-input-submit-label")},analyzeValueType:{type:"concrete",valueType:u.Types.string}},showSubmitButton:{description:function(){return n.i18n.s("cl-docs-description-expression-input-show-submit")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean}},resetLabel:{description:function(){return n.i18n.s("cl-docs-description-expression-input-reset-label")},analyzeValueType:{type:"concrete",valueType:u.Types.string}},clearOnReset:{description:function(){return n.i18n.s("cl-docs-description-expression-input-clear-on-reset")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean}},submitDisabled:{description:function(){return n.i18n.s("cl-docs-description-expression-input-submit-disabled")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean}},initialText:{description:function(){return n.i18n.s("cl-docs-description-expression-input-initial-text")},analyzeValueType:{type:"concrete",valueType:u.Types.string}},explainPrompt:{description:function(){return n.i18n.s("cl-docs-description-expression-input-explain-prompt")},analyzeValueType:{type:"concrete",valueType:u.Types.string}},showPeerResponses:{description:function(){return n.i18n.s("cl-docs-description-expression-input-show-classmates")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean}},showExplain:{description:function(){return n.i18n.s("cl-docs-description-expression-input-show-explain")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean}}}).registerSinksFrom(a.correctnessSinks).registerSinksFrom(s.hiddenSink).registerSinksFrom(l.resetOnChangeSink)});define("core/components/shared/generate-graph-sinks",["require","exports","core/lib/i18n","core/computation-layer/types","core/lib/calculator-helpers","core/computation-layer/cl-types","./correctness-sinks","./hidden-sink"],function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});var u=function(){return r.i18n.s("cl-docs-warning-graph-raw-expression-deprecation")};var c=function(){return r.i18n.s("cl-docs-warning-graph-bounds-deprecation")};function l(e){var t={number:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-number-sink"):r.i18n.s("cl-docs-description-sketch-number-sink")},params:[{name:"identifier",type:o.Types.latex,validate:i.validLatexIdentifierRequired}],analyzeValueType:{type:"concrete",valueType:o.Types.number}},numberList:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-number-list-sink"):r.i18n.s("cl-docs-description-sketch-number-list-sink")},params:[{name:"identifier",type:o.Types.latex,validate:i.validLatexIdentifierRequired}],analyzeValueType:{type:"concrete",valueType:o.Types.numberList}},pointLabel:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-raw-expression-point-label"):r.i18n.s("cl-docs-description-sketch-raw-expression-point-label")},params:[{name:"identifier",type:o.Types.string,validate:i.validStrippedIdentifierRequired}],analyzeValueType:{type:"concrete",valueType:o.Types.string}},xAxisLabel:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-x-axis-label"):r.i18n.s("cl-docs-description-sketch-x-axis-label")},analyzeValueType:{type:"concrete",valueType:o.Types.string}},yAxisLabel:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-y-axis-label"):r.i18n.s("cl-docs-description-sketch-y-axis-label")},analyzeValueType:{type:"concrete",valueType:o.Types.string}},audioTraceReverseExpressions:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-audiotrace-reverse"):r.i18n.s("cl-docs-description-sketch-audiotrace-reverse")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean}},trace:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-trace"):r.i18n.s("cl-docs-description-sketch-trace")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean}},narration:{description:function(){return r.i18n.s("cl-docs-description-graph-narration")},params:[{name:"narrationIndex",type:o.Types.number,default:1}],analyzeValueType:{type:"concrete",valueType:o.Types.string}},bounds:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-bounds-sink"):r.i18n.s("cl-docs-description-sketch-bounds-sink")},analyzeValueType:{type:"concrete",valueType:o.Types.bounds}},background:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-background"):r.i18n.s("cl-docs-description-sketch-background")},analyzeValueType:{type:"concrete",valueType:o.Types.layer}}};return n.convertSinkList(t)}var p={rawExpression:{description:function(){return r.i18n.s("cl-docs-description-graph-raw-expression")},params:[{name:"identifier",type:o.Types.string,default:{type:"string",parts:["undefined"]},validate:i.validStringIdentifierPreferred}],analyzeValueType:{type:"concrete",valueType:o.Types.string},deprecated:u},rawExpressionColor:{description:function(){return r.i18n.s("cl-docs-description-graph-raw-expression-color")},params:[{name:"identifier",type:o.Types.string,validate:i.validStringIdentifierPreferred}],analyzeValueType:{type:"concrete",valueType:o.Types.string},deprecated:u},rawExpressionHidden:{description:function(){return r.i18n.s("cl-docs-description-graph-raw-expression-hidden")},params:[{name:"identifier",type:o.Types.string,validate:i.validStringIdentifierPreferred}],analyzeValueType:{type:"concrete",valueType:o.Types.boolean},deprecated:u},rawExpressionStyle:{description:function(){return r.i18n.s("cl-docs-description-graph-raw-expression-style")},params:[{name:"identifier",type:o.Types.string,validate:i.validStringIdentifierPreferred}],analyzeValueType:{type:"concrete",valueType:o.Types.string},deprecated:u}};p["xmin"]={description:function(){return r.i18n.s("cl-docs-description-graph-xmin")},analyzeValueType:{type:"concrete",valueType:o.Types.number},deprecated:c};p["xmax"]={description:function(){return r.i18n.s("cl-docs-description-graph-xmax")},analyzeValueType:{type:"concrete",valueType:o.Types.number},deprecated:c};p["ymin"]={description:function(){return r.i18n.s("cl-docs-description-graph-ymin")},analyzeValueType:{type:"concrete",valueType:o.Types.number},deprecated:c};p["ymax"]={description:function(){return r.i18n.s("cl-docs-description-graph-ymax")},analyzeValueType:{type:"concrete",valueType:o.Types.number},deprecated:c};var f={matches:function(e){return e.type=="function"},toString:function(){return"function"}};var d=new n.NewSinkSpec("function",{type:"concrete",validator:f},[{name:"identifier",type:o.Types.latex,validate:i.validLatexIdentifierRequired}],function(){return r.i18n.s("cl-docs-warning-graph-function")});function h(e){return n.convertSinkList(p).registerSinksFrom(l(e)).registerSinksFrom(a.correctnessSinks).registerSinksFrom(s.hiddenSink).registerSinkSpec(d)}t.getGraphSinks=h});define("core/components/shared/cl-graph-helpers",["require","exports","underscore","core/lib/calculator-helpers","core/computation-layer/helpers","core/computation-layer/library/bounds","core/lib/log","core/computation-layer/cl-types","core/computation-layer/library/math","core/lib/assert-unreachable"],function(e,t,r,n,i,o,a,s,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.subscribeSourcesAndSinks=function(e,t){var r=t();var n=r.sources;if(n.number!=undefined)n.number.forEach(function(t){var r=t.params[0];var n=e.HelperExpression(r);if(t.getValue()===undefined){t.setValue(n.numericValue)}n.observe("numericValue",function(){t.setValue(n.numericValue)})});if(n.numberList!=undefined)n.numberList.forEach(function(t){var r=t.params[0];var n=e.HelperExpression(r);if(t.getValue()===undefined){t.setValue(n.listValue)}n.observe("listValue",function(){t.setValue(n.listValue)})})};t.updateSinks=function(e,t,r){p(e,t,r);f(e,t,r);if("_calc"in e&&"grapher"in e._calc&&e._calc.grapher!=undefined){d(t,e,r)}};var l=function(e,t){return e+JSON.stringify(t.params)};function p(e,t,i){for(var o=0,a=["number","numberList","function"];o<a.length;o++){var p=a[o];for(var f=0,d=t[p]||[];f<d.length;f++){var h=d[f];var m=h.value;var y=l(p,h);if(i.hasOwnProperty(y)&&r.isEqual(m,i[y])){continue}i[y]=m;var g=h.params[0].latex;var v=void 0;switch(p){case"number":v=g+"=1*"+n.numberAsLatex(+m);break;case"numberList":v=m==undefined||m.length==0?"":g+"=["+m.map(n.numberAsLatex).join(",")+"]";break;case"function":if(!(h.valueType instanceof s.FunctionType))throw new Error("Unexpected type "+h.valueType+" provided to function sink");var b=u.generateFunctionProxyVariables(h.valueType.params.numVars);v=g+"("+b.join(", ")+")="+(m||"0/0");break;default:return c.assertUnreachable(p)}e.setExpression({type:"expression",id:"sink-"+g,latex:v,hidden:true,secret:true})}}}function f(e,t,n){var o,a;var s=function(s){var u=s;var c=u.params[0];var p=u.value?i.synthesizeStringInternal(u.value):"";var f=l("rawExpression",u);var d=r.find(t.rawExpressionColor||[],function(e){return e.params[0]==c});var h=((o=d)===null||o===void 0?void 0:o.value)?i.synthesizeStringInternal(d.value):"#000";var m=r.find(t.rawExpressionHidden||[],function(e){return e.params[0]==c});var y=m?m.value:false;var g=r.find(t.rawExpressionStyle||[],function(e){return e.params[0]==c});var v=(((a=g)===null||a===void 0?void 0:a.value)?i.synthesizeStringInternal(g.value):"SOLID").toUpperCase();var b=false;if(p!=n[f]){n[f]=p;b=true}if(d){var x=l("rawExpressionColor",d);if(h!=n[x]){n[x]=h;b=true}}if(m){var _=l("rawExpressionHidden",m);if(y!=n[_]){n[_]=y;b=true}}if(g){var S=l("rawExpressionStyle",g);if(v!=n[S]){n[S]=v;b=true}}if(!b){return"continue"}e.setExpression({id:"sink-"+u.params[0],latex:p,secret:true,hidden:y,color:h,style:v})};for(var u=0,c=t.rawExpression||[];u<c.length;u++){var p=c[u];s(p)}}function d(e,t,s){var u;for(var p=0,f=e.pointLabel||[];p<f.length;p++){var d=f[p];var h=d.value?i.synthesizeStringForContent(d.value):"";var m=l("pointLabel",d);if(h==s[m]){continue}s[m]=h;if(u==undefined){u=t.getState()}var y=n.getIdFromIdentifier(u,d.params[0]);if(y==undefined){a.log("CL warning: There is no item with identifier "+d.params[0]+" in the graph state.");continue}t.setExpression({id:y,label:h,showLabel:h.length>0})}for(var g=0,v=e.xAxisLabel||[];g<v.length;g++){var d=v[g];var h=d.value?i.synthesizeStringForContent(d.value):undefined;var m=l("xAxisLabel",d);if(h==s[m]){continue}s[m]=h;t.updateSettings({xAxisLabel:h})}for(var b=0,x=e.yAxisLabel||[];b<x.length;b++){var d=x[b];var h=d.value?i.synthesizeStringForContent(d.value):undefined;var m=l("yAxisLabel",d);if(h==s[m]){continue}s[m]=h;t.updateSettings({yAxisLabel:h})}var _=e["bounds"];if(_&&_[0]){var S=_[0].value;if(S){var T={width:t.graphpaperBounds.pixelCoordinates.width,height:t.graphpaperBounds.pixelCoordinates.height};var m=l("bounds",_[0]);if(T.width<=0)T.width=1;if(T.height<=0)T.height=1;var w=o.applyStrategy(S,S.strategy,T);if(!r.isEqual({bounds:S,size:T},s[m])){s[m]={bounds:S,size:T};t.setMathBounds({left:w.left,bottom:w.bottom,right:w.left+w.width,top:w.bottom+w.height});t._calc.grapher.settings.setProperty("squareAxes",S.strategy!="stretch")}}}else{var E=["xmin","xmax","ymin","ymax"];var S={};var M=false;for(var C=0,I=E;C<I.length;C++){var P=I[C];for(var k=0,O=e[P]||[];k<O.length;k++){var d=O[k];var h=d.value;var m=l(P,d);switch(P){case"xmin":S.left=h;break;case"xmax":S.right=h;break;case"ymin":S.bottom=h;break;case"ymax":S.top=h;break;default:c.assertUnreachable(P)}if(h==s[m]){continue}M=true;s[m]=h}}if(M){t.setMathBounds({left:S.left,right:S.right,bottom:S.bottom,top:S.top})}}for(var D=0,N=e.audioTraceReverseExpressions||[];D<N.length;D++){var d=N[D];var h=d.value;var m=l("audioTraceReverseExpressions",d);if(h==s[m]){continue}s[m]=h;t.updateSettings({audioTraceReverseExpressions:h})}for(var A=0,L=e.trace||[];A<L.length;A++){var d=L[A];var h=d.value;var m=l("trace",d);if(h==s[m]){continue}s[m]=h;t.updateSettings({trace:h})}}t.listDefinitions=function(e){var t=function(t){return(e[t]||[]).map(function(e){var t;return(t=e.params[0])===null||t===void 0?void 0:t.latex})};var n=function(t){return(e[t]||[]).map(function(e){return e.params[0]})};return r.flatten([t("number"),t("numberList"),t("function"),n("rawExpression")]).filter(function(e){return e!=undefined})};function h(e,r){if(!e){return e}return n.calcStateWithoutDefinitions(e,t.listDefinitions(r))}t.omitDefinitions=h;t.hasSources=function(e){return(e.number||[]).length+(e.numberList||[]).length>0}});define("core/components/shared/generate-graph-sources",["require","exports","core/lib/simpleevaluator","core/computation-layer/cl-types","core/lib/i18n","core/lib/calculator-helpers","core/lib/mathtools","core/random-seed","underscore","core/lib/copydata","core/lib/evaluator-helpers","./cl-graph-helpers"],function(e,t,r,n,i,o,a,s,u,c,l,p){"use strict";Object.defineProperty(t,"__esModule",{value:true});var f=new r.SimpleEvaluator;function d(e){return{description:function(){return e==="input/graph"?i.i18n.s("cl-docs-description-graph-number-source"):i.i18n.s("cl-docs-description-sketch-number-source")},params:[{name:"latex",type:n.Types.latex,validate:o.validLatexRequired}],analyzeValueType:{type:"concrete",valueType:n.Types.number},publishedBy:"playgroundController",analyzeSinkSourceDependencies:function(t){var r=t.sinks,n=t.config,i=t.params,o=t.warn;if(e==="input/graph"&&!n.exhibitMode){o("This data comes from a full-screen graph - dependencies may not be computed correctly.")}for(var u=0,c=r;u<c.length;u++){var l=c[u];if(l.name=="rawExpression")o("This data comes from a graph that uses rawExpression - dependencies may not be computed correctly.")}var p=x(r);var f=i[0];var d=a.parser.parse(f.latex);var h=_(f.latex,p,n.calculatorState,n.alias),m=h.expressionRequired,y=h.warnings;for(var g=0,v=y;g<v.length;g++){var b=v[g];o(b)}return function(t){var r=t.response,i=t.randomSeed,o=t.sinks;var u=e==="input/graph"?r.calculatorState:undefined;var c=u||s.populateRandomSeed(n.calculatorState,i);if(c==undefined)return NaN;var l=S({calculatorState:c,sinks:o,expressionRequired:m});var p=d.tryGetConcreteTree(a.policies.graphing,l);var f=p.asValue();return typeof f==="number"?f:NaN}}}}function h(e){return{description:function(){return e==="input/graph"?i.i18n.s("cl-docs-description-graph-number-list-source"):i.i18n.s("cl-docs-description-sketch-number-list-source")},params:[{name:"latex",type:n.Types.latex,validate:o.validLatexIdentifierPreferred}],analyzeValueType:{type:"concrete",valueType:n.Types.numberList},publishedBy:"playgroundController",analyzeSinkSourceDependencies:function(t){var r=t.sinks,n=t.config,i=t.params,o=t.warn;if(e==="input/graph"&&!n.exhibitMode){o("This data comes from a full-screen graph - dependencies may not be computed correctly.")}for(var u=0,c=r;u<c.length;u++){var l=c[u];if(l.name=="rawExpression")o("This data comes from a graph that uses rawExpression - dependencies may not be computed correctly.")}var p=x(r);var f=i[0];var d=a.parser.parse(f.latex);var h=_(f.latex,p,n.calculatorState,n.alias),m=h.expressionRequired,y=h.warnings;for(var g=0,v=y;g<v.length;g++){var b=v[g];o(b)}return function(t){var r=t.response,i=t.sinks,o=t.randomSeed;var u=e==="input/graph"?r.calculatorState:undefined;var c=u||s.populateRandomSeed(n.calculatorState,o);if(c==undefined)return[];var l=S({calculatorState:c,sinks:i,expressionRequired:m});var p=d.tryGetConcreteTree(a.policies.graphing,l);if(!p.isList)return[];var f=p.getEvaluationInfo();if(f&&f[0]&&f[0].val)return f[0].val;return[]}}}}function m(e){return{internal:true,description:function(){return i.i18n.raw("Only for internal use")},analyzeValueType:{type:"concrete",valueType:n.Types.calculatorStateWithSinkValues},analyzeSinkSourceDependencies:function(t){var r=t.sinks,n=t.config;for(var i=0,o=r;i<o.length;i++){var a=o[i];a.registerDependency()}return function(t){var r=t.response,i=t.randomSeed,o=t.sinks;var a=e==="input/graph"?r.calculatorState:undefined;var u=a||s.populateRandomSeed(n.calculatorState,i);return{calculatorState:u,sinks:o}}}}}function y(e){return{description:function(){return e==="input/graph"?i.i18n.s("cl-docs-description-graph-bounds-source"):i.i18n.s("cl-docs-description-sketch-bounds-source")},analyzeValueType:{type:"concrete",valueType:n.Types.bounds},analyzeSinkSourceDependencies:function(t){var r=t.sinks,n=t.config,i=t.warn;for(var a=0,s=r;a<s.length;a++){var l=s[a];if(["xmin","xmax","ymin","ymax"].indexOf(l.name)>-1){i(l.name+" is deprecated, and cannot be used together with the bounds source.\n            Use the bounds sink instead.")}if(l.name=="bounds"){l.registerDependency()}}return function t(r){var i=r.response,a=r.sinks;var s=undefined;if(a.bounds){s=a.bounds[0].value}if(s!=undefined&&u.isFinite(s.left)&&u.isFinite(s.bottom)&&u.isFinite(s.width)&&u.isFinite(s.height)&&s.width>0&&s.height>0){return s}var l;var p;var f=e==="input/graph"?i.calculatorState:undefined;var d=f||n.calculatorState;if(d){l=c.copydata(o.extractViewport(d));if(o.areAxesSquare(d)){p="centeredVertical"}else{p="stretch"}}else{var h=e==="input/graph"?10:1;l={xmin:-1*h,xmax:h,ymin:-1*h,ymax:h};p="centeredVertical"}return{left:l.xmin,width:l.xmax-l.xmin,bottom:l.ymin,height:l.ymax-l.ymin,strategy:p}}}}}function g(e){return{description:function(){return e==="input/graph"?i.i18n.s("cl-docs-description-graph-label-text"):i.i18n.s("cl-docs-description-sketch-label-text")},analyzeValueType:{type:"concrete",valueType:n.Types.string},params:[{name:"identifier",type:n.Types.string,validate:o.validStrippedIdentifierRequired}],computeFromResponse:function(t,r){var n=r.config,i=r.params,a=r.randomSeed;var u=e==="input/graph"?t.calculatorState:undefined;var c=u||s.populateRandomSeed(n.calculatorState,a);if(c==undefined)return undefined;var l=o.getLabelValueFromIdentifier(c,i[0]);return l!=undefined?{type:"string",parts:[l]}:undefined}}}function v(e){return{description:function(){return e==="input/graph"?i.i18n.s("cl-docs-description-graph-label-latex"):i.i18n.s("cl-docs-description-sketch-label-latex")},analyzeValueType:{type:"concrete",valueType:n.Types.latex},params:[{name:"identifier",type:n.Types.string,validate:o.validStrippedIdentifierRequired}],computeFromResponse:function(t,r){var n=r.config,i=r.params,a=r.randomSeed;var u=e==="input/graph"?t.calculatorState:undefined;var c=u||s.populateRandomSeed(n.calculatorState,a);if(c==undefined)return undefined;var l=o.getLabelValueFromIdentifier(c,i[0]);if(l==undefined)return undefined;var p=l.match(/^`([^`]+)`$/);return p?{latex:p[1]}:undefined}}}function b(e){return{description:function(){return e==="input/graph"?i.i18n.s("cl-docs-description-graph-label-numeric-value"):i.i18n.s("cl-docs-description-sketch-label-numeric-value")},analyzeValueType:{type:"concrete",valueType:n.Types.number},params:[{name:"identifier",type:n.Types.string,validate:o.validStrippedIdentifierRequired}],computeFromResponse:function(t,r){var n=r.config,i=r.params,a=r.randomSeed;var u=e==="input/graph"?t.calculatorState:undefined;var c=u||s.populateRandomSeed(n.calculatorState,a);if(c==undefined)return NaN;var p=o.getLabelValueFromIdentifier(c,i[0]);if(p==undefined)return NaN;var d=p.match(/^`([^`]+)`$/);var h=d?l.evaluateRawLatex(d[1],f):l.evaluateRawLatex(p,f);if(h==undefined)return NaN;return h}}}function x(e){var t={};for(var r=0,n=e;r<n.length;r++){var i=n[r];if(["number","numberList","function"].indexOf(i.name)>-1){var o=i.params[0].latex;o=o.replace(/[{}]/g,"");t[o]=i}if(i.name=="rawExpression"){var o=i.params[0];o=o.replace(/[{}]/g,"");t[o]=i}}return t}function _(e,t,r,n){var i=a.builtInFrame;var s=a.parser.parse(e);var u=s.getDependencies();var c={};var l={};var p=o.getExportAndDependencyMapFromState(r);var f={};var d=[];var h;while(h=u.pop()){if(h=="globalRandomSeed"){continue}h=h.replace(/[{}]/g,"");if(c[h])continue;if(i[h])continue;var m=t[h];if(m){m.registerDependency();continue}var y=p.exportMap[h]||p.weakExportMap[h];if(y){if(!f[y]){f[y]=true;for(var g=0,v=p.dependencyMap[y]||[];g<v.length;g++){var b=v[g];u.push(b);l[b]="needed by "+h}}continue}var x=l[h];if(x){d.push("can't find variable "+h+" ("+x+") in graph "+n)}else{d.push("can't find variable "+h+" in graph "+n)}}return{expressionRequired:f,warnings:d}}function S(e){var t=e.calculatorState,r=e.sinks,n=e.expressionRequired;t=o.filterListToIds(t,n);var i=a.CLCalculator(t);p.updateSinks(i,r,{});var s=new a.context;var u=i.getChangeSet();s.setDegreeMode(u.degreeMode);if(u.hasOwnProperty("globalRandomSeed")){s.setGlobalRandomSeed(u.globalRandomSeed)}for(var c in u.statements){s.addStatement(u.statements[c])}s.updateAnalysis();return s.frame}function T(e){return{number:d(e),numberList:h(e),calculatorState:m(e),bounds:y(e),labelText:g(e),labelLatex:v(e),labelNumericValue:b(e)}}t.getGraphSources=T});define("core/components/graph-input/cl-spec",["require","exports","tslib","core/computation-layer/types","../shared/generate-graph-sinks","../shared/generate-graph-sources","core/lib/i18n","core/computation-layer/cl-types"],function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSources=r.__assign(r.__assign({},o.getGraphSources("input/graph")),{animationTime:{description:function(){return a.i18n.s("cl-docs-description-graph-animation-time")},analyzeValueType:{type:"concrete",valueType:s.Types.number},publishedBy:"playgroundController",analyzeSinkSourceDependencies:function(e){var t=e.sinks;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i.name=="animationDuration"){i.registerDependency()}}return function(){return 0}}}});t.listSinks=n.convertSinkList({animationDuration:{analyzeValueType:{type:"concrete",valueType:s.Types.number},description:function(){return a.i18n.s("cl-docs-description-graph-animation-duration")}},animationKeyboardStepValue:{analyzeValueType:{type:"concrete",valueType:s.Types.number},description:function(){return a.i18n.s("cl-docs-description-graph-animation-keyboard-step")}}}).registerSinksFrom(i.getGraphSinks("input/graph"))});define("core/components/marbleslides/cl-spec",["require","exports","core/computation-layer/types","core/computation-layer/cl-types","core/random-seed","core/lib/i18n"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a={internal:true,description:function(){return o.i18n.raw("Only for internal use")},analyzeValueType:{type:"concrete",valueType:n.Types.calculatorStateWithSinkValues},analyzeSinkSourceDependencies:function(e){var t=e.config;return function(e){var r=e.randomSeed,n=e.response;var o=n.calculatorState||i.populateRandomSeed(t.calculatorState,r);return{calculatorState:o,sinks:{}}}}};t.listSources={calculatorState:a};t.listSinks=r.convertSinkList({})});define("core/components/multiple-choice/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/components/shared/correctness-sinks","core/components/shared/hidden-sink","core/computation-layer/cl-types","underscore"],function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});var u={description:function(){return r.i18n.s("cl-docs-description-mc-is-selected")},params:[{name:"choiceIndex",type:a.Types.number}],analyzeValueType:{type:"concrete",valueType:a.Types.boolean},computeFromResponse:function(e,t){var r=t.config,n=t.params;var i=n[0];var o;if(typeof i=="number"){o=i-1}else if(typeof i=="string"){o=parseInt(i)-1}else{return false}var a=r.choiceIds[o];if(a==null)return false;if(e==null||e.selection==null||e.selection.choiceIds==null)return false;return!!e.selection.choiceIds[a]}};var c={description:function(){return r.i18n.s("cl-docs-description-mc-time-since-submit")},analyzeValueType:{type:"concrete",valueType:a.Types.number},publishedBy:"playgroundController",computeFromResponse:function(e,t){var r=t.params;return e.mcSubmitted?r[0]:0},params:[{name:"maxTime",type:a.Types.number,default:10}]};var l={description:function(){return r.i18n.s("cl-docs-description-mc-choice-content-source")},analyzeValueType:{type:"concrete",valueType:a.Types.string},params:[{name:"index",type:a.Types.number}],analyzeSinkSourceDependencies:function(e){var t=e.params,r=e.sinks,n=e.config;var i=t[0];for(var o=0,a=r;o<a.length;o++){var u=a[o];if(s.contains(["choiceContent"],u.name)&&s.isEqual(u.params,t)){u.registerDependency()}}return function e(t){var r=t.sinks;if(i>n.choiceIds.length)return undefined;if(r.choiceContent){for(var o=0,a=r.choiceContent;o<a.length;o++){var s=a[o];if(s.params[0]===i){return s.value}}}var u=n.choiceIds[i-1];if(!u)return undefined;var c=n.choices[u];if(!c)return undefined;return{type:"string",parts:[c.text||""]}}}};var p={description:function(){return r.i18n.s("cl-docs-description-mc-submitted")},analyzeValueType:{type:"concrete",valueType:a.Types.boolean},publishedBy:"playgroundController",computeFromResponse:function(e){return!!e.mcSubmitted}};var f={description:function(){return r.i18n.s("cl-docs-description-mc-explain-content")},analyzeValueType:{type:"concrete",valueType:a.Types.string},computeFromResponse:function(e){return{type:"string",parts:e.explainText?[e.explainText]:[]}}};var d={description:function(){return r.i18n.s("cl-docs-description-mc-submit-count")},analyzeValueType:{type:"concrete",valueType:a.Types.number},publishedBy:"playgroundController",computeFromResponse:function(e){if(e.mcSubmitCount==null)return 0;return e.mcSubmitCount}};t.listSources={isSelected:u,timeSinceSubmit:c,submitted:p,explainContent:f,submitCount:d,choiceContent:l};t.listSinks=n.convertSinkList({choiceContent:{description:function(){return r.i18n.s("cl-docs-description-mc-choice-content")},analyzeValueType:{type:"concrete",valueType:a.Types.string},params:[{name:"choiceIndex",type:a.Types.number}]},initialText:{description:function(){return r.i18n.s("cl-docs-description-mc-initial-text")},analyzeValueType:{type:"concrete",valueType:a.Types.string}},prompt:{description:function(){return r.i18n.s("cl-docs-description-mc-prompt")},analyzeValueType:{type:"concrete",valueType:a.Types.string}},multiSelectHeading:{description:function(){return r.i18n.s("cl-docs-description-mc-multi-select-heading")},analyzeValueType:{type:"concrete",valueType:a.Types.string},deprecated:function(){return r.i18n.s("cl-docs-message-mc-multi-select-heading-deprecation")}},explainPrompt:{description:function(){return r.i18n.s("cl-docs-description-mc-explain-prompt")},analyzeValueType:{type:"concrete",valueType:a.Types.string}},WOTS:{description:function(){return r.i18n.s("cl-docs-description-mc-wots")},analyzeValueType:{type:"concrete",valueType:a.Types.boolean},internal:true},submitLabel:{description:function(){return r.i18n.s("cl-docs-description-mc-submit-label")},analyzeValueType:{type:"concrete",valueType:a.Types.string}}}).registerSinksFrom(i.correctnessSinks).registerSinksFrom(o.hiddenSink)});define("core/components/penny-dragging-widget/cl-spec",["require","exports","core/computation-layer/types","core/computation-layer/cl-types","core/lib/i18n"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});var o={description:function(){return i.i18n.s("cl-docs-description-penny-widget-count")},analyzeValueType:{type:"concrete",valueType:n.Types.number},computeFromResponse:function(e){if(e.circleData==null)return 0;if(e.circleData.pennies==null)return 0;return e.circleData.pennies.length}};var a={description:function(){return i.i18n.s("cl-docs-description-penny-widget-size")},analyzeValueType:{type:"concrete",valueType:n.Types.number},computeFromResponse:function(e){if(e==null)return NaN;if(e.circleData==null)return NaN;return e.circleData.size}};t.listSources={count:o,size:a};t.listSinks=r.convertSinkList({})});define("core/components/reorder/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/components/shared/correctness-sinks","core/components/shared/hidden-sink","core/computation-layer/cl-types","underscore","core/components/reorder/helpers"],function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});var c={description:function(){return r.i18n.s("cl-docs-description-ordered-list-matches-key")},analyzeValueType:{type:"concrete",valueType:a.Types.boolean},computeFromResponse:function(e,t){var r=t.config;if(!r.hasAnswerKey)return false;return s.isEqual(r.itemIds,e.order)}};var l={description:function(){return r.i18n.s("cl-docs-description-ordered-list-order")},analyzeValueType:{type:"concrete",valueType:a.Types.numberList},analyzeSinkSourceDependencies:function(e){var t=e.sinks,r=e.config;for(var n=0,i=t;n<i.length;n++){var o=i[n];if(o.name=="initialOrder"){o.registerDependency()}}return function e(t){var n=t.response,i=t.sinks;var o=i.initialOrder&&i.initialOrder[0];var a=[];var s=u.getResponseOrder(r,n,o);for(var c=0;c<r.itemIds.length;c++){a[c]=s.indexOf(r.itemIds[c])+1}return a}}};var p={description:function(){return r.i18n.s("cl-docs-description-ordered-list-item-at-index")},analyzeValueType:{type:"concrete",valueType:a.Types.number},params:[{name:"itemIndex",type:a.Types.number}],analyzeSinkSourceDependencies:function(e){var t=e.sinks,r=e.config,n=e.params;for(var i=0,o=t;i<o.length;i++){var a=o[i];if(a.name=="initialOrder"){a.registerDependency()}}return function e(t){var i=t.response,o=t.sinks;var a=o.initialOrder&&o.initialOrder[0];var s=n[0];var c=u.getResponseOrder(r,i,a);var l=c[s-1];var p=r.itemIds.indexOf(l);if(p>=0)return p+1;return undefined}}};var f={description:function(){return r.i18n.s("cl-docs-description-ordered-list-text-at-index")},analyzeValueType:{type:"concrete",valueType:a.Types.string},params:[{name:"itemIndex",type:a.Types.number}],analyzeSinkSourceDependencies:function(e){var t=e.sinks,r=e.config,n=e.params;for(var i=0,o=t;i<o.length;i++){var a=o[i];if(a.name=="itemContent"){a.registerDependency()}}return function e(t){var i=t.response,o=t.sinks;var a=o.initialOrder&&o.initialOrder[0];var s=n[0];var c=u.getResponseOrder(r,i,a);var l=c[s-1];var p=r.itemIds.indexOf(l)+1;if(o.itemContent){for(var f=0,d=o.itemContent;f<d.length;f++){var h=d[f];if(h.params[0]===p){return h.value}}}if(r.items[l])return{type:"string",parts:[r.items[l].text]};return undefined}}};var d={description:function(){return r.i18n.s("cl-docs-description-ordered-list-index-of-item")},analyzeValueType:{type:"concrete",valueType:a.Types.number},params:[{name:"initialItemIndex",type:a.Types.number}],analyzeSinkSourceDependencies:function(e){var t=e.sinks,r=e.config,n=e.params;for(var i=0,o=t;i<o.length;i++){var a=o[i];if(a.name=="initialOrder"){a.registerDependency()}}return function e(t){var i=t.response,o=t.sinks;var a=o.initialOrder&&o.initialOrder[0];var s=n[0];var c=r.itemIds[s-1];if(!c)return undefined;var l=u.getResponseOrder(r,i,a);var p=l.indexOf(c);if(p>=0)return p+1;return undefined}}};t.listSources={matchesKey:c,order:l,itemAtIndex:p,textAtIndex:f,indexOfItem:d};t.listSinks=n.convertSinkList({initialOrder:{description:function(){return r.i18n.s("cl-docs-description-ordered-list-initial-order")},analyzeValueType:{type:"concrete",valueType:a.Types.numberList}},itemContent:{description:function(){return r.i18n.s("cl-docs-description-ordered-list-item-content")},analyzeValueType:{type:"concrete",valueType:a.Types.string},params:[{name:"itemIndex",type:a.Types.number}]}}).registerSinksFrom(i.correctnessSinks).registerSinksFrom(o.hiddenSink)});define("core/components/sketch/cl-spec",["require","exports","tslib","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types","core/components/shared/reset-on-change-sink","../shared/generate-graph-sinks","../shared/generate-graph-sources"],function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});var c={points:[],strokes:[],bounds:{left:0,right:1,bottom:0,top:1}};var l={description:function(){return n.i18n.s("cl-docs-description-sketch-object")},params:[],analyzeValueType:{type:"concrete",valueType:o.Types.sketch},computeFromResponse:function(e){if(e.sketchData!=null){return e.sketchData}return c}};var p={description:function(){return n.i18n.s("cl-docs-description-sketch-current-stroke")},params:[],analyzeValueType:{type:"concrete",valueType:o.Types.sketch},publishedBy:"playgroundController",computeFromResponse:function(){return undefined}};var f={description:function(){return n.i18n.s("cl-docs-description-sketch-current-x")},params:[],analyzeValueType:{type:"concrete",valueType:o.Types.number},publishedBy:"playgroundController",computeFromResponse:function(){return undefined}};var d={description:function(){return n.i18n.s("cl-docs-description-sketch-current-y")},params:[],analyzeValueType:{type:"concrete",valueType:o.Types.number},publishedBy:"playgroundController",computeFromResponse:function(){return undefined}};t.listSources=r.__assign(r.__assign({},u.getGraphSources("sketch")),{sketch:l,currentStroke:p,currentX:f,currentY:d});t.listSinks=i.convertSinkList({previewCurrentStroke:{description:function(){return n.i18n.s("cl-docs-description-sketch-preview-current-stroke")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean}},allowEraser:{description:function(){return n.i18n.s("cl-docs-description-sketch-allow-eraser")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean}},disableSketch:{description:function(){return n.i18n.s("cl-docs-description-sketch-disable-sketch")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean}},hideSketch:{description:function(){return n.i18n.s("cl-docs-description-sketch-hide-sketch")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean}},initialTool:{description:function(){return n.i18n.s("cl-docs-description-sketch-initial-tool")},analyzeValueType:{type:"concrete",valueType:o.Types.sketchTool}},initialColor:{description:function(){return n.i18n.s("cl-docs-description-sketch-initial-color")},analyzeValueType:{type:"concrete",valueType:o.Types.color}},availableColors:{description:function(){return n.i18n.s("cl-docs-description-sketch-available-colors")},analyzeValueType:{type:"concrete",valueType:o.Types.colorList}}}).registerSinksFrom(s.getGraphSinks("sketch")).registerSinksFrom(a.resetOnChangeSink)});define("core/components/table/cl-spec",["require","exports","tslib","core/lib/i18n","core/computation-layer/types","core/components/shared/button-sources","core/components/table/helpers","core/lib/evaluator-helpers","core/lib/simpleevaluator","core/components/shared/correctness-sinks","core/components/shared/hidden-sink","underscore","core/computation-layer/cl-types"],function(e,t,r,n,i,o,a,s,u,c,l,p,f){"use strict";Object.defineProperty(t,"__esModule",{value:true});var d=o.ButtonSources("table");var h;var m={description:function(){return n.i18n.s("cl-docs-description-table-cell-content-source")},params:[{name:"rowIndex",type:f.Types.number},{name:"columnIndex",type:f.Types.number}],analyzeValueType:{type:"dynamic",possibleValueTypes:[f.Types.string,f.Types.latex],analyze:function(e,t){var r=e,n=r[0],i=r[1];var o=a.getTableCellType(n,i,t);return o==a.columnTypes.MATH?{valueType:f.Types.latex}:{valueType:f.Types.string}}},analyzeSinkSourceDependencies:function(e){var t=e.params,n=e.sinks,i=e.config,o=e.valueType;var s=t,u=s[0],c=s[1];var l=false;for(var d=0,h=n;d<h.length;d++){var m=h[d];if(p.contains(["cellContent","initialCellContent"],m.name)&&p.isEqual(m.params,t)){if(m.name==="cellContent")l=true;m.registerDependency()}if(m.name=="maxRows"){m.registerDependency()}}for(var y=0,g=n;y<g.length;y++){var m=g[y];if(m.name==="cellEditable"&&p.isEqual(m.params,t)&&l){m.registerDependency()}}return function e(t){var n=t.response,s=t.sinks;var l=r.__assign(r.__assign({},i),n);var d=s.maxRows&&s.maxRows[0];var h=d&&d.value?d.value:Infinity;if(u>h){return undefined}var m=a.getCellIdFromCoordinates(l,u,c);if(!m){return undefined}var y=a.getStudentCellContent({cellContentSink:p.first(s.cellContent),initialCellContentSink:p.first(s.initialCellContent),cellEditableSink:p.first(s.cellEditable),cellErrorMessageSink:undefined,cellDisableEvaluationSink:undefined,cellSuffixSink:undefined,configurationData:i.cells[m],studentData:n.cells?n.cells[m]:undefined,columnType:a.getColumnType(i,c),fullyEditable:i.fullyEditable,isHeader:u===0});var g=y.content;if(f.Types.latex.matches(o)){return{latex:g}}else if(f.Types.string.matches(o)){return{type:"string",parts:[g]}}else{throw new Error("Internal CL Error. Expected cellContent source to be of type latex or string but found "+o.type)}}}};var y={description:function(){return n.i18n.s("cl-docs-description-table-cell-numeric-value")},params:[{name:"rowIndex",type:f.Types.number},{name:"columnIndex",type:f.Types.number}],analyzeValueType:{type:"concrete",valueType:f.Types.number},analyzeSinkSourceDependencies:function(e){var t=e.params,n=e.sinks,i=e.config;var o=t,c=o[0],l=o[1];for(var f=0,d=n;f<d.length;f++){var m=d[f];if(p.contains(["cellContent","initialCellContent","cellEditable"],m.name)&&p.isEqual(m.params,t)){m.registerDependency()}if(m.name=="maxRows"){m.registerDependency()}}return function e(t){var n=t.response,o=t.sinks;var f=r.__assign(r.__assign({},i),n);h=h||new u.SimpleEvaluator;var d=o.maxRows&&o.maxRows[0];var m=d&&typeof d.value==="number"?d.value:Infinity;if(c>m)return NaN;var y=a.getCellIdFromCoordinates(f,c,l);if(!y)return NaN;var g=a.getStudentCellContent({cellContentSink:p.first(o.cellContent),initialCellContentSink:p.first(o.initialCellContent),cellEditableSink:p.first(o.cellEditable),cellErrorMessageSink:undefined,cellDisableEvaluationSink:undefined,cellSuffixSink:undefined,configurationData:i.cells[y],studentData:n.cells?n.cells[y]:undefined,columnType:a.getColumnType(i,l),fullyEditable:i.fullyEditable,isHeader:c===0});var v=s.evaluateRawLatex(g.content,h);if(v==null)return NaN;return v}}};var g={description:function(){return n.i18n.s("cl-docs-description-table-column-numeric-value")},params:[{name:"columnIndex",type:f.Types.number}],analyzeValueType:{type:"concrete",valueType:f.Types.numberList},analyzeSinkSourceDependencies:function(e){var t=e.params,n=e.sinks,i=e.config;var o=t[0];for(var c=0,l=n;c<l.length;c++){var f=l[c];if(p.contains(["cellContent","initialCellContent","cellEditable"],f.name)&&f.params[1]==o){f.registerDependency()}if(f.name=="maxRows"){f.registerDependency()}}return function e(t){var n=t.response,c=t.sinks;h=h||new u.SimpleEvaluator;var l=r.__assign(r.__assign({},i),n);var f=0;var d=[];var m=p.indexBy(c.cellContent,function(e){return e.params[0]});var y=p.indexBy(c.initialCellContent,function(e){return e.params[0]});var g=p.indexBy(c.cellEditable,function(e){return e.params[0]});var v=c.maxRows&&c.maxRows[0];var b=v&&v.value?v.value:Infinity;for(var x=1;x<=a.getLastRowCoordinate(l);x++){var _=a.getCellIdFromCoordinates(l,x,o);if(!_){d[x-1]=NaN;continue}var S=a.getStudentCellContent({cellContentSink:m[x],initialCellContentSink:y[x],cellEditableSink:g[x],cellErrorMessageSink:undefined,cellDisableEvaluationSink:undefined,cellSuffixSink:undefined,configurationData:i.cells[_],studentData:n.cells?n.cells[_]:undefined,columnType:a.getColumnType(i,o),fullyEditable:i.fullyEditable,isHeader:x===0});var T=s.evaluateRawLatex(S.content,h);d[x-1]=T==null?NaN:T;if(p.isFinite(T))f=x}d=d.slice(0,Math.min(f,b));return d}}};var v={description:function(){return n.i18n.s("cl-docs-description-table-cell-has-focus")},params:[{name:"rowIndex",type:f.Types.number},{name:"columnIndex",type:f.Types.number}],analyzeValueType:{type:"concrete",valueType:f.Types.boolean},publishedBy:"playgroundController",computeFromResponse:function(){return false}};var b=function(){return n.i18n.s("cl-docs-warning-table-submit-button-deprecation")};var x={description:function(){return n.i18n.s("cl-docs-description-table-time-since-submit")},analyzeValueType:{type:"concrete",valueType:f.Types.number},publishedBy:"playgroundController",computeFromResponse:function(e){return e.tableSubmitted?10:0},deprecated:b};var _={description:function(){return n.i18n.s("cl-docs-description-table-submitted")},analyzeValueType:{type:"concrete",valueType:f.Types.boolean},computeFromResponse:function(e){return!!e.tableSubmitted},deprecated:b};var S=r.__assign(r.__assign({},d.history),{deprecated:b});var T=r.__assign(r.__assign({},d.lastValue),{deprecated:b});var w=r.__assign(r.__assign({},d.submitCount),{deprecated:b});t.listSources={cellContent:m,cellNumericValue:y,columnNumericValues:g,cellHasFocus:v,timeSinceSubmit:x,submitted:_,history:S,lastValue:T,submitCount:w};t.listSinks=i.convertSinkList({submitButtonText:{description:function(){return n.i18n.s("cl-docs-description-table-submit-button-text")},analyzeValueType:{type:"concrete",valueType:f.Types.string},deprecated:b},submitButtonDisabled:{description:function(){return n.i18n.s("cl-docs-description-table-submit-button-disabled")},analyzeValueType:{type:"concrete",valueType:f.Types.boolean},deprecated:b},maxRows:{description:function(){return n.i18n.s("cl-docs-description-table-max-rows")},analyzeValueType:{type:"concrete",valueType:f.Types.number}},disableRowChanges:{description:function(){return n.i18n.s("cl-docs-description-table-disable-row-changes")},analyzeValueType:{type:"concrete",valueType:f.Types.boolean}},cellContent:{description:function(){return n.i18n.s("cl-docs-description-table-cell-content-sink")},params:[{name:"rowIndex",type:f.Types.number},{name:"columnIndex",type:f.Types.number}],analyzeValueType:{type:"dynamic",possibleValueTypes:[f.Types.latex,f.Types.string],analyze:function(e,t){var r;var n=(r=e,r[0]),i=r[1];var o=a.getTableCellType(n,i,t);return{valueType:o==a.columnTypes.MATH?f.Types.latex:f.Types.string}}}},cellSuffix:{params:[{name:"rowIndex",type:f.Types.number},{name:"columnIndex",type:f.Types.number}],description:function(){return n.i18n.s("cl-docs-description-table-cell-suffix")},analyzeValueType:{type:"concrete",valueType:f.Types.string}},cellErrorMessage:{params:[{name:"rowIndex",type:f.Types.number},{name:"columnIndex",type:f.Types.number}],description:function(){return n.i18n.s("cl-docs-description-table-cell-error-message")},analyzeValueType:{type:"concrete",valueType:f.Types.string}},initialCellContent:{description:function(){return n.i18n.s("cl-docs-description-table-initial-cell-content")},params:[{name:"rowIndex",type:f.Types.number},{name:"columnIndex",type:f.Types.number}],analyzeValueType:{type:"dynamic",possibleValueTypes:[f.Types.latex,f.Types.string],analyze:function(e,t){var r;var n=(r=e,r[0]),i=r[1];var o=a.getTableCellType(n,i,t);return{valueType:o==a.columnTypes.MATH?f.Types.latex:f.Types.string}}}},cellEditable:{description:function(){return n.i18n.s("cl-docs-description-table-cell-editable")},params:[{name:"rowIndex",type:f.Types.number},{name:"columnIndex",type:f.Types.number}],analyzeValueType:{type:"concrete",valueType:f.Types.boolean}},cellDisableEvaluation:{description:function(){return n.i18n.s("cl-docs-description-table-cell-disable-evaluation")},params:[{name:"rowIndex",type:f.Types.number},{name:"columnIndex",type:f.Types.number}],analyzeValueType:{type:"concrete",valueType:f.Types.boolean}},capture:{description:function(){return n.i18n.s("cl-docs-description-table-capture")},analyzeValueType:{type:"concrete",valueType:f.Types.number},deprecated:b,params:[{name:"key",type:f.Types.string}]}}).registerSinksFrom(c.correctnessSinks).registerSinksFrom(l.hiddenSink)});define("core/components/text-exhibit/cl-spec",["require","exports","core/computation-layer/types","core/computation-layer/cl-types","core/components/shared/hidden-sink","core/lib/i18n"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=r.convertSinkList({content:{description:function(){return o.i18n.s("cl-docs-description-note-content")},analyzeValueType:{type:"concrete",valueType:n.Types.string}}}).registerSinksFrom(i.hiddenSink)});define("core/components/text-input/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types","core/components/shared/hidden-sink"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a={description:function(){return r.i18n.s("cl-docs-description-text-input-content")},analyzeValueType:{type:"concrete",valueType:i.Types.string},computeFromResponse:function(e){return{type:"string",parts:e.response?[e.response]:[]}}};var s={description:function(){return r.i18n.s("cl-docs-description-text-input-time-since-submit")},analyzeValueType:{type:"concrete",valueType:i.Types.number},publishedBy:"playgroundController",computeFromResponse:function(e,t){var r=t.params;return e.submitted?r[0]:0},params:[{name:"maxTime",type:i.Types.number,default:10}]};var u={description:function(){return r.i18n.s("cl-docs-description-text-input-submitted")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean},computeFromResponse:function(e){return!!e.submitted}};t.listSources={content:a,timeSinceSubmit:s,submitted:u};t.listSinks=n.convertSinkList({initialText:{description:function(){return r.i18n.s("cl-docs-description-text-input-initial-text")},analyzeValueType:{type:"concrete",valueType:i.Types.string}},showSubmitButton:{description:function(){return r.i18n.s("cl-docs-description-text-input-show-submit")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean}},submitLabel:{description:function(){return r.i18n.s("cl-docs-description-text-input-submit-label")},analyzeValueType:{type:"concrete",valueType:i.Types.string}},WOTS:{description:function(){return r.i18n.s("cl-docs-description-text-input-wots")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean},internal:true}}).registerSinksFrom(o.hiddenSink)});define("core/components/video/cl-spec",["require","exports","core/computation-layer/types","core/computation-layer/cl-types","core/components/shared/hidden-sink","core/lib/i18n"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a={description:function(){return o.i18n.s("cl-docs-description-video-time-source")},analyzeValueType:{type:"concrete",valueType:n.Types.number},publishedBy:"playgroundController",computeFromResponse:function(){return 0}};t.listSources={time:a};t.listSinks=r.convertSinkList({time:{description:function(){return o.i18n.s("cl-docs-description-video-time-sink")},params:[],analyzeValueType:{type:"concrete",valueType:n.Types.number}}}).registerSinksFrom(i.hiddenSink)});define("core/components/image-exhibit/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types","core/components/shared/hidden-sink"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSources={};t.listSinks=n.convertSinkList({internalImagePath:{description:function(){return r.i18n.s("cl-docs-description-image-internal-image-path")},analyzeValueType:{type:"concrete",valueType:i.Types.string},internal:true},altText:{description:function(){return r.i18n.s("cl-docs-description-image-alt-text")},analyzeValueType:{type:"concrete",valueType:i.Types.string},internal:true}}).registerSinksFrom(o.hiddenSink)});define("core/components/cardsort/cl-spec",["require","exports","core/computation-layer/types","core/computation-layer/cl-types","core/components/cardsort/group-tools","core/lib/i18n"],function(e,t,r,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a={description:function(){return o.i18n.s("cl-docs-description-cardsort-total-cards")},analyzeValueType:{type:"concrete",valueType:n.Types.number},computeFromResponse:function(e,t){var r=t.config;return r.cardIds.length}};var s={description:function(){return o.i18n.s("cl-docs-description-cardsort-total-correct")},analyzeValueType:{type:"concrete",valueType:n.Types.number},computeFromResponse:function(e,t){var r=t.config;if(!r.answerKey)return 0;return i.computeCorrectCardCount(e,r.answerKey)}};var u={description:function(){return o.i18n.s("cl-docs-description-cardsort-matches-key")},analyzeValueType:{type:"concrete",valueType:n.Types.boolean},computeFromResponse:function(e,t){var r=t.config;if(!r.answerKey)return false;return i.responseMatchesKey(e,r.answerKey)}};t.listSources={totalCards:a,totalCorrectCards:s,matchesKey:u};t.listSinks=r.convertSinkList({})});define("core/components/transform/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=n.convertSinkList({readOnly:{description:function(){return r.i18n.s("cl-docs-description-transform-read-only")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean}}})});define("core/components/shared/export-sinks",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.exportSinks=n.convertSinkList({exportNumber:{description:function(){return r.i18n.raw("Export this value to the Player API. For Amplify Alpha use only!")},analyzeValueType:{type:"concrete",valueType:i.Types.number},internal:true,params:[{name:"key",type:i.Types.string}]},exportString:{description:function(){return r.i18n.raw("Export this value to the Player API. For Amplify Alpha use only!")},analyzeValueType:{type:"concrete",valueType:i.Types.string},internal:true,params:[{name:"key",type:i.Types.string}]},exportNumberList:{description:function(){return r.i18n.raw("Export this value to the Player API. For Amplify Alpha use only!")},analyzeValueType:{type:"concrete",valueType:i.Types.numberList},internal:true,params:[{name:"key",type:i.Types.string}]}})});define("core/computation-layer/cl-specs",["require","exports","core/components/action-button/cl-spec","core/components/challenge/cl-spec","core/components/expression-input/cl-spec","core/components/graph-input/cl-spec","core/components/marbleslides/cl-spec","core/components/multiple-choice/cl-spec","core/components/penny-dragging-widget/cl-spec","core/components/reorder/cl-spec","core/components/sketch/cl-spec","core/components/table/cl-spec","core/components/text-exhibit/cl-spec","core/components/text-input/cl-spec","core/components/video/cl-spec","core/components/image-exhibit/cl-spec","core/components/cardsort/cl-spec","core/components/transform/cl-spec","core/computation-layer/types","core/components/shared/export-sinks"],function(e,t,r,n,i,o,a,s,u,c,l,p,f,d,h,m,y,g,v,b){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.clSpecs={"action-button":r,cardsort:y,challenge:n,"exhibit/image":m,"exhibit/text":f,geometry:{listSinks:v.convertSinkList({})},"input/expression":i,"input/graph":o,"input/text":d,marbleslides:a,"multiple-choice":s,"penny-dragging-widget":u,sketch:l,table:p,video:h,"student-survey":{listSinks:v.convertSinkList({})},reorder:c,transform:g};for(var x in t.clSpecs){var _=t.clSpecs[x];_.listSinks.registerSinksFrom(b.exportSinks)}});define("core/computation-layer/pure-source-controller",["require","exports","tslib"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){var r=this;this.options=e;this.studentId=t;this.subscriptions=[];this.subscribed=false;this.subscribe=function(e,t){var n=r.options.lessonQuery.getScreenIdFromComponentId(e);var i=r.options.lessonQuery.getComponentConfigById(e);var o={cb:t,componentId:e,stepId:n,componentConfig:i};r.subscriptions.push(o);r.updateSubscription(o);r.ensureSubscribed()}}e.prototype.ensureSubscribed=function(){var e=this;if(this.subscribed)return;this.subscribed=true;this.options.register(function(t){return e.handleUpdate(t)})};e.prototype.handleUpdate=function(e){if(e.type!="student-list-updated")return;for(var t=0,n=this.subscriptions;t<n.length;t++){var i=n[t];var o=r.__assign(r.__assign({},e.updated.responses[i.stepId]),e.updated.responses[i.componentId]);if(o[this.studentId]){this.updateSubscription(i)}}};e.prototype.updateSubscription=function(e){var t=this.options.responseForStudentAndComponent(this.studentId,e.componentId);if(t==null)t={};e.cb(t,e.componentConfig)};return e}();t.PureSourceController=n});(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define("flux",[],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.Flux=e()}})(function(){var e,t,r;return function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){var u=typeof require=="function"&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[a].exports}var o=typeof require=="function"&&require;for(var a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,r){t.exports.Dispatcher=e("./lib/Dispatcher")},{"./lib/Dispatcher":2}],2:[function(e,t,r){function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=e("./invariant");var o="ID_";var a=function(){function e(){n(this,e);this._lastID=1;this._callbacks={};this._isPending={};this._isHandled={};this._isDispatching=false;this._pendingPayload=null}e.prototype.register=function e(t){var r=o+this._lastID++;this._callbacks[r]=t;return r};e.prototype.unregister=function e(t){i(this._callbacks[t],"Dispatcher.unregister(...): `%s` does not map to a registered callback.",t);delete this._callbacks[t]};e.prototype.waitFor=function e(t){i(this._isDispatching,"Dispatcher.waitFor(...): Must be invoked while dispatching.");for(var r=0;r<t.length;r++){var n=t[r];if(this._isPending[n]){i(this._isHandled[n],"Dispatcher.waitFor(...): Circular dependency detected while "+"waiting for `%s`.",n);continue}i(this._callbacks[n],"Dispatcher.waitFor(...): `%s` does not map to a registered callback.",n);this._invokeCallback(n)}};e.prototype.dispatch=function e(t){i(!this._isDispatching,"Dispatch.dispatch(...): Cannot dispatch in the middle of a dispatch.");this._startDispatching(t);try{for(var r in this._callbacks){if(this._isPending[r]){continue}this._invokeCallback(r)}}finally{this._stopDispatching()}};e.prototype.isDispatching=function e(){return this._isDispatching};e.prototype._invokeCallback=function e(t){this._isPending[t]=true;this._callbacks[t](this._pendingPayload);this._isHandled[t]=true};e.prototype._startDispatching=function e(t){for(var r in this._callbacks){this._isPending[r]=false;this._isHandled[r]=false}this._pendingPayload=t;this._isDispatching=true};e.prototype._stopDispatching=function e(){this._pendingPayload=null;this._isDispatching=false};return e}();t.exports=a},{"./invariant":3}],3:[function(e,t,r){var n=function(e,t,r,n,i,o,a,s){if(false){if(t===undefined){throw new Error("invariant requires an error message argument")}}if(!e){var u;if(t===undefined){u=new Error("Minified exception occurred; use the non-minified dev environment "+"for the full error message and additional helpful warnings.")}else{var c=[r,n,i,o,a,s];var l=0;u=new Error("Invariant Violation: "+t.replace(/%s/g,function(){return c[l++]}))}u.framesToPop=1;throw u}};t.exports=n},{}]},{},[1])(1)});define("core/lib/flux-wrapper",["require","exports","tslib","flux","underscore"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});var o;try{if(performance){o=function(){return performance.now()}}else{throw new Error("Performance not defined")}}catch(e){o=function(){return(new Date).getTime()}}var a=o();var s=function(e){r.__extends(t,e);function t(t){var r=e.call(this)||this;r.options=t;r.lastAction={type:"initialization",finished:o()};r.views={};var n=r.dispatch;r.dispatch=function(e){return n.call(r,e)};return r}t.prototype.dispatch=function(t){var n=o();if(!t.type){throw new Error("Bad action: "+JSON.stringify(t))}var i=[];e.prototype.dispatch.call(this,r.__assign(r.__assign({},t),{_onUpdateDone:function(e){return i.push(e)}}));var s=o();this.updateAll();var u=o();for(var c=0,l=i;c<l.length;c++){var p=l[c];p()}var f=o();var d=1e4;if(d<1){throw new Error("Downsample less than one will sample every dispatch")}if(this.options.logJSON&&Math.random()*d<1)this.options.logJSON("dispatch-sample",{type:t.type,w:d,times:{model:s-n,view:u-s,updateDone:f-u,timeSinceLoad:f-a},prev:{type:this.lastAction.type,dt:n-this.lastAction.finished}});this.lastAction={type:t.type,finished:f}};t.prototype.pushView=function(e){var t=i.uniqueId("viewToken_");this.views[t]=e;return t};t.prototype.removeView=function(e){delete this.views[e]};t.prototype.register=function(t){return e.prototype.register.call(this,function(e){return t(e,e._onUpdateDone)})};t.prototype.updateAll=function(){if(this.view){this.view.update()}for(var e in this.views){this.views[e].update()}};return t}(n.Dispatcher);t.Dispatcher=s});define("core/lib/typed-bind",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.bind=function(e,t){return e["bind"](t)}});define("core/computation-layer/params",["require","exports","core/computation-layer/aggregator","core/computation-layer/step-component","core/computation-layer/library/index","core/computation-layer/cl-specs","core/computation-layer/pure-source-controller","core/lib/flux-wrapper","core/lib/typed-bind"],function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});function c(e,t,c){var l={};function p(e,t){l[e]=t}for(var f=0,d=e.lessonQuery.listSteps();f<d.length;f++){var h=d[f];p(h.id,{stepId:h.id,sinks:n.stepComponent.listSinks,script:h.script})}for(var m=0,y=e.lessonQuery.listAllComponentIds();m<y.length;m++){var g=y[m];var v=e.lessonQuery.getComponentConfigById(g);var b=e.lessonQuery.getScreenIdFromComponentId(g);var x=e.lessonQuery.getComponentAliasById(g);var _=o.clSpecs[x];var S=v.alias?v.alias.trim():"";if(S===""){S=void 0}p(g,{stepId:b,sinks:_.listSinks,sources:_.listSources,alias:S,script:v.script,config:v})}p("aggregate",{stepId:"aggregate",sinks:r.listSinks,sources:r.listSources});var T=undefined;var w=e.dispatcher;if(!w){w=new s.Dispatcher({})}var E=new a.PureSourceController({lessonQuery:e.lessonQuery,register:u.bind(w.register,w),responseForStudentAndComponent:e.responseForStudentAndComponent},t);T=E.subscribe;var M={randomSeed:c,noScripts:false,components:l,library:i,computationDidUpdate:function(){return e.dispatcher?e.dispatcher.dispatch({type:"computation-layer-updated"}):undefined},subscribePureSource:T,publishersAvailable:["playgroundController","aggregate"],dryRun:false,insertThumbnailComponent:false};return M}t.buildRuntimeParams=c});define("core/lesson-query",["require","exports","underscore","core/lib/i18n","./components/component-helpers","core/components/component-helpers","./lib/log","./components/multiple-choice/helpers"],function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});var u=function(){function e(){}return e}();var c=function(){function e(e){this.screenId=e}e.prototype.getScreenId=function(){return this.screenId};e.prototype.containsScreenId=function(e){return e==this.screenId};return e}();var l=function(){function e(){}e.prototype.getScreenId=function(){return"unimplemented"};e.prototype.containsScreenId=function(e){return false};return e}();t.ConditionalStep=l;var p=0;var f=function(){function e(e){this.data=d();this.stepsConfig=[];this.editingSubscreenParentIndex={};this.id=p++;this.reload(e)}e.prototype.reload=function(e){this.data=d();this.stepsConfig=e;for(var t=0;t<e.length;t++){var r=e[t];this.appendStep(r);var o=r.beginNewSection;var a=this.data.sections[this.data.sections.length-1];if(o){var s=a?a.activityNumber:0;this.data.sections.push({key:o,start:t,end:t,activityNumber:o==="im-pilot-activity"?1+s:s})}else if(a){a.end=t}}this.editingSubscreenParentIndex={};for(var t=0,u=1;t<e.length;t++){var c=e[t];var l=this.data.screens[this.getScreenIdByIndex(t)];var p=i.getSubscreenParentConfig(c);l.displayNumber=n.i18n.num(u);u+=1;if(!p||typeof p.numSteps!=="number"){continue}for(var f=0;f<p.numSteps;f++){var h=e[t+1+f];var m=this.data.screens[this.getScreenIdByIndex(t+1+f)];m.displayNumber=n.i18n.raw(l.displayNumber+"."+n.i18n.num(f+1));this.editingSubscreenParentIndex[h.id]=l.id}t+=p.numSteps}};e.prototype.getId=function(){return this.id};e.prototype.appendStep=function(e){if(e.type!="two-column")throw new Error("Expected a two-column step type");var t={layout:[],id:e.id,displayNumber:n.i18n.num(this.data.steps.length+1),title:e.title,script:e.script};if(e.id==undefined){throw new Error("Error - screen without id")}else if(this.data.screens[t.id]){throw new Error("screenId Collision")}for(var r=0,i=e.root.linearlayout.components;r<i.length;r++){var a=i[r];var s=[];for(var u=0,l=a.linearlayout.components;u<l.length;u++){var p=l[u];var f=o.componentKey(p);var d=o.traverseComponentKey(p);if(d.id==undefined){throw new Error("Error - component without id")}else if(this.data.components[d.id]){throw new Error("componentId collision")}s.push(d.id);this.data.components[d.id]={type:f,config:d,screenId:t.id}}t.layout.push(s)}this.data.screens[t.id]=t;this.data.steps.push(new c(t.id))};e.prototype.getStepConfig=function(e){for(var t=0,r=this.stepsConfig;t<r.length;t++){var n=r[t];if(n.id==e)return n}throw new Error("Unable to find step config for screen "+e)};e.prototype.getScreenIdByIndex=function(e){return this.getStepByIndex(e).getScreenId()};e.prototype.getIndexForScreenId=function(e){for(var t=0;t<this.data.steps.length;t++){if(this.data.steps[t].containsScreenId(e))return t}throw new Error("Screen "+e+" not found in any step")};e.prototype.hasExplainAtEndOfLayout=function(e){var t=this.getComponentById(e);if(!(t.type==="multiple-choice"&&t.config.showExplainAtEndOfLayout&&s.isSimpleWithExplanation(t.config)))return false;return this.mcCanHaveExplainAtEndOfLayout(e)};e.prototype.mcCanHaveExplainAtEndOfLayout=function(e){var t=this;var n=this.componentIdsByColumn(this.getScreenIdFromComponentId(e));if(n.length!==2)return false;if(n[0].indexOf(e)===-1)return false;return r.every(r.flatten(n),function(r){if(r===e)return true;return t.getComponentAliasById(r)==="exhibit/text"})};e.prototype.getDisplayNumberForScreenId=function(e){var t=this.data.screens[e];if(!t)throw new Error("Screen "+e+" not found.");return t.displayNumber};e.prototype.getComponentIdsForScreen=function(e){var t=this.getScreenById(e);return r.flatten(t.layout)};e.prototype.getComponentIdLayoutByScreenId=function(e){return this.getScreenById(e).layout};e.prototype.getComponentKeysForScreen=function(e){var t=this;var r=this.getComponentIdsForScreen(e);return r.map(function(e){return t.getComponentAliasById(e)})};e.prototype.getScreenIdFromComponentId=function(e){return this.getComponentById(e).screenId};e.prototype.isComponentOnScreen=function(e){var t=e.componentId,r=e.screenId;return this.getComponentById(t).screenId==r};e.prototype.hasScreen=function(e){return this.data.screens[e]!=undefined};e.prototype.isSubscreen=function(e){return!!this.getSubscreenParentForStepWhileEditing(e)};e.prototype.componentIdsByColumn=function(e){return this.getScreenById(e).layout.map(function(e){return e.map(function(e){return e})})};e.prototype.componentKeysByColumn=function(e){var t=this;return this.getScreenById(e).layout.map(function(e){return e.map(function(e){return t.getComponentAliasById(e)})})};e.prototype.columnIdxForComponent=function(e,t){var r=this.getScreenById(e).layout;for(var n=0;n<r.length;n++){if(r[n].indexOf(t)>=0)return n}return-1};e.prototype.componentCountForScreen=function(e){return this.getComponentIdsForScreen(e).length};e.prototype.getImageForScreen=function(e){if(!this.hasScreen(e))return undefined;var t=this.getComponentByKeyAndScreen("exhibit/image",e);return t&&t.img};e.prototype.getNoteForScreen=function(e){var t=this.getComponentByKeyAndScreen("exhibit/text",e);return t&&t.text};e.prototype.getChallengeCreatorForScreen=function(e){return this.getComponentByKeyAndScreen("challenge",e)};e.prototype.getCardsortForScreen=function(e){return this.getComponentByKeyAndScreen("cardsort",e)};e.prototype.getSubscreenParentForStepWhileEditing=function(e){var t=this.editingSubscreenParentIndex[e];return t?this.getStepConfig(t):undefined};e.prototype.getSubscreensForChallenge=function(e){var t=this;if(this.getChallengeCreatorForScreen(e)){return r.keys(this.editingSubscreenParentIndex).filter(function(r){return t.editingSubscreenParentIndex[r]===e})}return[]};e.prototype.getChallengeScreenId=function(){var e=r.uniq(r.values(this.editingSubscreenParentIndex));if(e.length>0){if(e.length>1){a.warn("get-challenge-screens","Expected at most one Challenge Creator for activity")}return e[0]}return undefined};e.prototype.getSubscreenSteps=function(){var e={};for(var t in this.editingSubscreenParentIndex){var r=this.editingSubscreenParentIndex[t];if(!e[r]){e[r]=[this.getStepConfig(r)]}e[r].push(this.getStepConfig(t))}return e};e.prototype.getPrimaryActivitySteps=function(){var e=this;return this.stepsConfig.filter(function(t){return!e.isSubscreen(t.id)&&!e.getComponentByKeyAndScreen("challenge",t.id)})};e.prototype.getPreviousGraphComponentId=function(e){var t;for(var r=0,n=this.data.steps;r<n.length;r++){var i=n[r];if(!(i instanceof c))continue;var o=i.getScreenId();for(var a=0,s=this.getComponentIdsForScreen(o);a<s.length;a++){var u=s[a];if(u==e){return t}if(this.getComponentAliasById(u)=="input/graph"){t=u}}}return undefined};e.prototype.getSourceId=function(e){var t=this.getComponentConfigById(e);if(t&&t.copyId){var r=this.getPreviousGraphComponentId(e);return r?this.getSourceId(r):t.id}else{return t?t.id:e}};e.prototype.getSourceData=function(e){return this.getComponentConfigById(this.getSourceId(e))};e.prototype.lessonUsesScripts=function(){for(var e in this.data.screens){if(this.getScreenById(e).script)return true}for(var t in this.data.components){if(this.getComponentById(t).config.script)return true}return false};e.prototype.scriptByScreenOrComponentId=function(e){var t=this.data.components[e];var r=this.data.screens[e];if(t&&r)throw new Error("Screen and component have matching ids");if(t){return t.config.script}if(r){return r.script}return undefined};e.prototype.getComponentAliasById=function(e){return this.getComponentById(e).type};e.prototype.componentAliasExists=function(e){for(var t in this.data.components){if(this.data.components[t].type==e)return true}return false};e.prototype.listAllComponentIds=function(){return r.keys(this.data.components)};e.prototype.listAllScreenIds=function(){return r.keys(this.data.screens)};e.prototype.listSteps=function(){return this.stepsConfig};e.prototype.getStepCount=function(){return this.data.steps.length};e.prototype.getComponentConfigById=function(e){return this.getComponentById(e).config};e.prototype.componentExists=function(e){return this.data.components[e]!=undefined};e.prototype.screenExists=function(e){return this.data.screens[e]!=undefined};e.prototype.getSectionForStep=function(e){var t=this.getIndexForScreenId(e);for(var r=0,n=this.data.sections;r<n.length;r++){var i=n[r];if(i.start<=t&&i.end>=t)return i}return undefined};e.prototype.getSections=function(){return this.data.sections};e.prototype.hasSections=function(){return this.data.sections.length>0};e.prototype.getComponentById=function(e){var t=this.data.components[e];if(t==undefined)throw new Error("Component "+e+" not found");return t};e.prototype.getScreenById=function(e){var t=this.data.screens[e];if(t==undefined)throw new Error("Screen "+e+" not found");return t};e.prototype.getStepByIndex=function(e){var t=this.data.steps[e];if(t==undefined)throw new Error("Unable to find step with index "+e);return t};e.prototype.getComponentByKeyAndScreen=function(e,t){for(var r=0,n=this.getComponentIdsForScreen(t);r<n.length;r++){var i=n[r];var o=this.getComponentById(i);if(o.type==e){return o.config}}return undefined};return e}();t.LessonQuery=f;function d(){return{components:{},screens:{},steps:[],sections:[]}}});define("core/lib/combine-step-and-component-response",["require","exports","tslib","underscore"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});function i(e,t){return r.__assign(r.__assign({},n.omit(e,"seen","coverDismissed")),t)}t.combineStepAndComponentResponse=i});define("core/computation-layer/class-runtime",["require","exports","tslib","./runtime","./params","core/lesson-query","core/lib/combine-step-and-component-response","core/random-seed","core/lib/flux-wrapper","core/lib/typed-bind"],function(e,t,r,n,i,o,a,s,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});var l=function(){function e(e){this.options=e;this.runtimes={};this.students={};this.lessonQuery=new o.LessonQuery(e.steps);for(var t=0,r=e.studentIds;t<r.length;t++){var n=r[t];this.ensureRuntimeExists(n)}this.handleResponses(e.responses)}e.prototype.responseForStudentAndComponent=function(e,t){var r=this.students[e];if(!r){throw new Error("Tried reading data for student "+e+" but it did not exist.")}var n=r.data[t];var i=this.lessonQuery.getScreenIdFromComponentId(t);var o=r.data[i];var s=a.combineStepAndComponentResponse(o,n);return s};e.prototype.getRuntime=function(e){this.ensureRuntimeExists(e);return this.runtimes[e]};e.prototype.getDownstreamComponentIds=function(e,t){var r=this.runtimes[e];var n={};var i={};function o(e){if(n[e]){return}n[e]=true;var t=r.nodes[e];for(var i=0,a=t.dependents;i<a.length;i++){var s=a[i];o(s)}}for(var a in t){var s=r.analysis.responseSources[a];if(s){o(s)}}for(var u in r.analysis.sinks){var c=r.analysis.sinks[u];for(var l in c){for(var p=0,f=c[l];p<f.length;p++){var d=f[p];for(var h=0,m=d.dependencies;h<m.length;h++){var y=m[h];if(n[y]){i[u]=true}}}}}return Object.keys(i)};e.prototype.handleResponses=function(e){for(var t in e){var n=this.students[t];if(!n){throw new Error("Processing response for student "+t+" before student runtime is defined")}n.data=r.__assign(r.__assign({},n.data),e[t])}var i=p(e);for(var t in this.students){this.students[t].dispatcher.dispatch({type:"student-list-updated",updated:i});this.runtimes[t].processPendingValues()}};e.prototype.onceRuntime=function(e,t,r,n){this.ensureRuntimeExists(e,t,true,r);var i=this.runtimes[e];for(var o=0,a=i.getSources("aggregate","aggregateSource");o<a.length;o++){var s=a[o];var u=s.params[0];if(!n[u]){throw new Error("Expected aggregateSource with id "+u+" but found none.")}s.setValue(n[u])}};e.prototype.ensureRuntimeExists=function(e,t,o,a){var l=this;if(this.runtimes[e])return;var p=new u.Dispatcher({});var f=p.register(function(t){var r=l.students[e];var n=l.runtimes[e];if(!r||!n){throw new Error("Tried handling dispatch for "+e+" but that student runtime no longer exists.")}switch(t.type){case"student-list-updated":l.updateAggregateSources(e,t.updated);break;case"computation-layer-updated":var i={};var o=n.sinks;for(var a in o){var s=o[a];i[a]={};for(var u in s){var c=s[u];i[a][u]=[];for(var p=0,f=c;p<f.length;p++){var d=f[p];i[a][u].push({params:d.params,value:d.value,valueType:d.valueType})}}}l.options.onCLUpdated(e,i);if(r.once){l.destroyRuntime(e)}break;default:l.options.onUnexpectedAction(t.type)}});this.students[e]={dispatcher:p,token:f,data:t||{},once:!!o};var d=i.buildRuntimeParams({lessonQuery:this.lessonQuery,dispatcher:p,responseForStudentAndComponent:c.bind(this.responseForStudentAndComponent,this)},e,a?s.RandomSeed.fromString(a):new s.RandomSeed(e)),h=d.noScripts,m=r.__rest(d,["noScripts"]);var y=r.__assign(r.__assign({noScripts:false},m),{publishersAvailable:["aggregate"],dryRun:false,insertThumbnailComponent:true});var g;if(this.initialRuntime){g=new n.Runtime(r.__assign(r.__assign({},y),{reuseAnalysisFrom:this.initialRuntime}))}else{g=new n.Runtime(r.__assign({},y))}this.initializeAggregateSources(g);this.runtimes[e]=g;if(!this.initialRuntime)this.initialRuntime=g};e.prototype.updateAggregateSources=function(e,t){var r=this.students[e];var n=this.runtimes[e];if(!r||!n){throw new Error("Tried aggregating for student "+e+" but that student is not registered.")}for(var i=0,o=n.getSources("aggregate","aggregateSource");i<o.length;i++){var a=o[i];var s=a.params[0];if(t.responses[s]){var u=[];for(var c=0,l=Object.keys(this.students).sort();c<l.length;c++){var p=l[c];var f=this.students[p].data[s];if(f&&f.computedValue!=null&&!isNaN(f.computedValue)){u.push(f.computedValue)}}a.setValue(u)}}};e.prototype.initializeAggregateSources=function(e){for(var t=0,r=e.getSources("aggregate","aggregateSource");t<r.length;t++){var n=r[t];n.setValue([])}};e.prototype.destroyRuntime=function(e){var t=this.students[e];var r=this.runtimes[e];if(!t||!r){throw new Error("Tried to destroy runtime for student "+e+" but it did not exist.")}t.dispatcher.unregister(t.token);delete this.students[e];delete this.runtimes[e]};return e}();t.ClassRuntime=l;function p(e){var t={};for(var r in e){for(var n in e[r]){if(!t[n]){t[n]={}}t[n][r]=true}}return{responses:t}}});define("prosemirror-schema-basic/index",["require","exports","module","prosemirror-model"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=e("prosemirror-model");var i=["p",0],o=["blockquote",0],a=["hr"],s=["pre",["code",0]],u=["br"];var c={doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:function e(){return i}},blockquote:{content:"block+",group:"block",defining:true,parseDOM:[{tag:"blockquote"}],toDOM:function e(){return o}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:function e(){return a}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:true,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function e(t){return["h"+t.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:true,defining:true,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:function e(){return s}},text:{group:"inline"},image:{inline:true,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:true,parseDOM:[{tag:"img[src]",getAttrs:function e(t){return{src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")}}}],toDOM:function e(t){var r=t.attrs;var n=r.src;var i=r.alt;var o=r.title;return["img",{src:n,alt:i,title:o}]}},hard_break:{inline:true,group:"inline",selectable:false,parseDOM:[{tag:"br"}],toDOM:function e(){return u}}};var l=["em",0],p=["strong",0],f=["code",0];var d={link:{attrs:{href:{},title:{default:null}},inclusive:false,parseDOM:[{tag:"a[href]",getAttrs:function e(t){return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM:function e(t){var r=t.attrs;var n=r.href;var i=r.title;return["a",{href:n,title:i},0]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function e(){return l}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(e){return e.style.fontWeight!="normal"&&null}},{style:"font-weight",getAttrs:function(e){return/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}}],toDOM:function e(){return p}},code:{parseDOM:[{tag:"code"}],toDOM:function e(){return f}}};var h=new n.Schema({nodes:c,marks:d});t.marks=d;t.nodes=c;t.schema=h});define("prosemirror-schema-basic",["prosemirror-schema-basic/index"],function(e){return e});define("core/prosemirror/link-mark-spec",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.link={attrs:{href:{},title:{default:null},target:{default:"_blank"}},inclusive:false,parseDOM:[{tag:"a[href]",getAttrs:function(e){return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM:function(e){var t=e.attrs,r=t.href,n=t.title,i=t.target;return["a",{href:r,title:n,target:i,class:"blue-link"},0]}}});define("core/prosemirror/mq-schema",["require","exports","orderedmap","prosemirror-model","prosemirror-schema-basic"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.mqSpec={inline:true,group:"inline",content:"text*",selectable:true,toDOM:function(e){return"`"+e.textContent+"`"}};t.mqSchema=new n.Schema({nodes:r.from({doc:i.nodes.doc,paragraph:i.nodes.paragraph,text:i.nodes.text,mq:t.mqSpec})})});define("core/prosemirror/interp-node-spec",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.interpSpec={content:"inline*",attrs:{interpExpr:{default:""}},group:"inline",inline:true,selectable:true,toDOM:function(e){return"${"+e.attrs.interpExpr+"}"}}});define("core/lib/rich-text",["require","exports","orderedmap","prosemirror-model","prosemirror-schema-basic","../prosemirror/link-mark-spec","../prosemirror/mq-schema","../prosemirror/interp-node-spec"],function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.schemas={document:{schema:new n.Schema({nodes:r.from({doc:i.nodes.doc,paragraph:i.nodes.paragraph,text:i.nodes.text,heading:i.nodes.heading,mq:a.mqSpec,interp:s.interpSpec}),marks:r.from({link:o.link,em:i.marks.em,strong:i.marks.strong})}),version:2},section:{schema:new n.Schema({nodes:r.from({doc:i.nodes.doc,paragraph:i.nodes.paragraph,text:i.nodes.text,mq:a.mqSpec}),marks:r.from({link:o.link,em:i.marks.em,strong:i.marks.strong})}),version:1},heading:{schema:new n.Schema({nodes:r.from({doc:{content:"heading"},heading:i.nodes.heading,text:i.nodes.text,mq:a.mqSpec}),marks:r.from({link:o.link,em:i.marks.em,strong:i.marks.strong})}),version:1}}});define("core/lib/rich-text-helpers",["require","exports","tslib","../prosemirror/prosemirror-serialize","prosemirror-model","./rich-text","./log","./assert-unreachable"],function(e,t,r,n,i,o,a,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});function u(e){var t=o.schemas[e.schemaKey];if(e.version===t.version)return e;var r=i.Node.fromJSON(t.schema,e.content);return c(e.schemaKey,r)}t.updateRichTextVersion=u;function c(e,t){return{schemaKey:e,version:o.schemas[e].version,content:t.toJSON()}}t.richTextFromNode=c;function l(e,t){var r=o.schemas[e].schema;var i;var a=e;switch(a){case"heading":i=r.nodes["heading"];break;case"document":case"section":i=r.nodes["paragraph"];break;default:s.assertUnreachable(a)}var u=t.trim().split("\n").map(function(e){return i.create(undefined,n.stringToNodes(e,r))});var c=r.nodes[r.spec.topNode||"doc"].create(undefined,u);return{schemaKey:e,version:o.schemas[e].version,content:c.toJSON()}}t.richTextFromText=l;function p(e){var t=e.length>0?[{type:"text",text:e}]:[];return{schemaKey:"document",version:1,content:{type:"doc",content:[{type:"mq",content:t}]}}}t.richTextFromLatex=p;function f(e,t,n){if(e.content.type!=="doc"){a.warn("RichTextParseError","Expected RichText<document> root to be of type 'doc', but found "+e.content.type+" instead");return e}var i=e.content.content||[];return r.__assign(r.__assign({},e),{content:r.__assign(r.__assign({},e.content),{content:i.slice(t,n)})})}t.sliceParagraphs=f});define("prosemirror-transform/index",["require","exports","module","prosemirror-model"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=e("prosemirror-model");var i=65535;var o=Math.pow(2,16);function a(e,t){return e+t*o}function s(e){return e&i}function u(e){return(e-(e&i))/o}var c=function e(t,r,n){if(r===void 0)r=false;if(n===void 0)n=null;this.pos=t;this.deleted=r;this.recover=n};var l=function e(t,r){if(r===void 0)r=false;this.ranges=t;this.inverted=r};l.prototype.recover=function e(t){var r=0,n=s(t);if(!this.inverted){for(var i=0;i<n;i++){r+=this.ranges[i*3+2]-this.ranges[i*3+1]}}return this.ranges[n*3]+r+u(t)};l.prototype.mapResult=function e(t,r){if(r===void 0)r=1;return this._map(t,r,false)};l.prototype.map=function e(t,r){if(r===void 0)r=1;return this._map(t,r,true)};l.prototype._map=function e(t,r,n){var i=0,o=this.inverted?2:1,s=this.inverted?1:2;for(var u=0;u<this.ranges.length;u+=3){var l=this.ranges[u]-(this.inverted?i:0);if(l>t){break}var p=this.ranges[u+o],f=this.ranges[u+s],d=l+p;if(t<=d){var h=!p?r:t==l?-1:t==d?1:r;var m=l+i+(h<0?0:f);if(n){return m}var y=a(u/3,t-l);return new c(m,r<0?t!=l:t!=d,y)}i+=f-p}return n?t+i:new c(t+i)};l.prototype.touches=function e(t,r){var n=0,i=s(r);var o=this.inverted?2:1,a=this.inverted?1:2;for(var u=0;u<this.ranges.length;u+=3){var c=this.ranges[u]-(this.inverted?n:0);if(c>t){break}var l=this.ranges[u+o],p=c+l;if(t<=p&&u==i*3){return true}n+=this.ranges[u+a]-l}return false};l.prototype.forEach=function e(t){var r=this.inverted?2:1,n=this.inverted?1:2;for(var i=0,o=0;i<this.ranges.length;i+=3){var a=this.ranges[i],s=a-(this.inverted?o:0),u=a+(this.inverted?0:o);var c=this.ranges[i+r],l=this.ranges[i+n];t(s,s+c,u,u+l);o+=l-c}};l.prototype.invert=function e(){return new l(this.ranges,!this.inverted)};l.prototype.toString=function e(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};l.offset=function e(t){return t==0?l.empty:new l(t<0?[0,-t,0]:[0,0,t])};l.empty=new l([]);var p=function e(t,r,n,i){this.maps=t||[];this.from=n||0;this.to=i==null?this.maps.length:i;this.mirror=r};p.prototype.slice=function e(t,r){if(t===void 0)t=0;if(r===void 0)r=this.maps.length;return new p(this.maps,this.mirror,t,r)};p.prototype.copy=function e(){return new p(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};p.prototype.appendMap=function e(t,r){this.to=this.maps.push(t);if(r!=null){this.setMirror(this.maps.length-1,r)}};p.prototype.appendMapping=function e(t){for(var r=0,n=this.maps.length;r<t.maps.length;r++){var i=t.getMirror(r);this.appendMap(t.maps[r],i!=null&&i<r?n+i:null)}};p.prototype.getMirror=function e(t){if(this.mirror){for(var r=0;r<this.mirror.length;r++){if(this.mirror[r]==t){return this.mirror[r+(r%2?-1:1)]}}}};p.prototype.setMirror=function e(t,r){if(!this.mirror){this.mirror=[]}this.mirror.push(t,r)};p.prototype.appendMappingInverted=function e(t){for(var r=t.maps.length-1,n=this.maps.length+t.maps.length;r>=0;r--){var i=t.getMirror(r);this.appendMap(t.maps[r].invert(),i!=null&&i>r?n-i-1:null)}};p.prototype.invert=function e(){var t=new p;t.appendMappingInverted(this);return t};p.prototype.map=function e(t,r){if(r===void 0)r=1;if(this.mirror){return this._map(t,r,true)}for(var n=this.from;n<this.to;n++){t=this.maps[n].map(t,r)}return t};p.prototype.mapResult=function e(t,r){if(r===void 0)r=1;return this._map(t,r,false)};p.prototype._map=function e(t,r,n){var i=false,o=null;for(var a=this.from;a<this.to;a++){var s=this.maps[a],u=o&&o[a];if(u!=null&&s.touches(t,u)){t=s.recover(u);continue}var l=s.mapResult(t,r);if(l.recover!=null){var p=this.getMirror(a);if(p!=null&&p>a&&p<this.to){if(l.deleted){a=p;t=this.maps[p].recover(l.recover);continue}else{(o||(o=Object.create(null)))[p]=l.recover}}}if(l.deleted){i=true}t=l.pos}return n?t:new c(t,i)};function f(e){var t=Error.call(this,e);t.__proto__=f.prototype;return t}f.prototype=Object.create(Error.prototype);f.prototype.constructor=f;f.prototype.name="TransformError";var d=function e(t){this.doc=t;this.steps=[];this.docs=[];this.mapping=new p};var h={before:{configurable:true},docChanged:{configurable:true}};h.before.get=function(){return this.docs.length?this.docs[0]:this.doc};d.prototype.step=function e(t){var r=this.maybeStep(t);if(r.failed){throw new f(r.failed)}return this};d.prototype.maybeStep=function e(t){var r=t.apply(this.doc);if(!r.failed){this.addStep(t,r.doc)}return r};h.docChanged.get=function(){return this.steps.length>0};d.prototype.addStep=function e(t,r){this.docs.push(this.doc);this.steps.push(t);this.mapping.appendMap(t.getMap());this.doc=r};Object.defineProperties(d.prototype,h);function m(){throw new Error("Override me")}var y=Object.create(null);var g=function e(){};g.prototype.apply=function e(t){return m()};g.prototype.getMap=function e(){return l.empty};g.prototype.invert=function e(t){return m()};g.prototype.map=function e(t){return m()};g.prototype.merge=function e(t){return null};g.prototype.toJSON=function e(){return m()};g.fromJSON=function e(t,r){if(!r||!r.stepType){throw new RangeError("Invalid input for Step.fromJSON")}var n=y[r.stepType];if(!n){throw new RangeError("No step type "+r.stepType+" defined")}return n.fromJSON(t,r)};g.jsonID=function e(t,r){if(t in y){throw new RangeError("Duplicate use of step JSON ID "+t)}y[t]=r;r.prototype.jsonID=t;return r};var v=function e(t,r){this.doc=t;this.failed=r};v.ok=function e(t){return new v(t,null)};v.fail=function e(t){return new v(null,t)};v.fromReplace=function e(t,r,i,o){try{return v.ok(t.replace(r,i,o))}catch(e){if(e instanceof n.ReplaceError){return v.fail(e.message)}throw e}};var b=function(e){function t(t,r,n,i){e.call(this);this.from=t;this.to=r;this.slice=n;this.structure=!!i}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){if(this.structure&&_(t,this.from,this.to)){return v.fail("Structure replace would overwrite content")}return v.fromReplace(t,this.from,this.to,this.slice)};t.prototype.getMap=function e(){return new l([this.from,this.to-this.from,this.slice.size])};t.prototype.invert=function e(r){return new t(this.from,this.from+this.slice.size,r.slice(this.from,this.to))};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);if(n.deleted&&i.deleted){return null}return new t(n.pos,Math.max(n.pos,i.pos),this.slice)};t.prototype.merge=function e(r){if(!(r instanceof t)||r.structure!=this.structure){return null}if(this.from+this.slice.size==r.from&&!this.slice.openEnd&&!r.slice.openStart){var i=this.slice.size+r.slice.size==0?n.Slice.empty:new n.Slice(this.slice.content.append(r.slice.content),this.slice.openStart,r.slice.openEnd);return new t(this.from,this.to+(r.to-r.from),i,this.structure)}else if(r.to==this.from&&!this.slice.openStart&&!r.slice.openEnd){var o=this.slice.size+r.slice.size==0?n.Slice.empty:new n.Slice(r.slice.content.append(this.slice.content),r.slice.openStart,this.slice.openEnd);return new t(r.from,this.to,o,this.structure)}else{return null}};t.prototype.toJSON=function e(){var t={stepType:"replace",from:this.from,to:this.to};if(this.slice.size){t.slice=this.slice.toJSON()}if(this.structure){t.structure=true}return t};t.fromJSON=function e(r,i){if(typeof i.from!="number"||typeof i.to!="number"){throw new RangeError("Invalid input for ReplaceStep.fromJSON")}return new t(i.from,i.to,n.Slice.fromJSON(r,i.slice),!!i.structure)};return t}(g);g.jsonID("replace",b);var x=function(e){function t(t,r,n,i,o,a,s){e.call(this);this.from=t;this.to=r;this.gapFrom=n;this.gapTo=i;this.slice=o;this.insert=a;this.structure=!!s}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){if(this.structure&&(_(t,this.from,this.gapFrom)||_(t,this.gapTo,this.to))){return v.fail("Structure gap-replace would overwrite content")}var r=t.slice(this.gapFrom,this.gapTo);if(r.openStart||r.openEnd){return v.fail("Gap is not a flat range")}var n=this.slice.insertAt(this.insert,r.content);if(!n){return v.fail("Content does not fit in gap")}return v.fromReplace(t,this.from,this.to,n)};t.prototype.getMap=function e(){return new l([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])};t.prototype.invert=function e(r){var n=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,r.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);var o=r.map(this.gapFrom,-1),a=r.map(this.gapTo,1);if(n.deleted&&i.deleted||o<n.pos||a>i.pos){return null}return new t(n.pos,i.pos,o,a,this.slice,this.insert,this.structure)};t.prototype.toJSON=function e(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};if(this.slice.size){t.slice=this.slice.toJSON()}if(this.structure){t.structure=true}return t};t.fromJSON=function e(r,i){if(typeof i.from!="number"||typeof i.to!="number"||typeof i.gapFrom!="number"||typeof i.gapTo!="number"||typeof i.insert!="number"){throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON")}return new t(i.from,i.to,i.gapFrom,i.gapTo,n.Slice.fromJSON(r,i.slice),i.insert,!!i.structure)};return t}(g);g.jsonID("replaceAround",x);function _(e,t,r){var n=e.resolve(t),i=r-t,o=n.depth;while(i>0&&o>0&&n.indexAfter(o)==n.node(o).childCount){o--;i--}if(i>0){var a=n.node(o).maybeChild(n.indexAfter(o));while(i>0){if(!a||a.isLeaf){return true}a=a.firstChild;i--}}return false}function S(e,t,r){return(t==0||e.canReplace(t,e.childCount))&&(r==e.childCount||e.canReplace(0,r))}function T(e){var t=e.parent;var r=t.content.cutByIndex(e.startIndex,e.endIndex);for(var n=e.depth;;--n){var i=e.$from.node(n);var o=e.$from.index(n),a=e.$to.indexAfter(n);if(n<e.depth&&i.canReplace(o,a,r)){return n}if(n==0||i.type.spec.isolating||!S(i,o,a)){break}}}d.prototype.lift=function(e,t){var r=e.$from;var i=e.$to;var o=e.depth;var a=r.before(o+1),s=i.after(o+1);var u=a,c=s;var l=n.Fragment.empty,p=0;for(var f=o,d=false;f>t;f--){if(d||r.index(f)>0){d=true;l=n.Fragment.from(r.node(f).copy(l));p++}else{u--}}var h=n.Fragment.empty,m=0;for(var y=o,g=false;y>t;y--){if(g||i.after(y+1)<i.end(y)){g=true;h=n.Fragment.from(i.node(y).copy(h));m++}else{c++}}return this.step(new x(u,c,a,s,new n.Slice(l.append(h),p,m),l.size-p,true))};function w(e,t,r,n){if(n===void 0)n=e;var i=M(e,t);var o=i&&C(n,t);if(!o){return null}return i.map(E).concat({type:t,attrs:r}).concat(o.map(E))}function E(e){return{type:e,attrs:null}}function M(e,t){var r=e.parent;var n=e.startIndex;var i=e.endIndex;var o=r.contentMatchAt(n).findWrapping(t);if(!o){return null}var a=o.length?o[0]:t;return r.canReplaceWith(n,i,a)?o:null}function C(e,t){var r=e.parent;var n=e.startIndex;var i=e.endIndex;var o=r.child(n);var a=t.contentMatch.findWrapping(o.type);if(!a){return null}var s=a.length?a[a.length-1]:t;var u=s.contentMatch;for(var c=n;u&&c<i;c++){u=u.matchType(r.child(c).type)}if(!u||!u.validEnd){return null}return a}d.prototype.wrap=function(e,t){var r=n.Fragment.empty;for(var i=t.length-1;i>=0;i--){r=n.Fragment.from(t[i].type.create(t[i].attrs,r))}var o=e.start,a=e.end;return this.step(new x(o,a,o,a,new n.Slice(r,0,0),t.length,true))};d.prototype.setBlockType=function(e,t,r,i){var o=this;if(t===void 0)t=e;if(!r.isTextblock){throw new RangeError("Type given to setBlockType should be a textblock")}var a=this.steps.length;this.doc.nodesBetween(e,t,function(e,t){if(e.isTextblock&&!e.hasMarkup(r,i)&&I(o.doc,o.mapping.slice(a).map(t),r)){o.clearIncompatible(o.mapping.slice(a).map(t,1),r);var s=o.mapping.slice(a);var u=s.map(t,1),c=s.map(t+e.nodeSize,1);o.step(new x(u,c,u+1,c-1,new n.Slice(n.Fragment.from(r.create(i,null,e.marks)),0,0),1,true));return false}});return this};function I(e,t,r){var n=e.resolve(t),i=n.index();return n.parent.canReplaceWith(i,i+1,r)}d.prototype.setNodeMarkup=function(e,t,r,i){var o=this.doc.nodeAt(e);if(!o){throw new RangeError("No node at given position")}if(!t){t=o.type}var a=t.create(r,null,i||o.marks);if(o.isLeaf){return this.replaceWith(e,e+o.nodeSize,a)}if(!t.validContent(o.content)){throw new RangeError("Invalid content for node type "+t.name)}return this.step(new x(e,e+o.nodeSize,e+1,e+o.nodeSize-1,new n.Slice(n.Fragment.from(a),0,0),1,true))};function P(e,t,r,n){if(r===void 0)r=1;var i=e.resolve(t),o=i.depth-r;var a=n&&n[n.length-1]||i.parent;if(o<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!a.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount))){return false}for(var s=i.depth-1,u=r-2;s>o;s--,u--){var c=i.node(s),l=i.index(s);if(c.type.spec.isolating){return false}var p=c.content.cutByIndex(l,c.childCount);var f=n&&n[u]||c;if(f!=c){p=p.replaceChild(0,f.type.create(f.attrs))}if(!c.canReplace(l+1,c.childCount)||!f.type.validContent(p)){return false}}var d=i.indexAfter(o);var h=n&&n[0];return i.node(o).canReplaceWith(d,d,h?h.type:i.node(o+1).type)}d.prototype.split=function(e,t,r){if(t===void 0)t=1;var i=this.doc.resolve(e),o=n.Fragment.empty,a=n.Fragment.empty;for(var s=i.depth,u=i.depth-t,c=t-1;s>u;s--,c--){o=n.Fragment.from(i.node(s).copy(o));var l=r&&r[c];a=n.Fragment.from(l?l.type.create(l.attrs,a):i.node(s).copy(a))}return this.step(new b(e,e,new n.Slice(o.append(a),t,t),true))};function k(e,t){var r=e.resolve(t),n=r.index();return O(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function O(e,t){return e&&t&&!e.isLeaf&&e.canAppend(t)}function D(e,t,r){if(r===void 0)r=-1;var n=e.resolve(t);for(var i=n.depth;;i--){var o=void 0,a=void 0,s=n.index(i);if(i==n.depth){o=n.nodeBefore;a=n.nodeAfter}else if(r>0){o=n.node(i+1);s++;a=n.node(i).maybeChild(s)}else{o=n.node(i).maybeChild(s-1);a=n.node(i+1)}if(o&&!o.isTextblock&&O(o,a)&&n.node(i).canReplace(s,s+1)){return t}if(i==0){break}t=r<0?n.before(i):n.after(i)}}d.prototype.join=function(e,t){if(t===void 0)t=1;var r=new b(e-t,e+t,n.Slice.empty,true);return this.step(r)};function N(e,t,r){var n=e.resolve(t);if(n.parent.canReplaceWith(n.index(),n.index(),r)){return t}if(n.parentOffset==0){for(var i=n.depth-1;i>=0;i--){var o=n.index(i);if(n.node(i).canReplaceWith(o,o,r)){return n.before(i+1)}if(o>0){return null}}}if(n.parentOffset==n.parent.content.size){for(var a=n.depth-1;a>=0;a--){var s=n.indexAfter(a);if(n.node(a).canReplaceWith(s,s,r)){return n.after(a+1)}if(s<n.node(a).childCount){return null}}}}function A(e,t,r){var n=e.resolve(t);if(!r.content.size){return t}var i=r.content;for(var o=0;o<r.openStart;o++){i=i.firstChild.content}for(var a=1;a<=(r.openStart==0&&r.size?2:1);a++){for(var s=n.depth;s>=0;s--){var u=s==n.depth?0:n.pos<=(n.start(s+1)+n.end(s+1))/2?-1:1;var c=n.index(s)+(u>0?1:0);if(a==1?n.node(s).canReplace(c,c,i):n.node(s).contentMatchAt(c).findWrapping(i.firstChild.type)){return u==0?n.pos:u<0?n.before(s+1):n.after(s+1)}}}return null}function L(e,t,r){var i=[];for(var o=0;o<e.childCount;o++){var a=e.child(o);if(a.content.size){a=a.copy(L(a.content,t,a))}if(a.isInline){a=t(a,r,o)}i.push(a)}return n.Fragment.fromArray(i)}var F=function(e){function t(t,r,n){e.call(this);this.from=t;this.to=r;this.mark=n}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){var r=this;var i=t.slice(this.from,this.to),o=t.resolve(this.from);var a=o.node(o.sharedDepth(this.to));var s=new n.Slice(L(i.content,function(e,t){if(!t.type.allowsMarkType(r.mark.type)){return e}return e.mark(r.mark.addToSet(e.marks))},a),i.openStart,i.openEnd);return v.fromReplace(t,this.from,this.to,s)};t.prototype.invert=function e(){return new R(this.from,this.to,this.mark)};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);if(n.deleted&&i.deleted||n.pos>=i.pos){return null}return new t(n.pos,i.pos,this.mark)};t.prototype.merge=function e(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from){return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)}};t.prototype.toJSON=function e(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}};t.fromJSON=function e(r,n){if(typeof n.from!="number"||typeof n.to!="number"){throw new RangeError("Invalid input for AddMarkStep.fromJSON")}return new t(n.from,n.to,r.markFromJSON(n.mark))};return t}(g);g.jsonID("addMark",F);var R=function(e){function t(t,r,n){e.call(this);this.from=t;this.to=r;this.mark=n}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){var r=this;var i=t.slice(this.from,this.to);var o=new n.Slice(L(i.content,function(e){return e.mark(r.mark.removeFromSet(e.marks))}),i.openStart,i.openEnd);return v.fromReplace(t,this.from,this.to,o)};t.prototype.invert=function e(){return new F(this.from,this.to,this.mark)};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);if(n.deleted&&i.deleted||n.pos>=i.pos){return null}return new t(n.pos,i.pos,this.mark)};t.prototype.merge=function e(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from){return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)}};t.prototype.toJSON=function e(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}};t.fromJSON=function e(r,n){if(typeof n.from!="number"||typeof n.to!="number"){throw new RangeError("Invalid input for RemoveMarkStep.fromJSON")}return new t(n.from,n.to,r.markFromJSON(n.mark))};return t}(g);g.jsonID("removeMark",R);d.prototype.addMark=function(e,t,r){var n=this;var i=[],o=[],a=null,s=null;this.doc.nodesBetween(e,t,function(n,u,c){if(!n.isInline){return}var l=n.marks;if(!r.isInSet(l)&&c.type.allowsMarkType(r.type)){var p=Math.max(u,e),f=Math.min(u+n.nodeSize,t);var d=r.addToSet(l);for(var h=0;h<l.length;h++){if(!l[h].isInSet(d)){if(a&&a.to==p&&a.mark.eq(l[h])){a.to=f}else{i.push(a=new R(p,f,l[h]))}}}if(s&&s.to==p){s.to=f}else{o.push(s=new F(p,f,r))}}});i.forEach(function(e){return n.step(e)});o.forEach(function(e){return n.step(e)});return this};d.prototype.removeMark=function(e,t,r){var i=this;if(r===void 0)r=null;var o=[],a=0;this.doc.nodesBetween(e,t,function(i,s){if(!i.isInline){return}a++;var u=null;if(r instanceof n.MarkType){var c=r.isInSet(i.marks);if(c){u=[c]}}else if(r){if(r.isInSet(i.marks)){u=[r]}}else{u=i.marks}if(u&&u.length){var l=Math.min(s+i.nodeSize,t);for(var p=0;p<u.length;p++){var f=u[p],d=void 0;for(var h=0;h<o.length;h++){var m=o[h];if(m.step==a-1&&f.eq(o[h].style)){d=m}}if(d){d.to=l;d.step=a}else{o.push({style:f,from:Math.max(s,e),to:l,step:a})}}}});o.forEach(function(e){return i.step(new R(e.from,e.to,e.style))});return this};d.prototype.clearIncompatible=function(e,t,r){if(r===void 0)r=t.contentMatch;var i=this.doc.nodeAt(e);var o=[],a=e+1;for(var s=0;s<i.childCount;s++){var u=i.child(s),c=a+u.nodeSize;var l=r.matchType(u.type,u.attrs);if(!l){o.push(new b(a,c,n.Slice.empty))}else{r=l;for(var p=0;p<u.marks.length;p++){if(!t.allowsMarkType(u.marks[p].type)){this.step(new R(a,c,u.marks[p]))}}}a=c}if(!r.validEnd){var f=r.fillBefore(n.Fragment.empty,true);this.replace(a,a,new n.Slice(f,0,0))}for(var d=o.length-1;d>=0;d--){this.step(o[d])}return this};function q(e,t,r,i){if(r===void 0)r=t;if(i===void 0)i=n.Slice.empty;if(t==r&&!i.size){return null}var o=e.resolve(t),a=e.resolve(r);if(V(o,a,i)){return new b(t,r,i)}return new z(o,a,i).fit()}d.prototype.replace=function(e,t,r){if(t===void 0)t=e;if(r===void 0)r=n.Slice.empty;var i=q(this.doc,e,t,r);if(i){this.step(i)}return this};d.prototype.replaceWith=function(e,t,r){return this.replace(e,t,new n.Slice(n.Fragment.from(r),0,0))};d.prototype.delete=function(e,t){return this.replace(e,t,n.Slice.empty)};d.prototype.insert=function(e,t){return this.replaceWith(e,e,t)};function V(e,t,r){return!r.openStart&&!r.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),r.content)}var z=function e(t,r,i){this.$to=r;this.$from=t;this.unplaced=i;this.frontier=[];for(var o=0;o<=t.depth;o++){var a=t.node(o);this.frontier.push({type:a.type,match:a.contentMatchAt(t.indexAfter(o))})}this.placed=n.Fragment.empty;for(var s=t.depth;s>0;s--){this.placed=n.Fragment.from(t.node(s).copy(this.placed))}};var j={depth:{configurable:true}};j.depth.get=function(){return this.frontier.length-1};z.prototype.fit=function e(){while(this.unplaced.size){var e=this.findFittable();if(e){this.placeNodes(e)}else{this.openMore()||this.dropNode()}}var t=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth;var i=this.$from,o=t<0?this.$to:i.doc.resolve(t);if(this.close(o)){var a=this.placed,s=i.depth,u=o.depth;while(s&&u&&a.childCount==1){a=a.firstChild.content;s--;u--}var c=new n.Slice(a,s,u);if(t>-1){return new x(i.pos,t,this.$to.pos,this.$to.end(),c,r)}if(c.size||i.pos!=this.$to.pos){return new b(i.pos,o.pos,c)}}return null};z.prototype.findFittable=function e(){for(var t=1;t<=2;t++){for(var r=this.unplaced.openStart;r>=0;r--){var i=void 0,o=void 0;if(r){o=G(this.unplaced.content,r-1).firstChild;i=o.content}else{i=this.unplaced.content}var a=i.firstChild;for(var s=this.depth;s>=0;s--){var u=this.frontier[s];var c=u.type;var l=u.match;var p=void 0,f=void 0;if(t==1&&(a?l.matchType(a.type)||(f=l.fillBefore(n.Fragment.from(a),false)):c.compatibleContent(o.type))){return{sliceDepth:r,frontierDepth:s,parent:o,inject:f}}else if(t==2&&a&&(p=l.findWrapping(a.type))){return{sliceDepth:r,frontierDepth:s,parent:o,wrap:p}}if(o&&l.matchType(o.type)){break}}}}};z.prototype.openMore=function e(){var t=this.unplaced;var r=t.content;var i=t.openStart;var o=t.openEnd;var a=G(r,i);if(!a.childCount||a.firstChild.isLeaf){return false}this.unplaced=new n.Slice(r,i+1,Math.max(o,a.size+i>=r.size-o?i+1:0));return true};z.prototype.dropNode=function e(){var t=this.unplaced;var r=t.content;var i=t.openStart;var o=t.openEnd;var a=G(r,i);if(a.childCount<=1&&i>0){var s=r.size-i<=i+a.size;this.unplaced=new n.Slice(B(r,i-1,1),i-1,s?i-1:o)}else{this.unplaced=new n.Slice(B(r,i,1),i,o)}};z.prototype.placeNodes=function e(t){var r=t.sliceDepth;var i=t.frontierDepth;var o=t.parent;var a=t.inject;var s=t.wrap;while(this.depth>i){this.closeFrontierNode()}if(s){for(var u=0;u<s.length;u++){this.openFrontierNode(s[u])}}var c=this.unplaced,l=o?o.content:c.content;var p=c.openStart-r;var f=0,d=[];var h=this.frontier[i];var m=h.match;var y=h.type;if(a){for(var g=0;g<a.childCount;g++){d.push(a.child(g))}m=m.matchFragment(a)}var v=l.size+r-(c.content.size-c.openEnd);while(f<l.childCount){var b=l.child(f),x=m.matchType(b.type);if(!x){break}f++;if(f>1||p==0||b.content.size){m=x;d.push(W(b.mark(y.allowedMarks(b.marks)),f==1?p:0,f==l.childCount?v:-1))}}var _=f==l.childCount;if(!_){v=-1}if(_&&v<0&&o&&o.type==this.frontier[this.depth].type){this.closeFrontierNode()}else{this.frontier[i].match=m}for(var S=0,T=l;S<v;S++){var w=T.lastChild;this.frontier.push({type:w.type,match:w.contentMatchAt(w.childCount)});T=w.content}this.unplaced=!_?new n.Slice(B(c.content,r,f),c.openStart,c.openEnd):r==0?n.Slice.empty:new n.Slice(B(c.content,r-1,1),r-1,v<0?c.openEnd:r-1);this.placed=U(this.placed,i,n.Fragment.from(d))};z.prototype.mustMoveInline=function e(){if(!this.$to.parent.isTextblock){return-1}var t=this.frontier[this.depth],r;if(!t.type.isTextblock||!J(this.$to,this.$to.depth,t.type,t.match,false)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth){return-1}var n=this.$to;var i=n.depth;var o=this.$to.after(i);while(i>1&&o==this.$to.end(--i)){++o}return o};z.prototype.findCloseLevel=function e(t){e:for(var r=Math.min(this.depth,t.depth);r>=0;r--){var n=this.frontier[r];var i=n.match;var o=n.type;var a=J(t,r,o,i,false);if(!a){continue}for(var s=r-1;s>=0;s--){var u=this.frontier[s];var c=u.match;var l=u.type;var p=J(t,s,l,c,true);if(!p||p.childCount){continue e}}return{depth:r,fit:a}}};z.prototype.close=function e(t){var e=this.findCloseLevel(t);if(!e){return false}while(this.depth>e.depth){this.closeFrontierNode()}if(e.fit.childCount){this.placed=U(this.placed,e.depth,e.fit)}for(var r=e.depth+1;r<=t.depth;r++){var n=t.node(r),i=n.type.contentMatch.fillBefore(n.content,true,t.index(r));this.openFrontierNode(n.type,n.attrs,i)}return true};z.prototype.openFrontierNode=function e(t,r,i){var o=this.frontier[this.depth];o.match=o.match.matchType(t);this.placed=U(this.placed,this.depth,n.Fragment.from(t.create(r,i)));this.frontier.push({type:t,match:t.contentMatch})};z.prototype.closeFrontierNode=function e(){var t=this.frontier.pop();var r=t.match.fillBefore(n.Fragment.empty,true);if(r.childCount){this.placed=U(this.placed,this.frontier.length,r)}};Object.defineProperties(z.prototype,j);function B(e,t,r){if(t==0){return e.cutByIndex(r)}return e.replaceChild(0,e.firstChild.copy(B(e.firstChild.content,t-1,r)))}function U(e,t,r){if(t==0){return e.append(r)}return e.replaceChild(e.childCount-1,e.lastChild.copy(U(e.lastChild.content,t-1,r)))}function G(e,t){for(var r=0;r<t;r++){e=e.firstChild.content}return e}function W(e,t,r){if(t<=0){return e}var i=e.content;if(t>1){i=i.replaceChild(0,W(i.firstChild,t-1,i.childCount==1?r-1:0))}if(t>0){i=e.type.contentMatch.fillBefore(i).append(i);if(r<=0){i=i.append(e.type.contentMatch.matchFragment(i).fillBefore(n.Fragment.empty,true))}}return e.copy(i)}function J(e,t,r,n,i){var o=e.node(t),a=i?e.indexAfter(t):e.index(t);if(a==o.childCount&&!r.compatibleContent(o.type)){return null}var s=n.fillBefore(o.content,true,a);return s&&!H(r,o.content,a)?s:null}function H(e,t,r){for(var n=r;n<t.childCount;n++){if(!e.allowsMarks(t.child(n).marks)){return true}}return false}d.prototype.replaceRange=function(e,t,r){if(!r.size){return this.deleteRange(e,t)}var i=this.doc.resolve(e),o=this.doc.resolve(t);if(V(i,o,r)){return this.step(new b(e,t,r))}var a=Y(i,this.doc.resolve(t));if(a[a.length-1]==0){a.pop()}var s=-(i.depth+1);a.unshift(s);for(var u=i.depth,c=i.pos-1;u>0;u--,c--){var l=i.node(u).type.spec;if(l.defining||l.isolating){break}if(a.indexOf(u)>-1){s=u}else if(i.before(u)==c){a.splice(1,0,-u)}}var p=a.indexOf(s);var f=[],d=r.openStart;for(var h=r.content,m=0;;m++){var y=h.firstChild;f.push(y);if(m==r.openStart){break}h=y.content}if(d>0&&f[d-1].type.spec.defining&&i.node(p).type!=f[d-1].type){d-=1}else if(d>=2&&f[d-1].isTextblock&&f[d-2].type.spec.defining&&i.node(p).type!=f[d-2].type){d-=2}for(var g=r.openStart;g>=0;g--){var v=(g+d+1)%(r.openStart+1);var x=f[v];if(!x){continue}for(var _=0;_<a.length;_++){var S=a[(_+p)%a.length],T=true;if(S<0){T=false;S=-S}var w=i.node(S-1),E=i.index(S-1);if(w.canReplaceWith(E,E,x.type,x.marks)){return this.replace(i.before(S),T?o.after(S):t,new n.Slice($(r.content,0,r.openStart,v),v,r.openEnd))}}}var M=this.steps.length;for(var C=a.length-1;C>=0;C--){this.replace(e,t,r);if(this.steps.length>M){break}var I=a[C];if(C<0){continue}e=i.before(I);t=o.after(I)}return this};function $(e,t,r,i,o){if(t<r){var a=e.firstChild;e=e.replaceChild(0,a.copy($(a.content,t+1,r,i,a)))}if(t>i){var s=o.contentMatchAt(0);var u=s.fillBefore(e).append(e);e=u.append(s.matchFragment(u).fillBefore(n.Fragment.empty,true))}return e}d.prototype.replaceRangeWith=function(e,t,r){if(!r.isInline&&e==t&&this.doc.resolve(e).parent.content.size){var i=N(this.doc,e,r.type);if(i!=null){e=t=i}}return this.replaceRange(e,t,new n.Slice(n.Fragment.from(r),0,0))};d.prototype.deleteRange=function(e,t){var r=this.doc.resolve(e),n=this.doc.resolve(t);var i=Y(r,n);for(var o=0;o<i.length;o++){var a=i[o],s=o==i.length-1;if(s&&a==0||r.node(a).type.contentMatch.validEnd){return this.delete(r.start(a),n.end(a))}if(a>0&&(s||r.node(a-1).canReplace(r.index(a-1),n.indexAfter(a-1)))){return this.delete(r.before(a),n.after(a))}}for(var u=1;u<=r.depth&&u<=n.depth;u++){if(e-r.start(u)==r.depth-u&&t>r.end(u)&&n.end(u)-t!=n.depth-u){return this.delete(r.before(u),t)}}return this.delete(e,t)};function Y(e,t){var r=[],n=Math.min(e.depth,t.depth);for(var i=n;i>=0;i--){var o=e.start(i);if(o<e.pos-(e.depth-i)||t.end(i)>t.pos+(t.depth-i)||e.node(i).type.spec.isolating||t.node(i).type.spec.isolating){break}if(o==t.start(i)){r.push(i)}}return r}t.AddMarkStep=F;t.MapResult=c;t.Mapping=p;t.RemoveMarkStep=R;t.ReplaceAroundStep=x;t.ReplaceStep=b;t.Step=g;t.StepMap=l;t.StepResult=v;t.Transform=d;t.TransformError=f;t.canJoin=k;t.canSplit=P;t.dropPoint=A;t.findWrapping=w;t.insertPoint=N;t.joinPoint=D;t.liftTarget=T;t.replaceStep=q});define("prosemirror-transform",["prosemirror-transform/index"],function(e){return e});define("prosemirror-state/index",["require","exports","module","prosemirror-model","prosemirror-transform"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=e("prosemirror-model");var i=e("prosemirror-transform");var o=Object.create(null);var a=function e(t,r,n){this.ranges=n||[new u(t.min(r),t.max(r))];this.$anchor=t;this.$head=r};var s={anchor:{configurable:true},head:{configurable:true},from:{configurable:true},to:{configurable:true},$from:{configurable:true},$to:{configurable:true},empty:{configurable:true}};s.anchor.get=function(){return this.$anchor.pos};s.head.get=function(){return this.$head.pos};s.from.get=function(){return this.$from.pos};s.to.get=function(){return this.$to.pos};s.$from.get=function(){return this.ranges[0].$from};s.$to.get=function(){return this.ranges[0].$to};s.empty.get=function(){var e=this.ranges;for(var t=0;t<e.length;t++){if(e[t].$from.pos!=e[t].$to.pos){return false}}return true};a.prototype.content=function e(){return this.$from.node(0).slice(this.from,this.to,true)};a.prototype.replace=function e(t,r){if(r===void 0)r=n.Slice.empty;var i=r.content.lastChild,o=null;for(var a=0;a<r.openEnd;a++){o=i;i=i.lastChild}var s=t.steps.length,u=this.ranges;for(var c=0;c<u.length;c++){var l=u[c];var p=l.$from;var f=l.$to;var d=t.mapping.slice(s);t.replaceRange(d.map(p.pos),d.map(f.pos),c?n.Slice.empty:r);if(c==0){y(t,s,(i?i.isInline:o&&o.isTextblock)?-1:1)}}};a.prototype.replaceWith=function e(t,r){var n=t.steps.length,i=this.ranges;for(var o=0;o<i.length;o++){var a=i[o];var s=a.$from;var u=a.$to;var c=t.mapping.slice(n);var l=c.map(s.pos),p=c.map(u.pos);if(o){t.deleteRange(l,p)}else{t.replaceRangeWith(l,p,r);y(t,n,r.isInline?-1:1)}}};a.findFrom=function e(t,r,n){var i=t.parent.inlineContent?new c(t):m(t.node(0),t.parent,t.pos,t.index(),r,n);if(i){return i}for(var o=t.depth-1;o>=0;o--){var a=r<0?m(t.node(0),t.node(o),t.before(o+1),t.index(o),r,n):m(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,r,n);if(a){return a}}};a.near=function e(t,r){if(r===void 0)r=1;return this.findFrom(t,r)||this.findFrom(t,-r)||new d(t.node(0))};a.atStart=function e(t){return m(t,t,0,0,1)||new d(t)};a.atEnd=function e(t){return m(t,t,t.content.size,t.childCount,-1)||new d(t)};a.fromJSON=function e(t,r){if(!r||!r.type){throw new RangeError("Invalid input for Selection.fromJSON")}var n=o[r.type];if(!n){throw new RangeError("No selection type "+r.type+" defined")}return n.fromJSON(t,r)};a.jsonID=function e(t,r){if(t in o){throw new RangeError("Duplicate use of selection JSON ID "+t)}o[t]=r;r.prototype.jsonID=t;return r};a.prototype.getBookmark=function e(){return c.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(a.prototype,s);a.prototype.visible=true;var u=function e(t,r){this.$from=t;this.$to=r};var c=function(e){function t(t,r){if(r===void 0)r=t;e.call(this,t,r)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={$cursor:{configurable:true}};r.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null};t.prototype.map=function r(n,i){var o=n.resolve(i.map(this.head));if(!o.parent.inlineContent){return e.near(o)}var a=n.resolve(i.map(this.anchor));return new t(a.parent.inlineContent?a:o,o)};t.prototype.replace=function t(r,i){if(i===void 0)i=n.Slice.empty;e.prototype.replace.call(this,r,i);if(i==n.Slice.empty){var o=this.$from.marksAcross(this.$to);if(o){r.ensureMarks(o)}}};t.prototype.eq=function e(r){return r instanceof t&&r.anchor==this.anchor&&r.head==this.head};t.prototype.getBookmark=function e(){return new l(this.anchor,this.head)};t.prototype.toJSON=function e(){return{type:"text",anchor:this.anchor,head:this.head}};t.fromJSON=function e(r,n){if(typeof n.anchor!="number"||typeof n.head!="number"){throw new RangeError("Invalid input for TextSelection.fromJSON")}return new t(r.resolve(n.anchor),r.resolve(n.head))};t.create=function e(t,r,n){if(n===void 0)n=r;var i=t.resolve(r);return new this(i,n==r?i:t.resolve(n))};t.between=function r(n,i,o){var a=n.pos-i.pos;if(!o||a){o=a>=0?1:-1}if(!i.parent.inlineContent){var s=e.findFrom(i,o,true)||e.findFrom(i,-o,true);if(s){i=s.$head}else{return e.near(i,o)}}if(!n.parent.inlineContent){if(a==0){n=i}else{n=(e.findFrom(n,-o,true)||e.findFrom(n,o,true)).$anchor;if(n.pos<i.pos!=a<0){n=i}}}return new t(n,i)};Object.defineProperties(t.prototype,r);return t}(a);a.jsonID("text",c);var l=function e(t,r){this.anchor=t;this.head=r};l.prototype.map=function e(t){return new l(t.map(this.anchor),t.map(this.head))};l.prototype.resolve=function e(t){return c.between(t.resolve(this.anchor),t.resolve(this.head))};var p=function(e){function t(t){var r=t.nodeAfter;var n=t.node(0).resolve(t.pos+r.nodeSize);e.call(this,t,n);this.node=r}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.map=function r(n,i){var o=i.mapResult(this.anchor);var a=o.deleted;var s=o.pos;var u=n.resolve(s);if(a){return e.near(u)}return new t(u)};t.prototype.content=function e(){return new n.Slice(n.Fragment.from(this.node),0,0)};t.prototype.eq=function e(r){return r instanceof t&&r.anchor==this.anchor};t.prototype.toJSON=function e(){return{type:"node",anchor:this.anchor}};t.prototype.getBookmark=function e(){return new f(this.anchor)};t.fromJSON=function e(r,n){if(typeof n.anchor!="number"){throw new RangeError("Invalid input for NodeSelection.fromJSON")}return new t(r.resolve(n.anchor))};t.create=function e(t,r){return new this(t.resolve(r))};t.isSelectable=function e(t){return!t.isText&&t.type.spec.selectable!==false};return t}(a);p.prototype.visible=false;a.jsonID("node",p);var f=function e(t){this.anchor=t};f.prototype.map=function e(t){var r=t.mapResult(this.anchor);var n=r.deleted;var i=r.pos;return n?new l(i,i):new f(i)};f.prototype.resolve=function e(t){var r=t.resolve(this.anchor),n=r.nodeAfter;if(n&&p.isSelectable(n)){return new p(r)}return a.near(r)};var d=function(e){function t(t){e.call(this,t.resolve(0),t.resolve(t.content.size))}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.replace=function t(r,i){if(i===void 0)i=n.Slice.empty;if(i==n.Slice.empty){r.delete(0,r.doc.content.size);var o=e.atStart(r.doc);if(!o.eq(r.selection)){r.setSelection(o)}}else{e.prototype.replace.call(this,r,i)}};t.prototype.toJSON=function e(){return{type:"all"}};t.fromJSON=function e(r){return new t(r)};t.prototype.map=function e(r){return new t(r)};t.prototype.eq=function e(r){return r instanceof t};t.prototype.getBookmark=function e(){return h};return t}(a);a.jsonID("all",d);var h={map:function e(){return this},resolve:function e(t){return new d(t)}};function m(e,t,r,n,i,o){if(t.inlineContent){return c.create(e,r)}for(var a=n-(i>0?0:1);i>0?a<t.childCount:a>=0;a+=i){var s=t.child(a);if(!s.isAtom){var u=m(e,s,r+i,i<0?s.childCount:0,i,o);if(u){return u}}else if(!o&&p.isSelectable(s)){return p.create(e,r-(i<0?s.nodeSize:0))}r+=s.nodeSize*i}}function y(e,t,r){var n=e.steps.length-1;if(n<t){return}var o=e.steps[n];if(!(o instanceof i.ReplaceStep||o instanceof i.ReplaceAroundStep)){return}var s=e.mapping.maps[n],u;s.forEach(function(e,t,r,n){if(u==null){u=n}});e.setSelection(a.near(e.doc.resolve(u),r))}var g=1,v=2,b=4;var x=function(e){function t(t){e.call(this,t.doc);this.time=Date.now();this.curSelection=t.selection;this.curSelectionFor=0;this.storedMarks=t.storedMarks;this.updated=0;this.meta=Object.create(null)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={selection:{configurable:true},selectionSet:{configurable:true},storedMarksSet:{configurable:true},isGeneric:{configurable:true},scrolledIntoView:{configurable:true}};r.selection.get=function(){if(this.curSelectionFor<this.steps.length){this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor));this.curSelectionFor=this.steps.length}return this.curSelection};t.prototype.setSelection=function e(t){if(t.$from.doc!=this.doc){throw new RangeError("Selection passed to setSelection must point at the current document")}this.curSelection=t;this.curSelectionFor=this.steps.length;this.updated=(this.updated|g)&~v;this.storedMarks=null;return this};r.selectionSet.get=function(){return(this.updated&g)>0};t.prototype.setStoredMarks=function e(t){this.storedMarks=t;this.updated|=v;return this};t.prototype.ensureMarks=function e(t){if(!n.Mark.sameSet(this.storedMarks||this.selection.$from.marks(),t)){this.setStoredMarks(t)}return this};t.prototype.addStoredMark=function e(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))};t.prototype.removeStoredMark=function e(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))};r.storedMarksSet.get=function(){return(this.updated&v)>0};t.prototype.addStep=function t(r,n){e.prototype.addStep.call(this,r,n);this.updated=this.updated&~v;this.storedMarks=null};t.prototype.setTime=function e(t){this.time=t;return this};t.prototype.replaceSelection=function e(t){this.selection.replace(this,t);return this};t.prototype.replaceSelectionWith=function e(t,r){var i=this.selection;if(r!==false){t=t.mark(this.storedMarks||(i.empty?i.$from.marks():i.$from.marksAcross(i.$to)||n.Mark.none))}i.replaceWith(this,t);return this};t.prototype.deleteSelection=function e(){this.selection.replace(this);return this};t.prototype.insertText=function e(t,r,n){if(n===void 0)n=r;var i=this.doc.type.schema;if(r==null){if(!t){return this.deleteSelection()}return this.replaceSelectionWith(i.text(t),true)}else{if(!t){return this.deleteRange(r,n)}var o=this.storedMarks;if(!o){var s=this.doc.resolve(r);o=n==r?s.marks():s.marksAcross(this.doc.resolve(n))}this.replaceRangeWith(r,n,i.text(t,o));if(!this.selection.empty){this.setSelection(a.near(this.selection.$to))}return this}};t.prototype.setMeta=function e(t,r){this.meta[typeof t=="string"?t:t.key]=r;return this};t.prototype.getMeta=function e(t){return this.meta[typeof t=="string"?t:t.key]};r.isGeneric.get=function(){for(var e in this.meta){return false}return true};t.prototype.scrollIntoView=function e(){this.updated|=b;return this};r.scrolledIntoView.get=function(){return(this.updated&b)>0};Object.defineProperties(t.prototype,r);return t}(i.Transform);function _(e,t){return!t||!e?e:e.bind(t)}var S=function e(t,r,n){this.name=t;this.init=_(r.init,n);this.apply=_(r.apply,n)};var T=[new S("doc",{init:function e(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function e(t){return t.doc}}),new S("selection",{init:function e(t,r){return t.selection||a.atStart(r.doc)},apply:function e(t){return t.selection}}),new S("storedMarks",{init:function e(t){return t.storedMarks||null},apply:function e(t,r,n,i){return i.selection.$cursor?t.storedMarks:null}}),new S("scrollToSelection",{init:function e(){return 0},apply:function e(t,r){return t.scrolledIntoView?r+1:r}})];var w=function e(t,r){var n=this;this.schema=t;this.fields=T.concat();this.plugins=[];this.pluginsByKey=Object.create(null);if(r){r.forEach(function(e){if(n.pluginsByKey[e.key]){throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")")}n.plugins.push(e);n.pluginsByKey[e.key]=e;if(e.spec.state){n.fields.push(new S(e.key,e.spec.state,e))}})}};var E=function e(t){this.config=t};var M={schema:{configurable:true},plugins:{configurable:true},tr:{configurable:true}};M.schema.get=function(){return this.config.schema};M.plugins.get=function(){return this.config.plugins};E.prototype.apply=function e(t){return this.applyTransaction(t).state};E.prototype.filterTransaction=function e(t,r){if(r===void 0)r=-1;for(var n=0;n<this.config.plugins.length;n++){if(n!=r){var i=this.config.plugins[n];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,t,this)){return false}}}return true};E.prototype.applyTransaction=function e(t){if(!this.filterTransaction(t)){return{state:this,transactions:[]}}var r=[t],n=this.applyInner(t),i=null;for(;;){var o=false;for(var a=0;a<this.config.plugins.length;a++){var s=this.config.plugins[a];if(s.spec.appendTransaction){var u=i?i[a].n:0,c=i?i[a].state:this;var l=u<r.length&&s.spec.appendTransaction.call(s,u?r.slice(u):r,c,n);if(l&&n.filterTransaction(l,a)){l.setMeta("appendedTransaction",t);if(!i){i=[];for(var p=0;p<this.config.plugins.length;p++){i.push(p<a?{state:n,n:r.length}:{state:this,n:0})}}r.push(l);n=n.applyInner(l);o=true}if(i){i[a]={state:n,n:r.length}}}}if(!o){return{state:n,transactions:r}}}};E.prototype.applyInner=function e(t){if(!t.before.eq(this.doc)){throw new RangeError("Applying a mismatched transaction")}var r=new E(this.config),n=this.config.fields;for(var i=0;i<n.length;i++){var o=n[i];r[o.name]=o.apply(t,this[o.name],this,r)}for(var a=0;a<C.length;a++){C[a](this,t,r)}return r};M.tr.get=function(){return new x(this)};E.create=function e(t){var r=new w(t.schema||t.doc.type.schema,t.plugins);var n=new E(r);for(var i=0;i<r.fields.length;i++){n[r.fields[i].name]=r.fields[i].init(t,n)}return n};E.prototype.reconfigure=function e(t){var r=new w(t.schema||this.schema,t.plugins);var n=r.fields,i=new E(r);for(var o=0;o<n.length;o++){var a=n[o].name;i[a]=this.hasOwnProperty(a)?this[a]:n[o].init(t,i)}return i};E.prototype.toJSON=function e(t){var r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks){r.storedMarks=this.storedMarks.map(function(e){return e.toJSON()})}if(t&&typeof t=="object"){for(var n in t){if(n=="doc"||n=="selection"){throw new RangeError("The JSON fields `doc` and `selection` are reserved")}var i=t[n],o=i.spec.state;if(o&&o.toJSON){r[n]=o.toJSON.call(i,this[i.key])}}}return r};E.fromJSON=function e(t,r,i){if(!r){throw new RangeError("Invalid input for EditorState.fromJSON")}if(!t.schema){throw new RangeError("Required config field 'schema' missing")}var o=new w(t.schema,t.plugins);var s=new E(o);o.fields.forEach(function(e){if(e.name=="doc"){s.doc=n.Node.fromJSON(t.schema,r.doc)}else if(e.name=="selection"){s.selection=a.fromJSON(s.doc,r.selection)}else if(e.name=="storedMarks"){if(r.storedMarks){s.storedMarks=r.storedMarks.map(t.schema.markFromJSON)}}else{if(i){for(var o in i){var u=i[o],c=u.spec.state;if(u.key==e.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(r,o)){s[e.name]=c.fromJSON.call(u,t,r[o],s);return}}}s[e.name]=e.init(t,s)}});return s};E.addApplyListener=function e(t){C.push(t)};E.removeApplyListener=function e(t){var r=C.indexOf(t);if(r>-1){C.splice(r,1)}};Object.defineProperties(E.prototype,M);var C=[];function I(e,t,r){for(var n in e){var i=e[n];if(i instanceof Function){i=i.bind(t)}else if(n=="handleDOMEvents"){i=I(i,t,{})}r[n]=i}return r}var P=function e(t){this.props={};if(t.props){I(t.props,this,this.props)}this.spec=t;this.key=t.key?t.key.key:O("plugin")};P.prototype.getState=function e(t){return t[this.key]};var k=Object.create(null);function O(e){if(e in k){return e+"$"+ ++k[e]}k[e]=0;return e+"$"}var D=function e(t){if(t===void 0)t="key";this.key=O(t)};D.prototype.get=function e(t){return t.config.pluginsByKey[this.key]};D.prototype.getState=function e(t){return t[this.key]};t.AllSelection=d;t.EditorState=E;t.NodeSelection=p;t.Plugin=P;t.PluginKey=D;t.Selection=a;t.SelectionRange=u;t.TextSelection=c;t.Transaction=x});define("prosemirror-state",["prosemirror-state/index"],function(e){return e});define("core/prosemirror/prosemirror-interpolation",["require","exports","prosemirror-model","core/computation-layer/helpers","core/computation-layer/library/builtin","prosemirror-state","./prosemirror-serialize","./mq-schema","core/lib/rich-text"],function(e,t,r,n,i,o,a,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});function c(e){var t={};e.descendants(function(e,r,n){if(e.type.name==="interp"){if(t[r]){throw new Error("Attempted to record a unique interpolation node at position "+r+" when one already exists.")}t[r]={from:r,to:r+e.nodeSize,interpExpr:e.attrs.interpExpr,block:{type:n.type.name,attrs:n.attrs},marks:e.marks}}});return t}t.createInterpMap=c;function l(e,t,r){var n={};for(var i in e){var o=e[i].interpExpr;if(!n[o]){n[o]=p(t,r,o)}}return n}t.getCLValueMap=l;function p(e,t,r){var o=e.getNodeFromVariable(t,r);if(o===undefined||o.value===undefined)return;var a=o.analysis.valueType.type;switch(a){case"string":return n.synthesizeStringForContent(o.value);case"number":return o.value.toString();case"latex":return n.synthesizeStringForContent(i.castLatexToString(o.value));default:return}}function f(e,t,n){var i={};var o=e.tr;var u=function(u){var c=o.mapping.map(t[u].from);var l=o.mapping.map(t[u].to);var p=t[u],f=p.interpExpr,d=p.block,h=p.marks;var m=n[f];if(!m){m=" "}var y=m.split("\n");var g=[];var v=0;var b=a.stringToNodes(y[0],e.schema,s.mqSchema);g.push.apply(g,b);v+=r.Fragment.fromArray(b).size;var x=void 0;if(y.length===2){x=e.schema.nodes[d.type].create();g.push(x)}else if(y.length>2){var _=y.slice(1,-1).join("\n");var S=a.stringToBlockNodes(_,e.schema,s.mqSchema,d);g.push.apply(g,S);v+=r.Fragment.fromArray(S).size}if(y.length>1){var T=a.stringToNodes(y[y.length-1],e.schema,s.mqSchema);g.push.apply(g,T);v+=r.Fragment.fromArray(T).size+2}o=o.replaceWith(c,l,g);if(x){var w=c+r.Fragment.fromArray(b).size;o=o.deleteRange(w,w+x.nodeSize)}l=c+v;h.forEach(function(e){o=o.addMark(c,l,e)});o.doc.nodesBetween(c,l,function(e,t){if(e.type.name==="mq"&&e.marks.length>0){h.forEach(function(r){o=o.removeMark(t,t+e.nodeSize,r)})}});if(y.length>1){var E=o.doc.resolve(l);o=o.replaceWith(E.before(),E.after(),e.schema.nodes[d.type].create(d.attrs,E.parent.content))}if(i[c]){throw new Error("Attempted to record a unique interpolation node at position "+c+" when one already exists.")}i[c]={from:c,to:l,interpExpr:f,block:d,marks:h}};for(var c in t){u(c)}return{newInterpMap:i,tr:o}}t.makeNewInterpolationState=f;function d(e,t,n){var i=r.Node.fromJSON(u.schemas.document.schema,e);var a=o.EditorState.create({schema:u.schemas.document.schema,doc:i});var s=c(i);var p=l(s,t,n);var d=f(a,s,p).tr;var h=a.apply(d);return h.doc.toJSON()}t.interpolateSerializedDoc=d});define("core/lib/deserialize-responses",["require","exports","tslib","underscore","core/lib/calculator-helpers"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});function o(e,t,r){if(t===null||t===undefined){return t}var n;if(typeof t=="string"){try{n=JSON.parse(t)}catch(t){throw new Error('Failed to parse response data as JSON for response key "'+e+'".')}}else{n=t}if(n.calculatorState||n.calculatorStateDiff){return a(e,n,r)}return n}t.deserializeResponse=o;var a=function(e,t,r){var o;if(r.componentExists(e)){o=e}else{var a=n.find(r.getComponentIdsForScreen(e),function(e){var t=r.getComponentAliasById(e);return t=="input/graph"||t=="marbleslides"});if(!a){throw new Error("could not find calculator state component on response "+e)}o=a}var u=r.getSourceData(o).calculatorState;if(!t.calculatorState&&!u){throw new s({id:"CalculatorStateDiffNoConfig",message:"Calculator state diff was found for componentId "+o+", but no config calculator state was found."})}var c=n.omit(t,"calculatorState");c.calculatorState=i.mergeImages(i.getRehydratedCalculatorState(u,t),u);return c};var s=function(e){r.__extends(t,e);function t(t){var r=e.call(this,t.message)||this;r.id=t.id;return r}return t}(Error)});define("core/components/transform/affine",["require","exports","tslib","underscore","core/lib/assert-unreachable"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.diff=function(e,t){var r=0;for(var n=0;n<3;n++){for(var i=0;i<3;i++){r+=Math.abs(e[n][i]-t[n][i])}}return r};t.invert=function(e){var r=t.identity();var n=e[2][2]*e[1][1]-e[2][1]*e[1][2];var i=e[2][1]*e[0][2]-e[2][2]*e[0][1];var o=e[1][2]*e[0][1]-e[1][1]*e[0][2];var a=e[0][0]*n+e[1][0]*i+e[2][0]*o;if(a===0){throw new Error("Unexpected degenerate matrix when computing inverse")}var s=1/a;r[0][0]=n*s;r[1][0]=(e[2][0]*e[1][2]-e[2][2]*e[1][0])*s;r[2][0]=(e[2][1]*e[1][0]-e[2][0]*e[1][1])*s;r[0][1]=i*s;r[1][1]=(e[2][2]*e[0][0]-e[2][0]*e[0][2])*s;r[2][1]=(e[2][0]*e[0][1]-e[2][1]*e[0][0])*s;r[0][2]=o*s;r[1][2]=(e[1][0]*e[0][2]-e[1][2]*e[0][0])*s;r[2][2]=(e[1][1]*e[0][0]-e[1][0]*e[0][1])*s;return r};t.identity=function(){return[[1,0,0],[0,1,0],[0,0,1]]};t.rotateOrigin=function(e){var t=Math.cos(e);var r=Math.sin(e);return[[t,r,0],[-r,t,0],[0,0,1]]};t.scale=function(e,t){return[[e,0,0],[0,t,0],[0,0,1]]};t.translate=function(e,t){return[[1,0,e],[0,1,t],[0,0,1]]};t.mult=function(e,r){var n=t.identity();for(var i=0;i<3;i++){for(var o=0;o<3;o++){var a=0;for(var s=0;s<3;s++){a+=e[i][s]*r[s][o]}n[i][o]=a}}return n};t.chain=function(){var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}return n.reduceRight(e,function(e,r){return t.mult(e,r)},t.identity())};t.copy=function(e){return r.__assign({},e)};t.applyToPoint=function(e,t){return{x:e[0][0]*t.x+e[0][1]*t.y+e[0][2]*1,y:e[1][0]*t.x+e[1][1]*t.y+e[1][2]*1}};t.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)};t.distance=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))};t.dot=function(e,t){return e.x*t.x+e.y*t.y};t.vec=function(e,t){return{x:t.x-e.x,y:t.y-e.y}};t.projection=function(e,r){return t.dot(r,e)/t.dot(r,r)};t.project=function(e,r){var n=t.projection(e,r);return{x:n*r.x,y:n*r.y}};t.bound=function(e,t){var r={x:e.x,y:e.y};if(r.x<t.left){r.x=t.left}if(r.x>t.left+t.width){r.x=t.left+t.width}if(r.y>t.bottom+t.height){r.y=t.bottom+t.height}if(r.y<t.bottom){r.y=t.bottom}return r};t.translateToMatrix=function(e,r){if(r===void 0){r=1}return t.translate((e.p2.x-e.p1.x)*r,(e.p2.y-e.p1.y)*r)};t.rotateToMatrix=function(e,r){if(r===void 0){r=1}return t.chain(t.translate(-e.c.x,-e.c.y),t.rotateOrigin(-e.theta*e.direction*r),t.translate(e.c.x,e.c.y))};t.scaleToMatrix=function(e,r){if(r===void 0){r=1}var n=e.factor*r+(1*1-r);return t.chain(t.translate(-e.c.x,-e.c.y),t.scale(n,n),t.translate(e.c.x,e.c.y))};t.reflectToMatrix=function(e,r){if(r===void 0){r=1}if(e.l1.x==e.l2.x&&e.l1.y==e.l2.y){return t.identity()}var n=(e.l1.x+e.l2.x)/2;var i=(e.l1.y+e.l2.y)/2;var o=e.l2.x-e.l1.x;var a=e.l2.y-e.l1.y;var s=Math.atan2(a,o);return t.chain(t.translate(-n,-i),t.rotateOrigin(s),t.scale(1,-1*r+1*(1-r)),t.rotateOrigin(-s),t.translate(n,i))};t.transformToMatrix=function(e,r){if(r===void 0){r=1}switch(e.type){case"translate":return t.translateToMatrix(e,r);case"rotate":return t.rotateToMatrix(e,r);case"scale":return t.scaleToMatrix(e,r);case"reflect":return t.reflectToMatrix(e,r);default:return i.assertUnreachable(e)}};t.transformsToMatrix=function(){var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}var n=e.map(t.transformToMatrix);return t.chain.apply(void 0,n)};t.getSegments=function(e){if(e.length<2){return[]}var t=[];for(var r=0;r<e.length;r++){var n=e[r];var i=e[(r+1)%e.length];t.push([n,i])}return t};t.segmentsIntersect=function(e,t){var r=e[0].x;var n=e[0].y;var i=e[1].x;var o=e[1].y;var a=t[0].x;var s=t[0].y;var u=t[1].x;var c=t[1].y;var l=i-r;var p=o-n;var f=u-a;var d=c-s;var h=-f*p+l*d;if(h!=0){var m=(-p*(r-a)+l*(n-s))/h;if(m>0&&m<1){var y=(f*(n-s)-d*(r-a))/h;return y>0&&y<1}return false}else{return false}};t.inside=function(e,t){return t.left<=e.x&&e.x<=t.left+t.width&&t.bottom<=e.y&&e.y<=t.bottom+t.height};t.isSeparating=function(e,t,r){var i={x:e[1].y-e[0].y,y:-(e[1].x-e[0].x)};var o=t.map(function(e){return i.x*e.x+i.y*e.y});var a=r.map(function(e){return i.x*e.x+i.y*e.y});var s=n.min(o);var u=n.max(o);var c=n.min(a);var l=n.max(a);return u-c<1e-6||l-s<1e-6};t.objectsCollide=function(e,r){return!n.any([e,r],function(i){return n.any(t.getSegments(i),function(n){return t.isSeparating(n,e,r)})})}});define("core/migrations/lib/convert-v0-transform",["require","exports","core/components/transform/affine"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.convertTransform=function(e){var t=e.t;switch(t.type){case"rotate":if(!!t.p1){var n=t.theta===0?-1:t.theta/Math.abs(t.theta);return{id:e.id,t:{type:"rotate",c:t.c,direction:n,theta:Math.abs(t.theta)}}}break;case"scale":if(!!t.p1&&!!t.p2){return{id:e.id,t:{type:"scale",c:t.c,factor:r.projection(r.vec(t.c,t.p2),r.vec(t.c,t.p1))}}}break;case"reflect":if(!!t.p1&&!!t.p2){var i=t.p1;var o=t.p2;var a=r.distance(i,o);var s=(o.x-i.x)/a;var u=(o.y-i.y)/a;var c=(o.x+i.x)/2;var l=(o.y+i.y)/2;var p=-u;var f=s;var d={x:c-p,y:l-f};var h={x:c+p,y:l+f};return{id:e.id,t:{type:"reflect",l1:d,l2:h}}}}return e}});define("core/migrations/activity-config-v1",["require","exports","tslib","./lib/convert-v0-transform","underscore"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});function o(e){var t=false;var a;for(var s=0,u=e.steps;s<u.length;s++){var c=u[s];for(var l=0,p=c.root.linearlayout.components;l<p.length;l++){var f=p[l];for(var d=0,h=f.linearlayout.components;d<h.length;d++){var m=h[d];if(m.transform||m.challenge){t=true}}}}if(t){a=e.steps.map(function(e){var t=[];for(var a=0,s=e.root.linearlayout.components;a<s.length;a++){var u=s[a];var c=[];for(var l=0,p=u.linearlayout.components;l<p.length;l++){var f=p[l];if(f.transform){c.push({transform:r.__assign(r.__assign({},f.transform),{solution:f.transform.solution.map(n.convertTransform)})})}else if(f.challenge){var d=o({steps:f.challenge.steps});c.push({challenge:r.__assign(r.__assign({},i.omit(f.challenge,"steps")),{activityConfig:d})})}else{c.push(f)}}t.push({linearlayout:{mainType:"rows",components:c}})}return r.__assign(r.__assign({},e),{root:{linearlayout:{mainType:"columns",components:t}}})})}else{a=e.steps}return r.__assign(r.__assign({},e),{version:1,steps:a})}t.migrate0To1=o;function a(e){var t=false;var n;for(var o=0,s=e.steps;o<s.length;o++){var u=s[o];for(var c=0,l=u.root.linearlayout.components;c<l.length;c++){var p=l[c];for(var f=0,d=p.linearlayout.components;f<d.length;f++){var h=d[f];if(h.challenge){t=true}}}}if(t){n=e.steps.map(function(e){var t=[];for(var n=0,o=e.root.linearlayout.components;n<o.length;n++){var s=o[n];var u=[];for(var c=0,l=s.linearlayout.components;c<l.length;c++){var p=l[c];if(p.challenge){var f=a(p.challenge.activityConfig);u.push({challenge:r.__assign(r.__assign({},i.omit(p.challenge,"activityConfig")),{steps:f.steps})})}else{u.push(p)}}t.push({linearlayout:{mainType:"rows",components:u}})}return r.__assign(r.__assign({},e),{root:{linearlayout:{mainType:"columns",components:t}}})})}else{n=e.steps}return r.__assign(r.__assign({},e),{version:0,steps:n})}t.migrate1To0=a});define("core/migrate-config",["require","exports","tslib","./migrations/activity-config-v1","./lib/assert-unreachable"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});function o(e){if(e.version&&e.version>t.latestVersion){throw new Error("Loading activity configuration with version "+e.version+" but last known version is "+t.latestVersion+".")}if(e.hasOwnProperty("version")&&(typeof e.version!=="number"||e.version<0)){throw new Error("Activity configuration has invalid version "+e.version+".\nIf a version is present, it should be a non-negative integer less than or equal to "+t.latestVersion+".")}if(e.version===1){return e}return n.migrate0To1(e)}t.migrateConfigToLatest=o;function a(e){if(e.version===undefined||e.version===0){return r.__assign(r.__assign({},e),{version:0})}else if(e.version===1){return n.migrate1To0(e)}else{return i.assertUnreachable(e.version)}}t.migrateConfigToPersisted=a;t.persistedVersion=0;t.latestVersion=1});define("core/analysis-engine/analysis-engine",["require","exports","tslib","core/components/component-helpers","core/computation-layer/class-runtime","core/lib/log","core/lib/typed-bind","core/components/index","underscore","core/computation-layer/helpers","core/lib/rich-text-helpers","core/prosemirror/prosemirror-interpolation","core/components/shared/sketch/sketch","core/components/multiple-choice/helpers","core/components/table/helpers","core/lib/deserialize-responses","core/migrate-config","core/components/cardsort/group-tools","core/lib/rich-text"],function(e,t,r,n,i,o,a,s,u,c,l,p,f,d,h,m,y,g,v){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.STUDENT_META_RESPONSE_KEY="player-api-student-meta";function b(e){switch(e){case"input/expression":return"expression-input";case"input/graph":return"graph";case"input/text":return"text-input";case"exhibit/text":return"note";case"exhibit/image":return"image";default:return e}}t.EMPTY_STUDENT_ID="empty-student-id";var x=function(){function e(e){this.private=new _(e)}e.prototype.getStudentAnalysis=function(e){if(e===void 0){e={}}return this.private.getStudentAnalysis(e)};e.version=function(){return{version:"0.8.0",commit:"bd3698272484cd41c2c432ab04c1aaccea844819"}};return e}();t.AnalysisContext=x;var _=function(){function e(e){this.inputActivityConfiguration=e;this.studentSinkValues={};this.screenOrder=[];this.screens={};this.components={};var t=y.migrateConfigToLatest(e.content);for(var r=0,o=t.steps;r<o.length;r++){var s=o[r];this.screenOrder.push(s.id);var u=[];for(var c=0,l=s.root.linearlayout.components;c<l.length;c++){var p=l[c];for(var f=0,d=p.linearlayout.components;f<d.length;f++){var h=d[f];var m=n.componentKey(h);var g=n.traverseComponentKey(h);u.push(g.id);this.components[g.id]={type:m,config:g}}}this.screens[s.id]={componentIds:u}}this.classRuntime=new i.ClassRuntime({steps:t.steps,studentIds:[],responses:{},onCLUpdated:a.bind(this.onCLUpdated,this),onUnexpectedAction:a.bind(this.onUnexpectedAction,this)})}e.prototype.getStudentAnalysis=function(e){if(e.responses){var r=e.responses[t.STUDENT_META_RESPONSE_KEY]&&JSON.parse(e.responses[t.STUDENT_META_RESPONSE_KEY]);if(r){var n=r.studentId;var i=u.uniqueId(n);this.updateStudentData({studentId:i,responseData:e.responses,randomSeed:n});return new S(this,{studentId:i,randomSeed:n})}else{throw new Error("Error: responseData was provided, but the student metadata response was not present.             Did you provide all previously exported responses?")}}else{var i=u.uniqueId(t.EMPTY_STUDENT_ID);this.updateStudentData({studentId:i,responseData:{},randomSeed:t.EMPTY_STUDENT_ID});return new S(this,{studentId:i,randomSeed:t.EMPTY_STUDENT_ID})}};e.prototype.updateStudentData=function(e){var r;var n=e.studentId,i=e.responseData,o=e.randomSeed;if(typeof i!=="object"){throw new Error("Expected responseData to be an object but saw "+typeof i+".")}var a={};for(var s in i){if(!(this.screens.hasOwnProperty(s)||this.components.hasOwnProperty(s)||s==t.STUDENT_META_RESPONSE_KEY)){throw new Error("Unexpected responseData key '"+s+"'. All response data keys must be screen or component ids for this activity.")}var u=i[s];if(typeof u!="string"){throw new Error("Expected content of key '"+s+"' to be of type string, but it was  "+typeof u)}a[s]=m.deserializeResponse(s,u,this.classRuntime.lessonQuery)}this.classRuntime.ensureRuntimeExists(n,undefined,undefined,o);var c=this.classRuntime.getDownstreamComponentIds(n,a);this.classRuntime.handleResponses((r={},r[n]=a,r));var l={};var p={};for(var f=0,d=c;f<d.length;f++){var h=d[f];if(this.classRuntime.lessonQuery.componentExists(h)){l[h]=true}else if(this.classRuntime.lessonQuery.screenExists(h)){p[h]=true}}for(var s in a){if(this.classRuntime.lessonQuery.componentExists(s)){l[s]=true}else if(this.classRuntime.lessonQuery.screenExists(s)){p[s]=true}}return{updatedComponentIds:Object.keys(l),updatedScreenIds:Object.keys(p)}};e.prototype.getCorrectness=function(e,t){var r=this.classRuntime.lessonQuery.getComponentAliasById(t);var n=this.studentSinkValues[e]&&this.studentSinkValues[e][t];var i=n&&n["correct"];var o=undefined;if(i&&i[0]){o=!!i[0].value}var a=s.nameToComponent(r);var c=this.getComponentResponse({studentId:e,componentId:t});var l=this.getComponentConfig(t);if(r==="input/expression"&&l.explainResponse&&o){return"correct"}if(r==="multiple-choice"){var p=l;var f=c;var h=!!(f&&f.selection&&u.isEqual(p.answerKey,f.selection))||o;if(d.isSimpleWithExplanation(p)&&h){return"correct"}}return a.checkCorrectness({response:c,config:l,clCorrectness:o})};e.prototype.getComponentConfig=function(e){return this.classRuntime.lessonQuery.getComponentConfigById(e)};e.prototype.getComponentResponse=function(e){var t=e.studentId,r=e.componentId;return this.classRuntime.responseForStudentAndComponent(t,r)};e.prototype.getActvityMetadata=function(){return this.inputActivityConfiguration.customMetadata};e.prototype.getScreenConfig=function(e){return this.classRuntime.lessonQuery.getStepConfig(e)};e.prototype.hasResponse=function(e){var t=this.classRuntime.lessonQuery.getComponentAliasById(e.componentId);var r=s.nameToComponent(t);var n=this.getComponentResponse({studentId:e.studentId,componentId:e.componentId});return r.hasResponse(n)};e.prototype.isExhibitMode=function(e){var t=this.classRuntime.lessonQuery.getScreenIdFromComponentId(e);return this.classRuntime.lessonQuery.getComponentIdsForScreen(t).length>1};e.prototype.getScreenIds=function(){return this.screenOrder.slice()};e.prototype.listComponentIds=function(e){return this.screens[e].componentIds};e.prototype.getComponentType=function(e){return this.components[e].type};e.prototype.listAssetUrls=function(){var e={};for(var t=0,r=Object.keys(this.components);t<r.length;t++){var n=r[t];var i=this.components[n];var o=this.getComponentAssetUrls(i.type,i.config);e[n]=o}return e};e.prototype.getComponentAssetUrls=function(e,t){return s.nameToComponent(e).getAssetUrls(t)};e.prototype.onCLUpdated=function(e,t){if(!this.studentSinkValues[e]){this.studentSinkValues[e]={}}for(var r in t){this.studentSinkValues[e][r]=t[r]}};e.prototype.onUnexpectedAction=function(e){o.warn("AnalysisEngine","Unexpected action type in class-runtime: "+e)};return e}();var S=function(){function e(e,t){var r=t.studentId,n=t.randomSeed;this.private=new T(e,r,n)}e.prototype.listScreenIds=function(){if(console&&typeof console.warn==="function"){console.warn("listScreenIds() is deprecated. Please use getScreenIds() instead.")}return this.getScreenIds()};e.prototype.getScreenIds=function(){return this.private.getScreenIds()};e.prototype.listComponentIds=function(e){return this.private.listComponentIds(e)};e.prototype.getComponentType=function(e){return this.private.getComponentType(e)};e.prototype.listAssetUrls=function(){return this.private.listAssetUrls()};e.prototype.getActivityMetadata=function(e){return this.private.getActivityMetadata(e)};e.prototype.getScreenMetadata=function(e,t){return this.private.getScreenMetadata(e,t)};e.prototype.getComponentMetadata=function(e,t){return this.private.getComponentMetadata(e,t)};e.prototype.updateStudentData=function(e){return this.private.updateStudentData(e)};e.prototype.getCorrectness=function(e){return this.private.getCorrectness(e)};e.prototype.getScreenTitle=function(e){return this.private.getScreenTitle(e)};e.prototype.getNoteState=function(e){return this.private.getNoteState(e)};e.prototype.getTextInputState=function(e){return this.private.getTextInputState(e)};e.prototype.getExpressionInputState=function(e){return this.private.getExpressionInputState(e)};e.prototype.getMultipleChoiceState=function(e){return this.private.getMultipleChoiceState(e)};e.prototype.getTableState=function(e){return this.private.getTableState(e)};e.prototype.getCardsortState=function(e){return this.private.getCardsortState(e)};e.prototype.getSketchSVG=function(e){return r.__awaiter(this,void 0,Promise,function(){return r.__generator(this,function(t){return[2,this.private.getSketchSVG(e)]})})};e.prototype.getGraphSVG=function(e){return r.__awaiter(this,void 0,Promise,function(){return r.__generator(this,function(t){return[2,this.private.getGraphSVG(e)]})})};e.prototype.hasResponse=function(e){return this.private.hasResponse(e)};e.prototype.listExportKeys=function(){return this.private.listExportKeys()};e.prototype.listImportKeys=function(){return this.private.listImportKeys()};e.prototype.setImportKeyValue=function(e,t){this.private.setImportKeyValue(e,t)};e.prototype.getExportedValue=function(e){return this.private.getExportedValue(e)};return e}();t.StudentAnalysis=S;var T=function(){function e(e,t,r){this.context=e;this.studentId=t;this.randomSeed=r}e.prototype.getScreenIds=function(){return this.context.getScreenIds()};e.prototype.getRuntime=function(){return this.context.classRuntime.getRuntime(this.studentId)};e.prototype.getCorrectness=function(e){return this.context.getCorrectness(this.studentId,e)};e.prototype.hasResponse=function(e){return this.context.hasResponse({studentId:this.studentId,componentId:e})};e.prototype.updateStudentData=function(e){return this.context.updateStudentData({studentId:this.studentId,responseData:e,randomSeed:this.randomSeed})};e.prototype.listExportKeys=function(){return c.listExportKeys(this.getRuntime())};e.prototype.listImportKeys=function(){return this.getRuntime().listImportSourceKeys()};e.prototype.setImportKeyValue=function(e,t){var r=this.context.classRuntime.getRuntime(this.studentId);r.updateImportSourceValue(e.importKey,t);r.processPendingValues()};e.prototype.listComponentIds=function(e){return this.context.listComponentIds(e)};e.prototype.listAssetUrls=function(){return this.context.listAssetUrls()};e.prototype.getComponentType=function(e){return b(this.context.getComponentType(e))};e.prototype.getActivityMetadata=function(e){var t;var r=this.context.getActvityMetadata();var n=r&&r[e];return(t=n)===null||t===void 0?void 0:t.activity};e.prototype.getScreenMetadata=function(e,t){var r=this.context.getActvityMetadata();var n=r&&r[e];return n&&n.screen&&n.screen[t]};e.prototype.getComponentMetadata=function(e,t){var r=this.context.getActvityMetadata();var n=r&&r[e];return n&&n.component&&n.component[t]};e.prototype.getExportedValue=function(e){var t=this.getRuntime().getSinks(e.componentId,e.sinkName);var r=u.find(t,function(t){return t.params[0]==e.exportKey});if(!r){return undefined}if(c.isCLStringType(r.value)){return c.synthesizeStringForContent(r.value)}return r.value};e.prototype.validateComponentType=function(e,t){var r=this.getComponentType(e);if(r!==t){throw new Error("Expected component "+e+' to have type "'+t+'", but got "'+r+'" instead.')}};e.prototype.getScreenTitle=function(e){var t=this.context.getScreenConfig(e);var r=this.getRuntime().getSinkValue(e,"title");var n=this.getRuntime().getSinkValue(e,"subtitle");var i=l.richTextFromText("document",r&&c.synthesizeStringForContent(r)||t.title||"");if(n===undefined){return{title:i}}else{return{title:i,subtitle:l.richTextFromText("document",n&&c.synthesizeStringForContent(n)||"")}}};e.prototype.getComponentState=function(e,t){var r=b(t);this.validateComponentType(e,r);var n=s.nameToComponent(t);var i=this.context.getComponentConfig(e);var o=this.context.getComponentResponse({componentId:e,studentId:this.studentId});var a=this.getRuntime().getComponentSinks(e);return n.getComponentState({config:i,sinks:a,response:o})};e.prototype.getNoteState=function(e){var t=this.getComponentState(e,"exhibit/text").content;var r=p.interpolateSerializedDoc(t,this.getRuntime(),e);return{content:{schemaKey:"document",version:v.schemas.document.version,content:r}}};e.prototype.getTextInputState=function(e){var t=this.getComponentState(e,"input/text");return{content:l.richTextFromText("document",t.content)}};e.prototype.getExpressionInputState=function(e){var t=this.getComponentState(e,"input/expression");var r=t.explainContent;return r!=undefined?{content:l.richTextFromLatex(t.content),explainContent:l.richTextFromText("document",r)}:{content:l.richTextFromLatex(t.content)}};e.prototype.getMultipleChoiceState=function(e){var t=this.getComponentState(e,"multiple-choice");var n=t.options.map(function(e){if(e.type==="text"){return{type:"text",content:l.richTextFromText("document",e.content||"")}}else{return e}});var i=t.explainContent;if(i===undefined){return r.__assign(r.__assign({},u.omit(t,"explainContent")),{options:n})}return r.__assign(r.__assign({},t),{options:n,explainContent:l.richTextFromText("document",i)})};e.prototype.getTableState=function(e){var t=this.getComponentState(e,"table");var r=t.cellContent.map(function(e){return e.map(function(e){var t={studentEditable:e.studentEditable,content:e.columnType==h.columnTypes.MATH&&e.coords.row>0?l.richTextFromLatex(e.content):l.richTextFromText("document",e.content),warning:l.richTextFromText("document",e.warning),suffixContent:l.richTextFromText("document",e.suffixContent)};if(e.numericValue){t.numericValue=e.numericValue}return t})});return{columnHeaders:t.columnHeaders,rowHeaders:t.rowHeaders,cellContent:r}};e.prototype.getCardsortState=function(e){var t=this.getComponentState(e,"cardsort");var r;if(t.answerKey){var n=g.responseToExternalGroups(t.answerKey);r=n.map(function(e){return{cardIds:e.cardIds}})}return{groups:g.responseToExternalGroups(t),answerKey:r}};e.prototype.getSketchSVG=function(e){var t=e.componentId,n=e.svgRenderer,i=e.size;return r.__awaiter(this,void 0,Promise,function(){var e,o,a,s,c,l,p,d,h,m;return r.__generator(this,function(r){switch(r.label){case 0:this.validateComponentType(t,"sketch");e=this.context.getComponentConfig(t);if(e.background&&e.background.type==="graph"){a=this.getRuntime().getSinks("thumbnail","thumbnail");s=u.find(a,function(e){return e.params[0]==t});o=s&&s.value}c=this.context.getComponentResponse({studentId:this.studentId,componentId:t});l=c&&c.sketchData;p=this.getRuntime().getSinks(t,"bounds");d=this.getRuntime().getSinks(t,"background")[0];h=f.getSketchBounds({exhibitMode:this.context.isExhibitMode(t),sketchConfig:e,bounds:p[0]&&p[0].value});return[4,n.renderSketchSVG({studentId:this.randomSeed,sketchData:l,clBackground:o?undefined:d&&d.value,backgroundCalculatorState:o,config:e,bounds:h,size:i})];case 1:m=r.sent();return[2,{svg:m}]}})})};e.prototype.getGraphSVG=function(e){var t=e.componentId,n=e.svgRenderer,i=e.size;return r.__awaiter(this,void 0,Promise,function(){var e,o,a,s,c,l;return r.__generator(this,function(r){switch(r.label){case 0:this.validateComponentType(t,"graph");e=this.context.getComponentConfig(t);if(e.copyId!=undefined){throw new Error("Copy previous is not supported in the analysis engine.")}o=this.getRuntime().getSinks("thumbnail","thumbnail");a=u.find(o,function(e){return e.params[0]==t});s=a&&a.value;c=this.getRuntime().getSinks(t,"background")[0];if(!s){throw new Error("Calculator state not found.")}return[4,n.renderGraphSVG({clCalculatorState:s,clBackground:c&&c.value,size:i})];case 1:l=r.sent();return[2,{svg:l}]}})})};return e}()});
    return requirejs('core/analysis-engine/analysis-engine');
  }).call(global);;
  return _exports;
})(typeof window !== 'undefined' ? window : this || {});
