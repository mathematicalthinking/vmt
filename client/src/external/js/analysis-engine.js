/* *** The Desmos javascript source is a commercially licensed product. If you'd like to include it in your product, please email partnerships@desmos.com *** */
;(function (global) {
  
  

  var _exports = (function () {
    var module = undefined;
    var exports = undefined;
    var requirejs,require,define;(function(e){var t,r,n,i,a={},o={},s={},u={},c=Object.prototype.hasOwnProperty,l=[].slice,p=/\.js$/;function d(e,t){return c.call(e,t)}function f(e,t){var r,n,i,a,o,u,c,l,d,f,h,y,m=t&&t.split("/"),v=s.map,g=v&&v["*"]||{};if(e){e=e.split("/");o=e.length-1;if(s.nodeIdCompat&&p.test(e[o])){e[o]=e[o].replace(p,"")}if(e[0].charAt(0)==="."&&m){y=m.slice(0,m.length-1);e=y.concat(e)}for(d=0;d<e.length;d++){h=e[d];if(h==="."){e.splice(d,1);d-=1}else if(h===".."){if(d===0||d===1&&e[2]===".."||e[d-1]===".."){continue}else if(d>0){e.splice(d-1,2);d-=2}}}e=e.join("/")}if((m||g)&&v){r=e.split("/");for(d=r.length;d>0;d-=1){n=r.slice(0,d).join("/");if(m){for(f=m.length;f>0;f-=1){i=v[m.slice(0,f).join("/")];if(i){i=i[n];if(i){a=i;u=d;break}}}}if(a){break}if(!c&&g&&g[n]){c=g[n];l=d}}if(!a&&c){a=c;u=l}if(a){r.splice(0,u,a);e=r.join("/")}}return e}function h(t,n){return function(){var i=l.call(arguments,0);if(typeof i[0]!=="string"&&i.length===1){i.push(null)}return r.apply(e,i.concat([t,n]))}}function y(e){return function(t){return f(t,e)}}function m(e){return function(t){a[e]=t}}function v(r){if(d(o,r)){var n=o[r];delete o[r];u[r]=true;t.apply(e,n)}if(!d(a,r)&&!d(u,r)){throw new Error("No "+r)}return a[r]}function g(e){var t,r=e?e.indexOf("!"):-1;if(r>-1){t=e.substring(0,r);e=e.substring(r+1,e.length)}return[t,e]}function b(e){return e?g(e):[]}n=function(e,t){var r,n=g(e),i=n[0],a=t[1];e=n[1];if(i){i=f(i,a);r=v(i)}if(i){if(r&&r.normalize){e=r.normalize(e,y(a))}else{e=f(e,a)}}else{e=f(e,a);n=g(e);i=n[0];e=n[1];if(i){r=v(i)}}return{f:i?i+"!"+e:e,n:e,pr:i,p:r}};function x(e){return function(){return s&&s.config&&s.config[e]||{}}}i={require:function(e){return h(e)},exports:function(e){var t=a[e];if(typeof t!=="undefined"){return t}else{return a[e]={}}},module:function(e){return{id:e,uri:"",exports:a[e],config:x(e)}}};t=function(t,r,s,c){var l,p,f,y,g,x,S=[],T=typeof s,w;c=c||t;x=b(c);if(T==="undefined"||T==="function"){r=!r.length&&s.length?["require","exports","module"]:r;for(g=0;g<r.length;g+=1){y=n(r[g],x);p=y.f;if(p==="require"){S[g]=i.require(t)}else if(p==="exports"){S[g]=i.exports(t);w=true}else if(p==="module"){l=S[g]=i.module(t)}else if(d(a,p)||d(o,p)||d(u,p)){S[g]=v(p)}else if(y.p){y.p.load(y.n,h(c,true),m(p),{});S[g]=a[p]}else{throw new Error(t+" missing "+p)}}f=s?s.apply(a[t],S):undefined;if(t){if(l&&l.exports!==e&&l.exports!==a[t]){a[t]=l.exports}else if(f!==e||!w){a[t]=f}}}else if(t){a[t]=s}};requirejs=require=r=function(a,o,u,c,l){if(typeof a==="string"){if(i[a]){return i[a](o)}return v(n(a,b(o)).f)}else if(!a.splice){s=a;if(s.deps){r(s.deps,s.callback)}if(!o){return}if(o.splice){a=o;o=u;u=null}else{a=e}}o=o||function(){};if(typeof u==="function"){u=c;c=l}if(c){t(e,a,o,u)}else{setTimeout(function(){t(e,a,o,u)},4)}return r};r.config=function(e){return r(e)};requirejs._defined=a;define=function(e,t,r){if(typeof e!=="string"){throw new Error("See almond README: incorrect module build, no module name")}if(!t.splice){r=t;t=[]}if(!d(a,e)&&!d(o,e)){o[e]=[e,t,r]}};define.amd={jQuery:true}})();define("../vendor/almondv0.3.3",function(){});var __extends;var __assign;var __rest;var __decorate;var __param;var __metadata;var __awaiter;var __generator;var __exportStar;var __values;var __read;var __spread;var __spreadArrays;var __await;var __asyncGenerator;var __asyncDelegator;var __asyncValues;var __makeTemplateObject;var __importStar;var __importDefault;(function(e){var t=typeof global==="object"?global:typeof self==="object"?self:typeof this==="object"?this:{};if(typeof define==="function"&&define.amd){define("tslib",["exports"],function(n){e(r(t,r(n)))})}else if(typeof module==="object"&&typeof module.exports==="object"){e(r(t,r(module.exports)))}else{e(r(t))}function r(e,r){if(e!==t){if(typeof Object.create==="function"){Object.defineProperty(e,"__esModule",{value:true})}else{e.__esModule=true}}return function(t,n){return e[t]=r?r(t,n):n}}})(function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};__extends=function(e,r){t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)};__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]}return e};__rest=function(e,t){var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0)r[n]=e[n];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++){if(t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i]))r[n[i]]=e[n[i]]}return r};__decorate=function(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)if(o=e[s])a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a;return i>3&&a&&Object.defineProperty(t,r,a),a};__param=function(e,t){return function(r,n){t(r,n,e)}};__metadata=function(e,t){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(e,t)};__awaiter=function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n["throw"](e))}catch(e){a(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(o,s)}u((n=n.apply(e,t||[])).next())})};__generator=function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return u([e,t])}}function u(o){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,i&&(a=o[0]&2?i["return"]:o[0]?i["throw"]||((a=i["return"])&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;if(i=0,a)o=[o[0]&2,a.value];switch(o[0]){case 0:case 1:a=o;break;case 4:r.label++;return{value:o[1],done:false};case 5:r.label++;i=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(a=r.trys,a=a.length>0&&a[a.length-1])&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(o[0]===6&&r.label<a[1]){r.label=a[1];a=o;break}if(a&&r.label<a[2]){r.label=a[2];r.ops.push(o);break}if(a[2])r.ops.pop();r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e];i=0}finally{n=a=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};__exportStar=function(e,t){for(var r in e)if(!t.hasOwnProperty(r))t[r]=e[r]};__values=function(e){var t=typeof Symbol==="function"&&e[Symbol.iterator],r=0;if(t)return t.call(e);return{next:function(){if(e&&r>=e.length)e=void 0;return{value:e&&e[r++],done:!e}}}};__read=function(e,t){var r=typeof Symbol==="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],o;try{while((t===void 0||t-- >0)&&!(i=n.next()).done)a.push(i.value)}catch(e){o={error:e}}finally{try{if(i&&!i.done&&(r=n["return"]))r.call(n)}finally{if(o)throw o.error}}return a};__spread=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e};__spreadArrays=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)n[i]=a[o];return n};__await=function(e){return this instanceof __await?(this.v=e,this):new __await(e)};__asyncGenerator=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,a=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(e){if(n[e])i[e]=function(t){return new Promise(function(r,n){a.push([e,t,r,n])>1||s(e,t)})}}function s(e,t){try{u(n[e](t))}catch(e){p(a[0][3],e)}}function u(e){e.value instanceof __await?Promise.resolve(e.value.v).then(c,l):p(a[0][2],e)}function c(e){s("next",e)}function l(e){s("throw",e)}function p(e,t){if(e(t),a.shift(),a.length)s(a[0][0],a[0][1])}};__asyncDelegator=function(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:__await(e[n](t)),done:n==="return"}:i?i(t):t}:i}};__asyncValues=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof __values==="function"?__values(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(t){r[t]=e[t]&&function(r){return new Promise(function(n,a){r=e[t](r),i(n,a,r.done,r.value)})}}function i(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)}};__makeTemplateObject=function(e,t){if(Object.defineProperty){Object.defineProperty(e,"raw",{value:t})}else{e.raw=t}return e};__importStar=function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(Object.hasOwnProperty.call(e,r))t[r]=e[r];t["default"]=e;return t};__importDefault=function(e){return e&&e.__esModule?e:{default:e}};e("__extends",__extends);e("__assign",__assign);e("__rest",__rest);e("__decorate",__decorate);e("__param",__param);e("__metadata",__metadata);e("__awaiter",__awaiter);e("__generator",__generator);e("__exportStar",__exportStar);e("__values",__values);e("__read",__read);e("__spread",__spread);e("__spreadArrays",__spreadArrays);e("__await",__await);e("__asyncGenerator",__asyncGenerator);e("__asyncDelegator",__asyncDelegator);e("__asyncValues",__asyncValues);e("__makeTemplateObject",__makeTemplateObject);e("__importStar",__importStar);e("__importDefault",__importDefault)});define("core/lib/uuid",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.uuid=void 0;function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0;var r=e==="x"?t:t&3|8;return r.toString(16)})}t.uuid=r});define("core/computation-layer/helpers",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.isCLLatexType=t.isCLStringType=t.synthesizeStringInternal=t.synthesizeStringForContent=t.listExportKeys=void 0;function r(e){var t=[];var r=e.sinks;for(var n in r){var i=r[n];for(var a=0,o=["exportString","exportNumber","exportNumberList"];a<o.length;a++){var s=o[a];if(i[s]){for(var u=0,c=i[s];u<c.length;u++){var l=c[u];t.push({componentId:n,exportKey:l.params[0],sinkName:s})}}}}return t}t.listExportKeys=r;var n=new WeakMap;function i(e){var t=n.get(e);if(t!=undefined){return t}var r="";var i=0;for(var a=0;a<e.parts.length;a+=1){var o=e.parts[a];if(o==undefined||typeof o=="number"&&isNaN(o)){r+="undefined"}else if(u(o)){if(i%2==1){r+=o.latex}else{r+="`"+o.latex+"`";i+=2}}else{var s=o.toString();for(var c=0,l=s;c<l.length;c++){var p=l[c];if(p=="`"){i+=1}}r+=s}}n.set(e,r);return r}t.synthesizeStringForContent=i;var a=new WeakMap;function o(e){var t=a.get(e);if(t!=undefined){return t}var r="";for(var n=0,i=e.parts;n<i.length;n++){var o=i[n];if(u(o)){r+=o.latex}else if(o==undefined&&typeof o=="number"&&isNaN(o)){r+="undefined"}else{r+=o}}a.set(e,r);return r}t.synthesizeStringInternal=o;function s(e){if(e==undefined){return false}return e.type=="string"}t.isCLStringType=s;function u(e){if(e==undefined){return false}return e.latex!=undefined}t.isCLLatexType=u});define("core/components/action-button/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(){return false},getAssetUrls:function(){return[]},rewriteAssetUrls:function(e){return e}}});(function(){var e=typeof self==="object"&&self.self===self&&self||typeof global==="object"&&global.global===global&&global||this;var t=e._;var r=Array.prototype,n=Object.prototype;var i=r.push,a=r.slice,o=n.toString,s=n.hasOwnProperty;var u=Array.isArray,c=Object.keys,l=Object.create;var p=function(){};var d=function(e){if(e instanceof d)return e;if(!(this instanceof d))return new d(e);this._wrapped=e};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=d}exports._=d}else{}d.VERSION="1.8.3";var f=function(e,t,r){if(t===void 0)return e;switch(r==null?3:r){case 1:return function(r){return e.call(t,r)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,a){return e.call(t,r,n,i,a)}}return function(){return e.apply(t,arguments)}};var h=function(e,t,r){if(e==null)return d.identity;if(d.isFunction(e))return f(e,t,r);if(d.isObject(e))return d.matcher(e);return d.property(e)};d.iteratee=function(e,t){return h(e,t,Infinity)};var y=function(e,t){t=t==null?e.length-1:+t;return function(){var r=Math.max(arguments.length-t,0);var n=Array(r);for(var i=0;i<r;i++){n[i]=arguments[i+t]}switch(t){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}var a=Array(t+1);for(i=0;i<t;i++){a[i]=arguments[i]}a[t]=n;return e.apply(this,a)}};var m=function(e){if(!d.isObject(e))return{};if(l)return l(e);p.prototype=e;var t=new p;p.prototype=null;return t};var v=function(e){return function(t){return t==null?void 0:t[e]}};var g=Math.pow(2,53)-1;var b=v("length");var x=function(e){var t=b(e);return typeof t=="number"&&t>=0&&t<=g};d.each=d.forEach=function(e,t,r){t=f(t,r);var n,i;if(x(e)){for(n=0,i=e.length;n<i;n++){t(e[n],n,e)}}else{var a=d.keys(e);for(n=0,i=a.length;n<i;n++){t(e[a[n]],a[n],e)}}return e};d.map=d.collect=function(e,t,r){t=h(t,r);var n=!x(e)&&d.keys(e),i=(n||e).length,a=Array(i);for(var o=0;o<i;o++){var s=n?n[o]:o;a[o]=t(e[s],s,e)}return a};var S=function(e){var t=function(t,r,n,i){var a=!x(t)&&d.keys(t),o=(a||t).length,s=e>0?0:o-1;if(!i){n=t[a?a[s]:s];s+=e}for(;s>=0&&s<o;s+=e){var u=a?a[s]:s;n=r(n,t[u],u,t)}return n};return function(e,r,n,i){var a=arguments.length>=3;return t(e,f(r,i,4),n,a)}};d.reduce=d.foldl=d.inject=S(1);d.reduceRight=d.foldr=S(-1);d.find=d.detect=function(e,t,r){var n;if(x(e)){n=d.findIndex(e,t,r)}else{n=d.findKey(e,t,r)}if(n!==void 0&&n!==-1)return e[n]};d.filter=d.select=function(e,t,r){var n=[];t=h(t,r);d.each(e,function(e,r,i){if(t(e,r,i))n.push(e)});return n};d.reject=function(e,t,r){return d.filter(e,d.negate(h(t)),r)};d.every=d.all=function(e,t,r){t=h(t,r);var n=!x(e)&&d.keys(e),i=(n||e).length;for(var a=0;a<i;a++){var o=n?n[a]:a;if(!t(e[o],o,e))return false}return true};d.some=d.any=function(e,t,r){t=h(t,r);var n=!x(e)&&d.keys(e),i=(n||e).length;for(var a=0;a<i;a++){var o=n?n[a]:a;if(t(e[o],o,e))return true}return false};d.contains=d.includes=d.include=function(e,t,r,n){if(!x(e))e=d.values(e);if(typeof r!="number"||n)r=0;return d.indexOf(e,t,r)>=0};d.invoke=y(function(e,t,r){var n=d.isFunction(t);return d.map(e,function(e){var i=n?t:e[t];return i==null?i:i.apply(e,r)})});d.pluck=function(e,t){return d.map(e,d.property(t))};d.where=function(e,t){return d.filter(e,d.matcher(t))};d.findWhere=function(e,t){return d.find(e,d.matcher(t))};d.max=function(e,t,r){var n=-Infinity,i=-Infinity,a,o;if(t==null||typeof t=="number"&&typeof e[0]!="object"&&e!=null){e=x(e)?e:d.values(e);for(var s=0,u=e.length;s<u;s++){a=e[s];if(a>n){n=a}}}else{t=h(t,r);d.each(e,function(e,r,a){o=t(e,r,a);if(o>i||o===-Infinity&&n===-Infinity){n=e;i=o}})}return n};d.min=function(e,t,r){var n=Infinity,i=Infinity,a,o;if(t==null||typeof t=="number"&&typeof e[0]!="object"&&e!=null){e=x(e)?e:d.values(e);for(var s=0,u=e.length;s<u;s++){a=e[s];if(a<n){n=a}}}else{t=h(t,r);d.each(e,function(e,r,a){o=t(e,r,a);if(o<i||o===Infinity&&n===Infinity){n=e;i=o}})}return n};d.shuffle=function(e){return d.sample(e,Infinity)};d.sample=function(e,t,r){if(t==null||r){if(!x(e))e=d.values(e);return e[d.random(e.length-1)]}var n=x(e)?d.clone(e):d.values(e);var i=b(n);t=Math.max(Math.min(t,i),0);var a=i-1;for(var o=0;o<t;o++){var s=d.random(o,a);var u=n[o];n[o]=n[s];n[s]=u}return n.slice(0,t)};d.sortBy=function(e,t,r){t=h(t,r);return d.pluck(d.map(e,function(e,r,n){return{value:e,index:r,criteria:t(e,r,n)}}).sort(function(e,t){var r=e.criteria;var n=t.criteria;if(r!==n){if(r>n||r===void 0)return 1;if(r<n||n===void 0)return-1}return e.index-t.index}),"value")};var T=function(e,t){return function(r,n,i){var a=t?[[],[]]:{};n=h(n,i);d.each(r,function(t,i){var o=n(t,i,r);e(a,t,o)});return a}};d.groupBy=T(function(e,t,r){if(d.has(e,r))e[r].push(t);else e[r]=[t]});d.indexBy=T(function(e,t,r){e[r]=t});d.countBy=T(function(e,t,r){if(d.has(e,r))e[r]++;else e[r]=1});d.toArray=function(e){if(!e)return[];if(d.isArray(e))return a.call(e);if(x(e))return d.map(e,d.identity);return d.values(e)};d.size=function(e){if(e==null)return 0;return x(e)?e.length:d.keys(e).length};d.partition=T(function(e,t,r){e[r?0:1].push(t)},true);d.first=d.head=d.take=function(e,t,r){if(e==null)return void 0;if(t==null||r)return e[0];return d.initial(e,e.length-t)};d.initial=function(e,t,r){return a.call(e,0,Math.max(0,e.length-(t==null||r?1:t)))};d.last=function(e,t,r){if(e==null)return void 0;if(t==null||r)return e[e.length-1];return d.rest(e,Math.max(0,e.length-t))};d.rest=d.tail=d.drop=function(e,t,r){return a.call(e,t==null||r?1:t)};d.compact=function(e){return d.filter(e,d.identity)};var w=function(e,t,r,n){n=n||[];var i=n.length;for(var a=0,o=b(e);a<o;a++){var s=e[a];if(x(s)&&(d.isArray(s)||d.isArguments(s))){if(t){var u=0,c=s.length;while(u<c)n[i++]=s[u++]}else{w(s,t,r,n);i=n.length}}else if(!r){n[i++]=s}}return n};d.flatten=function(e,t){return w(e,t,false)};d.without=y(function(e,t){return d.difference(e,t)});d.uniq=d.unique=function(e,t,r,n){if(!d.isBoolean(t)){n=r;r=t;t=false}if(r!=null)r=h(r,n);var i=[];var a=[];for(var o=0,s=b(e);o<s;o++){var u=e[o],c=r?r(u,o,e):u;if(t){if(!o||a!==c)i.push(u);a=c}else if(r){if(!d.contains(a,c)){a.push(c);i.push(u)}}else if(!d.contains(i,u)){i.push(u)}}return i};d.union=y(function(e){return d.uniq(w(e,true,true))});d.intersection=function(e){var t=[];var r=arguments.length;for(var n=0,i=b(e);n<i;n++){var a=e[n];if(d.contains(t,a))continue;var o;for(o=1;o<r;o++){if(!d.contains(arguments[o],a))break}if(o===r)t.push(a)}return t};d.difference=y(function(e,t){t=w(t,true,true);return d.filter(e,function(e){return!d.contains(t,e)})});d.unzip=function(e){var t=e&&d.max(e,b).length||0;var r=Array(t);for(var n=0;n<t;n++){r[n]=d.pluck(e,n)}return r};d.zip=y(d.unzip);d.object=function(e,t){var r={};for(var n=0,i=b(e);n<i;n++){if(t){r[e[n]]=t[n]}else{r[e[n][0]]=e[n][1]}}return r};var _=function(e){return function(t,r,n){r=h(r,n);var i=b(t);var a=e>0?0:i-1;for(;a>=0&&a<i;a+=e){if(r(t[a],a,t))return a}return-1}};d.findIndex=_(1);d.findLastIndex=_(-1);d.sortedIndex=function(e,t,r,n){r=h(r,n,1);var i=r(t);var a=0,o=b(e);while(a<o){var s=Math.floor((a+o)/2);if(r(e[s])<i)a=s+1;else o=s}return a};var I=function(e,t,r){return function(n,i,o){var s=0,u=b(n);if(typeof o=="number"){if(e>0){s=o>=0?o:Math.max(o+u,s)}else{u=o>=0?Math.min(o+1,u):o+u+1}}else if(r&&o&&u){o=r(n,i);return n[o]===i?o:-1}if(i!==i){o=t(a.call(n,s,u),d.isNaN);return o>=0?o+s:-1}for(o=e>0?s:u-1;o>=0&&o<u;o+=e){if(n[o]===i)return o}return-1}};d.indexOf=I(1,d.findIndex,d.sortedIndex);d.lastIndexOf=I(-1,d.findLastIndex);d.range=function(e,t,r){if(t==null){t=e||0;e=0}r=r||1;var n=Math.max(Math.ceil((t-e)/r),0);var i=Array(n);for(var a=0;a<n;a++,e+=r){i[a]=e}return i};var E=function(e,t,r,n,i){if(!(n instanceof t))return e.apply(r,i);var a=m(e.prototype);var o=e.apply(a,i);if(d.isObject(o))return o;return a};d.bind=y(function(e,t,r){if(!d.isFunction(e))throw new TypeError("Bind must be called on a function");var n=y(function(i){return E(e,n,t,this,r.concat(i))});return n});d.partial=y(function(e,t){var r=d.partial.placeholder;var n=function(){var i=0,a=t.length;var o=Array(a);for(var s=0;s<a;s++){o[s]=t[s]===r?arguments[i++]:t[s]}while(i<arguments.length)o.push(arguments[i++]);return E(e,n,this,this,o)};return n});d.partial.placeholder=d;d.bindAll=y(function(e,t){t=w(t,false,false);var r=t.length;if(r<1)throw new Error("bindAll must be passed function names");while(r--){var n=t[r];e[n]=d.bind(e[n],e)}});d.memoize=function(e,t){var r=function(n){var i=r.cache;var a=""+(t?t.apply(this,arguments):n);if(!d.has(i,a))i[a]=e.apply(this,arguments);return i[a]};r.cache={};return r};d.delay=y(function(e,t,r){return setTimeout(function(){return e.apply(null,r)},t)});d.defer=d.partial(d.delay,d,1);d.throttle=function(e,t,r){var n,i,a;var o=null;var s=0;if(!r)r={};var u=function(){s=r.leading===false?0:d.now();o=null;a=e.apply(n,i);if(!o)n=i=null};return function(){var c=d.now();if(!s&&r.leading===false)s=c;var l=t-(c-s);n=this;i=arguments;if(l<=0||l>t){if(o){clearTimeout(o);o=null}s=c;a=e.apply(n,i);if(!o)n=i=null}else if(!o&&r.trailing!==false){o=setTimeout(u,l)}return a}};d.debounce=function(e,t,r){var n,i,a,o,s;var u=function(){var c=d.now()-o;if(c<t&&c>=0){n=setTimeout(u,t-c)}else{n=null;if(!r){s=e.apply(a,i);if(!n)a=i=null}}};return function(){a=this;i=arguments;o=d.now();var c=r&&!n;if(!n)n=setTimeout(u,t);if(c){s=e.apply(a,i);a=i=null}return s}};d.wrap=function(e,t){return d.partial(t,e)};d.negate=function(e){return function(){return!e.apply(this,arguments)}};d.compose=function(){var e=arguments;var t=e.length-1;return function(){var r=t;var n=e[t].apply(this,arguments);while(r--)n=e[r].call(this,n);return n}};d.after=function(e,t){return function(){if(--e<1){return t.apply(this,arguments)}}};d.before=function(e,t){var r;return function(){if(--e>0){r=t.apply(this,arguments)}if(e<=1)t=null;return r}};d.once=d.partial(d.before,2);d.restArgs=y;var C=!{toString:null}.propertyIsEnumerable("toString");var M=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];var k=function(e,t){var r=M.length;var i=e.constructor;var a=d.isFunction(i)&&i.prototype||n;var o="constructor";if(d.has(e,o)&&!d.contains(t,o))t.push(o);while(r--){o=M[r];if(o in e&&e[o]!==a[o]&&!d.contains(t,o)){t.push(o)}}};d.keys=function(e){if(!d.isObject(e))return[];if(c)return c(e);var t=[];for(var r in e)if(d.has(e,r))t.push(r);if(C)k(e,t);return t};d.allKeys=function(e){if(!d.isObject(e))return[];var t=[];for(var r in e)t.push(r);if(C)k(e,t);return t};d.values=function(e){var t=d.keys(e);var r=t.length;var n=Array(r);for(var i=0;i<r;i++){n[i]=e[t[i]]}return n};d.mapObject=function(e,t,r){t=h(t,r);var n=d.keys(e),i=n.length,a={};for(var o=0;o<i;o++){var s=n[o];a[s]=t(e[s],s,e)}return a};d.pairs=function(e){var t=d.keys(e);var r=t.length;var n=Array(r);for(var i=0;i<r;i++){n[i]=[t[i],e[t[i]]]}return n};d.invert=function(e){var t={};var r=d.keys(e);for(var n=0,i=r.length;n<i;n++){t[e[r[n]]]=r[n]}return t};d.functions=d.methods=function(e){var t=[];for(var r in e){if(d.isFunction(e[r]))t.push(r)}return t.sort()};var P=function(e,t){return function(r){var n=arguments.length;if(n<2||r==null)return r;for(var i=1;i<n;i++){var a=arguments[i],o=e(a),s=o.length;for(var u=0;u<s;u++){var c=o[u];if(!t||r[c]===void 0)r[c]=a[c]}}return r}};d.extend=P(d.allKeys);d.extendOwn=d.assign=P(d.keys);d.findKey=function(e,t,r){t=h(t,r);var n=d.keys(e),i;for(var a=0,o=n.length;a<o;a++){i=n[a];if(t(e[i],i,e))return i}};var O=function(e,t,r){return t in r};d.pick=y(function(e,t){var r={},n=t[0];if(e==null)return r;if(d.isFunction(n)){if(t.length>1)n=f(n,t[1]);t=d.allKeys(e)}else{n=O;t=w(t,false,false);e=Object(e)}for(var i=0,a=t.length;i<a;i++){var o=t[i];var s=e[o];if(n(s,o,e))r[o]=s}return r});d.omit=y(function(e,t){var r=t[0],n;if(d.isFunction(r)){r=d.negate(r);if(t.length>1)n=t[1]}else{t=d.map(w(t,false,false),String);r=function(e,r){return!d.contains(t,r)}}return d.pick(e,r,n)});d.defaults=P(d.allKeys,true);d.create=function(e,t){var r=m(e);if(t)d.extendOwn(r,t);return r};d.clone=function(e){if(!d.isObject(e))return e;return d.isArray(e)?e.slice():d.extend({},e)};d.tap=function(e,t){t(e);return e};d.isMatch=function(e,t){var r=d.keys(t),n=r.length;if(e==null)return!n;var i=Object(e);for(var a=0;a<n;a++){var o=r[a];if(t[o]!==i[o]||!(o in i))return false}return true};var L,N;L=function(e,t,r,n){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return e===t;if(e!==e)return t!==t;var i=typeof e;if(i!=="function"&&i!=="object"&&typeof t!=="object")return false;return N(e,t,r,n)};N=function(e,t,r,n){if(e instanceof d)e=e._wrapped;if(t instanceof d)t=t._wrapped;var i=o.call(e);if(i!==o.call(t))return false;switch(i){case"[object RegExp]":case"[object String]":return""+e===""+t;case"[object Number]":if(+e!==+e)return+t!==+t;return+e===0?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var a=i==="[object Array]";if(!a){if(typeof e!="object"||typeof t!="object")return false;var s=e.constructor,u=t.constructor;if(s!==u&&!(d.isFunction(s)&&s instanceof s&&d.isFunction(u)&&u instanceof u)&&("constructor"in e&&"constructor"in t)){return false}}r=r||[];n=n||[];var c=r.length;while(c--){if(r[c]===e)return n[c]===t}r.push(e);n.push(t);if(a){c=e.length;if(c!==t.length)return false;while(c--){if(!L(e[c],t[c],r,n))return false}}else{var l=d.keys(e),p;c=l.length;if(d.keys(t).length!==c)return false;while(c--){p=l[c];if(!(d.has(t,p)&&L(e[p],t[p],r,n)))return false}}r.pop();n.pop();return true};d.isEqual=function(e,t){return L(e,t)};d.isEmpty=function(e){if(e==null)return true;if(x(e)&&(d.isArray(e)||d.isString(e)||d.isArguments(e)))return e.length===0;return d.keys(e).length===0};d.isElement=function(e){return!!(e&&e.nodeType===1)};d.isArray=u||function(e){return o.call(e)==="[object Array]"};d.isObject=function(e){var t=typeof e;return t==="function"||t==="object"&&!!e};d.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){d["is"+e]=function(t){return o.call(t)==="[object "+e+"]"}});if(!d.isArguments(arguments)){d.isArguments=function(e){return d.has(e,"callee")}}var A=e.document&&e.document.childNodes;if(typeof/./!="function"&&typeof Int8Array!="object"&&typeof A!="function"){d.isFunction=function(e){return typeof e=="function"||false}}d.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))};d.isNaN=function(e){return d.isNumber(e)&&e!==+e};d.isBoolean=function(e){return e===true||e===false||o.call(e)==="[object Boolean]"};d.isNull=function(e){return e===null};d.isUndefined=function(e){return e===void 0};d.has=function(e,t){return e!=null&&s.call(e,t)};d.noConflict=function(){e._=t;return this};d.identity=function(e){return e};d.constant=function(e){return function(){return e}};d.noop=function(){};d.property=v;d.propertyOf=function(e){return e==null?function(){}:function(t){return e[t]}};d.matcher=d.matches=function(e){e=d.extendOwn({},e);return function(t){return d.isMatch(t,e)}};d.times=function(e,t,r){var n=Array(Math.max(0,e));t=f(t,r,1);for(var i=0;i<e;i++)n[i]=t(i);return n};d.random=function(e,t){if(t==null){t=e;e=0}return e+Math.floor(Math.random()*(t-e+1))};d.now=Date.now||function(){return(new Date).getTime()};var D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var R=d.invert(D);var F=function(e){var t=function(t){return e[t]};var r="(?:"+d.keys(e).join("|")+")";var n=RegExp(r);var i=RegExp(r,"g");return function(e){e=e==null?"":""+e;return n.test(e)?e.replace(i,t):e}};d.escape=F(D);d.unescape=F(R);d.result=function(e,t,r){var n=e==null?void 0:e[t];if(n===void 0){n=r}return d.isFunction(n)?n.call(e):n};var q=0;d.uniqueId=function(e){var t=++q+"";return e?e+t:t};d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/;var V={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var z=/\\|'|\r|\n|\u2028|\u2029/g;var j=function(e){return"\\"+V[e]};d.template=function(e,t,r){if(!t&&r)t=r;t=d.defaults({},t,d.templateSettings);var n=RegExp([(t.escape||B).source,(t.interpolate||B).source,(t.evaluate||B).source].join("|")+"|$","g");var i=0;var a="__p+='";e.replace(n,function(t,r,n,o,s){a+=e.slice(i,s).replace(z,j);i=s+t.length;if(r){a+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"}else if(n){a+="'+\n((__t=("+n+"))==null?'':__t)+\n'"}else if(o){a+="';\n"+o+"\n__p+='"}return t});a+="';\n";if(!t.variable)a="with(obj||{}){\n"+a+"}\n";a="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";var o;try{o=new Function(t.variable||"obj","_",a)}catch(e){e.source=a;throw e}var s=function(e){return o.call(this,e,d)};var u=t.variable||"obj";s.source="function("+u+"){\n"+a+"}";return s};d.chain=function(e){var t=d(e);t._chain=true;return t};var U=function(e,t){return e._chain?d(t).chain():t};d.mixin=function(e){d.each(d.functions(e),function(t){var r=d[t]=e[t];d.prototype[t]=function(){var e=[this._wrapped];i.apply(e,arguments);return U(this,r.apply(d,e))}})};d.mixin(d);d.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];d.prototype[e]=function(){var r=this._wrapped;t.apply(r,arguments);if((e==="shift"||e==="splice")&&r.length===0)delete r[0];return U(this,r)}});d.each(["concat","join","slice"],function(e){var t=r[e];d.prototype[e]=function(){return U(this,t.apply(this._wrapped,arguments))}});d.prototype.value=function(){return this._wrapped};d.prototype.valueOf=d.prototype.toJSON=d.prototype.value;d.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return d})}})();define("core/lib/tools",["require","exports","underscore"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.flatten=t.pluck=t.contains=t.repeat=void 0;var n=function(e,t){return r.range(e).map(function(){return t})};t.repeat=n;var i=function(e,t){return!!(e&&e.indexOf(t)>=0)};t.contains=i;var a=function(e,t){return e.map(function(e){return e[t]})};t.pluck=a;var o=function(e){var t;return(t=[]).concat.apply(t,e)};t.flatten=o});define("core/l10n/localization",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.EMPTY=t.Localization=void 0;var r=function(){function e(e){if(e){this.initialize(e)}}e.prototype.assertContext=function(){if(!this.context){throw new Error("Expected i18n module to be initialized before being used.")}return this.context};e.prototype.ftl=function(){return this.assertContext().getFluentBundleSequence()};e.prototype.locale=function(){return this.assertContext().getLocale()};e.prototype.initialize=function(e){this.context=e};e.prototype.isRTL=function(){return["ar","he"].indexOf(this.locale())>=0};e.prototype.s=function(e,t){if(t===void 0){t={}}return this.ftl().format(e,t)||this.fallback(e)};e.prototype.unpack=function(e){var t=e.key,r=e.variables;return this.ftl().format(t,r)||this.fallback(t)};e.prototype.raw=function(e){return e};e.prototype.num=function(e){return""+e};e.prototype.date=function(e,t){return this.ftl().formatDate(e,t)};e.prototype.time=function(e){return this.ftl().formatTime(e)};e.prototype.fallback=function(e){var r;if(((r=this.context)===null||r===void 0?void 0:r.getEnvironment())==="development"){return e}return t.EMPTY};return e}();t.Localization=r;t.EMPTY=""});define("core/lib/i18n",["require","exports","../l10n/localization"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.initialize=t.i18n=t.EMPTY=void 0;Object.defineProperty(t,"EMPTY",{enumerable:true,get:function(){return r.EMPTY}});t.i18n=new r.Localization;function n(e){t.i18n.initialize(e)}t.initialize=n});define("core/components/cardsort/group-tools",["require","exports","underscore","core/lib/tools","core/lib/i18n","../component-helpers"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.responseToExternalGroups=t.aggregateCards=t.aggregateGroups=t.labelResponse=t.responseMatchesKey=t.computeCorrectCardCount=t.labelGroup=t.labelName=t.scoreLabeledGroup=t.computeDecCoords=t.isSubgroup=t.isIncorrect=t.groupsEqual=t.anyGrouped=t.avgGroupSize=t.numUngroupedCards=t.numGroupedCards=t.groupSizes=t.studentFinished=t.pairsEqual=t.allPairs=t.getGroupHashes=t.groupHash=t.pairHash=t.canCardJoinGroupWithCard=t.canCardJoinGroup=t.isCategoryCard=t.dropGroup=t.unjoinCardFromKeyboard=t.joinCardFromKeyboard=t.dropCard=t.pluckCard=t.removeGroup=t.getCardGroupForCard=t.bubbleGroup=t.addCardGroup=t.positionInitialCards=t.initCardGroup=void 0;var o="g-";var s=function(e,t,r){var n;var i;if(r!=null){n=r.x;i=r.y}else{n=Math.random()*.9;i=Math.random()*.9}return{id:a.generatePrefixId(o,a.getNextUniqueIdNum(e,o)),cardIds:[t],x:n,y:i}};t.initCardGroup=s;var u=function(e){var t=r.keys(e).length;var n=Math.ceil(Math.sqrt(t));var i=Math.pow(n,2);var a=r.shuffle(r.range(i));var o=0;var s={};for(var u in e){var c=a[o];var l=c%n;var p=(c-l)/n;s[u]={x:(l/n+(o+1)*.5/n/t)*.9,y:p/n+(o+1)*.5/n/t};o++}return s};t.positionInitialCards=u;var c=function(e,t){t.groupIds.push(e.id);t.groups[e.id]=e};t.addCardGroup=c;var l=function(e,t){var n=r.without(t.groupIds,e);n.push(e);t.groupIds=n};t.bubbleGroup=l;var p=function(e,t){for(var r in t.groups){var n=t.groups[r];if(n.cardIds.indexOf(e)>=0){return r}}return undefined};t.getCardGroupForCard=p;var d=function(e,t){t.groupIds=r.without(t.groupIds,e);delete t.groups[e]};t.removeGroup=d;var f=function(e,n){var i=t.getCardGroupForCard(e,n);if(!i)return;var a=n.groups[i].cardIds;n.groups[i].cardIds=r.without(a,e);if(n.groups[i].cardIds.length===0){t.removeGroup(i,n)}};t.pluckCard=f;var h=function(e,r,n){var i=e.itemId,a=e.dropZone;t.pluckCard(i,n);if(a&&a.groupId){var o=n.groups[a.groupId].cardIds;var s=a.cardIdAfter?o.indexOf(a.cardIdAfter):-1;o.splice(s+1,0,i);t.bubbleGroup(a.groupId,n)}else{t.addCardGroup(t.initCardGroup(n.groupIds,i,r),n)}};t.dropCard=h;var y=function(e,r,n,i){var a=t.getCardGroupForCard(r,n);if(a&&n.groups[a]){t.pluckCard(e,n);var o=n.groups[a].cardIds;if(t.isCategoryCard(e,i)){o.unshift(e)}else{o.push(e)}t.bubbleGroup(a,n)}};t.joinCardFromKeyboard=y;var m=function(e,r){var n=t.getCardGroupForCard(e,r);if(n){var i=r.groups[n].cardIds;if(i.length>1){t.pluckCard(e,r);t.addCardGroup(t.initCardGroup(r.groupIds,e),r)}}};t.unjoinCardFromKeyboard=m;var v=function(e,r,n){var i=e.itemId;n.groups[i].x=r.x;n.groups[i].y=r.y;t.bubbleGroup(i,n)};t.dropGroup=v;var g=function(e,t){var r;return((r=t[e])===null||r===void 0?void 0:r.type)==="category"};t.isCategoryCard=g;var b=function(e,r,n){return r.groups[e].cardIds.some(function(e){return t.isCategoryCard(e,n)})};var x=function(e,r,i,a){if(!t.isCategoryCard(e,a)){return true}if(n.contains(i.groups[r].cardIds,e)){return true}return!b(r,i,a)};t.canCardJoinGroup=x;var S=function(e,r,n,i){var a=t.getCardGroupForCard(r,n);if(a){return t.canCardJoinGroup(e,a,n,i)}return false};t.canCardJoinGroupWithCard=S;var T=function(e){var t=e[0],r=e[1];if(t<r){return t+"-"+r}else{return r+"-"+t}};t.pairHash=T;var w=function(e){return r.sortBy(e.cardIds).join(";")};t.groupHash=w;var _=function(e){return r.filter(r.values(e.groups),function(e){return e.cardIds.length>1}).map(t.groupHash)};t.getGroupHashes=_;var I=function(e){var t=[];for(var r=0,n=e;r<n.length;r++){var i=n[r];var a=i.cardIds.length;if(a>1){for(var o=0;o<a;o++){for(var s=o;s<a;s++){t.push([i.cardIds[o],i.cardIds[s]])}}}}return t};t.allPairs=I;var E=function(e,t){return e[0]===t[0]&&e[1]===t[1]||e[0]===t[1]&&e[1]===t[0]};t.pairsEqual=E;var C=function(e){if((e!=null?e.groups:void 0)==null){return false}return t.numGroupedCards(e)>2*t.numUngroupedCards(e)};t.studentFinished=C;var M=function(e){return r.values(e.groups).map(function(e){return e.cardIds.length})};t.groupSizes=M;var k=function(e){return r.filter(t.groupSizes(e),function(e){return e>1}).reduce(function(e,t){return e+t},0)};t.numGroupedCards=k;var P=function(e){return r.filter(t.groupSizes(e),function(e){return e===1}).reduce(function(e,t){return e+t},0)};t.numUngroupedCards=P;var O=function(e){var t=r.values(e.groups).map(function(e){return e.cardIds.length});if(t.length===0){return 0}return t.reduce(function(e,t){return e+t},0)/t.length};t.avgGroupSize=O;var L=function(e){return r.any(r.values(e.groups),function(e){return e.cardIds.length>1})};t.anyGrouped=L;var N=function(e,t){return e.cardIds.length===t.cardIds.length&&r.all(e.cardIds,function(e){return t.cardIds.indexOf(e)>=0})};t.groupsEqual=N;var A=function(e,t){if(!(e.cardIds.length>1)){return false}if(t==null){return false}var n=r.pluck(r.values(t.groups),"cardIds");return r.any(n,function(t){return r.any(e.cardIds,function(n){return t.indexOf(n)>=0&&!r.all(e.cardIds,function(e){return t.indexOf(e)>=0})})})};t.isIncorrect=A;var D=function(e,t){return e.cardIds.length<t.cardIds.length&&r.all(e.cardIds,function(e){return t.cardIds.indexOf(e)>=0})};t.isSubgroup=D;var R=function(e,t){var r=Math.ceil(Math.sqrt(t));return{x:e%r/r,y:Math.floor(e/r)/r}};t.computeDecCoords=R;var F=function(e){var t=e.labels;var n=r.filter(t,function(e){return e==="correct"}).length;var i;if(n===t.length){i=1e4+t.length}else if(n>0){i=n*100+t.length}else{i=t.length}return-i};t.scoreLabeledGroup=F;function q(e){switch(e){case"card":return i.i18n.s("cardsort-title-card");case"correct":return i.i18n.s("cardsort-title-correct");case"missing":return i.i18n.s("cardsort-title-missing");case"incorrect":return i.i18n.s("cardsort-title-incorrect")}}t.labelName=q;var B=function(e,t){var i=e.cardIds;if(t==undefined){return n.repeat(i.length,"card")}var a=function(e){var a=t.groups[e].cardIds;if(r.all(i,function(e){return a.indexOf(e)>=0})){if(i.length==1&&!(a.length==1)){return{value:["card"]}}return{value:n.repeat(i.length,"correct").concat(n.repeat(a.length-i.length,"missing"))}}};for(var o in t.groups){var s=a(o);if(typeof s==="object")return s.value}return n.repeat(i.length,"incorrect")};t.labelGroup=B;var V=function(e,n){var i=t.labelResponse(e,n);var a=0;r.each(i,function(e){r.each(e.labels,function(e){if(e==="correct")a++})});return a};t.computeCorrectCardCount=V;var z=function(e,n){if(e&&e.groupIds){var i=t.labelResponse(e,n);var a=r.flatten(r.map(i,function(e){return e.labels}));var o=r.some(a,function(e){return e!=="correct"});return!o}else{return false}};t.responseMatchesKey=z;var j=function(e,n){var i=r.keys(e.groups).map(function(r){return{groupId:r,labels:t.labelGroup(e.groups[r],n)}});return r.sortBy(i,t.scoreLabeledGroup)};t.labelResponse=j;var U=function(e,n){var i={};for(var a in e){var o=e[a];for(var s=0,u=r.values(o.groups);s<u.length;s++){var c=u[s];if(!(c.cardIds.length>1)){continue}var l=t.groupHash(c);if(i[l]==null){i[l]={id:l,cardIds:c.cardIds,studentIds:[],incorrect:t.isIncorrect(c,n)}}i[l].studentIds.push(a)}}return i};t.aggregateGroups=U;var G=function(e){var t={};for(var r in e){var n=e[r];if(n.incorrect){for(var i=0,a=n.cardIds;i<a.length;i++){var o=a[i];if(t[o]==null){t[o]={id:o,cardIds:[o],studentIds:[]}}t[o].studentIds=t[o].studentIds.concat(n.studentIds)}}}return t};t.aggregateCards=G;function W(e){var t=[];for(var r=0,n=e.groupIds;r<n.length;r++){var i=n[r];var a=e.groups[i];if(a){t.push({cardIds:a.cardIds,collapsed:!!a.collapsed,x:a.x,y:a.y})}}return t}t.responseToExternalGroups=W});define("core/lib/copydata",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.copydata=void 0;function r(e){if(e===undefined){return undefined}return JSON.parse(JSON.stringify(e))}t.copydata=r});(function(e,t){if(typeof define==="function"&&define.amd){define("core/lib/mathtools",[],t)}else{e.mathtools=t()}})(this,function(){var e,t,r;!function(n){var i,a,o,s,u={},c={},l={},p={},d=Object.prototype.hasOwnProperty,f=[].slice;function h(e,t){return d.call(e,t)}function y(e,t){var r,n,i,a,o,s,u,c,p,d,f=t&&t.split("/"),h=l.map,y=h&&h["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=(f=f.slice(0,f.length-1)).concat(e.split("/")),c=0;c<e.length;c+=1)if("."===(d=e[c]))e.splice(c,1),c-=1;else if(".."===d){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((f||y)&&h){for(c=(r=e.split("/")).length;c>0;c-=1){if(n=r.slice(0,c).join("/"),f)for(p=f.length;p>0;p-=1)if((i=h[f.slice(0,p).join("/")])&&(i=i[n])){a=i,o=c;break}if(a)break;!s&&y&&y[n]&&(s=y[n],u=c)}!a&&s&&(a=s,o=u),a&&(r.splice(0,o,a),e=r.join("/"))}return e}function m(e,t){return function(){return a.apply(n,f.call(arguments,0).concat([e,t]))}}function v(e){return function(t){u[e]=t}}function g(e){if(h(c,e)){var t=c[e];delete c[e],p[e]=!0,i.apply(n,t)}if(!h(u,e)&&!h(p,e))throw new Error("No "+e);return u[e]}function b(e){var t,r=e?e.indexOf("!"):-1;return r>-1&&(t=e.substring(0,r),e=e.substring(r+1,e.length)),[t,e]}function x(e){return function(){return l&&l.config&&l.config[e]||{}}}o=function(e,t){var r,n=b(e),i=n[0];return e=n[1],i&&(r=g(i=y(i,t))),i?e=r&&r.normalize?r.normalize(e,function(e){return function(t){return y(t,e)}}(t)):y(e,t):(i=(n=b(e=y(e,t)))[0],e=n[1],i&&(r=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:r}},s={require:function(e){return m(e)},exports:function(e){var t=u[e];return void 0!==t?t:u[e]={}},module:function(e){return{id:e,uri:"",exports:u[e],config:x(e)}}},i=function(e,t,r,i){var a,l,d,f,y,b,x=[];if(i=i||e,"function"==typeof r){for(t=!t.length&&r.length?["require","exports","module"]:t,y=0;y<t.length;y+=1)if("require"===(l=(f=o(t[y],i)).f))x[y]=s.require(e);else if("exports"===l)x[y]=s.exports(e),b=!0;else if("module"===l)a=x[y]=s.module(e);else if(h(u,l)||h(c,l)||h(p,l))x[y]=g(l);else{if(!f.p)throw new Error(e+" missing "+l);f.p.load(f.n,m(i,!0),v(l),{}),x[y]=u[l]}d=r.apply(u[e],x),e&&(a&&a.exports!==n&&a.exports!==u[e]?u[e]=a.exports:d===n&&b||(u[e]=d))}else e&&(u[e]=r)},e=t=a=function(e,t,r,u,c){return"string"==typeof e?s[e]?s[e](t):g(o(e,t).f):(e.splice||(l=e,t.splice?(e=t,t=r,r=null):e=n),t=t||function(){},"function"==typeof r&&(r=u,u=c),u?i(n,e,t,r):setTimeout(function(){i(n,e,t,r)},4),a)},a.config=function(e){return(l=e).deps&&a(l.deps,l.callback),a},(r=function(e,t,r){t.splice||(r=t,t=[]),h(u,e)||h(c,e)||(c[e]=[e,t,r])}).amd={jQuery:!0}}(),"undefined"!=typeof ALMOND_OVERRIDES&&ALMOND_OVERRIDES&&(r=ALMOND_OVERRIDES.define||r,t=ALMOND_OVERRIDES.require||t,e=ALMOND_OVERRIDES.requirejs||e);r("core/vendor/almond",function(){});r("pjs",[],function(){return function(e,t,r){function n(e){return"object"==typeof e}function i(e){return"function"==typeof e}function a(){}return function e(r,o){function s(){var e=new u;return i(e.init)&&e.init.apply(e,arguments),e}function u(){}undefined===o&&(o=r,r=Object),s.Bare=u;var c,l=a.prototype=r.prototype,p=u.prototype=s.prototype=new a;return p.constructor=s,s.mixin=function(t){return u.prototype=s.prototype=e(s,t).prototype,s},(s.open=function(e){if(c={},i(e)?c=e.call(s,p,l,s,r):n(e)&&(c=e),n(c))for(var a in c)t.call(c,a)&&(p[a]=c[a]);return i(p.init)||(p.init=r),s})(o)}}(0,{}.hasOwnProperty)});r("core/math/parser/input-span",["require","exports"],function(e,t){"use strict";function r(e,t,r){return{input:e,start:t,end:r}}Object.defineProperty(t,"__esModule",{value:!0}),t.slice=t.joinSpans=t.emptySpanAt=t.Span=void 0,t.Span=r,t.emptySpanAt=function(e,t){return r(e,t,t)},t.joinSpans=function(e,t){if(e.input!==t.input)throw new Error("Programming Error: cannot form a span on different inputs");return r(e.input,e.start,t.end)},t.slice=function(e){return e.input.slice(e.start,e.end)}});r("core/math/domaintypes",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.intersectDomains=t.allReals=t.linearPositiveDomain=t.knownDomain=t.unknownDomain=t.emptyDomain=void 0;t.emptyDomain=function(){return{type:"empty"}};t.unknownDomain=function(){return{type:"unknown"}};t.knownDomain=function(e){return isNaN(e[0])||isNaN(e[1])||e[1]<e[0]?t.emptyDomain():{type:"known",bounds:e}};t.linearPositiveDomain=function(e,r){if(0===r)return e>0?t.allReals():t.emptyDomain();var n=-e/r,i=r<0?[-1/0,n]:[n,1/0];return t.knownDomain(i)};t.allReals=function(){return t.knownDomain([-1/0,1/0])};t.intersectDomains=function(e,r){if("empty"===e.type||"empty"===r.type)return t.emptyDomain();if("unknown"===e.type||"unknown"===r.type)return t.unknownDomain();if(e.bounds&&r.bounds){var n=[Math.max(e.bounds[0],r.bounds[0]),Math.min(e.bounds[1],r.bounds[1])];return t.knownDomain(n)}return t.emptyDomain()}});r("core/lib/worker-i18n",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.s=void 0,t.s=function(e,t){return{key:e,vars:t}}});r("core/math/types",["require","exports","core/lib/worker-i18n"],function(e,t,r){"use strict";var n;function i(e){switch(e){case t.Any:return"Any";case t.Number:return"Number";case t.Bool:return"Bool";case t.Point:return"Point";case t.Distribution:return"Distribution";case t.Action:return"Action";case t.ListOfAny:return"ListOfAny";case t.ListOfNumber:return"ListOfNumber";case t.ListOfBool:return"ListOfBool";case t.ListOfPoint:return"ListOfPoint";case t.ListOfDistribution:return"ListOfDistribution";case t.EmptyList:return"EmptyList";case t.ErrorType:return"ErrorType";case t.SeedType:return"SeedType";case t.RGBColor:return"RGBColor";case t.ListOfColor:return"ListOfColor";case t.Polygon:return"Polygon";case t.ListOfPolygon:return"ListOfPolygon";default:throw new Error("Invalid type: "+e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.isTypeOrListOfType=t.typesMatch=t.isSubType=t.isOneOf=t.hasListType=t.listType=t.elementType=t.isList=t.prettyPrint=t.repr=t.ListOfPolygon=t.Polygon=t.ListOfColor=t.RGBColor=t.SeedType=t.ErrorType=t.EmptyList=t.ListOfDistribution=t.ListOfPoint=t.ListOfBool=t.ListOfNumber=t.ListOfAny=t.Action=t.Distribution=t.Point=t.Bool=t.Number=t.Any=void 0,t.Any=0,t.Number=1,t.Bool=2,t.Point=3,t.Distribution=4,t.Action=5,t.ListOfAny=6,t.ListOfNumber=7,t.ListOfBool=8,t.ListOfPoint=9,t.ListOfDistribution=10,t.EmptyList=11,t.ErrorType=12,t.SeedType=13,t.RGBColor=14,t.ListOfColor=15,t.Polygon=16,t.ListOfPolygon=17,t.repr=i,t.prettyPrint=function(e){switch(e){case t.Any:return r.s("shared-calculator-label-value-type-any");case t.Number:return r.s("shared-calculator-label-value-type-number");case t.Bool:return r.s("shared-calculator-label-value-type-bool");case t.Point:return r.s("shared-calculator-label-value-type-point");case t.Distribution:return r.s("shared-calculator-label-value-type-distribution");case t.Action:return r.s("shared-calculator-label-value-type-action");case t.ListOfAny:return r.s("shared-calculator-label-value-type-list-of-any");case t.ListOfNumber:return r.s("shared-calculator-label-value-type-list-of-numbers");case t.ListOfBool:return r.s("shared-calculator-label-value-type-list-of-bool");case t.ListOfPoint:return r.s("shared-calculator-label-value-type-list-of-points");case t.ListOfDistribution:return r.s("shared-calculator-label-value-type-list-of-distributions");case t.EmptyList:return r.s("shared-calculator-label-value-type-empty-list");case t.ErrorType:return r.s("shared-calculator-label-value-type-error");case t.SeedType:return r.s("shared-calculator-label-value-type-seed");case t.RGBColor:return r.s("shared-calculator-label-value-type-color");case t.ListOfColor:return r.s("shared-calculator-label-value-type-list-of-colors");case t.Polygon:return r.s("shared-calculator-label-value-type-polygon");case t.ListOfPolygon:return r.s("shared-calculator-label-value-type-list-of-polygons");default:throw new Error("Invalid type: "+e)}};(n={})[t.ListOfAny]=t.Any,n[t.EmptyList]=t.Number,n[t.ListOfNumber]=t.Number,n[t.ListOfBool]=t.Bool,n[t.ListOfPoint]=t.Point,n[t.ListOfDistribution]=t.Distribution,n[t.ListOfColor]=t.RGBColor,n[t.ListOfPolygon]=t.Polygon;function a(e){switch(e){case t.ListOfAny:case t.ListOfNumber:case t.ListOfBool:case t.ListOfPoint:case t.ListOfDistribution:case t.ListOfColor:case t.ListOfPolygon:case t.EmptyList:return!0;case t.Any:case t.Number:case t.Bool:case t.Point:case t.Distribution:case t.ErrorType:case t.SeedType:case t.RGBColor:case t.Action:case t.Polygon:return!1;default:throw new Error("Invalid type: "+e)}}function o(e){switch(e){case t.EmptyList:case t.ListOfNumber:return t.Number;case t.ListOfBool:return t.Bool;case t.ListOfPoint:return t.Point;case t.ListOfDistribution:return t.Distribution;case t.ListOfColor:return t.RGBColor;case t.ListOfPolygon:return t.Polygon;case t.ListOfAny:return t.Any;case t.Any:case t.Number:case t.Bool:case t.Point:case t.Distribution:case t.ErrorType:case t.SeedType:case t.RGBColor:case t.Action:case t.Polygon:return t.Any;default:throw new Error("Invalid type: "+e)}}function s(e,r){return!(e!==t.EmptyList||!a(r))||(!(r!==t.ListOfAny||!a(e))||e===r)}t.isList=a,t.elementType=o,t.listType=function(e){switch(e){case t.Any:return t.ListOfAny;case t.Number:return t.ListOfNumber;case t.Bool:return t.ListOfBool;case t.Point:return t.ListOfPoint;case t.Distribution:return t.ListOfDistribution;case t.RGBColor:return t.ListOfColor;case t.Polygon:return t.ListOfPolygon;case t.EmptyList:case t.ListOfNumber:case t.ListOfBool:case t.ListOfPoint:case t.ListOfDistribution:case t.ListOfColor:case t.ListOfPolygon:case t.ListOfAny:case t.ErrorType:case t.SeedType:case t.Action:throw new Error("Type "+i(e)+" does not implement listType.");default:throw new Error("Invalid type: "+e)}},t.hasListType=function(e){switch(e){case t.Any:case t.Number:case t.Bool:case t.Point:case t.Distribution:case t.RGBColor:case t.Polygon:return!0;case t.EmptyList:case t.ListOfNumber:case t.ListOfBool:case t.ListOfPoint:case t.ListOfDistribution:case t.ListOfColor:case t.ListOfPolygon:case t.ListOfAny:case t.ErrorType:case t.SeedType:case t.Action:return!1;default:throw new Error("Invalid type: "+e)}},t.isOneOf=function(e,t){for(var r=0,n=t;r<n.length;r++){if(e===n[r])return!0}return!1},t.isSubType=s,t.typesMatch=function(e,t){return s(e,t)||s(t,e)},t.isTypeOrListOfType=function(e,r){return e===r||!!a(e)&&(e===t.EmptyList||o(e)===r)}});r("core/math/parsenode/base",["require","pjs","core/math/parser/input-span","core/math/domaintypes","core/math/types"],function(e){"use strict";var t=e("pjs"),r=e("core/math/parser/input-span"),n=e("core/math/domaintypes"),i=e("core/math/types");return t(function(e,t,a){e.init=function(){this._dependencies=[],this._dummyDependencies=[],this._updateSymbols=[],this._scope={definitions:[],dependencies:[],scopes:[]},this._exports=[]},e.exportPenalty=0,e.setInputSpan=function(e){this._inputSpan=e},e.getInputString=function(){return void 0===this.getInputSpan()?"":r.slice(this._inputSpan)},e.getInputSpan=function(){return this._inputSpan},e.shouldExportAns=function(){return!1},e.getAnsVariable=function(){return this.shouldExportAns()&&this.userData&&this.userData.hasOwnProperty("index")?["ans_"+this.userData.index]:[]},e.addDependency=function(e){-1===this._dependencies.indexOf(e)&&this._dependencies.push(e),-1===this._scope.dependencies.indexOf(e)&&this._scope.dependencies.push(e)},e.addDependencies=function(e){for(var t=0;t<e.length;t++)this.addDependency(e[t])},e.addDummyDependency=function(e){-1===this._dependencies.indexOf(e)&&this._dependencies.push(e),-1===this._dummyDependencies.indexOf(e)&&this._dummyDependencies.push(e)},e.addDummyDependencies=function(e){for(var t=0;t<e.length;t++)this.addDummyDependency(e[t])},e.addUpdateSymbol=function(e){-1===this._dependencies.indexOf(e)&&this._dependencies.push(e),-1===this._updateSymbols.indexOf(e)&&this._updateSymbols.push(e)},e.mergeDependencies=function(){for(var e=0;e<arguments.length;e++){var t,r=arguments[e];for(t=0;t<r._dependencies.length;t++)-1===this._dependencies.indexOf(r._dependencies[t])&&this._dependencies.push(r._dependencies[t]);for(t=0;t<r._updateSymbols.length;t++)-1===this._updateSymbols.indexOf(r._updateSymbols[t])&&this._updateSymbols.push(r._updateSymbols[t]);for(t=0;t<r._scope.dependencies.length;t++)-1===this._scope.dependencies.indexOf(r._scope.dependencies[t])&&this._scope.dependencies.push(r._scope.dependencies[t]);this.addDummyDependencies(r.getDummyDependencies()),Array.prototype.push.apply(this._scope.scopes,r._scope.scopes)}},e.mergeDependenciesInScope=function(e,t){this.addDummyDependencies(e);var r=t.getScope(),n={definitions:e,dependencies:r.dependencies,scopes:r.scopes};this._scope.scopes.push(n);for(var i=0;i<t._dependencies.length;i++)-1===this._dependencies.indexOf(t._dependencies[i])&&this._dependencies.push(t._dependencies[i]);for(i=0;i<t._updateSymbols.length;i++)-1===this._updateSymbols.indexOf(t._updateSymbols[i])&&this._updateSymbols.push(t._updateSymbols[i]);this.addDummyDependencies(t.getDummyDependencies())},e.getDependencies=function(){return this._dependencies},e.getDummyDependencies=function(){return this._dummyDependencies},e.getUpdateSymbols=function(){return this._updateSymbols},e.getScope=function(){return this._scope},e.dependsOn=function(e){return this._dependencies.indexOf(e)>-1},e.getExports=function(){return(this._exports||[]).concat(this.getAnsVariable())},e.getLegalExports=function(e){return this.getExports().filter(function(t){return!e.assignmentForbidden(t)})},e.exportsSymbol=function(e){return this._exports.indexOf(e)>-1},e.exportTo=function(e,t,r){for(var n=this.getLegalExports(e),i=0;i<n.length;i++){var a=n[i];if(r[a])return;r[a]=t.blocksExport?t:this}},e.getOperator=function(){return this.operator||"="},e.isInequality=function(){return!1},e.isShadeBetween=function(){return!1},e.getAllIds=function(){return this.userData?[this.userData.id]:[]},e.getEvaluationInfo=function(){return!1},e.shouldPromoteToSlider=function(e){return!1},e.getSliderVariables=function(e,t){var r=e.sliderVariables(t.getDependencies());return t.valueType===i.Point||t.valueType===i.ListOfPoint?r.filter(function(t){return!e.validParametricVariable(t)}):r},e.getCompiledDerivative=function(){var e=this.getDependencies();return this.takeDerivative(e[0]||"x").getCompiledFunction()},e.asValue=function(){},e.boundDomain=function(e){return n.unknownDomain()}})});r("core/math/parsenode/error",["require","pjs","./base"],function(e){"use strict";return e("pjs")(e("./base"),function(e,t){e.init=function(e){t.init.call(this),this._msg=e,this.blocksExport=!0},e.evaluateOnce=function(e){return this._msg},e.isError=!0,e.getError=function(){return this._msg},e.setDependencies=function(e){return this.addDependencies(e),this},e.setActionValue=function(e){this.actionValue=e},e.allowExport=function(){return this.blocksExport=!1,this}})});!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof r&&r.amd?r("underscore",t):function(){var r=e._,n=t();e._=n,n.noConflict=function(){return e._=r,n}}()}(this,function(){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},t=Array.prototype,r=Object.prototype,n="undefined"!=typeof Symbol?Symbol.prototype:null,i=t.push,a=t.slice,o=r.toString,s=r.hasOwnProperty,u=Array.isArray,c=Object.keys,l=Object.create,p=e.isNaN,d=e.isFinite,f=function(){};function h(e){return e instanceof h?e:this instanceof h?void(this._wrapped=e):new h(e)}var y=h.VERSION="1.10.2";function m(e,t,r){if(void 0===t)return e;switch(null==r?3:r){case 1:return function(r){return e.call(t,r)};case 3:return function(r,n,i){return e.call(t,r,n,i)};case 4:return function(r,n,i,a){return e.call(t,r,n,i,a)}}return function(){return e.apply(t,arguments)}}function v(e,t,r){return null==e?nt:Ue(e)?m(e,t,r):ze(e)&&!Ve(e)?at(e):it(e)}function g(e,t){return v(e,t,1/0)}function b(e,t,r){return h.iteratee!==g?h.iteratee(e,t):v(e,t,r)}function x(e,t){return t=null==t?e.length-1:+t,function(){for(var r=Math.max(arguments.length-t,0),n=Array(r),i=0;i<r;i++)n[i]=arguments[i+t];switch(t){case 0:return e.call(this,n);case 1:return e.call(this,arguments[0],n);case 2:return e.call(this,arguments[0],arguments[1],n)}var a=Array(t+1);for(i=0;i<t;i++)a[i]=arguments[i];return a[t]=n,e.apply(this,a)}}function S(e){if(!ze(e))return{};if(l)return l(e);f.prototype=e;var t=new f;return f.prototype=null,t}function T(e){return function(t){return null==t?void 0:t[e]}}function w(e,t){return null!=e&&s.call(e,t)}function _(e,t){for(var r=t.length,n=0;n<r;n++){if(null==e)return;e=e[t[n]]}return r?e:void 0}h.iteratee=g;var I=Math.pow(2,53)-1,E=T("length");function C(e){var t=E(e);return"number"==typeof t&&t>=0&&t<=I}function M(e,t,r){var n,i;if(t=m(t,r),C(e))for(n=0,i=e.length;n<i;n++)t(e[n],n,e);else{var a=we(e);for(n=0,i=a.length;n<i;n++)t(e[a[n]],a[n],e)}return e}function k(e,t,r){t=b(t,r);for(var n=!C(e)&&we(e),i=(n||e).length,a=Array(i),o=0;o<i;o++){var s=n?n[o]:o;a[o]=t(e[s],s,e)}return a}function P(e){var t=function(t,r,n,i){var a=!C(t)&&we(t),o=(a||t).length,s=e>0?0:o-1;for(i||(n=t[a?a[s]:s],s+=e);s>=0&&s<o;s+=e){var u=a?a[s]:s;n=r(n,t[u],u,t)}return n};return function(e,r,n,i){var a=arguments.length>=3;return t(e,m(r,i,4),n,a)}}var O=P(1),L=P(-1);function N(e,t,r){var n=(C(e)?ae:Oe)(e,t,r);if(void 0!==n&&-1!==n)return e[n]}function A(e,t,r){var n=[];return t=b(t,r),M(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function D(e,t,r){t=b(t,r);for(var n=!C(e)&&we(e),i=(n||e).length,a=0;a<i;a++){var o=n?n[a]:a;if(!t(e[o],o,e))return!1}return!0}function R(e,t,r){t=b(t,r);for(var n=!C(e)&&we(e),i=(n||e).length,a=0;a<i;a++){var o=n?n[a]:a;if(t(e[o],o,e))return!0}return!1}function F(e,t,r,n){return C(e)||(e=Ie(e)),("number"!=typeof r||n)&&(r=0),ce(e,t,r)>=0}var q=x(function(e,t,r){var n,i;return Ue(t)?i=t:Ve(t)&&(n=t.slice(0,-1),t=t[t.length-1]),k(e,function(e){var a=i;if(!a){if(n&&n.length&&(e=_(e,n)),null==e)return;a=e[t]}return null==a?a:a.apply(e,r)})});function B(e,t){return k(e,it(t))}function V(e,t,r){var n,i,a=-1/0,o=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,u=(e=C(e)?e:Ie(e)).length;s<u;s++)null!=(n=e[s])&&n>a&&(a=n);else t=b(t,r),M(e,function(e,r,n){((i=t(e,r,n))>o||i===-1/0&&a===-1/0)&&(a=e,o=i)});return a}function z(e,t,r){if(null==t||r)return C(e)||(e=Ie(e)),e[ot(e.length-1)];var n=C(e)?Re(e):Ie(e),i=E(n);t=Math.max(Math.min(t,i),0);for(var a=i-1,o=0;o<t;o++){var s=ot(o,a),u=n[o];n[o]=n[s],n[s]=u}return n.slice(0,t)}function j(e,t){return function(r,n,i){var a=t?[[],[]]:{};return n=b(n,i),M(r,function(t,i){var o=n(t,i,r);e(a,t,o)}),a}}var U=j(function(e,t,r){w(e,r)?e[r].push(t):e[r]=[t]}),G=j(function(e,t,r){e[r]=t}),W=j(function(e,t,r){w(e,r)?e[r]++:e[r]=1}),K=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;var H=j(function(e,t,r){e[r?0:1].push(t)},!0);function J(e,t,r){return null==e||e.length<1?null==t?void 0:[]:null==t||r?e[0]:Y(e,e.length-t)}function Y(e,t,r){return a.call(e,0,Math.max(0,e.length-(null==t||r?1:t)))}function $(e,t,r){return a.call(e,null==t||r?1:t)}function X(e,t,r,n){for(var i=(n=n||[]).length,a=0,o=E(e);a<o;a++){var s=e[a];if(C(s)&&(Ve(s)||je(s)))if(t)for(var u=0,c=s.length;u<c;)n[i++]=s[u++];else X(s,t,r,n),i=n.length;else r||(n[i++]=s)}return n}var Z=x(function(e,t){return te(e,t)});function Q(e,t,r,n){rt(t)||(n=r,r=t,t=!1),null!=r&&(r=b(r,n));for(var i=[],a=[],o=0,s=E(e);o<s;o++){var u=e[o],c=r?r(u,o,e):u;t&&!r?(o&&a===c||i.push(u),a=c):r?F(a,c)||(a.push(c),i.push(u)):F(i,u)||i.push(u)}return i}var ee=x(function(e){return Q(X(e,!0,!0))});var te=x(function(e,t){return t=X(t,!0,!0),A(e,function(e){return!F(t,e)})});function re(e){for(var t=e&&V(e,E).length||0,r=Array(t),n=0;n<t;n++)r[n]=B(e,n);return r}var ne=x(re);function ie(e){return function(t,r,n){r=b(r,n);for(var i=E(t),a=e>0?0:i-1;a>=0&&a<i;a+=e)if(r(t[a],a,t))return a;return-1}}var ae=ie(1),oe=ie(-1);function se(e,t,r,n){for(var i=(r=b(r,n,1))(t),a=0,o=E(e);a<o;){var s=Math.floor((a+o)/2);r(e[s])<i?a=s+1:o=s}return a}function ue(e,t,r){return function(n,i,o){var s=0,u=E(n);if("number"==typeof o)e>0?s=o>=0?o:Math.max(o+u,s):u=o>=0?Math.min(o+1,u):o+u+1;else if(r&&o&&u)return n[o=r(n,i)]===i?o:-1;if(i!=i)return(o=t(a.call(n,s,u),tt))>=0?o+s:-1;for(o=e>0?s:u-1;o>=0&&o<u;o+=e)if(n[o]===i)return o;return-1}}var ce=ue(1,ae,se),le=ue(-1,oe);function pe(e,t,r,n,i){if(!(n instanceof t))return e.apply(r,i);var a=S(e.prototype),o=e.apply(a,i);return ze(o)?o:a}var de=x(function(e,t,r){if(!Ue(e))throw new TypeError("Bind must be called on a function");var n=x(function(i){return pe(e,n,t,this,r.concat(i))});return n}),fe=x(function(e,t){var r=fe.placeholder,n=function(){for(var i=0,a=t.length,o=Array(a),s=0;s<a;s++)o[s]=t[s]===r?arguments[i++]:t[s];for(;i<arguments.length;)o.push(arguments[i++]);return pe(e,n,this,this,o)};return n});fe.placeholder=h;var he=x(function(e,t){var r=(t=X(t,!1,!1)).length;if(r<1)throw new Error("bindAll must be passed function names");for(;r--;){var n=t[r];e[n]=de(e[n],e)}});var ye=x(function(e,t,r){return setTimeout(function(){return e.apply(null,r)},t)}),me=fe(ye,h,1);function ve(e){return function(){return!e.apply(this,arguments)}}function ge(e,t){var r;return function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=null),r}}var be=fe(ge,2),xe=!{toString:null}.propertyIsEnumerable("toString"),Se=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function Te(e,t){var n=Se.length,i=e.constructor,a=Ue(i)&&i.prototype||r,o="constructor";for(w(e,o)&&!F(t,o)&&t.push(o);n--;)(o=Se[n])in e&&e[o]!==a[o]&&!F(t,o)&&t.push(o)}function we(e){if(!ze(e))return[];if(c)return c(e);var t=[];for(var r in e)w(e,r)&&t.push(r);return xe&&Te(e,t),t}function _e(e){if(!ze(e))return[];var t=[];for(var r in e)t.push(r);return xe&&Te(e,t),t}function Ie(e){for(var t=we(e),r=t.length,n=Array(r),i=0;i<r;i++)n[i]=e[t[i]];return n}function Ee(e){for(var t={},r=we(e),n=0,i=r.length;n<i;n++)t[e[r[n]]]=r[n];return t}function Ce(e){var t=[];for(var r in e)Ue(e[r])&&t.push(r);return t.sort()}function Me(e,t){return function(r){var n=arguments.length;if(t&&(r=Object(r)),n<2||null==r)return r;for(var i=1;i<n;i++)for(var a=arguments[i],o=e(a),s=o.length,u=0;u<s;u++){var c=o[u];t&&void 0!==r[c]||(r[c]=a[c])}return r}}var ke=Me(_e),Pe=Me(we);function Oe(e,t,r){t=b(t,r);for(var n,i=we(e),a=0,o=i.length;a<o;a++)if(t(e[n=i[a]],n,e))return n}function Le(e,t,r){return t in r}var Ne=x(function(e,t){var r={},n=t[0];if(null==e)return r;Ue(n)?(t.length>1&&(n=m(n,t[1])),t=_e(e)):(n=Le,t=X(t,!1,!1),e=Object(e));for(var i=0,a=t.length;i<a;i++){var o=t[i],s=e[o];n(s,o,e)&&(r[o]=s)}return r}),Ae=x(function(e,t){var r,n=t[0];return Ue(n)?(n=ve(n),t.length>1&&(r=t[1])):(t=k(X(t,!1,!1),String),n=function(e,r){return!F(t,r)}),Ne(e,n,r)}),De=Me(_e,!0);function Re(e){return ze(e)?Ve(e)?e.slice():ke({},e):e}function Fe(e,t){var r=we(t),n=r.length;if(null==e)return!n;for(var i=Object(e),a=0;a<n;a++){var o=r[a];if(t[o]!==i[o]||!(o in i))return!1}return!0}function qe(e,t,r,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var a=typeof e;return("function"===a||"object"===a||"object"==typeof t)&&function(e,t,r,i){e instanceof h&&(e=e._wrapped);t instanceof h&&(t=t._wrapped);var a=o.call(e);if(a!==o.call(t))return!1;switch(a){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return n.valueOf.call(e)===n.valueOf.call(t)}var s="[object Array]"===a;if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var u=e.constructor,c=t.constructor;if(u!==c&&!(Ue(u)&&u instanceof u&&Ue(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}i=i||[];var l=(r=r||[]).length;for(;l--;)if(r[l]===e)return i[l]===t;if(r.push(e),i.push(t),s){if((l=e.length)!==t.length)return!1;for(;l--;)if(!qe(e[l],t[l],r,i))return!1}else{var p,d=we(e);if(l=d.length,we(t).length!==l)return!1;for(;l--;)if(!w(t,p=d[l])||!qe(e[p],t[p],r,i))return!1}return r.pop(),i.pop(),!0}(e,t,r,i)}function Be(e){return function(t){return o.call(t)==="[object "+e+"]"}}var Ve=u||Be("Array");function ze(e){var t=typeof e;return"function"===t||"object"===t&&!!e}var je=Be("Arguments"),Ue=Be("Function"),Ge=Be("String"),We=Be("Number"),Ke=Be("Date"),He=Be("RegExp"),Je=Be("Error"),Ye=Be("Symbol"),$e=Be("Map"),Xe=Be("WeakMap"),Ze=Be("Set"),Qe=Be("WeakSet");!function(){je(arguments)||(je=function(e){return w(e,"callee")})}();var et=e.document&&e.document.childNodes;function tt(e){return We(e)&&p(e)}function rt(e){return!0===e||!1===e||"[object Boolean]"===o.call(e)}function nt(e){return e}function it(e){return Ve(e)?function(t){return _(t,e)}:T(e)}function at(e){return e=Pe({},e),function(t){return Fe(t,e)}}function ot(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof et&&(Ue=function(e){return"function"==typeof e||!1});var st=Date.now||function(){return(new Date).getTime()},ut={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},ct=Ee(ut);function lt(e){var t=function(t){return e[t]},r="(?:"+we(e).join("|")+")",n=RegExp(r),i=RegExp(r,"g");return function(e){return e=null==e?"":""+e,n.test(e)?e.replace(i,t):e}}var pt=lt(ut),dt=lt(ct);var ft=0;var ht=h.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},yt=/(.)^/,mt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},vt=/\\|'|\r|\n|\u2028|\u2029/g,gt=function(e){return"\\"+mt[e]};function bt(e,t){return e._chain?h(t).chain():t}function xt(e){return M(Ce(e),function(t){var r=h[t]=e[t];h.prototype[t]=function(){var e=[this._wrapped];return i.apply(e,arguments),bt(this,r.apply(h,e))}}),h}M(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var r=t[e];h.prototype[e]=function(){var t=this._wrapped;return r.apply(t,arguments),"shift"!==e&&"splice"!==e||0!==t.length||delete t[0],bt(this,t)}}),M(["concat","join","slice"],function(e){var r=t[e];h.prototype[e]=function(){return bt(this,r.apply(this._wrapped,arguments))}}),h.prototype.value=function(){return this._wrapped},h.prototype.valueOf=h.prototype.toJSON=h.prototype.value,h.prototype.toString=function(){return String(this._wrapped)};var St=xt({default:h,VERSION:y,iteratee:g,restArguments:x,each:M,forEach:M,map:k,collect:k,reduce:O,foldl:O,inject:O,reduceRight:L,foldr:L,find:N,detect:N,filter:A,select:A,reject:function(e,t,r){return A(e,ve(b(t)),r)},every:D,all:D,some:R,any:R,contains:F,includes:F,include:F,invoke:q,pluck:B,where:function(e,t){return A(e,at(t))},findWhere:function(e,t){return N(e,at(t))},max:V,min:function(e,t,r){var n,i,a=1/0,o=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var s=0,u=(e=C(e)?e:Ie(e)).length;s<u;s++)null!=(n=e[s])&&n<a&&(a=n);else t=b(t,r),M(e,function(e,r,n){((i=t(e,r,n))<o||i===1/0&&a===1/0)&&(a=e,o=i)});return a},shuffle:function(e){return z(e,1/0)},sample:z,sortBy:function(e,t,r){var n=0;return t=b(t,r),B(k(e,function(e,r,i){return{value:e,index:n++,criteria:t(e,r,i)}}).sort(function(e,t){var r=e.criteria,n=t.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(r<n||void 0===n)return-1}return e.index-t.index}),"value")},groupBy:U,indexBy:G,countBy:W,toArray:function(e){return e?Ve(e)?a.call(e):Ge(e)?e.match(K):C(e)?k(e,nt):Ie(e):[]},size:function(e){return null==e?0:C(e)?e.length:we(e).length},partition:H,first:J,head:J,take:J,initial:Y,last:function(e,t,r){return null==e||e.length<1?null==t?void 0:[]:null==t||r?e[e.length-1]:$(e,Math.max(0,e.length-t))},rest:$,tail:$,drop:$,compact:function(e){return A(e,Boolean)},flatten:function(e,t){return X(e,t,!1)},without:Z,uniq:Q,unique:Q,union:ee,intersection:function(e){for(var t=[],r=arguments.length,n=0,i=E(e);n<i;n++){var a=e[n];if(!F(t,a)){var o;for(o=1;o<r&&F(arguments[o],a);o++);o===r&&t.push(a)}}return t},difference:te,unzip:re,zip:ne,object:function(e,t){for(var r={},n=0,i=E(e);n<i;n++)t?r[e[n]]=t[n]:r[e[n][0]]=e[n][1];return r},findIndex:ae,findLastIndex:oe,sortedIndex:se,indexOf:ce,lastIndexOf:le,range:function(e,t,r){null==t&&(t=e||0,e=0),r||(r=t<e?-1:1);for(var n=Math.max(Math.ceil((t-e)/r),0),i=Array(n),a=0;a<n;a++,e+=r)i[a]=e;return i},chunk:function(e,t){if(null==t||t<1)return[];for(var r=[],n=0,i=e.length;n<i;)r.push(a.call(e,n,n+=t));return r},bind:de,partial:fe,bindAll:he,memoize:function(e,t){var r=function(n){var i=r.cache,a=""+(t?t.apply(this,arguments):n);return w(i,a)||(i[a]=e.apply(this,arguments)),i[a]};return r.cache={},r},delay:ye,defer:me,throttle:function(e,t,r){var n,i,a,o,s=0;r||(r={});var u=function(){s=!1===r.leading?0:st(),n=null,o=e.apply(i,a),n||(i=a=null)},c=function(){var c=st();s||!1!==r.leading||(s=c);var l=t-(c-s);return i=this,a=arguments,l<=0||l>t?(n&&(clearTimeout(n),n=null),s=c,o=e.apply(i,a),n||(i=a=null)):n||!1===r.trailing||(n=setTimeout(u,l)),o};return c.cancel=function(){clearTimeout(n),s=0,n=i=a=null},c},debounce:function(e,t,r){var n,i,a=function(t,r){n=null,r&&(i=e.apply(t,r))},o=x(function(o){if(n&&clearTimeout(n),r){var s=!n;n=setTimeout(a,t),s&&(i=e.apply(this,o))}else n=ye(a,t,this,o);return i});return o.cancel=function(){clearTimeout(n),n=null},o},wrap:function(e,t){return fe(t,e)},negate:ve,compose:function(){var e=arguments,t=e.length-1;return function(){for(var r=t,n=e[t].apply(this,arguments);r--;)n=e[r].call(this,n);return n}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:ge,once:be,keys:we,allKeys:_e,values:Ie,mapObject:function(e,t,r){t=b(t,r);for(var n=we(e),i=n.length,a={},o=0;o<i;o++){var s=n[o];a[s]=t(e[s],s,e)}return a},pairs:function(e){for(var t=we(e),r=t.length,n=Array(r),i=0;i<r;i++)n[i]=[t[i],e[t[i]]];return n},invert:Ee,functions:Ce,methods:Ce,extend:ke,extendOwn:Pe,assign:Pe,findKey:Oe,pick:Ne,omit:Ae,defaults:De,create:function(e,t){var r=S(e);return t&&Pe(r,t),r},clone:Re,tap:function(e,t){return t(e),e},isMatch:Fe,isEqual:function(e,t){return qe(e,t)},isEmpty:function(e){return null==e||(C(e)&&(Ve(e)||Ge(e)||je(e))?0===e.length:0===we(e).length)},isElement:function(e){return!(!e||1!==e.nodeType)},isArray:Ve,isObject:ze,isArguments:je,isFunction:Ue,isString:Ge,isNumber:We,isDate:Ke,isRegExp:He,isError:Je,isSymbol:Ye,isMap:$e,isWeakMap:Xe,isSet:Ze,isWeakSet:Qe,isFinite:function(e){return!Ye(e)&&d(e)&&!p(parseFloat(e))},isNaN:tt,isBoolean:rt,isNull:function(e){return null===e},isUndefined:function(e){return void 0===e},has:function(e,t){if(!Ve(t))return w(e,t);for(var r=t.length,n=0;n<r;n++){var i=t[n];if(null==e||!s.call(e,i))return!1;e=e[i]}return!!r},identity:nt,constant:function(e){return function(){return e}},noop:function(){},property:it,propertyOf:function(e){return null==e?function(){}:function(t){return Ve(t)?_(e,t):e[t]}},matcher:at,matches:at,times:function(e,t,r){var n=Array(Math.max(0,e));t=m(t,r,1);for(var i=0;i<e;i++)n[i]=t(i);return n},random:ot,now:st,escape:pt,unescape:dt,result:function(e,t,r){Ve(t)||(t=[t]);var n=t.length;if(!n)return Ue(r)?r.call(e):r;for(var i=0;i<n;i++){var a=null==e?void 0:e[t[i]];void 0===a&&(a=r,i=n),e=Ue(a)?a.call(e):a}return e},uniqueId:function(e){var t=++ft+"";return e?e+t:t},templateSettings:ht,template:function(e,t,r){!t&&r&&(t=r),t=De({},t,h.templateSettings);var n,i=RegExp([(t.escape||yt).source,(t.interpolate||yt).source,(t.evaluate||yt).source].join("|")+"|$","g"),a=0,o="__p+='";e.replace(i,function(t,r,n,i,s){return o+=e.slice(a,s).replace(vt,gt),a=s+t.length,r?o+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":n?o+="'+\n((__t=("+n+"))==null?'':__t)+\n'":i&&(o+="';\n"+i+"\n__p+='"),t}),o+="';\n",t.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{n=new Function(t.variable||"obj","_",o)}catch(e){throw e.source=o,e}var s=function(e){return n.call(this,e,h)},u=t.variable||"obj";return s.source="function("+u+"){\n"+o+"}",s},chain:function(e){var t=h(e);return t._chain=!0,t},mixin:xt});return St._=St,St});r("core/math/distance",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.approx=t.pointToSegment=t.closestPointOnSegment=t.pointToSegmentParameter=t.mean=t.hypot=void 0;var r=Math.hypot&&Math.hypot(1/0,NaN)===1/0;function n(e){return e===1/0||e===-1/0}function i(e,r,n,i,a,o,s,u,c){var l=t.hypot(s-i,u-a,c-o);return 0===l?0:function(e,t,r,n,i,a){return e*n+t*i+r*a}((e-i)/l,(r-a)/l,(n-o)/l,(s-i)/l,(u-a)/l,(c-o)/l)}function a(e,t,r,n,a,o){var s=i(e,t,0,r,n,0,a,o,0);return s<=0?[r,n]:s>=1?[a,o]:[r+s*(a-r),n+s*(o-n)]}t.hypot=r?Math.hypot:function(e,t,r){if(n(e)||n(t)||void 0!==r&&n(r))return 1/0;if(isNaN(e)||isNaN(t)||void 0!==r&&isNaN(r))return NaN;if(0===e&&0===t&&(void 0===r||0===r))return 0;for(var i=0,a=0,o=0;o<arguments.length;o+=1){var s=Math.abs(Number(arguments[o]));s>i&&(a*=i/s*(i/s),i=s),a+=0===s&&0===i?0:s/i*(s/i)}return i===1/0?1/0:i*Math.sqrt(a)},t.mean=function(e,t){return e>0==t>0?e+.5*(t-e):.5*(e+t)},t.pointToSegmentParameter=i,t.closestPointOnSegment=a,t.pointToSegment=function(e,r,n,i,o,s){var u=a(e,r,n,i,o,s);return t.hypot(e-u[0],r-u[1])},t.approx=function(e,t,r){if(void 0===r&&(r=1),e===t)return!0;if(!isFinite(e)||!isFinite(t))return!1;if(r>50)throw new Error("Within "+(52-r)+" bits isn't really approximate any more");var n=Math.max(Math.max(Math.abs(e),Math.abs(t)),1);return n===n+(1===r?.5:Math.pow(.5,r))*Math.abs(t-e)}});r("core/math/tofraction",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(void 0===t&&(t=1e6),e===1/0)return{n:1/0,d:1};if(e===-1/0)return{n:-1/0,d:1};if(!isFinite(e))return{n:NaN,d:1};for(var r,n,i,a=0,o=1,s=1,u=0;!(n=(r=Math.floor(e))*o+a,(i=r*u+s)>t||(a=o,s=u,o=n,u=i,e===r));)e=1/(e-r);return{n:o,d:u}}});r("core/lib/label",["require","exports","underscore","core/math/distance","core/math/tofraction"],function(e,t,r,n,i){"use strict";function a(e,t){if(void 0===t&&(t=e),isNaN(e)||!isFinite(e))return{ariaString:"undefined",string:"undefined",value:e};if(0===e)return{ariaString:"0",string:"0",value:e};Math.abs(e)>Math.abs(t)&&(t=e);var r,a=i.default(e/Math.PI,24);if(y(t)&&n.approx(a.n/a.d*Math.PI,e,3))return{ariaString:p(r=(0===a.n?"0":1===a.n?"":-1===a.n?"-":a.n.toString()+"")+(1===a.d?"":"/"+a.d.toString())),string:r,value:a.n/a.d*Math.PI};if(y(t))return{ariaString:p(r=function(e){return"-0"===e?"0":e}(f(e.toFixed(m(t))))),string:r,value:parseFloat(r)};var o=h(e.toExponential(m(t/e))).split("e"),s=o[0]+"10",u=o[1].replace("+","");return{ariaString:p(r=h(e.toExponential(m(t/e))).replace("+","")),string:r,mantissa:s,superscript:u,value:parseFloat(r)}}Object.defineProperty(t,"__esModule",{value:!0}),t.trimLatex=t.latexToIdentifier=t.identifierToHTML=t.identifierToLatex=t.formatSymbol=t.truncatedAriaLabel=t.truncatedLatexLabel=t.truncatedPlainmathLabel=t.truncatedHTMLLabel=t.numericLabel=t.canDisplayAsFraction=t.point=t.value=void 0,t.value=a;var o={"[e]":" times 10 to the ","[+]":" plus ","[-]":" minus ","[*]":" times ","[/]":" over ","[]":" pi ","[]":" tau ","[]":" theta ","[]":" phi "},s=new RegExp(Object.keys(o).join("|"),"gi");function u(e){return o["["+e+"]"]}var c=/(\.)([0-9]+)/g;function l(e,t,r){return t+r.split("").join(" ").trim()}function p(e){return e.replace(c,l).replace(s,u).replace(/ +/gi," ").trim()}t.point=function(e,t,r,n){var i=a(e,t);return[i,a(n(i.value),r)]};var d=/\.?0+$/;function f(e){return-1===e.indexOf(".")?e:e.replace(d,"")}function h(e){return e.replace(/\.?0+e/,"e")}function y(e){return 1e-4<(e=Math.abs(e))&&e<1e7}function m(e){return e=Math.abs(e),e=Math.max(e,1e-16),Math.max(3,Math.floor(4.5-Math.log(e)/Math.LN10))}function v(e){return 1e6/Math.sqrt(Math.abs(e))}function g(e){var t=v(e);if(t<1)return!1;if(t>1e12)return!1;var r=i.default(e,t),n=r.n,a=r.d;return 1!==a&&e===e+Math.pow(2,-3)*Math.abs(n/a-e)}function b(e,t){if(t=t||{},isNaN(e)||!isFinite(e))return{type:"undefined"};if(0===e||t.zeroCutoff&&Math.abs(e)<t.zeroCutoff)return{type:"decimal",value:"0"};var r=t.smallCutoff||.001,n=t.bigCutoff||1e6,a=t.digits||10,o=h(e.toExponential(a-2)).match(/([\d\.\-]+)e\+?([\d\-]+)/);if(!o)return{type:"undefined"};var s=parseInt(o[2],10)>=a;if(g(e)&&t.displayAsFraction){var u=i.default(e,v(e));return{type:"fraction",numerator:u.n.toString(),denominator:u.d.toString()}}if(Math.abs(e)>n||Math.abs(e)<r||s)return{type:"scientific",mantissa:o[1],exponent:o[2]};var c=f(e.toPrecision(a));return e!==Number(c)&&t.addEllipses&&(c+="..."),{type:"decimal",value:c}}function x(e){e=e.replace("\\","");var t={pi:"",tau:"",theta:"",phi:"",div:"",cdot:"",times:"",lt:"<",gt:">",le:"",ge:"",sim:"",ldots:"",prime:"",approx:"",to:"","->":""};return t.hasOwnProperty(e)?t[e]:e}t.canDisplayAsFraction=g,t.numericLabel=b,t.truncatedHTMLLabel=function(e,t){var r=b(e,t);switch(r.type){case"undefined":return"undefined";case"decimal":return r.value;case"scientific":return r.mantissa+"<span class='dcg-cross'></span>10<sup>"+r.exponent+"</sup>";case"fraction":return"1"===r.denominator?r.numerator:r.numerator+"/"+r.denominator;default:return r}},t.truncatedPlainmathLabel=function(e,t){var r=b(e,t);switch(r.type){case"undefined":return"undefined";case"decimal":return r.value;case"scientific":return r.mantissa+" * 10^"+r.exponent;case"fraction":return"1"===r.denominator?r.numerator:r.numerator+"/"+r.denominator;default:return r}},t.truncatedLatexLabel=function(e,t){var r=b(e,t);switch(r.type){case"undefined":return"undefined";case"decimal":return r.value;case"scientific":return r.mantissa+"\\times10^{"+r.exponent+"}";case"fraction":return"1"===r.denominator?r.numerator:"-"===r.numerator[0]?"-\\frac{"+r.numerator.slice(1)+"}{"+r.denominator+"}":"\\frac{"+r.numerator+"}{"+r.denominator+"}";default:return r}},t.truncatedAriaLabel=function(e,t){var r=b(e,t);switch(r.type){case"undefined":return"undefined";case"decimal":return p(r.value);case"scientific":return p(r.mantissa+"e"+r.exponent);case"fraction":return p(r.numerator+"/"+r.denominator);default:return r}},t.formatSymbol=x,t.identifierToLatex=function(e){var t=e.split("_"),r="";return t[0].length>1&&(r+="\\"),r+=t[0],t[1]&&(r+="_{"+t[1]+"}"),r},t.identifierToHTML=function(e){if(!e)return"";var t=e.split("_").map(x).map(r.escape),n=t[0];return t[1]&&(n+="<sub>"+t[1]+"</sub>"),n},t.latexToIdentifier=function(e){return(e=e.replace(/\\operatorname\{(.*)\}/,"$1")).replace(/[{}\\]/g,"")},t.trimLatex=function(e){return e.replace(/^(\\ | |\\space)+/,"").replace(/(\\ | |\\space)+$/,"")}});r("core/math/errormsg",["require","exports","core/math/parsenode/error","core/lib/worker-i18n","core/lib/label","core/math/types"],function(e,t,r,n,i,a){"use strict";function o(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-multiply-defined",{dependency:e}))}Object.defineProperty(t,"__esModule",{value:!0}),t.variableLengthProductBodyDependsOnIndex=t.variableLengthSumBodyDependsOnIndex=t.variableLengthDistributionList=t.variableLengthTopLevelList=t.badListComprehensionInputDependency=t.shadowedListComprehensionInput=t.unexpectedForKeyword=t.listComprehensionIncorrectInput=t.listComprehensionInputListTypeError=t.matrixInvalidVariable=t.matrixElementTypeError=t.matrixPowerDimensions=t.matrixFractionalPower=t.matrixMultiplyDimensions=t.matrixSubtractDimensions=t.matrixAddDimensions=t.matrixAssignment=t.clickableObjectInvalidExpression=t.clickableObjectAssignmentNotIdentifier=t.clickableObjectAlreadyAssigned=t.clickableObjectAssignmentNotDefined=t.singularInverse=t.nonSquareInverse=t.nonSquareTrace=t.nonSquareDeterminant=t.fractionsUnavailable=t.featureUnavailable=t.pointsUnsupported=t.regressionsUnsupported=t.inequalitiesUnsupported=t.equationsUnsupported=t.functionDefinitionsUnsupported=t.assignmentsUnsupported=t.constantUnsupported=t.logbaseUnsupported=t.functionUnsupported=t.variablesUnsupported=t.ansUndefined=t.badSymbolContext=t.variableSeed=t.badSampleSize=t.ttestListTooShort=t.illegalBinWidth=t.percentMissingOf=t.badIntegralBoundDependency=t.shadowedIntegrationVariable=t.mismatchedBraces=t.derivativeMissingBody=t.integralMissingBody=t.productMissingBody=t.sumMissingBody=t.differentialWithSuperscript=t.integralMissingDifferential=t.integralMissingBound=t.badProductBoundDependency=t.badSumBoundDependency=t.incorrectProductLowerBound=t.incorrectSumLowerBound=t.productMissingBound=t.sumMissingBound=t.invalidHalfEmptyRange=t.nonArithmeticRange=t.functionFreeVariable=t.methodRequiresList=t.nonListParameterizedReducer=t.nonListDoubleReducer=t.optimizationError=t.invalidRegressionParameter=t.invalidDependentFirstTableColumn=t.invalidFirstTableColumn=t.invalidTableEntry=t.invalidTableHeader=t.distributionAsFunction=t.variableAsFunction=t.equationRequired=t.complicatedDoubleInequality=t.mismatchedDoubleInequality=t.invalidDoubleInequalityVariables=t.complicatedPolarImplicit=t.inequalitiesDisabled=t.implicitsDisabled=t.singleVariableImplicitEquationsDisabled=t.invalidImplicitVariables=t.invalidInequalityVariables=t.unplottablePolarFunction=t.invalidLHS=t.addArgumentsToDefinition=t.tooManyVariables=t.cdfMaxLessThanMin=t.cdfMaxInvalid=t.cdfMinInvalid=t.domainMaxLessThanMin=t.domainMaxInvalid=t.domainMinInvalid=t.sliderStepInvalid=t.sliderMaxLessThanMin=t.sliderMaxInvalid=t.sliderMinInvalid=t.sliderLimitReferencesExport=t.tickerMinStepNonNegativeNumber=t.selfReferentialFunction=t.cycle=t.shadowedIndex=t.multiplyDefinedByTables=t.multiplyDefined=t.cannotSubscript=t.cannotRedefine=t.parameterAlreadyDefined=t.functionNotDefined=t.blankExpression=t.colonMissingCondition=t.piecewisePartMissingCondition=t.piecewiseMissingCondition=t.inequalityChainTooLong=t.badLogExponent=t.badTrigExponent=t.emptyPipe=t.emptySquareBracket=t.emptyParen=t.emptyRadicalIndex=t.emptyRadical=t.primeWithoutParen=t.unexpectedPrime=t.superscriptWithPrime=t.unexpectedSubscript=t.invalidOperatorName=t.invalidSubscript=t.emptySuperscript=t.emptySubscript=t.fractionEmpty=t.fractionMissingDenominator=t.fractionMissingNumerator=t.unaryOperatorMissingRight=t.unaryOperatorMissingLeft=t.binaryOperatorMissingOperand=t.identifierAsFunction=t.adjacentNumbers=t.badImplicitCall=t.badTupleDimensions=t.malformedList=t.malformedPoint=t.zeroArgReducer=t.primedFunctionArity=t.wrongDoubleReducerArity=t.wrongParameterizedReducerArity=t.wrongArity=t.colorArity=t.randomFromBroadcastDistribution=t.randomArity=t.tdistWrongArity=t.cdfTooManyArguments=t.cdfRequiresArguments=t.pdfWrongArity=t.tooManyArguments=t.boxplotBreadthInvalid=t.boxplotOffsetInvalid=t.polygonTwoNumbersError=t.polygonPointArgsError=t.polygonListTypeError=t.maxListSize=t.deeplyNested=t.combineTypeError=t.heterogeneousList=t.eventHandlerTypeError=t.actionMergeFreeVariable=t.updateRuleLocalLHS=t.updateRuleFunctionLHS=t.updateRuleIllegalLHS=t.updateRuleUndefinedLHS=t.duplicateUpdateRules=t.updateRuleNonIdentifierLHS=t.updateRuleTypeError=t.regressionTypeError=t.tableEntryTypeError=t.tableHeaderTypeError=t.piecewiseBranchTypeError=t.piecewiseConditionTypeError=t.derivativeVariableTypeError=t.derivativeTypeError=t.integralArgumentTypeError=t.integralUpperBoundTypeError=t.integralLowerBoundTypeError=t.productArgumentTypeError=t.productInfiniteBoundError=t.productUpperBoundTypeError=t.productLowerBoundTypeError=t.sumArgumentTypeError=t.sumInfiniteBoundError=t.sumUpperBoundTypeError=t.sumLowerBoundTypeError=t.dotLHSTypeError=t.illegalDotCall=t.functionTypeError=t.orderedPairAccessTypeError=t.indexTypeError=t.pointTypeError=t.listTypeError=t.andTypeError=t.comparatorTypeError=t.negativeTypeError=t.exponentTypeError=t.divideTypeError=t.multiplyTypeError=t.subtractTypeError=t.addTypeError=t.unexpectedSymbol=t.unexpectedInequality=t.unrecognizedSymbol=t.parseError=void 0,t.parseError=function(){return r(n.s("shared-calculator-error-parse-error"))},t.unrecognizedSymbol=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-unrecognized-symbol",{symbol:e}))},t.unexpectedInequality=function(){return r(n.s("shared-calculator-error-unexpected-inequality"))},t.unexpectedSymbol=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-unexpected-symbol",{symbol:e}))},t.addTypeError=function(e){return r(n.s("shared-calculator-error-add-type-error",{symbol1:e[0],symbol2:e[1]})).allowExport()},t.subtractTypeError=function(e){return r(n.s("shared-calculator-error-subtract-type-error",{symbol1:e[0],symbol2:e[1]})).allowExport()},t.multiplyTypeError=function(e){return r(n.s("shared-calculator-error-multiply-type-error",{symbol1:e[0],symbol2:e[1]})).allowExport()},t.divideTypeError=function(e){return r(n.s("shared-calculator-error-divide-type-error",{symbol1:e[0],symbol2:e[1]})).allowExport()},t.exponentTypeError=function(e){return r(n.s("shared-calculator-error-exponent-type-error",{symbol1:e[0],symbol2:e[1]})).allowExport()},t.negativeTypeError=function(e){return r(n.s("shared-calculator-error-negative-type-error",{symbol:e[0]})).allowExport()},t.comparatorTypeError=function(e){return r(n.s("shared-calculator-error-comparator-type-error",{symbol1:e[0],symbol2:e[1]})).allowExport()},t.andTypeError=function(e){return r(n.s("shared-calculator-error-and-type-error",{symbol:"and",symbol1:e[0],symbol2:e[1]})).allowExport()},t.listTypeError=function(e){return r(n.s("shared-calculator-error-list-type-error",{symbol1:e[0]})).allowExport()},t.pointTypeError=function(e){return r(n.s("shared-calculator-error-point-type-error",{symbol1:e,symbol2:a.prettyPrint(a.Point)})).allowExport()},t.indexTypeError=function(e){return r(n.s("shared-calculator-error-index-type-error",{symbol1:e[0],symbol2:e[1]})).allowExport()},t.orderedPairAccessTypeError=function(e){return r(n.s("shared-calculator-error-ordered-pair-access-type-error",{symbol:e[0]})).allowExport()},t.functionTypeError=function(e,t){switch(t.length){case 1:return r(n.s("shared-calculator-error-function-type-error-1",{fn:i.formatSymbol(e),arg:t[0]})).allowExport();case 2:return r(n.s("shared-calculator-error-function-type-error-2",{fn:i.formatSymbol(e),arg1:t[0],arg2:t[1]})).allowExport();default:return r(n.s("shared-calculator-error-function-type-error-many",{fn:i.formatSymbol(e)})).allowExport()}},t.illegalDotCall=function(e){return r(n.s("shared-calculator-error-illegal-dot-call",{symbol:i.formatSymbol(e)}))},t.dotLHSTypeError=function(e,t){return r(n.s("shared-calculator-error-dot-lhs-type-error",{symbol:i.formatSymbol(e),type:t})).allowExport()},t.sumLowerBoundTypeError=function(e){return r(n.s("shared-calculator-error-sum-lower-bound-type-error",{symbol:e[0]})).allowExport()},t.sumUpperBoundTypeError=function(e){return r(n.s("shared-calculator-error-sum-upper-bound-type-error",{symbol:e[0]})).allowExport()},t.sumInfiniteBoundError=function(){return r(n.s("shared-calculator-error-sum-infinite-bound-type-error"))},t.sumArgumentTypeError=function(e){return r(n.s("shared-calculator-error-sum-argument-type-error",{symbol:e[0]})).allowExport()},t.productLowerBoundTypeError=function(e){return r(n.s("shared-calculator-error-product-lower-bound-type-error",{symbol:e[0]})).allowExport()},t.productUpperBoundTypeError=function(e){return r(n.s("shared-calculator-error-product-upper-bound-type-error",{symbol:e[0]})).allowExport()},t.productInfiniteBoundError=function(){return r(n.s("shared-calculator-error-product-infinite-bound-type-error"))},t.productArgumentTypeError=function(e){return r(n.s("shared-calculator-error-product-argument-type-error",{symbol:e[0]})).allowExport()},t.integralLowerBoundTypeError=function(e){return r(n.s("shared-calculator-error-integral-lower-bound-type-error",{symbol:e[0]})).allowExport()},t.integralUpperBoundTypeError=function(e){return r(n.s("shared-calculator-error-integral-upper-bound-type-error",{symbol:e[0]})).allowExport()},t.integralArgumentTypeError=function(e){return r(n.s("shared-calculator-error-integral-argument-type-error",{symbol:e[0]})).allowExport()},t.derivativeTypeError=function(e){return r(n.s("shared-calculator-error-derivative-type-error",{symbol:e[0]})).allowExport()},t.derivativeVariableTypeError=function(e,t){return r(n.s("shared-calculator-error-derivative-variable-type-error",{symbol1:i.formatSymbol(e),symbol2:t[0]}))},t.piecewiseConditionTypeError=function(e){return r(n.s("shared-calculator-error-piecewise-condition-type-error",{symbol1:a.prettyPrint(a.Bool),symbol2:e[0]})).allowExport()},t.piecewiseBranchTypeError=function(e){return r(n.s("shared-calculator-error-piecewise-branch-type-error",{symbol1:e[0],symbol2:e[1]})).allowExport()},t.tableHeaderTypeError=function(e){return r(n.s("shared-calculator-error-table-header-type-error",{symbol:e[0]}))},t.tableEntryTypeError=function(e){return r(n.s("shared-calculator-error-table-entry-type-error",{symbol:e[0]}))},t.regressionTypeError=function(e){return r(n.s("shared-calculator-error-regression-type-error",{symbol1:e[0],symbol2:e[1]}))},t.updateRuleTypeError=function(e){return r(n.s("shared-calculator-error-update-rule-type-error",{symbol:e}))},t.updateRuleNonIdentifierLHS=function(){return r(n.s("shared-calculator-error-update-rule-non-identifier-lhs",{arrow:"",example:"a"}))},t.duplicateUpdateRules=function(e){return r(n.s("shared-calculator-error-duplicate-update-rules",{symbol:i.formatSymbol(e)}))},t.updateRuleUndefinedLHS=function(e){return r(n.s("shared-calculator-error-update-rule-undefined-lhs",{symbol:i.formatSymbol(e)}))},t.updateRuleIllegalLHS=function(e){return r(n.s("shared-calculator-error-update-rule-illegal-lhs",{symbol:i.formatSymbol(e)}))},t.updateRuleFunctionLHS=function(e){return r(n.s("shared-calculator-error-update-rule-function-lhs",{symbol:i.formatSymbol(e)}))},t.updateRuleLocalLHS=function(e){return r(n.s("shared-calculator-error-update-rule-local-lhs",{symbol:i.formatSymbol(e)}))},t.actionMergeFreeVariable=function(e){var t=e.filter(function(e){return"free"===e.scope}).map(function(e){return e.symbol});return r(n.s("shared-calculator-error-action-merge-free-variable",{symbol:i.formatSymbol(t[0]||"")})).setDependencies(t).allowExport()},t.eventHandlerTypeError=function(e){return r(n.s("shared-calculator-error-event-handler-type-error",{example:"aa+1"}))},t.heterogeneousList=function(){return r(n.s("shared-calculator-error-heterogeneous-list")).allowExport()},t.combineTypeError=function(e){return r(n.s("shared-calculator-error-combine-type-error",{symbol1:e[0],symbol2:e[1]})).allowExport()},t.deeplyNested=function(){return r(n.s("shared-calculator-error-deeply-nested")).allowExport()},t.maxListSize=function(e){return r(n.s("shared-calculator-error-max-list-size",{maxListSize:e})).allowExport()},t.polygonListTypeError=function(e){return r(n.s("shared-calculator-error-polygon-list-type-error",{type:e[0]}))},t.polygonPointArgsError=function(){return r(n.s("shared-calculator-error-polygon-point-args-error"))},t.polygonTwoNumbersError=function(){return r(n.s("shared-calculator-error-two-numbers-error"))},t.boxplotOffsetInvalid=function(){return r(n.s("shared-calculator-error-boxplot-offset-invalid"))},t.boxplotBreadthInvalid=function(){return r(n.s("shared-calculator-error-boxplot-breadth-invalid"))},t.tooManyArguments=function(e,t){return r(n.s("shared-calculator-error-too-many-arguments",{symbol:e,max:t}))},t.pdfWrongArity=function(){var e=n.s("shared-calculator-error-pdf-wrong-arity-recommendation"),t=n.s("shared-calculator-error-pdf-wrong-arity",{recommendation:e});return r(t)},t.cdfRequiresArguments=function(){var e=n.s("shared-calculator-error-cdf-wrong-arity-recommendation"),t=n.s("shared-calculator-error-cdf-wrong-arity",{recommendation:e});return r(t)},t.cdfTooManyArguments=function(){var e=n.s("shared-calculator-error-cdf-too-many-arguments-recommendation"),t=n.s("shared-calculator-error-cdf-too-many-arguments",{recommendation:e});return r(t)},t.tdistWrongArity=function(){return r(n.s("shared-calculator-error-tdist-wrong-arity"))},t.randomArity=function(){return r(n.s("shared-calculator-error-random-arity"))},t.randomFromBroadcastDistribution=function(){return r(n.s("shared-calculator-error-random-from-broadcast-distribution"))},t.colorArity=function(e){var t="rgb"===e?[150,30,100]:[180,.5,.5],a=n.s("shared-calculator-error-color-arity-recommendation",{recommendation:i.formatSymbol(e)+"("+t.join(", ")+")"}),o=n.s("shared-calculator-error-color-arity",{symbol:e,recommendation:a});return r(o)},t.wrongArity=function(e,t,a,o){var s,u;if(e=i.formatSymbol(e),1===t)o||(o=e+"(x)"),u=n.s("shared-calculator-error-wrong-arity-supplement",{recommendation:o}),s=a>1?n.s("shared-calculator-error-wrong-arity-single-arg-too-many",{dependency:e,supplement:u}):n.s("shared-calculator-error-wrong-arity-single-arg-too-few",{dependency:e,supplement:u});else{var c=[];if(!o){for(var l=0;l<t;l++)c[l]=l+1;o=i.formatSymbol(e)+"("+c.join(", ")+")"}u=n.s("shared-calculator-error-wrong-arity-supplement",{recommendation:o}),s=n.s("shared-calculator-error-wrong-arity-many-arg",{dependency:e,assignment_arity:t,supplement:u})}return r(s)},t.wrongParameterizedReducerArity=function(e){return r(n.s("shared-calculator-error-wrong-two-arg-arity",{symbol:i.formatSymbol(e),recommendation:i.formatSymbol(e)+"([1,2,3], 1)"}))},t.wrongDoubleReducerArity=function(e){return r(n.s("shared-calculator-error-wrong-two-arg-arity",{symbol:i.formatSymbol(e),recommendation:i.formatSymbol(e)+"([1,2,3], [3,2,1])"}))},t.primedFunctionArity=function(){return r(n.s("shared-calculator-error-primed-function-arity"))},t.zeroArgReducer=function(e){return r(n.s("shared-calculator-error-zero-arg-reducer",{symbol:i.formatSymbol(e)}))},t.malformedPoint=function(){return r(n.s("shared-calculator-error-malformed-point"))},t.malformedList=function(){return r(n.s("shared-calculator-error-malformed-list"))},t.badTupleDimensions=function(e){return r(n.s("shared-calculator-error-bad-tuple-dimensions",{symbol:e}))},t.badImplicitCall=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-bad-implicit-call",{symbol:e}))},t.adjacentNumbers=function(e,t){return r(n.s("shared-calculator-error-adjacent-numbers",{left:e,right:t}))},t.identifierAsFunction=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-identifier-as-function",{symbol:e}))},t.binaryOperatorMissingOperand=function(e){return"%"===(e=i.formatSymbol(e))&&(e="% of"),r(n.s("shared-calculator-error-binary-operator-missing-operand",{symbol:e}))},t.unaryOperatorMissingLeft=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-unary-operator-missing-left",{symbol:e}))},t.unaryOperatorMissingRight=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-unary-operator-missing-right",{symbol:e}))},t.fractionMissingNumerator=function(){return r(n.s("shared-calculator-error-fraction-missing-numerator"))},t.fractionMissingDenominator=function(){return r(n.s("shared-calculator-error-fraction-missing-denominator"))},t.fractionEmpty=function(){return r(n.s("shared-calculator-error-fraction-empty"))},t.emptySubscript=function(){return r(n.s("shared-calculator-error-empty-subscript"))},t.emptySuperscript=function(){return r(n.s("shared-calculator-error-empty-superscript"))},t.invalidSubscript=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-invalid-subscript",{symbol:e}))},t.invalidOperatorName=function(){return r(n.s("shared-calculator-error-invalid-operator-name"))},t.unexpectedSubscript=function(){return r(n.s("shared-calculator-error-unexpected-subscript"))},t.superscriptWithPrime=function(){return r(n.s("shared-calculator-error-superscript-with-prime"))},t.unexpectedPrime=function(){return r(n.s("shared-calculator-error-unexpected-prime"))},t.primeWithoutParen=function(){return r(n.s("shared-calculator-error-prime-without-paren"))},t.emptyRadical=function(){return r(n.s("shared-calculator-error-empty-radical"))},t.emptyRadicalIndex=function(){return r(n.s("shared-calculator-error-empty-radical-index"))},t.emptyParen=function(){return r(n.s("shared-calculator-error-empty-paren"))},t.emptySquareBracket=function(){return r(n.s("shared-calculator-error-empty-square-bracket"))},t.emptyPipe=function(){return r(n.s("shared-calculator-error-empty-pipe"))},t.badTrigExponent=function(e){var t=e+"^2",i=e+"^-1";return r(n.s("shared-calculator-error-bad-trig-exponent",{form1:t,form2:i}))},t.badLogExponent=function(e){var t=e+"^2";return r(n.s("shared-calculator-error-bad-log-exponent",{form:t}))},t.inequalityChainTooLong=function(){return r(n.s("shared-calculator-error-inequality-chain-too-long"))},t.piecewiseMissingCondition=function(){return r(n.s("shared-calculator-error-piecewise-missing-condition"))},t.piecewisePartMissingCondition=function(){return r(n.s("shared-calculator-error-piecewise-part-missing-condition"))},t.colonMissingCondition=function(){return r(n.s("shared-calculator-error-colon-missing-condition"))},t.blankExpression=function(){return r(n.s("shared-calculator-error-blank-expression"))},t.functionNotDefined=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-function-not-defined",{dependency:e}))},t.parameterAlreadyDefined=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-parameter-already-defined",{dependency:e}))},t.cannotRedefine=function(e,t){return e=i.formatSymbol(e),r(void 0===t?n.s("shared-calculator-error-cannot-redefine",{symbol:e}):n.s("shared-calculator-error-cannot-redefine-root",{symbol:e,symbolRoot:t}))},t.cannotSubscript=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-cannot-subscript",{symbol:e}))},t.multiplyDefined=o,t.multiplyDefinedByTables=function(e){var t=o(e);return t.isMultiplyDefinedByTables=!0,t},t.shadowedIndex=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-shadowed-index",{symbol:e}))},t.cycle=function(e){var t=(e=e.map(i.formatSymbol)).pop()||"";return r(n.s("shared-calculator-error-dependency-cycle",{symbols:e.join("', '"),lastSymbol:t}))},t.selfReferentialFunction=function(e){return r(n.s("shared-calculator-error-self-referential-function",{symbol:i.formatSymbol(e)}))},t.tickerMinStepNonNegativeNumber=function(){return r(n.s("shared-calculator-error-ticker-min-step-nonnegative"))},t.sliderLimitReferencesExport=function(e){return r(n.s("shared-calculator-error-slider-limit-references-export",{symbol:i.formatSymbol(e)}))},t.sliderMinInvalid=function(){return r(n.s("shared-calculator-error-slider-min-invalid"))},t.sliderMaxInvalid=function(){return r(n.s("shared-calculator-error-slider-max-invalid"))},t.sliderMaxLessThanMin=function(){return r(n.s("shared-calculator-error-slider-max-less-than-min"))},t.sliderStepInvalid=function(){return r(n.s("shared-calculator-error-slider-step-invalid"))},t.domainMinInvalid=function(){return r(n.s("shared-calculator-error-domain-min-invalid"))},t.domainMaxInvalid=function(){return r(n.s("shared-calculator-error-domain-max-invalid"))},t.domainMaxLessThanMin=function(){return r(n.s("shared-calculator-error-domain-max-less-than-min"))},t.cdfMinInvalid=function(){return r(n.s("shared-calculator-error-cdf-min-invalid"))},t.cdfMaxInvalid=function(){return r(n.s("shared-calculator-error-cdf-max-invalid"))},t.cdfMaxLessThanMin=function(){return r(n.s("shared-calculator-error-cdf-max-less-than-min"))},t.tooManyVariables=function(e){if(0===(e=e.map(i.formatSymbol)).length)return r(n.s("shared-calculator-error-too-many-variables-no-symbols"));var t=e.pop()||"";return e.length>0?r(n.s("shared-calculator-error-too-many-variables-many-symbols",{variables:e.join("', '"),lastVariable:t})):r(n.s("shared-calculator-error-too-many-variables-one-symbol",{variable:t}))},t.addArgumentsToDefinition=function(e,t,a){e=e.map(i.formatSymbol);var o=(t=i.formatSymbol(t))+"("+(a=a.map(i.formatSymbol)).join(",")+","+e.join(",")+")",s=e.pop()||"",u={symbols:e.join("', '"),lastSymbol:s,newSignature:o};return e.length?r(n.s("shared-calculator-error-add-arguments-to-definition-many",u)):r(n.s("shared-calculator-error-add-arguments-to-definition-one",u))},t.invalidLHS=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-invalid-lhs",{symbol:e}))},t.unplottablePolarFunction=function(){return r(n.s("shared-calculator-error-unplottable-polar-function"))},t.invalidInequalityVariables=function(){return r(n.s("shared-calculator-error-invalid-inequality-variables"))},t.invalidImplicitVariables=function(){return r(n.s("shared-calculator-error-invalid-implicit-variables"))},t.singleVariableImplicitEquationsDisabled=function(){return r(n.s("shared-calculator-error-single-variable-implicit-equations-disabled"))},t.implicitsDisabled=function(){return r(n.s("shared-calculator-error-implicits-disabled"))},t.inequalitiesDisabled=function(){return r(n.s("shared-calculator-error-inequalities-disabled"))},t.complicatedPolarImplicit=function(){return r(n.s("shared-calculator-error-complicated-polar-implicit"))},t.invalidDoubleInequalityVariables=function(){return r(n.s("shared-calculator-error-invalid-double-inequality-variables"))},t.mismatchedDoubleInequality=function(){return r(n.s("shared-calculator-error-mismatched-double-inequality",{example:"1 < y < 2"}))},t.complicatedDoubleInequality=function(){return r(n.s("shared-calculator-error-complicated-double-inequality"))},t.equationRequired=function(e){return e?(e=i.formatSymbol(e),r(n.s("shared-calculator-error-equation-required-symbol",{lhs:e+"="}))):r(n.s("shared-calculator-error-equation-required"))},t.variableAsFunction=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-variable-as-function",{dependency:e}))},t.distributionAsFunction=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-distribution-as-function",{symbol:e}))},t.invalidTableHeader=function(e){return r(n.s("shared-calculator-error-invalid-table-header",{supplement:e}))},t.invalidTableEntry=function(e){return r(n.s("shared-calculator-error-invalid-table-entry",{supplement:e}))},t.invalidFirstTableColumn=function(){return r(n.s("shared-calculator-error-invalid-first-table-column",{most:"'y', 'r',",last:"''"}))},t.invalidDependentFirstTableColumn=function(){return r(n.s("shared-calculator-error-invalid-dependent-first-table-column"))},t.invalidRegressionParameter=function(e){return r(n.s("shared-calculator-error-invalid-regression-parameter",{symbol:i.formatSymbol(e)}))},t.optimizationError=function(){return r(n.s("shared-calculator-error-optimization-error"))},t.nonListDoubleReducer=function(e){return r(n.s("shared-calculator-error-non-list-double-reducer",{symbol:i.formatSymbol(e),recommendation:i.formatSymbol(e)+"([1,2,3], [3,2,1])"})).allowExport()},t.nonListParameterizedReducer=function(e){return r(n.s("shared-calculator-error-non-list-parameterized-reducer",{symbol:i.formatSymbol(e),recommendation:i.formatSymbol(e)+"([1,2,3], 1)"})).allowExport()},t.methodRequiresList=function(e){return r(n.s("shared-calculator-error-method-requires-list",{symbol:i.formatSymbol(e),recommendation:i.formatSymbol(e)+"([1,2,3])"})).allowExport()},t.functionFreeVariable=function(e,t){return r(n.s("shared-calculator-error-variable-function-free-variable",{functionSymbol:e,variableSymbol:t})).allowExport()},t.nonArithmeticRange=function(){return r(n.s("shared-calculator-error-non-arithmetic-range")).allowExport()},t.invalidHalfEmptyRange=function(){return r(n.s("shared-calculator-error-invalid-half-empty-range"))},t.sumMissingBound=function(){return r(n.s("shared-calculator-error-sum-missing-bound"))},t.productMissingBound=function(){return r(n.s("shared-calculator-error-product-missing-bound"))},t.incorrectSumLowerBound=function(){return r(n.s("shared-calculator-error-incorrect-sum-lower-bound"))},t.incorrectProductLowerBound=function(){return r(n.s("shared-calculator-error-incorrect-product-lower-bound"))},t.badSumBoundDependency=function(e){return r(n.s("shared-calculator-error-bad-sum-bound-dependency",{symbol:i.formatSymbol(e)}))},t.badProductBoundDependency=function(e){return r(n.s("shared-calculator-error-bad-product-bound-dependency",{symbol:i.formatSymbol(e)}))},t.integralMissingBound=function(){return r(n.s("shared-calculator-error-integral-missing-bound"))},t.integralMissingDifferential=function(){return r(n.s("shared-calculator-error-integral-missing-differential"))},t.differentialWithSuperscript=function(){return r(n.s("shared-calculator-error-differential-with-superscript"))},t.sumMissingBody=function(){return r(n.s("shared-calculator-error-sum-missing-body"))},t.productMissingBody=function(){return r(n.s("shared-calculator-error-product-missing-body"))},t.integralMissingBody=function(){return r(n.s("shared-calculator-error-integral-missing-body"))},t.derivativeMissingBody=function(){return r(n.s("shared-calculator-error-derivative-missing-body"))},t.mismatchedBraces=function(e,t){return e=i.formatSymbol(e),t=i.formatSymbol(t),r(n.s("shared-calculator-error-mismatched-braces",{symbol1:e,symbol2:t}))},t.shadowedIntegrationVariable=function(e){return r(n.s("shared-calculator-error-shadowed-integration-variable",{symbol:i.formatSymbol(e)}))},t.badIntegralBoundDependency=function(e){return r(n.s("shared-calculator-error-bad-integral-bound-dependency",{symbol:i.formatSymbol(e)}))},t.percentMissingOf=function(){return r(n.s("shared-calculator-error-percent-missing-of"))},t.illegalBinWidth=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-illegal-bin-width",{symbol:e}))},t.ttestListTooShort=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-ttest-list-too-short",{symbol:e}))},t.badSampleSize=function(){return r(n.s("shared-calculator-error-bad-sample-size"))},t.variableSeed=function(e){return r(n.s("shared-calculator-error-variable-seed",{symbol:i.formatSymbol(e[0].symbol)})).setDependencies(e.filter(function(e){return"free"===e.scope}).map(function(e){return e.symbol})).allowExport()},t.badSymbolContext=function(e){return r(n.s("shared-calculator-error-bad-symbol-context",{symbol:i.formatSymbol(e)}))},t.ansUndefined=function(){return r(n.s("shared-calculator-error-ans-undefined"))},t.variablesUnsupported=function(e){return r(n.s("shared-calculator-error-variables-unsupported",{variable:i.formatSymbol(e)}))},t.functionUnsupported=function(e){return r(n.s("shared-calculator-error-function-unsupported",{symbol:i.formatSymbol(e)}))},t.logbaseUnsupported=function(){return r(n.s("shared-calculator-error-logbase-unsupported"))},t.constantUnsupported=function(e){return r(n.s("shared-calculator-error-constant-unsupported",{symbol:i.formatSymbol(e)}))},t.assignmentsUnsupported=function(){return r(n.s("shared-calculator-error-assignments-unsupported"))},t.functionDefinitionsUnsupported=function(){return r(n.s("shared-calculator-error-function-definition-unsupported"))},t.equationsUnsupported=function(){return r(n.s("shared-calculator-error-equations-unsupported"))},t.inequalitiesUnsupported=function(){return r(n.s("shared-calculator-error-inequalities-unsupported"))},t.regressionsUnsupported=function(){return r(n.s("shared-calculator-error-regressions-unsupported"))},t.pointsUnsupported=function(){return r(n.s("shared-calculator-error-points-unsupported"))},t.featureUnavailable=function(){return r(n.s("shared-calculator-error-feature-unavailable"))},t.fractionsUnavailable=function(){return r(n.s("basic-calculator-error-fractions-unavailable"))},t.nonSquareDeterminant=function(){return r(n.s("shared-calculator-error-non-square-determinant"))},t.nonSquareTrace=function(){return r(n.s("shared-calculator-error-non-square-trace"))},t.nonSquareInverse=function(){return r(n.s("shared-calculator-error-non-square-inverse"))},t.singularInverse=function(){return r(n.s("shared-calculator-error-non-singular-inverse"))},t.clickableObjectAssignmentNotDefined=function(e){return r(n.s("shared-calculator-error-clickable-object-assignment-not-defined",{symbol:e}))},t.clickableObjectAlreadyAssigned=function(e){return r(n.s("shared-calculator-error-multiply-defined",{dependency:e}))},t.clickableObjectAssignmentNotIdentifier=function(){return r(n.s("shared-calculator-error-clickable-object-assignment-not-identifier"))},t.clickableObjectInvalidExpression=function(){return r(n.s("shared-calculator-error-clickable-object-invalid-expression"))},t.matrixAssignment=function(){return r(n.s("shared-calculator-error-matrix-assignment"))},t.matrixAddDimensions=function(){return r(n.s("shared-calculator-error-matrix-add-dimensions"))},t.matrixSubtractDimensions=function(){return r(n.s("shared-calculator-error-matrix-subtract-dimensions"))},t.matrixMultiplyDimensions=function(){return r(n.s("shared-calculator-error-matrix-multiply-dimensions"))},t.matrixFractionalPower=function(){return r(n.s("shared-calculator-error-matrix-fractional-power"))},t.matrixPowerDimensions=function(){return r(n.s("shared-calculator-error-matrix-power-dimensions"))},t.matrixElementTypeError=function(e){return r(n.s("shared-calculator-error-matrix-element-type-error",{arg:e[0]}))},t.matrixInvalidVariable=function(e){return r(n.s("shared-calculator-error-matrix-invalid-variable",{symbol:i.formatSymbol(e)}))},t.listComprehensionInputListTypeError=function(e,t){return r(n.s("shared-calculator-error-list-comprehension-input-type-error",{identifier:e,actual:t}))},t.listComprehensionIncorrectInput=function(){return r(n.s("shared-calculator-error-incorrect-list-comprehension-input"))},t.unexpectedForKeyword=function(){return r(n.s("shared-calculator-error-unexpected-for-keyword"))},t.shadowedListComprehensionInput=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-shadowed-list-comprehension-input",{symbol:e}))},t.badListComprehensionInputDependency=function(e){return e=i.formatSymbol(e),r(n.s("shared-calculator-error-bad-list-comprehension-input-dependency",{symbol:e}))},t.variableLengthTopLevelList=function(e){var t=e.filter(function(e){return"free"===e.scope}).map(function(e){return e.symbol});return r(n.s("shared-calculator-error-variable-length-top-level-list",{symbol:i.formatSymbol(t[0]||"")})).setDependencies(t).allowExport()},t.variableLengthDistributionList=function(e){return r(n.s("shared-calculator-error-variable-length-distribution-list",{symbol:e[0].symbol})).setDependencies(e.filter(function(e){return"free"===e.scope}).map(function(e){return e.symbol}))},t.variableLengthSumBodyDependsOnIndex=function(e){return r(n.s("shared-calculator-error-variable-length-sum-body-depends-on-index",{symbol:e}))},t.variableLengthProductBodyDependsOnIndex=function(e){return r(n.s("shared-calculator-error-variable-length-product-body-depends-on-index",{symbol:e}))}});r("core/math/parsenode/expression",["require","pjs","./base","core/math/errormsg"],function(e){"use strict";var t=e("pjs"),r=e("./base"),n=e("core/math/errormsg");return t(r,function(e,t){e.init=function(e){if(!Array.isArray(e))throw new TypeError("Argument to expression constructor must be an Array.");t.init.call(this),this.args=e,this.registerDependencies(),this.computeTreeSize()},e.shouldExportAns=function(){return!0},e.registerDependencies=function(){for(var e=0;e<this.args.length;e++)this.mergeDependencies(this.args[e])},e.computeTreeSize=function(){for(var e=0,t=0;t<this.args.length;t++)this.args[t].treeSize&&(e+=this.args[t].treeSize);if(this.treeSize=e+1,e>1e4)throw n.deeplyNested()},e.copyWithArgs=function(e){return new this.constructor(e)}})});r("core/math/parsenode/expressionTypes",["require","pjs","./expression"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n={Add:t(r,{}),Subtract:t(r,{}),Multiply:t(r,{}),Divide:t(r,{}),Exponent:t(r,{}),Negative:t(r,{}),And:t(r,{isInequality:function(){return this.args[0].isInequality()&&this.args[1].isInequality()}}),PercentOf:t(r,{})};return n.RawExponent=t(n.Exponent,{}),n});r("core/math/builtin-common",["require","exports","./tofraction","core/math/distance"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.pow=t.gcd=void 0,t.gcd=function(e,t){if((e=Math.round(e))<0&&(e=-e),(t=Math.round(t))<0&&(t=-t),t>e){var r=t;t=e,e=r}if(0===t)return e;for(var n=e%t;n>0;)n=(e=t)%(t=n);return t},t.pow=function(e,t){if(!isFinite(e)&&0===t)return NaN;if(e>=0||t===Math.floor(t))return Math.pow(e,t);var i=r.default(t,100);return n.approx(i.n/i.d,t,2)&&i.d%2==1?(i.n%2==0?1:-1)*Math.pow(-e,t):NaN}});r("core/math/maybe-rational",["require","exports","./builtin-common"],function(e,t,r){"use strict";function n(e,t){return{n:e,d:t}}function i(e){return"object"==typeof e&&"number"==typeof e.n&&"number"==typeof e.d}Object.defineProperty(t,"__esModule",{value:!0}),t.total=t.mod=t.nthroot=t.sqrt=t.pow=t.div=t.sub=t.mul=t.add=t.reciprocal=t.abs=t.neg=t.maybeRational=t.isNanFloat=t.asFloat=t.fromDecimalString=t.isRational=void 0,t.isRational=i;var a=Math.pow(2,53)-1;function o(e){return i(e)?e.n/e.d:+e}function s(e,t){if(!isFinite(e)||!isFinite(t)||0===t||Math.floor(e)!==e||Math.floor(t)!==t||Math.abs(e)>a||Math.abs(t)>a)return e/t;t<0&&(e=-e,t=-t);var i=r.gcd(e,t);return n(e/i,t/i)}function u(e){return i(e)?n(-e.n,e.d):-e}function c(e){return i(e)?0===e.n?e.d/e.n:n(e.n<0?-e.d:e.d,Math.abs(e.n)):1/e}function l(e,t){if(!i(e)||!i(t))return o(e)+o(t);var n=r.gcd(e.d,t.d);return s(e.n*(t.d/n)+t.n*(e.d/n),e.d/n*t.d)}function p(e,t){if(!i(e)||!i(t))return o(e)*o(t);var n=r.gcd(e.n,t.d),a=r.gcd(t.n,e.d);return s(e.n/n*(t.n/a),e.d/a*(t.d/n))}function d(e,t){return l(e,u(t))}function f(e,t){return i(e)&&i(t)?p(e,c(t)):o(e)/o(t)}function h(e,t){if(!i(e)||!i(t))return r.pow(o(e),o(t));var n=function(e,t){var n=e,a=t;if(t.n<0&&(a=u(t),n=c(e)),!i(n)||!i(a))return r.pow(o(e),o(t));if(e=n,1===(t=a).d)return s(Math.pow(e.n,t.n),Math.pow(e.d,t.n));var l=e.n<0;if(l&&t.d%2!=1)return NaN;var p=(l?-1:1)*Math.round(Math.pow(Math.abs(e.n),1/t.d)),d=Math.round(Math.pow(Math.abs(e.d),1/t.d));return Math.pow(p,t.d)!==e.n||Math.pow(d,t.d)!==e.d?r.pow(o(e),o(t)):s(Math.pow(p,t.n),Math.pow(d,t.n))}(e,t);return i(n)?n:r.pow(o(e),o(t))}t.fromDecimalString=function(e){var t=e.match(/^(-)?(\d*)?(?:\.(\d*))?$/);if(!t)return NaN;var r=t[1],n=t[2],i=t[3];if(!n&&!i)return NaN;var o=!!r;if(i){var u,c=i.replace(/0+$/,""),l=c.length,p=Math.pow(10,l);return(u=parseInt(n||"0",10)*p+parseInt(c||"0",10))>a||p>a?parseFloat(e):s(o?-u:u,p)}return(u=parseInt(n,10))>a?parseFloat(e):s(o?-u:u,1)},t.asFloat=o,t.isNanFloat=function(e){return!i(e)&&isNaN(e)},t.maybeRational=s,t.neg=u,t.abs=function(e){return i(e)?n(Math.abs(e.n),Math.abs(e.d)):Math.abs(e)},t.reciprocal=c,t.add=l,t.mul=p,t.sub=d,t.div=f,t.pow=h,t.sqrt=function(e){if(!i(e))return Math.sqrt(e);var t=Math.round(Math.sqrt(e.n)),r=Math.round(Math.sqrt(e.d));return t*t!==e.n||r*r!==e.d?Math.sqrt(o(e)):s(t,r)},t.nthroot=function(e,t){return h(e,c(t))},t.mod=function(e,t){if(!i(e)||!i(t)){var r=o(e),a=o(t);return r-a*Math.floor(r/a)}return d(e,p(t,n(Math.floor(o(f(e,t))),1)))},t.total=function(e){for(var t=n(0,1),r=0,i=e;r<i.length;r++){t=l(t,i[r])}return t}});r("core/math/parsenode/constant",["require","pjs","./expression","core/math/maybe-rational"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("core/math/maybe-rational");return t(r,function(e,t){e.init=function(e){"number"==typeof e&&(e=n.maybeRational(e,1)),this._constantValue=e,t.init.call(this,[])},e.isConstant=!0,e.asValue=function(){return"boolean"==typeof this._constantValue?this._constantValue:n.asFloat(this._constantValue)},e.asCompilerValue=function(){return this._constantValue},e.scalarExprString=function(){return this.asValue()>0?String(this.asValue()):"("+String(this.asValue())+")"},e.getEvaluationInfo=function(){return[{val:this.asValue()}]},e.isNaN=function(){return"number"==typeof this.asValue()&&isNaN(this.asValue())}})});r("core/math/parsenode/mixednumber",["require","pjs","./constant"],function(e){"use strict";return e("pjs")(e("./constant"),function(e,t){e.init=function(e){t.init.call(this,e)},e.is_mixed_number=!0})});r("core/math/parsenode/identifier",["require","pjs","./expression","core/lib/label","core/math/parser/input-span"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("core/lib/label"),i=e("core/math/parser/input-span");return t(r,function(e,t,r){e.init=function(e){t.init.call(this,[]),this._symbol=n.latexToIdentifier(e),this._errorSymbol=this._symbol,this.addDependency(this._symbol)},e.setInputSpan=function(e){t.setInputSpan.call(this,e),this._errorSymbol=n.latexToIdentifier(this.getInputString())},e.getInputSpan=function(){return void 0===this._inputSpan?new i.Span(this._symbol,0,this._symbol.length):this._inputSpan}})});r("core/math/parsenode/ans",["require","pjs","./identifier"],function(e){"use strict";return e("pjs")(e("./identifier"),function(e,t,r){})});r("core/math/parsenode/list",["require","pjs","./expression","core/math/types"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("core/math/types");return t(r,function(e,t,r){e.init=function(e){t.init.call(this,e),this.length=e.length},e.isList=!0,e.asValue=function(){for(var e=[],t=0;t<this.args.length;t++)e.push(this.args[t].asValue());return e},e.asCompilerValue=function(){for(var e=[],t=0;t<this.args.length;t++)e.push(this.args[t].asCompilerValue());return e},e.getEvaluationInfo=function(){if(this.args.every(function(e){return e.isConstant}))return[{val:this.args.map(function(e){return e.asValue()})}]},r.eachArgs=function(e,t){var r=function(e){for(var t=1/0,r=0;r<e.length;r++)(e[r].isList||e[r].isBroadcast)&&(t=Math.min(t,e[r].length));return t}(e);if(isFinite(r))for(var i=0;i<r;i++){for(var a=[],o=0;o<e.length;o++)a.push(e[o].isList||n.isList(e[o].valueType)?e[o].elementAt(i):e[o]);t(a,i)}else t(e)},r.wrap=function(e){return e.isList||n.isList(e.valueType)?e:r([e])}})});r("core/math/parsenode/range",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t,r){e.init=function(e){t.init.call(this,e),this.beginning=e[0],this.end=e[1]},e.isHalfEmpty=function(){return this.end&&this.end.args&&0===this.end.args.length}})});r("core/math/parsenode/listaccess",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){t.init.call(this,e),this.list=e[0],this.index=e[1]}})});r("core/math/parsenode/dotaccess",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),{})});r("core/math/parsenode/parenseq",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),{})});r("core/math/parsenode/movablepoint",["require","pjs","./parenseq","core/math/types"],function(e){"use strict";var t=e("pjs"),r=e("./parenseq"),n=e("core/math/types");return t(r,function(e,t){e.asValue=function(){return[+this.args[0].asValue(),+this.args[1].asValue()]},e.asCompilerValue=function(){return[this.args[0].asCompilerValue(),this.args[1].asCompilerValue()]},e.init=function(e,r,i){t.init.call(this,e),this.moveStrategy=r,this.defaultDragMode=i,this.valueType=n.Point},e.isMovablePoint=!0})});r("core/math/parsenode/orderedpairaccess",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){t.init.call(this,e),this.point=e[0],this.index=e[1]}})});r("core/math/parsenode/bareseq",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),{})});r("core/math/comparators",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.get=t.table=void 0,t.table={"<":{inclusive:!1,direction:-1},"!=":{inclusive:!1,direction:0},">":{inclusive:!1,direction:1},"<=":{inclusive:!0,direction:-1},"=":{inclusive:!0,direction:0},">=":{inclusive:!0,direction:1}},t.get=function(e,t){switch(t){case-1:return e?"<=":"<";case 0:return e?"=":"!=";case 1:return e?">=":">";default:throw"Programming error.  Comparators must have a direction of -1, 0, or 1"}}});r("core/math/parsenode/basecomparator",["require","pjs","./expression","./expressionTypes","core/math/comparators"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("./expressionTypes").Subtract,i=e("core/math/comparators").table;return t(r,function(e,r,a){a.create=function(e){return t(a,function(t,r){t.operator=e,t.isInequality=function(){return 0!==i[e].direction}})},e.init=function(e){r.init.call(this,e),this._difference=-1===i[this.operator].direction?n([e[1],e[0]]):n([e[0],e[1]])},e.asComparator=function(){return this}})});r("core/math/parsenode/comparator",["require","core/math/parsenode/basecomparator"],function(e){"use strict";var t=e("core/math/parsenode/basecomparator");return{"<":t.create("<"),">":t.create(">"),"<=":t.create("<="),">=":t.create(">="),"=":t.create("=")}});r("core/math/parsenode/doubleinequality",["require","pjs","./base","core/math/comparators","./comparator"],function(e){"use strict";var t=e("pjs"),r=e("./base"),n=e("core/math/comparators"),i=e("./comparator");return t(r,function(e,t){e.init=function(e){t.init.call(this),this.args=e,this._symbol=e[2]._symbol,this._operators=[e[1],e[3]],this._expressions=[e[0],e[4]];var r=n.get(n.table[e[1]].inclusive&&n.table[e[3]].inclusive,n.table[e[1]].direction);this._indicator=i[r]([e[0],e[4]]),this.addDependency(this._symbol),this.mergeDependencies(this._expressions[0],this._expressions[1])},e.isInequality=function(){return!0},e.isShadeBetween=function(){return!0}})});r("core/math/parsenode/repeatedoperator",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){this._index=e[0],t.init.call(this,e)},e.registerDependencies=function(){this.addDummyDependency(this._index._symbol),this.mergeDependencies(this.args[1]),this.mergeDependencies(this.args[2]),this.mergeDependenciesInScope([this._index._symbol],this.args[3])}})});r("core/math/parsenode/sum",["require","pjs","./repeatedoperator"],function(e){"use strict";return e("pjs")(e("./repeatedoperator"),function(e,t){e.in_place_operator="+=",e.starting_value=0,e.evaluateConstant=function(e){var t=1+Math.round(e[1])-Math.round(e[0]);return t<=0?this.starting_value:t*e[2]},e.update=function(e,t){return e+t}})});r("core/math/parsenode/product",["require","pjs","./repeatedoperator"],function(e){"use strict";return e("pjs")(e("./repeatedoperator"),function(e,t){e.in_place_operator="*=",e.starting_value=1,e.evaluateConstant=function(e){var t=1+Math.round(e[1])-Math.round(e[0]);return t<=0?this.starting_value:Math.pow(e[2],t)},e.update=function(e,t){return e*t}})});r("core/math/parsenode/integral",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){this._differential=e[0],t.init.call(this,e)},e.registerDependencies=function(){this.mergeDependencies(this.args[1]),this.mergeDependencies(this.args[2]),this.mergeDependenciesInScope([this._differential._symbol],this.args[3])}})});r("core/math/parsenode/assignmentexpression",["require","./expression","pjs"],function(e){"use strict";var t=e("./expression");return e("pjs")(t,function(e,t){e.init=function(e){t.init.call(this,e),this._symbol=e[0]._symbol}})});r("core/math/parsenode/listcomprehension",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e,r,n){this._index=e,this._body=r,this._inputLists=n,t.init.call(this,[e,r].concat(n))},e.registerDependencies=function(){for(var e=[],t=0;t<this._inputLists.length;t++){var r=this._inputLists[t],n=r._symbol;this.addDummyDependency(n),e.push(n),this.mergeDependencies(r.args[1])}this.addDummyDependency(this._index._symbol),e.push(this._index._symbol),this.mergeDependenciesInScope(e,this._body)}})});r("core/math/ir/opcodes",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Action=t.BroadcastResult=t.BlockVar=t.ExtendSeed=t.Distribution=t.InboundsListAccess=t.DeferredListAccess=t.ListAccess=t.List=t.NativeFunction=t.Piecewise=t.And=t.GreaterEqual=t.LessEqual=t.Greater=t.Less=t.Equal=t.EndBroadcast=t.BeginBroadcast=t.EndIntegral=t.BeginIntegral=t.EndLoop=t.BeginLoop=t.OrderedPairAccess=t.OrderedPair=t.Negative=t.RawExponent=t.Exponent=t.Divide=t.Multiply=t.Subtract=t.Add=t.MAX_LEAF_OPCODE=t.SymbolicVar=t.LoadArg=t.Constant=t.Noop=void 0,t.Noop=0,t.Constant=1,t.LoadArg=2,t.SymbolicVar=3,t.MAX_LEAF_OPCODE=3,t.Add=8,t.Subtract=9,t.Multiply=10,t.Divide=11,t.Exponent=12,t.RawExponent=13,t.Negative=14,t.OrderedPair=15,t.OrderedPairAccess=16,t.BeginLoop=17,t.EndLoop=18,t.BeginIntegral=19,t.EndIntegral=20,t.BeginBroadcast=21,t.EndBroadcast=22,t.Equal=23,t.Less=24,t.Greater=25,t.LessEqual=26,t.GreaterEqual=27,t.And=30,t.Piecewise=31,t.NativeFunction=37,t.List=38,t.ListAccess=39,t.DeferredListAccess=40,t.InboundsListAccess=41,t.Distribution=42,t.ExtendSeed=44,t.BlockVar=47,t.BroadcastResult=48,t.Action=49});r("core/math/ir/builtin-table",["require","exports","core/math/types","./opcodes","core/math/maybe-rational"],function(e,t,r,n,i){"use strict";function a(e,t,n){var i,a,o,s,u,c,l=null!==(i=null==n?void 0:n.tag)&&void 0!==i?i:"default",p=null!==(a=null==n?void 0:n.argumentTypes)&&void 0!==a?a:function(e){switch(e){case"default":case"trig":case"inverseTrig":case"never-broadcast":return[r.Number];case"reducer":return[r.ListOfNumber];case"doubleReducer":return[r.ListOfNumber,r.ListOfNumber];case"parameterizedReducer":return[r.ListOfNumber,r.Number];case"color":return[r.Number,r.Number,r.Number]}}(l),d=(null==n?void 0:n.defaultArguments)?n.defaultArguments.length:0,f=null!==(o=null==n?void 0:n.minArity)&&void 0!==o?o:p.length-d,h=null!==(s=null==n?void 0:n.maxArity)&&void 0!==s?s:function(e,t,r){return"reducer"===e?1/0:t+r}(l,f,d),y=null!==(u=null==n?void 0:n.allowDotCall)&&void 0!==u?u:function(e){switch(e){case"default":case"trig":case"inverseTrig":case"doubleReducer":case"color":case"never-broadcast":return!1;case"reducer":case"parameterizedReducer":return!0}}(l);return{module:e,symbol:t,argumentTypes:p,defaultArguments:null==n?void 0:n.defaultArguments,returnType:null!==(c=null==n?void 0:n.returnType)&&void 0!==c?c:r.Number,tag:l,minArity:f,maxArity:h,allowDotCall:y}}function o(e){if(!i.isRational(e))throw new Error("Programming Error: numeric constants should be rational");return{type:n.Constant,valueType:r.Number,value:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CompilerFunctionTable=t.BuiltInTable=void 0;var s=o(i.maybeRational(0,1)),u=o(i.maybeRational(1,1)),c=o(i.maybeRational(1,2));function l(e,t){var r,n,i,a,o=null==t?void 0:t.defaultArguments,s=null!==(r=null==t?void 0:t.maxArity)&&void 0!==r?r:function(e,t){return t?t.length+e:e}(e,o),u=null!==(n=null==t?void 0:t.fallthroughUnlessDistribution)&&void 0!==n&&n,c=null!==(i=null==t?void 0:t.allowDotCall)&&void 0!==i&&i,l=null!==(a=null==t?void 0:t.isSeeded)&&void 0!==a&&a;return{minArity:e,maxArity:s,defaultArguments:o,fallthroughUnlessDistribution:u,minArityExampleArgs:null==t?void 0:t.minArityExampleArgs,maxArityExampleArgs:null==t?void 0:t.maxArityExampleArgs,dotMinArityExampleArgs:null==t?void 0:t.dotMinArityExampleArgs,dotMaxArityExampleArgs:null==t?void 0:t.dotMaxArityExampleArgs,allowDotCall:c,isSeeded:l}}function p(){return l(0,{maxArity:1/0})}t.BuiltInTable={sin:a("BuiltIn","sin",{tag:"trig"}),cos:a("BuiltIn","cos",{tag:"trig"}),tan:a("BuiltIn","tan",{tag:"trig"}),cot:a("BuiltIn","cot",{tag:"trig"}),sec:a("BuiltIn","sec",{tag:"trig"}),csc:a("BuiltIn","csc",{tag:"trig"}),arcsin:a("Math","asin",{tag:"inverseTrig"}),arccos:a("Math","acos",{tag:"inverseTrig"}),arctan:a("Math","atan2",{argumentTypes:[r.Number,r.Number],defaultArguments:[u],tag:"inverseTrig"}),arccot:a("BuiltIn","acot",{tag:"inverseTrig"}),arcsec:a("BuiltIn","asec",{tag:"inverseTrig"}),arccsc:a("BuiltIn","acsc",{tag:"inverseTrig"}),sinh:a("BuiltIn","sinh"),cosh:a("BuiltIn","cosh"),tanh:a("BuiltIn","tanh"),coth:a("BuiltIn","coth"),sech:a("BuiltIn","sech"),csch:a("BuiltIn","csch"),arcsinh:a("BuiltIn","asinh"),arccosh:a("BuiltIn","acosh"),arctanh:a("BuiltIn","atanh"),arccoth:a("BuiltIn","acoth"),arcsech:a("BuiltIn","asech"),arccsch:a("BuiltIn","acsch"),sqrt:a("Math","sqrt"),rtxsqpone:a("BuiltIn","sqrtxsqp1"),rtxsqmone:a("BuiltIn","sqrtxsqm1"),nthroot:a("BuiltIn","nthroot",{argumentTypes:[r.Number,r.Number]}),hypot:a("BuiltIn","hypot",{argumentTypes:[r.Number,r.Number]}),log:a("BuiltIn","common_log"),logbase:a("BuiltIn","log_base",{argumentTypes:[r.Number,r.Number]}),ln:a("BuiltIn","log"),exp:a("Math","exp"),floor:a("Math","floor"),ceil:a("Math","ceil"),round:a("Math","round"),abs:a("Math","abs"),sign:a("BuiltIn","sign"),mod:a("BuiltIn","mod",{argumentTypes:[r.Number,r.Number]}),nCr:a("BuiltIn","nCr",{argumentTypes:[r.Number,r.Number]}),nPr:a("BuiltIn","nPr",{argumentTypes:[r.Number,r.Number]}),factorial:a("BuiltIn","factorial"),polyGamma:a("BuiltIn","polyGamma",{argumentTypes:[r.Number,r.Number]}),lcm:a("BuiltIn","listLCM",{tag:"reducer"}),gcd:a("BuiltIn","listGCD",{tag:"reducer"}),distance:a("BuiltIn","distance",{argumentTypes:[r.Point,r.Point]}),polygon:a("BuiltIn","polygon",{tag:"never-broadcast",argumentTypes:[r.ListOfPoint],returnType:r.Polygon}),mean:a("BuiltIn","mean",{tag:"reducer"}),total:a("BuiltIn","total",{tag:"reducer"}),stdev:a("BuiltIn","stdev",{tag:"reducer"}),stdevp:a("BuiltIn","stdevp",{tag:"reducer"}),mad:a("BuiltIn","mad",{tag:"reducer"}),length:a("BuiltIn","length",{tag:"reducer",argumentTypes:[r.ListOfAny]}),min:a("BuiltIn","listMin",{tag:"reducer"}),max:a("BuiltIn","listMax",{tag:"reducer"}),argmin:a("BuiltIn","argMin",{tag:"reducer"}),argmax:a("BuiltIn","argMax",{tag:"reducer"}),median:a("BuiltIn","median",{tag:"reducer"}),var:a("BuiltIn","variance",{tag:"reducer"}),varp:a("BuiltIn","varp",{tag:"reducer"}),cov:a("BuiltIn","cov",{tag:"doubleReducer"}),covp:a("BuiltIn","covp",{tag:"doubleReducer"}),corr:a("BuiltIn","corr",{tag:"doubleReducer"}),spearman:a("BuiltIn","spearman",{tag:"doubleReducer"}),quantile:a("BuiltIn","quantile",{tag:"parameterizedReducer"}),quartile:a("BuiltIn","quartile",{tag:"parameterizedReducer"}),upperQuantileIndex:a("BuiltIn","upperQuantileIndex",{tag:"parameterizedReducer"}),lowerQuantileIndex:a("BuiltIn","lowerQuantileIndex",{tag:"parameterizedReducer"}),quartileIndex:a("BuiltIn","quartileIndex",{tag:"parameterizedReducer"}),upperQuartileIndex:a("BuiltIn","upperQuartileIndex",{tag:"parameterizedReducer"}),lowerQuartileIndex:a("BuiltIn","lowerQuartileIndex",{tag:"parameterizedReducer"}),normalcdf:a("BuiltIn","normalcdf",{argumentTypes:[r.Number,r.Number,r.Number,r.Number],defaultArguments:[s,u]}),normalpdf:a("BuiltIn","normalpdf",{argumentTypes:[r.Number,r.Number,r.Number],defaultArguments:[s,u]}),binomcdf:a("BuiltIn","binomcdf",{argumentTypes:[r.Number,r.Number,r.Number,r.Number],defaultArguments:[c]}),binompdf:a("BuiltIn","binompdf",{argumentTypes:[r.Number,r.Number,r.Number],defaultArguments:[c]}),poissoncdf:a("BuiltIn","poissoncdf",{argumentTypes:[r.Number,r.Number,r.Number]}),poissonpdf:a("BuiltIn","poissonpdf",{argumentTypes:[r.Number,r.Number,r.Number]}),uniformcdf:a("BuiltIn","uniformcdf",{argumentTypes:[r.Number,r.Number,r.Number,r.Number],defaultArguments:[s,u]}),uniformpdf:a("BuiltIn","uniformpdf",{argumentTypes:[r.Number,r.Number,r.Number],defaultArguments:[s,u]}),invT:a("BuiltIn","invT",{argumentTypes:[r.Number,r.Number]}),invPoisson:a("BuiltIn","invPoisson",{argumentTypes:[r.Number,r.Number]}),invBinom:a("BuiltIn","invBinom",{argumentTypes:[r.Number,r.Number,r.Number]}),invUniform:a("BuiltIn","invUniform",{argumentTypes:[r.Number,r.Number,r.Number]}),tpdf:a("BuiltIn","tpdf",{argumentTypes:[r.Number,r.Number]}),tcdf:a("BuiltIn","tcdf",{argumentTypes:[r.Number,r.Number,r.Number]}),erf:a("BuiltIn","erf"),invNorm:a("BuiltIn","invNorm"),tscore:a("BuiltIn","tscore",{tag:"parameterizedReducer",defaultArguments:[s]}),normalSample:a("BuiltIn","normalSample",{argumentTypes:[r.SeedType,r.Number,r.Number]}),uniformSample:a("BuiltIn","uniformSample",{argumentTypes:[r.SeedType,r.Number,r.Number]}),tSample:a("BuiltIn","tSample",{argumentTypes:[r.SeedType,r.Number]}),poissonSample:a("BuiltIn","poissonSample",{argumentTypes:[r.SeedType,r.Number]}),binomSample:a("BuiltIn","binomSample",{argumentTypes:[r.SeedType,r.Number,r.Number]}),rgb:a("BuiltIn","rgb",{returnType:r.RGBColor,tag:"color"}),hsv:a("BuiltIn","hsv",{returnType:r.RGBColor,tag:"color"}),validateRangeLength:a("BuiltIn","validateRangeLength",{returnType:r.Number,argumentTypes:[r.ListOfNumber,r.ListOfNumber,r.Number,r.Number],tag:"never-broadcast"}),validateSampleCount:a("BuiltIn","validateSampleCount",{returnType:r.Number,argumentTypes:[r.Number]}),select:a("BuiltIn","select",{argumentTypes:[r.ListOfAny,r.ListOfBool],returnType:function(e){return e[0]},tag:"never-broadcast"}),shuffle:a("BuiltIn","shuffle",{argumentTypes:[r.SeedType,r.ListOfAny],returnType:function(e){return e[1]},tag:"never-broadcast"}),sortPerm:a("BuiltIn","sortPerm",{argumentTypes:[r.ListOfNumber],returnType:r.ListOfNumber,tag:"never-broadcast"}),elementsAt:a("BuiltIn","elementsAt",{argumentTypes:[r.ListOfAny,r.ListOfNumber],returnType:function(e){return e[0]},tag:"never-broadcast"}),uniquePerm:a("BuiltIn","uniquePerm",{argumentTypes:[r.ListOfAny],returnType:r.ListOfNumber,tag:"never-broadcast"})},t.CompilerFunctionTable={round:l(1,{maxArity:2}),midpoint:l(2),sort:l(1,{maxArity:2,minArityExampleArgs:"([3,2,1])",maxArityExampleArgs:"([1,2,3],[3,2,1])",dotMaxArityExampleArgs:"([3,4])",allowDotCall:!0}),shuffle:l(2,{maxArity:3,minArityExampleArgs:"([1,2,3])",maxArityExampleArgs:"([1,2,3],2)",dotMaxArityExampleArgs:"(2)",allowDotCall:!0,isSeeded:!0}),join:l(2,{maxArity:1/0,minArityExampleArgs:"([1,2],[3,4])",dotMinArityExampleArgs:"([3,4])",allowDotCall:!0}),unique:l(1,{minArityExampleArgs:"([1,2,3])",maxArityExampleArgs:"([1,2,3])",allowDotCall:!0}),normaldist:l(0,{defaultArguments:[s,u]}),tdist:l(1),binomialdist:l(1,{defaultArguments:[c]}),poissondist:l(1),uniformdist:l(0,{defaultArguments:[s,u]}),pdf:l(2,{allowDotCall:!0}),cdf:l(2,{maxArity:3,allowDotCall:!0}),mean:l(1,{fallthroughUnlessDistribution:!0,allowDotCall:!0}),median:l(1,{fallthroughUnlessDistribution:!0,allowDotCall:!0}),stdev:l(1,{fallthroughUnlessDistribution:!0,allowDotCall:!0}),var:l(1,{fallthroughUnlessDistribution:!0,allowDotCall:!0}),quantile:l(2,{fallthroughUnlessDistribution:!0,allowDotCall:!0,minArityExampleArgs:"([1,2,3], 1)",maxArityExampleArgs:"([1,2,3], 1)",dotMinArityExampleArgs:"(x)",dotMaxArityExampleArgs:"(x)"}),random:l(1,{maxArity:4,allowDotCall:!0,isSeeded:!0}),polygon:l(0,{maxArity:1/0}),histogram:p(),dotplot:p(),boxplot:p(),ttest:p(),ittest:p(),stats:p(),det:p(),inv:p(),transpose:p(),rref:p(),trace:p()}});r("core/math/parsenode/functioncall",["require","pjs","./expression","./identifier","core/math/ir/builtin-table"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("./identifier"),i=e("core/math/ir/builtin-table").BuiltInTable;return t(r,function(e,t){e.init=function(e,r){"string"==typeof e&&(e=n(e)),this._identifier=e,this._symbol=e._symbol,this._errorSymbol="logbase"===e._errorSymbol?"log":e._errorSymbol,t.init.call(this,r)},e.registerDependencies=function(){this.addDependency(this._symbol),t.registerDependencies.call(this);var e=i[this._symbol];!e||"trig"!==e.tag&&"inverseTrig"!==e.tag||this.addDependency("trigAngleMultiplier")},e.copyWithArgs=function(e){return new this.constructor(n(this._symbol),e)}})});r("core/math/parsenode/seededfunctioncall",["require","pjs","./functioncall"],function(e){"use strict";return e("pjs")(e("./functioncall"),function(e,t){e.init=function(e,r){t.init.call(this,e,r),this.seed=r[0]}})});r("core/math/parsenode/functionexponent",["require","pjs","./expression","core/math/ir/builtin-table"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("core/math/ir/builtin-table").BuiltInTable;return t(r,function(e,t){e.registerDependencies=function(){if(t.registerDependencies.call(this),"Identifier"===this.args[0].type){var e=this.args[0]._symbol,r=n[e];!r||"trig"!==r.tag&&"inverseTrig"!==r.tag||this.addDependency("trigAngleMultiplier")}}})});r("core/math/parsenode/functionfactorial",["require","pjs","./expression","core/math/ir/builtin-table"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("core/math/ir/builtin-table").BuiltInTable;return t(r,function(e,t){e.registerDependencies=function(){if(this.addDependency("factorial"),t.registerDependencies.call(this),"Identifier"===this.args[0].type){var e=this.args[0]._symbol,r=n[e];!r||"trig"!==r.tag&&"inverseTrig"!==r.tag||this.addDependency("trigAngleMultiplier")}}})});r("core/math/parsenode/prime",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e,r){t.init.call(this,r),this.order=e},e.copyWithArgs=function(e){return new this.constructor(this.order,e)}})});r("core/math/parsenode/piecewise",["require","pjs","./expression","./constant","core/math/maybe-rational"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("./constant"),i=e("core/math/maybe-rational").maybeRational,a=t(r,{});return a.chain=function(e,t){for(var r,n=t;e.length;)r=e.pop(),n=a([r.condition,r.if_expr,n]);return n},a.empty=function(){return a([n(!0),n(i(1,1)),n(NaN)])},a});r("core/math/parsenode/derivative",["require","pjs","./expression","./identifier"],function(e){"use strict";var t=e("pjs"),r=e("./expression"),n=e("./identifier");return t(r,function(e,t){e.init=function(e,r){this._symbol=e instanceof n?e._symbol:n(e)._symbol,t.init.call(this,r),this.addDependency(this._symbol)}})});r("core/math/parsenode/updaterule",["require","./expression","pjs"],function(e){"use strict";var t=e("./expression");return e("pjs")(t,function(e,t){e.init=function(e){this._symbol=e[0]._symbol,this._expression=e[1],t.init.call(this,e)},e.registerDependencies=function(){this.addUpdateSymbol(this._symbol),this.mergeDependencies(this._expression)}})});r("core/math/parsenode/histogram",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){t.init.call(this,e),this._symbol="histogram"}})});r("core/math/parsenode/object3d",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e,r){t.init.call(this,e),this._symbol=r}})});r("core/math/parsenode/dotplot",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){t.init.call(this,e),this._symbol="dotplot"}})});r("core/math/parsenode/boxplot",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){t.init.call(this,e),this._symbol="boxplot"}})});r("core/math/parsenode/ttest",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(){t.init.apply(this,arguments),this._symbol="ttest"}})});r("core/math/parsenode/independent-ttest",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(){t.init.apply(this,arguments),this._symbol="ittest"}})});r("core/math/parsenode/stats",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(){t.init.apply(this,arguments),this._symbol="stats"}})});r("core/math/parsenode/equation",["require","./base","pjs","./expressionTypes","core/math/parsenode/comparator"],function(e){"use strict";var t=e("./base"),r=e("pjs"),n=e("./expressionTypes").Subtract,i=e("core/math/parsenode/comparator");return r(t,function(e,t){e.init=function(e,r){t.init.call(this),this.mergeDependencies(e,r),this._lhs=e,this._rhs=r,this._difference=n([this._lhs,this._rhs])},e.asComparator=function(){return i["="]([this._lhs,this._rhs])}})});r("core/math/parsenode/assignment",["require","./base","./equation","./identifier","pjs"],function(e){"use strict";var t=e("./base"),r=e("./equation"),n=e("./identifier");return e("pjs")(t,function(e,t){e.init=function(e,r){t.init.call(this),e=e._symbol,this.mergeDependencies(r),this._expression=r,this._symbol=e,this._exports=this.computeExports()},e.shouldExportAns=function(){return!0},e.computeExports=function(){for(var e=this._symbol,t=this.getDependencies(),r=0;r<t.length;r++)if(t[r]===e)return[];return[e]},e.isEquation=function(e){return-1!==e.getDependencies().indexOf(this._symbol)},e.asEquation=function(){var e=r(n(this._symbol),this._expression);return e.userData=this.userData,e.metaData=this.metaData,e},e.shouldPromoteToSlider=function(e){return!!this._expression.isConstant&&(!this._expression.is_mixed_number&&("number"==typeof this._expression.asValue()&&(!!isFinite(this._expression.asValue())&&e.isValidSlider(this._symbol))))}})});r("core/math/parsenode/functiondefinition",["require","pjs","./base","core/math/errormsg","./equation","./identifier","./functioncall"],function(e){"use strict";var t=e("pjs"),r=e("./base"),n=e("core/math/errormsg"),i=e("./equation"),a=e("./identifier"),o=e("./functioncall");return t(r,function(e,t){e.init=function(e,r,n){t.init.call(this),e=e._symbol,this._argSymbols=r.map(function(e){return e._symbol}),this._symbol=e,this._exports=[e],this._expression=n,this.mergeDependenciesInScope(this._argSymbols,this._expression)},e.isFunction=!0,e.getConcreteInvocationTree=function(e,t,r,i){if(r.length!==this._argSymbols.length)throw n.wrongArity(i,this._argSymbols.length,r.length);for(var a=Object.create(t),o=0;o<this._argSymbols.length;o++)a[this._argSymbols[o]]=r[o];return this._expression.getConcreteTree(e,a)},e.getSliderVariables=function(e,r){var n=this._argSymbols;return t.getSliderVariables.call(this,e,r).filter(function(e){return-1===n.indexOf(e)})},e.asEquation=function(){var e=this._argSymbols.map(function(e){return a(e)}),t=i(o(a(this._symbol),e),this._expression);return t.userData=this.userData,t.metaData=this.metaData,t}})});r("core/math/parsenode/regression",["require","pjs","./base","core/math/errormsg","./functioncall","./identifier","./expressionTypes"],function(e){"use strict";var t=e("pjs"),r=e("./base"),n=e("core/math/errormsg"),i=e("./functioncall"),a=e("./identifier"),o=e("./expressionTypes").Subtract;return t(r,function(e,t,r){e.init=function(e,r){t.init.call(this),this._lhs=e,this.isLhsSimple=e instanceof a,this._logLhs=i("ln",[e]),this._rhs=r,this._difference=o([e,r]),this._logDifference=o([i("ln",[e]),i("ln",[r])]),this.mergeDependencies(e,r)},e.isRegression=!0,e.exportTo=function(e,t,r){if(!t.isError){for(var i in t.parameters)t.parameters.hasOwnProperty(i)&&(e.assignmentForbidden(i)||(r[i]=r[i]?n.multiplyDefined(i):t.parameters[i]));e.assignmentForbidden(t.residualVariable)||(r[t.residualVariable]=t.residuals)}},e.getSliderVariables=function(){return[]}})});r("core/math/parsenode/image",["require","pjs","./base"],function(e){"use strict";return e("pjs")(e("./base"),function(e,t,r,n){e.isImage=!0,e.init=function(e,r){t.init.call(this),this.center=e.center,this.radianAngle=e.radianAngle,this.width=e.width,this.height=e.height,this.opacity=e.opacity,this.moveStrategy=r,this.mergeDependencies(this.center,this.radianAngle,this.width,this.height,this.opacity)}})});r("core/math/parsenode/ticker",["require","pjs","./base"],function(e){"use strict";return e("pjs")(e("./base"),function(e,t){e.init=function(e){t.init.call(this),this.handler=e.handler,this.minStep=e.minStep,this.mergeDependencies(this.handler),this.mergeDependencies(this.minStep)}})});r("core/math/parsenode/slider",["require","pjs","./assignment","./identifier"],function(e){"use strict";var t=e("pjs"),r=e("./assignment"),n=e("./identifier");return t(r,function(e,t,i,a){e.isSlider=!0,e.init=function(e,r){t.init.call(this,n(e._symbol),e._expression),this.setInputSpan(e._inputSpan),this.sliderAssignment=e,this.sliderMin=r.sliderMin,this.sliderMax=r.sliderMax,this.sliderSoftMin=r.sliderSoftMin,this.sliderSoftMax=r.sliderSoftMax,this.sliderStep=r.sliderStep,this.sliderIsPlayingOnce=r.sliderIsPlayingOnce,this.sliderMin&&this.mergeDependencies(this.sliderMin),this.sliderMax&&this.mergeDependencies(this.sliderMax),this.sliderStep&&this.mergeDependencies(this.sliderStep)},e.shouldPromoteToSlider=function(e){return!1},e.asAssignment=function(){return r(this._symbol,this._expression)}})});r("core/math/parsenode/table",["require","pjs","./base"],function(e){"use strict";return e("pjs")(e("./base"),function(e,t){e.init=function(e){t.init.call(this),this.columns=e,this._exports=[],this.mergeDependencies.apply(this,e);for(var r=0;r<e.length;r++)Array.prototype.push.apply(this._exports,e[r].getExports())},e.exportPenalty=1,e.isTable=!0,e.exportTo=function(e,t,r){for(var n=0;n<this.columns.length;n++){var i=this.columns[n].getExports();if(i.length){var a=i[0];e.assignmentForbidden(a)||r[a]||(t.isError?r[a]=t:this.columns[n].exportTo(e,t.columns[n],r))}}},e.getAllIds=function(){return this.columns.map(function(e){return e.header.userData.id})}})});r("core/math/parsenode/tablecolumn",["require","pjs","./base","./list","./constant","./identifier"],function(e){"use strict";var t=e("pjs"),r=e("./base"),n=e("./list"),i=e("./constant"),a=e("./identifier");return t(r,function(e,t){function o(e){return e.isConstant?i(e.asCompilerValue()):i(NaN)}e.init=function(e,r,n){t.init.call(this),this.header=e,this.length=r,this.values=n,this.isIndependent=!1,this.registerDependencies(),this._exports=this.computeExports()},e.registerDependencies=function(){this.mergeDependencies(this.header),this.mergeDependencies.apply(this,this.values)},e.computeExports=function(){return this.header instanceof a?[this.header._symbol]:[]},e.isDiscrete=function(e){return!this.continuousConcreteTree||1!==this.continuousConcreteTree.getDependencies().length||1!==e.header.getDependencies().length||this.continuousConcreteTree.getDependencies()[0]!==e.header.getDependencies()[0]},e._exportSymbolsTo=function(e,t,i){if(e.length){var a=e[0];if(t.isError)i[a]=t;else try{i[a]=n(t.values.map(o))}catch(e){if(!(e instanceof r))throw e;i[a]=e}}},e.exportTo=function(e,t,r){var n=this.getLegalExports(e);this._exportSymbolsTo(n,t,r)},e.exportToLocal=function(e,t){this._exportSymbolsTo(this.getExports(),e,t)}})});r("core/math/parsenode/solvedequation",["require","pjs","./base"],function(e){"use strict";return e("pjs")(e("./base"),function(e,t){e.init=function(e,r,n){t.init.call(this),this._symbol=e,this._expression=r,this.mergeDependencies(r),this.branchMultiplier=n}})});r("core/math/parsenode/optimizedregression",["require","pjs","./base"],function(e){"use strict";return e("pjs")(e("./base"),function(e,t){e.init=function(e,r,n,i,a){for(var o in t.init.call(this),this.parameters=e,this.residuals=r,this.statistics=n,this.model=i,this.isModelValid=a.isModelValid,this.residualVariable=a.residualVariable,this.residualSuggestionId=a.residualSuggestionId,this.shouldSuggestLogMode=a.shouldSuggestLogMode,this.isLinear=a.isLinear,this.parameterWarning=a.parameterWarning,this._exports=[this.residualVariable],e)e.hasOwnProperty(o)&&this._exports.push(o);this.mergeDependencies(i)},e.getCompiledFunction=function(){return this.model.getCompiledFunction.apply(this.model,arguments)},e.getCompiledDerivative=function(){return this.model.getCompiledDerivative.apply(this.model,arguments)}})});r("core/math/parsenode/seed",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e){"string"!=typeof e&&(e=""+e),this._stringValue=e,t.init.call(this,[])},e.isString=!0,e.asValue=function(){return this._stringValue}})});r("core/math/parsenode/extendseed",["require","pjs","./expression"],function(e){"use strict";return e("pjs")(e("./expression"),function(e,t){e.init=function(e,r){t.init.call(this,r),this.seed=r[0],this.userSeed=r[1],this.tag=e},e.asValue=function(){return this.seed.asValue()+"::"+this.tag+this.userSeed.asValue()},e.copyWithArgs=function(e){return new this.constructor(this.tag,e)}})});r("core/math/context-types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isActionCompilerValue=void 0,t.isActionCompilerValue=function(e){return!("object"!=typeof e||!e)&&"Action"===e.type}});r("core/math/ir/features/as-value",["require","exports","../opcodes","core/math/context-types","core/math/maybe-rational"],function(e,t,r,n,i){"use strict";function a(e){if(Array.isArray(e))return e.map(a);switch(typeof e){case"boolean":case"number":case"string":return e;case"object":if(n.isActionCompilerValue(e)){var t={};for(var r in e.updateRules){var o=e.updateRules[r];t[r]={value:a(o.value),valueType:o.valueType}}return{type:"Action",updateRules:t}}return i.asFloat(e);default:throw new Error("Unexpected value: "+e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.compilerValueToRuntimeValue=t.asValue=void 0,t.asValue=function(e,t){var n=e.getInstruction(t);switch(n.type){case r.Constant:return a(n.value);default:throw new Error("Unexpected opcode "+n.type+".")}},t.compilerValueToRuntimeValue=a});r("core/math/ir/features/nan-of-type",["require","exports","core/math/types"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.nanOfType=t.isNanableValueType=void 0,t.isNanableValueType=function(e){switch(e){case r.Bool:case r.Number:case r.Point:case r.Action:case r.RGBColor:case r.Polygon:return!0;default:return!1}},t.nanOfType=function(e){switch(e){case r.Number:return NaN;case r.Point:return[NaN,NaN];case r.RGBColor:return[NaN,NaN,NaN];case r.Action:return{type:"Action",updateRules:{}};case r.Bool:return!1;case r.Polygon:return[];default:throw new Error(e+" does not have a NaN type.")}}});r("core/math/parsenode/irexpression",["require","pjs","./base","core/math/types","core/math/ir/features/as-value","core/math/ir/features/nan-of-type","core/math/errormsg"],function(e){"use strict";var t=e("pjs"),r=e("./base"),n=e("core/math/types"),i=e("core/math/ir/features/as-value").compilerValueToRuntimeValue,a=e("core/math/ir/features/nan-of-type").nanOfType,o=e("core/math/errormsg");return t(r,function(e,t,r){e.init=function(e){if(t.init.call(this),this._chunk=e,this.valueType=e.getReturnType(),this.addDependencies(e.getLiveArgNames()),this.isList=n.isList(this.valueType),this.isList&&(this.length=this._chunk.getConstantListLength(),void 0===this.length))throw o.variableLengthTopLevelList(e.getListLengthDependencies());var r=e.isConstant();this.isConstant=r&&(this.valueType===n.Number||this.valueType===n.Bool),this.isEmptyAction=r&&this.valueType===n.Action&&0===Object.keys(e.asValue().updateRules).length},e.shouldExportAns=function(){return!0},e.getCompiledFunction=function(e){return this._chunk.getCompiledFunction(e)},e.polynomialOrder=function(e){return this._chunk.polynomialOrder(e,{allowRestriction:!0,allowClosedBlockReferences:!1})},e.getPolynomialCoefficients=function(e){for(var t=this._chunk.getPolynomialCoefficients(e),n=t.chunk,i=t.coefficients,a=[],o=0;o<i.length;o++){var s=n.copy();s.returnIndex=i[o],s.close(),a.push(new r(s))}return a},e.takeDerivative=function(e){var t=this._chunk.copy().takeDerivative(e).close();return new r(t)},e.boundDomain=function(e){return this._chunk.boundDomain(e)},e.asValue=function(){if(this._chunk.isConstant())return this._chunk.asValue();if(this.isList){for(var e=[],t=i(a(n.elementType(this.valueType))),r=0;r<this.length;r++)e.push(t);return e}return i(a(this.valueType))},e.asCompilerValue=function(){return this._chunk.asCompilerValue()},e.isNaN=function(){return"number"==typeof this.asValue()&&isNaN(this.asValue())},e.getEvaluationInfo=function(){return!(!this._chunk.isConstant()||0!==this.getDependencies().length||!n.isTypeOrListOfType(this.valueType,n.Number)&&!n.isTypeOrListOfType(this.valueType,n.Bool))&&[{val:this.asValue()}]},e.elementAt=function(e){var t=this._chunk.elementAt(e);return new r(t)},e.findLinearSubset=function(e){return this._chunk.findLinearSubset(e)},e.deriveRegressionRestrictions=function(){var e=this._chunk.deriveRegressionRestrictions();return e===this._chunk?this:new r(e)},e.eachElement=function(e){for(var t=0;t<this.length;t++)e(this.elementAt(t),t)},e.mapElements=function(e){for(var t=[],r=0;r<this.length;r++)t.push(e(this.elementAt(r),r));return t}})});r("parsenodes",["require","core/math/parsenode/expressionTypes","core/math/parsenode/base","core/math/parsenode/expression","core/math/parsenode/error","core/math/parsenode/constant","core/math/parsenode/mixednumber","core/math/parsenode/identifier","core/math/parsenode/ans","core/math/parsenode/list","core/math/parsenode/range","core/math/parsenode/listaccess","core/math/parsenode/dotaccess","core/math/parsenode/parenseq","core/math/parsenode/movablepoint","core/math/parsenode/orderedpairaccess","core/math/parsenode/bareseq","core/math/parsenode/basecomparator","core/math/parsenode/comparator","core/math/parsenode/doubleinequality","core/math/parsenode/repeatedoperator","core/math/parsenode/sum","core/math/parsenode/product","core/math/parsenode/integral","core/math/parsenode/assignmentexpression","core/math/parsenode/listcomprehension","core/math/parsenode/functioncall","core/math/parsenode/seededfunctioncall","core/math/parsenode/functionexponent","core/math/parsenode/functionfactorial","core/math/parsenode/prime","core/math/parsenode/piecewise","core/math/parsenode/derivative","core/math/parsenode/updaterule","core/math/parsenode/histogram","core/math/parsenode/object3d","core/math/parsenode/dotplot","core/math/parsenode/boxplot","core/math/parsenode/ttest","core/math/parsenode/independent-ttest","core/math/parsenode/stats","core/math/parsenode/assignment","core/math/parsenode/functiondefinition","core/math/parsenode/equation","core/math/parsenode/regression","core/math/parsenode/image","core/math/parsenode/ticker","core/math/parsenode/slider","core/math/parsenode/table","core/math/parsenode/tablecolumn","core/math/parsenode/solvedequation","core/math/parsenode/optimizedregression","core/math/parsenode/seed","core/math/parsenode/extendseed","core/math/parsenode/irexpression"],function(e){"use strict";var t=e("core/math/parsenode/expressionTypes"),r={Base:e("core/math/parsenode/base"),Expression:e("core/math/parsenode/expression"),Error:e("core/math/parsenode/error"),Constant:e("core/math/parsenode/constant"),MixedNumber:e("core/math/parsenode/mixednumber"),Identifier:e("core/math/parsenode/identifier"),Ans:e("core/math/parsenode/ans"),List:e("core/math/parsenode/list"),Range:e("core/math/parsenode/range"),ListAccess:e("core/math/parsenode/listaccess"),DotAccess:e("core/math/parsenode/dotaccess"),ParenSeq:e("core/math/parsenode/parenseq"),MovablePoint:e("core/math/parsenode/movablepoint"),OrderedPairAccess:e("core/math/parsenode/orderedpairaccess"),BareSeq:e("core/math/parsenode/bareseq"),BaseComparator:e("core/math/parsenode/basecomparator"),Comparator:e("core/math/parsenode/comparator"),DoubleInequality:e("core/math/parsenode/doubleinequality"),RepeatedOperator:e("core/math/parsenode/repeatedoperator"),Sum:e("core/math/parsenode/sum"),Product:e("core/math/parsenode/product"),Integral:e("core/math/parsenode/integral"),AssignmentExpression:e("core/math/parsenode/assignmentexpression"),ListComprehension:e("core/math/parsenode/listcomprehension"),FunctionCall:e("core/math/parsenode/functioncall"),SeededFunctionCall:e("core/math/parsenode/seededfunctioncall"),FunctionExponent:e("core/math/parsenode/functionexponent"),FunctionFactorial:e("core/math/parsenode/functionfactorial"),Prime:e("core/math/parsenode/prime"),Piecewise:e("core/math/parsenode/piecewise"),Derivative:e("core/math/parsenode/derivative"),UpdateRule:e("core/math/parsenode/updaterule"),Histogram:e("core/math/parsenode/histogram"),Object3D:e("core/math/parsenode/object3d"),DotPlot:e("core/math/parsenode/dotplot"),BoxPlot:e("core/math/parsenode/boxplot"),TTest:e("core/math/parsenode/ttest"),IndependentTTest:e("core/math/parsenode/independent-ttest"),Stats:e("core/math/parsenode/stats"),Assignment:e("core/math/parsenode/assignment"),FunctionDefinition:e("core/math/parsenode/functiondefinition"),Equation:e("core/math/parsenode/equation"),Regression:e("core/math/parsenode/regression"),Image:e("core/math/parsenode/image"),Ticker:e("core/math/parsenode/ticker"),Slider:e("core/math/parsenode/slider"),Table:e("core/math/parsenode/table"),TableColumn:e("core/math/parsenode/tablecolumn"),SolvedEquation:e("core/math/parsenode/solvedequation"),OptimizedRegression:e("core/math/parsenode/optimizedregression"),Seed:e("core/math/parsenode/seed"),ExtendSeed:e("core/math/parsenode/extendseed"),IRExpression:e("core/math/parsenode/irexpression")};for(var n in t)r[n]=t[n];for(var i in r)r.hasOwnProperty(i)&&"Comparator"!==i&&(r[i].prototype.type=i);for(var a in r.Comparator)r.Comparator.hasOwnProperty(a)&&(r.Comparator[a].prototype.type="Comparator['"+a+"']");return r});r("core/math/parser/char-codes",["require","exports"],function(e,t){"use strict";function r(e){return 97<=e&&e<=122}function n(e){return 65<=e&&e<=90}Object.defineProperty(t,"__esModule",{value:!0}),t.isWhitespace=t.isSingleQuote=t.isDot=t.isBackslash=t.isLetter=t.isUpperCaseLetter=t.isLowerCaseLetter=t.isDigit=void 0,t.isDigit=function(e){return 48<=e&&e<=57},t.isLowerCaseLetter=r,t.isUpperCaseLetter=n,t.isLetter=function(e){return r(e)||n(e)},t.isBackslash=function(e){return 92===e},t.isDot=function(e){return 46===e},t.isSingleQuote=function(e){return 39===e},t.isWhitespace=function(e){if(9<=e&&e<=13)return!0;if(8192<=e&&e<=8202)return!0;switch(e){case 32:case 160:case 5760:case 8232:case 8233:case 8239:case 8287:case 12288:case 65279:return!0;default:return!1}}});r("core/math/parser/latex-lexer",["require","exports","./char-codes","./input-span"],function(e,t,r,n){"use strict";function i(e,t,r){return{type:e,span:t,val:r}}function a(e,t,a){for(;r.isWhitespace(e.charCodeAt(t));)t+=1;var o=function(e,t){var a=t;if(t>=e.length)return i("End",n.emptySpanAt(e,t),"");var o=e.charCodeAt(t);if(r.isDigit(o))return i("Digit",s=n.Span(e,a,t+1),e.charAt(a));if(r.isLetter(o))return i("Letter",s=n.Span(e,a,t+1),e.charAt(a));if(r.isBackslash(o)){if(t+=1,r.isLetter(e.charCodeAt(t))){for(;r.isLetter(e.charCodeAt(t));)t+=1;var s=n.Span(e,a,t),l=n.slice(s);return i(u[l]||"Cmd",s,l)}return t+=1,i("EscapedSymbol",s=n.Span(e,a,t),l=n.slice(s))}if(r.isSingleQuote(o)){for(t+=1;r.isSingleQuote(e.charCodeAt(t));)t+=1;return"^"===e.charAt(t)?(t+=1,i("Primes^",s=n.Span(e,a,t),l=n.slice(s))):i("Primes",s=n.Span(e,a,t),l=n.slice(s))}s=n.Span(e,a,t+1),l=e.charAt(a);return i(c[l]||"Symbol",s,l)}(e,t);return function(e,t,r,n){return{input:e,prevSpan:t,pos:r,token:n}}(e,a,t,o)}function o(e){return a(e.input,e.token.span.end,e.token.span)}function s(e){return e.token}Object.defineProperty(t,"__esModule",{value:!0}),t.isDone=t.isAt=t.eat=t.peek=t.advance=t.lex=t.LatexToken=t.spanStates=void 0,t.spanStates=function(e,t){return n.joinSpans(e.token.span,t.prevSpan)},t.LatexToken=i,t.lex=function(e){return a(e,0,n.emptySpanAt(e,0))},t.advance=o,t.peek=s,t.eat=function(e,t){if(s(e).type!==t)throw"Parse Error: expected "+t+".";return o(e)},t.isAt=function(e,t){return s(e).type===t},t.isDone=function(e){return e.pos>=e.input.length};var u={"\\left":"Left","\\right":"Right","\\sqrt":"Sqrt","\\frac":"Frac","\\operatorname":"OperatorName"},c={"[":"[","]":"]","{":"{","}":"}","^":"^",_:"_"}});r("core/math/parser/latex-node",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Symbol=t.OperatorName=t.LeftRight=t.SupSub=t.Frac=t.Sqrt=t.Group=void 0,t.Group=function(e,t){return{type:"Group",span:e,args:t}},t.Sqrt=function(e,t,r){return{type:"Sqrt",span:e,optArg:t,arg:r}},t.Frac=function(e,t,r){return{type:"Frac",span:e,num:t,den:r}},t.SupSub=function(e,t,r,n){return{type:"SupSub",span:e,sup:t,sub:r,nprimes:n}},t.LeftRight=function(e,t,r,n){return{type:"LeftRight",span:e,left:t,right:r,arg:n}},t.OperatorName=function(e,t){return{type:"OperatorName",span:e,arg:t}},t.Symbol=function(e,t){return{type:"Symbol",span:e,val:t}}});r("core/math/parser/latex-parser",["require","exports","./latex-lexer","./input-span","./latex-node"],function(e,t,r,n,i){"use strict";function a(e){switch(e){case"Frac":return 2;case"^":case"_":case"Primes^":case"Left":case"Sqrt":case"OperatorName":return 1;default:return 0}}function o(e,t){return{state:e,tree:t}}function s(e,t){var n,a=e,s=[];e:for(;!r.isDone(e);){var c=r.peek(e);switch(c.type){case"Cmd":case"EscapedSymbol":case"Letter":case"Digit":case"Symbol":case"[":case"{":case"^":case"_":case"Primes":case"Primes^":case"Left":case"Frac":case"Sqrt":case"OperatorName":case"]":if("]"===c.type&&t)break e;var l;if(e=(n=u(e)).state,"Group"===(l=n.tree).type)for(var p=0,d=l.args;p<d.length;p++){var f=d[p];s.push(f)}else s.push(l);break;case"}":case"Right":case"End":break e;default:throw"Unexpected token type "+c.type+"."}}var h=r.spanStates(a,e);return o(e,i.Group(h,s))}function u(e){var t,n=r.peek(e);switch(n.type){case"Cmd":case"EscapedSymbol":case"Letter":case"Digit":case"Symbol":return o(e=r.advance(e),n);case"[":case"]":return o(e=r.advance(e),i.Symbol(n.span,n.val));case"{":var a;return e=(t=s(e=r.advance(e),!1)).state,a=t.tree,o(e=r.eat(e,"}"),a);case"^":case"_":case"Primes":case"Primes^":return function(e){var t,n,a,s,u,l=e,p=0;e:for(;!r.isDone(e);){var d=r.peek(e);switch(d.type){case"^":if(e=r.advance(e),s)throw"Parse Error: double superscript.";e=(t=c(e,d)).state,s=t.tree;break;case"_":if(e=r.advance(e),u)throw"Parse Error: double subscript.";e=(n=c(e,d)).state,u=n.tree;break;case"Primes":if(e=r.advance(e),p>0)throw"Parse Error: double primes.";p=d.val.length;break;case"Primes^":if(e=r.advance(e),p>0)throw"Parse Error: double primes.";if(s)throw"Parse Error: double superscript";p=d.val.length-1,e=(a=c(e,d)).state,s=a.tree;break;default:break e}}var f=r.spanStates(l,e);return o(e,i.SupSub(f,s,u,p))}(e);case"Left":return function(e){var t,n=e;e=r.eat(e,"Left");var a,u=r.peek(e);e=r.advance(e),t=s(e,!1),e=t.state,a=t.tree,e=r.eat(e,"Right");var c=r.peek(e);e=r.advance(e);var l=r.spanStates(n,e);return o(e,i.LeftRight(l,u,c,a))}(e);case"Frac":return function(e){var t,n,a,s,u=e,l=r.peek(e);e=r.eat(e,"Frac"),t=c(e,l),e=t.state,a=t.tree,n=c(e,l),e=n.state,s=n.tree;var p=r.spanStates(u,e);return o(e,i.Frac(p,a,s))}(e);case"Sqrt":return function(e){var t,n,a,u,l=e,p=r.peek(e);e=r.eat(e,"Sqrt"),r.isAt(e,"[")&&(t=function(e){var t,n;return e=r.eat(e,"["),t=s(e,!0),e=t.state,n=t.tree,o(e=r.eat(e,"]"),n)}(e),e=t.state,a=t.tree);n=c(e,p),e=n.state,u=n.tree;var d=r.spanStates(l,e);return o(e,i.Sqrt(d,a,u))}(e);case"OperatorName":return function(e){var t,n,a=e,s=r.peek(e);e=r.eat(e,"OperatorName"),t=c(e,s),e=t.state,n=t.tree;var u=r.spanStates(a,e);return o(e,i.OperatorName(u,n))}(e);case"}":case"Right":throw"Parse Error: unexpected "+n.val+".";case"End":throw"Parse Error: unexpected end.";default:throw"Unexpected token type "+n.type+"."}}function c(e,t){var s,c,l=a(t.type);if(l<=0)throw new Error("Programming Error: greediness must be greater than 0.");var p=a(r.peek(e).type);if(p>0&&p<=l){var d=n.slice(t.span);throw"Parse Error: can't use "+n.slice(r.peek(e).span)+" as argument of "+d+". Use {}."}return e=(s=u(e)).state,"Group"!==(c=s.tree).type&&(c=i.Group(c.span,[c])),o(e,c)}Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0,t.parse=function(e){var t=s(r.lex(e),!1),i=t.state,a=t.tree;if(!r.isDone(i))throw"Parse error: unexpected "+n.slice(r.peek(i).span)+".";return a}});!function(){var e,t,n,i,a,o,s,u,c,l,p,d,f,h,y,m,v,g,b,x,S,T,w,_,I={};!function(e){var t="object"==typeof I?I:"object"==typeof self?self:"object"==typeof this?this:{};function n(e,r){return e!==t&&("function"==typeof Object.create?Object.defineProperty(e,"__esModule",{value:!0}):e.__esModule=!0),function(t,n){return e[t]=r?r(t,n):n}}"function"==typeof r&&r.amd?r("tslib",["exports"],function(r){e(n(t,n(r)))}):"object"==typeof module&&"object"==typeof module.exports?e(n(t,n(module.exports))):e(n(t))}(function(r){var I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])};e=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}I(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r},i=function(e,t,r,n){var i,a=arguments.length,o=a<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},a=function(e,t){return function(r,n){t(r,n,e)}},o=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(e,t,r,n){return new(r||(r=Promise))(function(i,a){function o(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,s)}u((n=n.apply(e,t||[])).next())})},u=function(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},c=function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||_(t,e,r)},_=Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]},l=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},p=function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o},d=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},f=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)n[i]=a[o];return n},h=function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},y=function(e){return this instanceof y?(this.v=e,this):new y(e)},m=function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),a=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(e){i[e]&&(n[e]=function(t){return new Promise(function(r,n){a.push([e,t,r,n])>1||s(e,t)})})}function s(e,t){try{(r=i[e](t)).value instanceof y?Promise.resolve(r.value.v).then(u,c):l(a[0][2],r)}catch(e){l(a[0][3],e)}var r}function u(e){s("next",e)}function c(e){s("throw",e)}function l(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}},v=function(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:y(e[n](t)),done:"return"===n}:i?i(t):t}:i}},g=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=l(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){(function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)})(n,i,(t=e[r](t)).done,t.value)})}}},b=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};var E=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};x=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&_(t,e,r);return E(t,e),t},S=function(e){return e&&e.__esModule?e:{default:e}},T=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},w=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},r("__extends",e),r("__assign",t),r("__rest",n),r("__decorate",i),r("__param",a),r("__metadata",o),r("__awaiter",s),r("__generator",u),r("__exportStar",c),r("__createBinding",_),r("__values",l),r("__read",p),r("__spread",d),r("__spreadArrays",f),r("__spreadArray",h),r("__await",y),r("__asyncGenerator",m),r("__asyncDelegator",v),r("__asyncValues",g),r("__makeTemplateObject",b),r("__importStar",x),r("__importDefault",S),r("__classPrivateFieldGet",T),r("__classPrivateFieldSet",w)})}();r("core/math/parser/command-aliases",["require","exports","./char-codes"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.translateCmd=void 0;var n={mcd:"gcd",gcf:"gcd",mcm:"lcm",signum:"sign",sgn:"sign",stdDevP:"stdevp",stddevp:"stdevp",stdDev:"stdev",stddev:"stdev",variance:"var",TTest:"ttest",TScore:"tscore",IndependentTTest:"ittest",iTTest:"ittest",inverseCdf:"quantile",inversecdf:"quantile",arsinh:"arcsinh",arcosh:"arccosh",artanh:"arctanh",arcsch:"arccsch",arsech:"arcsech",arcoth:"arccoth"};t.translateCmd=function(e){for(var t=0;r.isBackslash(e.charCodeAt(t));)t+=1;return t>0&&(e=e.slice(t)),n[e]||e}});r("core/math/parser/surface-node",["require","exports","./command-aliases"],function(e,t,r){"use strict";function n(e){if("Subscript"===e.type){if("Alphanumeric"!==e.args[1].type)return!1;e=e.args[0]}switch(e.type){case"Cmd":case"Letter":return!0;default:return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.unwrapSeq=t.isDerivative=t.isSuperscriptedIdentifier=t.isIdentifier=t.MixedNumber=t.Alphanumeric=t.Cmd=t.Decimal=t.Letter=t.Juxt=t.RightArrow=t.PercentOf=t.Dot=t.For=t.Ellipsis=t.Colon=t.EmptyRangeEnd=t.EmptyPiecewise=t.Piecewise=t.Product=t.Sum=t.EmptyIntegral=t.Integral=t.Derivative=t.Frac=t.Nthroot=t.Sqrt=t.Seq=t.Prime=t.Superscript=t.Subscript=t.Pipes=t.List=t.Paren=t.Index=t.ImplicitCall=t.Call=t.Bang=t.Div=t.Mul=t.Sub=t.Add=t.Neg=t.Pos=t.Tilde=t.InequalityChain=t.TrailingInequalityPiece=t.Inequality=t.Equals=void 0,t.Equals=function(e,t){return{type:"Equals",span:e,args:t}},t.Inequality=function(e,t,r){return{type:"Inequality",span:e,symbol:t,args:r}},t.TrailingInequalityPiece=function(e,t,r){return{type:"TrailingInequalityPiece",span:e,symbol:t,args:r}},t.InequalityChain=function(e,t,r){return{type:"InequalityChain",span:e,first:t,chain:r}},t.Tilde=function(e,t){return{type:"Tilde",span:e,args:t}},t.Pos=function(e,t){return{type:"Pos",span:e,args:t}},t.Neg=function(e,t){return{type:"Neg",span:e,args:t}},t.Add=function(e,t){return{type:"Add",span:e,args:t}},t.Sub=function(e,t){return{type:"Sub",span:e,args:t}},t.Mul=function(e,t){return{type:"Mul",span:e,args:t}},t.Div=function(e,t){return{type:"Div",span:e,args:t}},t.Bang=function(e,t){return{type:"Bang",span:e,args:t}},t.Call=function(e,t){return{type:"Call",span:e,args:t}},t.ImplicitCall=function(e,t){return{type:"ImplicitCall",span:e,args:t}},t.Index=function(e,t){return{type:"Index",span:e,args:t}},t.Paren=function(e,t){return{type:"Paren",span:e,args:t}},t.List=function(e,t){return{type:"List",span:e,args:t}},t.Pipes=function(e,t){return{type:"Pipes",span:e,args:t}},t.Subscript=function(e,t){return{type:"Subscript",span:e,args:t}},t.Superscript=function(e,t){return{type:"Superscript",span:e,args:t}},t.Prime=function(e,t,r){return{type:"Prime",span:e,nprimes:t,args:r}},t.Seq=function(e,t){return{type:"Seq",span:e,args:t}},t.Sqrt=function(e,t){return{type:"Sqrt",span:e,args:t}},t.Nthroot=function(e,t){return{type:"Nthroot",span:e,args:t}},t.Frac=function(e,t){return{type:"Frac",span:e,args:t}},t.Derivative=function(e,t){return{type:"Derivative",span:e,args:t}},t.Integral=function(e,t){return{type:"Integral",span:e,args:t}},t.EmptyIntegral=function(e,t){return{type:"EmptyIntegral",span:e,args:t}},t.Sum=function(e,t){return{type:"Sum",span:e,args:t}},t.Product=function(e,t){return{type:"Product",span:e,args:t}},t.Piecewise=function(e,t){return{type:"Piecewise",span:e,args:t}},t.EmptyPiecewise=function(e){return{type:"EmptyPiecewise",span:e}},t.EmptyRangeEnd=function(e){return{type:"EmptyRangeEnd",span:e}},t.Colon=function(e,t){return{type:"Colon",span:e,args:t}},t.Ellipsis=function(e,t){return{type:"Ellipsis",span:e,args:t}},t.For=function(e,t){return{type:"For",span:e,args:t}},t.Dot=function(e,t){return{type:"Dot",span:e,args:t}},t.PercentOf=function(e,t){return{type:"PercentOf",span:e,args:t}},t.RightArrow=function(e,t){return{type:"RightArrow",span:e,args:t}},t.Juxt=function(e,t){return{type:"Juxt",span:e,args:t}},t.Letter=function(e,t){return{type:"Letter",span:e,val:t}},t.Decimal=function(e,t){return{type:"Decimal",span:e,val:t}},t.Cmd=function(e,t){return{type:"Cmd",span:e,val:r.translateCmd(t)}},t.Alphanumeric=function(e,t){return{type:"Alphanumeric",span:e,val:t}},t.MixedNumber=function(e,t,r,n){return{type:"MixedNumber",span:e,whole:t,num:r,den:n}},t.isIdentifier=n,t.isSuperscriptedIdentifier=function(e){return"Superscript"===e.type&&n(e.args[0])},t.isDerivative=function(e,t){if("Letter"!==e.type||"d"!==e.val)return!1;if("Juxt"!==t.type)return!1;var r=t.args,i=r[0],a=r[1];return"Letter"===i.type&&"d"===i.val&&n(a)},t.unwrapSeq=function(e){return"Seq"===e.type?e.args:[e]}});r("core/math/parser/surface-node-error",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnexpectedFor=t.AdjacentNumbers=t.FractionEmpty=t.FractionMissingDenominator=t.FractionMissingNumerator=t.DifferentialWithSuperscript=t.IntegralMissingDifferential=t.DerivativeMissingBody=t.IntegralMissingBody=t.ProductMissingBody=t.SumMissingBody=t.IntegralMissingBound=t.MissingBound=t.ProductMissingBound=t.SumMissingBound=t.UnexpectedPrime=t.SuperscriptWithPrime=t.PrimeWithoutParen=t.PercentMissingOf=t.FunctionMissingArgument=t.UnexpectedSubscript=t.InvalidSubscript=t.InvalidOperatorName=t.UnrecognizedSymbol=t.UnexpectedDifferential=t.UnexpectedCloseDelimiter=t.MissingCloseDelimiter=t.UnaryOperatorMissingLeft=t.UnaryOperatorMissingRight=t.BinaryOperatorMissingLeft=t.BinaryOperatorMissingRight=t.UnexpectedEnd=t.EmptyRadicalIndex=t.EmptyPipe=t.EmptySquareBracket=t.EmptyRadical=t.EmptySuperscript=t.EmptySubscript=t.EmptyGroup=t.EmptyInput=t.UnexpectedParseError=t.Err=void 0,t.Err=function(e,t){return{type:"Err",span:e,error:t}},t.UnexpectedParseError=function(){return{type:"UnexpectedParseError"}},t.EmptyInput=function(){return{type:"EmptyInput"}},t.EmptyGroup=function(){return{type:"EmptyGroup"}},t.EmptySubscript=function(){return{type:"EmptySubscript"}},t.EmptySuperscript=function(){return{type:"EmptySuperscript"}},t.EmptyRadical=function(){return{type:"EmptyRadical"}},t.EmptySquareBracket=function(){return{type:"EmptySquareBracket"}},t.EmptyPipe=function(){return{type:"EmptyPipe"}},t.EmptyRadicalIndex=function(){return{type:"EmptyRadicalIndex"}},t.UnexpectedEnd=function(){return{type:"UnexpectedEnd"}},t.BinaryOperatorMissingRight=function(e){return{type:"BinaryOperatorMissingRight",val:e}},t.BinaryOperatorMissingLeft=function(e){return{type:"BinaryOperatorMissingLeft",val:e}},t.UnaryOperatorMissingRight=function(e){return{type:"UnaryOperatorMissingRight",val:e}},t.UnaryOperatorMissingLeft=function(e){return{type:"UnaryOperatorMissingLeft",val:e}},t.MissingCloseDelimiter=function(e,t){return{type:"MissingCloseDelimiter",open:e,close:t}},t.UnexpectedCloseDelimiter=function(e,t){return{type:"UnexpectedCloseDelimiter",open:e,close:t}},t.UnexpectedDifferential=function(){return{type:"UnexpectedDifferential"}},t.UnrecognizedSymbol=function(e){return{type:"UnrecognizedSymbol",val:e}},t.InvalidOperatorName=function(e){return{type:"InvalidOperatorName",val:e}},t.InvalidSubscript=function(e){return{type:"InvalidSubscript",val:e}},t.UnexpectedSubscript=function(e){return{type:"UnexpectedSubscript",base:e}},t.FunctionMissingArgument=function(e){return{type:"FunctionMissingArgument",val:e}},t.PercentMissingOf=function(){return{type:"PercentMissingOf"}},t.PrimeWithoutParen=function(){return{type:"PrimeWithoutParen"}},t.SuperscriptWithPrime=function(){return{type:"SuperscriptWithPrime"}},t.UnexpectedPrime=function(){return{type:"UnexpectedPrime"}},t.SumMissingBound=function(){return{type:"SumMissingBound"}},t.ProductMissingBound=function(){return{type:"ProductMissingBound"}},t.MissingBound=function(){return{type:"MissingBound"}},t.IntegralMissingBound=function(){return{type:"IntegralMissingBound"}},t.SumMissingBody=function(){return{type:"SumMissingBody"}},t.ProductMissingBody=function(){return{type:"ProductMissingBody"}},t.IntegralMissingBody=function(){return{type:"IntegralMissingBody"}},t.DerivativeMissingBody=function(){return{type:"DerivativeMissingBody"}},t.IntegralMissingDifferential=function(){return{type:"IntegralMissingDifferential"}},t.DifferentialWithSuperscript=function(){return{type:"DifferentialWithSuperscript"}},t.FractionMissingNumerator=function(){return{type:"FractionMissingNumerator"}},t.FractionMissingDenominator=function(){return{type:"FractionMissingDenominator"}},t.FractionEmpty=function(){return{type:"FractionEmpty"}},t.AdjacentNumbers=function(e){return{type:"AdjacentNumbers",args:e}},t.UnexpectedFor=function(){return{type:"UnexpectedFor"}}});r("core/math/parser/expression-token-tables",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.allTokenTypes=t.rightTable=t.leftTable=t.escapedSymbolTable=t.symbolTable=t.commandTable=void 0;t.commandTable={"\\lt":"<","\\gt":">","\\le":"<=","\\ge":">=","\\leq":"<=","\\geq":">=","\\ldots":"...","\\sim":"~","\\to":"->","\\cdot":"*","\\times":"*","\\div":"/","\\ln":"Ln","\\log":"Log","\\int":"Int","\\sum":"Sum","\\prod":"Prod","\\backslash":"Err","\\for":"for"};for(var r=0,n=["sin","cos","tan","cot","sec","csc"];r<n.length;r++){var i=n[r];t.commandTable["\\"+i]="Trig",t.commandTable["\\"+i+"h"]="Trig",t.commandTable["\\arc"+i]="Trig",t.commandTable["\\arc"+i+"h"]="Trig",t.commandTable["\\ar"+i+"h"]="Trig"}t.symbolTable={"+":"+","-":"-","*":"*","/":"/","!":"!","(":"(",")":")","[":"[","]":"]",",":",","...":"...",":":":","=":"=",">=":">=","<=":"<=",">":">","<":"<","~":"~",".":"."},t.escapedSymbolTable={"\\{":"\\{","\\}":"\\}","\\%":"%"},t.leftTable={"|":"(|","\\{":"\\{","[":"[","(":"("},t.rightTable={"|":"|)","\\}":"\\}","]":"]",")":")"},t.allTokenTypes=Object.keys({"+":!0,"-":!0,"*":!0,"/":!0,"!":!0,"(":!0,")":!0,"\\{":!0,"\\}":!0,"(|":!0,"|)":!0,"[":!0,"]":!0,",":!0,"...":!0,":":!0,"=":!0,">":!0,"<":!0,">=":!0,"<=":!0,"->":!0,"~":!0,"%":!0,".":!0,for:!0,Letter:!0,Decimal:!0,Cmd:!0,Differential:!0,End:!0,Trig:!0,Ln:!0,Log:!0,Int:!0,Sum:!0,Prod:!0,Err:!0})});r("core/math/parser/expression-lexer",["require","exports","./expression-token-tables","./input-span","./input-span","./surface-node"],function(e,t,r,n,i,a){"use strict";function o(e,t,r,n,i,a,o,s){return{opts:e,input:t,prevSpan:r,startIndex:n,endIndex:i,token:a,mode:o,parent:s}}function s(e,t,r){return{type:e,span:t,val:r}}function u(e,t,n,i,a,u){var l=t.args;if(n>l.length&&u)return c(u,i);var f=h(t,n=v(l,n),a),y=f.token,m=f.endIndex;if("End"===y.type&&u){var g=u.input.args[u.startIndex];if("LeftRight"===g.type){var b=g.right;return o(e,t,i,n,m,s(r.rightTable[b.val]||"Err",b.span,b.val),a,u)}}else"Int"===y.type?a=p(a):"Differential"===y.type&&(a=d(a));return o(e,t,i,n,m,y,a,u)}function c(e,t){var r=e.input,n=e.endIndex,i=e.mode,a=e.parent;return u(e.opts,r,n+1,t,i,a)}function l(e){return e.token}function p(e){return{type:"integral",parent:e}}function d(e){if(!e||"integral"!==e.type)throw new Error("Programming Error: expected lexer to be in integral mode.");return e.parent}function f(e,t){return{token:t,endIndex:e}}function h(e,t,i){if(t>=e.args.length)return f(t,s("End",n.emptySpanAt(e.span.input,e.span.end),""));var a=e.args[t];switch(a.type){case"Sqrt":case"Frac":case"SupSub":return f(t,a);case"Letter":if(!i||"integral"!==i.type)return f(t,a);if("d"!=a.val)return f(t,a);var o=h(e,t+1,i),u=o.endIndex,c=o.token;return"Letter"===c.type||"Cmd"===c.type?f(u,function(e,t){return{type:"Differential",span:e,val:t}}(n.joinSpans(a.span,c.span),c.val)):f(t,a);case"LeftRight":var l=a.left;return f(t,s(r.leftTable[l.val]||"Err",n.joinSpans(a.span,l.span),l.val));case"OperatorName":for(var p=[],d=0,m=a.arg.args;d<m.length;d++){var x=m[d];if("Letter"!==x.type)return f(t,s("Err",a.span,n.slice(a.arg.span)));p.push(x.val)}var S="\\"+p.join("");return f(t,s(r.commandTable[S]||"Cmd",a.span,S));case"Cmd":return f(t,s(r.commandTable[a.val]||"Cmd",a.span,a.val));case"EscapedSymbol":return f(t,s(r.escapedSymbolTable[a.val]||"Err",a.span,a.val));case"Symbol":return function(e,t,i){switch(i.val){case".":return function(e,t){var i=e.args[t];if("Symbol"!==i.type||"."!==i.val)throw new Error("Programming Error: expected '.'");if(t+2<e.args.length&&g(e.args[t+1])&&g(e.args[t+2])){var a=n.joinSpans(i.span,e.args[t+2].span);return f(t+2,s("...",a,n.slice(a)))}var o=v(e.args,t+1);if(o<e.args.length&&"Digit"===e.args[o].type)return y(e,t);var u=r.symbolTable[i.val]||"Err";return f(t,s(u,i.span,i.val))}(e,t);case"-":if((a=e.args[t+1])&&b(a,">"))return f(t+1,s("->",n.joinSpans(i.span,a.span),"->"));break;case"<":if((a=e.args[t+1])&&b(a,"="))return f(t+1,s("<=",n.joinSpans(i.span,a.span),"<="));break;case">":var a;if((a=e.args[t+1])&&b(a,"="))return f(t+1,s(">=",n.joinSpans(i.span,a.span),">="))}var o=r.symbolTable[i.val]||"Err";return f(t,s(o,i.span,i.val))}(e,t,a);case"Digit":return y(e,t);default:throw"Unexpected atom "+a.type+"."}}function y(e,t){var r=function(e,t){for(var r=e.args,i=r[t].span,o=[];t<r.length;t++){var s=v(r,t);if(s>=r.length)break;if("Digit"!==(g=r[s]).type)break;t=s,o.push(g.val)}if((t=v(r,t))>=r.length)return;var u=r[t];if("Frac"!==u.type)return;for(var c=[],l=[],p=0,d=u.num.args;p<d.length;p++){if(!m(g=d[p])){if("Digit"!==g.type)return;c.push(g.val)}}for(var h=0,y=u.den.args;h<y.length;h++){var g;if(!m(g=y[h])){if("Digit"!==g.type)return;l.push(g.val)}}var b=n.joinSpans(i,u.span);return f(t,a.MixedNumber(b,o.join(""),c.join(""),l.join("")))}(e,t);if(r)return r;for(var i=e.args,o=e.args[t].span,u=[],c=!1,l=!1;t<i.length;t++){var p=v(i,t);if(p>=i.length)break;var d=i[p];if("Digit"===d.type)t=p,c=!0,u.push(d.val);else{if(l||!g(d))break;if(p+1<i.length&&g(e.args[p+1]))break;t=p,l=!0,u.push(".")}}if(!c)throw new Error("Programming Error: decimals must have at least one digit.");return f(t-1,s("Decimal",n.joinSpans(o,e.args[t-1].span),u.join("")))}function m(e){switch(e.type){case"Sqrt":case"Frac":case"SupSub":case"LeftRight":case"OperatorName":case"Symbol":case"Letter":case"Digit":return!1;case"Cmd":return"\\space"===e.val;case"EscapedSymbol":return"\\ "===e.val||"\\:"===e.val||"\\,"===e.val||"\\;"===e.val;default:throw"Unexpected atom "+e.type+"."}}function v(e,t){for(;t<e.length&&m(e[t]);)t+=1;return t}function g(e){return b(e,".")}function b(e,t){return"Symbol"===e.type&&e.val===t}Object.defineProperty(t,"__esModule",{value:!0}),t.didAdvance=t.isDone=t.isAt=t.endIntegral=t.beginIntegral=t.peek=t.advance=t.lexAt=t.lex=t.emptySpanAtState=t.joinState=t.spanStates=t.Span=void 0,Object.defineProperty(t,"Span",{enumerable:!0,get:function(){return i.Span}}),t.spanStates=function(e,t){return n.joinSpans(e.token.span,t.prevSpan)},t.joinState=function(e,t){return n.joinSpans(e,t.prevSpan)},t.emptySpanAtState=function(e){return n.emptySpanAt(e.token.span.input,e.token.span.start)},t.lex=function(e,t){return u(t,e,0,n.emptySpanAt(e.span.input,e.span.start),undefined,undefined)},t.lexAt=u,t.advance=function(e){var t=e.input.args[e.startIndex],r=e.token.span;return t&&"LeftRight"===t.type?u(e.opts,t.arg,0,r,e.mode,e):c(e,r)},t.peek=l,t.beginIntegral=p,t.endIntegral=d,t.isAt=function(e,t){return l(e).type===t},t.isDone=function(e){return e.startIndex>=e.input.args.length},t.didAdvance=function(e,t){return t.token.span.start>e.token.span.start}});r("core/math/parser/precspec",["require","exports","./expression-token-tables"],function(e,t,r){"use strict";function n(e,t){for(var n=0,i=r.allTokenTypes;n<i.length;n++){var a=i[n];if(void 0===t[a])throw new Error("Programming Error: token "+a+" must be a assigned a "+e+" precedence")}}function i(e,t,r,n){if(void 0!==t[r])throw new Error("Programming Error: duplicate "+e+" entry for token "+r+".");t[r]=n}Object.defineProperty(t,"__esModule",{value:!0}),t.precSpec=t.ra=t.la=t.r=t.l=t.initial=void 0,t.initial=function(e){return{type:"initial",tokenType:e}},t.l=function(e){return{type:"l",tokenType:e}},t.r=function(e){return{type:"r",tokenType:e}},t.la=function(e){return{type:"la",tokenType:e}},t.ra=function(e){return{type:"ra",tokenType:e}},t.precSpec=function(e){for(var t={},r={},a={},o=0;o<e.length;o++)for(var s=0,u=e[o];s<u.length;s++){var c=u[s],l=c.type,p=c.tokenType;switch(l){case"initial":i("initial",t,p,o);break;case"l":i("left",r,p,o);break;case"r":i("right",a,p,o);break;case"la":i("left",r,p,o),i("right",a,p,o);break;case"ra":i("left",r,p,o),i("right",a,p,o-1)}}function d(e){return a[e]}return n("left",r),n("right",a),{rightPrec:d,leftPrec:function(e){return r[e]},initialPrec:function(e){var r=t[e];return void 0===r?d(e):r}}}});r("core/math/inverses",[],function(){"use strict";var e={};return["sin","cos","tan","cot","sec","csc","sinh","cosh","tanh","coth","sech","csch"].forEach(function(t){e[t]="arc"+t,e["arc"+t]=t}),e});r("core/math/parser/lower",["require","exports","core/math/inverses","tslib","core/math/errormsg","./input-span","./surface-node","../maybe-rational"],function(e,t,r,n,i,a,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLegalAssignmentLhs=t.isFunctionSignature=t.lower=void 0;var u=0;function c(e,t){for(var r=[],n=0;n<t.length;n++)r.push(f(e,t[n]));return r}function l(e){if("Call"===e.type){var t=e.args,r=t[0],n=t[1],i=o.unwrapSeq(n);return o.isIdentifier(r)&&i.every(o.isIdentifier)?{base:r,args:i}:void 0}}function p(e){return o.isIdentifier(e)}function d(e){if("Paren"!==e.type)return!1;var t=e.args[0];return"Seq"===t.type&&2===t.args.length}function f(e,t){return e.setInput(h(e,t),t.span)}function h(e,t){var r=e.nodes;switch(t.type){case"Pos":return h(e,t.args[0]);case"Neg":for(var n=-1,l=t.args[0];;)if("Pos"===l.type||"Paren"===l.type&&!d(l))l=l.args[0];else{if("Neg"!==l.type)break;l=l.args[0],n*=-1}switch(l.type){case"Decimal":var p=x(l);return r.Constant(-1===n?s.neg(p):p);case"MixedNumber":p=S(l);return r.MixedNumber(-1===n?s.neg(p):p);default:return-1===n?r.Negative([f(e,l)]):h(e,l)}case"Add":return r.Add(c(e,t.args));case"Sub":return r.Subtract(c(e,t.args));case"Mul":return r.Multiply(c(e,t.args));case"Div":return r.Divide(c(e,t.args));case"Bang":var M=t.args[0];return"Call"===M.type?r.FunctionFactorial(c(e,M.args)):r.FunctionCall("\\factorial",c(e,t.args));case"PercentOf":return r.PercentOf(c(e,t.args));case"Call":return v(e,t);case"ImplicitCall":return function(e){var t=e.args,r=t[0],n=t[1];"Superscript"===r.type&&(r=r.args[0]);if("Cmd"===r.type&&"logbase"===r.val&&"Seq"===n.type&&2===n.args.length){if(!_(n.args[0]))throw i.badImplicitCall("log")}else if(!_(n)){if("Cmd"===r.type)throw i.badImplicitCall(r.val);throw i.parseError()}}(t),v(e,t);case"Dot":var k=t.args[1],P=c(e,t.args),O=P[0],L=P[1];if(I(k)){var N=a.emptySpanAt(k.span.input,k.span.end),A=e.setInput(E(e),N);L=e.setInput(r.SeededFunctionCall(L,[A]),k.span)}else if("Letter"===k.type)switch(k.val){case"x":return r.OrderedPairAccess([O,r.Constant(1)]);case"y":return r.OrderedPairAccess([O,r.Constant(2)])}else if("Call"===k.type){if("Letter"===(F=k.args[0]).type)switch(F.val){case"x":return r.Multiply([r.OrderedPairAccess([O,r.Constant(1)]),f(e,k.args[1])]);case"y":return r.Multiply([r.OrderedPairAccess([O,r.Constant(2)]),f(e,k.args[1])])}}return r.DotAccess([O,L]);case"Prime":var D=t.args[0];if("Call"===D.type){var R=D.args,F=R[0],q=R[1],B=o.unwrapSeq(q).length;if("Cmd"===F.type&&"logbase"===F.val){if(2!==B)throw i.primedFunctionArity()}else if(1!==B)throw i.primedFunctionArity();return r.Prime(t.nprimes,c(e,t.args))}throw"ImplicitCall"===D.type?i.primeWithoutParen():i.unexpectedPrime();case"Index":var V=t.args,z=V[0],j=V[1];if("Seq"===j.type)return r.ListAccess([h(e,z),r.List(c(e,j.args))]);if("Ellipsis"===j.type){var U=j.args,G=U[0],W=U[1];return r.ListAccess([h(e,z),r.Range([r.List(c(e,o.unwrapSeq(G))),r.List("EmptyRangeEnd"===W.type?[]:c(e,o.unwrapSeq(W)))])])}return g(j)?r.ListAccess([h(e,z),b(e,j)]):r.ListAccess(c(e,t.args));case"Paren":var K=t.args[0];if("Seq"===K.type){if(0===K.args.length)throw i.emptyParen();return r.ParenSeq(c(e,K.args))}return h(e,K);case"List":if(0===t.args.length)return r.List([]);var H=t.args[0];if("Ellipsis"===H.type){var J=H.args;G=J[0],W=J[1];return r.Range([r.List(c(e,o.unwrapSeq(G))),r.List(c(e,o.unwrapSeq(W)))])}if("For"===H.type){for(var Y=H.args,$=Y[0],X=Y[1],Z=e.setInput(r.Identifier("_comprehensionIndex_"+u++),$.span),Q=f(C(e,{prefix:"li",expr:Z}),$),ee=[],te=0,re=o.unwrapSeq(X);te<re.length;te++){var ne=re[te];if(!T(ne))throw i.listComprehensionIncorrectInput();ee.push(e.setInput(r.AssignmentExpression(c(e,ne.args)),ne.span))}return r.ListComprehension(Z,Q,ee)}return r.List(c(e,o.unwrapSeq(H)));case"Pipes":return r.FunctionCall("\\abs",c(e,t.args));case"Subscript":var ie=t.args,ae=ie[0],oe=ie[1];if(0===oe.val.length)throw i.emptySubscript();var se=void 0;switch(ae.type){case"Letter":case"Cmd":se=ae.val;break;default:throw i.unexpectedSubscript()}return r.Identifier(se+"_"+oe.val);case"Superscript":var ue=t.args,ce=(ae=ue[0],ue[1]);if("Call"!==ae.type||"Seq"===ae.args[1].type||function(e){if("Call"!==e.type)return!1;var t=e.args[0];for(;"Superscript"===t.type||"Subscript"===t.type||"Prime"===t.type;)t=t.args[0];return"Cmd"===t.type&&(y(t.val)||m(t.val))}(ae)){if("Dot"===ae.type){k=ae.args[1];var le=c(e,ae.args),pe=(O=le[0],L=le[1],f(e,ce));if("Letter"===k.type)switch(k.val){case"x":return r.Exponent([r.OrderedPairAccess([O,r.Constant(1)]),pe]);case"y":return r.Exponent([r.OrderedPairAccess([O,r.Constant(2)]),pe])}else if("Call"===k.type){if("Letter"===(F=k.args[0]).type)switch(F.val){case"x":return r.Multiply([r.OrderedPairAccess([O,r.Constant(1)]),r.Exponent([f(e,k.args[1]),pe])]);case"y":return r.Multiply([r.OrderedPairAccess([O,r.Constant(2)]),r.Exponent([f(e,k.args[1]),pe])])}}return r.Exponent([r.DotAccess([O,L]),pe])}return r.Exponent(c(e,t.args))}return r.FunctionExponent(c(e,[ae.args[0],ae.args[1],ce]));case"Sqrt":return r.FunctionCall("sqrt",c(e,t.args));case"Nthroot":return r.FunctionCall("nthroot",c(e,[t.args[1],t.args[0]]));case"Frac":return r.Divide(c(e,t.args));case"Derivative":var de=c(e,t.args);if(!o.isIdentifier(t.args[0]))throw i.parseError();return r.Derivative(de[0],[de[1]]);case"Integral":var fe=t.args;de=c(e,[ye=fe[0],fe[1],ve=fe[2],ge=fe[3]]);return r.Integral(de);case"EmptyIntegral":var he=c(e,t.args),ye=he[0],me=he[1],ve=he[2],ge=r.Constant(s.maybeRational(1,1));return r.Integral([ye,me,ve,ge]);case"Sum":var be=t.args,xe=($=be[0],be[1]);ve=be[2];if(!T(xe))throw i.incorrectSumLowerBound();var Se=f(C(e,{prefix:"ro",expr:(de=c(e,[xe.args[0],xe.args[1],ve]))[0]}),$);return r.Sum(de.concat(Se));case"Product":var Te=t.args,we=($=Te[0],Te[1]);ve=Te[2];if(!T(we))throw i.incorrectProductLowerBound();Se=f(C(e,{prefix:"ro",expr:(de=c(e,[we.args[0],we.args[1],ve]))[0]}),$);return r.Product(de.concat(Se));case"Juxt":return r.Multiply(c(e,t.args));case"Letter":return r.Identifier(t.val);case"Cmd":var _e=t.val;switch(_e){case"ans":if(void 0===e.currentIndex)throw i.badSymbolContext("ans");return r.Ans("ans_{"+(e.currentIndex-1)+"}");case"approx":throw i.unrecognizedSymbol(_e);case"dt":if(!e.allowDt)throw i.badSymbolContext(_e);return r.Identifier(_e);case"index":if(!e.allowIndex)throw i.badSymbolContext(_e);return r.Identifier(_e);default:return r.Identifier(_e)}case"Decimal":return r.Constant(x(t));case"MixedNumber":return r.MixedNumber(S(t));case"Piecewise":return function(e,t){var r,n=e.nodes,a=t.args[0],u=o.unwrapSeq(a),c=[];e:for(r=0;r<u.length;r++){var l=u[r];switch(l.type){case"Colon":var p=l.args,d=p[0],h=p[1];if(!g(d))throw i.colonMissingCondition();c.push({condition:b(e,d),if_expr:f(e,h)});break;case"Equals":case"Inequality":case"InequalityChain":c.push({condition:b(e,l),if_expr:n.Constant(s.maybeRational(1,1))});break;default:break e}}if(0===r)throw i.piecewiseMissingCondition();if(r<u.length-1)throw i.piecewisePartMissingCondition();var y=r===u.length-1?f(e,u[r]):n.Constant(NaN);if(!n.Piecewise.chain)throw i.featureUnavailable();return n.Piecewise.chain(c,y)}(e,t);case"RightArrow":return function(e,t){var r=e.nodes;if(!o.isIdentifier(t.args[0]))throw i.updateRuleNonIdentifierLHS();return e=C(e,{prefix:"ec",expr:e.setInput(r.Identifier("globalEventCount"),a.emptySpanAt(t.span.input,t.span.start))}),r.UpdateRule(c(e,t.args))}(e,t);case"Seq":return r.BareSeq(c(e,t.args));case"EmptyPiecewise":if(!r.Piecewise.empty)throw i.featureUnavailable();return r.Piecewise.empty();case"Equals":throw i.unexpectedSymbol("=");case"Inequality":case"InequalityChain":throw i.unexpectedInequality();case"Tilde":throw i.unexpectedSymbol("~");case"Colon":throw i.unexpectedSymbol(":");case"Ellipsis":throw i.unexpectedSymbol("...");case"For":throw i.unexpectedForKeyword();case"EmptyRangeEnd":throw i.invalidHalfEmptyRange();case"Err":throw function(e){switch(e.type){case"UnexpectedParseError":case"MissingBound":case"EmptyGroup":case"UnexpectedDifferential":case"UnexpectedEnd":return i.parseError();case"InvalidOperatorName":return i.invalidOperatorName();case"UnexpectedCloseDelimiter":case"MissingCloseDelimiter":return i.mismatchedBraces(e.open,e.close);case"UnrecognizedSymbol":return"."===e.val?i.unexpectedSymbol(e.val):i.unrecognizedSymbol(e.val);case"EmptyInput":return i.blankExpression();case"BinaryOperatorMissingRight":case"BinaryOperatorMissingLeft":return i.binaryOperatorMissingOperand("%"===e.val?"% of":e.val);case"UnaryOperatorMissingLeft":return i.unaryOperatorMissingLeft(e.val);case"UnaryOperatorMissingRight":return i.unaryOperatorMissingRight(e.val);case"UnexpectedSubscript":return i.cannotSubscript(e.base);case"PercentMissingOf":return i.percentMissingOf();case"SumMissingBound":return i.sumMissingBound();case"ProductMissingBound":return i.productMissingBound();case"IntegralMissingBound":return i.integralMissingBound();case"SumMissingBody":return i.sumMissingBody();case"ProductMissingBody":return i.productMissingBody();case"IntegralMissingBody":return i.integralMissingBody();case"DerivativeMissingBody":return i.derivativeMissingBody();case"IntegralMissingDifferential":return i.integralMissingDifferential();case"DifferentialWithSuperscript":return i.differentialWithSuperscript();case"FractionMissingNumerator":return i.fractionMissingNumerator();case"FractionMissingDenominator":return i.fractionMissingDenominator();case"FractionEmpty":return i.fractionEmpty();case"EmptySuperscript":return i.emptySuperscript();case"EmptySubscript":return i.emptySubscript();case"InvalidSubscript":return i.invalidSubscript(e.val);case"SuperscriptWithPrime":return i.superscriptWithPrime();case"PrimeWithoutParen":return i.primeWithoutParen();case"UnexpectedPrime":return i.unexpectedPrime();case"EmptyRadical":return i.emptyRadical();case"EmptyRadicalIndex":return i.emptyRadicalIndex();case"EmptySquareBracket":return i.emptySquareBracket();case"EmptyPipe":return i.emptyPipe();case"FunctionMissingArgument":return i.wrongArity(e.val,1,0);case"AdjacentNumbers":return i.adjacentNumbers(w(e.args[0]),w(e.args[1]));case"UnexpectedFor":return i.unexpectedForKeyword();default:throw"Unexpected surface node "+e.type+"."}}(t.error);default:throw"Unexpected surface node "+t.type+"."}}function y(e){return r.hasOwnProperty(e)}function m(e){return"ln"===e||"log"===e||"logbase"===e}function v(e,t){var n=e.nodes,s=t.args,u=s[0],l=s[1],p=f(e,u),d=c(e,o.unwrapSeq(l));if(I(u)){var h=a.emptySpanAt(l.span.input,l.span.start),v=e.setInput(E(e),h);return n.SeededFunctionCall(p,[v].concat(d))}if(o.isIdentifier(u))return n.FunctionCall(p,d);if("Superscript"===u.type){var g=u.args,b=g[0],x=g[1];if("Cmd"===b.type){var S=b.val;if(y(S)||m(S)){if(function(e){return"Decimal"===e.type&&"2"===e.val}(x))return n.Exponent([n.FunctionCall(S,d),f(e,x)]);if(function(e){return"Neg"===e.type&&"Decimal"===(e=e.args[0]).type&&"1"===e.val}(x)&&void 0!==r[S])return n.FunctionCall(r[S],d);throw y(S)?i.badTrigExponent(S):i.badLogExponent("logbase"===S?"log":S)}}}return n.Multiply([p,f(e,l)])}function g(e){return"Equals"===e.type||"Inequality"===e.type||"InequalityChain"===e.type}function b(e,t){var r=e.nodes;switch(t.type){case"Equals":return r.Comparator["="](c(e,t.args));case"Inequality":return r.Comparator[t.symbol](c(e,t.args));case"InequalityChain":if(t.chain.length>1)throw i.inequalityChainTooLong();var n=t.first,s=n.symbol,u=n.args,l=u[0],p=u[1],d=t.chain[0],f=d.symbol,h=d.args[0],y=a.emptySpanAt(t.span.input,t.span.start);return r.And([b(e,o.Inequality(y,s,[l,p])),b(e,o.Inequality(y,f,[p,h]))]);default:throw i.parseError()}}function x(e){return s.fromDecimalString(e.val)}function S(e){var t=s.fromDecimalString(e.whole),r=s.fromDecimalString(e.num),n=s.fromDecimalString(e.den);return s.add(t,s.div(r,n))}function T(e){return"Equals"===e.type&&o.isIdentifier(e.args[0])}function w(e){switch(e.type){case"Decimal":return e.val;case"MixedNumber":return e.whole+" "+e.num+"/"+e.den;default:throw new Error("Unexpected node type "+e.type)}}function _(e){switch(e.type){case"Letter":case"Decimal":case"MixedNumber":case"Cmd":case"EmptyPiecewise":return!0;case"Neg":for(var t=e.args[0];;)if("Pos"===t.type||"Paren"===t.type&&!d(t))t=t.args[0];else{if("Neg"!==t.type)break;t=t.args[0]}return"Decimal"===t.type||"MixedNumber"===t.type;case"Pos":case"Paren":return _(e.args[0]);case"Juxt":case"Mul":case"Div":return _(e.args[0])&&_(e.args[1]);case"Subscript":return _(e.args[0]);case"Superscript":case"Frac":case"Add":case"Sub":return _(e.args[0])&&_(e.args[1]);case"Piecewise":return"Equals"===(t=e.args[0]).type||"Inequality"===t.type||"InequalityChain"===t.type;case"Call":var r=e.args,n=r[0],i=r[1];return!o.isIdentifier(n)&&!o.isSuperscriptedIdentifier(n)&&(_(n)&&_(i));case"Derivative":case"Sqrt":case"Nthroot":case"Pipes":case"Bang":return!1;case"Equals":case"Inequality":case"InequalityChain":case"Tilde":case"ImplicitCall":case"Index":case"List":case"Seq":case"Integral":case"EmptyIntegral":case"Sum":case"Product":case"Colon":case"Ellipsis":case"For":case"Dot":case"PercentOf":case"Prime":case"EmptyRangeEnd":case"RightArrow":return!1;default:throw"Unexpected surface node "+e.type+"."}}function I(e){return"Cmd"===e.type&&("random"===e.val||"shuffle"===e.val)}function E(e){var t=e.nodes.ExtendSeed("",[e.nodes.Identifier("globalRandomSeed"),e.nodes.Seed(e.nextSeed())]);if(!e.seedExtensions)return t;for(var r=0,n=e.seedExtensions;r<n.length;r++){var i=n[r],a=i.prefix,o=i.expr;t=e.nodes.ExtendSeed(a,[t,o])}return t}function C(e,t){var r=e.seedExtensions||[];return n.__assign(n.__assign({},e),{seedExtensions:r.concat(t)})}t.lower=function(e,t){return function(e,t){return e.setInput(function(e,t){var r=e.nodes;switch(t.type){case"Equals":var n=t.args,a=n[0],s=n[1],u=l(a);if(u){var d=u.base,y=u.args;return r.FunctionDefinition(f(e,d),c(e,y),f(e,s))}return p(a)?r.Assignment(f(e,a),f(e,s)):r.Equation(f(e,a),f(e,s));case"Tilde":var m=c(e,t.args);a=m[0],s=m[1];return r.Regression(a,s);case"Inequality":return b(e,t);case"InequalityChain":if(t.chain.length>1)throw i.inequalityChainTooLong();var v=t.first,g=v.symbol,x=v.args,S=x[0],T=x[1],w=t.chain[0],_=w.symbol,I=w.args[0];return o.isIdentifier(T)?r.DoubleInequality([f(e,S),g,f(e,T),_,f(e,I)]):b(e,t);case"Call":var E=t.args,C=E[0],M=E[1];if("Cmd"===C.type)switch(C.val){case"histogram":return r.Histogram(c(e,o.unwrapSeq(M)));case"cube":case"sphere":case"cone":case"dodecahedron":case"octahedron":case"tetrahedron":return r.Object3D(c(e,o.unwrapSeq(M)),C.val);case"dotplot":return r.DotPlot(c(e,o.unwrapSeq(M)));case"boxplot":return r.BoxPlot(c(e,o.unwrapSeq(M)));case"ttest":return r.TTest(c(e,o.unwrapSeq(M)));case"ittest":return r.IndependentTTest(c(e,o.unwrapSeq(M)));case"stats":return r.Stats(c(e,o.unwrapSeq(M)));default:return h(e,t)}return h(e,t);default:return h(e,t)}}(e,t),t.span)}(e,t)},t.isFunctionSignature=function(e){return void 0!==l(e)},t.isLegalAssignmentLhs=p});r("core/math/parser/expression-parser",["require","exports","tslib","core/math/errormsg","./surface-node","./surface-node-error","./input-span","./expression-lexer","./precspec","./lower"],function(e,t,r,n,i,a,o,s,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0;var l=[[u.initial("("),u.la(")"),u.initial("\\{"),u.la("\\}"),u.r("["),u.la("]"),u.initial("(|"),u.la("|)"),u.la("Differential"),u.la("End")],[u.r("for")],[u.ra("...")],[u.la(",")],[u.ra(":")],[u.r("->")],[u.la("="),u.la(">"),u.la("<"),u.la(">="),u.la("<="),u.la("~")],[u.l("->")],[u.l("for")],[u.la("+"),u.la("-")],[u.la("*"),u.la("/"),u.la("Decimal"),u.la("MixedNumber"),u.la("Letter"),u.la("Cmd"),u.la("%"),u.r("("),u.la("\\{"),u.la("(|"),u.la("Frac"),u.la("Sqrt"),u.la("Trig"),u.la("Ln"),u.la("Log"),u.ra("Int"),u.ra("Sum"),u.ra("Prod")],[u.initial("+"),u.initial("-")],[u.la("!")],[u.la("SupSub")],[u.l("["),u.la(".")],[u.l("(")],[u.la("Err")]],p=u.precSpec(l),d=p.leftPrec,f=p.rightPrec,h=p.initialPrec,y={trailingComma:!1};function m(e,t){var r=(void 0===t?{isToplevel:!1}:t).isToplevel;if(s.isDone(e))return a.Err(s.spanStates(e,e),a.EmptyGroup());var n=g(e,0,{isToplevel:r}),i=n.state,o=n.tree;return"Err"===o.type||s.isDone(i)?o:P(i).tree}function v(e,t){return{state:e,tree:t}}function g(e,t,r){var o,u,c,l=(void 0===r?{isToplevel:!1}:r).isToplevel,p=e;if(o=function(e){var t,r,o,u,c,l,p,f,y,x,S,T,_,O,L,N,A,D,R,F=e,q=s.peek(e),B=h(q.type);switch(q.type){case"+":if(e=(t=g(e=s.advance(e),B)).state,"Err"===(R=t.tree).type){if(!b(R.error))return v(e,R);var V=s.spanStates(F,e);return v(e,a.Err(V,a.UnaryOperatorMissingRight(q.val)))}return v(e,i.Pos(s.spanStates(F,e),[R]));case"-":if(e=(r=g(e=s.advance(e),B)).state,"Err"===(R=r.tree).type){if(!b(R.error))return v(e,R);V=s.spanStates(F,e);return v(e,a.Err(V,a.UnaryOperatorMissingRight(q.val)))}return v(e,i.Neg(s.spanStates(F,e),[R]));case"(":return C(e);case"\\{":return e=s.advance(e),s.isAt(e,"\\}")?v(e=s.advance(e),i.EmptyPiecewise(s.spanStates(F,e))):(e=(u=k(F,e=(o=g(e,B)).state,R=o.tree,"\\{","\\}")).state,"Err"===(R=u.tree).type?v(e,R):v(e,i.Piecewise(s.spanStates(F,e),[R])));case"[":return e=s.advance(e),s.isAt(e,"]")?v(e=s.advance(e),i.List(s.spanStates(F,e),[])):(e=(l=k(F,e=(c=g(e,B)).state,R=c.tree,"[","]")).state,"Err"===(R=l.tree).type?v(e,R):v(e,i.List(s.spanStates(F,e),[R])));case"(|":if(e=s.advance(e),s.isAt(e,"|)")){e=s.advance(e);V=s.spanStates(F,e);return v(e,a.Err(V,a.EmptyPipe()))}return e=(f=k(F,e=(p=g(e,B)).state,R=p.tree,"(|","|)")).state,"Err"===(R=f.tree).type?v(e,R):v(e,i.Pipes(s.spanStates(F,e),[R]));case"Frac":if(e.opts.disallowFrac)throw n.fractionsUnavailable();e=s.advance(e);var z=m(s.lex(q.num,e.opts)),j=m(s.lex(q.den,e.opts));if("Err"===z.type&&"EmptyGroup"===z.error.type&&"Err"===j.type&&"EmptyGroup"===j.error.type){V=s.spanStates(F,e);return v(e,a.Err(V,a.FractionEmpty()))}if("Err"===z.type&&"EmptyGroup"===z.error.type){V=s.spanStates(F,e);return v(e,a.Err(V,a.FractionMissingNumerator()))}if("Err"===j.type&&"EmptyGroup"===j.error.type){V=s.spanStates(F,e);return v(e,a.Err(V,a.FractionMissingDenominator()))}if("Err"===z.type)return v(e,z);if("Err"===j.type)return v(e,j);if(i.isDerivative(z,j)&&"Juxt"===j.type){var U=j.args[1],G=void 0;if(e=(y=g(e,d("*")-1)).state,"Err"===(G=y.tree).type){if(b(G.error)){V=s.spanStates(F,e);return v(e,a.Err(V,a.DerivativeMissingBody()))}return v(e,G)}return v(e,i.Derivative(s.spanStates(F,e),[U,G]))}return v(e,i.Frac(s.spanStates(F,e),[z,j]));case"Sqrt":if(e=s.advance(e),q.optArg){var W=m(s.lex(q.optArg,e.opts));return"Err"===W.type?"EmptyGroup"===W.error.type?v(e,a.Err(W.span,a.EmptyRadicalIndex())):v(e,W):"Err"===(K=m(s.lex(q.arg,e.opts))).type?"EmptyGroup"===K.error.type?v(e,a.Err(K.span,a.EmptyRadical())):v(e,K):v(e,i.Nthroot(s.spanStates(F,e),[W,K]))}var K;return"Err"===(K=m(s.lex(q.arg,e.opts))).type?"EmptyGroup"===K.error.type?v(e,a.Err(K.span,a.EmptyRadical())):v(e,K):v(e,i.Sqrt(s.spanStates(F,e),[K]));case"Trig":case"Ln":e=s.advance(e);var H=i.Cmd(s.spanStates(F,e),q.val),J=0;if("SupSub"===(oe=s.peek(e)).type){if(e=s.advance(e),oe.sub){V=s.spanStates(F,e);return v(e,a.Err(V,a.UnexpectedSubscript(H.val)))}if(Z=I(oe,e.opts)){if("Err"===Z.type)return v(e,Z);H=i.Superscript(s.spanStates(F,e),[H,Z])}J=oe.nprimes}if(Y=s.isAt(e,"(")){if(e=(x=C(e)).state,"Err"===(R=x.tree).type)return v(e,R);R=i.Call(s.spanStates(F,e),[H,R.args[0]])}else{if(e=(S=g(e,B-1)).state,"Err"===(R=S.tree).type)return b(R.error)?v(e,a.Err(s.spanStates(F,e),a.FunctionMissingArgument(q.val))):v(e,R);R=i.ImplicitCall(s.spanStates(F,e),[H,R])}if(J>0){V=s.spanStates(F,e);if(!Y)return v(e,a.Err(V,a.PrimeWithoutParen()));R=i.Prime(V,J,[R])}return v(e,R);case"Log":e=s.advance(e);var Y,$=s.spanStates(F,e),X=(H=i.Cmd($,q.val),J=0,void 0),Z=void 0;if("SupSub"===(oe=s.peek(e)).type&&(X=w(oe,(e=s.advance(e)).opts),Z=I(oe,e.opts),J=oe.nprimes),X&&"Err"===X.type)return v(e,X);if(Z&&"Err"===Z.type)return v(e,Z);if(Y=s.isAt(e,"(")){if(e=(T=C(e)).state,"Err"===(R=T.tree).type)return v(e,R);R=R.args[0]}else if(e=(_=g(e,B-1)).state,"Err"===(R=_.tree).type)return b(R.error)?v(e,a.Err(s.spanStates(F,e),a.FunctionMissingArgument(q.val))):v(e,R);var Q=X?i.Cmd($,"\\logbase"):H,ee=X?i.Seq(s.spanStates(F,e),i.unwrapSeq(R).concat(X)):R;if(Z&&(Q=i.Superscript(s.spanStates(F,e),[Q,Z])),R=Y?i.Call(s.spanStates(F,e),[Q,ee]):i.ImplicitCall(s.spanStates(F,e),[Q,ee]),J>0){V=s.spanStates(F,e);if(!Y)return v(e,a.Err(V,a.PrimeWithoutParen()));R=i.Prime(V,J,[R])}return v(e,R);case"Int":if(e=s.advance(e),"Err"===(re=E(oe=s.peek(e),F,e=s.advance(e))).type)return"MissingBound"===re.error.type?v(e,a.Err(re.span,a.IntegralMissingBound())):v(e,re);Z=re.sup,X=re.sub,U=void 0;if(s.isAt(e,"Differential"))return e=(O=M(e)).state,"Err"===(U=O.tree).type?v(e,U):v(e,i.EmptyIntegral(s.spanStates(F,e),[U,X,Z]));if(e=(L=g(e,B)).state,"Err"===(R=L.tree).type)return b(R.error)?v(e,a.Err(R.span,a.IntegralMissingBody())):v(e,R);var te=R;return s.isAt(e,"Differential")?(e=(N=M(e)).state,"Err"===(U=N.tree).type?v(e,U):v(e,i.Integral(s.spanStates(F,e),[U,X,Z,te]))):v(e,a.Err(s.spanStates(F,e),a.IntegralMissingDifferential()));case"Sum":if(e=s.advance(e),"Err"===(re=E(oe=s.peek(e),F,e=s.advance(e))).type)return"MissingBound"===re.error.type?v(e,a.Err(re.span,a.SumMissingBound())):v(e,re);Z=re.sup,X=re.sub;return e=(A=g(e,B)).state,"Err"===(R=A.tree).type?b(R.error)?v(e,a.Err(R.span,a.SumMissingBody())):v(e,R):v(e,i.Sum(s.spanStates(F,e),[R,X,Z]));case"Prod":var re;if(e=s.advance(e),"Err"===(re=E(oe=s.peek(e),F,e=s.advance(e))).type)return"MissingBound"===re.error.type?v(e,a.Err(re.span,a.ProductMissingBound())):v(e,re);Z=re.sup,X=re.sub;return e=(D=g(e,B)).state,"Err"===(R=D.tree).type?b(R.error)?v(e,a.Err(R.span,a.ProductMissingBody())):v(e,R):v(e,i.Product(s.spanStates(F,e),[R,X,Z]));case"Cmd":return v(e=s.advance(e),R=i.Cmd(s.spanStates(F,e),q.val));case"Letter":return v(e=s.advance(e),R=i.Letter(s.spanStates(F,e),q.val));case"Decimal":e=s.advance(e);var ne=i.Decimal(s.spanStates(F,e),q.val);if("Decimal"===(oe=e.token).type||"MixedNumber"===oe.type){var ie=e;e=s.advance(e);V=s.spanStates(F,e);var ae="MixedNumber"===oe.type?oe:i.Decimal(s.spanStates(ie,e),oe.val);return v(e,a.Err(V,a.AdjacentNumbers([ne,ae])))}return v(e,ne);case"MixedNumber":if(e.opts.disallowFrac)throw n.fractionsUnavailable();var oe;if("Decimal"===(oe=(e=s.advance(e)).token).type||"MixedNumber"===oe.type){ie=e;e=s.advance(e);V=s.spanStates(F,e),ae="MixedNumber"===oe.type?oe:i.Decimal(s.spanStates(ie,e),oe.val);return v(e,a.Err(V,a.AdjacentNumbers([q,ae])))}return v(e,q);case"*":case"/":case",":case"=":case">":case"<":case">=":case"<=":case"->":case"~":case":":case"...":case"%":case".":e=s.advance(e);V=s.spanStates(F,e);return v(e,a.Err(V,a.BinaryOperatorMissingLeft(q.val)));case"for":e=s.advance(e);V=s.spanStates(F,e);return v(e,a.Err(V,a.UnexpectedFor()));case"!":e=s.advance(e);V=s.spanStates(F,e);return v(e,a.Err(V,a.UnaryOperatorMissingLeft(q.val)));case"SupSub":e=s.advance(e);var se="supsub";q.sub?se="subscript":q.sup?se="superscript":q.nprimes>0&&(se="prime");V=s.spanStates(F,e);return v(e,a.Err(V,a.UnaryOperatorMissingLeft(se)));case")":case"\\}":case"]":case"|)":case"Differential":return P(e);case"Err":e=s.advance(e);V=s.spanStates(F,e);return v(e,a.Err(V,a.UnrecognizedSymbol(q.val)));case"End":V=s.spanStates(F,e);return v(e,a.Err(V,a.UnexpectedEnd()));default:throw"Unexpected token type "+q.type+"."}}(p),p=o.state,"Err"===(c=o.tree).type)return v(p,c);if(!s.didAdvance(e,p))throw new Error("Programming Error: parseInitial did not advance state.");for(;!s.isDone(p);){if(t>=(s.isAt(p,"(")&&!T(c)?f("("):d(s.peek(p).type)))break;var y=p;if(p=(u=S(p,c,x(p,c,l)?d(",")-1:f(s.peek(p).type))).state,"Err"===(c=u.tree).type)return v(p,c);if(!s.didAdvance(y,p))throw new Error("Programming Error: parseSuccessor did not advance state.")}return v(p,c)}function b(e){return"UnexpectedDifferential"===e.type||"UnexpectedCloseDelimiter"===e.type||"UnexpectedEnd"===e.type||"BinaryOperatorMissingLeft"===e.type}function x(e,t,r){return s.isAt(e,"=")&&r&&(c.isFunctionSignature(t)||c.isLegalAssignmentLhs(t))}function S(e,t,r){var n,o,u,c,l,p,f,h,y,m,x,S,T,w=s.peek(e);switch(w.type){case"+":case"-":case"*":case"/":case"=":case"~":case":":case".":case"->":case"for":if(e=(n=g(e=s.advance(e),r)).state,"Err"===(T=n.tree).type){if(b(T.error)){var E=s.joinState(t.span,e);return v(e,a.Err(E,a.BinaryOperatorMissingRight(w.val)))}return v(e,T)}return v(e,function(e,t,r){switch(e){case"+":return i.Add(t,r);case"-":return i.Sub(t,r);case"*":return i.Mul(t,r);case"/":return i.Div(t,r);case"=":return i.Equals(t,r);case"~":return i.Tilde(t,r);case":":return i.Colon(t,r);case".":return i.Dot(t,r);case"->":return i.RightArrow(t,r);case"for":return i.For(t,r);default:throw"Unexpected token type "+e+"."}}(w.type,s.joinState(t.span,e),[t,T]));case"%":e=s.advance(e);var M=s.peek(e);if("Cmd"!==M.type||"of"!==M.val&&"\\of"!==M.val)return v(e,a.Err(w.span,a.PercentMissingOf()));if(e=(o=g(e=s.advance(e),r)).state,"Err"===(T=o.tree).type){if(b(T.error)){E=s.joinState(t.span,e);return v(e,a.Err(E,a.BinaryOperatorMissingRight(w.val)))}return v(e,T)}return v(e,i.PercentOf(s.joinState(t.span,e),[t,T]));case">=":case"<=":case">":case"<":var L=w.type;if(e=(u=g(e=s.advance(e),r)).state,"Err"===(T=u.tree).type){if(b(T.error)){E=s.joinState(t.span,e);return v(e,a.Err(E,a.BinaryOperatorMissingRight(w.val)))}return v(e,T)}for(var N=i.Inequality(s.joinState(t.span,e),L,[t,T]),A=[],D=s.peek(e).type;">="===D||"<="===D||">"===D||"<"===D;){var R=e;if(L=D,e=(c=g(e=s.advance(e),r)).state,"Err"===(T=c.tree).type){if(b(T.error)){E=s.joinState(t.span,e);return v(e,a.Err(E,a.BinaryOperatorMissingRight(w.val)))}return v(e,T)}A.push(i.TrailingInequalityPiece(s.spanStates(R,e),L,[T])),D=s.peek(e).type}return A.length?v(e,i.InequalityChain(s.joinState(t.span,e),N,A)):v(e,N);case"!":return v(e=s.advance(e),i.Bang(s.joinState(t.span,e),[t]));case"[":R=e;if(e=s.advance(e),s.isAt(e,"]")){e=s.advance(e);E=s.spanStates(R,e);return v(e,a.Err(E,a.EmptySquareBracket()))}return e=(p=k(R,e=(l=g(e,r)).state,T=l.tree,"[","]")).state,"Err"===(T=p.tree).type?v(e,T):v(e,i.Index(s.joinState(t.span,e),[t,T]));case"Sqrt":case"Frac":case"Letter":case"Cmd":case"Trig":case"Ln":case"Log":case"Sum":case"Int":case"Prod":case"Decimal":case"MixedNumber":case"\\{":case"(|":return e=(f=g(e,r)).state,"Err"===(T=f.tree).type?v(e,T):v(e,i.Juxt(s.joinState(t.span,e),[t,T]));case"(":if(i.isIdentifier(t)){if(e=(h=C(e)).state,"Err"===(T=h.tree).type)return v(e,T);E=s.joinState(t.span,e);return v(e,i.Call(E,[t,T.args[0]]))}if("Prime"===t.type&&i.isIdentifier(t.args[0])){if(e=(y=C(e)).state,"Err"===(T=y.tree).type)return v(e,T);E=s.joinState(t.span,e);return v(e,i.Prime(E,t.nprimes,[i.Call(E,[t.args[0],T.args[0]])]))}return e=(m=g(e,r)).state,"Err"===(T=m.tree).type?v(e,T):v(e,i.Juxt(s.joinState(t.span,e),[t,T]));case"SupSub":e=s.advance(e);var F=_(w),q=I(w,e.opts);if(F&&"Err"===F.type)return v(e,F);if(q&&"Err"===q.type)return v(e,q);if(F&&(t=i.Subscript(s.joinState(t.span,e),[t,F])),q&&(t=i.Superscript(s.joinState(t.span,e),[t,q])),w.nprimes>0){E=s.joinState(t.span,e);if(!i.isIdentifier(t))return v(e,a.Err(E,a.UnexpectedPrime()));t=i.Prime(E,w.nprimes,[t])}return v(e,t);case",":for(var B=[t];s.isAt(e,",")&&(e=s.advance(e),!s.isAt(e,"..."))&&(!e.opts.trailingComma||!O(e));){if(e=(x=g(e,r)).state,"Err"===(T=x.tree).type){if(b(T.error)){E=s.joinState(t.span,e);return v(e,a.Err(E,a.BinaryOperatorMissingRight(w.val)))}return v(e,T)}B.push(T)}return v(e,i.Seq(s.joinState(t.span,e),B));case"...":if(e=s.advance(e),s.isAt(e,",")&&(e=s.advance(e)),r>=d(s.peek(e).type))return v(e,i.Ellipsis(s.joinState(t.span,e),[t,i.EmptyRangeEnd(s.emptySpanAtState(e))]));if(e=(S=g(e,r)).state,"Err"===(T=S.tree).type){if(b(T.error)){E=s.joinState(t.span,e);return v(e,a.Err(E,a.BinaryOperatorMissingRight(w.val)))}return v(e,T)}return v(e,i.Ellipsis(s.joinState(t.span,e),[t,T]));case"]":case")":case"\\}":case"|)":case"Differential":return P(e);case"Err":return g(e,r);case"End":E=s.spanStates(e,e);return v(e,a.Err(E,a.UnexpectedEnd()));default:throw"Unexpected token type "+w.type+"."}}function T(e){return!!i.isIdentifier(e)||!("Prime"!==e.type||!i.isIdentifier(e.args[0]))}function w(e,t){if(e.sub){var r=e.sub,n=m(s.lex(r,t));return"Err"===n.type&&"EmptyGroup"===n.error.type?a.Err(n.span,a.EmptySubscript()):n}}function _(e){if(e.sub){var t=e.sub;if(0===t.args.length)return a.Err(t.span,a.EmptySubscript());for(var r=[],n=0,s=t.args;n<s.length;n++){var u=s[n];if("Digit"!==u.type&&"Letter"!==u.type){var c=u.span;return a.Err(c,a.InvalidSubscript(o.slice(c)))}r.push(u.val)}return i.Alphanumeric(t.span,r.join(""))}}function I(e,t){if(e.sup){var r=m(s.lex(e.sup,t));return"Err"===r.type?"EmptyGroup"===r.error.type?a.Err(r.span,a.EmptySuperscript()):r:e.nprimes>0?a.Err(e.span,a.SuperscriptWithPrime()):r}}function E(e,t,r){if("SupSub"!==e.type){var n=s.spanStates(t,r);return a.Err(n,a.MissingBound())}if(e.nprimes>0){n=s.spanStates(t,r);return a.Err(n,a.UnexpectedPrime())}var i=w(e,r.opts),o=I(e,r.opts);if(!i||"Err"===i.type&&"EmptySubscript"===i.error.type||!o||"Err"===o.type&&"EmptySuperscript"===o.error.type){n=s.spanStates(t,r);return a.Err(n,a.MissingBound())}return"Err"===i.type?i:"Err"===o.type?o:{type:"Bounds",sup:o,sub:i}}function C(e){var t,r,n,a=e,o=s.peek(e),u=h(o.type);if(!s.isAt(e,"("))throw new Error("Programming Error: expected '(' at start of parseParen.");if(e=s.advance(e),s.isAt(e,")")){var c=i.Seq(s.emptySpanAtState(e),[]);e=s.advance(e);var l=s.spanStates(a,e);return v(e,i.Paren(l,[c]))}return e=(r=k(a,e=(t=g(e,u)).state,n=t.tree,"(",")")).state,"Err"===(n=r.tree).type?v(e,n):v(e,i.Paren(s.spanStates(a,e),[n]))}function M(e){var t=e,r=s.peek(e);if("Differential"!==r.type)throw new Error("Programming Error: expected differential");e=s.advance(e);var n=i.Cmd(r.span,r.val),o=s.peek(e);if("SupSub"===o.type){e=s.advance(e);var u=s.spanStates(t,e),c=_(o);if(c){if("Err"===c.type)return v(e,c);n=i.Subscript(u,[n,c])}if(o.sup)return v(e,a.Err(u,a.DifferentialWithSuperscript()));if(o.nprimes>0)return v(e,a.Err(u,a.UnexpectedPrime()))}return v(e,n)}function k(e,t,r,n,i){if("Err"===r.type&&"UnexpectedEnd"!==r.error.type)return v(t,r);if("Err"===r.type||!s.isAt(t,i)){var o=s.spanStates(e,t);return v(t,a.Err(o,a.MissingCloseDelimiter(n,i)))}return v(t=s.advance(t),r)}function P(e){var t=e;switch(s.peek(e).type){case")":e=s.advance(e);var r=s.spanStates(t,e);return v(e,a.Err(r,a.UnexpectedCloseDelimiter("(",")")));case"]":e=s.advance(e);r=s.spanStates(t,e);return v(e,a.Err(r,a.UnexpectedCloseDelimiter("[","]")));case"\\}":e=s.advance(e);r=s.spanStates(t,e);return v(e,a.Err(r,a.UnexpectedCloseDelimiter("\\{","\\}")));case"|)":e=s.advance(e);r=s.spanStates(t,e);return v(e,a.Err(r,a.UnexpectedCloseDelimiter("|","|")));case"Differential":e=s.advance(e);r=s.spanStates(t,e);return v(e,a.Err(r,a.UnexpectedDifferential()));default:e=s.advance(e);r=s.spanStates(t,e);return v(e,a.Err(r,a.UnexpectedParseError()))}}function O(e){return s.isAt(e,")")||s.isAt(e,"]")||s.isAt(e,"\\}")}t.parse=function(e,t){var n=t?r.__assign(r.__assign({},y),t):y,i=m(s.lex(e,n),{isToplevel:!0});return"Err"===i.type&&"EmptyGroup"===i.error.type?a.Err(i.span,a.EmptyInput()):i}});r("core/math/baseparser",["require","exports","parsenodes","core/math/errormsg","core/math/parser/latex-parser","core/math/parser/expression-parser","core/math/parser/lower"],function(e,t,r,n,i,a,o){"use strict";function s(){throw n.featureUnavailable()}function u(e,t){return e.setInputSpan(t),e}Object.defineProperty(t,"__esModule",{value:!0}),t.parse=void 0,t.parse=function(e,t){var c=typeof e;if("string"!==c)throw new Error("Type Error: parse can only be called with strings, got "+JSON.stringify(e)+" of type "+c);var l=r;if((t=t||{}).disabledFeatures){l=Object.create(l);for(var p=0,d=t.disabledFeatures;p<d.length;p++){var f=d[p];if(!l[f])throw new Error("Programming Error: "+f+" cannot be disabled because it is not a parsenode.");l[f]=s}}var h=void 0===t.seedPrefix?"":t.seedPrefix,y=0,m={nodes:l,currentIndex:t.index,setInput:u,nextSeed:function(){var e=h+"::vc"+y;return y+=1,e},allowDt:!!t.allowDt,allowIndex:!!t.allowIndex},v={};void 0!==t.trailingComma&&(v.trailingComma=t.trailingComma),t.disallowFrac&&(v.disallowFrac=!0);try{var g=i.parse(e),b=a.parse(g,v);return o.lower(m,b)}catch(e){return e instanceof r.Error?e:"string"==typeof e?r.Error(e):n.parseError()}}});r("core/math/sliders",["require","exports"],function(e,t){"use strict";function r(e,t){var r=Math.round(1e6*e)/1e6;return Math.abs(r-e)<t?r:e}function n(e){var t=e.target,n=e.hardMin,i=e.hardMax,a=e.step,o=1e-10;if(void 0!==n&&void 0!==i&&(o=Math.min(o,Math.abs(i-n)/1e3)),a&&(o=Math.min(o,a/10)),void 0!==n&&(n=r(n,o)),void 0!==i&&(i=r(i,o)),e.forceSliderToMax&&void 0!==i&&(t=i),n>i)return n;if(t<=n)return n;if(t>=i)return i;if(a){var s=void 0!==n?n:0;t=a*Math.round((t-s)/a)+s}var u=r(t,o);return(a||n===u||i===u)&&(t=u),t<=n?n:t>=i?i:t}Object.defineProperty(t,"__esModule",{value:!0}),t.computeSoftMax=t.constrainSliderValueLikeEvaluator=t.determineWhichLimitsAreCompatibleWithValue=t.roundToReasonableDecimal=void 0,t.roundToReasonableDecimal=r,t.determineWhichLimitsAreCompatibleWithValue=function(e){var t=!0,r=!0,i=!0;return void 0!==e.hardMin&&e.target<e.hardMin&&(t=!1),void 0!==e.hardMax&&e.target>e.hardMax&&(r=!1),e.step&&n({target:e.target,step:e.step,hardMin:t?e.hardMin:void 0,hardMax:r?e.hardMax:void 0})!==e.target&&(i=!1),{min:t,max:r,step:i}},t.constrainSliderValueLikeEvaluator=n,t.computeSoftMax=function(e){var t=e.storedMax,r=e.sliderValue,i=e.hardMin,a=e.step,o=10;if(t>o&&(o=t),r>o&&(o=r),i>o&&(o=i),a){var s=n({target:o,hardMin:i,hardMax:void 0,step:a});o=s>=o?s:s+a}return o}});r("core/math/features/getConcreteTree",["require","parsenodes","core/math/errormsg","core/math/types","core/math/maybe-rational","core/math/sliders"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/errormsg"),n=e("core/math/types"),i=e("core/math/maybe-rational"),a=(t.List,t.ParenSeq,t.Constant),o=t.Identifier,s=e("core/math/sliders");function u(e,t){return e.isError?e:-1===t.indexOf(e.valueType)?r.parseError():e}function c(e,t,r){if(t){var n=t.getDependencies();if(t.isError)r.errors[e]=!0;else if(n.length>0){r.errors[e]=!0;for(var i=0;i<n.length;i++)n[i]===r.exportedSymbol?r.errors.cycle=!0:r.missingVars.push(n[i])}else r.values[e]=+t.asValue();r.valids[e]=isFinite(r.values[e]),r.valids[e]||(r.values[e]=void 0)}else r.valids[e]=!0}function l(e){return e&&e.valueType===n.ListOfNumber&&1===e.length&&e.args?e.args[0]:e}function p(e,i){if(!i[this._symbol])throw r.functionUnsupported(this._symbol);var a=this.args.map(function(t){return t.getConcreteTree(e,i)});if(a.length>0){if(1===a.length&&a.push(t.Constant(1).getConcreteTree(e,i)),a[1].getDependencies().length)throw r.illegalBinWidth(this._symbol).setDependencies(a[1].getDependencies());if(a[1].valueType!==n.Number)throw r.illegalBinWidth(this._symbol);var o=a[1].asValue();if(!isFinite(o)||o<=0)throw r.illegalBinWidth(this._symbol)}return this.typeCheck(e,a),new this.constructor(a)}function d(e,t){if(!t[this._symbol])throw r.functionUnsupported(this._symbol);var n=this.args.map(function(r){return r.getConcreteTree(e,t)});return this.typeCheck(e,n),new this.constructor(n)}t.Base.prototype.tryGetConcreteTree=function(){var e;try{e=this.getConcreteTree.apply(this,arguments)}catch(n){e=n instanceof t.Base?n:r.parseError()}return e},t.Base.prototype.getConcreteTree=function(e,t){var r=this.buildIRExpression(e,t);if(r.isError)throw r;return r},t.DoubleInequality.prototype.getConcreteTree=function(e,r){return new this.constructor([t.Piecewise([this._indicator,this._expressions[0],a(NaN)]).getConcreteTree(e,r),this._operators[0],o(this._symbol),this._operators[1],t.Piecewise([this._indicator,this._expressions[1],a(NaN)]).getConcreteTree(e,r)])},t.Error.prototype.getConcreteTree=function(e,t){return this},t.Image.prototype.getConcreteTree=function(e,r){var i=this.center.tryGetConcreteTree(e,r),a=this.radianAngle.tryGetConcreteTree(e,r),o=this.width.tryGetConcreteTree(e,r),s=this.height.tryGetConcreteTree(e,r),c=this.opacity.tryGetConcreteTree(e,r),l=[n.Point,n.ListOfPoint,n.EmptyList],p=[n.Number,n.ListOfNumber,n.EmptyList];return i=u(i,l),a=u(a,p),o=u(o,p),s=u(s,p),c=u(c,p),t.Image({center:i,radianAngle:a,width:o,height:s,opacity:c},this.moveStrategy)},t.Ticker.prototype.getConcreteTree=function(e,i){var a=this.handler.tryGetConcreteTree(e,i);a.isError||a.valueType===n.Action||(a=r.eventHandlerTypeError(n.prettyPrint(a.valueType)));var o=a.getDependencies().filter(function(t){return!e.validActionVariable(t)});return o.length&&(a=r.tooManyVariables(e.sliderVariables(o)).setDependencies(o)),t.Ticker({handler:a,minStep:this.minStep.tryGetConcreteTree(e,i)})},t.Slider.prototype.getConcreteTree=function(e,t){var n=this._expression.getConcreteTree(e,t),o=l(this.sliderMin&&this.sliderMin.tryGetConcreteTree(e,t)),u=l(this.sliderMax&&this.sliderMax.tryGetConcreteTree(e,t)),p=l(this.sliderStep&&this.sliderStep.tryGetConcreteTree(e,t)),d={exportedSymbol:this._symbol,errors:{},values:{},valids:{},missingVars:[],errMsg:void 0};if(c("min",o,d),c("max",u,d),c("step",p,d),p&&d.valids.step&&(0===d.values.step?delete d.values.step:d.values.step=Math.abs(d.values.step)),d.errors.cycle?n=r.sliderLimitReferencesExport(d.exportedSymbol):(d.errors.min||!d.valids.min?d.errMsg=r.sliderMinInvalid():d.errors.max||!d.valids.max?d.errMsg=r.sliderMaxInvalid():!d.errors.step&&d.valids.step||(d.errMsg=r.sliderStepInvalid()),d.values.min>d.values.max&&(d.valids.min=!1,d.valids.max=!1,d.errMsg||(d.errMsg=r.sliderMaxLessThanMin()))),n.isConstant){var f=t.initialEvaluation&&t.initialEvaluation.asValue()&&this.sliderIsPlayingOnce,h=d.values.max,y=+n.asValue(),m=d.values.min,v=d.values.step;if(f&&!isFinite(h)){var g=l(this.sliderSoftMax&&this.sliderSoftMax.tryGetConcreteTree(e,t));g&&(h=s.computeSoftMax({storedMax:+g.asValue(),sliderValue:y,step:v,hardMin:m}))}var b=s.constrainSliderValueLikeEvaluator({target:y,hardMin:m,hardMax:h,step:v,forceSliderToMax:f}),x=i.fromDecimalString(b.toString()),S=isFinite(i.asFloat(x))?x:b;n=a(S).getConcreteTree(e,t)}return n.sliderInfo=d,n},t.Histogram.prototype.getConcreteTree=p,t.DotPlot.prototype.getConcreteTree=p,t.BoxPlot.prototype.getConcreteTree=function(e,t){if(!t[this._symbol])throw r.functionUnsupported(this._symbol);var i=this.args.map(function(r){return r.getConcreteTree(e,t)});return this.typeCheck(e,i),1!==i.length||i[0].valueType!==n.ListOfNumber&&i[0].valueType!==n.EmptyList?r.parseError():new this.constructor(i)},t.TTest.prototype.getConcreteTree=d,t.IndependentTTest.prototype.getConcreteTree=d,t.Stats.prototype.getConcreteTree=d,t.Table.prototype.getConcreteTree=function(e,t){for(var r=[],n=Object.create(t),i=0;i<this.columns.length;i++){var a=this.columns[i].getConcreteTree(e,n);a.isIndependent&&this.columns[i].exportToLocal(a,n),r.push(a)}return new this.constructor(r)},t.TableColumn.prototype.getConcreteTree=function(e,i,a){var o,s,u=this.header.getConcreteTree(e,i);if(this.header instanceof t.Identifier&&!i[this.header._symbol]){o=[];for(var c=0;c<this.values.length;c++)if(this.values[c].tableError())o.push(r.invalidTableEntry(this.values[c].tableError()));else{var l=this.values[c].tryGetConcreteTree(e,i);l.isError?o.push(l):l.tableError()?o.push(r.invalidTableEntry(l.tableError())):l.valueType===n.Number?o.push(l):o.push(r.tableEntryTypeError([n.prettyPrint(l.valueType)]))}return(s=new this.constructor(u,this.length,o)).isIndependent=!0,s}if(u.isConstant){for(var p=[],d=0;d<this.length;d++)p.push(u);o=p}else o=u.isList?u.mapElements(function(e){return e}):[];if(u.isError||u.valueType===n.Number||u.valueType===n.ListOfNumber||u.valueType===n.EmptyList||(u=r.tableHeaderTypeError([n.prettyPrint(u.valueType)])),s=new this.constructor(u,this.length,o),void 0!==a){var f=this.header.tryGetConcreteTree(e,a);f.isError||f.valueType!==n.Number||(s.continuousConcreteTree=f)}return s}});r("core/math/builtinconstants",["require","core/math/parsenode/constant","core/math/maybe-rational"],function(e){"use strict";var t=e("core/math/parsenode/constant"),r=e("core/math/maybe-rational").maybeRational;return{pi:t(Math.PI),tau:t(2*Math.PI),e:t(Math.E),trigAngleMultiplier:t(r(1,1)),infty:t(1/0)}});r("core/math/builtinframe",["require","core/math/builtinconstants","core/math/ir/builtin-table"],function(e){"use strict";var t,r=e("core/math/builtinconstants"),n=e("core/math/ir/builtin-table"),i={};for(t in r)r.hasOwnProperty(t)&&(i[t]=r[t]);for(t in n.BuiltInTable)n.BuiltInTable.hasOwnProperty(t)&&(i[t]={isFunction:!0});for(t in n.CompilerFunctionTable)n.CompilerFunctionTable.hasOwnProperty(t)&&(i[t]={isFunction:!0});return i});r("core/math/ir/scope",["require","exports"],function(e,t){"use strict";function r(e,t){return{symbolMap:e,maxIndex:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.childScope=t.setSymbol=t.getSymbol=t.Scope=void 0,t.Scope=r,t.getSymbol=function(e,t){return e.symbolMap[t]},t.setSymbol=function(e,t,r){e.symbolMap[t]=r,e.maxIndex=Math.max(e.maxIndex,r)},t.childScope=function(e){return r(Object.create(e.symbolMap),e.maxIndex)}});!function(e){"use strict";function t(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function n(e,r,n,i,a,o){return t((s=t(t(r,e),t(i,o)))<<(u=a)|s>>>32-u,n);var s,u}function i(e,t,r,i,a,o,s){return n(t&r|~t&i,e,t,a,o,s)}function a(e,t,r,i,a,o,s){return n(t&i|r&~i,e,t,a,o,s)}function o(e,t,r,i,a,o,s){return n(t^r^i,e,t,a,o,s)}function s(e,t,r,i,a,o,s){return n(r^(t|~i),e,t,a,o,s)}function u(e,r){var n,u,c,l,p;e[r>>5]|=128<<r%32,e[14+(r+64>>>9<<4)]=r;var d=1732584193,f=-271733879,h=-1732584194,y=271733878;for(n=0;n<e.length;n+=16)u=d,c=f,l=h,p=y,d=i(d,f,h,y,e[n],7,-680876936),y=i(y,d,f,h,e[n+1],12,-389564586),h=i(h,y,d,f,e[n+2],17,606105819),f=i(f,h,y,d,e[n+3],22,-1044525330),d=i(d,f,h,y,e[n+4],7,-176418897),y=i(y,d,f,h,e[n+5],12,1200080426),h=i(h,y,d,f,e[n+6],17,-1473231341),f=i(f,h,y,d,e[n+7],22,-45705983),d=i(d,f,h,y,e[n+8],7,1770035416),y=i(y,d,f,h,e[n+9],12,-1958414417),h=i(h,y,d,f,e[n+10],17,-42063),f=i(f,h,y,d,e[n+11],22,-1990404162),d=i(d,f,h,y,e[n+12],7,1804603682),y=i(y,d,f,h,e[n+13],12,-40341101),h=i(h,y,d,f,e[n+14],17,-1502002290),d=a(d,f=i(f,h,y,d,e[n+15],22,1236535329),h,y,e[n+1],5,-165796510),y=a(y,d,f,h,e[n+6],9,-1069501632),h=a(h,y,d,f,e[n+11],14,643717713),f=a(f,h,y,d,e[n],20,-373897302),d=a(d,f,h,y,e[n+5],5,-701558691),y=a(y,d,f,h,e[n+10],9,38016083),h=a(h,y,d,f,e[n+15],14,-660478335),f=a(f,h,y,d,e[n+4],20,-405537848),d=a(d,f,h,y,e[n+9],5,568446438),y=a(y,d,f,h,e[n+14],9,-1019803690),h=a(h,y,d,f,e[n+3],14,-187363961),f=a(f,h,y,d,e[n+8],20,1163531501),d=a(d,f,h,y,e[n+13],5,-1444681467),y=a(y,d,f,h,e[n+2],9,-51403784),h=a(h,y,d,f,e[n+7],14,1735328473),d=o(d,f=a(f,h,y,d,e[n+12],20,-1926607734),h,y,e[n+5],4,-378558),y=o(y,d,f,h,e[n+8],11,-2022574463),h=o(h,y,d,f,e[n+11],16,1839030562),f=o(f,h,y,d,e[n+14],23,-35309556),d=o(d,f,h,y,e[n+1],4,-1530992060),y=o(y,d,f,h,e[n+4],11,1272893353),h=o(h,y,d,f,e[n+7],16,-155497632),f=o(f,h,y,d,e[n+10],23,-1094730640),d=o(d,f,h,y,e[n+13],4,681279174),y=o(y,d,f,h,e[n],11,-358537222),h=o(h,y,d,f,e[n+3],16,-722521979),f=o(f,h,y,d,e[n+6],23,76029189),d=o(d,f,h,y,e[n+9],4,-640364487),y=o(y,d,f,h,e[n+12],11,-421815835),h=o(h,y,d,f,e[n+15],16,530742520),d=s(d,f=o(f,h,y,d,e[n+2],23,-995338651),h,y,e[n],6,-198630844),y=s(y,d,f,h,e[n+7],10,1126891415),h=s(h,y,d,f,e[n+14],15,-1416354905),f=s(f,h,y,d,e[n+5],21,-57434055),d=s(d,f,h,y,e[n+12],6,1700485571),y=s(y,d,f,h,e[n+3],10,-1894986606),h=s(h,y,d,f,e[n+10],15,-1051523),f=s(f,h,y,d,e[n+1],21,-2054922799),d=s(d,f,h,y,e[n+8],6,1873313359),y=s(y,d,f,h,e[n+15],10,-30611744),h=s(h,y,d,f,e[n+6],15,-1560198380),f=s(f,h,y,d,e[n+13],21,1309151649),d=s(d,f,h,y,e[n+4],6,-145523070),y=s(y,d,f,h,e[n+11],10,-1120210379),h=s(h,y,d,f,e[n+2],15,718787259),f=s(f,h,y,d,e[n+9],21,-343485551),d=t(d,u),f=t(f,c),h=t(h,l),y=t(y,p);return[d,f,h,y]}function c(e){var t,r="",n=32*e.length;for(t=0;t<n;t+=8)r+=String.fromCharCode(e[t>>5]>>>t%32&255);return r}function l(e){var t,r=[];for(r[(e.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var n=8*e.length;for(t=0;t<n;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}function p(e){var t,r,n="0123456789abcdef",i="";for(r=0;r<e.length;r+=1)t=e.charCodeAt(r),i+=n.charAt(t>>>4&15)+n.charAt(15&t);return i}function d(e){return unescape(encodeURIComponent(e))}function f(e){return function(e){return c(u(l(e),8*e.length))}(d(e))}function h(e,t){return function(e,t){var r,n,i=l(e),a=[],o=[];for(a[15]=o[15]=void 0,i.length>16&&(i=u(i,8*e.length)),r=0;r<16;r+=1)a[r]=909522486^i[r],o[r]=1549556828^i[r];return n=u(a.concat(l(t)),512+8*t.length),c(u(o.concat(n),640))}(d(e),d(t))}function y(e,t,r){return t?r?h(t,e):p(h(t,e)):r?f(e):p(f(e))}"function"==typeof r&&r.amd?r("core/lib/md5",[],function(){return y}):"object"==typeof module&&module.exports?module.exports=y:e.md5=y}(this);r("core/vendor/d3-color",["require"],function(e){function t(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function r(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function n(){}var i=.7,a=1/i,o="\\s*([+-]?\\d+)\\s*",s="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",u="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",c=/^#([0-9a-f]{3,8})$/,l=new RegExp("^rgb\\("+[o,o,o]+"\\)$"),p=new RegExp("^rgb\\("+[u,u,u]+"\\)$"),d=new RegExp("^rgba\\("+[o,o,o,s]+"\\)$"),f=new RegExp("^rgba\\("+[u,u,u,s]+"\\)$"),h=new RegExp("^hsl\\("+[s,u,u]+"\\)$"),y=new RegExp("^hsla\\("+[s,u,u,s]+"\\)$"),m={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function v(){return this.rgb().formatHex()}function g(){return this.rgb().formatRgb()}function b(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=c.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?x(t):3===r?new _(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?S(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?S(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=l.exec(e))?new _(t[1],t[2],t[3],1):(t=p.exec(e))?new _(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=d.exec(e))?S(t[1],t[2],t[3],t[4]):(t=f.exec(e))?S(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=h.exec(e))?M(t[1],t[2]/100,t[3]/100,1):(t=y.exec(e))?M(t[1],t[2]/100,t[3]/100,t[4]):m.hasOwnProperty(e)?x(m[e]):"transparent"===e?new _(NaN,NaN,NaN,0):null}function x(e){return new _(e>>16&255,e>>8&255,255&e,1)}function S(e,t,r,n){return n<=0&&(e=t=r=NaN),new _(e,t,r,n)}function T(e){return e instanceof n||(e=b(e)),e?new _((e=e.rgb()).r,e.g,e.b,e.opacity):new _}function w(e,t,r,n){return 1===arguments.length?T(e):new _(e,t,r,null==n?1:n)}function _(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function I(){return"#"+C(this.r)+C(this.g)+C(this.b)}function E(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function C(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function M(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new O(e,t,r,n)}function k(e){if(e instanceof O)return new O(e.h,e.s,e.l,e.opacity);if(e instanceof n||(e=b(e)),!e)return new O;if(e instanceof O)return e;var t=(e=e.rgb()).r/255,r=e.g/255,i=e.b/255,a=Math.min(t,r,i),o=Math.max(t,r,i),s=NaN,u=o-a,c=(o+a)/2;return u?(s=t===o?(r-i)/u+6*(r<i):r===o?(i-t)/u+2:(t-r)/u+4,u/=c<.5?o+a:2-o-a,s*=60):u=c>0&&c<1?0:s,new O(s,u,c,e.opacity)}function P(e,t,r,n){return 1===arguments.length?k(e):new O(e,t,r,null==n?1:n)}function O(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function L(e,t,r){return 255*(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)}return t(n,b,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:v,formatHex:v,formatHsl:function(){return k(this).formatHsl()},formatRgb:g,toString:g}),t(_,w,r(n,{brighter:function(e){return e=null==e?a:Math.pow(a,e),new _(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?i:Math.pow(i,e),new _(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:I,formatHex:I,formatRgb:E,toString:E})),t(O,P,r(n,{brighter:function(e){return e=null==e?a:Math.pow(a,e),new O(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?i:Math.pow(i,e),new O(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new _(L(e>=240?e-240:e+120,i,n),L(e,i,n),L(e<120?e+240:e-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}})),{Color:n,darker:i,brighter:a,color:b,rgbConvert:T,rgb:w,Rgb:_,hslConvert:k,hsl:P}});r("core/math/mathshim",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sign=t.sqrtxsqm1=t.sqrtxsqp1=t.log1p=t.expm1=t.atanh=t.asinh=t.acosh=t.tanh=t.sinh=t.cosh=void 0;var r=Math;t.cosh=r.cosh||function(e){return.5*(Math.exp(e)+Math.exp(-e))},t.sinh=r.sinh&&0!==r.sinh(1e-20)?r.sinh:function(e){var r=e>0?1:-1;return e=e>0?e:-e,.5*-r*Math.exp(e)*t.expm1(-2*e)},t.tanh=r.tanh&&0!==r.tanh(1e-20)?r.tanh:function(e){var r=e>0?1:-1;e=e>0?e:-e;var n=t.expm1(-2*e);return-r*n/(2+n)},t.acosh=r.acosh||function(e){return e<1?NaN:Math.log(e+t.sqrtxsqm1(e))},t.asinh=r.asinh&&0!==r.asinh(1e-20)?r.asinh:function(e){var r=e>0?1:-1;return 1+(e=e>0?e:-e)*e==1?r*t.log1p(e):r*Math.log(e+t.sqrtxsqp1(e))},t.atanh=r.atanh&&0!==r.atanh(1e-20)?r.atanh:function(e){return.5*(t.log1p(e)-t.log1p(-e))},t.expm1=r.expm1||function(e){return e+.5*e*e===e?e:Math.exp(e)-1},t.log1p=r.log1p||function(e){return e-.5*e*e===e?e:Math.log(1+e)};t.sqrtxsqp1=function(e){var t=e*e;return 1+t===1?1:1+t===t?Math.abs(e):Math.sqrt(t+1)};t.sqrtxsqm1=function(e){var t=e*e;return t<1?NaN:t-1===t?Math.abs(e):Math.sqrt(t-1)},t.sign=r.sign||function(e){return 0===e?0:e>0?1:e<0?-1:NaN}});r("core/math/poi",["require","exports","core/math/distance"],function(e,t,r){"use strict";function n(e,t){var n;e>t&&(n=e,e=t,t=n);var i=e>0,a=t>0,o=Math.abs(e)>.01,s=Math.abs(t)>.01;if(o||s)return r.mean(e,t);if(0===e)return t*Math.abs(t);if(0===t)return e*Math.abs(e);if(i!==a)return 0;var u=i?Math.sqrt(e*t):-Math.sqrt(e*t);return u>=e&&t>=u?u:r.mean(e,t)}function i(e,t,r,i,s,u,c){var l,p,d,f;if(isFinite(i))return isFinite(t)||(l=a(e,t,r,i,c))&&(e=l[0],t=l[1]),isFinite(u)||(l=a(r,i,s,u,c))&&(s=l[0],u=l[1]),p=t===i?[e,t]:o(e,t,r,i,c,i),d=u===i?[s,u]:o(r,i,s,u,c,i),p&&d&&(f=n(p[0],d[0])),void 0!==f?[f,c(f)]:void 0}function a(e,t,r,i,a){if(isFinite(t)!==isFinite(i))for(;;){var o=n(e,r),s=a(o);if(o===e||o===r)return isFinite(t)?[e,t]:[r,i];isFinite(s)!==isFinite(t)?(r=o,i=s):(e=o,t=s)}}function o(e,t,r,i,a,o){if(t===o!=(i===o))for(;;){var s=n(e,r),u=a(s);if(s===e||s===r)return t===o?[e,t]:[r,i];u===o!=(t===o)?(r=s,i=u):(e=s,t=u)}}function s(e,t){var r=e[0],n=e[1],i=t[0],a=t[1];return(i-r)*(i-r)+(a-n)*(a-n)}function u(e,t,r,i,a,o){var u,c,l,p,d,f,h,y,m,v=o(e),g=o(t),b=o(r),x=s(v,i),S=s(g,i),T=s(b,i);if(!(t<=e||r<=t)&&isFinite(x)&&isFinite(S)&&isFinite(T)&&!(S>=x||S>=T))for(;;){if(Math.abs(b[0]-v[0])<a&&Math.abs(b[1]-v[1])<a)return[e,r];var w=n(e,t),_=o(w),I=s(_,i),E=n(t,r),C=o(E),M=s(C,i);if(!isFinite(I)||!isFinite(M))return;if(w===e||w===t||E===t||E===r)return I<S&&I<M?[w,w]:M<I&&M<S?[E,E]:[t,t];if(!(I!==S&&M!==S||I!==(S=s(g=o(t=.5*(w+t)),i))&&M!==S))return[e,r];I<S&&I<M?(r=(u=[t,w])[0],t=u[1],b=(c=[g,_])[0],g=c[1],T=(l=[S,I])[0],S=l[1]):M<I&&M<S?(e=(p=[t,E])[0],t=p[1],v=(d=[g,C])[0],g=d[1],x=(f=[S,M])[0],S=f[1]):(e=(h=[w,E])[0],r=h[1],v=(y=[_,C])[0],b=y[1],x=(m=[I,M])[0],T=m[1])}}function c(e,t,r){return void 0===t&&(t=-1/0),void 0===r&&(r=1/0),Math.min(r,Math.max(t,e))}function l(e,t,r,n,i,a){var o,l,p,d,f;void 0!==n&&void 0!==i?f=r+.01*(r<.5*(n+i)?i-n:n-i):f=Math.abs(r)>1?1.00001*r:r+1e-5;var h=e(r),y=e(f),m=s(h,t),v=s(y,t);if(isFinite(m)&&isFinite(v)){if(m===v)return[r,f];for(v>m&&(r=(o=[f,r])[0],f=o[1],h=(l=[y,h])[0],y=l[1],m=(p=[v,m])[0],v=p[1]);isFinite(r)&&isFinite(f)&&r!==f;){if(void 0!==i&&f>i)return[i,i];if(void 0!==n&&f<n)return[n,n];var g=r+3*(f-r),b=s(e(g),t);if(!isFinite(b))return[r,f];if(b===v)return[r,f];if(b>v){var x=f>r?u(r,f,g,t,a,e):u(g,f,r,t,a,e);return x?[c(x[0],n,i),c(x[1],n,i)]:x}r=(d=[f,v,g,b])[0],m=d[1],f=d[2],v=d[3]}return[r,f]}}function p(e,t,r,n){return!r||!!n&&Math.min(s(e(n[0]),t),s(e(n[1]),t))<Math.min(s(e(r[0]),t),s(e(r[1]),t))}function d(e,t,r,n,i,a,o,s){var u=Math.abs(n-t),c=Math.abs(a-n),l=Math.abs(s-a);return u>c&&u>l?[[e,t],[r,n]]:l>c&&l>u?[[i,a],[o,s]]:[[r,n],[i,a]]}Object.defineProperty(t,"__esModule",{value:!0}),t.bisectJump=t.findLocalClosestPointOnParametric=t.bisectClosestPointOnParametric=t.bisectExtremum=t.bisectFinite=t.flatCenter=t.bisectZero=t.floatMiddle=void 0,t.floatMiddle=n,t.bisectZero=function(e,t,r,a,o){if(!isNaN(t)&&!isNaN(a)&&t<0!=a<0)for(;;){var s=n(e,r),u=o(s);if(!isFinite(u))return;if(s===e||s===r)return Math.abs(t)<=Math.abs(a)?[e,t]:[r,a];if(0===u)return i(e,t,s,u,r,a,o);t<0!=u<0?(r=s,a=u):(e=s,t=u)}},t.flatCenter=i,t.bisectFinite=a,t.bisectExtremum=function(e,t,r,a,o,s,u){if(e<r&&r<o&&isFinite(t)&&isFinite(a)&&isFinite(s)&&t!==a&&a!==s&&a>t==a>s)for(;;){var c=n(e,r),l=u(c),p=n(r,o),d=u(p);if(!isFinite(l)||!isFinite(d))return;if(c===e||c===r||p===r||p===o)return l>a==a>t?[c,l]:d>a==a>t?[p,d]:[r,a];if(l===a||d===a)return i(e,t,r,a,o,s,u);l>t==a>t&&l>t==l>a?(o=r,s=a,r=c,a=l):d>s==a>s&&d>a==d>s?(e=r,t=a,r=p,a=d):(e=c,t=l,o=p,s=d)}},t.bisectClosestPointOnParametric=u,t.findLocalClosestPointOnParametric=function(e,t,r,n,i,a){var o=l(e,t,r,n,i,a);if(void 0!==n){var s=l(e,t,n,n,i,a);p(e,t,o,s)&&(o=s)}if(void 0!==i){var u=l(e,t,i,n,i,a);p(e,t,o,u)&&(o=u)}return o},t.bisectJump=function(e,t,i,o,s,u,c,l){if(l||(l=0),!((i-e)*(s-i)<=0)&&isFinite(e)&&isFinite(i)&&isFinite(s)&&isFinite(t)&&isFinite(u)){if(!isFinite(o)){var p=a(e,t,i,o,c),f=a(i,o,s,u,c);if(!p||!f)return;return[p,f]}if(!(Math.abs(o-((s-i)*t+(i-e)*u)/(s-e))<l))for(;;){var h=n(e,i),y=c(h),m=n(i,s),v=c(m),g=Math.abs(y-r.mean(t,o)),b=Math.abs(o-r.mean(y,v)),x=Math.abs(v-r.mean(o,u));if(g<=l&&b<=l&&x<=l)return;if(!isFinite(y)){p=a(e,t,h,y,c),f=a(h,y,s,u,c);if(!p||!f)return;return[p,f]}if(!isFinite(v)){p=a(e,t,m,v,c),f=a(m,v,s,u,c);if(!p||!f)return;return[p,f]}if(!(h!==e&&h!==i||m!==i&&m!==s))return Math.abs(o-t)>Math.abs(u-o)?[[e,t],[i,o]]:[[i,o],[s,u]];if(h===e||h===i)return d(e,t,i,o,m,v,s,u);if(m===i||m===s)return d(e,t,h,y,i,o,s,u);g>x&&g>=b?(s=i,u=o,i=h,o=y):x>g&&x>=b?(e=i,t=o,i=m,o=v):(e=h,t=y,s=m,u=v)}}}});r("core/math/quadrature",["require","core/math/mathshim","core/math/poi"],function(e){"use strict";var t=e("core/math/mathshim"),r=e("core/math/poi"),n=r.bisectJump,i=r.bisectFinite,a=Math.pow(2,-13),o=a*a,s=o*o,u=o,c=[],l=[];!function(e,r){for(var n=32;n>0;n--){var i=.09856311095410075*n,a=t.sinh(i),o=t.cosh(Math.PI/2*a),s=1/(Math.exp(Math.PI/2*a)*o),u=t.cosh(i)/(o*o);e.push(s),r.push(u)}}(c,l);for(var p=0,d=0;d<l.length;d++)p+=l[d];var f=1/(1+2*p);function h(e,t,r){return.5*(t*(2-r)+e*r)}function y(e,t,r){var i=.5*(t+r),a=n(t,e(t),i,e(i),r,e(r),e,0);return a?.5*(a[0][0]+a[1][0]):i}function m(e,t,r,n,i){return{x1:e,x2:t,value:r,error:n,minerror:i}}function v(e,t,r){var n=Math.abs(e(h(t,r,o))),i=Math.abs(e(h(t,r,2*o))),a=Math.abs(e(h(t,r,4*o)));return!(n<o||i<o)&&(n>1.95*i&&i>1.95*a)}function g(e,t,r){var n,a,o=h(r,t,c[0]),s=h(t,r,c[0]),p=e(o),d=e(s),y=h(t,r,1),g=e(y);if(isFinite(g)&&!isFinite(p)){if(n=i(o,p,y,g,e),Math.abs((n[0]-t)/(r-t))>u)return m(t,r,NaN,NaN,NaN);t=n[0],p=n[1]}if(isFinite(g)&&!isFinite(d)){if(a=i(y,g,s,d,e),Math.abs((a[0]-r)/(r-t))>u)return m(t,r,NaN,NaN,NaN);r=a[0],d=a[1]}if(isFinite(p)&&isFinite(d)&&!isFinite(g)){if(n=i(o,p,y,g,e),a=i(y,g,s,d,e),Math.abs((a[0]-n[0])/(r-t))>u)return m(t,r,NaN,NaN,NaN);g=.5*(n[1]+a[1])}if(v(e,t,r)||v(e,r,t))return m(t,r,NaN,NaN,NaN);for(var b=g,x=0,S=0,T=0,w=0,_=0,I=0,E=0;E<32;E+=4)_=e(h(t,r,c[E])),I=e(h(r,t,c[E])),w=Math.max(w,Math.abs(_),Math.abs(I)),x+=l[E]*(_+I),_=e(h(t,r,c[E+1])),I=e(h(r,t,c[E+1])),w=Math.max(w,Math.abs(_),Math.abs(I)),T+=l[E+1]*(_+I),_=e(h(t,r,c[E+2])),I=e(h(r,t,c[E+2])),w=Math.max(w,Math.abs(_),Math.abs(I)),S+=l[E+2]*(_+I),_=e(h(t,r,c[E+3])),I=e(h(r,t,c[E+3])),w=Math.max(w,Math.abs(_),Math.abs(I)),T+=l[E+3]*(_+I);var C,M=b+x,k=M+S,P=k+T,O=Math.abs(S-M),L=Math.abs(T-k),N=f*(r-t)*P,A=f*Math.abs(r-t)*w*l[0];return C=0===O?f*Math.abs(r-t)*L:f*Math.abs(r-t)*L*(L/O)*(L/O),m(t,r,N,C=Math.max(C,A),A)}function b(e){for(var t=-1/0,r=-1/0,n=-1,i=0,a=0;a<e.length;a++){var o=e[a];i+=o.value,o.error>t&&(t=o.error,n=a),o.minerror>r&&(r=o.minerror)}return{maxerror:t,maxminerror:r,maxindex:n,totalvalue:i}}return{quad:function e(t,r,n,i){if(void 0===i&&(i=32),isNaN(r)||isNaN(n))return NaN;var a=1;if(r>n){var o=r;r=n,n=o,a=-1}if(r===1/0&&n===1/0)return NaN;if(r===-1/0&&n===-1/0)return NaN;if(r===-1/0&&n===1/0)return a*e(function(e){return t(e/((1+e)*(1-e)))*(1+e*e)/((1+e)*(1+e)*(1-e)*(1-e))},-1,1,i);if(r===-1/0)return a*e(function(e){return-t(n-e/(1-e))/((1-e)*(1-e))},1,0,i);if(n===1/0)return a*e(function(e){return t(r+e/(1-e))/((1-e)*(1-e))},0,1,i);for(var u=[g(t,r,n)],c=b(u),l=1;l<i&&(!(Math.abs(c.maxerror/c.totalvalue)<=32*s||c.maxerror<=32*s||c.maxerror<=32*c.maxminerror)&&isFinite(c.maxerror)&&isFinite(c.maxminerror));l++){var p=u[u.length-1];u[u.length-1]=u[c.maxindex],u[c.maxindex]=p;var d=u.pop(),f=y(t,h(d.x2,d.x1,.125),h(d.x1,d.x2,.125));u.push(g(t,d.x1,f)),u.push(g(t,f,d.x2)),c=b(u)}return isFinite(c.maxerror)&&isFinite(c.maxminerror)?Math.abs(c.totalvalue)<=10*c.maxminerror?0:a*c.totalvalue:NaN}}});r("core/math/builtin",["require","exports","core/lib/md5","core/vendor/d3-color","core/math/quadrature","core/math/mathshim","core/math/mathshim","core/math/distance","core/math/distance","core/math/tofraction","core/math/poi","./maybe-rational","./builtin-common"],function(e,t,r,n,i,a,o,s,u,c,l,p,d){"use strict";function f(e,t,r){return Math.max(t,Math.min(r,e))}function h(e,r){e=Math.round(e),r=Math.round(r);var n=t.gcd(e,r);return Math.abs(e/n*r)}function y(e){return m(e+1)}function m(e){if(e<0)return Math.PI/(_(Math.PI*e)*m(1-e));if(e>170)return 1/0;var t,r=Math.round(e)===e;return t=e<15?v(e):e<120?function(e){var t=e-1;return Math.pow(t,t)*Math.exp(L(t)-t)*Math.sqrt(2*Math.PI*t)}(e):Math.exp(g(e)),r?Math.round(t):t}function v(e){var t=1+e*(4.077131788261185+e*(7.024675027156382+e*(6.657107767450176+e*(3.766266976716022+e*(1.2792371666711133+e*(.24304596436338005+.020049769312165774*e)))))),r=1+e*(4.154347453162709+e*(7.270007565107539+e*(6.97805297331391+e*(3.989651532924167+e*(1.367176195613119+e*(.26175627691546965+.021742722739397567*e))))));return Math.E*Math.pow((1+e)/Math.E,1+e)/(e*Math.sqrt(1+e))*(t/r)}function g(e){var t=e-1;return t*(Math.log(t)-1)+.5*Math.log(2*Math.PI*t)+L(t)}function b(e,t){if(e!==Math.floor(e))return NaN;if(e<0)return NaN;if(0===e)return 1/E(t);var r=_(t);if(1===e)return-1/(r*r);var n=I(t);if(2===e)return 2*n/(r*r*r);for(var i=[0,2],a=[],o=3;o<=e;o++){a=[];for(var s=0;s<o;s++){var u=0,c=0;s>0&&(u=(o-s+1)*i[s-1]),s+2<o&&(c=(s+1)*i[s+1]),a.push(-(u+c))}i=a}var l=0;for(s=e-1;s>=0;s--)l=a[s]+n*l;return l/Math.pow(r,e+1)}function x(e,t){return 0===t?NaN:(r=t===Math.E?Math.log(e):2===t&&Math.log2?Math.log2(e):10===t&&Math.log10?Math.log10(e):Math.log(e)/Math.log(t),Math.pow(t,Math.round(r))===e?Math.round(r):r);var r}Object.defineProperty(t,"__esModule",{value:!0}),t.uniquePerm=t.elementsAt=t.select=t.polygon=t.hsv=t.rgb=t.distance=t.quad=t.stdevp=t.stdev=t.spearman=t.rank=t.validateSampleCount=t.validateRangeLength=t.corr=t.cov=t.covp=t.variance=t.mad=t.varp=t.argMax=t.argMin=t.median=t.lowerQuartileIndex=t.upperQuartileIndex=t.lowerQuantileIndex=t.upperQuantileIndex=t.quartileIndex=t.sortPerm=t.quartile=t.quantile=t.listMax=t.listMin=t.length=t.stats=t.ittest=t.ttest=t.itscore=t.tscore=t.invUniform=t.invT=t.invBinom=t.invPoisson=t.invNorm=t.erfcx=t.erf=t.uniformcdf=t.uniformpdf=t.poissoncdf=t.poissonpdf=t.binompdf=t.binomcdf=t.poissonSample=t.binomSample=t.tSample=t.normalSample=t.uniformSample=t.randomPerm=t.shuffle=t.random=t.normalpdf=t.normalcdf=t.tcdf=t.tpdf=t.total=t.mean=t.acoth=t.acsch=t.asech=t.coth=t.csch=t.sech=t.asec=t.acsc=t.acot=t.cot=t.csc=t.sec=t.tan=t.cos=t.sin=t.nthroot=t.common_log=t.log_base=t.log=t.polyGamma=t.cotDerivative=t.bernoulliTable=t.lnGamma=t.gamma=t.factorial=t.nPr=t.nCr=t.listLCM=t.listGCD=t.lcm=t.mod=t.pow=t.gcd=t.toFraction=t.hypot=t.sign=t.sqrtxsqm1=t.sqrtxsqp1=t.log1p=t.expm1=t.atanh=t.asinh=t.acosh=t.tanh=t.sinh=t.cosh=t.md5Spyable=void 0,t.md5Spyable=r,Object.defineProperty(t,"cosh",{enumerable:!0,get:function(){return o.cosh}}),Object.defineProperty(t,"sinh",{enumerable:!0,get:function(){return o.sinh}}),Object.defineProperty(t,"tanh",{enumerable:!0,get:function(){return o.tanh}}),Object.defineProperty(t,"acosh",{enumerable:!0,get:function(){return o.acosh}}),Object.defineProperty(t,"asinh",{enumerable:!0,get:function(){return o.asinh}}),Object.defineProperty(t,"atanh",{enumerable:!0,get:function(){return o.atanh}}),Object.defineProperty(t,"expm1",{enumerable:!0,get:function(){return o.expm1}}),Object.defineProperty(t,"log1p",{enumerable:!0,get:function(){return o.log1p}}),Object.defineProperty(t,"sqrtxsqp1",{enumerable:!0,get:function(){return o.sqrtxsqp1}}),Object.defineProperty(t,"sqrtxsqm1",{enumerable:!0,get:function(){return o.sqrtxsqm1}}),Object.defineProperty(t,"sign",{enumerable:!0,get:function(){return o.sign}}),Object.defineProperty(t,"hypot",{enumerable:!0,get:function(){return u.hypot}}),t.toFraction=c.default,t.gcd=d.gcd,t.pow=d.pow,t.mod=function(e,t){var r=e%t;return e*t<0&&0!==r?r+t:r},t.lcm=h,t.listGCD=function(e){if(0===e.length)return NaN;for(var r=e[0],n=1;n<e.length;n++)r=t.gcd(r,e[n]);return r},t.listLCM=function(e){if(0===e.length)return NaN;for(var t=e[0],r=1;r<e.length;r++)t=h(t,e[r]);return t},t.nCr=function(e,t){if(e=Math.round(e),(t=Math.round(t))>e||e<0||t<0)return 0;if(t===1/0||e===1/0)return NaN;t>e-t&&(t=e-t);for(var r=1,n=0;n<t;n++)r*=(e-n)/(n+1);return Math.round(r)},t.nPr=function(e,t){if(e=Math.round(e),(t=Math.round(t))>e||e<0||t<0)return 0;if(t===1/0||e===1/0)return NaN;for(var r=1,n=0;n<t;n++)r*=e-n;return r},t.factorial=y,t.gamma=m,t.lnGamma=function(e){return e<0?NaN:e<15?Math.log(v(e)):g(e)},t.bernoulliTable=[1/6,-1/30,1/42,-1/30,5/66,-691/2730,7/6,-3617/510,43867/798,-174611/330,854513/138,-236364091/2730,8553103/6,-23749461029/870],t.cotDerivative=b,t.polyGamma=function e(r,n){if(r<0)return NaN;if(r!==Math.floor(r))return NaN;var i=r%2==0?-1:1;if(n<0)return-i*e(r,1-n)-Math.pow(Math.PI,r+1)*b(r,Math.PI*n);for(var a=y(r),o=0,s=Math.pow(n,-(r+1));n<10;)o+=s,n++,s=Math.pow(n,-(r+1));o+=0===r?-Math.log(n):s*n/r,o+=.5*s;for(var u=t.bernoulliTable,c=r+1,l=2,p=s*n*c/l,d=1/(n*n),f=1;f<=14;f++)o+=(p*=d)*u[f-1],p*=++c/++l,p*=++c/++l;return a*i*o},t.log=function(e){var t=Math.log(e);return Math.exp(Math.round(t))===e?Math.round(t):t},t.log_base=x,t.common_log=function(e){return x(e,10)},t.nthroot=function(e,r){return t.pow(e,1/r)};var S=1/Math.PI;function T(e){return!(e>1e12)&&Math.round(S*e)*Math.PI===e}function w(e){if(e>1e12)return!1;var t=Math.round(2*S*e);return t%2==1&&t*Math.PI==2*e}function _(e){return T(Math.abs(e))?0:Math.sin(e)}function I(e){return w(Math.abs(e))?0:Math.cos(e)}function E(e){var t=Math.abs(e);return T(t)?0:w(t)?1/0:Math.tan(e)}function C(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function M(e){return e>50?Math.exp(.5*((1-e)*a.log1p(-1/(e-1))-1)+O(.5*(e-1))-O(.5*(e-2)))*Math.sqrt((1-1/e)/(2*Math.PI)):m((e+1)/2)/(m(e/2)*Math.sqrt(e*Math.PI))}function k(e,t,r){if(void 0===r&&(r=e-t),Math.abs(r)<.1*(e+t))for(var n=r/(e+t),i=r*r/(e+t),a=2*e*n,o=1;o<10;o++){var s=i+(a*=n*n)/(2*o+1);if(s==i)return s;i=s}return e*Math.log(e/t)+t-e}t.sin=_,t.cos=I,t.tan=E,t.sec=function(e){return w(Math.abs(e))?1/0:1/Math.cos(e)},t.csc=function(e){return T(Math.abs(e))?1/0:1/Math.sin(e)},t.cot=function(e){var t=Math.abs(e);return T(t)?1/0:w(t)?0:1/Math.tan(e)},t.acot=function(e){return Math.PI/2-Math.atan(e)},t.acsc=function(e){return Math.asin(1/e)},t.asec=function(e){return Math.acos(1/e)},t.sech=function(e){return 1/a.cosh(e)},t.csch=function(e){return 1/a.sinh(e)},t.coth=function(e){return 1/a.tanh(e)},t.asech=function(e){return a.acosh(1/e)},t.acsch=function(e){return a.asinh(1/e)},t.acoth=function(e){return a.atanh(1/e)},t.mean=C,t.total=function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t};var P=[0,.08106146679532726,.0413406959554093,.02767792568499834,.020790672103765093,.016644691189821193,.013876128823070748,.01189670994589177,.010411265261972096,.009255462182712733,.00833056343336287,.007573675487951841,.00694284010720953,.006408994188004207,.0059513701127588475,.005554733551962801];function O(e){return e>15?L(e):e<0?NaN:e===Math.floor(e)?P[e]:Math.log(y(e)/(Math.pow(e,e)*Math.exp(-e)*Math.sqrt(2*Math.PI*e)))}function L(e){var t=e*e;return(.08333333333333333-(.002777777777777778-(.0007936507936507937-(.0005952380952380953-.0008417508417508417/t)/t)/t)/t)/e}function N(e,t){return t<=0?NaN:M(t)*Math.pow(1+e*e/t,-(t+1)/2)}function A(e,t){if(t>0)return 1-A(e,-t);if(t===-1/0)return 0;if(0===t)return.5;if(e>=40&&t>-1)return.5+M(e)*function(e,t){for(var r=t*t/e,n=t,i=n,a=1;a<=15;a++)i+=n*=-(2*a-1)/(2*a+1)*(.5*(e+1)+a-1)/a*r;return i}(e,t);if(t/e<-1e3){var r=t*t;return M(e)*Math.pow(e,.5*(e-1))*Math.pow(Math.abs(t),-e)*(1-e*e*(e+1)*(1/(2+e)+e*(e+3)/(4*(4+e)*r))/(2*r))}var n=Math.sqrt(t*t+e);return function(e,t,r){if(e<0||e>1)throw new RangeError("First argument must be between 0 and 1.");if(1===t&&1===r)return e;if(0===e)return 0;if(1===e)return 1;if(0===t)return 1;if(0===r)return 0;var n=O(t+r)-O(t)-O(r)-k(t,(t+r)*e)-k(r,(t+r)*(1-e),(t+r)*e-t),i=Math.exp(n)*Math.sqrt(t*r/(2*Math.PI*(t+r)));return e<(t+1)/(t+r+2)?i*R(e,t,r)/t:1-i*R(1-e,r,t)/r}((t+n)/(2*n),e/2,e/2)}function D(e,t,r){return r<=0?NaN:e===-1/0?A(r,t):e>0&&t>0?A(r,-e)-A(r,-t):A(r,t)-A(r,e)}function R(e,t,r){var n=Math.pow(2,-52),i=1e-300,a=t+r,o=t+1,s=t-1,u=1,c=1-a*e/o;Math.abs(c)<i&&(c=i);for(var l=c=1/c,p=1;p<=100;p++){var d=2*p,f=p*(r-p)*e/((s+d)*(t+d));c=1+f*c,Math.abs(c)<i&&(c=i),u=1+f/u,Math.abs(u)<i&&(u=i),l*=(c=1/c)*u,c=1+(f=-(t+p)*(a+p)*e/((t+d)*(o+d)))*c,Math.abs(c)<i&&(c=i),u=1+f/u,Math.abs(u)<i&&(u=i);var h=(c=1/c)*u;if(l*=h,Math.abs(h-1)<=n)return l}return l}function F(e,t,r){return(e-t)/(Math.SQRT2*Math.abs(r))}function q(e){return e<0?.5*Math.exp(-e*e)*J(-e):1-.5*Math.exp(-e*e)*J(e)}function B(e){var r=t.md5Spyable(e);return(4294967296*(2097151&parseInt(r.slice(0,8),16))+parseInt(r.slice(8,16),16))/9007199254740992}function V(e,t){for(var r=t.length-1;r>0;r--){var n=e+"::sc"+r,i=Math.floor(B(n)*(r+1)),a=t[r];t[r]=t[i],t[i]=a}}function z(e,t,r){return B(e)*(r-t)+t}function j(e,t,r){return e>=t?1:e<0?0:e<Math.floor((t+1)*r)?U(e,t,r):1-U(t-e-1,t,1-r)}function U(e,t,r){for(var n=(1-r)/r,i=G(e,t,r),a=i;e>0&&a+(i*=e/(t-e+1)*n)!==a;e--)a+=i;return a}function G(e,t,r){if(e=Math.round(e),(t=f(Math.round(t),0,1/0))===1/0)return NaN;if(r=f(r,0,1),e<0||e>t)return 0;if(0===r)return 0===e?1:0;if(1===r)return e===t?1:0;if(0===e)return Math.exp(t*a.log1p(-r));if(e===t)return Math.pow(r,t);var n=O(t)-O(e)-O(t-e)-k(e,t*r)-k(t-e,t*(1-r),t*r-e);return Math.exp(n)*Math.sqrt(t/(2*Math.PI*e*(t-e)))}function W(e,t){return t<0?NaN:(e=Math.round(e))<0?0:0===t?0===e?1:0:0===e?Math.exp(-t):Math.exp(-O(e)-k(e,t))/Math.sqrt(2*Math.PI*e)}function K(e,t){if(isNaN(e)||isNaN(t))return NaN;if(e===1/0)return 1;if((e=Math.floor(e))<0)return 0;if(0===t)return 1;if(e+1>12&&2.35*(e+1)>t&&.3*(e+1)<t)return function(e,t){for(var r=t/e,n=a.sign(t-e)*Math.sqrt(2*k(1,r)),i=[1,-.3333333333333333,.08333333333333333,-.014814814814814815,.0011574074074074073,.0003527336860670194,-.0001787551440329218,3919263178522438e-20,-2185448510679992e-21,-185406221071516e-20,8.296711340953087e-7,-1.7665952736826078e-7,6.707853543401498e-9,1.0261809784240309e-8,-4.382036018453353e-9,9.14769958223679e-10,-2.5514193994946248e-11,-5.830772132550426e-11,2.4361948020667415e-11,-5.0276692801141755e-12,1.1004392031956135e-13,3.371763262400985e-13,-1.392388722418162e-13,2.8534893807047445e-14,-5.139111834242572e-16,-1.9752288294349442e-15,8.099521156704561e-16],o=i.length-2,s=0,u=0,c=0,l=0;o>=0;o--)l=n*l+(c=(o+2)*s/e+i[o+1]),s=u,u=c;if(l*=e/(e+s),t<e){var p=Math.exp(-.5*e*n*n)*(.5*J(-n*Math.sqrt(e/2))-l/Math.sqrt(2*Math.PI*e));return isFinite(p)?1-p:1}var d=Math.exp(-.5*e*n*n)*(.5*J(n*Math.sqrt(e/2))+l/Math.sqrt(2*Math.PI*e));return isFinite(d)?d:0}(e+1,t);if(e+1>=t){var r=function(e,t){var r=Math.pow(2,-52),n=1e-300,i=1/e,a=1/n,o=1/e,s=2,u=0,c=e,l=-(e-1),p=0;do{0===(o=o*(l-=1)*t+(c+=1))&&(o=n),0===(a=c+l*t/a)&&(a=n),i*=u=a*(o=1/o),0===(o=o*(p+=1)*t+(c+=1))&&(o=n),0===(a=c+p*t/a)&&(a=n),i*=u=a*(o=1/o),s+=2}while(s<100&&Math.abs(u-1)>r);return i}(e+1,t);return isFinite(r)?1-t*W(e,t)*r:1}r=function(e,t){var r=Math.pow(2,-52),n=1e-300,i=t+1-e,a=1/i,o=1/n,s=1/i,u=2,c=0,l=i;do{var p=-(u-1)*(u-e-1);0===(s=s*p+(l+=2))&&(s=n),0===(o=l+p/o)&&(o=n),a*=c=o*(s=1/s),u+=1}while(u<100&&Math.abs(c-1)>r);return a}(e+1,t);return isFinite(r)?t*W(e,t)*r:0}function H(e,t,r){return r<=t?NaN:e<t?0:e>r?1:(e-t)/(r-t)}function J(e){if(e<0)return e<-6.1?2*Math.exp(e*e):2*Math.exp(e*e)-J(-e);if(e>50){var t=.5641895835477563,r=e*e;return e>5e7?t/e:t*(r*(r+4.5)+2)/(e*(r*(r+5)+3.75))}return(.9999999999999999+e*(2.224574423459406+e*(2.444115549920689+e*(1.7057986861852539+e*(.8257463703357973+e*(.28647031042892007+e*(.07124513844341643+e*(.012296749268608364+e*(.001347817214557592+7263959403471071e-20*e)))))))))/(1+e*(3.352953590554884+e*(5.227518529742423+e*(5.003720878235473+e*(3.266590890998987+e*(1.5255421920765353+e*(.5185887413188858+e*(.12747319185915415+e*(.02185979575963238+e*(.0023889438122503674+.00012875032817508128*e))))))))))}function Y(e){var t,r,n;return e>.5?-Y(1-e):.5===e?0:e<0?NaN:0===e?-1/0:(n=e<.02425?(((((-.00778489400243029*(t=Math.sqrt(-2*Math.log(e)))-.322396458041136)*t-2.40075827716184)*t-2.54973253934373)*t+4.37466414146497)*t+2.93816398269878)/((((.00778469570904146*t+.32246712907004)*t+2.445134137143)*t+3.75440866190742)*t+1):(((((-39.6968302866538*(r=(t=e-.5)*t)+220.946098424521)*r-275.928510446969)*r+138.357751867269)*r-30.6647980661472)*r+2.50662827745924)*t/(((((-54.4760987982241*r+161.585836858041)*r-155.698979859887)*r+66.8013118877197)*r-13.2806815528857)*r+1))-Math.sqrt(2*Math.PI)*(.5*J(-n/Math.SQRT2)-Math.exp(.5*n*n)*e)}function $(e,t){if(t<=0||e<0||e>1)return NaN;if(0===e)return 0;if(1===e)return 1/0;for(var r=1,n=1,i=1;Math.exp(-t)*n<e;){if(n+(r*=t/i)===n)return 1/0;n+=r,i+=1}return i-1}function X(e,t,r){if(t!==Math.round(t))return NaN;if(r<0||r>1)return NaN;if(e<0||e>1)return NaN;if(0===e)return 0;if(1===e)return t;if(0===t)return 0;if(1===r)return t;if(0===r)return 0;for(var n=r/(1-r),i=Math.pow(1-r,t),a=i,o=1;a<e;){if(a+(i*=(t-o+1)/o*n)===a)return t;if(o>t)return t;a+=i,o+=1}return o-1}function Z(e,t){var r=4*t*(1-t);switch(e){case 1:return Math.tan(Math.PI*(t-.5));case 2:return 2*(t-.5)*Math.sqrt(2/r);case 4:var n=Math.cos(Math.acos(Math.sqrt(r))/3)/Math.sqrt(r);return 2*a.sign(t-.5)*Math.sqrt(n-1);default:throw new Error("_invTSimple() must be called with 1, 2, or 4 df.")}}function Q(e,t){var r=he(e);return(C(e)-t)*Math.sqrt(e.length)/r}function ee(e,t){var r=e.length,n=C(e),i=he(e),a=t.length,o=C(t),s=he(t);return(n-o)/(Math.sqrt(((r-1)*i*i+(a-1)*s*s)/(r+a-2))*Math.sqrt(1/r+1/a))}function te(e,t,r){return r<0?D(-1/0,e,t):r>0?D(-1/0,-e,t):2*D(-1/0,-Math.abs(e),t)}function re(e){if(e.length<1)return NaN;var t=e[0];if(isNaN(t))return NaN;for(var r=1;r<e.length;r++){if(isNaN(e[r]))return NaN;e[r]<t&&(t=e[r])}return t}function ne(e){if(e.length<1)return NaN;var t=e[0];if(isNaN(t))return NaN;for(var r=1;r<e.length;r++){if(isNaN(e[r]))return NaN;e[r]>=t&&(t=e[r])}return t}function ie(e,t){if(!isFinite(t)||t<0||t>1)return NaN;if(e.some(isNaN))return NaN;if(0===e.length)return NaN;var r=e.length,n=oe(e),i=t*(r-1);return Math.floor(i)===i?e[n[i]]:(Math.ceil(i)-i)*e[n[Math.floor(i)]]+(i-Math.floor(i))*e[n[Math.ceil(i)]]}function ae(e,t){if(!isFinite(t)||t<0||t>4)return NaN;if(e.some(isNaN))return NaN;var r=oe(e),n=se(e,t),i=Math.floor(n),a=Math.ceil(n);return(e[r[i]]+e[r[a]])/2}function oe(e){for(var t=e.length,r=[],n=0;n<t;n++)r.push(n);return r.sort(function(t,r){return p.asFloat(p.sub(e[t],e[r]))}),r}function se(e,t){t=Math.round(t);var r,n=e.length,i=n%2==1;return 1===n?0:(0===t&&(r=0),2===t&&(r=(n-1)/2),4===t&&(r=n-1),1===t&&(r=i?(n+1)/4-1:(n+2)/4-1),3===t&&(r=i?(3*n+3)/4-1:(3*n+2)/4-1),void 0===r?NaN:r)}function ue(e){return ie(e,.5)}function ce(e){for(var t=C(e),r=0,n=0;n<e.length;n++){var i=e[n]-t;r+=i*i}return r/e.length}function le(e){var t=e.length;return ce(e)*t/(t-1)}function pe(e,t){var r=Math.min(e.length,t.length);e.length!==r&&(e=e.slice(0,r)),t.length!==r&&(t=t.slice(0,r));for(var n=C(e),i=C(t),a=0,o=0;o<r;o++)a+=(e[o]-n)*(t[o]-i);return a/r}function de(e,t){var r=Math.min(e.length,t.length);e.length!==r&&(e=e.slice(0,r)),t.length!==r&&(t=t.slice(0,r));for(var n=C(e),i=C(t),a=0,o=0,s=0,u=0;u<r;u++){var c=e[u]-n,l=t[u]-i;a+=c*c,o+=l*l,s+=c*l}return s/Math.sqrt(a*o)}function fe(e){var t=e.length;if(0===t)return[];for(var r=[],n=[],i=0;i<t;i++)n.push([e[i],i]);n.sort(function(e,t){var r=e[0],n=t[0];return r===1/0&&n===1/0||r===-1/0&&n===-1/0?0:r-n});for(var a=0,o=1,s=1;a<t;){for(var u=a;u<t-1&&n[u][0]===n[u+1][0];)u+=1;s=u-a+1;var c=void 0;for(u=0;u<s;u++)r[c=n[a+u][1]]=isNaN(e[c])?NaN:o+.5*(s-1);o+=s,a+=s}return r}function he(e){return Math.sqrt(le(e))}function ye(e,t,r){return[f(Math.round(e),0,255),f(Math.round(t),0,255),f(Math.round(r),0,255)]}function me(e){if(Array.isArray(e))return"["+e.map(me).join(",")+"]";switch(typeof e){case"string":return e;case"boolean":case"number":return e.toString();case"object":if("object"==typeof(n=e)&&n&&"Action"===n.type){var t=[];for(var r in e.updateRules)t.push('"'+r+'": '+me(e.updateRules[r].value));return"{"+t.join(",")+"}"}return e.n+"/"+e.d;default:return e}var n}t.tpdf=N,t.tcdf=D,t.normalcdf=function(e,t,r,n){var i=F(t,r,n);if(e===-1/0)return q(i);var a=F(e,r,n);return e>0&&t>0?q(-a)-q(-i):q(i)-q(a)},t.normalpdf=function(e,t,r){return 1/Math.sqrt(2*Math.PI*r*r)*Math.exp(-(e-t)*(e-t)/(2*r*r))},t.random=B,t.shuffle=function(e,t){var r=t.slice();return V(e,r),r},t.randomPerm=function(e,t){for(var r=[],n=0;n<t;n++)r.push(n);return V(e,r),r},t.uniformSample=z,t.normalSample=function(e,t,r){var n,i,a,o,s=0;do{n=e+"::sc"+s,s+=1,i=2*z(n,0,1)-1,n=e+"::sc"+s,s+=1,o=i*i+(a=2*z(n,0,1)-1)*a}while(o>=1||0===o);return t+r*i*Math.sqrt(-2*Math.log(o)/o)},t.tSample=function(e,t){if(t<=0)return NaN;var r,n,i,a,o=0;do{r=e+"::sc"+o,o+=1,n=2*z(r,0,1)-1,r=e+"::sc"+o,o+=1,a=n*n+(i=2*z(r,0,1)-1)*i}while(a>1);var s=n*n/a,u=t*(Math.pow(a,-2/t)-1);return r=e+"::sc"+o,o+=1,(z(r,0,1)<.5?-1:1)*Math.sqrt(s*u)},t.binomSample=function(e,t,r){return(t=f(Math.round(t),0,1/0))===1/0?NaN:(r=f(r,0,1),X(z(e,0,1),t,r))},t.poissonSample=function(e,t){return t<=0?NaN:$(z(e,0,1),t)},t.binomcdf=function(e,t,r,n){return(r=f(Math.round(r),0,1/0))===1/0?NaN:(n=f(n,0,1),t<0?0:(e=Math.ceil(e),t=Math.floor(t),e===-1/0?j(t,r,n):j(t,r,n)-j(e-1,r,n)))},t.binompdf=G,t.poissonpdf=W,t.poissoncdf=function(e,t,r){return r<=0?NaN:(e=Math.ceil(e),(t=Math.floor(t))<0?0:e===-1/0?K(t,r):K(t,r)-K(e-1,r))},t.uniformpdf=function(e,t,r){return r<=t?NaN:e<t||e>r?0:1/(r-t)},t.uniformcdf=function(e,t,r,n){return H(t,r,n)-H(e,r,n)},t.erf=function(e){var t=-e*e;return t<-750?e>=0?1:-1:e>=.065?1-Math.exp(t)*J(e):e<=-.065?Math.exp(t)*J(-e)-1:e*(1.1283791670955126+t*(.37612638903183754+t*(.11283791670955126+t*(.026866170645131252+.005223977625442188*t))))},t.erfcx=J,t.invNorm=Y,t.invPoisson=$,t.invBinom=X,t.invT=function e(t,r){return isNaN(r)||r<=0||t<0||t>1?NaN:0===t?-1/0:1===t?1/0:1===r||2===r||4===r?Z(r,t):.5===t?0:t>.5?function(e,t,r,n){if(!isFinite(r)||!isFinite(n))return NaN;var i=r,a=n;for(;;){var o=l.floatMiddle(i,a),s=A(e,o);if(o===i||o===a)return s>t?i:a;s<t?i=o:a=o}}(r,t,r>1?Y(t):Z(1,t),r>1?Z(1,t):Math.pow(N(0,r)*Math.pow(r,(r-1)/2)/(1-t),1/r)):-e(1-t,r)},t.invUniform=function(e,t,r){return e<0||e>1||r<=t?NaN:0===e?t:1===e?r:t+e*(r-t)},t.tscore=Q,t.itscore=ee,t.ttest=function(e,t){1===arguments.length&&(t=0);var r=Q(e,t),n=e.length-1;return{lessThan:te(r,n,-1),greaterThan:te(r,n,1),notEqual:te(r,n,0)}},t.ittest=function(e,t){var r=ee(e,t),n=e.length+t.length-2;return{lessThan:te(r,n,-1),greaterThan:te(r,n,1),notEqual:te(r,n,0)}},t.stats=function(e){return{min:re(e),q1:ae(e,1),median:ue(e),q3:ae(e,3),max:ne(e)}},t.length=function(e){return e.length},t.listMin=re,t.listMax=ne,t.quantile=ie,t.quartile=ae,t.sortPerm=oe,t.quartileIndex=se,t.upperQuantileIndex=function(e,t){return oe(e)[Math.ceil(t*(e.length-1))]+1},t.lowerQuantileIndex=function(e,t){return oe(e)[Math.floor(t*(e.length-1))]+1},t.upperQuartileIndex=function(e,t){return oe(e)[Math.ceil(se(e,t))]+1},t.lowerQuartileIndex=function(e,t){return oe(e)[Math.floor(se(e,t))]+1},t.median=ue,t.argMin=function(e){if(e.length<1)return 0;var t=e[0];if(isNaN(t))return 0;for(var r=0,n=1;n<e.length;n++){if(isNaN(e[n]))return 0;e[n]<t&&(r=n,t=e[n])}return r+1},t.argMax=function(e){if(e.length<1)return 0;var t=e[0];if(isNaN(t))return 0;for(var r=0,n=1;n<e.length;n++)if(e[n]>=t){if(isNaN(e[n]))return 0;r=n,t=e[n]}return r+1},t.varp=ce,t.mad=function(e){for(var t=C(e),r=0,n=0;n<e.length;n++)r+=Math.abs(e[n]-t);return r/e.length},t.variance=le,t.covp=pe,t.cov=function(e,t){var r=Math.min(e.length,t.length);return pe(e,t)*r/(r-1)},t.corr=de,t.validateRangeLength=function(e,t,r,n){for(var i=e[0],a=2;a<e.length;a++){var o=p.asFloat(p.div(p.sub(e[a],i),r));if(!s.approx(o,a,10))return 0}var u=p.asFloat(n);for(a=0;a<t.length-1;a++){o=p.asFloat(p.div(p.sub(t[a],i),r));if(!s.approx(o,u-t.length+a,10))return 0}return!isFinite(u)||u<e.length||u<t.length?0:u},t.validateSampleCount=function(e){return e<0||!isFinite(e)?0:e},t.rank=fe,t.spearman=function(e,t){var r=Math.min(e.length,t.length);return e.length!==r&&(e=e.slice(0,r)),t.length!==r&&(t=t.slice(0,r)),de(fe(e),fe(t))},t.stdev=he,t.stdevp=function(e){return Math.sqrt(ce(e))},t.quad=i.quad,t.distance=function(e,t){return s.hypot(t[0]-e[0],t[1]-e[1])},t.rgb=ye,t.hsv=function(e,t,r){e=f(e,0,360),t=f(t,0,1);var i=(r=f(r,0,1))*(1-t/2);t=0===i||1===i?0:(r-i)/Math.min(i,1-i);var a=n.hsl(e,t,i).rgb();return ye(a.r,a.g,a.b)},t.polygon=function(e){return e},t.select=function(e,t){for(var r=[],n=0;n<e.length;n++)t[n]&&r.push(e[n]);return r},t.elementsAt=function(e,t){for(var r=[],n=0,i=t;n<i.length;n++){var a=i[n];r.push(e[a])}return r},t.uniquePerm=function(e){for(var t=[],r={},n=0;n<e.length;n++){var i=me(e[n]);r.hasOwnProperty(i)||(r[i]=!0,t.push(n))}return t}});r("core/math/functions",["require","exports","core/math/builtin"],function(e,t,r){"use strict";function n(e){delete e.fn}function i(e){e.fn=a(e.args,e.source,e.constants)}function a(e,t,n){var i=e.join(",");return new Function("BuiltIn","_C","return (function("+i+'){"use strict"; '+t+"})")(r,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.closureFunctionWithBuiltIn=t.rehydrateCompiledFunction=t.dehydrateCompiledFunction=t.rehydrateGraphData=t.dehydrateGraphData=void 0,t.dehydrateGraphData=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t].compiled;i&&n(i)}},t.rehydrateGraphData=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t].compiled;n&&i(n)}},t.dehydrateCompiledFunction=n,t.rehydrateCompiledFunction=i,t.closureFunctionWithBuiltIn=a});r("core/math/ir/instructions",["require","exports","./opcodes"],function(e,t,r){"use strict";function n(e){return e.type<=r.MAX_LEAF_OPCODE}Object.defineProperty(t,"__esModule",{value:!0}),t.endsBlock=t.beginsBlock=t.isInternalInstruction=t.isLeafInstruction=void 0,t.isLeafInstruction=n,t.isInternalInstruction=function(e){return!n(e)},t.beginsBlock=function(e){switch(e.type){case r.BeginIntegral:case r.BeginBroadcast:case r.BeginLoop:return!0;default:return!1}},t.endsBlock=function(e){switch(e.type){case r.EndLoop:case r.EndIntegral:case r.EndBroadcast:return!0;default:return!1}}});r("core/math/ir/features/print",["require","exports","../instructions","../opcodes","core/math/types","../../context-types"],function(e,t,r,n,i,a){"use strict";function o(e,t){var r=e.getInstruction(t);switch(r.type===n.Noop&&r.removedInstructionForDebuggingOnly&&(r=r.removedInstructionForDebuggingOnly),r.type){case n.Noop:return s(r.type);case n.LoadArg:return s(r.type)+" "+i.repr(r.valueType)+" "+e.argNames[t];case n.SymbolicVar:return s(r.type)+" "+i.repr(r.valueType);case n.Constant:return s(r.type)+" "+i.repr(r.valueType)+" "+u(r.value);case n.NativeFunction:case n.Distribution:return s(r.type)+" "+i.repr(r.valueType)+" "+r.symbol+" "+r.args.join(" ");case n.ExtendSeed:return s(r.type)+" "+i.repr(r.valueType)+" "+r.tag+" "+r.args.join(" ");case n.BroadcastResult:return s(r.type)+" "+i.repr(r.valueType)+" "+r.args.join(" ")+(r.isConstantBroadcast?" (constant)":"");case n.Add:case n.Subtract:case n.Multiply:case n.Divide:case n.RawExponent:case n.Exponent:case n.Negative:case n.OrderedPair:case n.OrderedPairAccess:case n.BeginLoop:case n.EndLoop:case n.BeginIntegral:case n.EndIntegral:case n.BeginBroadcast:case n.EndBroadcast:case n.Equal:case n.Less:case n.Greater:case n.LessEqual:case n.GreaterEqual:case n.And:case n.Piecewise:case n.List:case n.ListAccess:case n.DeferredListAccess:case n.InboundsListAccess:case n.BlockVar:case n.Action:return s(r.type)+" "+i.repr(r.valueType)+" "+r.args.join(" ");default:throw new Error("Unexpected opcode "+r.type)}}function s(e){switch(e){case n.Noop:return"Noop";case n.Constant:return"Constant";case n.Add:return"Add";case n.Subtract:return"Subtract";case n.Multiply:return"Multiply";case n.Divide:return"Divide";case n.Exponent:return"Exponent";case n.RawExponent:return"RawExponent";case n.Negative:return"Negative";case n.OrderedPair:return"OrderedPair";case n.OrderedPairAccess:return"OrderedPairAccess";case n.BeginLoop:return"BeginLoop";case n.EndLoop:return"EndLoop";case n.BeginIntegral:return"BeginIntegral";case n.EndIntegral:return"EndIntegral";case n.BeginBroadcast:return"BeginBroadcast";case n.EndBroadcast:return"EndBroadcast";case n.Equal:return"Equal";case n.Less:return"Less";case n.Greater:return"Greater";case n.LessEqual:return"LessEqual";case n.GreaterEqual:return"GreaterEqual";case n.And:return"And";case n.Piecewise:return"Piecewise";case n.List:return"List";case n.ListAccess:return"ListAccess";case n.DeferredListAccess:return"DeferredListAccess";case n.InboundsListAccess:return"InboundsListAccess";case n.NativeFunction:return"NativeFunction";case n.Distribution:return"Distribution";case n.LoadArg:return"LoadArg";case n.BlockVar:return"BlockVar";case n.BroadcastResult:return"BroadcastResult";case n.SymbolicVar:return"SymbolicVar";case n.ExtendSeed:return"ExtendSeed";case n.Action:return"Action";default:throw new Error("Unexpected opcode "+e.type)}}function u(e){if(Array.isArray(e))return"["+e.map(u).join(",")+"]";switch(typeof e){case"string":return e;case"boolean":case"number":return e.toString();case"object":if(a.isActionCompilerValue(e)){var t=[];for(var r in e.updateRules)t.push('"'+r+'": '+u(e.updateRules[r].value));return"{"+t.join(", ")+"}"}return e.n+"/"+e.d;default:throw new Error("Unexpected value: "+e)}}function c(e,t){var r=e.toString();return l(t-r.length)+r}function l(e){for(var t="",r=0;r<e;r++)t+=" ";return t}Object.defineProperty(t,"__esModule",{value:!0}),t.printValue=t.printOp=t.printInstruction=t.print=void 0,t.print=function(e){for(var t="",i=(e.instructionsLength()-1).toString().length,a=0,s=!1,u=0;u<e.instructionsLength();u++){var p=e.getInstruction(u),d=e.comments[u]||"",f=p.type===n.Noop&&p.removedInstructionForDebuggingOnly;if((r.endsBlock(p)||f&&r.endsBlock(f))&&(a-=1),p.type!==n.Noop||f){s=!1;var h=f?" [X]":"    ";t+=c(u,i)+":"+h+" "+l(2*a)+o(e,u)+(d?"\t\t# "+d:"")+"\n"}else s||(t+=c(u,i)+": "+l(2*a)+"...\n"),s=!0;(r.beginsBlock(p)||f&&r.beginsBlock(f))&&(a+=1)}return t},t.printInstruction=o,t.printOp=s,t.printValue=u});r("core/math/ir/features/is-constant",["require","exports","../opcodes","./print"],function(e,t,r,n){"use strict";function i(e){return e.type===r.Constant}function a(e){return e.type===r.BroadcastResult&&e.isConstantBroadcast}Object.defineProperty(t,"__esModule",{value:!0}),t.isConstantOrConstantBroadcast=t.isConstantBroadcast=t.assertConstant=t.isConstant=void 0,t.isConstant=i,t.assertConstant=function(e){if(!i(e))throw new Error("Programming error: expected constant instruction but found "+n.printOp(e.type)+" instead.")},t.isConstantBroadcast=a,t.isConstantOrConstantBroadcast=function(e){return i(e)||a(e)}});r("core/math/ir/features/depends-on-outer-variable",["require","exports","../instructions","./is-constant"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dependsOnOuterVariable=void 0,t.dependsOnOuterVariable=function(e,t,i){var a=e.getInstruction(i);if(!r.isLeafInstruction(a))for(var o=0,s=a.args;o<s.length;o++){var u=s[o];if(!n.isConstantOrConstantBroadcast(e.getInstruction(u)))return!0}if(t<i)return!n.isConstantOrConstantBroadcast(e.getInstruction(t));for(var c=[!0],l=i+1;l<=t;l++)c.push(!1);for(var p=[t];p.length;){if(!c[(l=p.pop())-i]){c[l-i]=!0;var d=e.getInstruction(l);if(!r.isLeafInstruction(d))for(var f=0,h=d.args;f<h.length;f++){if((u=h[f])<i){if(!n.isConstantOrConstantBroadcast(e.getInstruction(u)))return!0}else c[u-i]||p.push(u)}}}return!1}});r("core/math/ir/features/reconstitute-ir",["require","exports","core/math/types"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reconstituteIR=void 0,t.reconstituteIR=function e(t,n,i){if(r.isList(n)){for(var a=[],o=0;o<i.length;o++)a.push(e(t,r.elementType(n),i[o]));return t.ConstantOfType(n,a)}switch(n){case r.Number:return t.Constant(i);case r.Bool:case r.Point:case r.RGBColor:return t.ConstantOfType(n,i);default:throw new Error("Cannot reconstitute value of a "+r.prettyPrint(n)+".")}}});r("core/math/ir/features/list-length",["require","exports","../opcodes","core/math/types","./print"],function(e,t,r,n,i){"use strict";function a(e,t){var r=o(e,t);if(!(r<0))return r}function o(e,t,a){var s,u=a&&a[t];if(u)return u;var c,l=e.getInstruction(t);switch(l.type){case r.List:c=l.args.length;break;case r.Constant:c=l.value.length;break;case r.BroadcastResult:c=null!==(s=l.constantLength)&&void 0!==s?s:-1}return void 0===c&&(c=function(e,t,a){switch(t.type){case r.Piecewise:var s=o(e,t.args[1],a);return s===o(e,t.args[2],a)?s:-1;case r.NativeFunction:switch(t.symbol){case"elementsAt":return o(e,t.args[1],a);case"sortPerm":return o(e,t.args[0],a);case"shuffle":return o(e,t.args[1],a);default:return-1}default:if(n.isList(t.valueType))return-1;throw new Error("Programming Error: cannot find the list length of "+i.printOp(t.type)+" "+n.prettyPrint(t.valueType)+".")}}(e,l,a=a||{})),a&&(a[t]=c),c}function s(e,t){var i=e.getInstruction(t);if(!n.isList(i.valueType))throw new Error("Programming Error: cannot find the list length of "+e.printInstruction(t));switch(i.type){case r.List:return e.Constant(i.args.length);case r.Constant:return e.Constant(i.value.length);case r.BroadcastResult:var a=e.getInstruction(i.args[0]);return e.getInstruction(a.args[0]).args[0];case r.NativeFunction:switch(i.symbol){case"elementsAt":return s(e,i.args[1]);case"sortPerm":return s(e,i.args[0]);case"shuffle":return s(e,i.args[1])}}return e.SyntheticNativeFunction("length",[t])}Object.defineProperty(t,"__esModule",{value:!0}),t.minListLengthIndex=t.listLengthIndex=t.getConstantListLength=t.assertConstantListLength=void 0,t.assertConstantListLength=function(e,t,r){var n=a(e,t);if(void 0===n)throw new Error(r+'\nNon-constant instruction: "'+i.printInstruction(e,s(e,t))+'"');return n},t.getConstantListLength=a,t.listLengthIndex=s,t.minListLengthIndex=function(e,t){for(var r=[],i=0,o=t;i<o.length;i++){var u=o[i];n.isList(e.getInstruction(u).valueType)&&r.push(u)}if(0!==r.length){if(1===r.length)return s(e,r[0]);for(var c,l=[],p=0,d=r;p<d.length;p++){var f=d[p];l.push(a(e,f))}for(var h=1/0,y=0;y<l.length;y++){var m=r[y],v=l[y];if(void 0===v)return e.SyntheticNativeFunction("min",[e.List(r.map(function(t){return s(e,t)}))]);v<h&&(c=m,h=v)}return void 0!==c?s(e,c):e.Constant(h)}}});r("core/math/ir/features/contains-nan-value",["require","exports","core/math/types","core/math/maybe-rational"],function(e,t,r,n){"use strict";function i(e,t){switch(e){case r.Number:return n.isNanFloat(t);case r.Point:var i=t,a=i[0],o=i[1];return n.isNanFloat(a)||n.isNanFloat(o);case r.RGBColor:var s=t,u=s[0],c=s[1],l=s[2];return n.isNanFloat(u)||n.isNanFloat(c)||n.isNanFloat(l);case r.Action:return 0===Object.keys(t.updateRules).length;case r.Bool:return!1;default:throw new Error("Type cannot contain a NaN value: "+r.prettyPrint(e)+".")}}Object.defineProperty(t,"__esModule",{value:!0}),t.containsNanValue=void 0,t.containsNanValue=function(e,t){if(r.isList(e)){for(var n=r.elementType(e),a=0;a<t.length;a++)if(i(n,t[a]))return!0;return!1}return i(e,t)}});r("core/math/ir/features/interpret",["require","exports","tslib","core/math/maybe-rational","../opcodes","core/math/types","../instructions","../builtin-table","./as-value","./nan-of-type","../../builtin","../../errormsg"],function(e,t,r,n,i,a,o,s,u,c,l,p){"use strict";function d(e,t){return n.add(e,t)}function f(e,t){return n.sub(e,t)}function h(e,t){return n.mul(e,t)}function y(e,t){return n.div(e,t)}function m(e,t){return n.pow(e,t)}function v(e,t){return m(e,t)}function g(e){return n.neg(e)}function b(e,t){return[e,t]}function x(e,t){return e[n.asFloat(t)-1]}function S(e,t){return n.asFloat(e)===n.asFloat(t)}function T(e,t){return n.asFloat(e)<n.asFloat(t)}function w(e,t){return n.asFloat(e)>n.asFloat(t)}function _(e,t){return n.asFloat(e)<=n.asFloat(t)}function I(e,t){return n.asFloat(e)>=n.asFloat(t)}function E(e){return e}function C(e,t,r){var i=Math.floor(n.asFloat(r))-1;return!isFinite(i)||i<0||i>=t.length?c.nanOfType(e):t[i]}function M(e,t){return e[Math.floor(n.asFloat(t))-1]}function k(e,t,r){return n.isRational(r)&&(r=n.asFloat(r)),t+"::"+e+r}function P(e,t){switch(e){case"mod":return n.mod(t[0],t[1]);case"abs":return n.abs(t[0]);case"sqrt":return n.sqrt(t[0]);case"nthroot":return n.nthroot(t[0],t[1]);case"total":return n.total(t[0]);case"length":return t[0].length;case"validateRangeLength":var r=t[0],i=t[1],a=t[2],o=t[3];if(0===(c=l.validateRangeLength(r,i,a,o)))throw p.nonArithmeticRange();return c;case"validateSampleCount":var c;o=u.compilerValueToRuntimeValue(t[0]);if(0===(c=l.validateSampleCount(o))&&0!==o)throw p.badSampleSize();return c;case"select":case"elementsAt":case"uniquePerm":case"sortPerm":var d=s.BuiltInTable[e];return l[d.symbol].apply(null,t);default:return("Math"===(d=s.BuiltInTable[e]).module?Math:l)[d.symbol].apply(null,u.compilerValueToRuntimeValue(t))}}function O(e,t,r){if(t.constantLength)return t.constantLength;var i=t.args[0],a=e.getInstruction(i).args[0],o=e.getInstruction(a);return n.asFloat(A(e,o.args[0],r))}function L(e,t,r,n){var i=e.getInstruction(t),o=O(e,i,n);if(!isFinite(r)||r<0||r>=o)return c.nanOfType(a.elementType(i.valueType));var s=i.args[0],u=t-s,l=e.getInstruction(s),p=l.args[0],d=l.args[u];n[p]=r+1;for(var f=A(e,d,n),h=p;h<=s;h++)n[h]=void 0;return f}function N(e,t,a){var o=A(e,t.args[1],a),s=t.args[0],u=e.getInstruction(s);if(u.type===i.BroadcastResult)return L(e,s,n.asFloat(o)-1,a);if(u.type===i.Piecewise){var c=A(e,u.args[0],a);return N(e,r.__assign(r.__assign({},t),{args:[c?u.args[1]:u.args[2],t.args[1]]}),a)}var l=A(e,t.args[0],a);return C(t.valueType,l,o)}function A(e,t,r){var i=r[t];if(void 0!==i)return i;var a=D(e,t,r);return"number"==typeof a&&a===Math.floor(a)&&(a=n.maybeRational(a,1)),r[t]=a,a}function D(e,t,r){var n=e.getInstruction(t);switch(n.type){case i.Constant:return n.value;case i.Add:return d(A(e,n.args[0],r),A(e,n.args[1],r));case i.Subtract:return f(A(e,n.args[0],r),A(e,n.args[1],r));case i.Multiply:return h(A(e,n.args[0],r),A(e,n.args[1],r));case i.Divide:return y(A(e,n.args[0],r),A(e,n.args[1],r));case i.Exponent:return m(A(e,n.args[0],r),A(e,n.args[1],r));case i.RawExponent:return v(A(e,n.args[0],r),A(e,n.args[1],r));case i.Negative:return g(A(e,n.args[0],r));case i.OrderedPair:return b(A(e,n.args[0],r),A(e,n.args[1],r));case i.OrderedPairAccess:return x(A(e,n.args[0],r),A(e,n.args[1],r));case i.Equal:return S(A(e,n.args[0],r),A(e,n.args[1],r));case i.Less:return T(A(e,n.args[0],r),A(e,n.args[1],r));case i.Greater:return w(A(e,n.args[0],r),A(e,n.args[1],r));case i.LessEqual:return _(A(e,n.args[0],r),A(e,n.args[1],r));case i.GreaterEqual:return I(A(e,n.args[0],r),A(e,n.args[1],r));case i.And:return A(e,n.args[0],r)&&A(e,n.args[1],r);case i.ExtendSeed:return k(n.tag,A(e,n.args[0],r),A(e,n.args[1],r));case i.Piecewise:var a=A(e,n.args[0],r);return A(e,a?n.args[1]:n.args[2],r);case i.NativeFunction:for(var s=[],u=0,c=n.args;u<c.length;u++){var l=c[u];s.push(A(e,l,r))}return P(n.symbol,s);case i.List:s=[];for(var p=0,E=n.args;p<E.length;p++){l=E[p];s.push(A(e,l,r))}return s;case i.ListAccess:case i.DeferredListAccess:case i.InboundsListAccess:return N(e,n,r);case i.BroadcastResult:return function(e,t,r){for(var n=e.getInstruction(t),i=O(e,n,r),a=[],o=0;o<i;o++)a.push(L(e,t,o,r));return a}(e,t,r);case i.BlockVar:var C=n.args[0],M=e.getInstruction(C).args[0],D=t-C,R=e.getInstruction(C).args[D],F=[];F[R]=!0;for(var q=R;q>=M;q--)if(F[q]){var B=e.getInstruction(q);if(!o.isLeafInstruction(B))for(var V=0,z=B.args;V<z.length;V++){(l=z[V])<M?A(e,l,r):F[l]=!0}}var j=e.copy();j.truncate(M);for(q=0;q<M;q++){var U=r[q],G=e.getInstruction(q);if(void 0!==U){var W=G.valueType;j.replaceInstructionWithConstant(q,{type:i.Constant,valueType:W,value:U})}}var K=[];for(q=M;q<t;q++){var H=e.getInstruction(q);if(o.isLeafInstruction(H))K.push(j.copyInstruction(H));else{for(var J=[],Y=0,$=H.args;Y<$.length;Y++){l=$[Y];J.push(l<M?l:K[l-M])}H.type===i.DeferredListAccess?K.push(j.InboundsListAccess(J)):K.push(j.copyInstructionWithArgs(H,J))}}return j.Noop(),j.replaceInstructionWithBlockVar(j.returnIndex,{type:i.BlockVar,valueType:n.valueType,args:[C<M?C:K[C-M]]}),j.close().getCompiledFunction().fn();case i.BeginLoop:case i.EndLoop:case i.BeginIntegral:case i.EndIntegral:case i.BeginBroadcast:case i.EndBroadcast:case i.Distribution:case i.Noop:case i.LoadArg:case i.SymbolicVar:case i.Action:throw new Error("Programming Error: cannot interpret opcode "+n.type);default:throw new Error("Programming Error: unexpected opcode "+n.type)}}Object.defineProperty(t,"__esModule",{value:!0}),t._interpretRecursive=t.interpretBroadcastElements=t.interpretBroadcastElement=t.interpret=t.NativeFunction=t.ExtendSeed=t.InboundsListAccess=t.DeferredListAccess=t.ListAccess=t.List=t.And=t.GreaterEqual=t.LessEqual=t.Greater=t.Less=t.Equal=t.OrderedPairAccess=t.OrderedPair=t.Negative=t.RawExponent=t.Exponent=t.Divide=t.Multiply=t.Subtract=t.Add=void 0,t.Add=d,t.Subtract=f,t.Multiply=h,t.Divide=y,t.Exponent=m,t.RawExponent=v,t.Negative=g,t.OrderedPair=b,t.OrderedPairAccess=x,t.Equal=S,t.Less=T,t.Greater=w,t.LessEqual=_,t.GreaterEqual=I,t.And=function(e,t){return e&&t},t.List=E,t.ListAccess=C,t.DeferredListAccess=function(e,t){return M(e,t)},t.InboundsListAccess=M,t.ExtendSeed=k,t.NativeFunction=P,t.interpret=function(e,t){return A(e,t,Array(t+1))},t.interpretBroadcastElement=function(e,t,r){return L(e,t,r,Array(t+1))},t.interpretBroadcastElements=function(e,t,r){for(var n=Array(t+1),i=[],a=0,o=r;a<o.length;a++){var s=o[a];i.push(L(e,t,s,n))}return i},t._interpretRecursive=D});r("core/math/ir/features/find-dependency-symbols",["require","exports","../instructions","../opcodes"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findDependencySymbols=void 0,t.findDependencySymbols=function(e,t){for(var i=[],a=[],o=0;o<t;o++)a.push(!1);for(a.push(!0),o=t;o>=0;o--)if(a[o]){var s=e.getInstruction(o);if(s.type===n.LoadArg)i.push({symbol:e.argNames[o],scope:"free"});else if(r.beginsBlock(s))switch(s.type){case n.BeginIntegral:i.push({symbol:s.callData.indexSymbol,scope:"integral"});break;case n.BeginLoop:i.push({symbol:s.callData.indexSymbol,scope:s.callData.type});break;case n.BeginBroadcast:if(s.listComprehensionCallData)for(var u=0,c=s.listComprehensionCallData.inputListSymbols;u<c.length;u++){var l=c[u];i.push({symbol:l,scope:"comprehension"})}break;default:throw new Error("Programming Error: unexpected loop instruction "+s.type)}else s.type===n.SymbolicVar&&s.symbol&&i.push({symbol:s.symbol,scope:"symbolic-var"});if(!r.isLeafInstruction(s))for(var p=0,d=s.args;p<d.length;p++){a[d[p]]=!0}}return i.reverse()}});r("core/math/ir/features/fuse-broadcast",["require","exports","../opcodes","core/math/types","../instructions","./interpret","./list-length","../../errormsg","./find-dependency-symbols"],function(e,t,r,n,i,a,o,s,u){"use strict";function c(e,t,r){if(r.valueType===n.ListOfDistribution){var i=o.getConstantListLength(e,t);if(null==i)throw s.variableLengthDistributionList(u.findDependencySymbols(e,t));for(var c=[],l=0;l<i;l++){var p=e.InboundsListAccess([t,e.Constant(l+1)]);c.push(p)}return e.List(c)}var d=a.interpret(e,t);return t===e.returnIndex&&e.popInstruction(),e.ConstantOfType(r.valueType,d)}Object.defineProperty(t,"__esModule",{value:!0}),t.fuseBroadcast=void 0,t.fuseBroadcast=function(e,t){var n=e.getInstruction(t);if(n.type!==r.BroadcastResult)return t;if(n.isConstantBroadcast)return c(e,t,n);for(var a=n.args[0],o=e.getInstruction(a),s=o.args[0],u=!1,l=s+1;l<a;l++){var p=e.getInstruction(l);if(p.type===r.DeferredListAccess&&p.args[1]===s){u=!0;break}}if(!u)return t;for(var d=[],f=s;f<=a+o.args.length-1;f++){var h=e.getInstruction(f);if(i.isLeafInstruction(h))d.push(e.copyInstruction(h));else{for(var y=[],m=0,v=h.args;m<v.length;m++){var g=v[m];y.push(g>=s?d[g-s]:g)}h.type===r.DeferredListAccess?d.push(e.InboundsListAccess(y)):d.push(e.copyInstructionWithArgs(h,y))}}var b=e.getInstruction(e.returnIndex);return b.type===r.BroadcastResult&&b.isConstantBroadcast?c(e,e.returnIndex,b):e.returnIndex}});r("core/math/ir/features/element-at",["require","exports","./list-length","./interpret","../opcodes","core/math/types","./nan-of-type"],function(e,t,r,n,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.elementsAt=t.elementAt=void 0,t.elementAt=function(e,t,o){var s=e.getInstruction(t);if(a.isList(s.valueType)){var u=r.getConstantListLength(e,t);if(o=Math.floor(o),isNaN(o)||o<0||void 0!==u&&o>=u){var c=a.elementType(s.valueType);return e.NanOfType(c)}return s.type===i.List?s.args[o]:s.type===i.Constant&&a.isList(s.valueType)?e.ConstantOfType(a.elementType(s.valueType),s.value[o]):s.type===i.BroadcastResult&&s.isConstantBroadcast?e.ConstantOfType(a.elementType(s.valueType),n.interpretBroadcastElement(e,t,o)):void 0!==u?e.InboundsListAccess([t,e.Constant(o+1)]):e.ListAccess([t,e.Constant(o+1)])}if(s.valueType===a.Point)return isNaN(o)||o<0||o>2?e.Constant(NaN):s.type===i.OrderedPair?s.args[o]:s.type===i.Constant?e.Constant(s.value[o]):e.OrderedPairAccess([t,e.Constant(o+1)]);throw new Error("Cannot access elements of "+a.prettyPrint(s.valueType))},t.elementsAt=function(e,t,s){var u=e.getInstruction(t);if(0===s.length)return e.ConstantOfType(u.valueType,[]);if(u.type===i.Constant&&a.isList(u.valueType)){for(var c=[],l=a.elementType(u.valueType),p=0,d=s;p<d.length;p++){var f=d[p],h=Math.floor(f);isNaN(h)||h<0||h>=r.assertConstantListLength(e,t,"Programming error: expected Constant list instruction to have constant length.")?c.push(o.nanOfType(l)):c.push(u.value[h])}return e.ConstantOfType(u.valueType,c)}if(u.type===i.List){c=[];for(var y=0,m=s;y<m.length;y++){f=m[y],h=Math.floor(f);if(isNaN(h)||h<0||h>=r.assertConstantListLength(e,t,"Programming error: expected List instruction to have constant length.")){var v=a.elementType(u.valueType);c.push(e.NanOfType(v))}else c.push(u.args[h])}return e.List(c)}if(u.type===i.BroadcastResult&&u.isConstantBroadcast)return e.ConstantOfType(u.valueType,n.interpretBroadcastElements(e,t,s));for(var g=[],b=!0,x=r.getConstantListLength(e,t),S=0,T=s;S<T.length;S++){f=T[S],h=Math.floor(f);g.push(e.Constant(h+1)),(isNaN(h)||h<0||void 0===x||h>=x)&&(b=!1)}var w=[t,e.List(g)];return b?e.InboundsListAccess(w):e.ListAccess(w)}});r("core/math/ir/features/constant-collapse",["require","exports","../opcodes","../instructions","core/math/types","core/math/maybe-rational","./depends-on-outer-variable","./is-constant","./as-value","./reconstitute-ir","./list-length","./contains-nan-value","./interpret","./fuse-broadcast","./element-at","../../builtin"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f,h,y){"use strict";function m(e,t){for(var r=[],n=0,i=t;n<i.length;n++){var a=i[n],o=e.getInstruction(a);if(!s.isConstant(o))return;r.push(o.value)}return r}Object.defineProperty(t,"__esModule",{value:!0}),t.constantCollapse=void 0,t.constantCollapse=function(e){if(e.instructionsLength()-1!==e.returnIndex)throw new Error("Programming Error: only the final instruction in a chunk can be constant collapsed");var t=e.getInstruction(e.returnIndex);if(n.isLeafInstruction(t))return e.returnIndex;switch(t.type){case r.Add:var v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.Constant&&g.type===r.Constant?(e.popInstruction(),e.Constant(d.Add(v.value,g.value))):v.type===r.Constant&&0===a.asFloat(v.value)?(e.popInstruction(),t.args[1]):g.type===r.Constant&&0===a.asFloat(g.value)?(e.popInstruction(),t.args[0]):e.returnIndex;case r.Subtract:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.Constant&&g.type===r.Constant?(e.popInstruction(),e.Constant(d.Subtract(v.value,g.value))):v.type===r.Constant&&0===a.asFloat(v.value)?(e.popInstruction(),e.Negative([t.args[1]])):g.type===r.Constant&&0===a.asFloat(g.value)?(e.popInstruction(),t.args[0]):e.returnIndex;case r.Multiply:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.Constant&&g.type===r.Constant?(e.popInstruction(),e.Constant(d.Multiply(v.value,g.value))):v.type===r.Constant&&1===a.asFloat(v.value)?(e.popInstruction(),t.args[1]):g.type===r.Constant&&1===a.asFloat(g.value)?(e.popInstruction(),t.args[0]):e.returnIndex;case r.Divide:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.Constant&&g.type===r.Constant?(e.popInstruction(),e.Constant(d.Divide(v.value,g.value))):g.type===r.Constant&&1===a.asFloat(g.value)?(e.popInstruction(),t.args[0]):e.returnIndex;case r.Exponent:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);if(v.type===r.Constant&&g.type===r.Constant)return e.popInstruction(),e.Constant(d.Exponent(v.value,g.value));if(v.type===r.Constant&&v.valueType===i.Number){if((b=a.asFloat(v.value))===Math.E)return e.popInstruction(),e.SyntheticNativeFunction("exp",[t.args[1]]);if(b>0)return e.popInstruction(),e.RawExponent(t.args)}if(g.type===r.Constant&&g.valueType===i.Number){var b;if(1===(b=a.asFloat(g.value)))return e.popInstruction(),t.args[0];if(b===Math.floor(b))return e.popInstruction(),e.RawExponent(t.args);if(a.isRational(g.value)){var x=g.value,S=x.n;if(x.d%2==1){e.popInstruction();var T=e.RawExponent([e.SyntheticNativeFunction("abs",[t.args[0]]),t.args[1]]);return S%2==0?T:e.Multiply([e.SyntheticNativeFunction("sign",[t.args[0]]),T])}}}return e.returnIndex;case r.RawExponent:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.Constant&&g.type===r.Constant?(e.popInstruction(),e.Constant(d.Exponent(v.value,g.value))):g.type===r.Constant&&1===a.asFloat(g.value)?(e.popInstruction(),t.args[0]):e.returnIndex;case r.Negative:return(v=e.getInstruction(t.args[0])).type===r.Constant?(e.popInstruction(),e.Constant(d.Negative(v.value))):e.returnIndex;case r.Equal:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.Constant&&g.type===r.Constant?(e.popInstruction(),e.ConstantOfType(i.Bool,d.Equal(v.value,g.value))):e.returnIndex;case r.Less:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.Constant&&g.type===r.Constant?(e.popInstruction(),e.ConstantOfType(i.Bool,d.Less(v.value,g.value))):e.returnIndex;case r.Greater:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.Constant&&g.type===r.Constant?(e.popInstruction(),e.ConstantOfType(i.Bool,d.Greater(v.value,g.value))):e.returnIndex;case r.LessEqual:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.Constant&&g.type===r.Constant?(e.popInstruction(),e.ConstantOfType(i.Bool,d.LessEqual(v.value,g.value))):e.returnIndex;case r.GreaterEqual:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.Constant&&g.type===r.Constant?(e.popInstruction(),e.ConstantOfType(i.Bool,d.GreaterEqual(v.value,g.value))):e.returnIndex;case r.And:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.Constant&&g.type===r.Constant?(e.popInstruction(),e.ConstantOfType(i.Bool,d.And(v.value,g.value))):e.returnIndex;case r.Piecewise:return(v=e.getInstruction(t.args[0])).type===r.Constant?(e.popInstruction(),v.value?t.args[1]:t.args[2]):e.returnIndex;case r.OrderedPairAccess:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.OrderedPair&&g.type===r.Constant?(e.popInstruction(),v.args[a.asFloat(g.value)-1]):v.type===r.Constant&&v.valueType===i.Point&&g.type===r.Constant?(e.popInstruction(),e.Constant(v.value[a.asFloat(g.value)-1])):e.returnIndex;case r.List:if(function(e,t){for(var r=0,n=t;r<n.length;r++){var i=n[r],a=e.getInstruction(i);if(!s.isConstant(a))return!1}return!0}(e,t.args)){e.popInstruction();for(var w=[],_=0,I=t.args;_<I.length;_++){var E=I[_];w.push(e.getInstruction(E).value)}return e.ConstantOfType(t.valueType,w)}return e.returnIndex;case r.ListAccess:case r.InboundsListAccess:var C=t.args[0],M=e.getInstruction(C),k=e.getInstruction(t.args[1]);if(M.type===r.Piecewise&&k.type===r.Constant){var P=t.type===r.ListAccess?e.ListAccess([M.args[1],t.args[1]]):e.InboundsListAccess([M.args[1],t.args[1]]),O=t.type===r.ListAccess?e.ListAccess([M.args[2],t.args[1]]):e.InboundsListAccess([M.args[2],t.args[1]]);return e.Piecewise([M.args[0],P,O])}if(M.type===r.BroadcastResult){if(k.type===r.Constant&&M.isConstantBroadcast&&M.valueType!==i.ListOfDistribution)return e.ConstantOfType(t.valueType,d.interpret(e,e.returnIndex));e.popInstruction();var L=M.args[0],N=C-L,A=(re=e.getInstruction(L)).args[0],D=void 0,R=void 0;if(t.type===r.InboundsListAccess)D=t.args[1];else{var F=l.getConstantListLength(e,C);if(k.type===r.Constant&&k.valueType===i.Number&&void 0!==F){var q=a.asFloat(k.value),B=Math.floor(q);if(B<1||B>F)return e.NanOfType(t.valueType);D=q===B?t.args[1]:e.Constant(B)}else{var V=e.Constant(1),z=e.getInstruction(A).args[0],j=e.SyntheticNativeFunction("floor",[t.args[1]]),U=e.GreaterEqual([j,V]),G=e.LessEqual([j,z]);D=e.Piecewise([U,e.Piecewise([G,j,z]),V]),R={one:V,lengthIndex:z,roundedIndex:j,greaterEqualIndex:U,lessEqualIndex:G}}}if(re.args[N]<A)return re.args[N];for(var W=[D],K=A+1;K<=re.args[N];K++){var H=e.getInstruction(K);if(n.isLeafInstruction(H))W.push(e.copyInstruction(H));else{for(var J=[],Y=0,$=H.args;Y<$.length;Y++){E=$[Y];J.push(E>=A?W[E-A]:E)}H.type===r.DeferredListAccess?W.push(e.InboundsListAccess(J)):W.push(e.copyInstructionWithArgs(H,J))}}if(R){U=R.greaterEqualIndex,G=R.lessEqualIndex,z=R.lengthIndex,V=R.one;var X=i.elementType(M.valueType),Z=e.NanOfType(X),Q=W[W.length-1],ee=e.And([e.And([U,G]),e.GreaterEqual([z,V])]);return e.Piecewise([ee,Q,Z])}return W[W.length-1]}if(k.type===r.Constant&&k.valueType===i.Number){if(M.type===r.List){e.popInstruction();var te=Math.floor(a.asFloat(k.value))-1;return isNaN(te)||te<0||te>=M.args.length?e.NanOfType(t.valueType):M.args[te]}if(M.type===r.Constant){e.popInstruction();te=Math.floor(a.asFloat(k.value))-1;return isNaN(te)||te<0||te>=M.value.length?e.NanOfType(t.valueType):e.ConstantOfType(i.elementType(M.valueType),M.value[te])}return e.returnIndex}return e.returnIndex;case r.BlockVar:var re=e.getInstruction(t.args[0]);if(!n.endsBlock(re))return e.returnIndex;N=e.returnIndex-t.args[0];if(o.dependsOnOuterVariable(e,re.args[N],re.args[0]))return e.returnIndex;var ne=e.copy();ne.close();w=ne.getCompiledFunction().fn();return e.popInstruction(),c.reconstituteIR(e,t.valueType,w);case r.NativeFunction:switch(t.symbol){case"nthroot":if(void 0!==(de=m(e,t.args)))return e.Constant(a.nthroot(de[0],de[1]));var ie=e.getInstruction(t.args[1]);return ie.type===r.Constant&&ie.valueType===i.Number?e.Exponent([t.args[0],e.Constant(a.reciprocal(ie.value))]):e.returnIndex;case"length":return void 0!==(F=l.getConstantListLength(e,t.args[0]))?(e.popInstruction(),e.Constant(F)):e.returnIndex;case"select":if(s.isConstant(e.getInstruction(t.args[1]))){e.popInstruction();var ae=u.asValue(e,t.args[1]),oe=[];for(K=0;K<ae.length;K++)ae[K]&&oe.push(K);return h.elementsAt(e,t.args[0],oe)}return e.returnIndex;case"shuffle":var se=t.args[0];M=t.args[1];if(void 0!==(F=l.getConstantListLength(e,M))&&s.isConstant(e.getInstruction(se))){e.popInstruction();var ue=y.randomPerm(u.asValue(e,se),F);return h.elementsAt(e,M,ue)}return e.returnIndex;case"elementsAt":var ce=t.args[0],le=t.args[1];if(s.isConstant(e.getInstruction(le))){e.popInstruction();var pe=u.asValue(e,le);return h.elementsAt(e,ce,pe)}return e.returnIndex;default:var de;return void 0===(de=m(e,t.args))?e.returnIndex:(e.popInstruction(),e.ConstantOfType(t.valueType,d.NativeFunction(t.symbol,de)))}case r.ExtendSeed:var fe=e.getInstruction(t.args[0]),he=e.getInstruction(t.args[1]);return s.isConstant(fe)&&s.isConstant(he)?e.ConstantOfType(i.SeedType,d.ExtendSeed(t.tag,u.asValue(e,t.args[0]),u.asValue(e,t.args[1]))):e.returnIndex;case r.OrderedPair:v=e.getInstruction(t.args[0]),g=e.getInstruction(t.args[1]);return v.type===r.Constant&&v.valueType===i.Number&&g.type===r.Constant&&g.valueType===i.Number?e.ConstantOfType(i.Point,[v.value,g.value]):e.returnIndex;case r.BroadcastResult:return void 0!==(F=l.getConstantListLength(e,e.returnIndex))&&0===F?(e.popInstruction(),e.ConstantOfType(t.valueType,[])):e.returnIndex;case r.Action:for(var ye=0,me=t.args;ye<me.length;ye++){E=me[ye];if(!s.isConstantOrConstantBroadcast(e.getInstruction(E)))return e.returnIndex}e.popInstruction();var ve={};for(K=0;K<t.symbols.length;K++){var ge=t.symbols[K],be=e.getInstruction(t.args[K]);if(be.type===r.BroadcastResult&&(be=e.getInstruction(f.fuseBroadcast(e,t.args[K]))),be.type!==r.Constant)throw new Error("Expected instruction to be constant");var xe=be.valueType;w=be.value;p.containsNanValue(xe,w)||(ve[ge]={value:w,valueType:xe})}return e.ConstantOfType(i.Action,{type:"Action",updateRules:ve});case r.EndLoop:case r.EndIntegral:case r.BeginBroadcast:case r.EndBroadcast:case r.DeferredListAccess:case r.Distribution:case r.BeginIntegral:case r.BeginLoop:return e.returnIndex;default:throw new Error("Unexpected opcode "+t.type)}}});r("core/math/ir/features/type-check",["require","exports","core/math/errormsg","../opcodes","core/math/types","../builtin-table","../instructions"],function(e,t,r,n,i,a,o){"use strict";function s(e,t){for(var r=[],n=0,a=t;n<a.length;n++){var o=a[n];r.push(i.prettyPrint(e.getInstruction(o).valueType))}return r}function u(e,t,r){for(var n=0;n<t.length;n++){var a=e.getInstruction(t[n]).valueType,o=r[n];if(!i.isSubType(a,o))return!1}return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.typeCheck=t.argIsTypeOrListOfType=t.argTypesMatch=t.extractScalarValueTypes=t.extractValueTypes=void 0,t.extractValueTypes=s,t.extractScalarValueTypes=function(e,t){for(var r=[],n=0,a=t;n<a.length;n++){var o=a[n],s=e.getInstruction(o).valueType,u=i.isList(s)?i.elementType(s):s;r.push(i.prettyPrint(u))}return r},t.argTypesMatch=u,t.argIsTypeOrListOfType=function(e,t,r){return i.isTypeOrListOfType(e.getInstruction(t).valueType,r)},t.typeCheck=function(e,t){var c=e.getInstruction(t);if(!o.isLeafInstruction(c))switch(c.type){case n.Add:var l=[i.Number,i.Number];if(!u(e,c.args,l))throw r.addTypeError(s(e,c.args));return;case n.Subtract:l=[i.Number,i.Number];if(!u(e,c.args,l))throw r.subtractTypeError(s(e,c.args));return;case n.Multiply:l=[i.Number,i.Number];if(!u(e,c.args,l))throw r.multiplyTypeError(s(e,c.args));return;case n.Divide:l=[i.Number,i.Number];if(!u(e,c.args,l))throw r.divideTypeError(s(e,c.args));return;case n.Exponent:case n.RawExponent:l=[i.Number,i.Number];if(!u(e,c.args,l))throw r.exponentTypeError(s(e,c.args));return;case n.Negative:l=[i.Number];if(!u(e,c.args,l))throw r.negativeTypeError(s(e,c.args));return;case n.Equal:case n.Less:case n.Greater:case n.LessEqual:case n.GreaterEqual:l=[i.Number,i.Number];if(!u(e,c.args,l))throw r.comparatorTypeError(s(e,c.args));return;case n.And:l=[i.Bool,i.Bool];if(!u(e,c.args,l))throw r.andTypeError(s(e,c.args));return;case n.Piecewise:if(e.getInstruction(c.args[0]).valueType!==i.Bool)throw r.piecewiseConditionTypeError(s(e,c.args));if(!i.isSubType(e.getInstruction(c.args[1]).valueType,c.valueType)||!i.isSubType(e.getInstruction(c.args[2]).valueType,c.valueType))throw r.piecewiseBranchTypeError([i.prettyPrint(e.getInstruction(c.args[1]).valueType),i.prettyPrint(e.getInstruction(c.args[2]).valueType)]);return;case n.OrderedPair:for(var p=0,d=c.args;p<d.length;p++){var f=d[p];if((x=e.getInstruction(f).valueType)!==i.Number)throw r.pointTypeError(i.prettyPrint(x))}return;case n.OrderedPairAccess:l=[i.Point,i.Number];if(!u(e,c.args,l))throw r.orderedPairAccessTypeError(s(e,c.args));return;case n.BeginIntegral:var h=e.getInstruction(c.args[0]).valueType,y=e.getInstruction(c.args[1]).valueType;if(h!==i.Number)throw r.integralLowerBoundTypeError([i.prettyPrint(h)]);if(y!==i.Number)throw r.integralUpperBoundTypeError([i.prettyPrint(y)]);return;case n.EndIntegral:var m=e.getInstruction(c.args[1]).valueType;if(m!==i.Number)throw r.integralArgumentTypeError([i.prettyPrint(m)]);return;case n.List:if(0===c.args.length)return;var v=e.getInstruction(c.args[0]).valueType;if(!i.hasListType(v))throw r.listTypeError([i.prettyPrint(v)]);for(var g=0,b=c.args;g<b.length;g++){f=b[g];var x=e.getInstruction(f).valueType;if(!i.hasListType(x))throw r.listTypeError([i.prettyPrint(x)]);if(x!==v)throw r.heterogeneousList()}return;case n.ListAccess:case n.DeferredListAccess:case n.InboundsListAccess:var S=e.getInstruction(c.args[0]).valueType,T=i.isList(S),w=e.getInstruction(c.args[1]).valueType===i.Number;if(!T||!w)throw r.indexTypeError(s(e,c.args));return;case n.NativeFunction:var _=c.args,I=c.symbol,E=a.BuiltInTable[I],C=(l=E.argumentTypes,c.callData.errorSymbol);if(!u(e,c.args,l)){if("doubleReducer"===E.tag){if(!i.isList(e.getInstruction(_[0]).valueType)||!i.isList(e.getInstruction(_[1]).valueType))throw r.nonListDoubleReducer(C)}else if("parameterizedReducer"===E.tag&&!i.isList(e.getInstruction(_[0]).valueType))throw r.nonListParameterizedReducer(C);var M=_;throw r.functionTypeError(C,s(e,M))}return;case n.ExtendSeed:if(e.getInstruction(c.args[0]).valueType!==i.SeedType||e.getInstruction(c.args[1]).valueType!==i.SeedType&&e.getInstruction(c.args[1]).valueType!==i.Number)throw r.parseError();return;case n.Action:for(var k=0,P=c.args;k<P.length;k++){f=P[k];var O=e.getInstruction(f).valueType;if(!i.isTypeOrListOfType(O,i.Number)&&!i.isTypeOrListOfType(O,i.Point))throw r.updateRuleTypeError(i.prettyPrint(O))}for(var L={},N=0,A=c.symbols;N<A.length;N++){if(L[I=A[N]])throw r.duplicateUpdateRules(I);L[I]=!0}return;case n.BroadcastResult:case n.BlockVar:case n.BeginBroadcast:case n.EndBroadcast:case n.BeginLoop:case n.EndLoop:case n.Distribution:return;default:throw new Error("Unexpected opcode: "+c.type)}}});r("core/math/ir/features/count-references",["require","exports","../opcodes","../instructions"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countReferences=void 0,t.countReferences=function(e){for(var t=[],i=0;i<e.instructionsLength();i++){t.push(0);var a=e.getInstruction(i);if(!n.isLeafInstruction(a))if(n.endsBlock(a)&&a.type!==r.EndIntegral)for(var o=0,s=a.args;o<s.length;o++){t[s[o]]=1/0}else for(var u=0,c=a.args;u<c.length;u++){t[c[u]]+=1}}return t}});r("core/math/ir/features/emit-js",["require","exports","../opcodes","./print","../instructions","core/math/maybe-rational","core/math/types","../builtin-table","./count-references","core/math/context-types","./as-value","./nan-of-type"],function(e,t,r,n,i,a,o,s,u,c,l,p){"use strict";function d(e){return"_"+e}function f(e,t){var r=t[e];return void 0!==r?r:d(e)}function h(e,t,i,a,u,c){var h=i+1;switch(t.type){case r.Noop:case r.BlockVar:case r.BroadcastResult:case r.EndIntegral:case r.Action:return{source:"",nextIdx:h};case r.BeginIntegral:return{source:y(e,t,i,a,u,c),nextIdx:t.endIndex};case r.LoadArg:return u[i]=e.argNames[i],{source:"",nextIdx:h};case r.BeginBroadcast:return{source:v(e,t,i,u),nextIdx:h};case r.EndBroadcast:return{source:g(e,t,i,u),nextIdx:h};case r.BeginLoop:return{source:b(e,t,i,u),nextIdx:h};case r.EndLoop:return{source:x(e,t,i,u),nextIdx:h};default:var m=function(e,t,i){switch(e.type){case r.Constant:return e.valueType===o.Number||e.valueType===o.Bool||e.valueType===o.Point?S(e.value):(i.push(l.compilerValueToRuntimeValue(e.value)),"_C["+(i.length-1)+"]");case r.Add:return f(e.args[0],t)+"+"+f(e.args[1],t);case r.Subtract:return f(e.args[0],t)+"-"+f(e.args[1],t);case r.Multiply:return f(e.args[0],t)+"*"+f(e.args[1],t);case r.Divide:return f(e.args[0],t)+"/"+f(e.args[1],t);case r.Exponent:return"BuiltIn.pow("+f(e.args[0],t)+","+f(e.args[1],t)+")";case r.RawExponent:return"Math.pow("+f(e.args[0],t)+","+f(e.args[1],t)+")";case r.Negative:return"-"+f(e.args[0],t);case r.Equal:return f(e.args[0],t)+"==="+f(e.args[1],t);case r.Less:return f(e.args[0],t)+"<"+f(e.args[1],t);case r.Greater:return f(e.args[0],t)+">"+f(e.args[1],t);case r.LessEqual:return f(e.args[0],t)+"<="+f(e.args[1],t);case r.GreaterEqual:return f(e.args[0],t)+">="+f(e.args[1],t);case r.And:return f(e.args[0],t)+"&&"+f(e.args[1],t);case r.Piecewise:return f(e.args[0],t)+"?"+f(e.args[1],t)+":"+f(e.args[2],t);case r.OrderedPair:return"["+f(e.args[0],t)+","+f(e.args[1],t)+"]";case r.OrderedPairAccess:return f(e.args[0],t)+"["+f(e.args[1],t)+"-1]";case r.List:return"["+e.args.map(function(e){return f(e,t)}).join(",")+"]";case r.DeferredListAccess:case r.Distribution:case r.SymbolicVar:throw new Error("Programming Error: expect "+n.printOp(e.type)+" to be removed before emitting code.");case r.ListAccess:var a=f(e.args[0],t);return"(Math.floor("+(u=f(e.args[1],t))+")>=1&&Math.floor("+u+")<="+a+".length)?"+a+"[Math.floor("+u+")-1]:"+S(p.nanOfType(e.valueType));case r.InboundsListAccess:var u;return(a=f(e.args[0],t))+"["+(u=f(e.args[1],t))+"-1]";case r.NativeFunction:var c=s.BuiltInTable[e.symbol],d=e.args.map(function(e){return f(e,t)}).join(",");return c.module+"."+c.symbol+"("+d+")";case r.ExtendSeed:return f(e.args[0],t)+"+'::"+e.tag+"'+"+f(e.args[1],t);case r.LoadArg:case r.Noop:case r.BeginIntegral:case r.EndIntegral:case r.BeginLoop:case r.EndLoop:case r.BeginBroadcast:case r.EndBroadcast:case r.BlockVar:case r.BroadcastResult:case r.Action:throw new Error("Unexpected opcode "+e.type);default:throw new Error("Unexpected opcode "+e.type)}}(t,u,c);return a[i]<=1?(u[i]="("+m+")",{source:"",nextIdx:h}):{source:d(i)+"="+m+";\n",nextIdx:h}}}function y(e,t,r,n,i,a){var o="BuiltIn.quad(";o+=function(e,t,r,n,i,a){var o=t.endIndex,s="function("+d(r)+") {\n";s+=m(e,r+1,o-1,n);for(var u=r+1;u<o;){var c=e.getInstruction(u),l=h(e,c,u,n,i,a);s+=l.source,u=l.nextIdx}return s+"return "+f(e.getInstruction(o).args[1],i)+";\n}"}(e,t,r,n,i,a),o+=","+f(t.args[0],i)+","+f(t.args[1],i)+")";var s=t.endIndex;return n[s+1]<=1?(i[s+1]=o,""):d(s+1)+"="+o+";"}function m(e,t,n,a){for(var o="",s=!1,u=t;u<=n;u++){var c=e.getInstruction(u);if(c.type!==r.Noop&&c.type!==r.EndBroadcast&&c.type!==r.EndLoop)if(c.type!==r.BeginIntegral)a[u]<=1&&!i.beginsBlock(c)&&!i.endsBlock(c)&&c.type!==r.BlockVar&&c.type!==r.BroadcastResult||(s?o+=",":(o+="var ",s=!0),o+=d(u));else{var l=c.endIndex;u=a[l+1]<=1?l+1:l}}return s&&(o+=";\n"),o}function v(e,t,n,i){for(var a=d(n),o=e.getInstruction(t.endIndex),s=f(t.args[0],i),u="",c=1;c<o.args.length;c++){var l=t.endIndex+c;if(e.getInstruction(l).type===r.BroadcastResult)u+=d(l)+"=[];\n"}return u+="for("+a+"=1;"+a+"<="+s+";"+a+"++){\n"}function g(e,t,n,i){for(var a="",o=1;o<t.args.length;o++){var s=n+o;if(!(s>=e.instructionsLength()))if(e.getInstruction(s).type===r.BroadcastResult)a+=d(n+o)+".push("+f(t.args[o],i)+");\n"}return a+="}\n"}function b(e,t,n,i){for(var a=d(n),o=""+f(t.args[0],i),s=""+f(t.args[1],i),u="if(!isFinite("+s+"-"+o+")){\n",c=2;c<t.args.length;c++){var l=t.endIndex+c-1;if(!(l>=e.instructionsLength())){var h=e.getInstruction(l);if(h.type===r.BlockVar)u+=d(l)+"="+S(p.nanOfType(h.valueType))+";\n"}}u+="}else{\n";for(c=2;c<t.args.length;c++){var y=n+c-1;if(e.getInstruction(y).type===r.BlockVar)u+=d(y)+"="+f(t.args[c],i)+";\n"}return u+="for("+a+"="+o+";"+a+"<="+s+";"+a+"++){\n"}function x(e,t,n,i){for(var a="",o=1;o<t.args.length;o++){var s=t.args[0]+o;if(e.getInstruction(s).type===r.BlockVar)a+=d(s)+"="+f(t.args[o],i)+";\n"}a+="}\n";for(o=1;o<t.args.length;o++){var u=n+o;if(!(u>=e.instructionsLength()))if(e.getInstruction(u).type===r.BlockVar)a+=d(u)+"="+f(t.args[0]+o,i)+";\n"}return a+="}\n"}function S(e){if(Array.isArray(e))return"["+e.map(S).join(",")+"]";switch(typeof e){case"boolean":case"number":return e.toString();case"string":return""+JSON.stringify(e);case"object":if(c.isActionCompilerValue(e))throw new Error("Action values cannot be compiled");return a.asFloat(e).toString();default:throw new Error("Unexpected value: "+e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.emitJS=void 0,t.emitJS=function(e){for(var t=u.countReferences(e),r=[],n=[],i=m(e,e.argNames.length,e.instructionsLength()-1,t),a=0;a<e.instructionsLength();){var o=e.getInstruction(a),s=h(e,o,a,t,r,n);i+=s.source,a=s.nextIdx}return{source:i+="return "+f(e.returnIndex,r)+";",constants:n}}});r("core/math/ir/features/get-value-type",["require","exports","../opcodes","core/math/types"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getValueType=void 0,t.getValueType=function(e,t,i){switch(t){case r.Add:case r.Subtract:case r.Multiply:case r.Divide:case r.Exponent:case r.RawExponent:case r.Negative:case r.OrderedPairAccess:case r.BeginIntegral:case r.BeginLoop:case r.BeginBroadcast:return n.Number;case r.Equal:case r.Less:case r.Greater:case r.LessEqual:case r.GreaterEqual:case r.And:return n.Bool;case r.Piecewise:var a=e.getInstruction(i[1]).valueType,o=e.getInstruction(i[2]).valueType;return a===n.EmptyList&&n.isList(o)?o:a;case r.OrderedPair:return n.Point;case r.List:if(0===i.length)return n.EmptyList;var s=e.getInstruction(i[0]).valueType;return n.hasListType(s)?n.listType(s):n.ListOfAny;case r.ListAccess:case r.DeferredListAccess:case r.InboundsListAccess:var u=e.getInstruction(i[0]).valueType;return n.isList(u)?n.elementType(u):n.Any;case r.ExtendSeed:return n.SeedType;case r.Action:return n.Action;case r.Constant:case r.LoadArg:case r.NativeFunction:case r.Distribution:case r.BlockVar:case r.BroadcastResult:case r.SymbolicVar:case r.Noop:case r.EndIntegral:case r.EndBroadcast:case r.EndLoop:return n.Any;default:throw new Error("Unexpected opcode "+t)}}});r("core/math/ir/features/drop-unreferenced-instructions",["require","exports","../instructions"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dropUnreferencedInstructions=void 0,t.dropUnreferencedInstructions=function(e){for(var t=[],n=0;n<e.instructionsLength();n++)t.push(!1);for(t[e.returnIndex]=!0,n=e.instructionsLength()-1;n>=0;n--)if(t[n]){var i=e.getInstruction(n);if(!r.isLeafInstruction(i))for(var a=0,o=i.args;a<o.length;a++){t[o[a]]=!0}}else e.replaceInstructionWithNoop(n)}});r("core/math/ir/features/copy-instruction",["require","exports","../opcodes"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.copyInstructionWithArgs=t.copyInstruction=void 0,t.copyInstruction=function(e,t){return e.pushLeafInstruction(t)},t.copyInstructionWithArgs=function(e,t,n){switch(t.type){case r.Add:return e.Add(n);case r.Subtract:return e.Subtract(n);case r.Multiply:return e.Multiply(n);case r.Divide:return e.Divide(n);case r.Exponent:return e.Exponent(n);case r.RawExponent:return e.RawExponent(n);case r.Negative:return e.Negative(n);case r.Equal:return e.Equal(n);case r.Less:return e.Less(n);case r.Greater:return e.Greater(n);case r.LessEqual:return e.LessEqual(n);case r.GreaterEqual:return e.GreaterEqual(n);case r.And:return e.And(n);case r.Piecewise:return e.Piecewise(n);case r.BlockVar:return e.BlockVar(t.valueType,n);case r.BroadcastResult:return e.BroadcastResult(t.valueType,n);case r.OrderedPair:return e.OrderedPair(n);case r.OrderedPairAccess:return e.OrderedPairAccess(n);case r.NativeFunction:return e.NativeFunction(t.symbol,t.callData,n);case r.Distribution:return e.Distribution(t.symbol,n);case r.BeginIntegral:return e.BeginIntegral(t.callData,n);case r.EndIntegral:return e.EndIntegral(n);case r.BeginBroadcast:return e.BeginBroadcast(n);case r.EndBroadcast:return e.EndBroadcast(n);case r.BeginLoop:return e.BeginLoop(t.callData,n);case r.EndLoop:return e.EndLoop(n);case r.List:return e.List(n);case r.ListAccess:return e.ListAccess(n);case r.DeferredListAccess:return e.DeferredListAccess(n);case r.InboundsListAccess:return e.InboundsListAccess(n);case r.ExtendSeed:return e.ExtendSeed(t.tag,n);case r.Action:return e.Action(t.symbols,n);default:throw new Error("Unexpected opcode "+t.type)}}});r("core/math/ir/features/convert-to-broadcast",["require","exports","core/math/errormsg","../opcodes","core/math/types","./list-length","../instructions","../builtin-table","./fuse-broadcast","./is-constant","./as-value","./copy-instruction"],function(e,t,r,n,i,a,o,s,u,c,l,p){"use strict";function d(e,t,r){for(var o=t.args,s=!1,d=[],h=0;h<o.length;h++)if(!r||r[h]){var y=o[h],m=e.getInstruction(y).valueType;i.isList(m)&&-1===d.indexOf(y)&&d.push(y),m===i.EmptyList&&(s=!0)}if(0===d.length)return e.returnIndex;if(t.type===n.Piecewise&&-1==d.indexOf(t.args[0])&&d.indexOf(t.args[1])>=0&&d.indexOf(t.args[2])>=0){var v=u.fuseBroadcast(e,t.args[1]),g=u.fuseBroadcast(e,t.args[2]);return v!==t.args[1]||g!==t.args[2]?p.copyInstructionWithArgs(e,t,[t.args[0],v,g]):e.returnIndex}e.popInstruction();var b=a.minListLengthIndex(e,d);if(void 0===b)throw new Error("Programming Error: expected minListLength to be defined for "+d.length+" lists");var x=b;if(c.isConstant(e.getInstruction(x))&&0===l.asValue(e,x)&&s)return e.ConstantOfType(i.EmptyList,[]);for(var S=e.BeginBroadcast([x]),T=[],w=0,_=d;w<_.length;w++){var I=_[w];T.push(f(e,I,S))}var E=[];for(h=0;h<o.length;h++){y=o[h];if(r&&!r[h])E.push(y);else{var C=d.indexOf(y);E.push(-1===C?y:T[C])}}var M=e.copyInstructionWithArgs(t,E),k=e.EndBroadcast([S,M]);return e.BroadcastResult(i.listType(e.getInstruction(M).valueType),[k])}function f(e,t,r){return e.getInstruction(t).type==n.BroadcastResult?e.DeferredListAccess([t,r]):e.InboundsListAccess([t,r])}Object.defineProperty(t,"__esModule",{value:!0}),t.deferredOrInboundsAccess=t.convertToBroadcast=void 0,t.convertToBroadcast=function(e){if(e.instructionsLength()-1!==e.returnIndex)throw new Error("Programming Error: only the final instruction in a chunk can be converted to broadcast");var t=e.getInstruction(e.returnIndex);if(o.isLeafInstruction(t))return e.returnIndex;switch(t.type){case n.Add:case n.Subtract:case n.Multiply:case n.Divide:case n.Exponent:case n.RawExponent:case n.Equal:case n.Less:case n.Greater:case n.LessEqual:case n.GreaterEqual:case n.And:case n.OrderedPair:case n.Negative:case n.Piecewise:case n.OrderedPairAccess:return d(e,t);case n.Distribution:return u.fuseBroadcast(e,d(e,t));case n.NativeFunction:var a=s.BuiltInTable[t.symbol];switch(a.tag){case"default":case"trig":case"inverseTrig":case"color":return d(e,t);case"never-broadcast":for(var c=[],l=!1,p=0,f=t.args;p<f.length;p++){var h=f[p],y=u.fuseBroadcast(e,h);y!==h?(l=!0,c.push(y)):c.push(h)}return l?e.copyInstructionWithArgs(t,c):e.returnIndex;case"reducer":if(function(e,t){for(var r=0,n=t;r<n.length;r++){var a=n[r];if(i.isList(e.getInstruction(a).valueType))return!0}return!1}(e,t.args)){if(1===t.args.length){var m=t.args[0],v=u.fuseBroadcast(e,m);return v!==m?e.copyInstructionWithArgs(t,[v]):e.returnIndex}return d(e,t)}e.popInstruction();var g=function(e,t){var r=e.getInstruction(t[0]).valueType;if(!i.hasListType(r))return i.ListOfAny;for(var n=0,a=t;n<a.length;n++){var o=a[n];if(e.getInstruction(o).valueType!==r)return i.ListOfAny}return i.listType(r)}(e,t.args);if(!i.isSubType(g,a.argumentTypes[0]))throw r.functionTypeError(t.callData.errorSymbol,[i.prettyPrint(g)]);var b=e.List(t.args);return e.copyInstructionWithArgs(t,[b]);case"doubleReducer":if(2!==t.args.length)throw new Error("Programming error: double reducers must have two arguments");var x=u.fuseBroadcast(e,t.args[0]),S=u.fuseBroadcast(e,t.args[1]);return x!==t.args[0]&&S!==t.args[1]?e.copyInstructionWithArgs(t,[x,S]):e.returnIndex;case"parameterizedReducer":if(2!==t.args.length)throw new Error("Programming error: double reducers must have two arguments");return(x=u.fuseBroadcast(e,t.args[0]))===t.args[0]?d(e,t,[!1,!0]):e.copyInstructionWithArgs(t,[x,t.args[1]]);default:var T=a.tag;throw new Error("Programming Error: unexpected tag "+T)}case n.ListAccess:case n.DeferredListAccess:case n.InboundsListAccess:return d(e,t,[!1,!0]);case n.BeginIntegral:case n.EndIntegral:case n.BeginLoop:case n.EndLoop:return e.returnIndex;case n.List:case n.BlockVar:case n.BeginBroadcast:case n.EndBroadcast:case n.BroadcastResult:case n.ExtendSeed:case n.Action:return e.returnIndex;default:throw new Error("Unexpected opcode "+t.type)}},t.deferredOrInboundsAccess=f});r("core/math/ir/features/to-dot",["require","exports","../instructions","./print","../opcodes"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=[];t.push("digraph {");for(var a=0;a<e.instructionsLength();a++){(o=e.getInstruction(a)).type!==i.Noop&&t.push(a+' [label="'+a+": "+n.printInstruction(e,a)+'"];')}for(a=0;a<e.instructionsLength();a++){var o=e.getInstruction(a);if(r.isInternalInstruction(o))for(var s=0,u=o.args;s<u.length;s++){var c=u[s];t.push(a+" -> "+c+";")}}return t.push("}"),t.join("\n")}});r("core/math/ir/features/get-dependency-mask",["require","exports","../instructions"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDependencyMask=void 0,t.getDependencyMask=function(e,t){for(var n=[],i=0;i<e.instructionsLength();i++)n.push(!1);n[t]=!0;for(var a=0;a<=1;a++){var o=!1;for(i=t+1;i<e.instructionsLength();i++){var s=e.getInstruction(i);if(!r.isLeafInstruction(s)&&!n[i]){for(var u=!1,c=0,l=s.args;c<l.length;c++){if(n[l[c]]){u=!0;break}}n[i]=u,u&&r.endsBlock(s)&&!n[s.args[0]]&&(n[s.args[0]]=!0,o=!0)}}if(!o)break}return n}});r("core/math/ir/features/polynomial-order",["require","exports","../opcodes","core/math/maybe-rational","./get-dependency-mask","../instructions"],function(e,t,r,n,i,a){"use strict";function o(e,t,r){var n=r.allowRestriction,a=r.allowClosedBlockReferences;return{chunk:e,argIndex:t,orderTable:[],mask:i.getDependencyMask(e,t),allowRestriction:n,allowClosedBlockReferences:a}}function s(e,t){var i=e.orderTable[t];if(void 0!==i)return i;var o=function(e,t){var i=e.chunk,o=e.mask,u=e.argIndex,c=e.allowRestriction;if(!e.allowClosedBlockReferences&&i.isInClosedBlock(t))return 1/0;if(t===u)return 1;var l=i.getInstruction(t);if(a.beginsBlock(l)||a.endsBlock(l))return 1/0;switch(l.type){case r.Add:case r.Subtract:case r.Less:case r.LessEqual:case r.Greater:case r.GreaterEqual:var p=l.args,d=p[0],f=p[1];return Math.max(s(e,d),s(e,f));case r.Multiply:var h=l.args;d=h[0],f=h[1];return s(e,d)+s(e,f);case r.Negative:return s(e,l.args[0]);case r.Divide:var y=l.args;d=y[0];return s(e,f=y[1])>0?1/0:s(e,d);case r.Exponent:case r.RawExponent:var m=l.args,v=(d=m[0],f=m[1],i.getInstruction(f));if(0===s(e,d)&&0===s(e,f))return 0;if(v.type===r.Constant){var g=n.asFloat(v.value);return g===Math.round(g)&&g>0?s(e,d)*g:1/0}return 1/0;case r.Piecewise:if(!o[t])return 0;var b=i.getInstruction(l.args[2]);return c&&b.type===r.Constant&&isNaN(n.asFloat(b.value))?s(e,l.args[1]):1/0;case r.LoadArg:case r.Noop:case r.Constant:case r.Equal:case r.And:case r.OrderedPair:case r.OrderedPairAccess:case r.List:case r.ListAccess:case r.DeferredListAccess:case r.InboundsListAccess:case r.NativeFunction:case r.Distribution:case r.BroadcastResult:case r.BlockVar:case r.SymbolicVar:case r.ExtendSeed:case r.Action:return o[t]?1/0:0;default:throw new Error("Unexpected opcode "+l.type)}}(e,t);return e.orderTable[t]=o,o}Object.defineProperty(t,"__esModule",{value:!0}),t.instructionOrder=t.polynomialOrderContext=t.polynomialOrder=void 0,t.polynomialOrder=function(e,t,r){var n=e.argNames.indexOf(t);return-1===n?0:s(o(e,n,r),e.returnIndex)},t.polynomialOrderContext=o,t.instructionOrder=s});r("core/math/ir/features/get-polynomial-coefficients",["require","exports","../chunk","../opcodes","core/math/maybe-rational","./polynomial-order","../instructions","./copy-instruction"],function(e,t,r,n,i,a,o,s){"use strict";function u(e){var t,i,a=e.chunk,u=e.argIndex;if(a.isInClosedBlock(u))throw new Error("Programming Error: cannot find polynomial coefficients of an instruction in a closed block");u>=0&&u<a.argNames.length?(t=a.argNames.slice(),i=a.argTypes.slice(),t.splice(u,1),i.splice(u,1)):(t=a.argNames,i=a.argTypes);for(var c=new r.Chunk({argNames:t,argTypes:i}),l=[],p=0;p<a.instructionsLength();p++){var d=a.getInstruction(p);if(d.type===n.LoadArg)p<u||u<0?l.push(p):p===u?l.push(c.SymbolicVar(a.argTypes[p])):l.push(p-1);else if(o.isLeafInstruction(d))l.push(s.copyInstruction(c,d));else{for(var f=[],h=0,y=d.args;h<y.length;h++){var m=y[h];f.push(l[m])}l.push(s.copyInstructionWithArgs(c,d,f))}}var v=c.Constant(0),g=c.Constant(1),b=c.Constant(NaN);return{chunk:a,newChunk:c,orderCtx:e,coefficientTable:[],mask:e.mask,valueMap:l,argIndex:u,zero:v,one:g,nan:b}}function c(e,t){var r,o=e.newChunk,s=e.orderCtx,u=e.coefficientTable,l=e.mask,p=e.valueMap,d=e.argIndex,f=e.zero,h=e.one,y=e.nan,m=u[t];if(void 0!==m)return m;for(r=l[t]?t===d?[f,h]:a.instructionOrder(s,t)>2?[y]:function(e,t){var r,a=e.chunk.getInstruction(t),o=e.newChunk;switch(a.type){case n.Add:for(var s=a.args,u=s[0],l=s[1],p=c(e,u),d=c(e,l),f=p.length-1,h=d.length-1,y=[],m=0;m<=Math.max(f,h);m++)f>=m&&h>=m?y.push(o.Add([p[m],d[m]])):y.push(f>h?p[m]:d[m]);return y;case n.Subtract:case n.Less:case n.LessEqual:case n.Greater:case n.GreaterEqual:var v=a.args;u=v[0],l=v[1];a.type!==n.Less&&a.type!=n.LessEqual||(u=(r=[l,u])[0],l=r[1]);p=c(e,u),d=c(e,l),f=p.length-1,h=d.length-1,y=[];for(var g=0;g<=Math.max(f,h);g++)f>=g&&h>=g?y.push(o.Subtract([p[g],d[g]])):y.push(f>h?p[g]:o.Negative([d[g]]));return y;case n.Negative:p=c(e,u=a.args[0]),y=[];for(var b=0;b<p.length;b++)y.push(o.Negative([p[b]]));return y;case n.Multiply:for(var x=a.args,S=(u=x[0],l=x[1],p=c(e,u),d=c(e,l),f=p.length-1,h=d.length-1,y=[],0);S<=f;S++)for(var T=0;T<=h;T++)if(!(S+T>2)){var w=o.Multiply([p[S],d[T]]),_=y[S+T];y[S+T]=void 0===_?w:o.Add([_,w])}return y;case n.Divide:for(var I=a.args,E=(u=I[0],l=I[1],p=c(e,u),d=c(e,l),y=[],0);E<p.length;E++)y.push(o.Divide([p[E],d[0]]));return y;case n.Exponent:case n.RawExponent:var C=a.args;u=C[0],l=C[1],p=c(e,u),d=c(e,l);if(0===(f=p.length-1))return[o.RawExponent([p[0],d[0]])];var M=o.getInstruction(d[0]);switch(i.asFloat(M.value)){case 0:return[o.Constant(0)];case 1:return p;case 2:return[o.Multiply([p[0],p[0]]),o.Multiply([o.Constant(2),o.Multiply([p[0],p[1]])]),o.Multiply([p[1],p[1]])]}case n.Piecewise:return c(e,a.args[1]);case n.Noop:case n.BeginBroadcast:case n.LoadArg:case n.Constant:case n.Equal:case n.And:case n.OrderedPair:case n.OrderedPairAccess:case n.List:case n.ListAccess:case n.DeferredListAccess:case n.InboundsListAccess:case n.NativeFunction:case n.Distribution:case n.BeginIntegral:case n.EndIntegral:case n.BeginLoop:case n.EndLoop:case n.EndBroadcast:case n.BroadcastResult:case n.BlockVar:case n.SymbolicVar:case n.ExtendSeed:case n.Action:throw new Error("Cannot find polynomial coefficients of opcode "+a.type+" that depends on symbol.");default:throw new Error("Unexpected opcode "+a.type)}}(e,t):[p[t]];r.length>1;){var v=o.getInstruction(r[r.length-1]);if(v.type!==n.Constant||0!==i.asFloat(v.value))break;r.pop()}if(0===r.length)throw new Error("Programming Error: coefficients cannot be empty");return u[t]=r,r}Object.defineProperty(t,"__esModule",{value:!0}),t.instructionCoefficients=t.polynomialCoefficientContext=t.getPolynomialCoefficients=void 0,t.getPolynomialCoefficients=function(e,t){var r=e.argNames.indexOf(t),i=u(a.polynomialOrderContext(e,r,{allowRestriction:!0,allowClosedBlockReferences:!1}));if(a.instructionOrder(i.orderCtx,e.returnIndex)>2)throw new Error("Programming Error: cannot compute polynomial coefficients for polynomials of order greater than 2");for(var o=c(i,e.returnIndex),s=!1,l=0;l<e.instructionsLength();l++)e.getInstruction(l).type===n.Piecewise&&i.mask[l]&&(s=!0);return{chunk:i.newChunk,coefficients:o,mappedArgIndex:i.valueMap[r],mappedReturnIndex:i.valueMap[e.returnIndex],isRestrictedPolynomial:s}},t.polynomialCoefficientContext=u,t.instructionCoefficients=c});r("core/math/ir/features/lift-point-operations",["require","exports","../opcodes","core/math/types","../instructions"],function(e,t,r,n,i){"use strict";function a(e,t){return e.getInstruction(t).valueType===n.Point}function o(e,t){return e.getInstruction(t).valueType===n.Number}Object.defineProperty(t,"__esModule",{value:!0}),t.liftPointOperations=void 0,t.liftPointOperations=function(e){if(e.instructionsLength()-1!==e.returnIndex)throw new Error("Programming Error: only the final instruction in a chunk can be converted to broadcast");var t=e.getInstruction(e.returnIndex);if(i.isLeafInstruction(t))return e.returnIndex;switch(t.type){case r.Add:if(a(e,t.args[0])&&a(e,t.args[1])){var n=e.Constant(1),s=e.Constant(2);return e.OrderedPair([e.Add([e.OrderedPairAccess([t.args[0],n]),e.OrderedPairAccess([t.args[1],n])]),e.Add([e.OrderedPairAccess([t.args[0],s]),e.OrderedPairAccess([t.args[1],s])])])}return e.returnIndex;case r.Subtract:if(a(e,t.args[0])&&a(e,t.args[1])){n=e.Constant(1),s=e.Constant(2);return e.OrderedPair([e.Subtract([e.OrderedPairAccess([t.args[0],n]),e.OrderedPairAccess([t.args[1],n])]),e.Subtract([e.OrderedPairAccess([t.args[0],s]),e.OrderedPairAccess([t.args[1],s])])])}return e.returnIndex;case r.Negative:if(a(e,t.args[0])){n=e.Constant(1),s=e.Constant(2);return e.OrderedPair([e.Negative([e.OrderedPairAccess([t.args[0],n])]),e.Negative([e.OrderedPairAccess([t.args[0],s])])])}return e.returnIndex;case r.Multiply:if(a(e,t.args[0])&&o(e,t.args[1])){n=e.Constant(1),s=e.Constant(2);return e.OrderedPair([e.Multiply([e.OrderedPairAccess([t.args[0],n]),t.args[1]]),e.Multiply([e.OrderedPairAccess([t.args[0],s]),t.args[1]])])}if(o(e,t.args[0])&&a(e,t.args[1])){n=e.Constant(1),s=e.Constant(2);return e.OrderedPair([e.Multiply([t.args[0],e.OrderedPairAccess([t.args[1],n])]),e.Multiply([t.args[0],e.OrderedPairAccess([t.args[1],s])])])}return e.returnIndex;case r.Divide:if(a(e,t.args[0])&&o(e,t.args[1])){n=e.Constant(1),s=e.Constant(2);return e.OrderedPair([e.Divide([e.OrderedPairAccess([t.args[0],n]),t.args[1]]),e.Divide([e.OrderedPairAccess([t.args[0],s]),t.args[1]])])}return e.returnIndex;case r.Exponent:case r.RawExponent:case r.Equal:case r.Less:case r.Greater:case r.LessEqual:case r.GreaterEqual:case r.And:case r.OrderedPair:case r.Piecewise:case r.OrderedPairAccess:case r.NativeFunction:case r.Distribution:case r.ListAccess:case r.DeferredListAccess:case r.InboundsListAccess:case r.BeginIntegral:case r.EndIntegral:case r.BeginLoop:case r.EndLoop:case r.List:case r.BlockVar:case r.BeginBroadcast:case r.EndBroadcast:case r.BroadcastResult:case r.ExtendSeed:case r.Action:return e.returnIndex;default:throw new Error("Unexpected opcode "+t.type)}}});r("core/math/policy",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.defaultPolicy=void 0;var r=["Sum","Product","Integral","List","Derivative","Piecewise","Exponent","PercentOf","FunctionDefinition","UpdateRule"];t.defaultPolicy={assignmentForbidden:function(e){return!0},graphingEnabled:function(){return!1},isValidSlider:function(e){return!1},sliderVariables:function(e){return[]},ansEnabled:function(){return!1},disabledFeatures:function(){return r}}});r("core/math/ir/features/substitute",["require","exports","../instructions","./copy-instruction","../opcodes"],function(e,t,r,n,i){"use strict";function a(e,t){var n=e.chunk,s=e.argMap,u=e.start;if(t<u)return t;var c=s[t-u];if(void 0!==c)return c;var l=o(e,t);e.argMap[t-u]=l;var p=n.getInstruction(t);if(r.beginsBlock(p))switch(p.type){case i.BeginBroadcast:case i.BeginIntegral:break;case i.BeginLoop:for(var d=p.args.length-2,f=0;f<d;f++)a(e,t+1+f);break;default:throw new Error("Programming Error. Unexpected OpCode: "+p.type)}else if(r.endsBlock(p))for(d=p.args.length-1,f=0;f<d;f++)a(e,t+1+f);return l}function o(e,t){var i=e.chunk,o=e.start,s=i.getInstruction(t);if(r.endsBlock(s))for(var u=s.args[0],c=u;c<=t;c++){var l=i.getInstruction(c);if(!r.isLeafInstruction(l))for(var p=0,d=l.args;p<d.length;p++){(m=d[p])<u&&a(e,m)}}if(r.isLeafInstruction(s))return n.copyInstruction(i,s);for(var f=[],h=0,y=s.args;h<y.length;h++){var m=y[h];f.push(a(e,m))}var v=e.argMap[t-o];return void 0!==v?v:n.copyInstructionWithArgs(i,s,f)}Object.defineProperty(t,"__esModule",{value:!0}),t._substituteInstruction=t.substitute=void 0,t.substitute=function(e,t,r,n){return a(function(e,t,r){return{chunk:e,argMap:t,start:r}}(e,[t],r),n)},t._substituteInstruction=o});r("core/math/ir/dependencies",["require","exports","core/math/builtinframe"],function(e,t,r){"use strict";function n(e,t){return"FunctionDefinition"===t.type&&(t=t._expression),a(e,t,{})}function i(e,t,r){for(var n=[],a=[],s=0,u=t.scopes;s<u.length;s++){for(var c=i(e,u[s],r),l=0,p=c.freeDependencies;l<p.length;l++){var d=p[l];-1===n.indexOf(d)&&-1===t.definitions.indexOf(d)&&n.push(d)}for(var f=0,h=c.updateSymbols;f<h.length;f++){d=h[f];-1===a.indexOf(d)&&a.push(d)}}for(var y=0,m=t.dependencies;y<m.length;y++){for(var v=o(e,m[y],r),g=0,b=v.freeDependencies;g<b.length;g++){d=b[g];-1===n.indexOf(d)&&-1===t.definitions.indexOf(d)&&n.push(d)}for(var x=0,S=v.updateSymbols;x<S.length;x++){d=S[x];-1===a.indexOf(d)&&a.push(d)}}return{freeDependencies:n,updateSymbols:a}}function a(e,t,r){if("Slider"===t.type||"Assignment"===t.type)return a(e,t._expression,r);var n=i(e,t.getScope(),r),o=n.freeDependencies,s=n.updateSymbols,u=t.getUpdateSymbols();if(u.length>0){s=s.slice();for(var c=0,l=u;c<l.length;c++){var p=l[c];-1===s.indexOf(p)&&s.push(p)}}return{freeDependencies:o,updateSymbols:s}}function o(e,t,n){if(n[t])return n[t];if(r[t])return n[t]={freeDependencies:[],updateSymbols:[]},n[t];var i=e[t];return i?(n[t]={freeDependencies:[t],updateSymbols:[]},n[t]=a(e,i,n),n[t]):(n[t]={freeDependencies:[t],updateSymbols:[]},n[t])}Object.defineProperty(t,"__esModule",{value:!0}),t.getCacheKeys=t.analyzeDependencies=t.getFreeDependencies=t.FRAME_SENTINEL=void 0,t.FRAME_SENTINEL={},t.getFreeDependencies=function(e,t){return n(e,t).freeDependencies},t.analyzeDependencies=n,t.getCacheKeys=function(e,r){for(var n={},i=r.getDependencies().slice();i.length;){var a=i.pop();if(!n.hasOwnProperty(a)){var o=e[a];if(o===t.FRAME_SENTINEL)return;n[a]=o,o&&o.getDependencies&&Array.prototype.push.apply(i,o.getDependencies())}}return function(e){var t=[];for(var r in e)t.push([r,e[r]]);return t}(n)}});r("core/math/ir/features/take-derivative",["require","exports","core/math/builtinframe","tslib","core/math/errormsg","../scope","../instructions","../opcodes","./get-dependency-mask","core/math/policy","core/math/baseparser","../build-ir","./copy-instruction","core/math/types","./substitute","./list-length","../dependencies","core/math/maybe-rational"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f,h,y,m,v){"use strict";function g(e,t,r){for(var n=e.chunk,i=e.valueMap,a=e.derivativeMap,u=e.backwardMask,c=t;c<=r;c++){var l=n.getInstruction(c);if(u[c]&&o.beginsBlock(l)&&-1!==l.endIndex)switch(l.type){case s.BeginIntegral:c=b(e,c);continue;case s.BeginLoop:case s.BeginBroadcast:c=x(e,c);continue}i.push(S(e,c)),a.push(T(e,c))}return r}function b(e,t){var r=e.chunk,i=e.forwardMask,a=e.valueMap,s=e.derivativeMap,u=e.ZERO,c=r.getInstruction(t),l=c.endIndex,p=r.getInstruction(l),f=u;if(i[c.args[1]]){var y=a[c.args[1]];f=r.Add([f,r.Multiply([s[c.args[1]],h.substitute(r,y,t,p.args[1])])])}if(i[c.args[0]]){y=a[c.args[0]];f=r.Subtract([f,r.Multiply([s[c.args[0]],h.substitute(r,y,t,p.args[1])])])}if(function(e,t,r){var n=e.getInstruction(t),i=e.getInstruction(n.endIndex);if(i.args[1]<t+1)return r[i.args[1]];for(var a=t+1;a<=i.args[1];a++){var s=e.getInstruction(a);if(!o.isLeafInstruction(s))for(var u=0,c=s.args;u<c.length;u++){var l=c[u];if(l<t&&r[l])return!0}}return!1}(r,t,i)){var m=a.slice();m.push(d.copyInstructionWithArgs(r,c,[m[c.args[0]],m[c.args[1]]])),s.push(u),g(n.__assign(n.__assign({},e),{valueMap:m,mustCopy:!0}),t+1,l-1);var v=d.copyInstructionWithArgs(r,p,[m[p.args[0]],s[p.args[1]]]);s.push(v),f=r.Add([f,d.copyInstructionWithArgs(r,r.getInstruction(l+1),[v])])}else for(var b=t;b<=l;b++)s.push(u);if(function(e,t,r){for(var n=e.getInstruction(t),i=t;i<=n.endIndex;i++){var a=e.getInstruction(i);if(!o.isLeafInstruction(a))for(var s=0,u=a.args;s<u.length;s++){var c=u[s];if(r[c]!==c)return!0}}return!1}(r,t,a)){var x=n.__assign(n.__assign({},e),{mustCopy:!0});for(b=t;b<=l+1;b++)a.push(S(x,b))}else for(b=t;b<=l+1;b++)a.push(b);return s.push(f),l+p.args.length-1}function x(e,t){var r=e.chunk,i=e.derivativeMap,a=e.valueMap,o=e.ZERO,u=r.getInstruction(t),c=u.endIndex,l=r.getInstruction(c);if(u.type===s.BeginBroadcast)a.push(d.copyInstructionWithArgs(r,u,u.args)),i.push(o);else{var p=[];p.push(a[u.args[0]],a[u.args[1]]);for(var f=2;f<u.args.length;f++)p.push(a[u.args[f]],i[u.args[f]]);a.push(d.copyInstructionWithArgs(r,u,p)),i.push(o);for(f=2;f<u.args.length;f++)a.push(d.copyInstructionWithArgs(r,r.getInstruction(t+f-1),[a[t]])),i.push(d.copyInstructionWithArgs(r,r.getInstruction(t+f-1),[a[t]]))}g(n.__assign(n.__assign({},e),{mustCopy:!0}),i.length,c-1);var h=[];h.push(a[l.args[0]]);for(f=1;f<l.args.length;f++)h.push(a[l.args[f]],i[l.args[f]]);a.push(d.copyInstructionWithArgs(r,l,h)),i.push(o);for(f=1;f<l.args.length;f++)a.push(d.copyInstructionWithArgs(r,r.getInstruction(c+f),[a[c]])),i.push(d.copyInstructionWithArgs(r,r.getInstruction(c+f),[a[c]]));return c+l.args.length-1}function S(e,t){var r=e.chunk,n=e.valueMap,i=e.mustCopy,a=r.getInstruction(t);if(o.isLeafInstruction(a))return i?d.copyInstruction(r,a):t;for(var s=[],u=!1,c=0,l=a.args;c<l.length;c++){var p=l[c];s.push(n[p]),n[p]!==p&&(u=!0)}return u||i?d.copyInstructionWithArgs(r,a,s):t}function T(e,t){var r=e.chunk,n=e.derivativeVarIndex,i=e.forwardMask,a=e.backwardMask,u=e.valueMap,c=e.derivativeMap,l=e.ZERO,p=e.ONE,h=e.NAN,m=r.getInstruction(t);if(!a[t])return l;if(t===n){if(f.isList(m.valueType)){var g=y.listLengthIndex(r,t),b=r.BeginBroadcast([g]),x=r.EndBroadcast([b,p]);return r.BroadcastResult(f.ListOfNumber,[x])}return p}if(o.beginsBlock(m)||o.endsBlock(m)||m.type===s.BlockVar||m.type===s.BroadcastResult||m.type===s.Equal||m.type===s.Greater||m.type===s.Less||m.type===s.GreaterEqual||m.type===s.LessEqual||m.type===s.And||m.type===s.Distribution||m.type===s.ExtendSeed||m.type===s.Action)return l;if(!i[t]||o.isLeafInstruction(m))return m.valueType!==f.Number?r.Multiply([l,u[t]]):m.type!==s.Constant||isFinite(v.asFloat(m.value))?l:h;if(m.type===s.List||m.type===s.OrderedPair){for(var S=[],T=0,_=m.args;T<_.length;T++){var I=_[T];S.push(c[I])}return d.copyInstructionWithArgs(r,m,S)}if(m.type===s.Piecewise)return d.copyInstructionWithArgs(r,m,[u[m.args[0]],c[m.args[1]],c[m.args[2]]]);for(var E=l,C=[],M=0,k=m.args;M<k.length;M++){var P=k[M];C.push(u[P])}for(var O=0;O<m.args.length;O++)if(i[m.args[O]]){var L=c[m.args[O]];if(L!==l){var N=w(e,m,O,C,L);N!==l&&(E=E===l?N:r.Add([N,E]))}}return E}function w(e,t,n,i,o){var u=e.chunk,l=e.ZERO,f=e.ONE,h=e.NAN;switch(t.type){case s.Add:return o;case s.Subtract:switch(n){case 0:return o;default:return u.Negative([o])}case s.Multiply:switch(n){case 0:return u.Multiply([o,i[1]]);default:return u.Multiply([i[0],o])}case s.Divide:switch(n){case 0:return u.Divide([o,i[1]]);default:return u.Multiply([i[0],u.Divide([u.Negative([o]),u.Multiply([i[1],i[1]])])])}case s.Negative:return u.Negative([o]);case s.Exponent:case s.RawExponent:switch(n){case 0:return u.Multiply([u.Multiply([i[1],u.Exponent([i[0],u.Subtract([i[1],f])])]),o]);default:return u.Multiply([u.Piecewise([u.Equal([i[0],l]),u.Piecewise([u.GreaterEqual([i[1],l]),l,h]),u.Multiply([u.SyntheticNativeFunction("ln",[i[0]]),u.Exponent([i[0],i[1]])])]),o])}case s.NativeFunction:return function(e,t,n,i){for(var o=Object.create(r),s=a.Scope({},-1),u=0;u<n.length;u++){var l=_[u];a.setSymbol(s,l,n[u]),o[l]=m.FRAME_SENTINEL}return a.setSymbol(s,"x_1",i),o.x_1=m.FRAME_SENTINEL,p.addToIR(p.Ctx(c.defaultPolicy,o,e,s,void 0),t)}(u,E[t.symbol][n],i,o);case s.ListAccess:case s.DeferredListAccess:case s.InboundsListAccess:case s.OrderedPairAccess:switch(n){case 0:return d.copyInstructionWithArgs(u,t,[o,i[1]]);default:return l}default:throw new Error("Unimplemented derivative for opcode "+t.type)}}Object.defineProperty(t,"__esModule",{value:!0}),t.takeDerivative=void 0,t.takeDerivative=function(e,t,r){var n=e.getInstruction(t);if(!f.isTypeOrListOfType(n.valueType,f.Number)&&!f.isTypeOrListOfType(n.valueType,f.Point))throw i.derivativeTypeError([f.prettyPrint(n.valueType)]);var a=e.getInstruction(r);if(!f.isTypeOrListOfType(a.valueType,f.Number)&&a.type!==s.Noop)throw i.parseError();var c=e.Constant(0);if(t<r)return c;for(var l=e.Constant(1),p=e.Constant(NaN),d=u.getDependencyMask(e,r),h=function(e,t){for(var r=[],n=0;n<t;n++)r.push(!1);r.push(!0);for(n=t;n>=0;n--)if(r[n]){var i=e.getInstruction(n);if(!o.isLeafInstruction(i))if(i.type===s.Piecewise)r[i.args[1]]=!0,r[i.args[2]]=!0;else for(var a=0,u=i.args;a<u.length;a++){r[u[a]]=!0}}return r}(e,t),y=[],m=[],v=0;v<r;v++)m.push(v),y.push(c);return g({chunk:e,derivativeVarIndex:r,forwardMask:d,backwardMask:h,valueMap:m,derivativeMap:y,mustCopy:!1,ZERO:c,ONE:l,NAN:p},r,t),y[t]};var _=["x","y","z","u"],I={exp:["\\exp(x)*x_1"],ln:["\\{x >= 0: x_1/x \\}"],log:["\\{x >= 0: x_1/(x*\\ln(10)) \\}"],sqrt:["x_1/(2*\\sqrt{x})"],rtxsqpone:["x*x_1/\\rtxsqpone(x)"],rtxsqmone:["x*x_1/\\rtxsqmone(x)"],sin:["\\cos(x)*x_1"],cos:["-\\sin(x)*x_1"],tan:["\\sec(x)^2*x_1"],arcsin:["x_1/\\sqrt{1 - x^2}"],arccos:["-x_1/\\sqrt{1 - x^2}"],sinh:["\\cosh(x)*x_1"],cosh:["\\sinh(x)*x_1"],tanh:["(\\sech(x))^2*x_1"],arcsinh:["x_1/\\sqrt{x^2 + 1}"],arccosh:["\\{ x > 0: x_1/\\rtxsqmone(x) \\}"],arctanh:["\\{ \\abs(x) < 1: x_1/(1 - x^2) \\}"],csc:["-\\cot(x)*\\csc(x)*x_1"],sec:["\\tan(x)*\\sec(x)*x_1"],cot:["-\\csc(x)^2*x_1"],arccsc:["-x_1/(\\abs(x)*\\rtxsqmone(x))"],arcsec:["x_1/(\\abs(x)*\\rtxsqmone(x))"],arccot:["-x_1/(1+x^2)"],csch:["-\\coth(x)*\\csch(x)*x_1"],sech:["-\\tanh(x)*\\sech(x)*x_1"],coth:["-(\\csch(x))^2*x_1"],arccsch:["-x_1/(\\abs(x)*\\rtxsqpone(x))"],arcsech:["\\{ x >= 0: -x_1/(x*\\sqrt{1 - x^2}) \\}"],arccoth:["\\{ \\abs(x) > 1 : x_1/(1 - x^2) \\}"],factorial:["(x)!*\\polyGamma(0, x + 1)*x_1"],floor:["\\{ \\mod(x, 1) > 0: 0*x_1 \\}"],ceil:["\\{ \\mod(x, 1) > 0: 0*x_1 \\}"],round:["\\{ \\abs(\\mod(x, 1) - 0.5) > 0: 0*x_1 \\}"],abs:["\\{ \\abs(x) > 0: \\sign(x)*x_1 \\}"],sign:["\\{ \\abs(x) > 0: 0*x_1 \\}"],distance:["-((y.x-x.x)*x_1.x+(y.y-x.y)*x_1.y)/\\distance(x,y)","((y.x-x.x)*x_1.x+(y.y-x.y)*x_1.y)/\\distance(x,y)"],mean:["\\mean(x_1)"],total:["\\total(x_1)"],length:["0"],var:["2*\\cov(x, x_1)"],varp:["2*\\cov(x, x_1)*(\\length(x)-1)/\\length(x)"],stdev:["\\cov(x, x_1)/\\stdev(x)"],stdevp:["\\covp(x, x_1)/\\stdevp(x)"],mad:["\\mean(\\sign(x-\\mean(x))*(x_1 - \\mean(x_1)))"],min:["x_1[\\argmin(x)]"],max:["x_1[\\argmax(x)]"],median:["0.5*(x_1[\\lowerQuantileIndex(x, 0.5)] + x_1[\\upperQuantileIndex(x, 0.5)])"],argmin:["0/0"],argmax:["0/0"],gcd:["0/0"],lcm:["0/0"],erf:["\\frac{2x_1}{\\sqrt{\\pi }}e^{-x^2}"],invNorm:["\\frac{x_1}{\\pdf(\\normaldist(0,1),\\invNorm(x))}"],logbase:["\\{x > 0: \\frac{x_1}{x*\\ln(y)} \\}","\\frac{-\\log_{y}(x)*x_1}{y*\\ln(y)}"],nthroot:["x^{1/y - 1}/y*x_1","-\\frac{x^{1/y}*\\ln(x)*x_1}{y^2}"],hypot:["x_1*x/\\hypot(x,y)","x_1*y/\\hypot(x,y)"],polyGamma:["0/0","\\polyGamma(1 + x, y)*x_1"],mod:["\\{ \\abs(\\mod(x, y)) > 0: x_1 \\}","\\{ \\mod(x/y, 1) > 0: -\\floor(x/y)*x_1 \\}"],cov:["\\cov(x_1, y)","\\cov(x, x_1)"],covp:["\\covp(x_1, y)","\\covp(x, x_1)"],corr:["(\\cov(x_1, y) - (\\cov(x, y)*\\cov(x, x_1)/\\var(x)))/(\\stdevp(x)\\stdevp(y))","(\\cov(x, x_1) - (\\cov(x, y)*\\cov(y, x_1)/\\var(y)))/(\\stdevp(x)\\stdevp(y))"],spearman:["0/0","0/0"],quantile:["\\{ \\floor(y*(\\length(x)-1)) = y*(\\length(x)-1) :   x_1[\\upperQuantileIndex(x, y)],  (\\ceil(y*(\\length(x)-1)) - y*(\\length(x)-1))*x_1[\\lowerQuantileIndex(x, y)] +   (y*(\\length(x)-1) - \\floor(y*(\\length(x)-1)))*x_1[\\upperQuantileIndex(x, y)]\\}","\\{ \\floor(y*(\\length(x)-1)) < y*(\\length(x)-1) :   (x[\\upperQuantileIndex(x, y)] - x[\\lowerQuantileIndex(x, y)])*x_1\\}"],quartile:["0.5*(x_1[\\lowerQuartileIndex(x, y)] + x_1[\\upperQuartileIndex(x, y)])","0/0"],tscore:["\\frac{\\sqrt{\\length(x)}(\\stdev(x)*\\mean(x_1)-(\\mean(x)-y)*\\frac{\\cov(x,x_1)}{\\stdev(x)})}{\\stdev(x)^2}","-x_1*\\sqrt{\\length(x)}/\\stdev(x)"],quartileIndex:["0/0","0/0"],upperQuartileIndex:["0/0","0/0"],lowerQuartileIndex:["0/0","0/0"],upperQuantileIndex:["0/0","0/0"],lowerQuantileIndex:["0/0","0/0"],nCr:["0/0","0/0"],nPr:["0/0","0/0"],arctan:["x_1*y/(y^2+x^2)","-x_1*x/(y^2+x^2)"],poissonpdf:["0/0","x_1\\frac{e^{-y}(\\floor(x)-y)y^{(\\floor(x)-1)}}{(\\floor(x))!}"],invPoisson:["0/0","0/0"],tpdf:["x_1*\\pdf(\\tdist(y),x)*\\frac{-(y+1)*x}{y+x^2}","x_1*\\frac{1}{2}\\pdf(\\tdist(y),x)(  \\frac{x^2-1}{y + x^2} + \\ln(\\frac{y}{y + x^2}) +   \\polyGamma(0, \\frac{1+y}{2}) - \\polyGamma(0, y/2))"],invT:["x_1/\\pdf(\\tdist(y),\\invT(x, y))","0/0"],tcdf:["-x_1*\\pdf(\\tdist(z),x)","x_1*\\pdf(\\tdist(z),y)","0/0"],poissoncdf:["0/0","0/0","x_1\\sum _{n=\\max(0,\\floor(\\min(x,y)))}^{\\floor(\\max(x,y))}\\frac{e^{-z}(n-z)z^{(n-1)}}{n!}"],normalpdf:["-x_1*\\frac{x-y}{z^2} \\pdf(\\normaldist(y,z),x)","x_1*\\frac{x-y}{z^2} \\pdf(\\normaldist(y,z),x)","x_1*(\\frac{(x-y-z)*(x-y+z)}{z^3}) \\pdf(\\normaldist(y,z),x)"],binompdf:["0/0","0/0","\\{0<=z<=1: x_1*\\pdf(\\binomialdist(y,z),x)*(\\frac{\\round(x)}{z}-\\frac{\\round(y)-\\round(x)}{1-z}), 0 \\}"],invBinom:["0/0","0/0","0/0"],uniformpdf:["0","\\{y<=x: \\frac{x_1}{(z-y)^2}, 0\\}","\\{z>=x: -\\frac{x_1}{(z-y)^2}, 0\\}"],invUniform:["\\{y<=x<=z: x_1*(z-y), 0\\}","\\{y<=x<=z: x_1*(1-x), 0\\}","\\{y<=x<=z: x_1*x, 0\\}"],normalcdf:["-x_1\\pdf(\\normaldist(z,u), x)","x_1\\pdf(\\normaldist(z,u), y)","-x_1*(\\pdf(\\normaldist(z,u), y) - \\pdf(\\normaldist(z,u), x))","x_1*(  \\{\\abs(y)=1/0:0,\\frac{z-y}{u}\\pdf(\\normaldist(z,u),y)\\} -   \\{\\abs(x)=1/0:0,\\frac{z-x}{u}\\pdf(\\normaldist(z,u),x)\\})"],binomcdf:["0/0","0/0","0/0","\\{0<=u<=1: x_1*\\sum _{n=\\max(0,\\round(\\min(x,y)))}^{\\round(\\max(x,y))}(  \\pdf(\\binomialdist(z,u),n)*(\\frac{n}{u}-\\frac{\\round(z)-n}{1-u})), 0 \\}"],uniformcdf:["\\{z>u: 0/0, -x_1\\pdf(\\uniformdist(z,u), x)\\}","\\{z>u: 0/0, x_1\\pdf(\\uniformdist(z,u), y)\\}","\\{z>u: 0/0, x_1*(\\frac{\\{z<x<u:u-x,0\\} + \\{z<y<u:y-u,0\\}}{(u-z)^2})\\}","\\{z>u: 0/0, x_1*(\\frac{\\{z<x<u:x-z,0\\} + \\{z<y<u:z-y,0\\}}{(u-z)^2})\\}"],normalSample:["0/0","0/0","0/0"],uniformSample:["0/0","0/0","0/0"],tSample:["0/0","0/0"],poissonSample:["0/0","0/0"],binomSample:["0/0","0/0","0/0"],rgb:["0/0","0/0","0/0"],hsv:["0/0","0/0","0/0"],polygon:["\\polygon(x_1)"],validateRangeLength:["0","0","0","\\{\\validateRangeLength(x,y,z,u) \\ge 1: x_1, 0\\}"],validateSampleCount:["\\{x<0:0,1\\}*x_1"],select:["\\select(x_1, y)","0*\\select(x,y)"],shuffle:["0*y","\\shuffle(x, x_1)"],sortPerm:["0*x"],elementsAt:["\\elementsAt(x_1, y)","0*\\elementsAt(x,y)"],uniquePerm:["0*\\uniquePerm(x)"]},E={};for(var C in I){for(var M=C,k=I[M],P=[],O=0;O<k.length;O++){var L=k[O];P.push(l.parse(L,{}))}E[M]=P}});r("core/math/ir/features/bound-domain",["require","exports","core/math/domaintypes","core/math/types","core/math/maybe-rational","../opcodes","./polynomial-order","./get-polynomial-coefficients","../instructions","./is-constant","./as-value"],function(e,t,r,n,i,a,o,s,u,c,l){"use strict";function p(e,t){var d=e.domainTable,f=d[t];if(void 0!==f)return f;var h=function(e,t){var d=e.chunk,f=e.mask,h=e.orderCtx,y=d.getInstruction(t);if(u.isLeafInstruction(y)){if(y.type===a.Constant)if(y.valueType==n.Number){if(isNaN(i.asFloat(y.value)))return r.emptyDomain()}else if(y.valueType===n.ListOfNumber)for(var m=0,v=y.value;m<v.length;m++){var g=v[m];if(isNaN(i.asFloat(g)))return r.unknownDomain()}return r.allReals()}switch(y.type){case a.And:case a.Add:case a.Subtract:case a.Multiply:case a.Divide:case a.Exponent:case a.RawExponent:case a.Negative:case a.BlockVar:case a.BroadcastResult:case a.OrderedPair:case a.OrderedPairAccess:case a.NativeFunction:case a.Distribution:case a.BeginIntegral:case a.EndIntegral:case a.BeginBroadcast:case a.EndBroadcast:case a.BeginLoop:case a.EndLoop:case a.ListAccess:case a.DeferredListAccess:case a.InboundsListAccess:case a.ExtendSeed:case a.Action:for(var b=r.allReals(),x=0,S=y.args;x<S.length;x++){var T=S[x];b=r.intersectDomains(b,p(e,T))}return b;case a.List:if(!f[t])return r.allReals();var w=p(e,y.args[0]);if("known"!==w.type)return r.unknownDomain();for(var _=1;_<y.args.length;_++){if("known"!==(b=p(e,y.args[_])).type)return r.unknownDomain();if(b.bounds[0]!==w.bounds[0]||b.bounds[1]!==w.bounds[1])return r.unknownDomain()}return w;case a.Equal:return f[t]?r.unknownDomain():r.allReals();case a.Piecewise:var I=d.getInstruction(y.args[2]);return I.type===a.Constant&&I.valueType===n.Number&&isNaN(i.asFloat(I.value))?r.intersectDomains(p(e,y.args[0]),p(e,y.args[1])):r.unknownDomain();case a.Less:case a.Greater:case a.LessEqual:case a.GreaterEqual:if(!f[t])return r.allReals();if(o.instructionOrder(h,t)>1)return r.unknownDomain();var E=e.coefficientCtx;void 0===E&&(E=s.polynomialCoefficientContext(h),e.coefficientCtx=E);var C=E.newChunk,M=s.instructionCoefficients(E,t),k=M[0],P=M[1];if(!c.isConstant(C.getInstruction(k)))return r.unknownDomain();var O=l.asValue(C,k);if(isNaN(O))return r.emptyDomain();for(var L=r.allReals(),N=0,A=y.args;N<A.length;N++){T=A[N];L=r.intersectDomains(L,p(e,T))}if(void 0===P)return y.type===a.LessEqual||y.type===a.GreaterEqual?O>=0?L:r.emptyDomain():O>0?L:r.emptyDomain();var D=l.asValue(C,P);return r.intersectDomains(L,r.linearPositiveDomain(O,D))}}(e,t);return d[t]=h,h}Object.defineProperty(t,"__esModule",{value:!0}),t.boundDomain=void 0,t.boundDomain=function(e,t,s){var u=e.argNames.indexOf(t);if(-1===u){var c=e.getInstruction(s);return c.type===a.Constant&&c.valueType===n.Number&&isNaN(i.asFloat(c.value))?r.emptyDomain():r.allReals()}return p(function(e){var t=e.chunk,r=e.mask;return{chunk:t,mask:r,orderCtx:e,domainTable:[]}}(o.polynomialOrderContext(e,u,{allowRestriction:!0,allowClosedBlockReferences:!1})),s)}});r("core/math/ir/features/find-linear-subset",["require","exports","../opcodes","core/math/types","../instructions"],function(e,t,r,n,i){"use strict";function a(e,t,r){var n=e.getInstruction(r),a=function(e){for(var t=[],r=0;r<e;r++)t.push(!1);return t}(e.argNames.length);if(i.isLeafInstruction(n))return a;for(var o=0,s=n.args;o<s.length;o++)for(var u=t[s[o]],c=0;c<u.length;c++)a[c]=a[c]||u[c];return a}function o(e,t,n,a){var o=e.getInstruction(a);if(i.isLeafInstruction(o))return s(e.argNames.length);switch(o.type){case r.Add:case r.Subtract:case r.Negative:case r.List:for(var u=s(e.argNames.length),c=0;c<o.args.length;c++)for(var l=n[o.args[c]],p=0;p<l.length;p++)u[p]=u[p]&&l[p];return u;case r.Divide:for(var d=[],f=n[o.args[0]],h=t[o.args[1]],y=0;y<f.length;y++)d.push(f[y]&&!h[y]);return d;case r.Multiply:for(var m=n[o.args[0]].slice(),v=n[o.args[1]].slice(),g=t[o.args[0]],b=t[o.args[1]],x=0,S=0,T=0;T<m.length;T++){var w=m[T]&&!b[T],_=v[T]&&!g[T];m[T]=w,v[T]=_,w&&(x+=1),_&&(S+=1)}return x>=S?m:v;case r.Piecewise:var I=t[o.args[0]],E=n[o.args[1]],C=n[o.args[2]],M=[];for(a=0;a<I.length;a++)M.push(!I[a]&&E[a]&&C[a]);return M;case r.ListAccess:case r.DeferredListAccess:case r.InboundsListAccess:var k=n[o.args[0]],P=t[o.args[1]],O=[];for(a=0;a<P.length;a++)O.push(k[a]&&!P[a]);return O;case r.BroadcastResult:var L=o.args[0],N=a-L;return n[e.getInstruction(L).args[N]];case r.OrderedPair:case r.OrderedPairAccess:case r.Exponent:case r.RawExponent:case r.Less:case r.LessEqual:case r.Greater:case r.GreaterEqual:case r.Equal:case r.And:case r.NativeFunction:case r.Distribution:case r.BeginIntegral:case r.EndIntegral:case r.BeginLoop:case r.EndLoop:case r.BeginBroadcast:case r.EndBroadcast:case r.BlockVar:case r.ExtendSeed:case r.Action:for(var A=[],D=0,R=t[a];D<R.length;D++){var F=R[D];A.push(!F)}return A;default:throw new Error("Unexpected opcode "+o.type)}}function s(e){for(var t=[],r=0;r<e;r++)t.push(!0);return t}Object.defineProperty(t,"__esModule",{value:!0}),t.findLinearSubset=void 0,t.findLinearSubset=function(e){for(var t=[],r=[],i=0;i<e.argNames.length;i++){for(var s=[],u=[],c=0;c<e.argNames.length;c++)s.push(e.argTypes[c]===n.Number),u.push(i===c);r.push(u),t.push(s)}for(i=e.argNames.length;i<=e.returnIndex;i++)r.push(a(e,r,i)),t.push(o(e,r,t,i));return t[e.returnIndex]}});r("core/math/ir/features/derive-regression-restrictions",["require","exports","../opcodes","core/math/types","../instructions","./is-constant","./as-value","./polynomial-order","./get-polynomial-coefficients","core/math/domaintypes","./list-length"],function(e,t,r,n,i,a,o,s,u,c,l){"use strict";function p(e,t,r,n,i,a){if("known"!==t.type)return r;if(t.bounds[0]===-1/0&&t.bounds[1]===1/0)return r;var o=e.And([e.LessEqual([e.Constant(t.bounds[0]),n]),e.LessEqual([n,e.Constant(t.bounds[1])])]);return e.Multiply([r,e.Piecewise([o,i,a])])}function d(e,t){for(var r=[],n=0;n<e.argNames.length;n++)r.push(n);var i=[];for(n=0;n<=t;n++)i.push(y(e,r,i,n));return i[t]}function f(e){return e.type===r.NativeFunction&&("sin"===e.symbol||"cos"===e.symbol)}function h(e){for(var t=1/0,r=-1/0,n=e.length,i=0,a=e;i<a.length;i++){var o=a[i];t=Math.min(t,o),r=Math.max(r,o)}return{min:t,max:r,length:n}}function y(e,t,r,n){for(var a=e.getInstruction(n),o=function(e){for(var t=[],r=0;r<e;r++)t.push(!1);return t}(t.length),s=0;s<t.length;s++)if(t[s]===n)return o[s]=!0,o;if(i.isLeafInstruction(a))return o;for(var u=0,c=a.args;u<c.length;u++)for(var l=r[c[u]],p=0;p<l.length;p++)o[p]=o[p]||l[p];return o}Object.defineProperty(t,"__esModule",{value:!0}),t.deriveRegressionRestrictions=void 0,t.deriveRegressionRestrictions=function(e){var t=e.getInstruction(e.returnIndex);if(t.type!==r.BroadcastResult)return e;var i=t.args[0],m=e.returnIndex-i,v=e.getInstruction(i),g=v.args[0],b=v.args[m],x=[],S=[];x.push(g);var T=l.assertConstantListLength(e,e.returnIndex,"Programming error: cannot optimize regression on non-constant-length list");S.push({min:1,max:T,length:T});for(var w=!1,_=!1,I=g+1;I<=b;I++){if((Y=e.getInstruction(I)).type===r.ListAccess||Y.type===r.InboundsListAccess||Y.type===r.DeferredListAccess){if(Y.args[1]!==g)continue;var E=Y.args[0];if(e.getInstruction(E).valueType!==n.ListOfNumber)continue;if(!a.isConstant(e.getInstruction(E)))continue;var C=h(o.asValue(e,E));if(!isFinite(C.min)||!isFinite(C.max))continue;x.push(I),S.push(C)}else f(Y)?w=!0:Y.type!==r.Exponent&&Y.type!==r.RawExponent||(_=!0)}if(0===x.length)return e;if(!_&&!w)return e;var M=[],k=[];for(I=0;I<e.argNames.length;I++)k.push(I),M.push(c.allReals());var P=[],O=[];for(I=0;I<=b;I++)P.push(y(e,k,P,I)),O.push(y(e,x,O,I));for(I=0;I<=b;I++){if((Y=e.getInstruction(I)).type===r.Piecewise)for(var L=P[I],N=0;N<L.length;N++)L[N]&&(M[N]=c.unknownDomain());else if(Y.type===r.Exponent||Y.type===r.RawExponent){var A=!1,D=!1;for(N=0;N<x.length;N++)O[Y.args[0]][N]&&(A=!0),O[Y.args[1]][N]&&(D=!0);if(A)continue;if(!D)continue;L=P[Y.args[0]];var R=0,F=void 0;for(N=0;N<L.length;N++)L[N]&&(F=N,R+=1);if(1!==R)continue;if(void 0===F)continue;var q=k[F],B=s.polynomialOrderContext(e.copy().reopenFinalBlock(),q,{allowRestriction:!1,allowClosedBlockReferences:!1});if(1!==s.instructionOrder(B,Y.args[0]))continue;var V=u.polynomialCoefficientContext(B),z=u.instructionCoefficients(V,Y.args[0]),j=z[0];if(void 0===(te=z[1]))continue;var U=o.asValue(V.newChunk,te),G=o.asValue(V.newChunk,j);M[F]=c.intersectDomains(M[F],c.linearPositiveDomain(G,U))}}if(w)for(var W=e.copy().reopenFinalBlock(),K=0;K<x.length;K++){var H=s.polynomialOrderContext(W,x[K],{allowRestriction:!1,allowClosedBlockReferences:!1}),J=u.polynomialCoefficientContext(H);for(I=g+1;I<=b;I++){var Y;if(f(Y=W.getInstruction(I))){var $=Y.args[0];if(1!==s.instructionOrder(H,$))continue;var X=u.instructionCoefficients(J,$)[1];if(void 0===X)continue;var Z=d(J.newChunk,X),Q=(F=void 0,0);for(N=0;N<Z.length;N++)Z[N]&&(F=N,Q+=1);if(1!==Q)continue;if(void 0===F)continue;var ee=s.polynomialOrderContext(J.newChunk,F,{allowRestriction:!1,allowClosedBlockReferences:!1});if(1!==s.instructionOrder(ee,X))continue;var te,re=u.polynomialCoefficientContext(ee),ne=u.instructionCoefficients(re,X);j=ne[0];if(void 0===(te=ne[1])||!a.isConstant(re.newChunk.getInstruction(j))||!a.isConstant(re.newChunk.getInstruction(te)))continue;G=o.asValue(re.newChunk,j),U=o.asValue(re.newChunk,te);var ie=(S[K].max-S[K].min)/Math.min(S[K].length-1,31),ae=Math.PI/ie;if(!isFinite(ae))continue;if(ae<=0)continue;M[F]=c.intersectDomains(M[F],c.linearPositiveDomain(G,U)),M[F]=c.intersectDomains(M[F],c.linearPositiveDomain(ae-G,-U))}}}for(var oe=!1,se=0,ue=M;se<ue.length;se++){var ce=ue[se];if("known"!==ce.type)return e;ce.bounds[0]===-1/0&&ce.bounds[1]===1/0||(oe=!0)}if(!oe)return e;var le=e.copy(),pe=e.returnIndex,de=le.Constant(1),fe=le.Constant(NaN);for(N=0;N<le.argNames.length;N++)pe=p(le,M[N],pe,N,de,fe);return le.close(),le}});r("core/math/ir/chunk",["require","exports","core/math/errormsg","core/math/types","core/math/maybe-rational","core/math/functions","./opcodes","./builtin-table","./features/constant-collapse","./features/type-check","./features/emit-js","./features/get-value-type","./features/is-constant","./features/list-length","./features/drop-unreferenced-instructions","./features/convert-to-broadcast","./features/print","./features/to-dot","./features/fuse-broadcast","./features/polynomial-order","./features/get-polynomial-coefficients","./features/copy-instruction","./features/lift-point-operations","./features/element-at","./features/take-derivative","./features/bound-domain","./features/find-linear-subset","./features/derive-regression-restrictions","./features/as-value","./features/depends-on-outer-variable","./features/nan-of-type","./features/find-dependency-symbols"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f,h,y,m,v,g,b,x,S,T,w,_,I,E,C,M,k,P,O){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Chunk=void 0;var L=1e4,N=function(){function e(e){if(this.instructions=[],this.blockMask=[],this.comments=[],e.argNames.length!==e.argTypes.length)throw new Error("Programming Error: length of argNames must match length of argTypes");this.argNames=e.argNames,this.argTypes=e.argTypes;for(var t=0;t<this.argTypes.length;t++){var r=this.argTypes[t];this.LoadArg(r)}this.returnIndex=-1}return e.prototype.addComments=function(e){for(var t in e){var r=this.comments[t]||"";this.comments[t]=r+e[t]}return this},e.prototype.instructionsLength=function(){return this.instructions.length},e.prototype.getInstruction=function(e){return this.instructions[e]},e.prototype.popInstruction=function(){return this.instructions.pop()},e.prototype.truncate=function(e){this.instructions.length=e,this.blockMask.length=e,this.comments.length=e},e.prototype.pushInstructionChecked=function(e){if(this.instructions.length>=32768)throw r.deeplyNested();this.instructions.push(e),this.returnIndex=this.instructions.length-1},e.prototype.pushLeafInstruction=function(e){return this.pushInstructionChecked(e),this.returnIndex},e.prototype.pushInstruction=function(e){return this.checkInstructionArguments(e),this.pushInstructionChecked(e),this.returnIndex=y.convertToBroadcast(this),this.returnIndex=T.liftPointOperations(this),c.typeCheck(this,this.returnIndex),this.returnIndex=u.constantCollapse(this),this.returnIndex},e.prototype.checkInstructionArguments=function(e){for(var t=0,r=e.args;t<r.length;t++){var n=r[t];if(this.blockMask[n])throw new Error("Programming Error: cannot reference an instruction in a closed block")}},e.prototype.markClosedBlock=function(e,t){for(var r=e;r<t;r++)this.blockMask[r]=!0},e.prototype.LoadArg=function(e){return this.pushLeafInstruction({type:o.LoadArg,valueType:e})},e.prototype.BlockVar=function(e,t){return this.pushInstruction({type:o.BlockVar,valueType:e,args:t})},e.prototype.SymbolicVar=function(e,t){return this.pushLeafInstruction({type:o.SymbolicVar,valueType:e,symbol:t})},e.prototype.BroadcastResult=function(e,t){var r=t[0],n=this.instructions[r],i=n.args[0],a=this.instructions.length-r,s=n.args[a],u=!k.dependsOnOuterVariable(this,s,i),c=this.getInstruction(i).args[0],l=this.getInstruction(c);return this.pushInstruction({type:o.BroadcastResult,valueType:e,args:t,isConstantBroadcast:u,constantLength:d.isConstant(l)?M.asValue(this,c):void 0})},e.prototype.Constant=function(e){return this.ConstantOfType(n.Number,e)},e.prototype.ConstantOfType=function(e,t){if("number"==typeof t&&(t=i.maybeRational(t,1)),n.isList(e)&&t.length>L)throw r.maxListSize(L.toLocaleString());return this.pushLeafInstruction({type:o.Constant,valueType:e,value:t})},e.prototype.NanOfType=function(e){if(e===n.Distribution){var t=this.Constant(NaN);return this.Distribution("uniformdist",[t,t])}return this.ConstantOfType(e,P.nanOfType(e))},e.prototype.Add=function(e){var t=o.Add,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.Subtract=function(e){var t=o.Subtract,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.Multiply=function(e){var t=o.Multiply,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.Divide=function(e){var t=o.Divide,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.Exponent=function(e){var t=o.Exponent,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.RawExponent=function(e){var t=o.RawExponent,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.Negative=function(e){var t=o.Negative,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.Equal=function(e){var t=o.Equal,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.Less=function(e){var t=o.Less,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.Greater=function(e){var t=o.Greater,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.LessEqual=function(e){var t=o.LessEqual,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.GreaterEqual=function(e){var t=o.GreaterEqual,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.And=function(e){var t=o.And,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.Piecewise=function(e){var t=o.Piecewise,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.OrderedPair=function(e){var t=o.OrderedPair,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.OrderedPairAccess=function(e){var t=o.OrderedPairAccess,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.List=function(e){var t=o.List,n=p.getValueType(this,t,e);if(e.length>L)throw r.maxListSize(L.toLocaleString());return this.pushInstruction({type:t,valueType:n,args:e})},e.prototype.ListAccess=function(e){var t=o.ListAccess,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.DeferredListAccess=function(e){var t=o.DeferredListAccess,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.InboundsListAccess=function(e){var t=o.InboundsListAccess,r=p.getValueType(this,t,e);return this.pushInstruction({type:t,valueType:r,args:e})},e.prototype.NativeFunction=function(e,t,r){var n=this,i=o.NativeFunction,a=s.BuiltInTable[e].returnType,u="function"==typeof a?a(r.map(function(e){return n.getInstruction(e).valueType})):a;return this.pushInstruction({type:i,valueType:u,args:r,symbol:e,callData:t})},e.prototype.SyntheticNativeFunction=function(e,t){var r=this,n=o.NativeFunction,i=s.BuiltInTable[e].returnType,a="function"==typeof i?i(t.map(function(e){return r.getInstruction(e).valueType})):i,u={errorSymbol:e,providedArity:t.length,isDotCall:!1};return this.pushInstruction({type:n,valueType:a,args:t,symbol:e,callData:u})},e.prototype.Distribution=function(e,t){var r=o.Distribution,i=n.Distribution;return this.pushInstruction({type:r,valueType:i,args:t,symbol:e})},e.prototype.BeginIntegral=function(e,t){var r=o.BeginIntegral,n=p.getValueType(this,r,[]);return this.pushInstruction({type:r,valueType:n,args:t,endIndex:-1,callData:e})},e.prototype.EndIntegral=function(e){var t=o.EndIntegral,r=p.getValueType(this,t,e),n=e[0],i=this.getInstruction(n);this.instructions[n]={type:i.type,valueType:i.valueType,args:i.args,endIndex:this.instructionsLength(),callData:i.callData};var a=this.pushInstruction({type:t,valueType:r,args:e});return this.markClosedBlock(n,a),a},e.prototype.BeginBroadcast=function(e,t){var n=o.BeginBroadcast,i=p.getValueType(this,n,[]),a=this.getInstruction(e[0]);if(d.isConstant(a)&&M.asValue(this,e[0])>L)throw r.maxListSize(L.toLocaleString());return this.pushInstruction({type:n,valueType:i,endIndex:-1,args:e,listComprehensionCallData:t})},e.prototype.EndBroadcast=function(e){var t=o.EndBroadcast,r=p.getValueType(this,t,e),n=e[0],i=this.getInstruction(n),a={type:i.type,valueType:i.valueType,args:i.args,endIndex:this.instructionsLength()};this.instructions[n]=a;var s=this.pushInstruction({type:t,valueType:r,args:e});return this.markClosedBlock(n,s),s},e.prototype.BeginLoop=function(e,t){var r=o.BeginLoop,n=p.getValueType(this,r,t);return this.pushInstruction({type:r,valueType:n,args:t,endIndex:-1,callData:e})},e.prototype.EndLoop=function(e){var t=o.EndLoop,r=p.getValueType(this,t,e),n=e[0],i=this.getInstruction(n);this.instructions[n]={type:i.type,valueType:i.valueType,args:i.args,endIndex:this.instructionsLength(),callData:i.callData};var a=this.pushInstruction({type:t,valueType:r,args:e});return this.markClosedBlock(n,a),a},e.prototype.ExtendSeed=function(e,t){var r=o.ExtendSeed,i=n.SeedType;return this.pushInstruction({type:r,valueType:i,args:t,tag:e})},e.prototype.Noop=function(){var e=o.Noop,t=n.Any;return this.pushLeafInstruction({type:e,valueType:t})},e.prototype.Action=function(e,t){return this.pushInstruction({type:o.Action,valueType:n.Action,args:t,symbols:e})},e.prototype.replaceInstructionWithConstant=function(e,t){this.instructions[e]=t,this.blockMask[e]=void 0},e.prototype.replaceInstructionWithBlockVar=function(e,t){this.instructions[e]=t},e.prototype.reopenFinalBlock=function(){var e=this.getInstruction(this.returnIndex);if(e.type!==o.BroadcastResult)return this;for(var t=e.args[0],r=this.getInstruction(t).args[0];r<t;r++)this.blockMask[r]=void 0;return this.truncate(t),this},e.prototype.isInClosedBlock=function(e){return this.blockMask[e]},e.prototype.copy=function(){var t=new e({argNames:this.argNames,argTypes:this.argTypes});return t.instructions=this.instructions.slice(),t.blockMask=this.blockMask.slice(),t.comments=this.comments.slice(),t.returnIndex=this.returnIndex,t},e.prototype.close=function(){return this.returnIndex=g.fuseBroadcast(this,this.returnIndex),h.dropUnreferencedInstructions(this),this},e.prototype.copyInstruction=function(e){return S.copyInstruction(this,e)},e.prototype.copyInstructionWithArgs=function(e,t){return S.copyInstructionWithArgs(this,e,t)},e.prototype.replaceInstructionWithNoop=function(e){this.instructions[e]={type:o.Noop,valueType:n.Any}},e.prototype.getReturnType=function(){return this.instructions[this.returnIndex].valueType},e.prototype.isConstant=function(){return d.isConstant(this.instructions[this.returnIndex])},e.prototype.asValue=function(){return M.asValue(this,this.returnIndex)},e.prototype.asCompilerValue=function(){var e=this.instructions[this.returnIndex];switch(e.type){case o.Constant:return e.value;default:throw new Error("Unexpected opcode "+e.type+".")}},e.prototype.getConstantListLength=function(){return f.getConstantListLength(this,this.returnIndex)},e.prototype.getListLengthDependencies=function(){var e=this.copy(),t=f.listLengthIndex(e,e.returnIndex);return O.findDependencySymbols(e,t)},e.prototype.elementAt=function(e){var t=this.copy(),r=t.returnIndex;return t.returnIndex=w.elementAt(t,r,e),t.close(),t},e.prototype.getCompiledFunction=function(e){var t;if(e){t=e.slice();for(var r=0,n=this.argNames;r<n.length;r++){var i=n[r];-1===t.indexOf(i)&&t.push(i)}}else t=this.argNames;var o=l.emitJS(this),s=o.source,u=o.constants;return{args:t,source:s,constants:u,fn:a.closureFunctionWithBuiltIn(t,s,u)}},e.prototype.polynomialOrder=function(e,t){return b.polynomialOrder(this,e,t)},e.prototype.getPolynomialCoefficients=function(e){return x.getPolynomialCoefficients(this,e)},e.prototype.takeDerivative=function(e){var t=this.copy(),r=this.argNames.indexOf(e);return-1===r?(t.Constant(0),t.close(),t):(t.returnIndex=_.takeDerivative(t,t.returnIndex,r),t.close(),t)},e.prototype.deriveRegressionRestrictions=function(){return C.deriveRegressionRestrictions(this)},e.prototype.boundDomain=function(e){return I.boundDomain(this,e,this.returnIndex)},e.prototype.findLinearSubset=function(e){for(var t=E.findLinearSubset(this),r=[],n=0,i=e;n<i.length;n++){var a=i[n],o=this.argNames.indexOf(a);if(-1===o)throw new Error("Programming Error: findLinearSubset called with a non-dependency");r.push(t[o])}return r},e.prototype.print=function(){return m.print(this)},e.prototype.printInstruction=function(e){return m.printInstruction(this,e)},e.prototype.toDot=function(){return v.default(this)},e.prototype.getLiveArgNames=function(){for(var e=[],t=0;t<this.argNames.length;t++){this.instructions[t].type===o.LoadArg&&e.push(this.argNames[t])}return e},e}();t.Chunk=N});r("core/math/ir/distribution-table",["require","exports","./features/list-length"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomSampleFromList=t.DistributionTable=void 0,t.DistributionTable={normaldist:{pdf:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("normalpdf",r.concat(n.args))},cdf:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("normalcdf",r.concat(n.args))},mean:function(e,t,r){return e.getInstruction(t).args[0]},median:function(e,r,n){return t.DistributionTable.normaldist.mean(e,r,n)},stdev:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("abs",[n.args[1]])},var:function(e,t,r){var n=e.getInstruction(t);return e.Multiply([n.args[1],n.args[1]])},quantile:function(e,t,r){var n=e.getInstruction(t);return e.Add([e.Multiply([e.SyntheticNativeFunction("invNorm",r),e.SyntheticNativeFunction("abs",[n.args[1]])]),n.args[0]])},random:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("normalSample",[r[0],n.args[0],n.args[1]])}},tdist:{pdf:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("tpdf",r.concat(n.args))},cdf:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("tcdf",r.concat(n.args))},mean:function(e,t,r){return e.Constant(0)},median:function(e,t,r){return e.Constant(0)},stdev:function(e,r,n){return e.SyntheticNativeFunction("sqrt",[t.DistributionTable.tdist.var(e,r,n)])},var:function(e,t,r){var n=e.getInstruction(t),i=e.Constant(2),a=n.args[0];return e.Piecewise([e.GreaterEqual([a,i]),e.Divide([a,e.Subtract([a,i])]),e.Constant(NaN)])},quantile:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("invT",[r[0],n.args[0]])},random:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("tSample",[r[0],n.args[0]])}},poissondist:{pdf:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("poissonpdf",r.concat(n.args))},cdf:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("poissoncdf",r.concat(n.args))},mean:function(e,t,r){return e.getInstruction(t).args[0]},median:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("invPoisson",[e.Constant(.5),n.args[0]])},stdev:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("sqrt",[n.args[0]])},var:function(e,r,n){return t.DistributionTable.poissondist.mean(e,r,n)},quantile:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("invPoisson",[r[0],n.args[0]])},random:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("poissonSample",[r[0],n.args[0]])}},binomialdist:{pdf:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("binompdf",r.concat(n.args))},cdf:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("binomcdf",r.concat(n.args))},mean:function(e,t,r){var n=e.getInstruction(t);return e.Multiply([n.args[0],n.args[1]])},median:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("invBinom",[e.Constant(.5),n.args[0],n.args[1]])},stdev:function(e,r,n){return e.SyntheticNativeFunction("sqrt",[t.DistributionTable.binomialdist.var(e,r,n)])},var:function(e,t,r){var n=e.getInstruction(t).args,i=n[0],a=n[1];return e.Multiply([i,e.Multiply([a,e.Subtract([e.Constant(1),a])])])},quantile:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("invBinom",[r[0],n.args[0],n.args[1]])},random:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("binomSample",[r[0],n.args[0],n.args[1]])}},uniformdist:{pdf:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("uniformpdf",r.concat(n.args))},cdf:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("uniformcdf",r.concat(n.args))},mean:function(e,t,r){var n=e.getInstruction(t);return e.Divide([e.Add([n.args[0],n.args[1]]),e.Constant(2)])},median:function(e,r,n){return t.DistributionTable.uniformdist.mean(e,r,n)},stdev:function(e,r,n){return e.SyntheticNativeFunction("sqrt",[t.DistributionTable.uniformdist.var(e,r,n)])},var:function(e,t,r){var n=e.getInstruction(t),i=e.Subtract([n.args[1],n.args[0]]);return e.Divide([e.Multiply([i,i]),e.Constant(12)])},quantile:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("invUniform",[r[0],n.args[0],n.args[1]])},random:function(e,t,r){var n=e.getInstruction(t);return e.SyntheticNativeFunction("uniformSample",[r[0],n.args[0],n.args[1]])}}},t.randomSampleFromList=function(e,t,n){var i=n[0],a=e.Constant(0),o=e.Constant(1);if(0===r.getConstantListLength(e,t))return e.Constant(NaN);var s=r.listLengthIndex(e,t);return e.InboundsListAccess([t,e.Add([e.SyntheticNativeFunction("floor",[e.Multiply([e.SyntheticNativeFunction("uniformSample",[i,a,o]),s])]),o])])}});r("core/math/ir/features/depends-on-instruction",["require","exports","../instructions"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dependsOnInstruction=void 0,t.dependsOnInstruction=function(e,t,n){if(t===n)return!0;if(t<n)return!1;for(var i=[!0],a=n+1;a<=t;a++)i.push(!1);for(var o=[t];o.length;){if(!i[(a=o.pop())-n]){i[a-n]=!0;var s=e.getInstruction(a);if(!r.isLeafInstruction(s))for(var u=0,c=s.args;u<c.length;u++){var l=c[u];if(l===n)return!0;l<n||(i[l-n]||o.push(l))}}}return!1}});r("core/math/cache-stats",["require","exports"],function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.markCacheRead=t.markCacheWrite=t.markCacheMiss=t.markCacheHit=t.setCacheStatStore=void 0,t.setCacheStatStore=function(e){r=e},t.markCacheHit=function(){r&&(r.cacheHits+=1)},t.markCacheMiss=function(){r&&(r.cacheMisses+=1)},t.markCacheWrite=function(){r&&(r.cacheWrites+=1)},t.markCacheRead=function(){r&&(r.cacheReads+=1)}});r("core/math/ir/build-ir",["require","exports","parsenodes","core/math/builtinframe","core/math/errormsg","./scope","./chunk","core/math/types","core/math/maybe-rational","./opcodes","./builtin-table","./features/list-length","./features/is-constant","./features/type-check","./distribution-table","./features/fuse-broadcast","./features/find-dependency-symbols","./features/element-at","./features/take-derivative","./features/substitute","./features/convert-to-broadcast","./features/copy-instruction","./features/depends-on-instruction","./dependencies","../cache-stats","./features/nan-of-type"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f,h,y,m,v,g,b,x,S,T,w,_,I){"use strict";function E(e,t,r,n,i){return{policy:e,frame:t,chunk:r,scope:n,parentNode:i}}function C(e){var t=e.policy,r=e.frame,n=e.argNames,i=e.argTypes,s=new o.Chunk({argNames:n,argTypes:i});return E(t,r,s,function(e){for(var t=a.Scope({},-1),r=0;r<e.argNames.length;r++)a.setSymbol(t,e.argNames[r],r);return t}(s),void 0)}function M(e,t,r){if("FunctionDefinition"===t.type)for(var n=0,a=r;n<a.length;n++){var o=a[n];if(-1!==t._argSymbols.indexOf(o)||t._symbol===o)throw i.updateRuleLocalLHS(o);if(t._sybmol===o)throw i.updateRuleFunctionLHS(o)}for(var u=[],c=0,l=r;c<l.length;c++){o=l[c];e.frame[o]||u.push(o)}if(u.length){var p=z(e,u[0]).setDependencies(e.chunk.argNames.concat(u));throw e.chunk.isConstant()&&e.chunk.getReturnType()===s.Action&&p.setActionValue(e.chunk.asValue()),p}}function k(e,t){var o;if(_.markCacheRead(),N(e.frame,t))_.markCacheHit(),o=e.chunk.copyInstruction(t.__IRCache.instruction);else{_.markCacheMiss();var l=e.chunk.instructionsLength(),h=e.policy,m=e.frame,v=e.chunk,S=e.scope,C=e.parentNode;if(o=function(e,t){var o=e.policy,l=e.frame,h=e.chunk,m=e.scope,v=e.parentNode;switch(t.type){case"Constant":var S=t._constantValue,_="boolean"==typeof S?s.Bool:s.Number;return h.ConstantOfType(_,S);case"MixedNumber":return h.Constant(t._constantValue);case"Negative":return h.Negative(function(e,t){return[k(e,t[0])]}(e,t.args));case"Add":return h.Add(A(e,t.args));case"Subtract":return h.Subtract(A(e,t.args));case"Multiply":return h.Multiply(A(e,t.args));case"Divide":return h.Divide(A(e,t.args));case"Exponent":return h.Exponent(A(e,t.args));case"Comparator['=']":return h.Equal(A(e,t.args));case"Comparator['>']":return h.Greater(A(e,t.args));case"Comparator['<']":return h.Less(A(e,t.args));case"Comparator['>=']":return h.GreaterEqual(A(e,t.args));case"Comparator['<=']":return h.LessEqual(A(e,t.args));case"And":return h.And(A(e,t.args));case"PercentOf":return h.Divide([h.Multiply(A(e,t.args)),h.Constant(100)]);case"ParenSeq":return function(e,t){for(var r,n,a,o,u=e.chunk,c=e.policy,l=D(e,t.args),p=!1,d=0;d<l.length;d++){var f=u.getInstruction(l[d]).valueType;if(f===s.Action){if(p=!0,void 0!==o)throw i.combineTypeError([s.prettyPrint(o),s.prettyPrint(s.Action)])}else{if(p)throw i.combineTypeError([s.prettyPrint(s.Action),s.prettyPrint(f)]);o=f}}if(p)return V(e,l);var h=null!==(a=null===(n=(r=c).dimensions)||void 0===n?void 0:n.call(r))&&void 0!==a?a:2;if(2!==h)throw new Error("3D points not implemented.");if(l.length!==h)throw i.badTupleDimensions(h);return u.OrderedPair(l)}(e,t);case"BareSeq":return function(e,t){var r=e.chunk,n=D(e,t.args);if(n.length<2)throw i.unexpectedSymbol(",");for(var a=r.getInstruction(n[0]).valueType,o=1;o<n.length;o++){var u=r.getInstruction(n[o]).valueType;if(a!==u)throw i.combineTypeError([s.prettyPrint(a),s.prettyPrint(u)])}if(a===s.Number)throw 2===n.length?i.malformedPoint():i.malformedList();return a===s.Action?V(e,n):r.List(n)}(e,t);case"OrderedPairAccess":return h.OrderedPairAccess(A(e,t.args));case"UpdateRule":var C=l[ne=t._symbol];if(C){if(C.isError)throw C;if("Assignment"!==C.type&&"Slider"!==C.type)throw z(e,ne)}return h.Action([ne],[k(e,t.args[1])]);case"List":if(t.getDependencies().length>0)return h.List(D(e,t.args));if(0===t.args.length)return h.ConstantOfType(s.EmptyList,[]);for(var M=h.instructionsLength(),P=[],O=void 0,L=void 0,N=0,F=t.args;N<F.length;N++){var q=k(e,F[N]),B=h.getInstruction(q);if(void 0===O){if(O=B.valueType,!s.hasListType(O))throw i.listTypeError([s.prettyPrint(O)]);L=s.listType(O)}else if(B.valueType!==O)throw i.heterogeneousList();if(B.type!==c.Constant)throw new Error("Programming error: expected list with no dependencies to constant collapse.");P.push(B.value),h.truncate(M)}return h.ConstantOfType(L,P);case"ListAccess":var U=k(e,t.args[0]),G=h.getInstruction(U);if("Range"===t.args[1].type&&0===t.args[1].args[1].length){if(!s.isList(G.valueType))throw i.indexTypeError([s.prettyPrint(G.valueType),s.prettyPrint(s.Number)]);var W=p.listLengthIndex(h,U),K=j(e,k(e,t.args[1].args[0]),h.List([W]),{stepMustBePositive:!0});return h.ListAccess([U,K])}K=k(e,t.args[1]);var H=h.getInstruction(K);if(!s.isList(G.valueType))throw i.indexTypeError([s.prettyPrint(G.valueType),s.prettyPrint(H.valueType)]);return H.valueType===s.ListOfBool?h.SyntheticNativeFunction("select",[U,K]):h.ListAccess([U,K]);case"Range":var J=A(e,t.args);return j(e,J[0],J[1],{stepMustBePositive:!1});case"ListComprehension":return function(e,t){for(var r=e.policy,n=e.frame,o=e.chunk,u=e.scope,l=e.parentNode,d=t._body,f=[],h=o.Constant(1),y=Object.create(n),m=0,v=t._inputLists;m<v.length;m++){var g=v[m]._symbol;y[g]=i.badListComprehensionInputDependency(g)}for(var b=a.childScope(u),x=t._inputLists.length-1;x>=0;x--){var S=t._inputLists[x],T=S._symbol,_=k(E(r,y,o,b,l),S.args[1]),I=o.getInstruction(_);if(!s.isList(I.valueType))throw i.listComprehensionInputListTypeError(T,s.prettyPrint(I.valueType));var C=p.listLengthIndex(o,_);f.push({symbol:T,assignedList:_,lengthIndex:C}),h=o.Multiply([h,C])}var M=o.Constant(1),P=o.BeginBroadcast([h],{inputListSymbols:f.map(function(e){return e.symbol})}),O=a.childScope(u);a.setSymbol(O,t._index._symbol,P);var L=M;for(x=f.length-1;x>=0;x--){var N=f[x],A=(T=N.symbol,_=N.assignedList,C=N.lengthIndex,void 0);if(1===f.length)A=P;else{var D=o.SyntheticNativeFunction("floor",[o.Divide([o.Subtract([P,M]),L])]);A=o.Add([o.SyntheticNativeFunction("mod",[D,C]),M]),x>0&&(L=o.Multiply([L,C]))}var R=a.getSymbol(O,T);if(void 0!==n[T]||void 0!==R&&o.getInstruction(R).type!==c.LoadArg)throw i.shadowedListComprehensionInput(T);a.setSymbol(O,T,o.ListAccess([_,A]))}for(var F=Object.create(n),q=0,B=f;q<B.length;q++){F[B[q].symbol]=w.FRAME_SENTINEL}var V=k(E(r,F,o,O,l),d),z=o.getInstruction(V);if(!s.hasListType(z.valueType))throw i.listTypeError([s.prettyPrint(z.valueType)]);var j=o.EndBroadcast([P,V]);return o.BroadcastResult(s.listType(z.valueType),[j])}(e,t);case"Piecewise":var Y=function(e,t){return[k(e,t[0]),k(e,t[1]),k(e,t[2])]}(e,t.args),$=h.getInstruction(Y[0]),X=h.getInstruction(Y[1]),Z=h.getInstruction(Y[2]);if($.type===c.Constant&&$.valueType===s.Bool&&s.typesMatch(X.valueType,Z.valueType)){var Q=Y[$.value?1:2],ee=h.getInstruction(Q),te=X.valueType!==s.EmptyList?X.valueType:Z.valueType;return ee.valueType===s.EmptyList&&te!==s.EmptyList?h.ConstantOfType(te,[]):Q}if(!s.typesMatch(X.valueType,Z.valueType)&&d.isConstant(Z)&&Z.valueType===s.Number&&u.isNanFloat(Z.value)&&I.isNanableValueType(X.valueType)){var re=h.NanOfType(X.valueType);Y=[Y[0],Y[1],re]}return h.Piecewise(Y);case"Ans":case"Identifier":var ne=t._symbol,ie=t._errorSymbol;if("Ans"===t.type&&-1!==h.argNames.indexOf(ne))throw i.ansUndefined();K=a.getSymbol(m,ne);var ae=l[ne];if(void 0!==K){if(m.symbolMap.hasOwnProperty(ne))return K;if(void 0===ae||ae===w.FRAME_SENTINEL)return K}if(void 0===ae){if(n[t._symbol])throw n[t._symbol].isFunction?i.functionUnsupported(ie):i.constantUnsupported(ie);throw new Error("Programming Error: reached undefined symbol "+ne)}if(ae.isError)throw ae;if(ae.isFunction)throw i.identifierAsFunction(ie);var oe=k(E(o,l,h,m,void 0),ae);return a.setSymbol(m,ne,oe),oe;case"FunctionCall":case"SeededFunctionCall":Y=D(e,t.args);return R(e,t._symbol,t._errorSymbol,Y);case"FunctionExponent":return l[tt=t.args[0]._symbol]&&l[tt].isFunction?k(e,r.Exponent([r.FunctionCall(tt,[t.args[1]]),t.args[2]])):k(e,r.Multiply([t.args[0],r.Exponent([t.args[1],t.args[2]])]));case"FunctionFactorial":return l[tt=t.args[0]._symbol]&&l[tt].isFunction?k(e,r.FunctionCall("\\factorial",[r.FunctionCall(tt,[t.args[1]])])):k(e,r.Multiply([t.args[0],r.FunctionCall("\\factorial",[t.args[1]])]));case"DotAccess":var se=t.args[0],ue=t.args[1];if(("Identifier"===ue.type||"FunctionCall"===ue.type)&&l[ue._symbol]&&l[ue._symbol].isFunction)return R(e,ne=ue._symbol,ie=ue._errorSymbol,Y=D(e,"Identifier"===ue.type?[se]:[se].concat(ue.args)),{dotLHSIndex:Y[0]});if("SeededFunctionCall"===ue.type)return R(e,ne=ue._symbol,ie=ue._errorSymbol,Y=D(e,[ue.seed,se].concat(ue.args.slice(1))),{dotLHSIndex:Y[1]});throw i.unexpectedSymbol(".");case"Seed":return h.ConstantOfType(s.SeedType,t._stringValue);case"ExtendSeed":return h.ExtendSeed(t.tag,A(e,t.args));case"Integral":var ce=t._differential._symbol,le=a.getSymbol(m,ce);if(void 0!==l[ce]||void 0!==le&&h.getInstruction(le).type!==c.LoadArg)throw i.shadowedIntegrationVariable(ce);(Ce=Object.create(l))[ce]=i.badIntegralBoundDependency(ce);var pe=k(ke=E(o,Ce,h,a.childScope(m),v),t.args[1]),de=k(ke,t.args[2]),fe=h.getInstruction(pe),he=h.getInstruction(de),ye=h.SymbolicVar(s.Number,ce),me=a.childScope(m);a.setSymbol(me,ce,ye);var ve=Object.create(l);ve[ce]=w.FRAME_SENTINEL;var ge=k(E(o,ve,h,me,v),t.args[3]);if(!T.dependsOnInstruction(h,ge,ye))return h.Multiply([ge,h.Subtract([de,pe])]);var be=pe;void 0!==(Ve=void 0!==(Re=p.minListLengthIndex(h,[pe,de,ge]))?h.BeginBroadcast([Re]):void 0)&&s.isList(fe.valueType)&&(be=x.deferredOrInboundsAccess(h,pe,Ve));var xe=de;void 0!==Ve&&s.isList(he.valueType)&&(xe=x.deferredOrInboundsAccess(h,de,Ve));var Se=h.BeginIntegral({indexSymbol:ce},[be,xe]),Te=b.substitute(h,Se,ye,ge),we=h.getInstruction(Te);void 0!==Ve&&s.isList(we.valueType)&&(Te=x.deferredOrInboundsAccess(h,Te,Ve));var _e=h.EndIntegral([Se,Te]),Ie=h.BlockVar(s.Number,[_e]);if(void 0!==Ve){var Ee=h.EndBroadcast([Ve,Ie]);return h.BroadcastResult(s.ListOfNumber,[Ee])}return Ie;case"Sum":case"Product":ce=t._index._symbol,le=a.getSymbol(m,ce);if(void 0!==l[ce]||void 0!==le&&h.getInstruction(le).type!==c.LoadArg)throw i.shadowedIndex(ce);var Ce,Me="Sum"===t.type;(Ce=Object.create(l))[ce]=Me?i.badSumBoundDependency(ce):i.badProductBoundDependency(ce);var ke,Pe=k(ke=E(o,Ce,h,a.childScope(m),v),t.args[1]),Oe=k(ke,t.args[2]);if(!f.argIsTypeOrListOfType(h,Pe,s.Number)){var Le=f.extractScalarValueTypes(h,[Pe]);throw Me?i.sumLowerBoundTypeError(Le):i.productLowerBoundTypeError(Le)}if(!f.argIsTypeOrListOfType(h,Oe,s.Number)){Le=f.extractScalarValueTypes(h,[Oe]);throw Me?i.sumUpperBoundTypeError(Le):i.productUpperBoundTypeError(Le)}pe=h.SyntheticNativeFunction("round",[Pe]),de=h.SyntheticNativeFunction("round",[Oe]),fe=h.getInstruction(pe),he=h.getInstruction(de);if(fe.type===c.Constant&&fe.valueType===s.Number&&!isFinite(u.asFloat(fe.value)))throw Me?i.sumInfiniteBoundError():i.productInfiniteBoundError();if(he.type===c.Constant&&he.valueType===s.Number&&!isFinite(u.asFloat(he.value)))throw Me?i.sumInfiniteBoundError():i.productInfiniteBoundError();var Ne=h.SymbolicVar(s.Number,ce),Ae=a.childScope(m);a.setSymbol(Ae,ce,Ne);var De=Object.create(l);De[ce]=w.FRAME_SENTINEL;var Re,Fe=k(E(o,De,h,Ae,v),t.args[3]);if(!T.dependsOnInstruction(h,Fe,Ne)){var qe=h.Add([h.Subtract([de,pe]),h.Constant(1)]);qe=h.SyntheticNativeFunction("max",[qe,h.Constant(0)]);var Be=Me?h.Multiply([Fe,qe]):h.Exponent([Fe,qe]);return h.Piecewise([h.Less([qe,h.Constant(1/0)]),Be,h.Constant(NaN)])}if(!f.argIsTypeOrListOfType(h,Fe,s.Number)){Le=f.extractScalarValueTypes(h,[Fe]);throw Me?i.sumArgumentTypeError(Le):i.productArgumentTypeError(Le)}if(void 0!==(Re=p.minListLengthIndex(h,[pe,de,Fe]))&&T.dependsOnInstruction(h,Re,Ne))throw Me?i.variableLengthSumBodyDependsOnIndex(ce):i.variableLengthProductBodyDependsOnIndex(ce);var Ve;be=pe;void 0!==(Ve=void 0!==Re?h.BeginBroadcast([Re]):void 0)&&s.isList(fe.valueType)&&(be=x.deferredOrInboundsAccess(h,pe,Ve));xe=de;null!=Ve&&s.isList(he.valueType)&&(xe=x.deferredOrInboundsAccess(h,de,Ve));var ze=h.Constant(Me?0:1),je=(Se=h.BeginLoop({type:Me?"sum":"product",indexSymbol:ce},[be,xe,ze]),h.BlockVar(s.Number,[Se])),Ue=b.substitute(h,Se,Ne,Fe),Ge=h.getInstruction(Ue);void 0!==Ve&&s.isList(Ge.valueType)&&(Ue=x.deferredOrInboundsAccess(h,Ue,Ve));var We=Me?h.Add([je,Ue]):h.Multiply([je,Ue]),Ke=(_e=h.EndLoop([Se,We]),h.BlockVar(s.Number,[_e]));if(void 0!==Ve){Ee=h.EndBroadcast([Ve,Ke]);return h.BroadcastResult(s.ListOfNumber,[Ee])}return Ke;case"Derivative":var He=k(e,r.Identifier(t._symbol));if(!f.argIsTypeOrListOfType(h,He,s.Number))throw i.derivativeVariableTypeError(t._symbol,f.extractScalarValueTypes(h,[He]));var Je=void 0,Ye=void 0;if((rt=h.getInstruction(He)).type===c.LoadArg&&rt.valueType===s.Number)Je=e,Ye=He;else{var $e=a.childScope(m);Ye=h.SymbolicVar(rt.valueType),a.setSymbol($e,t._symbol,Ye);var Xe=Object.create(l);Xe[t._symbol]=w.FRAME_SENTINEL,Je=E(o,Xe,h,$e,v)}for(var Ze=1;"Derivative"===t.args[0].type&&t.args[0]._symbol===t._symbol;)Ze+=1,t=t.args[0];for(var Qe=y.fuseBroadcast(h,k(Je,t.args[0])),et=0;et<Ze;et++)Qe=g.takeDerivative(h,Qe,Ye);return Ye===He?Qe:b.substitute(h,He,Ye,Qe);case"Prime":var tt;if(!l[(tt=t.args[0])._symbol])throw i.functionNotDefined(tt._symbol);var rt;He=k(e,tt.args[0]),Ye=void 0;Ye=(rt=h.getInstruction(He)).type===c.LoadArg&&rt.valueType===s.Number?He:h.SymbolicVar(rt.valueType);Y=void 0;if("logbase"===tt._symbol){if(2!==tt.args.length)throw i.primedFunctionArity();Y=[Ye,k(e,tt.args[1])]}else{if(1!==tt.args.length)throw i.primedFunctionArity();Y=[Ye]}Qe=y.fuseBroadcast(h,R(e,tt._symbol,tt._errorSymbol,Y));for(var nt=0;nt<t.order;nt++)Qe=g.takeDerivative(h,Qe,Ye);return Ye===He?Qe:b.substitute(h,He,Ye,Qe);case"Slider":return e.chunk.Constant(t.getConcreteTree(o,l).asCompilerValue());case"Assignment":return k(e,t._expression);case"FunctionDefinition":for(var it=0;it<t._argSymbols.length;it++){if(l[t._argSymbols[it]])throw i.parameterAlreadyDefined(t._argSymbols[it]);if(t._argSymbols[it]===t._symbol)throw i.parameterAlreadyDefined(t._argSymbols[it])}return k(e,t._expression);default:throw new Error("Programming error, unimplemented node type "+t.type)}}(E(h,m,v,S,t),t),!O(t,C)){var M=v.getInstruction(o);M.type===c.BroadcastResult&&M.isConstantBroadcast&&(o=y.fuseBroadcast(v,o))}L(e,t,o=P(e,l,o))}return e.chunk.returnIndex=o,o}function P(e,t,r){var n=e.chunk,i=e.scope;if(r<=t)return r;var a=n.getInstruction(r);return d.isConstant(a)?(n.truncate(Math.max(t,i.maxIndex+1)),S.copyInstruction(n,a)):r}function O(e,t){if(!t)return!1;if(!e.getScope||!t.getScope)return!1;var r=t.getScope().dependencies,i=e.getScope().dependencies;if(i.length===r.length)return!0;for(var a=0,o=0,s=i;o<s.length;o++){var u=s[o];n[u]||(a+=1)}for(var c=0,l=0,p=r;l<p.length;l++){u=p[l];n[u]||(c+=1)}return a===c}function L(e,t,r){var n=e.frame,i=e.chunk,a=e.parentNode,o=i.getInstruction(r);if(d.isConstant(o)&&!O(t,a)){var s=w.getCacheKeys(n,t);s&&(_.markCacheWrite(),t.__IRCache={keys:s,instruction:o})}}function N(e,t){if(!t.__IRCache)return!1;for(var r=0,n=t.__IRCache.keys;r<n.length;r++){var i=n[r],a=i[0],o=i[1];if(e[a]!==o)return!1}return!0}function A(e,t){return[k(e,t[0]),k(e,t[1])]}function D(e,t){for(var r=[],n=0,i=t;n<i.length;n++){var a=i[n];r.push(k(e,a))}return r}function R(e,t,o,g,b){var x=e.policy,S=e.frame,T=e.chunk,_=e.scope,I=e.parentNode,C=a.getSymbol(_,t);if(void 0!==C){if(1==g.length)return T.Multiply([C,g[0]]);throw T.getInstruction(C).type===c.LoadArg?i.functionNotDefined(o):T.getInstruction(C).valueType===s.Distribution?i.distributionAsFunction(o):i.variableAsFunction(o)}var M=S[t];if(M&&M.isError)throw M;if(void 0===M||!M.isFunction){if(n[t]&&n[t].isFunction){if("logbase"===t&&S.ln&&S.log)throw i.logbaseUnsupported();throw i.functionUnsupported(o)}if(M){var P=k(e,M);if(T.getInstruction(P).valueType===s.Distribution)throw i.distributionAsFunction(o)}if(1==g.length)return T.Multiply([k(e,r.Identifier(t)),g[0]]);throw M?i.variableAsFunction(o):new Error("Programming Error: reached undefined symbol "+t)}if("FunctionDefinition"===M.type){if(b&&void 0!==b.dotLHSIndex)throw i.illegalDotCall(o);if(g.length!==M._argSymbols.length)throw i.wrongArity(o,M._argSymbols.length,g.length);for(var O=a.childScope(_),L=Object.create(S),N=0;N<M._argSymbols.length;N++)a.setSymbol(O,M._argSymbols[N],g[N]),L[M._argSymbols[N]]=w.FRAME_SENTINEL;return k(E(x,L,T,O,I),M._expression)}if(l.CompilerFunctionTable.hasOwnProperty(t))return function(e,t,r,n,a){var o=e.chunk,g=!(!a||void 0===a.dotLHSIndex),b=l.CompilerFunctionTable[t];if(b.fallthroughUnlessDistribution&&(0===n.length||o.getInstruction(n[0]).valueType===s.EmptyList||!s.isTypeOrListOfType(o.getInstruction(n[0]).valueType,s.Distribution)))return q(e,t,r,n,a);var x=b.minArity,S=b.maxArity,T=b.allowDotCall;if(a&&void 0!==a.dotLHSIndex){if(!T)throw i.illegalDotCall(r);F(o,a.dotLHSIndex,"."+r)}var w,_=n.length;if(_<x)throw function(e,t,r,n,a){var o=a.isDotCall;o&&(r-=1,n-=1,t="."+t);var s=l.CompilerFunctionTable[e];s.isSeeded&&(r-=1,n-=1);var u=void 0;o&&s.dotMinArityExampleArgs?u=t+s.dotMinArityExampleArgs:s.minArityExampleArgs&&(u=t+s.minArityExampleArgs);switch(e){case"pdf":return o?i.wrongArity(t,r,n,u):i.pdfWrongArity();case"cdf":return o?i.wrongArity(t,r,n,u):i.cdfRequiresArguments();case"tdist":return i.tdistWrongArity();case"random":return i.randomArity();case"round":case"midpoint":case"normaldist":case"poissondist":case"binomialdist":case"uniformdist":case"mean":case"median":case"stdev":case"var":case"quantile":case"sort":case"shuffle":case"join":case"unique":case"polygon":return i.wrongArity(t,r,n,u);case"histogram":case"dotplot":case"boxplot":case"ttest":case"ittest":case"stats":case"det":case"inv":case"transpose":case"rref":case"trace":throw i.parseError();default:throw new Error("Unexpected compiler function "+e)}}(t,r,x,_,{isDotCall:g});if(_>S)throw function(e,t,r,n,a){var o=a.isDotCall;o&&(r-=1,n-=1,t="."+t);var s=l.CompilerFunctionTable[e];s.isSeeded&&(r-=1,n-=1);var u=void 0;o&&s.dotMaxArityExampleArgs?u=t+s.dotMaxArityExampleArgs:s.maxArityExampleArgs&&(u=t+s.maxArityExampleArgs);switch(e){case"pdf":return o?i.wrongArity(t,r,n,u):i.pdfWrongArity();case"cdf":return o?i.wrongArity(t,r,n,u):i.cdfTooManyArguments();case"tdist":return i.tdistWrongArity();case"random":return i.randomArity();case"round":case"midpoint":case"normaldist":case"poissondist":case"binomialdist":case"uniformdist":case"mean":case"median":case"stdev":case"var":case"quantile":case"sort":case"shuffle":case"join":case"unique":case"polygon":return i.wrongArity(t,r,n,u);case"histogram":case"dotplot":case"boxplot":case"ttest":case"ittest":case"stats":case"det":case"inv":case"transpose":case"rref":case"trace":throw i.parseError();default:throw new Error("Unexpected compiler function "+e)}}(t,r,S,_,{isDotCall:g});if("cdf"===t)w=2===_?[n[0],o.Constant(-1/0),n[1]]:n;else if("random"===t)if(1===_||_<4&&!s.isList(o.getInstruction(n[1]).valueType)&&o.getInstruction(n[1]).valueType!==s.Distribution){var I=o.Distribution("uniformdist",[o.Constant(0),o.Constant(1)]);w=[n[0],I].concat(n.slice(1))}else w=n;else w=B(o,n,b);switch(t){case"round":if(1===w.length)return o.SyntheticNativeFunction("round",w);if(!f.argIsTypeOrListOfType(o,w[0],s.Number)||!f.argIsTypeOrListOfType(o,w[1],s.Number))throw i.functionTypeError(r,f.extractScalarValueTypes(o,w));var E=o.SyntheticNativeFunction("round",[w[1]]),C=o.RawExponent([o.Constant(10),E]);return o.Divide([o.SyntheticNativeFunction("round",[o.Multiply([w[0],C])]),C]);case"midpoint":if(!f.argIsTypeOrListOfType(o,w[0],s.Point)||!f.argIsTypeOrListOfType(o,w[1],s.Point))throw i.functionTypeError(r,f.extractScalarValueTypes(o,w));var M=o.Constant(u.maybeRational(1,2));return o.Multiply([M,o.Add(w)]);case"normaldist":case"tdist":case"poissondist":case"binomialdist":case"uniformdist":for(var k=0,P=w;k<P.length;k++){var O=P[k];if(!f.argIsTypeOrListOfType(o,O,s.Number))throw i.functionTypeError(r,f.extractScalarValueTypes(o,n))}return o.Distribution(t,w);case"pdf":case"cdf":case"mean":case"median":case"stdev":case"var":case"quantile":var L=w[0],N=o.getInstruction(L);if(!s.isTypeOrListOfType(N.valueType,s.Distribution))throw i.functionTypeError(r,f.extractScalarValueTypes(o,n));for(var A=w.slice(1),D=0,R=A;D<R.length;D++){O=R[D];if(!s.isTypeOrListOfType(o.getInstruction(O).valueType,s.Number))throw i.functionTypeError(r,f.extractScalarValueTypes(o,n))}if(s.isList(N.valueType)){for(var V=[],z=1/0,U=0,G=w;U<G.length;U++){O=G[U];var W=y.fuseBroadcast(o,O);V.push(W);var K=o.getInstruction(W);if(s.isList(K.valueType)){if(void 0===(oe=p.getConstantListLength(o,W)))throw i.variableLengthDistributionList(m.findDependencySymbols(o,W));z=Math.min(z,oe)}}for(var H=[],J=0;J<z;J++){var Y=v.elementAt(o,V[0],J),$=o.getInstruction(Y);if($.type!==c.Distribution)throw i.parseError();for(var X=[],Z=0,Q=V.slice(1);Z<Q.length;Z++){O=Q[Z];s.isList(o.getInstruction(O).valueType)?X.push(v.elementAt(o,O,J)):X.push(O)}H.push(h.DistributionTable[$.symbol][t](o,Y,X))}return o.List(H)}if(N.type!==c.Distribution)throw i.parseError();return h.DistributionTable[N.symbol][t](o,L,A);case"random":var ee=w[0],te=(L=w[1],o.getInstruction(w[0]));N=o.getInstruction(L);if(te.valueType!==s.SeedType)throw i.parseError();if(N.valueType===s.ListOfDistribution)throw i.randomFromBroadcastDistribution();var re=void 0;if(s.isList(N.valueType))re=h.randomSampleFromList;else{if(N.valueType!==s.Distribution)throw i.randomArity();if(N.type!==c.Distribution)throw i.parseError();re=h.DistributionTable[N.symbol][t]}if(w.length>2){var ne=w[2];if(o.getInstruction(ne).valueType!==s.Number)throw i.randomArity();if(4===w.length){var ie=o.getInstruction(w[3]);if(ie.valueType!==s.Number)throw i.randomArity();if(!d.isConstant(ie))throw i.variableSeed(m.findDependencySymbols(o,w[3]));ee=o.ExtendSeed("us",[ee,w[3]])}var ae=o.Constant(1),oe=o.SyntheticNativeFunction("round",[o.SyntheticNativeFunction("validateSampleCount",[ne])]),se=o.BeginBroadcast([oe]);ee=o.ExtendSeed("lc",[ee,o.Subtract([se,ae])]);var ue=re(o,L,[ee]),ce=o.EndBroadcast([se,ue]);return o.BroadcastResult(s.listType(o.getInstruction(ue).valueType),[ce])}return re(o,L,[ee]);case"shuffle":ee=w[0];var le=w[1],pe=w[2];if(!s.isList(o.getInstruction(le).valueType)||void 0!==pe&&o.getInstruction(pe).valueType!==s.Number)throw i.functionTypeError(r,f.extractValueTypes(o,n.slice(1)));if(void 0!==pe){if(!d.isConstant(o.getInstruction(pe)))throw i.variableSeed(m.findDependencySymbols(o,pe));ee=o.ExtendSeed("us",[ee,pe])}return o.SyntheticNativeFunction("shuffle",[ee,le]);case"sort":var de=2===w.length?w[1]:w[0],fe=o.getInstruction(de);if(!s.isList(o.getInstruction(w[0]).valueType)||fe.valueType!==s.ListOfNumber&&fe.valueType!==s.EmptyList)throw i.functionTypeError(r,f.extractValueTypes(o,n));if(0===p.getConstantListLength(o,de))return de;var he=o.SyntheticNativeFunction("min",[p.listLengthIndex(o,w[0]),p.listLengthIndex(o,de)]);return de=o.ListAccess([de,j(e,o.List([o.Constant(1)]),o.List([he]),{stepMustBePositive:!0})]),o.SyntheticNativeFunction("elementsAt",[w[0],o.SyntheticNativeFunction("sortPerm",[de])]);case"join":for(var ye=[],me=!0,ve=0,ge=w;ve<ge.length;ve++){O=ge[ve];var be=o.getInstruction(O);d.isConstantOrConstantBroadcast(be)||(me=!1);var xe=be.valueType;if(xe!==s.EmptyList)if(s.isList(xe))ye.push({isList:!0,index:O,elementType:s.elementType(xe)});else{if(!s.hasListType(xe))throw i.functionTypeError(r,f.extractValueTypes(o,n));ye.push({isList:!1,index:O,elementType:xe})}}if(0===ye.length)return o.ConstantOfType(s.EmptyList,[]);for(var Se=0,Te=ye;Se<Te.length;Se++){if((Ee=Te[Se]).elementType!==ye[0].elementType)throw i.functionTypeError(r,f.extractValueTypes(o,n))}if(me){for(var we=[],_e=0,Ie=ye;_e<Ie.length;_e++){var Ee=Ie[_e],Ce=o.getInstruction(y.fuseBroadcast(o,Ee.index));d.assertConstant(Ce),Ee.isList?we.push.apply(we,Ce.value):we.push(Ce.value)}return o.ConstantOfType(s.listType(ye[0].elementType),we)}for(var Me=o.Constant(0),ke=o.Constant(1),Pe={},Oe=0,Le=ye;Oe<Le.length;Oe++){(Ee=Le[Oe]).isList&&void 0===Pe[Ee.index]&&(Pe[Ee.index]=p.listLengthIndex(o,Ee.index))}for(var Ne=o.SyntheticNativeFunction("total",ye.map(function(e){return e.isList?Pe[e.index]:ke})),Ae=(se=o.BeginBroadcast([Ne]),Me),De=[],Re=[],Fe=0,qe=ye;Fe<qe.length;Fe++){var Be=(Ee=qe[Fe]).isList?o.ListAccess([Ee.index,o.Subtract([se,Ae])]):Ee.index;if(Re.push(Be),Ee!==ye[ye.length-1]){oe=Ee.isList?Pe[Ee.index]:ke;Ae=o.Add([Ae,oe]),De.push(o.LessEqual([se,Ae]))}}var Ve=Re[Re.length-1];for(J=Re.length-2;J>=0;J--)Ve=o.Piecewise([De[J],Re[J],Ve]);ce=o.EndBroadcast([se,Ve]);return o.BroadcastResult(s.listType(ye[0].elementType),[ce]);case"unique":var ze=w[0],je=o.getInstruction(ze);if(!s.isList(je.valueType)||je.valueType===s.ListOfDistribution)throw i.functionTypeError("unique",[s.prettyPrint(je.valueType)]);return o.SyntheticNativeFunction("elementsAt",[ze,o.SyntheticNativeFunction("uniquePerm",[ze])]);case"polygon":var Ue=void 0,Ge=w.map(function(e){return o.getInstruction(e)});if(1===Ge.length){if((je=Ge[0]).valueType!==s.ListOfPoint)throw i.polygonListTypeError([s.prettyPrint(je.valueType)]);Ue=w[0]}else if(2===Ge.length&&s.isTypeOrListOfType(Ge[0].valueType,s.Number)&&s.isTypeOrListOfType(Ge[1].valueType,s.Number)){if(Ge[0].valueType===s.Number&&Ge[1].valueType===s.Number)throw i.polygonTwoNumbersError();Ue=o.OrderedPair(w)}else{if(!Ge.every(function(e){return e.valueType===s.Point}))throw i.polygonPointArgsError();Ue=o.List(w)}return o.SyntheticNativeFunction("polygon",[Ue]);case"histogram":case"dotplot":case"boxplot":case"ttest":case"ittest":case"stats":case"det":case"inv":case"transpose":case"rref":case"trace":throw i.unexpectedSymbol(r);default:throw new Error("Programming Error: unexpected compiler function "+t)}}(e,t,o,g,b);if(l.BuiltInTable.hasOwnProperty(t))return q(e,t,o,g,b);throw i.functionUnsupported(o)}function F(e,t,r){var n=e.getInstruction(t).valueType;if(!s.isList(n)&&n!==s.Distribution)throw i.dotLHSTypeError(r,s.prettyPrint(n))}function q(e,t,n,a,o){var s=e.chunk,u=l.BuiltInTable[t],c=!(!o||void 0===o.dotLHSIndex),p=a.length,d=u.minArity,f=u.maxArity,h=u.allowDotCall;if(o&&void 0!==o.dotLHSIndex){if(!h)throw i.illegalDotCall(n);F(s,o.dotLHSIndex,"."+n)}if("logbase"===t&&2!==p)throw i.wrongArity(n,1,p-1);if(p>f)throw c&&(d-=1,f-=1,p-=1,n="."+n),"doubleReducer"===u.tag?i.wrongDoubleReducerArity(n):"parameterizedReducer"===u.tag?i.wrongParameterizedReducerArity(n):"color"===u.tag?i.colorArity(n):i.wrongArity(n,f,p);if(p<d)throw c&&(d-=1,f-=1,p-=1,n="."+n),"reducer"===u.tag&&0===p?i.zeroArgReducer(n):"doubleReducer"===u.tag?i.wrongDoubleReducerArity(n):"parameterizedReducer"===u.tag?i.wrongParameterizedReducerArity(n):"color"===u.tag?i.colorArity(n):i.wrongArity(n,d,p);var y=B(s,a,u),m={errorSymbol:n,providedArity:p,isDotCall:c};switch(u.tag){case"default":case"reducer":case"doubleReducer":case"parameterizedReducer":case"color":case"never-broadcast":return s.NativeFunction(t,m,y);case"trig":var v=k(e,r.Identifier("trigAngleMultiplier")),g=s.Multiply([y[0],v]);return s.NativeFunction(t,m,[g]);case"inverseTrig":v=k(e,r.Identifier("trigAngleMultiplier"));var b=s.NativeFunction(t,m,y);return s.Divide([b,v]);default:var x=u.tag;throw new Error("Programming Error: unexpected tag "+x)}}function B(e,t,r){var n=r.minArity,i=r.defaultArguments;if(!i)return t;if(!(t.length-n<i.length))return t;for(var a=t.slice();a.length-n<i.length;)a.push(e.copyInstruction(i[a.length-n]));return a}function V(e,t){for(var r=e.chunk,n=[],a=[],o=0,s=t;o<s.length;o++){var u=s[o],l=r.getInstruction(u);switch(l.type){case c.Action:Array.prototype.push.apply(n,l.symbols),Array.prototype.push.apply(a,l.args);break;case c.Constant:var p=l.value.updateRules;for(var d in p)n.push(d),a.push(r.ConstantOfType(p[d].valueType,p[d].value));break;default:var f=m.findDependencySymbols(r,u);throw f.length>0?i.actionMergeFreeVariable(f):i.parseError()}}return r.Action(n,a)}function z(e,t){var r=e.frame[t];return e.policy.assignmentForbidden(t)?i.updateRuleIllegalLHS(t):r===w.FRAME_SENTINEL?i.updateRuleLocalLHS(t):r&&"FunctionDefinition"===r.type?i.updateRuleFunctionLHS(t):i.updateRuleUndefinedLHS(t).allowExport()}function j(e,t,r,n){var a,o=n.stepMustBePositive,u=e.chunk,c=u.getInstruction(t),l=u.getInstruction(r),d=p.assertConstantListLength(u,t,"Programming error: expected range start list to have constant length."),f=p.assertConstantListLength(u,r,"Programming error: expected range start list to have constant length.");if(c.valueType!==s.ListOfNumber||l.valueType!==s.ListOfNumber)throw i.nonArithmeticRange();var h=u.Constant(1),y=u.Constant(0),m=u.ListAccess([t,h]),v=u.ListAccess([t,u.Constant(2)]),g=u.ListAccess([r,u.Constant(f)]),b=u.Subtract([g,m]),x=d>1?u.Subtract([v,m]):u.Piecewise([u.GreaterEqual([b,y]),h,u.Constant(-1)]),S=u.Add([h,u.SyntheticNativeFunction("round",[u.Divide([b,x])])]),T=u.SyntheticNativeFunction("validateRangeLength",[t,r,x,S]);o&&(T=u.Piecewise([u.GreaterEqual([x,y]),T,y]));var w=u.BeginBroadcast([T]),_=u.Add([m,u.Multiply([x,u.Subtract([w,h])])]),I=u.EndBroadcast([w,_]);return u.addComments(((a={})[m]="start",a[v]="second",a[g]="last",a[S]="proposedLength",a[x]="step",a[_]="body",a)),u.BroadcastResult(s.listType(u.getInstruction(_).valueType),[I])}Object.defineProperty(t,"__esModule",{value:!0}),t.isCacheValid=t.maybeCacheIR=t.hasSameUserDependenciesAsParent=t.maybeDropIntermediates=t.addToIR=t.checkForUndefinedUpdateSymbols=t.buildIR=t.buildIRContext=t.Ctx=void 0,t.Ctx=E,t.buildIRContext=C,t.buildIR=function(e,t){var r=e.policy,n=e.frame,i=e.argNames,a=e.argTypes,o=w.analyzeDependencies(n,t),u=o.freeDependencies,c=o.updateSymbols;if(i||(i=u),!a){a=[];for(var l=0;l<i.length;l++)a.push(s.Number)}var p=C({policy:r,frame:n,argNames:i,argTypes:a});return k(p,t),e.wrapInList&&!s.isList(p.chunk.getReturnType())&&p.chunk.List([p.chunk.returnIndex]),p.chunk.close(),M(p,t,c),p.chunk},t.checkForUndefinedUpdateSymbols=M,t.addToIR=k,t.maybeDropIntermediates=P,t.hasSameUserDependenciesAsParent=O,t.maybeCacheIR=L,t.isCacheValid=N});r("core/math/features/buildIRExpression",["require","core/math/ir/build-ir","core/math/parsenode/base","core/math/parsenode/irexpression","core/math/errormsg","core/math/parsenode/error"],function(e){"use strict";var t=e("core/math/ir/build-ir").buildIR,r=e("core/math/parsenode/base"),n=e("core/math/parsenode/irexpression"),i=e("core/math/errormsg"),a=e("core/math/parsenode/error");r.prototype.buildIRExpression=function(e,a,o){try{var s=t({policy:e,frame:a,wrapInList:o&&o.wrapInList},this);return new n(s)}catch(e){return e instanceof r?e:i.parseError()}},a.prototype.buildIRExpression=function(){return this}});r("core/math/features/typeCheck",["require","parsenodes","core/math/types","core/math/errormsg"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/types"),n=e("core/math/errormsg"),i=r.isOneOf;function a(e){for(var t=[],n=0;n<e.length;n++)t.push(r.prettyPrint(e[n].valueType));return t}function o(e,t){var a=t.length,o=t[0];if(a<2)throw n.methodRequiresList(this._symbol);if(!i(o.valueType,[r.ListOfNumber,r.EmptyList]))throw n.methodRequiresList(this._symbol);if(a>2)throw n.tooManyArguments(this._symbol,2)}var s={Object3D:function(e,t){if(t.length<3)throw n.wrongArity(this._symbol,3,t.length)},Histogram:o,DotPlot:o,BoxPlot:function(e,t){var a=t.length,o=t[0];if(0===a)throw n.methodRequiresList(this._symbol);if(!i(o.valueType,[r.ListOfNumber,r.EmptyList]))throw n.methodRequiresList(this._symbol);if(a>1)throw n.methodRequiresList(this._symbol)},TTest:function(e,t){var i=this._symbol;if(0===t.length)throw n.methodRequiresList(i);if(t[0].valueType===r.EmptyList)throw n.ttestListTooShort(i);if(t[0].valueType!==r.ListOfNumber)throw n.methodRequiresList(i);if(t.length>2)throw n.tooManyArguments(i,2);if(t[0].length<2)throw n.ttestListTooShort(i);if(t[1]&&t[1].valueType!==r.Number)throw n.functionTypeError(i,a(t))},IndependentTTest:function(e,t){var i=this._symbol;if(2!==t.length)throw n.wrongDoubleReducerArity(i);if(!r.isList(t[0].valueType)||!r.isList(t[1].valueType))throw n.nonListDoubleReducer(i);if(t[0].valueType===r.EmptyList||t[1].valueType===r.EmptyList)throw n.ttestListTooShort("ittest");if(t[0].valueType!==r.ListOfNumber||t[1].valueType!==r.ListOfNumber)throw n.functionTypeError(i,a(t));if(t[0].length<2||t[1].length<2)throw n.ttestListTooShort("ittest")},Stats:function(e,t){var i=t.length,o=t[0];if(0===i)throw n.methodRequiresList(this._symbol);if(o.valueType===r.EmptyList)throw n.functionTypeError(this._symbol,a(t));if(o.valueType!==r.ListOfNumber)throw n.methodRequiresList(this._symbol);if(i>1)throw n.methodRequiresList(this._symbol)}};for(var u in s)t[u].prototype.typeCheck=s[u]});r("core/math/features/repr",["require","parsenodes"],function(e){"use strict";var t=e("parsenodes"),r=function(e,t,r){r=r||0;var n=Array(r+1).join("  "),i=n+"  ";return"[\n"+i+e.map(function(e){return e.repr(t,r+1)}).join(",\n"+i)+"\n"+n+"]"},n=function(e,t){return""+(t=t||"")+e};t.Expression.prototype.repr=function(e,t){return n(this.type,e)+"("+r(this.args,e,t)+")"},t.IRExpression.prototype.repr=function(e,t){t=t||0;var r=Array(t+1).join("  "),i=r+"  ",a=this._chunk.print().split("\n");return a.pop(),n(this.type,e)+"(`\n"+i+a.join("\n"+i)+"\n"+r+"`)"},t.DoubleInequality.prototype.repr=function(e,t){t=t||0;var r=Array(t+1).join("  "),i=r+"  ";return n(this.type,e)+"([\n"+i+this.args[0].repr(e,t+1)+",\n"+i+"'"+this.args[1]+"',\n"+i+this.args[2].repr(e,t+1)+",\n"+i+"'"+this.args[3]+"',\n"+i+this.args[4].repr(e,t+1)+"\n"+r+"])"},t.Identifier.prototype.repr=function(e){return n(this.type,e)+"('"+this._symbol+"')"},t.Constant.prototype.repr=function(e){return n(this.type,e)+"("+this.asValue()+")"},t.ExtendSeed.prototype.repr=function(e,t){return n(this.type,e)+"('"+this.tag+"', "+r(this.args,e,t)+")"},t.Seed.prototype.repr=function(e){return n(this.type,e)+"("+this.asValue()+")"},t.FunctionCall.prototype.repr=function(e,t){return n(this.type,e)+"('"+this._symbol+"', "+r(this.args,e,t)+")"},t.Assignment.prototype.repr=function(e,r){return n(this.type,e)+"("+t.Identifier(this._symbol).repr(e,r)+", "+this._expression.repr(e,r)+")"},t.Regression.prototype.repr=t.Equation.prototype.repr=function(e,t){return n(this.type,e)+"("+this._lhs.repr(e,t)+", "+this._rhs.repr(e,t)+")"},t.FunctionDefinition.prototype.repr=function(e,i){return n(this.type,e)+"("+t.Identifier(this._symbol).repr(e,i)+", "+r(this._argSymbols.map(function(e){return t.Identifier(e)}),e,i)+", "+this._expression.repr(e,i)+")"},t.Error.prototype.repr=function(e,t){return n(this.type,e)+"('"+this._msg+"')"},t.Derivative.prototype.repr=function(e,t){return n(this.type,e)+"('"+this._symbol+"', "+r(this.args,e,t)+")"},t.SolvedEquation.prototype.repr=function(e,t){return n(this.type,e)+"('"+this._symbol+"', "+this._expression.repr(e,t)+")"},t.OptimizedRegression.prototype.repr=function(e,t){return n(this.type,e)+"("+JSON.stringify(this.parameters)+", "+JSON.stringify(this.residuals)+", "+JSON.stringify(this.statistics)+", "+this.model.repr(e,t+1)+", "+JSON.stringify({isModelValid:this.isModelValid,residualVariable:this.residualVariable,residualSuggestionId:this.residualSuggestionId,shouldSuggestLogMode:this.shouldSuggestLogMode,isLinear:this.isLinear,parameterWarning:this.parameterWarning})+")"},t.Table.prototype.repr=function(e,t){return n(this.type,e)+"("+r(this.columns,e,t)+")"},t.TableColumn.prototype.repr=function(e,t){return n(this.type,e)+"("+this.header.repr(e,t)+", "+this.length+", "+r(this.values,e,t)+")"},t.Image.prototype.repr=function(e,t){var r=Array(t+1).join("  "),i=r+"  ";return n(this.type,e)+"({\n"+i+"center: "+this.center.repr(e,t+1)+",\n"+i+"radianAngle: "+this.radianAngle.repr(e,t+1)+",\n"+i+"width: "+this.width.repr(e,t+1)+",\n"+i+"height: "+this.height.repr(e,t+1)+"},\n"+i+"opacity: "+this.opacity.repr(e,t+1)+",\n"+i+JSON.stringify(this.moveStrategy)+"\n"+r+"})"},t.Ticker.prototype.repr=function(e,t){var r=Array(t+1).join("  "),i=r+"  ";return n(this.type,e)+"({\n"+i+"handler: "+this.handler.repr(e,t+1)+",\n"+i+"minStep: "+this.minStep.repr(e,t+1)+"\n"+r+"})"},t.Slider.prototype.repr=function(e,t){var r=Array(t+1).join("  "),i=r+"  ";return n(this.type,e)+"({\n"+i+"sliderAssignment: "+this.sliderAssignment.repr(e,t+1)+",\n"+i+"sliderMin: "+(this.sliderMin&&this.sliderMin.repr(e,t+1))+",\n"+i+"sliderMax: "+(this.sliderMax&&this.sliderMax.repr(e,t+1))+",\n"+i+"sliderStep: "+(this.sliderStep&&this.sliderStep.repr(e,t+1))+"},\n"+r+")"}});r("core/math/features/substitute",["require","parsenodes"],function(e){"use strict";var t=e("parsenodes"),r=function(e,t){return e.map(function(e){return e.substitute(t)})},n={Identifier:function(e){return e[this._symbol]?e[this._symbol]:this},FunctionCall:function(e){var n=e[this._symbol];if(n){if("Identifier"===n.type)return t.FunctionCall(n,r(this.args,e));if("Constant"===n.type)return t.Multiply([n,1===this.args.length?this.args[0].substitute(e):t.Constant(NaN)])}return t.Expression.prototype.substitute.call(this,e)},Constant:function(e){return this},Expression:function(e){return this.copyWithArgs(r(this.args,e))},Derivative:function(e){var n=e[this._symbol];if(n){if("Identifier"===n.type)return t.Derivative(n,r(this.args,e));throw new Error("Cannot substitute for a derivative variable with a non-Identifier")}return t.Derivative(this._symbol,r(this.args,e))}};for(var i in n)t[i].prototype.substitute=n[i]});r("core/math/features/simpleFunctionExpression",["require","parsenodes"],function(e){"use strict";var t=e("parsenodes");t.Expression.prototype.simpleFunctionExpression=function(){return this},t.Assignment.prototype.simpleFunctionExpression=function(){return this._expression},t.FunctionDefinition.prototype.simpleFunctionExpression=function(){return this._expression},t.Equation.prototype.simpleFunctionExpression=function(){return this.asComparator().simpleFunctionExpression()}});r("core/types/graphmode",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.POLYGON=t.ERROR=t.PARAMETRIC_CURVE_3D=t.Z_3D=t.OBJECT3D=t.VISUALIZATION=t.NONE=t.IMPLICIT=t.POLYGONFILL=t.POLAR=t.PARAMETRIC=t.XYPOINT_MOVABLE=t.XYPOINT=t.Y=t.X=void 0,t.X=1,t.Y=2,t.XYPOINT=3,t.XYPOINT_MOVABLE=4,t.PARAMETRIC=5,t.POLAR=6,t.POLYGONFILL=7,t.IMPLICIT=8,t.NONE=10,t.VISUALIZATION=11,t.OBJECT3D=12,t.Z_3D=13,t.PARAMETRIC_CURVE_3D=14,t.ERROR=15,t.POLYGON=16});r("core/math/distribution-spec",["require","exports","core/math/baseparser","tslib"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFunctionSpecFromTree=t.parseToplevelFunction=t.DistributionParameterDefaultsMap=void 0,t.DistributionParameterDefaultsMap={normaldist:{type:"distribution",symbol:"normaldist",params:["mean","stdev"],defaults:["0","1"],discrete:!1},tdist:{type:"distribution",symbol:"tdist",params:["dof"],defaults:[void 0],discrete:!1},binomialdist:{type:"distribution",symbol:"binomialdist",params:["trials","probsuccess"],defaults:[void 0,"0.5"],discrete:!0},poissondist:{type:"distribution",symbol:"poissondist",params:["mean"],defaults:[void 0],discrete:!0},uniformdist:{type:"distribution",symbol:"uniformdist",params:["min","max"],defaults:["0","1"],discrete:!1}};var i={Histogram:{type:"visualization",symbol:"histogram",params:["data","binwidth"],defaults:[void 0,"1"]},DotPlot:{type:"visualization",symbol:"dotplot",params:["data","binwidth"],defaults:[void 0,"1"]},BoxPlot:{type:"visualization",symbol:"boxplot",params:["data"],defaults:[void 0]}};function a(e){var r=e,a=i[r.type];if(!a)switch("Assignment"===r.type&&(r=r._expression),r.type){case"FunctionCall":a=t.DistributionParameterDefaultsMap[r._symbol];break;default:return}if(a){for(var o={},s=a.params,u=r.args,c=0;c<s.length;c++){var l=u[c];o[s[c]]=l&&l.getInputString()||""}return n.__assign(n.__assign({},a),{span:r.getInputSpan(),values:o})}}t.parseToplevelFunction=function(e){return a(r.parse(e,{trailingComma:!0}))},t.getFunctionSpecFromTree=a});r("core/lib/number-to-latex",["require","exports"],function(e,t){"use strict";function r(e){var t=e+"";if(/\d+\.?\d*e[\+\-]*\d+/i.test(t)){var r=String(t).toLowerCase().split("e"),n=parseFloat(r[0]),i=parseInt(r[1],10),a=Math.abs(i),o=Math.abs(n).toString().split(".");if(i<0)t="0."+new Array(a).join("0")+o.join("");else{var s=o[1];s&&(a-=s.length),t=o.join("")+new Array(a+1).join("0")}n<0&&(t="-"+t)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.numberToStatsConfidenceLatex=t.numberToDecimalString=void 0,t.default=function(e){if("string"==typeof e)return e;if(void 0===e)return"";if(isNaN(e))return"\\frac{0}{0}";if(e===1/0)return"\\infty";if(e===-1/0)return"-\\infty";var t=e+"";return t=(t=t.replace(/^1e\+?([-\d]+)/,"10^{$1}")).replace(/([-\d\.]+)e\+?([-\d]+)/,"$1\\cdot 10^{$2}")},t.numberToDecimalString=r,t.numberToStatsConfidenceLatex=function(e,t){void 0===t&&(t=2);var n,i=r(e),a=i.indexOf(".");if(-1===a)return i;for(var o=a+1;o<i.length;o++)if(n){if(i[o]!==n)break}else{if("0"!==i[o]&&"9"!==i[o])break;n=i[o]}return i.substr(0,Math.max(a+5,o+t))}});r("core/math/ir/features/value-to-latex",["require","exports","core/math/types","../../../lib/number-to-latex"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.valueToLatex=void 0,t.valueToLatex=function e(t,i){if(r.isList(t)){for(var a=[],o=0;o<i.length;o++)a.push(e(r.elementType(t),i[o]));return"\\left["+a.join(",")+"\\right]"}switch(t){case r.Number:return n.default(i);case r.Point:var s=i,u=s[0],c=s[1];return"\\left("+n.default(u)+","+n.default(c)+"\\right)";default:throw new Error("Cannot serialize a value of type "+r.prettyPrint(t)+".")}}});r("core/math/ir/features/action-to-latex",["require","exports","../../../lib/label","./value-to-latex"],function(e,t,r,n){"use strict";function i(e,t){var i=e.updateRules[t],a=i.valueType,o=i.value;return r.identifierToLatex(t)+"="+n.valueToLatex(a,o)}Object.defineProperty(t,"__esModule",{value:!0}),t.actionLatexForSymbol=t.actionToLatex=void 0,t.actionToLatex=function(e){var t={};for(var r in e.updateRules)t[r]=i(e,r);return t},t.actionLatexForSymbol=i});r("core/math/evaluationstate",["require","exports","core/vendor/d3-color","parsenodes","tslib","core/math/errormsg","core/types/graphmode","core/lib/label","core/math/distribution-spec","./types","./ir/features/action-to-latex"],function(e,t,r,n,i,a,o,s,u,c,l){"use strict";function p(e){return e.isError?e.getError():void 0===e.asValue()?"":+e.asValue()}function d(){return{operator:"=",variables:[]}}function f(e,t,r){var n=e.variables;if(n&&n.length){for(var i={},a=0,o=n;a<o.length;a++){i[s=o[a]]=!0}for(var s in r)i[s]=!0;r=i}e.variables=t.sliderVariables(Object.keys(r))}function h(e,t){if(t.blocksExport)return!1;var r=t.getDependencies();if(0===r.length)return!1;for(var n=0,i=r;n<i.length;n++){var a=i[n];if(!e.validActionVariable(a))return!1}return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.isErrorExportableActionDefinition=t.addSliderPrompts=t.EvaluationState=t.defaultEvaluationState=void 0,t.defaultEvaluationState=d,t.EvaluationState=function(e,t,d){if(t.isTable)return function(e,t,r){for(var n=[],i=0;i<t.columns.length;i++){var a=r.columns[i],o=a.isError?[]:a.values.map(p),s={dependent:!a.isIndependent,discrete:!!a.isIndependent,values:o};a.isError&&(s.error=a.getError()),n.push(s)}return{column_data:n}}(0,t,d);if(t.isImage)return function(e,t,r){var i={variables:[],errorMap:{},dimensions:{}};if(r.center.isError&&(i.errorMap.center=!0),r.radianAngle.isError&&(i.errorMap.angle=!0),r.width.isError&&(i.errorMap.width=!0),r.height.isError&&(i.errorMap.height=!0),r.opacity.isError&&(i.errorMap.opacity=!0),r.center.isError||r.radianAngle.isError||r.width.isError||r.height.isError||r.opacity.isError)return i.variables=t.getSliderVariables(e,r),i;i.dimensions.x=[],i.dimensions.y=[],i.dimensions.radianAngle=[],i.dimensions.width=[],i.dimensions.height=[],i.dimensions.opacity=[];var a=[r.center,r.radianAngle,r.width,r.height,r.opacity];return a.some(function(e){return e&&e.valueType&&c.isList(e.valueType)})&&(i.is_concrete_list=!0),n.List.eachArgs(a,function(e){var t=e[0].asValue(),r=+e[1].asValue(),n=Math.atan2(Math.sin(r),Math.cos(r));i.dimensions.x.push(+t[0]),i.dimensions.y.push(+t[1]),i.dimensions.radianAngle.push(n),i.dimensions.width.push(+e[2].asValue()),i.dimensions.height.push(+e[3].asValue()),i.dimensions.opacity.push(Math.max(0,Math.min(1,+e[4].asValue())))}),(e.graphingEnabled()?t.getGraphMode(e,r):o.NONE)!==o.NONE&&(i.is_graphable=!0),r.moveStrategy&&(i.move_strategy=r.moveStrategy),t.center&&("Identifier"===t.center.type?(i.center_reference_id=t.center.referencedStatementId,i.center_reference_symbol=t.center._symbol):"ParenSeq"===t.center.type&&r.center.valueType===c.Point&&(i.center_is_point_literal=!0)),i}(e,t,d);if(t instanceof n.Ticker)return function(e,t,r){for(var n,o=r.handler,s=r.minStep,u={},c={},l=0,p=o.getDependencies();l<p.length;l++){var d=p[l];e.validActionVariable(d)||(u[d]=!0)}for(var y=0,m=s.getDependencies();y<m.length;y++)c[d=m[y]]=!0;if(s.isError)n={status:"error",error:s.getError()};else{var v=s.asValue();n="number"==typeof v&&!isNaN(v)&&v>=0?{status:"valid",value:v}:{status:"error",error:a.tickerMinStepNonNegativeNumber().getError()}}var g=Object.keys(u);g.length>0&&(o=a.tooManyVariables(g).setDependencies(o.getDependencies()));var b={handler:o.isError&&!h(e,o)?{status:"error",error:o.getError()}:o.isEmptyAction?{status:"empty"}:{status:"maybe-valid"},minStep:n,variables:[]};return f(b,e,i.__assign(i.__assign({},u),c)),b}(e,0,d);var y={operator:"=",variables:[]};if(d.isError&&(!(t instanceof n.FunctionDefinition)||d.blocksExport))return y.error=d.getError(),y.variables=t.getSliderVariables(e,d),y.is_single_identifier=t instanceof n.Identifier,d.actionValue&&(y.action_value=l.actionToLatex(d.actionValue)),y;if(d.valueType===c.RGBColor&&0===d.getDependencies().length){var m=d.asValue();y.rgb_value=r.rgb(m[0],m[1],m[2]).formatHex()}d.valueType===c.Action&&0===d.getDependencies().length&&(y.action_value=l.actionToLatex(d.asValue())),d.moveStrategy&&(y.move_strategy=d.moveStrategy,y.default_drag_mode=d.defaultDragMode),t.isInequality()&&(y.is_inequality=!0),y.operator=t.getOperator(),d instanceof n.SolvedEquation?!0!==d._expression.asValue()&&!1!==d._expression.asValue()&&(y.assignment=d._symbol):t instanceof n.Assignment&&(y.assignment=t._symbol);var v=e.graphingEnabled()?t.getGraphMode(e,d):o.NONE;if(v!==o.NONE){y.is_graphable=!0,y.expression_type=t.getExpressionType(v,d.valueType),d.isShadeBetween()&&(y.is_shade_between=!0);var g=t.tableInfo(e,d);g&&(y.is_tableable=!0,y.table_info=g)}if(void 0!==d.valueType&&c.isList(d.valueType)&&(y.is_concrete_list=!0,d.valueType===c.ListOfColor&&0===d.getDependencies().length)){var b=d.asValue();b&&(y.rgb_value=b.map(function(e){return r.rgb(e[0],e[1],e[2]).formatHex()}))}y.variables=y.is_graphable?[]:t.getSliderVariables(e,d),y.is_single_identifier=t instanceof n.Identifier,d.isConstant&&(y.constant_value=d.asValue());var x=d.getEvaluationInfo();if(!x||"="!==y.operator||t.isConstant||t.isFunction||d.valueType===c.Bool||d.valueType===c.ListOfBool||t instanceof n.Equation||t instanceof n.And||(y.is_evaluable=!0,y.zero_values=x),d instanceof n.OptimizedRegression){var S=d,T={};for(var w in S.parameters)S.parameters.hasOwnProperty(w)&&(T[s.identifierToLatex(w)]=+S.parameters[w].asValue());y.is_regression=!0,y.regression={parameters:T,residualVariable:s.identifierToLatex(S.residualVariable),residualSuggestionId:S.residualSuggestionId,shouldSuggestLogMode:S.shouldSuggestLogMode,isLinear:S.isLinear,statistics:S.statistics,parameterWarning:S.parameterWarning}}var _=u.getFunctionSpecFromTree(t);return _&&_.discrete&&(y.is_discrete_distribution=!0),y},t.addSliderPrompts=f,t.isErrorExportableActionDefinition=h});r("core/math/workerconfig",[],function(){"use strict";return{pointsOfInterest:!0,plotSingleVariableImplicitEquations:!0,plotImplicits:!0,plotInequalities:!0,sliders:!0}});r("core/math/statementanalysis",["require","core/math/evaluationstate","pjs","core/types/graphmode","core/math/workerconfig"],function(e){"use strict";var t=e("core/math/evaluationstate").EvaluationState,r=e("pjs"),n=e("core/types/graphmode"),i=e("core/math/workerconfig");return r(function(e){e.init=function(e,r,n){this.policy=e,this.rawTree=r,this.concreteTree=n,this.evaluationState=t(e,r,n)},e.exportTo=function(e,t){this.rawTree.exportTo(e,this.concreteTree,t)},e.graph=function(e){return this.rawTree.tryGraph(this.policy,this.concreteTree,e)},e.getGraphMode=function(){return this.rawTree.getGraphMode(this.policy,this.concreteTree)},e.getGraphInfo=function(){return this.rawTree.getGraphInfo(this.policy,this.concreteTree)},e.shouldIntersect=function(){if(!this.evaluationState.is_graphable)return!1;if(!this.rawTree.userData.shouldGraph)return!1;if(!i.pointsOfInterest)return!1;var e=this.getGraphMode();return e===n.X||e===n.Y}})});r("core/math/expression-types",["require","exports"],function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.isClickableExpressionType=t.getReconciledExpressionProps=t.EXPRESSION_PROP_DEFAULTS=t.ExpressionType=void 0,function(e){e.X_OR_Y="X_OR_Y",e.SINGLE_POINT="SINGLE_POINT",e.POINT_LIST="POINT_LIST",e.PARAMETRIC="PARAMETRIC",e.POLAR="POLAR",e.IMPLICIT="IMPLICIT",e.POLYGON="POLYGON",e.HISTOGRAM="HISTOGRAM",e.DOTPLOT="DOTPLOT",e.BOXPLOT="BOXPLOT",e.TTEST="TTEST",e.STATS="STATS",e.CUBE="CUBE",e.SPHERE="SPHERE"}(r=t.ExpressionType||(t.ExpressionType={})),t.EXPRESSION_PROP_DEFAULTS={X_OR_Y:{points:!1,lines:!0,fill:!1},SINGLE_POINT:{points:!0,lines:!1,fill:!1},POINT_LIST:{points:!0,lines:!1,fill:!1},PARAMETRIC:{points:!1,lines:!0,fill:!1},POLAR:{points:!1,lines:!0,fill:!1},IMPLICIT:{points:!1,lines:!0,fill:!1},POLYGON:{points:!1,lines:!0,fill:!0},HISTOGRAM:{points:!1,lines:!0,fill:!0},DOTPLOT:{points:!0,lines:!1,fill:!1},BOXPLOT:{points:!1,lines:!0,fill:!1},TTEST:{points:!1,lines:!1,fill:!1},STATS:{points:!1,lines:!1,fill:!1},CUBE:{points:!1,lines:!1,fill:!0},SPHERE:{points:!1,lines:!1,fill:!0}},t.getReconciledExpressionProps=function(e,n){if(void 0===e)return{points:!1,lines:!1,fill:!1};var i=t.EXPRESSION_PROP_DEFAULTS[e];switch(e){case r.SINGLE_POINT:return{points:!0,lines:!1,fill:!1};case r.POINT_LIST:case r.DOTPLOT:return{points:void 0===n.points?i.points:n.points,lines:void 0===n.lines?i.lines:n.lines,fill:!1};case r.PARAMETRIC:case r.POLYGON:case r.X_OR_Y:case r.POLAR:case r.IMPLICIT:case r.HISTOGRAM:case r.BOXPLOT:case r.TTEST:case r.STATS:case r.CUBE:case r.SPHERE:return{points:!1,lines:void 0===n.lines?i.lines:n.lines,fill:void 0===n.fill?i.fill:n.fill};default:return e}},t.isClickableExpressionType=function(e){if(void 0===e)return!1;switch(e){case r.SINGLE_POINT:case r.POINT_LIST:case r.PARAMETRIC:case r.POLYGON:case r.X_OR_Y:case r.POLAR:case r.IMPLICIT:return!0;case r.HISTOGRAM:case r.BOXPLOT:case r.DOTPLOT:case r.TTEST:case r.STATS:case r.CUBE:case r.SPHERE:return!1;default:return e}}});r("core/math/ir/features/reapply-restrictions",["require","exports","../instructions","../opcodes","./get-dependency-mask"],function(e,t,r,n,i){"use strict";function a(e,t){for(var r=[],n=0,i=t;n<i.length;n++){var a=i[n];r.push(e[a])}return r}Object.defineProperty(t,"__esModule",{value:!0}),t.reapplyRestrictions=void 0,t.reapplyRestrictions=function(e,t){for(var o=[],s=e.returnIndex,u=i.getDependencyMask(e,t.mappedArgIndex),c=function(e,t,i){for(var a=[],o=0;o<i;o++)a.push(!1);a[i]=t[i];for(o=i;o>=0;o--)if(a[o]&&t[o]){var s=e.getInstruction(o);if(s.type===n.Piecewise)a[s.args[1]]=!0;else if(!r.isLeafInstruction(s))for(var u=0,c=s.args;u<c.length;u++){a[c[u]]=!0}}return a}(e,u,t.mappedReturnIndex),l=s,p=e.NanOfType(e.getReturnType()),d=0;d<t.mappedReturnIndex;d++){var f=e.getInstruction(d);if(d!==t.mappedArgIndex)if(u[d]||e.isInClosedBlock(d))if(r.isLeafInstruction(f))o.push(e.copyInstruction(f));else{var h=a(o,f.args);o.push(e.copyInstructionWithArgs(f,h)),f.type===n.Piecewise&&c[d]&&(l=e.Piecewise([h[0],l,p]))}else o.push(d);else o.push(s)}return l}});r("core/math/ir/features/solve",["require","exports","parsenodes","core/math/workerconfig","core/math/parsenode/irexpression","core/math/errormsg","../build-ir","../dependencies","core/math/comparators","../opcodes","./fuse-broadcast","./reapply-restrictions","core/math/types","core/math/maybe-rational"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f){"use strict";function h(e,t){return t?function(e){var t=e.chunk,r=e.coefficients,n=r[0],i=r[1],a=r[2],o=t.Constant(f.maybeRational(0,1));void 0===a&&(a=o);void 0===i&&(i=o);void 0===n&&(n=o);var s=t.Constant(f.maybeRational(2,1)),u=t.Constant(NaN),c=t.Constant(f.maybeRational(1e305,1)),l=t.Negative([c]),p=t.Multiply([s,a]),d=t.Negative([i]),h=t.Subtract([t.Multiply([i,i]),t.Multiply([s,t.Multiply([p,n])])]),y=t.SyntheticNativeFunction("sqrt",[h]),m=t.Divide([t.Add([d,y]),p]),v=t.Divide([t.Subtract([d,y]),p]),g=t.Negative([t.Divide([n,i])]),b=t.Equal([a,o]),x=t.Greater([a,o]),S=t.Equal([i,o]),T=t.Greater([i,o]),w=t.Less([i,o]),_=t.Greater([n,o]),I=t.Less([h,o]);return[t.Piecewise([b,t.Piecewise([w,g,u]),t.Piecewise([x,v,u])]),t.Piecewise([b,t.Piecewise([S,t.Piecewise([_,l,u]),u]),t.Piecewise([x,t.Piecewise([I,l,u]),m])]),t.Piecewise([b,t.Piecewise([S,t.Piecewise([_,c,u]),u]),t.Piecewise([x,t.Piecewise([I,c,u]),v])]),t.Piecewise([b,t.Piecewise([T,g,u]),t.Piecewise([x,m,u])])]}(e):function(e){var t=e.chunk,r=e.coefficients,n=r[0],i=r[1],a=r[2],o=t.Constant(f.maybeRational(0,1)),s=t.Constant(NaN);if(void 0===a){void 0===i&&(i=o);var u=t.Negative([t.Divide([n,i])]),l=t.Equal([i,o]);return[t.Piecewise([l,s,u])]}var p=t.Constant(f.maybeRational(2,1)),d=t.Multiply([p,a]),h=t.Negative([i]),y=t.Subtract([t.Multiply([i,i]),t.Multiply([p,t.Multiply([d,n])])]),m=t.Equal([a,o]),v=t.getInstruction(y);if(v.type===c.Constant&&0===f.asFloat(v.value))return[t.Piecewise([m,s,t.Divide([h,d])])];var g=t.SyntheticNativeFunction("sqrt",[y]),b=t.Less([i,o]),x=t.Greater([i,o]),S=t.Divide([t.Add([h,g]),d]),T=t.Divide([t.Subtract([h,g]),d]);u=t.Negative([t.Divide([n,i])]);return[t.Piecewise([m,t.Piecewise([b,u,s]),T]),t.Piecewise([m,t.Piecewise([x,u,s]),S])]}(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.trySolve=void 0,t.trySolve=function(e,t){try{return function(e,t){for(var f=e.policy,y=e.frame,m=s.getFreeDependencies(y,t),v=[],g=0;g<m.length;g++)v.push(d.Number);var b=o.buildIRContext({policy:f,frame:y,argNames:m,argTypes:v}),x=b.chunk,S=o.addToIR(b,t.args[0]),T=o.addToIR(b,t.args[1]),w=t.getOperator(),_="="!==w;switch(w){case"<":x.Less([S,T]);break;case">":x.Greater([S,T]);break;case"<=":x.LessEqual([S,T]);break;case">=":x.GreaterEqual([S,T]);break;case"=":x.Equal([S,T])}if(x.returnIndex=l.fuseBroadcast(x,x.returnIndex),x.isConstant())return new i(x.close());var I=x.getInstruction(S).type!==c.LoadArg||-1!==s.getFreeDependencies(y,t.args[1]).indexOf(x.argNames[S]);if(!n.plotImplicits&&I)throw a.implicitsDisabled();-1===u.table[w].direction?x.Subtract([T,S]):x.Subtract([S,T]);x.close();var E=x.getLiveArgNames();if(0===E.length)throw a.parseError();if(1===E.length&&!_&&!n.plotSingleVariableImplicitEquations)return a.singleVariableImplicitEquationsDisabled();if(E.length>2)return a.tooManyVariables(f.sliderVariables(E)).setDependencies(E);if(_&&!f.validInequalityVariables(E))return a.invalidInequalityVariables().setDependencies(E);var C=function(e,t){var r=e.chunk,n=e.policy,i=r.argNames,a=d.isList(r.getReturnType()),o=[];e:for(var s=0;s<i.length;s++){var u=i[s],c=i.length>1&&!n.validSolvedVariable(u);o[s]={localFrames:[],effectiveOrder:0,variableOfInterest:u};var l=!t;if(c)o[s].effectiveOrder=1/0;else{var p=a?r.getConstantListLength():1;if(null==p)throw new Error("Programming error: cannot solve a variable-length list expression");for(var f=0;f<p;f++){var h=a?r.elementAt(f):r;if(h.polynomialOrder(u,{allowRestriction:l,allowClosedBlockReferences:!1})>2){o[s].effectiveOrder=1/0;continue e}var y=h.getPolynomialCoefficients(u);o[s].localFrames.push(y),o[s].effectiveOrder=Math.max(o[s].effectiveOrder,y.coefficients.length-1)}}}return 1===i.length?o[0]:("y"===i[0]&&(o=[o[1],o[0]]),0===o[0].effectiveOrder?o[1]:0===o[1].effectiveOrder?o[0]:o[o[0].effectiveOrder<o[1].effectiveOrder?0:1])}(b,_),M=C.localFrames,k=C.effectiveOrder,P=C.variableOfInterest;if(f.complicatedPolarImplicit(P,k))return a.complicatedPolarImplicit().setDependencies(E);if(!f.validImplicitVariables(E))return a.invalidImplicitVariables();if(k>2)return new i(x.close());for(var O=[],L=1,N=0,A=M;N<A.length;N++){var D=A[N],R=h(D,_);L=R.length;for(var F=0,q=R;F<q.length;F++){var B=q[F],V=D.chunk.copy();V.returnIndex=B,D.isRestrictedPolynomial&&(V.returnIndex=p.reapplyRestrictions(V,D)),V.close(),O.push(new i(V))}}return r.SolvedEquation(P,r.List(O),L)}(e,t)}catch(e){return e instanceof r.Base?e:a.parseError()}}});r("numeric",[],function(){"use strict";var e="undefined"==typeof exports?function(){}:exports;return"undefined"!=typeof global&&(global.numeric=e),e.version="1.2.6",e._myIndexOf=function(e){var t,r=this.length;for(t=0;t<r;++t)if(this[t]===e)return t;return-1},e.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:e._myIndexOf,e.precision=4,e.largeArray=50,e.compile=function(){var t=Array.prototype.slice.call(arguments),r=t.pop();return r="return function ("+t.join(",")+") {"+r+"}",new Function(["numeric"],r)(e)},e._dim=function(e){for(var t=[];"object"==typeof e;)t.push(e.length),e=e[0];return t},e.dim=function(t){var r;return"object"==typeof t?"object"==typeof(r=t[0])?"object"==typeof r[0]?e._dim(t):[t.length,r.length]:[t.length]:[]},e.mapreduce=function(t,r){return e.compile("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+r+';\nif(typeof x === "number") { var xi = x; '+t+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+t+";\n    xi = x[i-1];\n    "+t+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+t+"\n}\nreturn accum;")},e.mapreduce2=function(t,r){return e.compile("x","var n = x.length;\nvar i,xi;\n"+r+"\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+t+"\n}\nreturn accum;")},e.rep=function(t,r,n){void 0===n&&(n=0);var i,a=t[n],o=Array(a);if(n===t.length-1){for(i=a-2;i>=0;i-=2)o[i+1]=r,o[i]=r;return-1===i&&(o[0]=r),o}for(i=a-1;i>=0;i--)o[i]=e.rep(t,r,n+1);return o},e.dotMMsmall=function(e,t){var r,n,i,a,o,s,u,c,l,p,d;for(a=e.length,o=t.length,s=t[0].length,u=Array(a),r=a-1;r>=0;r--){for(c=Array(s),l=e[r],i=s-1;i>=0;i--){for(p=l[o-1]*t[o-1][i],n=o-2;n>=1;n-=2)d=n-1,p+=l[n]*t[n][i]+l[d]*t[d][i];0===n&&(p+=l[0]*t[0][i]),c[i]=p}u[r]=c}return u},e._getCol=function(e,t,r){var n;for(n=e.length-1;n>0;--n)r[n]=e[n][t],r[--n]=e[n][t];0===n&&(r[0]=e[0][t])},e.dotMMbig=function(t,r){var n,i,a,o=e._getCol,s=r.length,u=Array(s),c=t.length,l=r[0].length,p=new Array(c),d=e.dotVV;for(--s,i=--c;-1!==i;--i)p[i]=Array(l);for(i=--l;-1!==i;--i)for(o(r,i,u),a=c;-1!==a;--a)0,n=t[a],p[a][i]=d(n,u);return p},e.dotMV=function(t,r){var n,i=t.length,a=(r.length,Array(i)),o=e.dotVV;for(n=i-1;n>=0;n--)a[n]=o(t[n],r);return a},e.dotVM=function(e,t){var r,n,i,a,o,s,u;for(i=e.length,a=t[0].length,o=Array(a),n=a-1;n>=0;n--){for(s=e[i-1]*t[i-1][n],r=i-2;r>=1;r-=2)u=r-1,s+=e[r]*t[r][n]+e[u]*t[u][n];0===r&&(s+=e[0]*t[0][n]),o[n]=s}return o},e.dotVV=function(e,t){var r,n,i=e.length,a=e[i-1]*t[i-1];for(r=i-2;r>=1;r-=2)n=r-1,a+=e[r]*t[r]+e[n]*t[n];return 0===r&&(a+=e[0]*t[0]),a},e.dot=function(t,r){var n=e.dim;switch(1e3*n(t).length+n(r).length){case 2002:return r.length<10?e.dotMMsmall(t,r):e.dotMMbig(t,r);case 2001:return e.dotMV(t,r);case 1002:return e.dotVM(t,r);case 1001:return e.dotVV(t,r);case 1e3:return e.mulVS(t,r);case 1:return e.mulSV(t,r);case 0:return t*r;default:throw new Error("numeric.dot only works on vectors and matrices")}},e.diag=function(e){var t,r,n,i,a=e.length,o=Array(a);for(t=a-1;t>=0;t--){for(i=Array(a),r=t+2,n=a-1;n>=r;n-=2)i[n]=0,i[n-1]=0;for(n>t&&(i[n]=0),i[t]=e[t],n=t-1;n>=1;n-=2)i[n]=0,i[n-1]=0;0===n&&(i[0]=0),o[t]=i}return o},e.getDiag=function(e){var t,r=Math.min(e.length,e[0].length),n=Array(r);for(t=r-1;t>=1;--t)n[t]=e[t][t],n[--t]=e[t][t];return 0===t&&(n[0]=e[0][0]),n},e.identity=function(t){return e.diag(e.rep([t],1))},e.pointwise=function(t,r,n){void 0===n&&(n="");var i,a,o=[],s=/\[i\]$/,u="",c=!1;for(i=0;i<t.length;i++)s.test(t[i])?u=a=t[i].substring(0,t[i].length-3):a=t[i],"ret"===a&&(c=!0),o.push(a);return o[t.length]="_s",o[t.length+1]="_k",o[t.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+u+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(c?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+t.join(",")+",_s,_k+1);\n    return ret;\n}\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n    "+r+"\n}\nreturn ret;",e.compile.apply(null,o)},e.pointwise2=function(t,r,n){void 0===n&&(n="");var i,a,o=[],s=/\[i\]$/,u="",c=!1;for(i=0;i<t.length;i++)s.test(t[i])?u=a=t[i].substring(0,t[i].length-3):a=t[i],"ret"===a&&(c=!0),o.push(a);return o[t.length]="var _n = "+u+".length;\nvar i"+(c?"":", ret = Array(_n)")+";\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n"+r+"\n}\nreturn ret;",e.compile.apply(null,o)},e._biforeach=function e(t,r,n,i,a){var o;if(i!==n.length-1)for(o=n[i]-1;o>=0;o--)e("object"==typeof t?t[o]:t,"object"==typeof r?r[o]:r,n,i+1,a);else a(t,r)},e._biforeach2=function e(t,r,n,i,a){if(i===n.length-1)return a(t,r);var o,s=n[i],u=Array(s);for(o=s-1;o>=0;--o)u[o]=e("object"==typeof t?t[o]:t,"object"==typeof r?r[o]:r,n,i+1,a);return u},e._foreach=function e(t,r,n,i){var a;if(n!==r.length-1)for(a=r[n]-1;a>=0;a--)e(t[a],r,n+1,i);else i(t)},e._foreach2=function e(t,r,n,i){if(n===r.length-1)return i(t);var a,o=r[n],s=Array(o);for(a=o-1;a>=0;a--)s[a]=e(t[a],r,n+1,i);return s},e.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},e.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},e.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],e.mathfuns2=["atan2","pow","max","min"],e.ops1={neg:"-",not:"!",bnot:"~",clone:""},e.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi);","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var t,r;for(t=0;t<e.mathfuns2.length;++t)r=e.mathfuns2[t],e.ops2[r]=r;for(t in e.ops2)if(e.ops2.hasOwnProperty(t)){r=e.ops2[t];var n,i,a="";-1!==e.myIndexOf.call(e.mathfuns2,t)?(a="var "+r+" = Math."+r+";\n",n=function(e,t,n){return e+" = "+r+"("+t+","+n+")"},i=function(e,t){return e+" = "+r+"("+e+","+t+")"}):(n=function(e,t,n){return e+" = "+t+" "+r+" "+n},i=e.opseq.hasOwnProperty(t+"eq")?function(e,t){return e+" "+r+"= "+t}:function(e,t){return e+" = "+e+" "+r+" "+t}),e[t+"VV"]=e.pointwise2(["x[i]","y[i]"],n("ret[i]","x[i]","y[i]"),a),e[t+"SV"]=e.pointwise2(["x","y[i]"],n("ret[i]","x","y[i]"),a),e[t+"VS"]=e.pointwise2(["x[i]","y"],n("ret[i]","x[i]","y"),a),e[t]=e.compile("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+t+"VV, VS = numeric."+t+"VS, SV = numeric."+t+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+i("x","y")+"\n}\nreturn x;\n"),e[r]=e[t],e[t+"eqV"]=e.pointwise2(["ret[i]","x[i]"],i("ret[i]","x[i]"),a),e[t+"eqS"]=e.pointwise2(["ret[i]","x"],i("ret[i]","x"),a),e[t+"eq"]=e.compile("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+t+"eqV, S = numeric."+t+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(t=0;t<e.mathfuns2.length;++t)r=e.mathfuns2[t],delete e.ops2[r];for(t=0;t<e.mathfuns.length;++t)r=e.mathfuns[t],e.ops1[r]=r;for(t in e.ops1)e.ops1.hasOwnProperty(t)&&(a="",r=e.ops1[t],-1!==e.myIndexOf.call(e.mathfuns,t)&&Math.hasOwnProperty(r)&&(a="var "+r+" = Math."+r+";\n"),e[t+"eqV"]=e.pointwise2(["ret[i]"],"ret[i] = "+r+"(ret[i]);",a),e[t+"eq"]=e.compile("x",'if(typeof x !== "object") return '+r+"x\nvar i;\nvar V = numeric."+t+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),e[t+"V"]=e.pointwise2(["x[i]"],"ret[i] = "+r+"(x[i]);",a),e[t]=e.compile("x",'if(typeof x !== "object") return '+r+"(x)\nvar i;\nvar V = numeric."+t+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(t=0;t<e.mathfuns.length;++t)r=e.mathfuns[t],delete e.ops1[r];for(t in e.mapreducers)e.mapreducers.hasOwnProperty(t)&&(r=e.mapreducers[t],e[t+"V"]=e.mapreduce2(r[0],r[1]),e[t]=e.compile("x","s","k",r[1]+'if(typeof x !== "object") {    xi = x;\n'+r[0]+'\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+t+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+r[0]+"\n}\nreturn accum;\n"))}(),e.inv=function(t){var r,n,i,a,o,s,u,c=e.dim(t),l=Math.abs,p=c[0],d=c[1],f=e.clone(t),h=e.identity(p);for(s=0;s<d;++s){var y=-1,m=-1;for(o=s;o!==p;++o)(u=l(f[o][s]))>m&&(y=o,m=u);for(n=f[y],f[y]=f[s],f[s]=n,a=h[y],h[y]=h[s],h[s]=a,t=n[s],u=s;u!==d;++u)n[u]/=t;for(u=d-1;-1!==u;--u)a[u]/=t;for(o=p-1;-1!==o;--o)if(o!==s){for(r=f[o],i=h[o],t=r[s],u=s+1;u!==d;++u)r[u]-=n[u]*t;for(u=d-1;u>0;--u)i[u]-=a[u]*t,i[--u]-=a[u]*t;0===u&&(i[0]-=a[0]*t)}}return h},e.det=function(t){var r=e.dim(t);if(2!==r.length||r[0]!==r[1])throw new Error("numeric: det() only works on square matrices");var n,i,a,o,s,u,c,l,p=r[0],d=1,f=e.clone(t);for(i=0;i<p-1;i++){for(a=i,n=i+1;n<p;n++)Math.abs(f[n][i])>Math.abs(f[a][i])&&(a=n);for(a!==i&&(c=f[a],f[a]=f[i],f[i]=c,d*=-1),o=f[i],n=i+1;n<p;n++){for(u=(s=f[n])[i]/o[i],a=i+1;a<p-1;a+=2)l=a+1,s[a]-=o[a]*u,s[l]-=o[l]*u;a!==p&&(s[a]-=o[a]*u)}if(0===o[i])return 0;d*=o[i]}return d*f[i][i]},e.transpose=function(e){var t,r,n,i,a,o=e.length,s=e[0].length,u=Array(s);for(r=0;r<s;r++)u[r]=Array(o);for(t=o-1;t>=1;t-=2){for(i=e[t],n=e[t-1],r=s-1;r>=1;--r)(a=u[r])[t]=i[r],a[t-1]=n[r],(a=u[--r])[t]=i[r],a[t-1]=n[r];0===r&&((a=u[0])[t]=i[0],a[t-1]=n[0])}if(0===t){for(n=e[0],r=s-1;r>=1;--r)u[r][0]=n[r],u[--r][0]=n[r];0===r&&(u[0][0]=n[0])}return u},e.negtranspose=function(e){var t,r,n,i,a,o=e.length,s=e[0].length,u=Array(s);for(r=0;r<s;r++)u[r]=Array(o);for(t=o-1;t>=1;t-=2){for(i=e[t],n=e[t-1],r=s-1;r>=1;--r)(a=u[r])[t]=-i[r],a[t-1]=-n[r],(a=u[--r])[t]=-i[r],a[t-1]=-n[r];0===r&&((a=u[0])[t]=-i[0],a[t-1]=-n[0])}if(0===t){for(n=e[0],r=s-1;r>=1;--r)u[r][0]=-n[r],u[--r][0]=-n[r];0===r&&(u[0][0]=-n[0])}return u},e.norm2=function(t){return Math.sqrt(e.norm2Squared(t))},e.linspace=function(e,t,r){if(void 0===r&&(r=Math.max(Math.round(t-e)+1,1)),r<2)return 1===r?[e]:[];var n,i=Array(r);for(n=--r;n>=0;n--)i[n]=(n*t+(r-n)*e)/r;return i},e.getBlock=function(t,r,n){var i=e.dim(t);return function e(t,a){var o,s=r[a],u=n[a]-s,c=Array(u);if(a===i.length-1){for(o=u;o>=0;o--)c[o]=t[o+s];return c}for(o=u;o>=0;o--)c[o]=e(t[o+s],a+1);return c}(t,0)},e.setBlock=function(t,r,n,i){var a=e.dim(t);return function e(t,i,o){var s,u=r[o],c=n[o]-u;if(o===a.length-1)for(s=c;s>=0;s--)t[s+u]=i[s];for(s=c;s>=0;s--)e(t[s+u],i[s],o+1)}(t,i,0),t},e.getRange=function(e,t,r){var n,i,a,o,s=t.length,u=r.length,c=Array(s);for(n=s-1;-1!==n;--n)for(c[n]=Array(u),a=c[n],o=e[t[n]],i=u-1;-1!==i;--i)a[i]=o[r[i]];return c},e.blockMatrix=function(t){var r=e.dim(t);if(r.length<4)return e.blockMatrix([t]);var n,i,a,o,s,u=r[0],c=r[1];for(n=0,i=0,a=0;a<u;++a)n+=t[a][0].length;for(o=0;o<c;++o)i+=t[0][o][0].length;var l=Array(n);for(a=0;a<n;++a)l[a]=Array(i);var p,d,f,h,y,m=0;for(a=0;a<u;++a){for(p=i,o=c-1;-1!==o;--o)for(p-=(s=t[a][o])[0].length,f=s.length-1;-1!==f;--f)for(y=s[f],d=l[m+f],h=y.length-1;-1!==h;--h)d[p+h]=y[h];m+=t[a][0].length}return l},e.tensor=function(t,r){if("number"==typeof t||"number"==typeof r)return e.mul(t,r);var n=e.dim(t),i=e.dim(r);if(1!==n.length||1!==i.length)throw new Error("numeric: tensor product is only defined for vectors");var a,o,s,u,c=n[0],l=i[0],p=Array(c);for(o=c-1;o>=0;o--){for(a=Array(l),u=t[o],s=l-1;s>=3;--s)a[s]=u*r[s],a[--s]=u*r[s],a[--s]=u*r[s],a[--s]=u*r[s];for(;s>=0;)a[s]=u*r[s],--s;p[o]=a}return p},e.epsilon=2.220446049250313e-16,e.LU=function(t,r){r=r||!1;var n,i,a,o,s,u,c,l,p,d=Math.abs,f=t.length,h=f-1,y=new Array(f);for(r||(t=e.clone(t)),a=0;a<f;++a){for(c=a,p=d((u=t[a])[a]),i=a+1;i<f;++i)p<(o=d(t[i][a]))&&(p=o,c=i);for(y[a]=c,c!=a&&(t[a]=t[c],t[c]=u,u=t[a]),s=u[a],n=a+1;n<f;++n)t[n][a]/=s;for(n=a+1;n<f;++n){for(l=t[n],i=a+1;i<h;++i)l[i]-=l[a]*u[i],l[++i]-=l[a]*u[i];i===h&&(l[i]-=l[a]*u[i])}}return{LU:t,P:y}},e.LUsolve=function(t,r){var n,i,a,o,s,u=t.LU,c=u.length,l=e.clone(r),p=t.P;for(n=c-1;-1!==n;--n)l[n]=r[n];for(n=0;n<c;++n)for(a=p[n],p[n]!==n&&(s=l[n],l[n]=l[a],l[a]=s),o=u[n],i=0;i<n;++i)l[n]-=l[i]*o[i];for(n=c-1;n>=0;--n){for(o=u[n],i=n+1;i<c;++i)l[n]-=l[i]*o[i];l[n]/=o[n]}return l},e.solve=function(t,r,n){return e.LUsolve(e.LU(t,n),r)},e});r("core/math/qr",["require","exports"],function(e,t){"use strict";function r(e,t){for(var r=e.length,n=t.length,i=0,a=0,o=n-r;o<n;o++)i+=e[o+r-n]*t[o],a+=e[o+r-n]*e[o+r-n];var s=i/a;for(o=n-r;o<n;o++)t[o]=2*s*e[o+r-n]-t[o]}function n(e,t,r){for(var n=e.length,i=t.length,a=0,o=0,s=i-n;s<i;s++)a+=e[s+n-i]*t[s][r],o+=e[s+n-i]*e[s+n-i];var u=a/o;for(s=i-n;s<i;s++)t[s][r]=2*u*e[s+n-i]-t[s][r]}function i(e,t,r,n){var i=Array(e.length-t);if(1===i.length)return i[0]=1,i;if(0===n){i[0]=1;for(var a=1;a<i.length;a++)i[a]=0;return i}var o=e[t][r]<0?-1:1;i[0]=e[t][r]+o*Math.sqrt(n);for(var s=t+1;s<e.length;s++)i[s-t]=e[s][r];return i}function a(e,t,r){for(var n=0;t<e.length;t++)n+=e[t][r]*e[t][r];return n}function o(e,t,n){for(var i=e.reflectors,a=e.r,o=e.p,s=t.slice(),u=0;u<i.length;u++)r(i[u],s);for(u=i.length;u<a[0].length;u++)s[u]=0;s.length=a[0].length;var c=Math.pow(2,-52),l=n.regularize?c*Math.abs(a[0][0])*Math.max(a.length,a[0].length):0;for(u=i.length-1;u>=0;u--){var p=a[u];if(Math.abs(p[u])<=l)s[u]=0;else{for(var d=u+1;d<i.length;d++)s[u]-=s[d]*p[d];s[u]/=p[u]}}for(u=o.length-1;u>=0;u--)if(o[u]!==u){var f=s[u];s[u]=s[o[u]],s[o[u]]=f}return s}function s(e){var t=e.r,r=Math.min(t.length,t[0].length),n=t[0][0],i=t[r-1][r-1];return 0===n?1/0:Math.abs(n/i)}Object.defineProperty(t,"__esModule",{value:!0}),t.isNumericallyFullRank=t.conditionNumber=t.qrSolve=t.qr=void 0,t.qr=function(e,t){if(!t||!t.mutateInput){var r=e;e=Array(e.length);for(var o=0;o<r.length;o++)e[o]=r[o].slice()}for(var s=Math.min(e.length,e[0].length),u=Array(s),c=[],l=0;l<s;l++){for(var p=-1/0,d=l,f=l;f<e[l].length;f++){var h=a(e,l,f);h>p&&(p=h,d=f)}if(u[l]=d,d!==l)for(o=0;o<e.length;o++){var y=e[o][d];e[o][d]=e[o][l],e[o][l]=y}var m=i(e,l,l,p);for(f=l;f<e[l].length;f++)n(m,e,f);c.push(m)}return{reflectors:c,r:e,p:u}},t.qrSolve=function(e,t,r){return Array.isArray(t[0])?function(e,t,r){for(var n=Array(e.r[0].length),i=0;i<n.length;i++)n[i]=Array(t[0].length);for(var a=Array(t.length),s=0;s<t[0].length;s++){for(i=0;i<t.length;i++)a[i]=t[i][s];var u=o(e,a,r);for(i=0;i<u.length;i++)n[i][s]=u[i]}return n}(e,t,r):o(e,t,r)},t.conditionNumber=s,t.isNumericallyFullRank=function(e){var t=Math.pow(2,-52);return Math.max(e.r.length,e.r[0].length)*t*s(e)<1}});r("core/math/least-squares",["require","exports","numeric","core/math/distance","./qr"],function(e,t,r,n,i){"use strict";function a(e,t){for(var r=[],n=0;n<t;n++)r.push(e);return r}function o(e,t){for(var r=s(e,t),n=0,i=0,a=r;i<a.length;i++){var o=a[i];n+=o*o}return n/r.length}function s(e,t){return e.apply(void 0,t)}function u(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var a=i[n].apply(void 0,t);r.push(a)}return r}function c(e,t){for(var r=[],n=0;n<e.length;n++)t[n]&&r.push(e[n]);return r}function l(e,t,r){for(var n=[],i=0,a=0;i<e.length;i++){var o=0;r[i]&&(o=t[a],a+=1),n.push(e[i]+o)}return n}function p(e,t,n,p){var d,f=p.maxIterations,h=p.linearSubset||a(!1,n.length),y=r.not(h),m=c(t,h),v=c(t,y),g=n,b=0,x=.001;if(r.any(h)){d={Jv:k=r.transpose(u(m,g)),F:M=i.qr(k)};var S=s(e,g);g=l(g,r.neg(i.qrSolve(M,S,{regularize:!0})),h)}for(var T=!1,w=o(e,g);b<f&&!T&&isFinite(w);){S=s(e,g);var _=u(v,g),I=r.transpose(_),E=void 0,C=void 0;if(d){var M=d.F,k=d.Jv;E=r.dot(_,r.sub(S,r.dot(k,i.qrSolve(M,S,{regularize:!0})))),C=r.dot(_,r.sub(I,r.dot(k,i.qrSolve(M,I,{regularize:!0}))))}else E=r.dot(_,S),C=r.dot(_,I);for(var P=g,O=!1;b<f&&!T&&!O;){b+=1;var L=r.add(C,r.diag(a(x,v.length)));P=l(g,r.neg(r.solve(L,E,!0)),y),T=r.all(r.eq(P,g));var N=void 0;if(d){N={Jv:k=r.transpose(u(m,P)),F:M=i.qr(k)};var A=s(e,P);P=l(P,r.neg(i.qrSolve(M,A,{regularize:!0})),h)}var D=o(e,P);(O=D<w)?(g=P,w=D,d=N,x*=.1):(x=Math.max(x,1e-64),x*=2)}}return{solution:g,MSE:w}}Object.defineProperty(t,"__esModule",{value:!0}),t.testOnlyExports=t.optimizeNonLinear=t.optimizeLinear=t.tryRoundingSmallParametersToZero=t.evaluateMeanSquare=void 0,t.evaluateMeanSquare=o,t.tryRoundingSmallParametersToZero=function(e,t){var r=t.solution.map(function(e){return Math.abs(e)<1e-6?0:e}),n=o(e,r);return isFinite(t.MSE)&&!isFinite(t.MSE)||n<t.MSE||t.MSE!==t.MSE+Math.pow(.5,8)*(n-t.MSE)?t:{solution:r,MSE:n}},t.optimizeLinear=function(e,t){for(var n=a(0,t.length),c=u(t,n),l=i.qr(r.transpose(c),{mutateInput:!0}),p=0;p<2;p++){var d=s(e,n),f=r.neg(i.qrSolve(l,d,{regularize:!1}));n=r.add(n,f)}var h=o(e,n);if(i.isNumericallyFullRank(l))return{solution:n,MSE:h};var y=a(0,t.length);for(p=0;p<2;p++){d=s(e,y),f=r.neg(i.qrSolve(l,d,{regularize:!0}));y=r.add(y,f)}var m=o(e,y);return.999*m<=h?{solution:y,MSE:m}:{solution:n,MSE:h}};var d=[18.9,.105,.0113,.089,4.414,.373,.06,.149,1.84,9.26,5,.7,.2,1.13,2.61,1,.007,30,120,1500,4e-4,7.23,-1,-.0081,-.03,-28.6,-1.71,-.4,-6.94,-.777,-500],f=function(e){for(var t=[],r=0;r<d.length;r++){for(var n=[],i=0;i<e;i++)n[i]=0===r&&1!==e?0:1===r&&1!==e?1:d[503*(r*e+i)%d.length];t.push(n)}return t},h=function(e,t,r,n,i){for(var a=[],o=0,s=r;o<s.length;o++){var u=s[o];a.push({soln:p(e,t,u,i),initialGuess:u})}a.sort(function(e,t){return isNaN(e.soln.MSE)?1:isNaN(t.soln.MSE)?-1:e.soln.MSE-t.soln.MSE});for(var c=[],l=0;l<n;l++)c.push(a[l].initialGuess);return c};function y(e,t,r,n){if(!t)return e;if("known"!==t.type)return e;var i=t.bounds;return i[0]===-1/0&&i[1]===1/0?e:i[0]===-1/0?i[1]-Math.exp(-e):i[1]===1/0?i[0]+Math.exp(e):r/(n-1)*i[1]+(n-1-r)/(n-1)*i[0]}var m=[3,5,7,11,13,17,19];function v(e,t){for(var r=[],n=0;n<e.length;n++){for(var i=e[n],a=[],o=0;o<i.length;o++){var s=m[o%m.length]*n%e.length;a.push(y(i[o],t[o],s,e.length))}r.push(a)}return r}t.optimizeNonLinear=function(e,t,r){r||(r={});var i=r.linearSubset,a=r.bounds,o=r.preferredInitialGuess,s=f(t.length);a&&(s=v(s,a));var u=h(e,t,s,5,{maxIterations:3,linearSubset:i}),c=p(e,t,h(e,t,u,1,{maxIterations:60,linearSubset:i})[0],{maxIterations:250,linearSubset:i});if(!o)return c;var l=p(e,t,o,{maxIterations:100,linearSubset:i});return isFinite(l.MSE)&&(l.MSE<c.MSE||n.approx(l.MSE,c.MSE,8))?l:c},t.testOnlyExports={generateInitialGuesses:f,mapInitialGuesses:v}});r("core/math/ir/features/reparameterize-regression",["require","exports","core/math/builtin","../opcodes","core/math/types","../instructions","./is-constant","./as-value","./polynomial-order","./get-polynomial-coefficients","./copy-instruction","core/math/maybe-rational","./list-length"],function(e,t,r,n,i,a,o,s,u,c,l,p,d){"use strict";function f(e){return{chunk:e,isLazy:!0}}function h(e){return e.slice()}function y(e){if(!e.isLazy)return e;var t=e.chunk.copy();return t.reopenFinalBlock(),{chunk:t,forwardParameterMap:h,reverseParameterMap:h,isLazy:!1,valueMap:P(e.chunk.instructionsLength()),replacementMask:k(e.chunk.argNames.length)}}function m(e){var t=e.chunk,r=e.forwardParameterMap,n=e.reverseParameterMap,i=e.isLazy,a=e.valueMap,o=e.replacementMask,s=e.didShiftScale;return{chunk:t.copy(),forwardParameterMap:r,reverseParameterMap:n,isLazy:i,valueMap:a.slice(),replacementMask:o.slice(),didShiftScale:s}}function v(e){for(var t=1/0,r=-1/0,n=e.length,i=0,a=e;i<a.length;i++){var o=a[i];t=Math.min(t,o),r=Math.max(r,o)}return{min:t,max:r,length:n}}function g(e,t,r,n){if(void 0!==r){var i=e.getInstruction(n);if(a.isLeafInstruction(i))for(var o=0,s=r;o<s.length;o++){(p=s[o]).valueMap[n]=n}else for(var u=0,c=r;u<c.length;u++){for(var p,d=(p=c[u]).chunk,f=p.valueMap,h=[],y=0,m=0,v=i.args;m<v.length;m++){var g=v[m];if(f[g]!==g){if((y+=1)>1)return void(r.length=0)}else for(var b=t[g],x=0;x<b.length;x++)if(b[x]&&p.replacementMask[x])return void(r.length=0);h.push(f[g])}f[n]=y>0?l.copyInstructionWithArgs(d,i,h):n}}}function b(e,t){for(var r,n=e.listAccessDependencyTable,i=e.listAccesses,a=e.listStatisticsTable,o=n[t],s=0;s<o.length;s++)if(o[s]){if(r)return;r={listAccessIndex:i[s],listStatistics:a[s]}}return r}function x(e,t){for(var r=0,n=e.listAccessDependencyTable[t];r<n.length;r++){if(n[r])return!0}return!1}function S(e,t){for(var r,i=[],a=0;a<=t;a++){if(e.getInstruction(a).type===n.LoadArg){var o=k(e.argNames.length);o[a]=!0,i.push(o)}else i.push(M(e,i,e.argNames.length,a))}var s=i[t];for(a=0;a<s.length;a++)if(s[a]){if(void 0!==r)return;r=a}return r}function T(e,t,i,a,o){var s=e.chunk,u=S(s,i);if(void 0!==u){var c=E(e,i,u);if(void 0!==c){var l=s.getInstruction(a),p=l.args[0];if(void 0!==(c=C(c,p,o))){var d=c.chunk,f=c.valueMap,h=d.getInstruction(f[p]);if(h.type===n.Add){var y=h.args[1],m=d.getInstruction(h.args[0]);if(m.type===n.Multiply){var v=m.args,g=v[0],b=v[1],x=u,T=y,w=g,_=b,I=d.Multiply([w,_]),M=d.SyntheticNativeFunction("cos",[I]),k=d.SyntheticNativeFunction("sin",[I]),P="sin"===l.symbol?d.Add([d.Multiply([x,k]),d.Multiply([T,M])]):d.Subtract([d.Multiply([x,M]),d.Multiply([T,k])]);f[t]=P;var O=c.replacementMask.slice();return O[u]=!0,O[g]=!0,O[y]=!0,{chunk:d,forwardParameterMap:function(e){var t=c.forwardParameterMap(e),r=t[u],n=t[y],i=r*Math.cos(n),a=r*Math.sin(n);return t[u]=i,t[y]=a,t},reverseParameterMap:function(e){var t=e.slice(),n=e[u],i=e[y],a=r.hypot(n,i),o=Math.atan2(i,n);return t[u]=a,t[y]=o,c.reverseParameterMap(t)},valueMap:f,replacementMask:O,isLazy:!1}}}}}}}function w(e,t,r,a){var o=e.chunk,s=o.getInstruction(t).args,u=s[0],c=s[1],l=o.getInstruction(u);if(l.type===n.Constant&&l.valueType===i.Number&&p.asFloat(l.value)>0){var d=y(e),f=d.chunk,h=d.valueMap,m=f.Multiply([f.SyntheticNativeFunction("ln",[h[u]]),h[c]]);return h[c]=m,h[t]=f.SyntheticNativeFunction("exp",[m]),I(d,t,c,r,a)||d}var v=S(o,u);if(void 0!==v){var g=E(e,u,v);if(void 0!==g){var b=g.chunk,x=g.valueMap,T=b.Multiply([x[u],x[c]]);x[c]=T,x[t]=b.SyntheticNativeFunction("exp",[T]);var w=g.replacementMask.slice();w[v]=!0;var _={chunk:b,forwardParameterMap:function(e){var t=g.forwardParameterMap(e),r=t[v],n=Math.log(r);return t[v]=n,t},reverseParameterMap:function(e){var t=e.slice(),r=t[v],n=Math.exp(r);return t[v]=n,g.reverseParameterMap(t)},isLazy:!1,valueMap:x,replacementMask:w};return I(_,t,c,r,a)||_}}}function _(e,t,r,n,i,a){if(e.isLazy||!e.didShiftScale){var o=e.isLazy?e:m(e),s=S(e.chunk,r);if(void 0!==s){var u=E(e,r,s);if(void 0!==u){var c=u.chunk,l=u.valueMap,p=c.getInstruction(l[n]).args[0],d=c.Add([p,l[r]]);l[r]=d,l[t]=c.SyntheticNativeFunction("exp",[d]);var f=u.replacementMask.slice();f[s]=!0;var h=y(o);h.valueMap[t]=h.chunk.Multiply([h.valueMap[r],h.valueMap[n]]);var v={chunk:c,forwardParameterMap:function(e){var t=u.forwardParameterMap(e),r=t[s],n=Math.log(r);return t[s]=n,t},reverseParameterMap:function(e){var t=e.slice(),r=t[s],n=Math.exp(r);return t[s]=n,u.reverseParameterMap(t)},isLazy:!1,valueMap:l,replacementMask:f},g=m(v);return g.forwardParameterMap=function(e){var t=u.forwardParameterMap(e),r=t[s],n=Math.log(-r);return t[s]=n,t},g.reverseParameterMap=function(e){var t=e.slice(),r=t[s],n=-Math.exp(r);return t[s]=n,u.reverseParameterMap(t)},v=I(v,t,r,i,a)||v,(g=I(g,t,r,i,a)||g).valueMap[t]=g.chunk.Negative([g.valueMap[t]]),[h,v,g]}}}}function I(e,t,r,i,a){var o=function(e,t,r,i){var a=C(e,t,r);if(void 0===a)return;var o=a.chunk,s=a.valueMap,u=o.getInstruction(s[t]);if(u.type!==n.Add)return;var c=u.args[1],l=o.getInstruction(u.args[0]);if(l.type!==n.Multiply)return;var p=l.args,d=p[0],f=p[1],h=i.min,y=i.max,m=y-h,v=.5*(y+h),g=o.Divide([o.Subtract([f,o.Constant(v)]),o.Constant(m)]),b=o.Add([o.Multiply([d,g]),c]);function x(e){var t=a.forwardParameterMap(e),r=t[d],n=t[c],i=r*m,o=n+v*r;return t[d]=i,t[c]=o,t}function S(e){var t=e.slice(),r=e[d],n=e[c],i=r/m,o=n-i*v;return t[d]=i,t[c]=o,a.reverseParameterMap(t)}return s[t]=b,{chunk:o,forwardParameterMap:x,reverseParameterMap:S,isLazy:!1,valueMap:s,replacementMask:a.replacementMask,didShiftScale:!0}}(e,r,i,a);if(void 0!==o)return o.valueMap[t]=o.chunk.SyntheticNativeFunction("exp",[o.valueMap[r]]),o}function E(e,t,r){var a=e.chunk,o=u.polynomialOrderContext(a,r,{allowRestriction:!1,allowClosedBlockReferences:!1});if(1===u.instructionOrder(o,t)){var s=c.polynomialCoefficientContext(o),l=c.instructionCoefficients(s,t),d=l[0],f=l[1];if(void 0!==f){var h=s.newChunk.getInstruction(d);if(h.type===n.Constant&&h.valueType===i.Number){var m=s.newChunk.getInstruction(f);if(m.type===n.Constant&&m.valueType===i.Number){var v=y(e),g=v.chunk,b=v.valueMap,x=p.asFloat(h.value),S=p.asFloat(m.value);b[t]=r;var T=v.replacementMask.slice();return T[r]=!0,{chunk:g,forwardParameterMap:function(e){var t=v.forwardParameterMap(e),n=t[r],i=x+S*n;return t[r]=i,t},reverseParameterMap:function(e){var t=e.slice(),n=(t[r]-x)/S;return t[r]=n,v.reverseParameterMap(t)},isLazy:!1,valueMap:b,replacementMask:T}}}}}}function C(e,t,r){var a=e.chunk,o=e.isLazy?t:e.valueMap[t],s=u.polynomialOrderContext(a,r,{allowRestriction:!1,allowClosedBlockReferences:!0});if(1===u.instructionOrder(s,o)){e.isLazy&&(s=u.polynomialOrderContext(a.copy().reopenFinalBlock(),r,{allowRestriction:!1,allowClosedBlockReferences:!1}));var l=c.polynomialCoefficientContext(s),d=c.instructionCoefficients(l,o),f=d[0],h=d[1];if(void 0!==h){for(var m,v,g=l.newChunk,b=Math.max(h,f),x=[],S=0;S<=b;S++){if(g.getInstruction(S).type===n.LoadArg){var T=k(g.argNames.length);T[S]=!0,x.push(T)}else x.push(M(g,x,g.argNames.length,S))}for(S=0;S<a.argNames.length;S++)if(x[h][S]){if(void 0!==m)return;m=S}else if(x[f][S]){if(void 0!==v)return;v=S}if(void 0!==m&&void 0!==v){var w=u.polynomialOrderContext(g,m,{allowRestriction:!1,allowClosedBlockReferences:!1});if(1===u.instructionOrder(w,h)){var _=u.polynomialOrderContext(g,v,{allowRestriction:!1,allowClosedBlockReferences:!1});if(1===u.instructionOrder(_,f)){var I=c.polynomialCoefficientContext(w),E=c.polynomialCoefficientContext(_),C=c.instructionCoefficients(I,h),P=C[0],O=C[1],L=I.newChunk.getInstruction(P);if(L.type===n.Constant&&L.valueType===i.Number){var N=I.newChunk.getInstruction(O);if(N.type===n.Constant&&N.valueType===i.Number){var A=y(e),D=A.chunk,R=A.valueMap,F=D.Add([D.Multiply([m,r]),v]);R[t]=F;var q=g.copy();q.List([h,f]);var B=q.close().getCompiledFunction().fn,V=p.asFloat(L.value),z=p.asFloat(N.value),j=c.instructionCoefficients(E,f),U=j[0],G=j[1],W=E.newChunk.copy();W.List([U,G]);var K=W.close().getCompiledFunction().fn,H=A.replacementMask.slice();return H[m]=!0,H[v]=!0,{chunk:D,forwardParameterMap:function(e){var t=A.forwardParameterMap(e),r=B.apply(null,t),n=r[0],i=r[1];return t[m]=n,t[v]=i,t},reverseParameterMap:function(e){var t=e.slice(),r=e[m],n=e[v],i=(r-V)/z,a=e.slice();a[m]=i,a.splice(v,1);var o=K.apply(null,a),s=(n-o[0])/o[1];return t[m]=i,t[v]=s,A.reverseParameterMap(t)},isLazy:!1,valueMap:R,replacementMask:H}}}}}}}}}function M(e,t,r,n){var i=e.getInstruction(n),o=k(r);if(a.isLeafInstruction(i))return o;for(var s=0,u=i.args;s<u.length;s++)for(var c=t[u[s]],l=0;l<c.length;l++)o[l]=o[l]||c[l];return o}function k(e){for(var t=[],r=0;r<e;r++)t.push(!1);return t}function P(e){for(var t=[],r=0;r<e;r++)t.push(r);return t}function O(e){return e.type===n.NativeFunction&&("sin"===e.symbol||"cos"===e.symbol)}Object.defineProperty(t,"__esModule",{value:!0}),t.reparameterizeRegression=void 0,t.reparameterizeRegression=function(e){var t=e.getInstruction(e.returnIndex);if(t.type===n.BroadcastResult){var r=t.args[0],u=e.returnIndex-r,c=e.getInstruction(r);if(2===c.args.length){var l=c.args[0],p=c.args[u],h=[],y=[];h.push(l),y.push({min:1,max:d.assertConstantListLength(e,e.returnIndex,"Programming error: cannot optimize regression on non-constant-length list"),length:d.assertConstantListLength(e,e.returnIndex,"Programming error: cannot optimize regression on non-constant-length list")});for(var m=!1,S=!1,E=l+1;E<=p;E++){if((F=e.getInstruction(E)).type===n.ListAccess||F.type===n.InboundsListAccess||F.type===n.DeferredListAccess){if(F.args[1]!==l)continue;var C=F.args[0];if(e.getInstruction(C).valueType!==i.ListOfNumber)continue;if(!o.isConstant(e.getInstruction(C)))continue;var P=v(s.asValue(e,C));if(!isFinite(P.min)||!isFinite(P.max))continue;h.push(E),y.push(P)}else if(F.type===n.NativeFunction)"exp"===F.symbol?S=!0:O(F)&&(m=!0);else if(F.type===n.Exponent||F.type===n.RawExponent)S=!0;else if(a.beginsBlock(F)||a.endsBlock(F))return}if(0!==h.length&&(S||m)){var L=[];for(E=0;E<=p;E++){if(-1!==(ae=h.indexOf(E)))(A=k(h.length))[ae]=!0,L.push(A);else L.push(M(e,L,h.length,E))}var N=[];for(E=0;E<=e.returnIndex;E++){var A;if((F=e.getInstruction(E)).type===n.LoadArg)(A=k(e.argNames.length))[E]=!0,N.push(A);else N.push(M(e,N,e.argNames.length,E))}var D={listAccessDependencyTable:L,listAccesses:h,listStatisticsTable:y},R=void 0;for(E=l+1;E<=e.returnIndex;E++){var F;switch((F=e.getInstruction(E)).type){case n.NativeFunction:if("exp"===F.symbol){var q=F.args[0],B=b(D,q);if(void 0===B){g(e,N,R,E);break}var V=B.listStatistics,z=B.listAccessIndex;(pe=I(f(e),E,q,z,V))?R=[pe]:g(e,N,R,E)}break;case n.Exponent:case n.RawExponent:var j=F.args,U=j[0],G=b(D,j[1]);if(void 0===G||x(D,U)){g(e,N,R,E);break}var W=G.listStatistics,K=G.listAccessIndex;(pe=w(f(e),E,K,W))?R=[pe]:g(e,N,R,E);break;case n.Multiply:if(R&&R.length>1){g(e,N,R,E);break}var H=R&&R.length>0?R[0]:f(e),J=F.args,Y=J[0],$=J[1],X=H.isLazy?Y:H.valueMap[Y],Z=H.isLazy?$:H.valueMap[$],Q=H.chunk.getInstruction(X),ee=H.chunk.getInstruction(Z),te=void 0,re=void 0,ne=void 0;if(Q.type===n.NativeFunction)te=Y,ne=Q,re=$;else{if(ee.type!==n.NativeFunction){g(e,N,R,E);break}te=$,ne=ee,re=Y}var ie=b(D,te);if(void 0===ie||x(D,re)){g(e,N,R,E);break}var ae=ie.listAccessIndex,oe=ie.listStatistics;if("exp"===ne.symbol){var se=_(H,E,re,te,ae,oe);if(se){R=se;break}}else if(O(ne)){if(pe=T(H,E,re,te,ae)){R=[pe];break}}g(e,N,R,E);break;default:g(e,N,R,E)}}if(void 0!==R&&0!==R.length){for(var ue=[],ce=0,le=R;ce<le.length;ce++){var pe=le[ce];ue.push({chunk:pe.chunk.close(),forwardParameterMap:pe.forwardParameterMap,reverseParameterMap:pe.reverseParameterMap})}return ue}}}}}});r("core/math/parsenode-from-value",["require","exports","parsenodes","core/math/types"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseNodeFromValue=void 0,t.parseNodeFromValue=function e(t,i){switch(t){case n.Number:case n.Bool:return r.Constant(i);case n.SeedType:return r.Seed(i);case n.Point:return r.ParenSeq([e(n.Number,i[0]),e(n.Number,i[1])]);case n.RGBColor:return r.FunctionCall("rgb",[e(n.Number,i[0]),e(n.Number,i[1]),e(n.Number,i[2])]);case n.EmptyList:case n.ListOfNumber:case n.ListOfBool:case n.ListOfPoint:case n.ListOfColor:case n.ListOfPolygon:case n.ErrorType:for(var a=[],o=n.elementType(t),s=0,u=i;s<u.length;s++){var c=u[s];a.push(e(o,c))}return r.List(a);case n.Polygon:return r.FunctionCall("\\polygon",[e(n.ListOfPoint,i)]);case n.Any:case n.Distribution:case n.ListOfAny:case n.ListOfDistribution:case n.Action:throw new Error("Programming error: cannot create parse node from valueType: "+n.repr(t));default:var l=t;throw new Error("Programming error: unexpected valueType: "+n.repr(l))}}});r("core/math/ir/features/optimize-regression",["require","exports","parsenodes","core/math/builtin","core/math/parsenode/irexpression","tslib","core/math/errormsg","core/math/distance","core/lib/label","core/math/types","core/math/least-squares","./reparameterize-regression","core/math/ir/build-ir","../../parsenode-from-value"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f){"use strict";function h(e,t,r){for(var n,i,a=e.policy,o=e.frame,s=0,u=t._rhs.getDependencies();s<u.length;s++){var l=u[s];if(!r.hasOwnProperty(l)){var p=o[l];if(p&&("Assignment"===p.type&&(p=p._expression),p.buildIRExpression)){var d=p.buildIRExpression(a,o);if(!d.isError&&d.valueType===c.ListOfNumber){if(void 0!==n){n=void 0,i=void 0;break}0===d.getDependencies().length&&(n=l,i=d)}}}}var f=Object.create(o);void 0!==n&&(f[n]=void 0);var h=t._rhs.buildIRExpression(a,f),y=Object.create(f);for(var m in r)y[m]=r[m];var v=t._rhs.buildIRExpression(a,y);return i?{node:h,substituted:v,listNode:i,isValid:!0}:{node:h,substituted:v,listNode:i,isValid:!1}}function y(e,t){var r=t.getDependencies(),n=t.getCompiledFunction(r).fn;if(r.length){for(var i=t.findLinearSubset(r),o=i.every(function(e){return e}),s=[],u=0,c=r;u<c.length;u++){var p=c[u];s.push(t.takeDerivative(p).getCompiledFunction(r).fn)}if(o)return a.__assign(a.__assign({},l.tryRoundingSmallParametersToZero(n,l.optimizeLinear(n,s))),{isLinear:o});for(var d=[],f=0,h=r;f<h.length;f++){p=h[f];d.push(t.boundDomain(p))}var y={linearSubset:i,bounds:d,preferredInitialGuess:e};return a.__assign(a.__assign({},l.tryRoundingSmallParametersToZero(n,l.optimizeNonLinear(n,s,y))),{isLinear:o})}return{solution:[],MSE:l.evaluateMeanSquare(n,[]),isLinear:!0}}function m(e,t){for(var n={},i=t.getDependencies(),a=0;a<i.length;a++)n[i[a]]=r.Constant(e[a]);return n}function v(e,t,i,a,u,p){if(a.getDependencies().length)throw o.optimizationError();var d=function(e){var t=0;return e.eachElement(function(e){var r=+e.asValue();t+=r*r}),t/e.length}(a);if(!isFinite(d))throw o.optimizationError();if(t.getDependencies().length>0)return{RMSE:Math.sqrt(d)};var f=c.isList(t.valueType)?n.varp(t.asValue()):0;if(t.getDependencies().length||!isFinite(f)||f<=0||!e.isLhsSimple)return{RMSE:Math.sqrt(d)};var h=1-d/f;if(i.isValid){var y=[],m=[],v=u&&(p===b.LINLOG||p===b.LOGLOG);r.List.eachArgs([i.listNode,t],function(e){y.push(v?Math.log(+e[0].asValue()):+e[0].asValue()),m.push(+e[1].asValue())});var g=n.corr(y,m);if(s.approx(function(e,t){function r(r,n){for(var i=[],a=0;a<e.length;a++)i.push(t[a]-(r*e[a]+n));return i}var n=[function(){return e.map(function(e){return-e})},function(){return e.map(function(){return-1})}];return l.optimizeLinear(r,n)}(y,m).MSE,d,8))return{r:g,rsquared:g*g}}return{Rsquared:h}}function g(e,t){var r=e.length,n=e[0],i=t[0],a=e[r-1],o=t[r-1];if(!(isFinite(n)&&isFinite(a)&&isFinite(i)&&isFinite(o)))return!1;if(o-i==0)return!1;var u=a-n;if(0===u)return!1;for(var c=1;c<r-1;c++){var l=e[c],p=t[c],d=(o*(l-n)+i*(a-l))/u;if(!s.approx(p,d,5))return!1}return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.tryOptimize=void 0,t.tryOptimize=function(e,t){try{return function(e,t){var n,i=e.policy,a=e.frame,s=e.exportFrame,l=e.lastExportFrame,p=e.priorAnalysis,d=t._lhs.buildIRExpression(i,a),f=t._rhs.buildIRExpression(i,a);if(d.isError)throw d;if(f.isError)throw f;if(d.valueType!==c.Number&&d.valueType!==c.ListOfNumber||f.valueType!==c.Number&&f.valueType!==c.ListOfNumber)throw o.regressionTypeError([c.prettyPrint(d.valueType),c.prettyPrint(f.valueType)]);var y=t._difference.buildIRExpression(i,a,{wrapInList:!0});if(y.isError)throw y;for(var m=0,T=y.getDependencies();m<T.length;m++){var w=T[m];if(!i.validRegressionParameter(w))throw o.invalidRegressionParameter(w)}var _,I=function(e,t,r){var n=[];t||(t={});r||(r={});for(var i=0,a=e;i<a.length;i++){var o=a[i],s=u.identifierToLatex(o);r[o]&&isFinite(r[o].asValue())?n.push(+r[o].asValue()):t.hasOwnProperty(s)&&isFinite(+t[s])?n.push(+t[s]):n.push(1)}return n}(y.getDependencies(),t.userData.regressionParameters,l),E=S(I,y),C=E.parameters,M=E.isLinear,k=E.parameterWarning,P={policy:i,frame:a},O=h(P,t,C),L=x(P,t._difference,C),N=function(e,t,n){if(!e.isLhsSimple)return b.NONE;if(!n.isValid)return b.NONE;var i=n.substituted;if(i.isError)return b.NONE;if(i.valueType!==c.Number)return b.NONE;var a=i.getDependencies();if(1!==a.length)return b.NONE;if(isFinite(n.node.polynomialOrder(a[0])))return b.NONE;var o=i.getCompiledFunction(a).fn,s=n.listNode;if(i.valueType!==c.Number)return b.NONE;var u=s.mapElements(function(e){return+e.asValue()});if(u.length<3)return b.NONE;u.sort(function(e,t){return e-t});var l=u.map(o),p=l.map(Math.log),d=u.map(Math.log),f=!0;return r.List.wrap(t).eachElement(function(e){isFinite(Math.log(+e.asValue()))||(f=!1)}),g(u,p)&&f?b.LOGLIN:g(d,p)&&f?b.LOGLOG:g(d,l)?b.LINLOG:b.NONE}(t,d,O);if(!t.userData.isLogModeRegression||N!==b.LOGLIN&&N!==b.LOGLOG)_=v(t,d,O,L,t.userData.isLogModeRegression,N);else{var A=t._logDifference.buildIRExpression(i,a,{wrapInList:!0});if(A.isError)throw A;var D=t._logLhs.buildIRExpression(i,a,{wrapInList:!0});if(D.isError)throw D;C=(n=S(I,A)).parameters,M=n.isLinear,k=n.parameterWarning,O=h(P,t,C),L=x(P,t._difference,C),_=v(t,D,O,x(P,t._logDifference,C),t.userData.isLogModeRegression,N)}var R=function(e,t){if(e.userData&&e.userData.residualVariable){var r=u.latexToIdentifier(e.userData.residualVariable);if(!t[r])return r}for(var n,i=e.getDependencies(),a=0,o=i;a<o.length;a++){var s=o[a].match(/_(.*)/);if(s&&!t[n="e_"+s[1]])return n}var c=1;for(;;){if(!t[n="e_"+c])return n;c++}}(t,s),F=function(e,t,r){var n,i=e._rhs.getDependencies();for(var a in r)if(r.hasOwnProperty(a)){var o=r[a].concreteTree;if(o.isTable&&o.columns[0]){var s=r[a].rawTree.columns;if(s&&s.length){var u=s[0].getExports();if(1===u.length&&-1!==i.indexOf(u[0])){for(var c=1;c<s.length;c++)if(-1!==s[c].getDependencies().indexOf(t))return;n=n||a}}}}return n||void 0}(t,R,p);return t.userData.residualVariable=u.identifierToLatex(R),r.OptimizedRegression(C,L,_,O.substituted,{isModelValid:O.isValid,residualVariable:R,residualSuggestionId:F,shouldSuggestLogMode:N!==b.NONE,isLinear:M,parameterWarning:k})}(e,t)}catch(e){return e instanceof r.Error?e:o.parseError()}};var b={NONE:0,LOGLIN:1,LOGLOG:2,LINLOG:3};function x(e,t,r){var n=e.policy,i=e.frame,a=Object.create(i);for(var o in r)r.hasOwnProperty(o)&&(a[o]=r[o]);var s=d.buildIR({policy:n,frame:a,wrapInList:!0},t);return f.parseNodeFromValue(s.getReturnType(),s.asCompilerValue())}function S(e,t){var r,n,a=t._chunk;if(a&&(n=p.reparameterizeRegression(a)),!n||0===n.length)return{parameters:m((r=y(e,t=t.deriveRegressionRestrictions())).solution,t),isLinear:r.isLinear,parameterWarning:!1};for(var o=t.getDependencies(),s=t.getCompiledFunction(o).fn,u=1/0,c={},d=!1,f=0,h=n;f<h.length;f++){var v=h[f],g=new i(v.chunk);if(g=g.deriveRegressionRestrictions(),(r=y(v.forwardParameterMap(e),g)).MSE<u){var b=v.reverseParameterMap(r.solution),x=l.evaluateMeanSquare(s,b);if(c&&(!isFinite(x)||x>=u)){isFinite(x)||(d=!0);continue}u=r.MSE,c=m(b,t)}}return{parameters:c,isLinear:!1,parameterWarning:d}}});r("core/math/features/analyze",["require","underscore","parsenodes","core/math/statementanalysis","core/math/builtin","core/math/builtinframe","core/math/errormsg","core/math/comparators","core/math/types","core/types/graphmode","core/math/expression-types","core/math/distribution-spec","core/math/workerconfig","core/math/ir/features/solve","core/math/ir/features/optimize-regression","core/math/ir/dependencies"],function(e){"use strict";var t=e("underscore"),r=e("parsenodes"),n=e("core/math/statementanalysis"),i=e("core/math/builtin"),a=e("core/math/builtinframe"),o=e("core/math/errormsg"),s=e("core/math/comparators"),u=e("core/math/types"),c=e("core/types/graphmode"),l=e("core/math/expression-types").ExpressionType,p=e("core/math/distribution-spec").DistributionParameterDefaultsMap,d=e("core/math/workerconfig"),f=e("core/math/ir/features/solve").trySolve,h=e("core/math/ir/features/optimize-regression").tryOptimize,y=e("core/math/ir/dependencies").getFreeDependencies;function m(e,t,r,i){if(i.isError)return n(e,r,i);var a=i.getDependencies();switch(i.valueType){case u.Distribution:case u.ListOfDistribution:case u.EmptyList:return n(e,r,i);case u.RGBColor:case u.ListOfColor:case u.Action:case u.Polygon:case u.ListOfPolygon:return a.length?n(e,r,o.tooManyVariables(r.getSliderVariables(e,i)).setDependencies(a)):n(e,r,i);case u.Point:case u.ListOfPoint:if(a.length){if(!e.validParametricVariables(a)){var s=r.getSliderVariables(e,i);return n(e,r,o.tooManyVariables(s).setDependencies(s))}return n(e,r,i)}return n(e,r,i);case u.Number:case u.ListOfNumber:return 0===a.length?n(e,r,i):a.length<=e.dimensions()-1?e.validExpressionVariables(a)?n(e,r,i):n(e,r,o.equationRequired(e.implicitDependency(a)).setDependencies(a)):e.validImplicitVariables(a)?n(e,r,o.equationRequired().setDependencies(a)):n(e,r,o.tooManyVariables(r.getSliderVariables(e,i)).setDependencies(a));default:return n(e,r,o.parseError())}}function v(e){return r.FunctionCall("pdf",[e,r.Identifier("x")])}function g(e,t){var r=this.tryGetConcreteTree(e,t),i=r.getDependencies();return i.length?n(e,this,o.tooManyVariables(this.getSliderVariables(e,r)).setDependencies(i)):n(e,this,this.tryGetConcreteTree(e,t))}function b(e){return function(t,r){var i=this.tryGetConcreteTree(t,r),a=i.getDependencies();if(a.length)return n(t,this,o.tooManyVariables(this.getSliderVariables(t,i)).setDependencies(a));var s=n(t,this,this.tryGetConcreteTree(t,r));if(!i.isError){s.evaluationState.expression_type=l.TTEST;var u=i.args.map(function(e){return e.asValue()});s.evaluationState.ttest_results=e.apply(null,u)}return s}}function x(e,t){return e.filter(function(e){return!t[e]})}r.Base.prototype.analyze=function(e,t){return n(e,this,this.tryGetConcreteTree(e,t))},r.FunctionCall.prototype.analyze=function(e,t){return m(e,0,this,p[this._symbol]&&0===y(t,this).length?v(this).tryGetConcreteTree(e,t):this.tryGetConcreteTree(e,t))},r.Expression.prototype.analyze=function(e,t){return m(e,0,this,this.tryGetConcreteTree(e,t))},r.FunctionDefinition.prototype.analyze=function(e,t){if(a[this._symbol])return this.asEquation().analyze(e,t);var r=this._symbol.split("_")[0];if(a[r]&&a[r].isFunction)return n(e,this,o.cannotRedefine(this._symbol,r));var i=this.tryGetConcreteTree(e,t);if(i.isError)return n(e,this,i);var s=this._argSymbols,u=i.getDependencies();if(-1!==u.indexOf(this._symbol))return n(e,this,o.selfReferentialFunction(this._symbol));var c=u.filter(function(e){return-1===s.indexOf(e)});if(e.unplottablePolarFunction(this._symbol,u))return n(e,this,o.unplottablePolarFunction());if(c.some(e.assignmentForbidden))return n(e,this,o.addArgumentsToDefinition(c,this._symbol,s).setDependencies(u));if(c.length){var l=this.getSliderVariables(e,i);return n(e,this,o.tooManyVariables(l).setDependencies(l))}return n(e,this,i)},r.Assignment.prototype.analyze=function(e,t,i){var s,c=this._symbol;if(!e.validLHS(c))return n(e,this,o.invalidLHS(c));if(a[c])return this.asEquation().analyze(e,t);if(this._expression instanceof r.FunctionCall&&p[this._expression._symbol]&&0===y(t,this).length)s=v(this._expression).tryGetConcreteTree(e,t);else{var l=Object.create(t);l[c]=e.validSolvedVariable(c)?void 0:o.invalidImplicitVariables(),s=this.tryGetConcreteTree(e,l)}if(s.isError)return n(e,this,s);var d=s.getDependencies();if(this.isEquation(s))return this.asEquation().analyze(e,t);var f=s.valueType===u.RGBColor||s.valueType===u.ListOfColor;if(d.length>1||f&&d.length){var h=this.getSliderVariables(e,s);return f||h.length?n(e,this,o.tooManyVariables(h).allowExport().setDependencies(h)):n(e,this,s)}var m=this.getMoveStrategy(e,t,s,i,this.userData);if(m){var g=this.getDefaultDragMode(m);return n(e,this,r.MovablePoint([s.elementAt(0),s.elementAt(1)],m,g))}return n(e,this,s)},r.Regression.prototype.analyze=function(e,t,r,i,a){return n(e,this,h({policy:e,frame:t,exportFrame:r,lastExportFrame:i,priorAnalysis:a},this))},r.Histogram.prototype.analyze=g,r.Object3D.prototype.analyze=g,r.DotPlot.prototype.analyze=g,r.BoxPlot.prototype.analyze=g,r.TTest.prototype.analyze=b(i.ttest),r.IndependentTTest.prototype.analyze=b(i.ittest),r.Stats.prototype.analyze=function(e,t){var r=this.tryGetConcreteTree(e,t),a=r.getDependencies();if(a.length)return n(e,this,o.tooManyVariables(this.getSliderVariables(e,r)).setDependencies(a));var s=n(e,this,this.tryGetConcreteTree(e,t));if(!r.isError){s.evaluationState.expression_type=l.STATS;var u=r.args.map(function(e){return e.asValue()});s.evaluationState.stats_results=i.stats.apply(null,u)}return s},r.Equation.prototype.analyze=r.BaseComparator.prototype.analyze=function(e,t){var i="="!==this.getOperator();if(!d.plotInequalities&&i)return n(e,this,o.inequalitiesDisabled());var a=f({policy:e,frame:t},this.asComparator());if(a.isError)return n(e,this,a);if(a instanceof r.SolvedEquation&&a.getDependencies().length){var s=a.getDependencies().concat(a._symbol);if(!e.validImplicitVariables(s))return n(e,this,o.invalidImplicitVariables().setDependencies(s))}return this.getGraphMode(e,a)!==c.IMPLICIT||e.validImplicitVariables(a.getDependencies())?n(e,this,a):n(e,this,o.invalidImplicitVariables().setDependencies(a.getDependencies()))},r.DoubleInequality.prototype.analyze=function(e,t){if(!d.plotInequalities)return n(e,this,o.inequalitiesDisabled());var r=this.tryGetConcreteTree(e,t);if(r.isError)return n(e,this,r);var i=r.getDependencies();return s.table[this._operators[0]].direction!==s.table[this._operators[1]].direction?n(e,this,o.mismatchedDoubleInequality()):e.validDoubleInequalitySymbol(r._symbol)&&e.validDoubleInequalityVariables(i)?i.length>2?n(e,this,o.tooManyVariables(this.getSliderVariables(e,r)).setDependencies(i)):-1!==r._expressions[0].getDependencies().indexOf(r._symbol)||-1!==r._expressions[1].getDependencies().indexOf(r._symbol)?n(e,this,o.complicatedDoubleInequality().setDependencies(i)):n(e,this,r):n(e,this,o.invalidDoubleInequalityVariables().setDependencies(i))},r.And.prototype.analyze=function(e,t){var r=this.tryGetConcreteTree(e,t);if(r.isError)return n(e,this,r);var i=r.getDependencies();return i.length?e.validDoubleInequalityVariables(i)?n(e,this,o.complicatedDoubleInequality().setDependencies(i)):n(e,this,o.tooManyVariables(this.getSliderVariables(e,r)).setDependencies(i)):n(e,this,r)},r.ParenSeq.prototype.analyze=function(e,t,i){var a=this.tryGetConcreteTree(e,t);if(a.isError)return n(e,this,a);var o=this.getMoveStrategy(e,t,a,i,this.userData);if(o){var s=this.getDefaultDragMode(o),u=a.asCompilerValue(),c=[r.Constant(u[0]),r.Constant(u[1])];return n(e,this,r.MovablePoint(c,o,s))}return m(e,0,this,a)},r.Table.prototype.analyze=function(e,t){for(var i=Object.create(t),a=Object.create(i),s=[],u=function(e){for(var t={},n=0;n<e.length;n++){var i=e[n];if(i.header instanceof r.Identifier){var a=i.header._symbol;void 0===t[a]&&(t[a]=0),t[a]+=1}}return t}(this.columns),c=0;c<this.columns.length;c++){var l=this.columns[c];if(l.header instanceof r.Identifier){var p=l.header._symbol,d=i[p],f=u[p]>1;d&&d.isError&&d.isMultiplyDefinedByTables&&!f&&(i[p]=void 0)}var h=l.analyze(e,i,a);if(0===c)if(h.concreteTree.isIndependent){var y=h.concreteTree.getDependencies()[0];e.validFirstColumnVariable(y)?a[y]=void 0:h=n(e,l,o.invalidFirstTableColumn())}else h=n(e,l,o.invalidDependentFirstTableColumn());if(h.concreteTree.isIndependent)h.rawTree.exportToLocal(h.concreteTree,i);else if(!h.concreteTree.isError){var m=x(h.concreteTree.header.getDependencies(),i);m.length&&(h=n(e,l,o.tooManyVariables(m).setDependencies(m)))}s.push(h.concreteTree)}var v=r.Table(s),g=n(e,this,v);return g.evaluationState.is_graphable=!0,g},r.TableColumn.prototype.analyze=function(e,t,r){var i=this.header.tableError();if(i)return n(e,this,o.invalidTableHeader(i));var a=this.tryGetConcreteTree(e,t,r);if(a.isError)return n(e,this,a);if(a.header.isError)return n(e,this,a.header);if(a.values.isError)return n(e,this,a.values);for(var s=0;s<a.values.length;s++)if(!a.values[s].isError){var u=this.values[s]&&this.values[s].tableError();if(u)a.values[s]=o.invalidTableEntry(u);else{var c=a.values[s].getDependencies();c.length&&(a.values[s]=o.tooManyVariables(c).setDependencies(c))}}return n(e,this,a)},r.Image.prototype.analyze=function(e,t,i){var a=this.tryGetConcreteTree(e,t);if(a.radianAngle.isError||a.center.isError||a.width.isError||a.height.isError||a.opacity.isError)return n(e,this,a);var s=a.center.getDependencies(),u=a.radianAngle.getDependencies(),c=a.width.getDependencies(),l=a.height.getDependencies(),p=a.opacity.getDependencies();return s.length||u.length||c.length||l.length||p.length?n(e,this,r.Image({center:s.length?o.tooManyVariables(u).setDependencies(s):a.center,radianAngle:u.length?o.tooManyVariables(u).setDependencies(u):a.radianAngle,width:c.length?o.tooManyVariables(c).setDependencies(c):a.width,height:l.length?o.tooManyVariables(l).setDependencies(l):a.height,opacity:p.length?o.tooManyVariables(p).setDependencies(p):a.opacity})):(a.moveStrategy=this.getMoveStrategy(e,t,a,i,this.userData),n(e,this,a))},r.Slider.prototype.analyze=function(e,r){var i,a=this.tryGetConcreteTree(e,r),s=a.sliderInfo;if(s.missingVars.length){var u=t.unique(s.missingVars);i=n(e,this,o.tooManyVariables(e.sliderVariables(u)).setDependencies(u).allowExport())}else i=n(e,this,a);var c=i.evaluationState;if(d.sliders){c.assignment=s.exportedSymbol,c.slider_min_number=s.values.min,c.slider_max_number=s.values.max,c.slider_step_number=s.values.step,c.slider_min_valid=s.valids.min,c.slider_max_valid=s.valids.max,c.slider_step_valid=s.valids.step;var l=c.slider_min_valid&&c.slider_max_valid&&c.slider_step_valid;c.is_slider=!0,c.raw_slider_latex=this.getInputString(),c.is_slidable=l,c.is_animatable=c.is_slidable&&!c.is_graphable,s.errMsg&&(c.error=s.errMsg.getError())}return delete c.is_evaluable,delete c.zero_values,i}});r("core/math/features/analyzeFourFunction",["require","parsenodes","core/math/statementanalysis","core/math/errormsg","core/math/builtinframe"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/statementanalysis"),n=e("core/math/errormsg"),i=e("core/math/builtinframe");function a(e,t){return r(e,this,n.inequalitiesUnsupported())}t.Base.prototype.analyzeFourFunction=function(e,t){var i=this.tryGetConcreteTree(e,t);return i.isError?r(e,this,i):r(e,this,n.parseError())},t.Expression.prototype.analyzeFourFunction=function(e,t){var a=this.tryGetConcreteTree(e,t);if(a.isError)return r(e,this,a);var o=a.getDependencies();if(o.length>0){var s,u=o[0],c=i[u];return s=c?c.isFunction?n.functionUnsupported(u):n.constantUnsupported(u):n.variablesUnsupported(u),r(e,this,s)}return r(e,this,a)},t.Assignment.prototype.analyzeFourFunction=function(e,t){return r(e,this,n.assignmentsUnsupported())},t.FunctionDefinition.prototype.analyzeFourFunction=function(e,t){return r(e,this,n.functionDefinitionsUnsupported())},t.Equation.prototype.analyzeFourFunction=function(e,t){return r(e,this,n.equationsUnsupported())},t.And.prototype.analyzeFourFunction=a,t.DoubleInequality.prototype.analyzeFourFunction=a,t.BaseComparator.prototype.analyzeFourFunction=a,t.Regression.prototype.analyzeFourFunction=function(e,t){return r(e,this,n.regressionsUnsupported())},t.ParenSeq.prototype.analyzeFourFunction=function(e,t){return r(e,this,n.pointsUnsupported())}});r("core/math/features/analyzeScientific",["require","parsenodes","core/math/statementanalysis","core/math/errormsg","core/math/builtinframe"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/statementanalysis"),n=e("core/math/errormsg"),i=e("core/math/builtinframe");function a(e,t){return r(e,this,n.inequalitiesUnsupported())}t.Base.prototype.analyzeScientific=function(e,t){var i=this.tryGetConcreteTree(e,t);return i.isError?r(e,this,i):r(e,this,n.parseError())},t.Expression.prototype.analyzeScientific=function(e,t){var i=this.tryGetConcreteTree(e,t);if(i.isError)return r(e,this,i);var a=i.getDependencies();return a.length>0?r(e,this,n.tooManyVariables(a)):r(e,this,i)},t.Assignment.prototype.analyzeScientific=function(e,t){var a=this._symbol;if(i[a])return r(e,this,n.cannotRedefine(a));var o=Object.create(t);o[a]=n.equationsUnsupported();var s=this.tryGetConcreteTree(e,o);if(s.isError)return r(e,this,s);var u=s.getDependencies();return this.isEquation(s)?r(e,this,n.equationsUnsupported()):u.length>0?r(e,this,n.tooManyVariables(u)):r(e,this,s)},t.FunctionDefinition.prototype.analyzeScientific=function(e,t){if(i[this._symbol])return r(e,this,n.cannotRedefine(this._symbol));var a=this.tryGetConcreteTree(e,t);if(a.isError)return r(e,this,a);var o=this._argSymbols,s=a.getDependencies();if(-1!==s.indexOf(this._symbol))return r(e,this,n.selfReferentialFunction(this._symbol));var u=s.filter(function(e){return-1===o.indexOf(e)});return u.length?r(e,this,n.addArgumentsToDefinition(u,this._symbol,o)):r(e,this,a)},t.Equation.prototype.analyzeScientific=function(e,t){return r(e,this,n.equationsUnsupported())},t.And.prototype.analyzeScientific=a,t.DoubleInequality.prototype.analyzeScientific=a,t.BaseComparator.prototype.analyzeScientific=a,t.Regression.prototype.analyzeScientific=function(e,t){return r(e,this,n.regressionsUnsupported())},t.ParenSeq.prototype.analyzeScientific=function(e,t){return r(e,this,n.pointsUnsupported())}});r("core/math/features/analyzeSingleExpressionScientific",["require","parsenodes","core/math/statementanalysis","core/math/errormsg","core/math/builtinframe"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/statementanalysis"),n=e("core/math/errormsg"),i=e("core/math/builtinframe");function a(e,t){return r(e,this,n.inequalitiesUnsupported())}t.Base.prototype.analyzeSingleExpressionScientific=function(e,t){var i=this.tryGetConcreteTree(e,t);return i.isError?r(e,this,i):r(e,this,n.parseError())},t.Expression.prototype.analyzeSingleExpressionScientific=function(e,t){var a=this.tryGetConcreteTree(e,t);if(a.isError)return r(e,this,a);var o=a.getDependencies();if(o.length>0){var s,u=o[0],c=i[u];return s=c?c.isFunction?n.functionUnsupported(u):n.constantUnsupported(u):n.variablesUnsupported(u),r(e,this,s)}return r(e,this,a)},t.Assignment.prototype.analyzeSingleExpressionScientific=function(e,t){return r(e,this,n.assignmentsUnsupported())},t.FunctionDefinition.prototype.analyzeSingleExpressionScientific=function(e,t){return r(e,this,n.functionDefinitionsUnsupported())},t.Equation.prototype.analyzeSingleExpressionScientific=function(e,t){return r(e,this,n.equationsUnsupported())},t.And.prototype.analyzeSingleExpressionScientific=a,t.DoubleInequality.prototype.analyzeSingleExpressionScientific=a,t.BaseComparator.prototype.analyzeSingleExpressionScientific=a,t.Regression.prototype.analyzeSingleExpressionScientific=function(e,t){return r(e,this,n.regressionsUnsupported())},t.ParenSeq.prototype.analyzeSingleExpressionScientific=function(e,t){return r(e,this,n.pointsUnsupported())}});r("core/lib/dragmode",["require","exports"],function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.reconcileDragMode=t.DragMode=void 0,function(e){e.NONE="NONE",e.X="X",e.Y="Y",e.XY="XY",e.AUTO="AUTO"}(r=t.DragMode||(t.DragMode={})),t.reconcileDragMode=function(e,t){var n=function(e){return e?"none"===e[0].type&&"none"===e[1].type?r.NONE:"none"===e[1].type?r.X:"none"===e[0].type?r.Y:r.XY:r.NONE}(t);switch(e){case r.NONE:return r.NONE;case r.AUTO:case r.XY:return n;case r.X:return n===r.X||n===r.XY?r.X:r.NONE;case r.Y:return n===r.Y||n===r.XY?r.Y:r.NONE;default:return r.NONE}}});r("core/math/features/getgraphmode",["require","parsenodes","core/types/graphmode","core/lib/dragmode","core/lib/dragmode","core/math/types"],function(e){"use strict";var t=e("parsenodes"),r=e("core/types/graphmode"),n=e("core/lib/dragmode").reconcileDragMode,i=e("core/lib/dragmode").DragMode,a=e("core/math/types");function o(e,t){if(t.isMovablePoint&&function(e,t){var r;return r=e&&e.hasOwnProperty("dragMode")?e.dragMode===i.AUTO?t.defaultDragMode:e.dragMode:t.defaultDragMode,n(r,t.moveStrategy)}(this.userData,t)!==i.NONE)return r.XYPOINT_MOVABLE;var o=t.getDependencies();switch(t.valueType){case a.Point:case a.ListOfPoint:return 0===o.length?r.XYPOINT:e.validParametricVariables(o)?2===e.dimensions()?r.PARAMETRIC:r.PARAMETRIC_CURVE_3D:r.NONE;case a.Number:case a.ListOfNumber:return 2===e.dimensions()&&1===o.length?r.Y:3===e.dimensions()&&2===o.length?r.Z_3D:r.NONE;case a.Polygon:case a.ListOfPolygon:return r.POLYGON;default:return r.NONE}}function s(e,t){var n=t._expression.getDependencies();if(n.length>1)return r.NONE;if(t._expression.isList&&0===t._expression.length)return r.NONE;var i=t._symbol;return e.graphMode(i,n)}function u(e,t){return t.isError?r.NONE:r.VISUALIZATION}t.Base.prototype.getGraphMode=function(e,t){return r.NONE},t.Expression.prototype.getGraphMode=o,t.Equation.prototype.getGraphMode=t.BaseComparator.prototype.getGraphMode=function(e,n){var i=n.getDependencies();return n.isConstant?r.NONE:n instanceof t.SolvedEquation?0===i.length?e.graphableAsConstant(n._symbol)?e.constantGraphMode(n._symbol):r.NONE:s(e,n):1===i.length||2===i.length?r.IMPLICIT:r.NONE},t.DoubleInequality.prototype.getGraphMode=function(e,t){return e.constantGraphMode(t._symbol)},t.Assignment.prototype.getGraphMode=function(e,n){if(n instanceof t.SolvedEquation)return s(e,n);if(this.isEquation(n))return this.asEquation().getGraphMode(e,n);var i=n.getDependencies();switch(n.valueType){case a.Number:case a.ListOfNumber:case a.EmptyList:switch(i.length){case 0:return e.graphableAsConstant(this._symbol)?e.constantGraphMode(this._symbol):r.NONE;case 1:return n.valueType!==a.ListOfNumber||e.graphableListVariables(this._symbol,i[0])?this.isSlider?r.NONE:e.graphMode(this._symbol,i):r.NONE;case 2:return 3===e.dimensions()&&"z"===this._symbol?r.Z_3D:r.NONE;default:return r.NONE}break;default:return o.call(this,e,n)}},t.FunctionDefinition.prototype.getGraphMode=function(e,t){if(1!==this._argSymbols.length)return r.NONE;var n=e.graphMode(this._symbol,this._argSymbols),i=t.getDependencies();switch(t.valueType){case a.Number:case a.ListOfNumber:switch(i.length){case 0:return n;case 1:return i[0]!==this._argSymbols[0]?r.NONE:n;default:return r.NONE}break;default:return r.NONE}},t.Regression.prototype.getGraphMode=function(e,t){return this.isLhsSimple&&t.isModelValid?1!==t.model.getDependencies().length?r.NONE:r.Y:r.NONE},t.Object3D.prototype.getGraphMode=function(e,t){return t.isError?r.NONE:r.OBJECT3D},t.Histogram.prototype.getGraphMode=u,t.DotPlot.prototype.getGraphMode=u,t.BoxPlot.prototype.getGraphMode=u,t.Image.prototype.getGraphMode=function(e,t){return this.userData.showPoints?this.center.isError||this.radianAngle.isError||this.width.isError||this.height.isError||this.opacity.isError?r.NONE:r.XYPOINT:r.NONE}});r("core/lib/color-helpers",["require","exports"],function(e,t){"use strict";function r(e){return n(e)?(e.match(/^#([A-Fa-f0-9]{3})$/g)&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),e.toLowerCase()):e}function n(e){return"string"==typeof e&&(e.match(/^#([A-Fa-f0-9]{3})$/g)||e.match(/^#([A-Fa-f0-9]{6})$/g))}Object.defineProperty(t,"__esModule",{value:!0}),t.colors=t.getDisplayColor=t.mutateOpacity=t.parseHex=t.invertColor=t.shadeColor=t.isValidHexColor=t.normalizeColor=void 0,t.normalizeColor=r,t.isValidHexColor=n,t.shadeColor=function(e,t){if(!n(e=r(e)))return e;t>1&&(t=1),t<-1&&(t=-1);var i=parseInt(e.slice(1),16),a=t<0?0:255,o=t<0?-1*t:t,s=i>>16,u=i>>8&255,c=255&i;return"#"+(16777216+65536*(Math.round((a-s)*o)+s)+256*(Math.round((a-u)*o)+u)+(Math.round((a-c)*o)+c)).toString(16).slice(1)},t.invertColor=function(e){if(!n(e=r(e)))return e;var t="0123456789abcdef";return"#"+e.slice(1).split("").map(function(e){return t[15-t.indexOf(e)]}).join("")},t.parseHex=function(e){if(3===(e=e.replace(/#/,"")).length)var t=parseInt(e.slice(0,1)+e.slice(0,1),16),r=parseInt(e.slice(1,2)+e.slice(1,2),16),n=parseInt(e.slice(2,3)+e.slice(2,3),16);else if(6===e.length)t=parseInt(e.slice(0,2),16),r=parseInt(e.slice(2,4),16),n=parseInt(e.slice(4,6),16);else t=0,r=0,n=0;return{r:t,g:r,b:n}},t.mutateOpacity=function(e,t){var r=/(rgba\([\d]+\,\ ?[\d]+\,\ ?[\d]+\,\ ?)[\d.]+(\))/;return e.match(r)?e.replace(r,"$1"+t+"$2"):e},t.getDisplayColor=function(e,t){if(t&&t.colorLatexValue){var r=t.colorLatexValue;return Array.isArray(r)?r[0]:r}return e.color},t.colors={RED:"#c74440",BLUE:"#2d70b3",GREEN:"#388c46",PURPLE:"#6042a6",ORANGE:"#fa7e19",BLACK:"#000000",GRAY:"#aaaaaa"}});r("core/math/features/getgraphinfo",["require","parsenodes","core/math/domaintypes","core/math/types","core/lib/color-helpers"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/domaintypes"),n=e("core/math/types"),i=e("core/lib/color-helpers").getDisplayColor;function a(e){switch(e.valueType){case n.Number:return o(e);case n.Point:var t=o(e.elementAt(0)),r=o(e.elementAt(1));if(!t||!r)return;return[t,r];default:return}}function o(e){var t=e.getDependencies();switch(t.length){case 0:return[+e.asValue(),0];case 1:if(e.polynomialOrder(t[0])>1)return;var r=e.getPolynomialCoefficients(t[0]);return[r[0]?+r[0].asValue():0,r[1]?+r[1].asValue():0];default:return}}t.Base.prototype.getGraphInfo=function(e,t){var n,o,s=t.getDependencies();switch(s.length){case 0:n=a(t),o=t.boundDomain("x");break;case 1:"known"===(o=t.boundDomain(s[0])).type&&(n=a(t));break;case 2:o=r.unknownDomain()}return{graphMode:this.getGraphMode(e,t),color:i(this.userData,this.metaData),pointStyle:this.userData.pointStyle,lineStyle:this.userData.lineStyle,operator:this.getOperator(),isLinear:!!n,linearCoefficients:n,domainBound:o}}});r("core/math/features/getMoveStrategy",["require","parsenodes","core/math/types","core/math/maybe-rational","core/math/functions"],function(e){"use strict";var t=e("parsenodes"),r=e("core/math/types"),n=e("core/math/maybe-rational").maybeRational,i=e("core/math/functions"),a=t.Constant(n(0,1));function o(e){return{type:"none",inputString:e}}function s(e){return{type:"updateCoordinate",inputString:e}}function u(e,t,r){return{type:"updateSlider",inputString:e,id:t,coefficients:r}}function c(e,t,r,n){return{type:"updateSliderNonlinear",inputString:e,id:t,initialValue:r.constant_value,min:r.slider_min_number,max:r.slider_max_number,compiled:n}}function l(e,t,r,n,i,o){for(var s=t.getDependencies(),u=0;u<s.length;u++)if(i[s[u]])return!1;for(var c=s.length-1;c>=0;c--){var l=s[c];if(!o[l]){var p=n[l];if(void 0!==p){var d=r[l];if(1===d.order){var f=d.tree.getPolynomialCoefficients(l),h=f[1]||a,y=f[0]||a;if(y.isConstant&&h.isConstant)if(isFinite(y.asValue())&&isFinite(h.asValue()))if(0!==h.asValue())return{symbol:l,id:p,coefficients:[-y.asValue()/h.asValue(),1/h.asValue()]}}}}}return!1}function p(e,t){var r=function(e){for(var t={},r=0;r<e.length;r++)t[e[r]]=!0;return t}(e),n={};for(var i in t){var a=t[i].evaluationState.assignment;t[i].evaluationState.is_slidable&&r[a]&&(n[a]=i)}return n}function d(e,t,r,n){for(var i=[],a=0;a<r.length;a++){var o=r[a],s={};i.push(s);for(var u=0;u<n.length;u++){var c=n[u],l=Object.create(t);l[c]=void 0;var p=o.tryGetConcreteTree(e,l);p.isError?s[c]={tree:p,order:1/0}:s[c]={tree:p,order:p.polynomialOrder(c)}}}return i}function f(e,t,r){for(var n=0;n<e.length;n++){var i=e[n];0!==t[i].order&&(r[i]=!0)}}t.Base.prototype.getMoveStrategy=function(){},t.Assignment.prototype.getMoveStrategy=function(e,r,n,i,a){if(this._expression instanceof t.ParenSeq)return this._expression.getMoveStrategy(e,r,n,i,a)},t.ParenSeq.prototype.getMoveStrategy=function(e,t,n,a,h){if(n.valueType===r.Point&&0===n.getDependencies().length){for(var y=p(this.getDependencies(),a),m=Object.keys(y),v=this.args,g=d(e,t,v,m),b=[],x={},S={},T=0;T<2;T++){var w=v[T],_=w.getInputString();if(w.isConstant)b[T]=s(_);else{var I=l(0,w,g[T],y,x,S);I&&(b[T]=u(_,I.id,I.coefficients),x[I.symbol]=!0,f(m,g[T],S)),b[T]||(b[T]=o(_))}}if("none"!==b[0].type||"none"!==b[1].type)return b;if(1===m.length){var E,C=m[0],M=y[C];try{var k=Object.create(t);k[C]=void 0,E=this.getConcreteTree(e,k).getCompiledFunction()}catch(e){return}return i.dehydrateCompiledFunction(E),[c(v[0].getInputString(),M,a[M].evaluationState,E),o(v[1].getInputString())]}}},t.Image.prototype.getMoveStrategy=function(e,t,n,i,a){if(n.center.valueType===r.Point&&0===n.center.getDependencies().length&&n.width.isConstant&&n.height.isConstant&&n.radianAngle.isConstant&&n.opacity.isConstant){var c=p(this.getDependencies(),i),h=Object.keys(c),y=[this.width,this.height];"ParenSeq"===this.center.type?y.push(this.center.args[0],this.center.args[1]):"Identifier"===this.center.type&&(this.center.referencedStatementId=function(e,t){for(var r in t)if(t[r].evaluationState.assignment===e)return r}(this.center._symbol,i));for(var m=[],v={},g={},b=d(e,t,y,h),x=[2,3,0,1],S=0;S<x.length;S++){var T=x[S],w=y[T];if(w){var _=w.getInputString();if(w.isConstant)m[T]=s(_);else{var I=l(0,w,b[T],c,v,g);I&&(m[T]=u(_,I.id,I.coefficients),v[I.symbol]=!0,f(h,b[T],g)),m[T]||(m[T]=o(_))}}else m[T]=o("")}if("none"!==m[0].type||"none"!==m[1].type||"none"!==m[2].type||"none"!==m[3].type)return m}}});r("core/math/features/getDefaultDragMode",["require","parsenodes","core/lib/dragmode"],function(e){"use strict";var t=e("parsenodes"),r=e("core/lib/dragmode").DragMode;t.Base.prototype.getMoveStrategy=function(){return r.NONE},t.Assignment.prototype.getDefaultDragMode=function(e){return"none"!==e[0].type&&"none"!==e[1].type?r.XY:"none"!==e[0].type?r.X:"none"!==e[1].type?r.Y:r.NONE},t.ParenSeq.prototype.getDefaultDragMode=function(e){return"updateSlider"===e[0].type&&"updateSlider"===e[1].type?r.XY:"updateSlider"===e[0].type?r.X:"updateSlider"===e[1].type?r.Y:r.NONE}});r("core/math/features/tableinfo",["require","parsenodes","core/math/types","core/lib/label","core/math/distribution-spec"],function(e){"use strict";var t=e("parsenodes"),r=t.List,n=e("core/math/types"),i=e("core/lib/label"),a=e("core/math/distribution-spec").getFunctionSpecFromTree;t.Base.prototype.tableInfo=function(e,t){return!1},t.Identifier.prototype.tableInfo=function(e,t){return!!e.validFirstColumnVariable(this._symbol)&&{independent_variable:this._symbol,dependent_column:this.getInputString(),by_reference:!1}},t.Expression.prototype.tableInfo=function(e,t){var i=t.getDependencies();if(a(this))return!1;switch(t.valueType){case n.Point:case n.ListOfPoint:return 0===i.length&&((!t.isMovablePoint||"updateSlider"!==t.moveStrategy[0].type&&"updateSlider"!==t.moveStrategy[1].type)&&{independent_variable:"x",dependent_column:"y",by_reference:!1,values:r.wrap(t).asValue()});case n.Number:if(1!==i.length)return!1;var o=i[0];return!!e.validFirstColumnVariable(o)&&{independent_variable:o,dependent_column:this.getInputString(),by_reference:!1};default:return!1}},t.Assignment.prototype.tableInfo=function(e,r){if(r instanceof t.SolvedEquation)return!1;if(!this.getInputString().length)return!1;if(a(this))return!1;var n,o=r.getDependencies();if(o.length>1)return!1;if(0===o.length){if(!e.tableableAsConstant(this._symbol))return!1;n=e.implicitIndependent(this._symbol)}else n=o[0];return!!e.validFirstColumnVariable(n)&&{independent_variable:n,dependent_column:e.assignmentForbidden(this._symbol)?i.trimLatex(this.getInputString().replace(/[^=]*=/,"")):i.trimLatex(this.getInputString().split("=")[0]),by_reference:!e.assignmentForbidden(this._symbol)}},t.FunctionDefinition.prototype.tableInfo=function(e,t){if(1!==this._argSymbols.length)return!1;if(!this.getInputString().length)return!1;if(t.getDependencies().length>1)return!1;var r=this._argSymbols[0];if(!e.validFirstColumnVariable(r))return!1;var n=e.assignmentForbidden(this._symbol);return{independent_variable:r,dependent_column:n?i.trimLatex(this.getInputString().replace(/[^=]*=/,"")):i.trimLatex(this.getInputString().split("=")[0]),by_reference:!n}},t.BaseComparator.prototype.tableInfo=function(e,t){return!1},t.DoubleInequality.prototype.tableInfo=function(e,t){return!1},t.Equation.prototype.tableInfo=function(e,t){return!1}});r("core/math/features/tableerror",["require","parsenodes","core/lib/worker-i18n"],function(e){"use strict";var t=e("parsenodes"),r=e("core/lib/worker-i18n");t.Base.prototype.tableError=function(){return this.isInequality()?r.s("shared-calculator-error-table-inequality-supplement"):!(this instanceof t.Expression||this instanceof t.IRExpression)&&r.s("shared-calculator-error-table-generic-supplement")},t.List.prototype.tableError=function(){return r.s("shared-calculator-error-table-list-supplement")},t.Equation.prototype.tableError=t.Assignment.prototype.tableError=function(){return r.s("shared-calculator-error-table-equation-supplement")},t.FunctionDefinition.prototype.tableError=function(){return r.s("shared-calculator-error-table-function-definition-supplement")},t.Regression.prototype.tableError=function(){return r.s("shared-calculator-error-table-regression-supplement")}});r("core/math/curve-accumulator",["require","exports","core/math/distance"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Accumulator=void 0;var n=function(){function e(e){e?(this.xtolerance=e.xtolerance||e.tolerance||0,this.ytolerance=e.ytolerance||e.tolerance||0,this.ztolerance=e.ztolerance||e.tolerance||0,this.map=e.map):this.xtolerance=this.ytolerance=this.ztolerance=0,this.segments=[],this.segment=[],this.pivotPoint=void 0,this.pendingPoint=void 0}return e.prototype.colinear=function(e,t,n){this.map&&(e=this.map(e),t=this.map(t),n=this.map(n));var i=r.pointToSegmentParameter(n[0],n[1],n[2]||0,e[0],e[1],e[2]||0,t[0],t[1],t[2]||0);if(i<1)return!1;var a=[e[0]+i*(t[0]-e[0]),e[1]+i*(t[1]-e[1]),3===e.length?e[2]+i*(t[2]-e[2]):0];return Math.abs(n[0]-a[0])<=this.xtolerance&&Math.abs(n[1]-a[1])<=this.ytolerance&&(2===e.length||Math.abs(n[2]-a[2])<=this.ztolerance)},e.prototype.addPoint=function(e){if(this.dimensions=e.length,this.xtolerance<0&&this.ytolerance<0&&(2===this.dimensions||this.ztolerance<0))this.segment.push.apply(this.segment,e);else if(this.segment.length){var t=2===this.dimensions?[this.segment[this.segment.length-2],this.segment[this.segment.length-1]]:[this.segment[this.segment.length-3],this.segment[this.segment.length-2],this.segment[this.segment.length-1]];if(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]){if(!this.pivotPoint||!this.pendingPoint)return this.pivotPoint=e,void(this.pendingPoint=e);(!this.colinear(t,this.pivotPoint,e)||r.hypot(t[0]-e[0],t[1]-e[1],(t[2]||0)-(e[2]||0))<r.hypot(t[0]-this.pendingPoint[0],t[1]-this.pendingPoint[1],(t[2]||0)-(this.pendingPoint[2]||0)))&&(this.flushPending(),this.pivotPoint=e),this.pendingPoint=e}}else this.segment.push.apply(this.segment,e)},e.prototype.flushPending=function(){this.pendingPoint&&(this.segment.push.apply(this.segment,this.pendingPoint),this.pivotPoint=void 0,this.pendingPoint=void 0)},e.prototype.breakSegment=function(){this.flushPending(),this.segment.length>(this.dimensions||2)&&this.segments.push(this.segment),this.segment=[]},e.prototype.getSegments=function(){return this.breakSegment(),this.segments},e.prototype.finish=function(){return{segments:this.getSegments(),resolved:!0}},e}();t.Accumulator=n});r("core/math/implicit-plotter",["require","exports","core/math/distance","./curve-accumulator"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.displayTriangles=t.traceContours=t.triangulate=t.buildQuadTree=t.sampleImplicitDiagnostic=t.sampleImplicit=void 0;var i=Math.pow(2,14);function a(e,t){var r=Math.pow(2,-5),n=c(t,r),i=c(t,2*r),a=d(e,n,i),o=_(a.root,e,n);return{paddedDomain:n,rootDomain:i,quadTree:a,triangles:o,contours:N(o,e,n)}}function o(e,t,r){return{x:e,y:t,z:r}}function s(e,t,r){return{x:e,y:t,isZero:r}}function u(e,t,r){return{vertices:[e,t,r],visited:!1,next:void 0}}function c(e,t){var r=(1+t)*e.xmin-t*e.xmax,n=(1+t)*e.xmax-t*e.xmin;return{xmin:r,ymin:(1+t)*e.ymin-t*e.ymax,xmax:n,ymax:(1+t)*e.ymax-t*e.ymin,xtolerance:e.xtolerance,ytolerance:e.ytolerance}}function l(e,t){return{depth:e,vertices:t,children:void 0,center:void 0}}function p(e,t,r){e.center=S(e.vertices[0],e.vertices[1],e.vertices[2],e.vertices[3],t,r)}function d(e,t,r){var n=function(e,t){var r=t.xmin,n=t.xmax,i=t.ymin,a=t.ymax;return l(0,[g(r,a,e),g(n,a,e),g(n,i,e),g(r,i,e)])}(e,r),a=[],o=[];o.push(n);var s=1,u=!0;e:for(;o.length;){var c=a;a=o,o=c;for(var d=void 0;d=a.pop();)if(h(d,e,t)){if(f(d,e),!d.children){u=!1;break e}if(o.push(d.children[0]),o.push(d.children[1]),o.push(d.children[2]),o.push(d.children[3]),(s+=3)>=i){u=!1;break e}}else p(d,e,t)}for(var y=0;y<a.length;y++)p(a[y],e,t);for(y=0;y<o.length;y++)p(o[y],e,t);return{root:n,resolved:u}}function f(e,t){var r=e.depth+1,n=e.vertices[0],i=e.vertices[1],a=e.vertices[2],o=e.vertices[3],s=b(n,i,t),u=b(i,a,t),c=b(a,o,t),p=b(o,n,t),d=b(n,a,t);e.children=[l(r,[n,s,d,p]),l(r,[s,i,u,d]),l(r,[d,u,a,c]),l(r,[p,d,c,o])]}function h(e,t,r){if(e.depth<5)return!0;if(function(e,t){return e.vertices[0].x<t.xmin||e.vertices[0].y>t.ymax||e.vertices[2].x>t.xmax||e.vertices[2].y<t.ymin}(e,r))return!1;if(function(e,t){if(e.vertices[1].x-e.vertices[0].x<10*t.xtolerance)return!0;if(e.vertices[0].y-e.vertices[3].y<10*t.ytolerance)return!0;return!1}(e,r))return!1;var n=e.vertices[0],i=e.vertices[1],a=e.vertices[2],o=e.vertices[3];if(isNaN(n.z)&&isNaN(i.z)&&isNaN(a.z)&&isNaN(o.z))return!1;if(isNaN(n.z)||isNaN(i.z)||isNaN(a.z)||isNaN(o.z))return!0;var s=S(n,i,a,o,t,r),u=x(n,i,t,r),c=x(i,a,t,r),l=x(a,o,t,r),p=x(o,n,t,r);return m(n,u,t)||m(i,u,t)||m(i,c,t)||m(a,c,t)||m(a,l,t)||m(o,l,t)||m(o,p,t)||m(n,p,t)||y(n,u,s,t,r)||y(u,i,s,t,r)||y(i,c,s,t,r)||y(c,a,s,t,r)||y(a,l,s,t,r)||y(l,o,s,t,r)||y(o,p,s,t,r)||y(p,n,s,t,r)}function y(e,t,n,i,a){if(e.z>0==t.z>0&&t.z>0==n.z>0)return!1;var o,s,u,c;if(e.z>0==t.z>0){if((o=b(e,t,i)).z>0!=e.z>0)return!0;s=w(e,n,i,a),u=w(t,n,i,a),c=w(o,n,i,a)}else if(t.z>0==n.z>0){if((o=b(t,n,i)).z>0!=t.z>0)return!0;s=w(t,e,i,a),u=w(n,e,i,a),c=w(o,e,i,a)}else{if((o=b(n,e,i)).z>0!=n.z>0)return!0;s=w(n,t,i,a),u=w(e,t,i,a),c=w(o,t,i,a)}var l=a.xtolerance,p=a.ytolerance;return r.pointToSegment(p*c.x,l*c.y,p*s.x,l*s.y,p*u.x,l*u.y)>l*p}function m(e,t,r){if(isNaN(e.z)&&isNaN(t.z))return!1;if(isNaN(e.z)||isNaN(t.z))return e.z>0||t.z>0;var n=4*b(e,t,r).z-t.z-3*e.z,i=1e-4,a=(r(.9999*e.x+i*t.x,.9999*e.y+i*t.y)-e.z)/i,o=Math.max(Math.abs(e.z),Math.abs(t.z));return Math.abs(n-a)>.125*o}function v(e,t){return e.x<t.xmin||e.x>t.xmax||e.y<t.ymin||e.y>t.ymax}function g(e,t,r){return o(e,t,r(e,t))}function b(e,t,r){return g(.5*(e.x+t.x),.5*(e.y+t.y),r)}function x(e,t,r,n){if(v(e,n)||v(t,n))return b(e,t,r);if(isNaN(e.z)||isNaN(t.z))return function(e,t,r,n){if(isNaN(e.z)===isNaN(t.z))return b(e,t,r);if(isNaN(e.z)){var i=e;e=t,t=i}var a=e.x,s=t.x,u=e.y,c=t.y,l=e.z,p=n.xtolerance,d=n.ytolerance;for(;Math.abs(a-s)>p||Math.abs(u-c)>d;){var f=.5*(a+s),h=.5*(u+c),y=r(f,h);isNaN(y)===isNaN(l)?(a=f,u=h,l=y):(s=f,c=h)}return o(a,u,l)}(e,t,r,n);if(e.z>0!=t.z>0)return b(e,t,r);var i=.01,a=r(.99*e.x+i*t.x,.99*e.y+i*t.y)-e.z,s=t.z-r(i*e.x+.99*t.x,i*e.y+.99*t.y);return isNaN(a)||isNaN(s)||a>0==s>0?b(e,t,r):T(o(e.x,e.y,a),o(t.x,t.y,s),r)}function S(e,t,r,n,i,a){var o=x(e,r,i,a);return e.z>0==r.z>0&&o.z>0!=e.z>0?o:(o=x(t,n,i,a),t.z>0==n.z>0&&o.z>0!=t.z>0?o:b(e,r,i))}function T(e,t,r){if(isNaN(e.z))return t;if(isNaN(t.z))return e;if(isFinite(e.z)||isFinite(t.z)){if(isFinite(e.z)){if(isFinite(t.z)){var n=1-e.z/t.z,i=1-t.z/e.z;return g(e.x/n+t.x/i,e.y/n+t.y/i,r)}return e}return t}return b(e,t,r)}function w(e,t,r,n){var i=e.x,a=t.x,u=e.y,c=t.y,l=e.z,p=t.z,d=n.xtolerance,f=n.ytolerance;if(v(e,n)||v(t,n)){var h=b(e,t,r);return s(h.x,h.y,!1)}for(;Math.abs(i-a)>d||Math.abs(u-c)>f;){var y=.5*(i+a),m=.5*(u+c),g=r(y,m);g>0==l>0?(i=y,u=m,l=g):(a=y,c=m,p=g)}if(isNaN(l))return s(a,c,!1);if(isNaN(p))return s(i,u,!1);var x=T(o(i,u,l),o(a,c,p),r),S=0===l||0===p||0===x.z||x.z>=l==p>=x.z&&Math.abs(x.z)<1e250;return s(x.x,x.y,S)}function _(e,t,r){var n={triangles:[],edgeCache:{},domain:r,fn:t};return I(e,n),n.triangles}function I(e,t){e.children&&(I(e.children[0],t),I(e.children[1],t),I(e.children[2],t),I(e.children[3],t),E(e.children[0],e.children[1],t),E(e.children[3],e.children[2],t),C(e.children[1],e.children[2],t),C(e.children[0],e.children[3],t))}function E(e,t,r){e.children&&t.children?(E(e.children[1],t.children[0],r),E(e.children[2],t.children[3],r)):e.children?(E(e.children[1],t,r),E(e.children[2],t,r)):t.children?(E(e,t.children[0],r),E(e,t.children[3],r)):function(e,t,r){if(!e.center||!t.center)return;var n,i;e.depth>=t.depth?(n=x(e.vertices[1],e.vertices[2],r.fn,r.domain),i=M(e.vertices[1],t.center,e.vertices[2],e.center,n)):(n=x(t.vertices[0],t.vertices[3],r.fn,r.domain),i=M(t.vertices[0],t.center,t.vertices[3],e.center,n));O(i,r.edgeCache,r.domain);for(var a=0;a<4;a++)r.triangles.push(i[a])}(e,t,r)}function C(e,t,r){e.children&&t.children?(C(e.children[2],t.children[1],r),C(e.children[3],t.children[0],r)):e.children?(C(e.children[2],t,r),C(e.children[3],t,r)):t.children?(C(e,t.children[1],r),C(e,t.children[0],r)):function(e,t,r){if(!e.center||!t.center)return;var n,i;e.depth>=t.depth?(n=x(e.vertices[3],e.vertices[2],r.fn,r.domain),i=M(e.vertices[2],t.center,e.vertices[3],e.center,n)):(n=x(t.vertices[1],t.vertices[0],r.fn,r.domain),i=M(t.vertices[1],t.center,t.vertices[0],e.center,n));O(i,r.edgeCache,r.domain);for(var a=0;a<4;a++)r.triangles.push(i[a])}(e,t,r)}function M(e,t,r,n,i){return[u(e,i,t),u(t,i,r),u(r,i,n),u(n,i,e)]}function k(e,t,r){return e.z>0&&!v(e,r)&&(!(t.z>0)||v(t,r))}function P(e,t){return e.x+","+e.y+","+t.x+","+t.y}function O(e,t,r){L(e[0],e[1],e[2],P(e[1].vertices[2],e[1].vertices[0]),t,r),L(e[1],e[2],e[3],P(e[2].vertices[0],e[2].vertices[2]),t,r),L(e[2],e[3],e[0],P(e[3].vertices[2],e[3].vertices[0]),t,r),L(e[3],e[0],e[1],P(e[0].vertices[0],e[0].vertices[2]),t,r)}function L(e,t,r,n,i,a){var o=t.vertices[0],s=t.vertices[1],u=t.vertices[2];k(s,u,a)&&(t.next=r),k(o,s,a)&&(t.next=e),k(u,o,a)&&function(e,t,r){r[t]?e.next=r[t]:r[t]=e}(t,n,i),k(o,u,a)&&function(e,t,r){r[t]?r[t].next=e:r[t]=e}(t,n,i)}function N(e,t,r){for(var i={fillAccumulator:new n.Accumulator(r),strokeAccumulator:new n.Accumulator(r),fn:t,domain:r},a=0;a<e.length;a++){var o=e[a];o.next&&!o.visited&&A(o,i)}return{strokeSegments:i.strokeAccumulator.finish().segments,fillSegments:i.fillAccumulator.finish().segments}}function A(e,t){for(;;){var r=e.vertices[0],n=e.vertices[1],i=e.vertices[2];if(D(r,n,t),D(n,i,t),D(i,r,t),e.visited)break;if(!e.next)break;e.visited=!0,e=e.next}t.strokeAccumulator.breakSegment(),t.fillAccumulator.breakSegment()}function D(e,t,r){if(k(e,t,r.domain)){var n=w(e,t,r.fn,r.domain);r.fillAccumulator.addPoint([n.x,n.y]),n.isZero?r.strokeAccumulator.addPoint([n.x,n.y]):r.strokeAccumulator.breakSegment()}}t.sampleImplicit=function(e,t){var r=a(e,t);return{segments:r.contours.strokeSegments,fillSegments:r.contours.fillSegments,resolved:r.quadTree.resolved}},t.sampleImplicitDiagnostic=a,t.buildQuadTree=d,t.triangulate=_,t.traceContours=N,t.displayTriangles=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push([n.vertices[0].x,n.vertices[0].y,n.vertices[1].x,n.vertices[1].y,n.vertices[2].x,n.vertices[2].y,n.vertices[0].x,n.vertices[0].y])}return t}});r("core/math/poi-finding-accumulator",["require","exports","core/math/workerconfig","tslib","./curve-accumulator","./poi"],function(e,t,r,n,i,a){"use strict";function o(e){return Math.abs(e)<5e-8}Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.domain=t,i.fn=r,i.derivative=n,i.poiData={zeros:{x:[],y:[]},intercept:{x:[],y:[]},extrema:{x:[],y:[]}},i.zeroBuffer=[],i.extremumBuffer=[],i}return n.__extends(t,e),t.prototype.getPOI=function(){return r.pointsOfInterest?(void 0!==this.fn&&(this.poiData.intercept=this.findIntercept(this.fn)),this.poiData):{zeros:{x:[],y:[]},intercept:{x:[],y:[]},extrema:{x:[],y:[]}}},t.prototype.addLinearZero=function(e){var t=-e[0]/e[1];this.isOutsideDomain(t)||(this.poiData.zeros={x:[t],y:[0]})},t.prototype.addLinearIntercept=function(e){this.isOutsideDomain(0)||(this.poiData.intercept={x:[0],y:[e[0]]})},t.prototype.isOutsideDomain=function(e){return!this.domain||void 0===this.domain.min||void 0===this.domain.max||(e<this.domain.min||e>this.domain.max||isNaN(e))},t.prototype.addPoint=function(t){0===this.segment.length&&o(t[1])&&(this.poiData.zeros.x.push(t[0]),this.poiData.zeros.y.push(t[1])),this.updateZeroBuffer(t),this.updateExtremumBuffer(t),e.prototype.addPoint.call(this,t)},t.prototype.updateZeroBuffer=function(e){if(this.fn)if(isFinite(e[0])&&isFinite(e[1]))switch(this.zeroBuffer.length){case 0:if(o(e[1]))return;return void this.zeroBuffer.push(e);case 1:return 0===e[1]?void this.zeroBuffer.push(e):e[1]>0!=this.zeroBuffer[0][1]>0?((t=a.bisectZero(this.zeroBuffer[0][0],this.zeroBuffer[0][1],e[0],e[1],this.fn))&&(this.poiData.zeros.x.push(t[0]),this.poiData.zeros.y.push(t[1])),this.zeroBuffer.length=0,void this.zeroBuffer.push(e)):(this.zeroBuffer.length=0,void this.zeroBuffer.push(e));case 2:if(0===e[1])return;var t;return e[1]>0!=this.zeroBuffer[0][1]>0?((t=a.flatCenter(this.zeroBuffer[0][0],this.zeroBuffer[0][1],this.zeroBuffer[1][0],this.zeroBuffer[1][1],e[0],e[1],this.fn))&&(this.poiData.zeros.x.push(t[0]),this.poiData.zeros.y.push(t[1])),this.zeroBuffer.length=0,void this.zeroBuffer.push(e)):(this.zeroBuffer.length=0,void this.zeroBuffer.push(e))}else this.zeroBuffer.length=0},t.prototype.updateExtremumBuffer=function(e){if(this.fn)if(isFinite(e[0])&&isFinite(e[1]))switch(this.extremumBuffer.length){case 0:return void this.extremumBuffer.push(e);case 1:return e[1]===this.extremumBuffer[0][1]&&(this.extremumBuffer.length=0),void this.extremumBuffer.push(e);case 2:if(e[1]===this.extremumBuffer[1][1])return void this.extremumBuffer.push(e);if(e[1]>this.extremumBuffer[1][1]!=this.extremumBuffer[1][1]>this.extremumBuffer[0][1]){if(t=this.bisectExtremumUsingDerivative(this.extremumBuffer[0][0],this.extremumBuffer[0][1],this.extremumBuffer[1][0],this.extremumBuffer[1][1],e[0],e[1]))this.poiData.extrema.x.push(t[0]),this.poiData.extrema.y.push(t[1]),!!!a.bisectJump(this.extremumBuffer[0][0],this.extremumBuffer[0][1],t[0],t[1],e[0],e[1],this.fn,this.ytolerance)&&t[0]>this.segment[this.segment.length-2]&&(this.pendingPoint=t);return this.extremumBuffer.shift(),void this.extremumBuffer.push(e)}return this.extremumBuffer.shift(),void this.extremumBuffer.push(e);case 3:if(e[1]===this.extremumBuffer[1][1])return;if(e[1]>this.extremumBuffer[1][1]!=this.extremumBuffer[1][1]>this.extremumBuffer[0][1]){var t=void 0,r=.5*(this.extremumBuffer[1][0]+this.extremumBuffer[2][0]),n=this.fn(r);return(t=n===this.extremumBuffer[1][1]?a.flatCenter(this.extremumBuffer[0][0],this.extremumBuffer[0][1],this.extremumBuffer[1][0],this.extremumBuffer[1][1],e[0],e[1],this.fn):this.bisectExtremumUsingDerivative(this.extremumBuffer[1][0],this.extremumBuffer[1][1],r,n,this.extremumBuffer[2][0],this.extremumBuffer[2][1]))&&(this.poiData.extrema.x.push(t[0]),this.poiData.extrema.y.push(t[1])),this.extremumBuffer.shift(),this.extremumBuffer.shift(),void this.extremumBuffer.push(e)}return this.extremumBuffer.shift(),this.extremumBuffer.shift(),void this.extremumBuffer.push(e)}else this.zeroBuffer.length=0},t.prototype.bisectExtremumUsingDerivative=function(e,t,r,n,i,o){if(this.fn){var s;if(this.derivative){var u=this.derivative(e),c=this.derivative(i);if(!isNaN(u)&&!isNaN(c)&&u<0!=c<0){var l=a.bisectZero(e,u,i,c,this.derivative);l&&(s=[l[0],this.fn(l[0])])}}return s||(s=a.bisectExtremum(e,t,r,n,i,o,this.fn)),s}},t.prototype.breakSegment=function(){this.zeroBuffer.length=0,this.extremumBuffer.length=0,this.flushPending(),this.segment.length>2&&(this.segments.push(this.segment),o(this.segment[this.segment.length-1])&&(this.poiData.zeros.x.push(this.segment[this.segment.length-2]),this.poiData.zeros.y.push(this.segment[this.segment.length-1]))),this.segment=[]},t.prototype.findIntercept=function(e){if(!e)return{x:[],y:[]};var t=e(0);return isFinite(t)?{x:[0],y:[e(0)]}:{x:[],y:[]}},t.prototype.finish=function(){return{segments:this.getSegments(),resolved:!0,poi:this.getPOI()}},t}(i.Accumulator);t.default=s});r("core/math/copy-defined-pois",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e){for(var t=[],r=[],n=e.length,i=0;i<n;i++)t.push(e[i][0]),r.push(e[i][1]);return{defined:{x:t,y:r}}}});r("core/math/plotter",["require","exports","tslib","core/math/distance","./poi","./implicit-plotter","./curve-accumulator","./poi-finding-accumulator","core/types/graphmode","./domaintypes","core/math/copy-defined-pois"],function(e,t,r,n,i,a,o,s,u,c,l){"use strict";function p(e,t){var r=new s.default(t),n=e[0]+t.min*e[1],i=e[0]+t.max*e[1];return isFinite(n)&&isFinite(i)?(r.addPoint([t.min,n]),r.addPoint([t.max,i]),r.addLinearZero(e),r.addLinearIntercept(e),r.finish()):r.finish()}function d(e,t){var n=e(t);return{segments:[r.__spreadArray(r.__spreadArray([],n),n)],resolved:!0}}function f(e,t,r){var a=r.fn,o=r.jumpTolerance,s=e[0],u=e[1],c=t[0],l=t[1],p=n.mean(s,c),d=a(p);return i.bisectJump(s,u,p,d,c,l,a,o)}Object.defineProperty(t,"__esModule",{value:!0}),t.errorBranch=void 0,t.errorBranch=function(e){return{graphMode:u.ERROR,error:e,segments:[]}};var h=function(e,t,r){var n=r.fn,i=r.jumpTolerance,a=r.accumulator;if(!isFinite(i)||i<=0)return t;var o=f(e,t,r);if(!o)return t;for(var s=(t[0]-e[0])/10,u=[-s,s],c=t,l=0;l<u.length;l++){var p=e[0]+u[l],d=n(p);isFinite(d)||(p=e[0],d=e[1],p=e[0],d=e[1]);var h=t[0]+u[l],y=n(h);if(isFinite(y)?c=[h,y]:(h=t[0],y=t[1]),f([p,d],[h,y],r)){var m=o[0],v=o[1];return a.addPoint(m),a.breakSegment(),a.addPoint(v),t}}return c},y=function(e,t,r){this.derivative=r,this.accumulator=new s.default(t,e,r),this.fn=e,this.jumpTolerance=t.ytolerance||t.tolerance||0};function m(e,t,r){var n=t,i=e(n);return isFinite(i)||(i=e(n=t+r)),isFinite(i)||(i=e(n=t-r)),[n,i]}function v(e,t,r){var n,a,o,s,u,c,l,p=new y(e,t,r),d=t.step/10,f=t.min,v=[l=(n=m(e,f,d))[0],c=n[1]];isFinite(c)&&p.accumulator.addPoint([l,c]);for(var g=Math.ceil((t.max-t.min)/t.step),b=1;b<=g;b++)l=(a=m(e,f=(g-b)/g*t.min+b/g*t.max,d))[0],c=a[1],isFinite(c)&&isFinite(v[1])?(l=(o=h(v,[l,c],p))[0],c=o[1],p.accumulator.addPoint([l,c])):isFinite(c)&&!isFinite(v[1])?(u=i.bisectFinite(v[0],v[1],l,c,e))&&(u[0]!==l&&p.accumulator.addPoint(u),l=(s=h(u,[l,c],p))[0],c=s[1],p.accumulator.addPoint([l,c])):!isFinite(c)&&isFinite(v[1])&&(u=i.bisectFinite(v[0],v[1],l,c,e))&&((u=h(v,u,p))[0]!==v[0]&&p.accumulator.addPoint(u),p.accumulator.breakSegment()),v=[l,c];return p.accumulator.finish()}function g(e,t,r,n){var i,a,o,s=t.min,u=t.max-t.min,c=t.xtolerance&&t.ytolerance?Math.min(t.xtolerance,t.ytolerance):t.tolerance?t.tolerance:0,l=Math.floor(u/(Math.PI/r));function p(e,t){var i=t%2==0?1:-1;if(!n&&-1===i)return!1;for(var a=t*(Math.PI/r),o=[s,s+1,s+2,s+3],u=!1,l=0,p=o.length;l<p;l++){var d=e(o[l]),f=e(o[l]+a);if(isFinite(d)&&isFinite(f)&&(u=!0),isFinite(d)!==isFinite(f)||Math.abs(d-i*f)>c)return!1}return!!u}for(i=1;i<=l;i++)if(p(e,i)){for(o=i,a=2;a*i<=l;a++)p(e,a*i)||(o=void 0);if(o)break}return o?o*(Math.PI/r):null}function b(e){return[e[1]*Math.cos(e[0]),e[1]*Math.sin(e[0])]}function x(e,t){return t.map=b,v(e,t)}function S(e,t){if(t.max<t.min)return{segments:[],resolved:!0};var r,n=new o.Accumulator(t),i=t.min,a=e(i);return isFinite(a[0])&&isFinite(a[1])&&n.addPoint(a),function(e,t){for(var r=e.min,n=e.max,i=e.step,a=n-r,o=Math.ceil(a/i),s=a/o,u=0;u<o;u++)t(r+u*s);t(n)}(t,function(t){r=e(t),T(e,i,a,t,r,10,n),i=t,a=r}),n.finish()}function T(e,t,r,i,a,o,s){if(i!==t){var u=s.xtolerance,c=s.ytolerance,l=s.ztolerance,p=n.mean(t,i),d=e(p),f=isFinite(r[0])&&isFinite(r[1])&&(2===r.length||isFinite(r[2])),h=isFinite(a[0])&&isFinite(a[1])&&(2===a.length||isFinite(a[2])),y=isFinite(d[0])&&isFinite(d[1])&&(2===d.length||isFinite(d[2]));if(0===o||p===t||p===i)return s.breakSegment(),void(h&&s.addPoint(a));if(f||h)if(f===h){if(f&&y&&h){var m=n.pointToSegmentParameter(d[0],d[1],d[2]||0,r[0],r[1],r[2]||0,a[0],a[1],a[2]||0);if(m>.2&&m<.8&&Math.abs(d[0]-(r[0]+m*(a[0]-r[0])))<=u&&Math.abs(d[1]-(r[1]+m*(a[1]-r[1])))<=c&&(2===r.length||Math.abs(d[2]-(r[2]+m*(a[2]-r[2])))<=l))return void s.addPoint(a)}r[0]===d[0]&&r[1]===d[1]||T(e,t,r,p,d,o-1,s),a[0]===d[0]&&a[1]===d[1]||T(e,p,d,i,a,o-1,s)}else{for(var v=t,g=i,b=r,x=a;t!==p&&p!==i;)y==f?(t=p,r=d,f=y):(i=p,a=d,h=y),d=e(p=t+(i-t)/2),y=isFinite(d[0])&&isFinite(d[1])&&(2===d.length||isFinite(d[2]));f?(T(e,v,b,t,r,o-1,s),s.breakSegment()):(s.breakSegment(),s.addPoint(a),T(e,i,a,g,x,o-1,s))}}}function w(e,t,r){var n=e.viewport.xmin,i=e.viewport.xmax,a=e.viewport.ymin,o=e.viewport.ymax,s=t.lineWidth;if(s>3){var l=s*(i-n)/e.screen.width,p=s*(o-a)/e.screen.height;n-=l,i+=l,a-=p,o+=p}var d,f,h=e.trigAngleMultiplier||1,y=e.oversample||4,m=1/y*(i-n)/e.screen.width,v=1/y*(o-a)/e.screen.height,b=t.domainBound;switch(t.graphMode){case u.X:switch((d=c.intersectDomains(c.knownDomain([a,o]),b)).type){case"empty":return!1;case"known":a=d.bounds[0],o=d.bounds[1]}f={min:a,max:o,xtolerance:v,ytolerance:m,step:v};break;case u.Y:switch((d=c.intersectDomains(c.knownDomain([n,i]),b)).type){case"empty":return!1;case"known":n=d.bounds[0],i=d.bounds[1]}f={min:n,max:i,xtolerance:m,ytolerance:v,step:m};break;case u.POLAR:if(!t.domain)throw new Error("Expected polar graph to have domain");if(f={min:t.domain.min,max:t.domain.max,step:2*Math.PI/h/1e3,tolerance:Math.min(m,v)},!t.domain.isExplicit){var x=g(r,f,h,"="===t.operator);x&&(f.max=f.min+x)}f.step=Math.max(f.step,(f.max-f.min)/11999);break;case u.PARAMETRIC:case u.PARAMETRIC_CURVE_3D:var S=t.domain?t.domain.min:0,T=t.domain?t.domain.max:1,w=t.domain?t.domain.step:.01;switch((d=c.intersectDomains(c.knownDomain([S,T]),b)).type){case"empty":return!1;case"known":S=d.bounds[0],T=d.bounds[1]}f={min:S,max:T,step:w,xtolerance:m,ytolerance:v,ztolerance:Math.min(m,v)};break;case u.IMPLICIT:f={xmin:n,xmax:i,ymin:a,ymax:o,xtolerance:m,ytolerance:v};break;case u.Z_3D:return{xmin:-10,xmax:10,ymin:-10,ymax:10};default:return!1}return f}function _(e,t,r){var n,i,a,o,s=[],c=null;switch(r){case u.POLAR:c=b;break;case u.X:c=function(e){return[e[1],e[0]]}}for(n=0;n<e.length;n++)for(o=e[n],i=0;i<o.length;i+=2)a=[o[i],o[i+1]],c&&(a=c(a)),s.push(a[0],a[1]);for(n=t.length-1;n>=0;n--)for(i=(o=t[n]).length-2;i>=0;i-=2)a=[o[i],o[i+1]],c&&(a=c(a)),s.push(a[0],a[1]);return s}function I(e){for(var t=[],r={},n=0;n<e.length;n++){var i=e[n],a=i[0],o=i[1];isNaN(a)||isNaN(o)?r[n]=!0:t.push(i)}return{points:t,droppedIndices:r}}t.default={sampleLinear:p,sampleXY:v,findPiPeriod:g,samplePolar:x,sampleParametricRecursive:S,subsampleParametricRecursive:T,validateViewState:function(e){if(!e)return!1;var t=e.viewport.xmin,r=e.viewport.xmax,n=e.viewport.ymin,i=e.viewport.ymax;return!(!isFinite(t)||!isFinite(r)||r<=t)&&(!(!isFinite(n)||!isFinite(i)||i<=n)&&(!(!isFinite(e.screen.width)||e.screen.width<=0)&&!(!isFinite(e.screen.height)||e.screen.height<=0)))},computeDomain:w,computeGraphData:function(e){var t,r,n,i=e.viewState,o=e.graphInfo,s=e.compiled,c=e.derivative,l=s.fn,f=w(i,o,l),h=o.graphMode;if(f){switch(h){case u.X:case u.Y:var y=c?c.fn:void 0;t=o.isLinear?p(o.linearCoefficients,f):v(l,f,y);break;case u.POLAR:t=x(l,f);break;case u.IMPLICIT:t=a.sampleImplicit(l,f);break;case u.PARAMETRIC:f.step||(f.step=(f.max-f.min)/1e3),t=f.max===f.min?d(l,f.min):o.isLinear?function(e,t){var r=p(e[0],t),n=p(e[1],t);return r.segments.length&&n.segments.length&&4===r.segments[0].length&&4===n.segments[0].length?{segments:[[r.segments[0][1],n.segments[0][1],r.segments[0][3],n.segments[0][3]]],resolved:!0}:{segments:[],resolved:!0}}(o.linearCoefficients,f):S(l,f);break;case u.PARAMETRIC_CURVE_3D:return f.step||(f.step=(f.max-f.min)/1e3),t=f.max===f.min?d(l,f.min):S(l,f),{graphMode:u.PARAMETRIC_CURVE_3D,segments:t.segments,cacheKey:s.source+":"+JSON.stringify(f),color:o.color,style:"dummy"};case u.Z_3D:return{meshData:function(e,t){for(var r=e.fn,n=t.xmin,i=t.xmax,a=t.ymin,o=30,s=(i-n)/30,u=(t.ymax-a)/o,c=[],l=[],p=[],d=s/1e3,f=u/1e3,h=0;h<30;h++)for(var y=0;y<o;y++){var m=n+h*s,v=a+y*u,g=r(m,v);c.push(m,v,g);var b=(r(m+d,v)-g)*f,x=(r(m,v+f)-g)*d,S=-d*f,T=Math.sqrt(b*b+x*x+S*S);l.push(b/T,x/T,S/T)}for(h=0;h<29;h++)for(y=0;y<29;y++){var w=y*o+h,_=y*o+h+1,I=(y+1)*o+h,E=(y+1)*o+h+1;p.push(w,I,_),p.push(I,E,_)}return{cacheKey:e.source+":"+JSON.stringify(t),positions:new Float32Array(c),normals:new Float32Array(l),faces:new Int16Array(p)}}(s,f),color:o.color,graphMode:u.Z_3D,poi:{zeros:{x:[],y:[]},extrema:{x:[],y:[]},intercept:{x:[],y:[]}},compiled:s,style:"dummy"};default:throw new Error("Programming Error: unexpected graphmode "+h)}n=t.poi}else t={segments:[],resolved:!0};if((!n||n.zeros.x.length+n.extrema.x.length+n.intercept.x.length>250)&&(n={zeros:{x:[],y:[]},extrema:{x:[],y:[]},intercept:{x:[],y:[]}}),h===u.X)for(var m in n)if(n.hasOwnProperty(m)){var g=m;r=n[g].y,n[g].y=n[g].x,n[g].x=r}var b={segments:t.segments,resolved:t.resolved,graphMode:h,color:o.color,style:o.lineStyle,lineWidth:o.lineWidth,lineOpacity:o.lineOpacity,listIndex:o.listIndex,operator:o.operator,poi:n,compiled:s};if(h===u.POLAR){var T=f;b.sampledDomain={min:T.min,max:T.max,step:T.step}}return t.fillSegments&&(b.fillSegments=t.fillSegments),b},computeDiscreteGraphData:function(e){var t,r=e.viewState,n=e.graphInfo,i=e.compiled,a=e.maxOverride,o=e.showPoint,s=i.fn,c=w(r,n,s);c||(t={segments:[],resolved:!0});var p=c,d=p.min,f=p.max,h=p.step,y=I((t=function(e){for(var t=e.fn,r=e.domain,n=r.min,i=r.max,a=Math.floor(n),o=Math.ceil(i),s=[],u=a;u<=o;u++){var c=t(u);isFinite(u)&&isFinite(c)&&s.push([u,c])}return{segments:s,resolved:!0}}({fn:s,domain:{min:Math.max(d,0),max:void 0!==a?Math.min(a,f):f,step:h}})).segments);return{segments:[y.points],droppedIndices:y.droppedIndices,graphMode:u.XYPOINT,color:n.color,style:n.pointStyle,poi:l.default(t.segments),showPoint:o}},polygonsFromSegments:function(e,t,r){for(var i=function(e){var t=e[e.length-1];return t[t.length-2]},a=[],o=0,s=0,u=[],c=[],l=-1/0,p=-1/0;;){if(l<=p){if(o>=t.length)break;c.push(t[o++])}if(p<=l){if(s>=e.length)break;u.push(e[s++])}if(l=i(c),p=i(u),n.approx(l,p,4)){a.push(_(u,c,r)),c=[],u=[];var d=Math.max(l,p);l=d,p=d}}return a},dropUndefinedPoints:I}});r("core/lib/deepCopy",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){var r=t;if(r&&"function"==typeof r.toJSON&&(r=r.toJSON()),!r)return r;if("object"!=typeof r)return r;if(Array.isArray(r))return r.map(e);var n={};for(var i in r)r.hasOwnProperty(i)&&(n[i]=e(r[i]));return n}});r("core/types/styles",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LineStyle=t.PointStyle=void 0,function(e){e.POINT="POINT",e.OPEN="OPEN",e.CROSS="CROSS"}(t.PointStyle||(t.PointStyle={})),function(e){e.SOLID="SOLID",e.DASHED="DASHED",e.DOTTED="DOTTED"}(t.LineStyle||(t.LineStyle={}))});r("core/math/cdf-branches",["require","exports","tslib","core/lib/deepCopy","core/math/plotter","core/math/domaintypes","core/types/styles"],function(e,t,r,n,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeContinuousCDFTopBranches=t.makeDiscreteCDFTopBranches=void 0;function s(e){var t=e.viewState,r=e.graphInfo,s=e.compiled,u=e.bounds,c=e.included,l=e.showPoint,p=n.default(r),d=a.intersectDomains(r.domainBound,a.knownDomain(u));if("known"===d.type)return p.domainBound=d,p.pointStyle=c?o.PointStyle.POINT:o.PointStyle.OPEN,i.default.computeDiscreteGraphData({graphInfo:p,viewState:t,compiled:s,showPoint:l,maxOverride:void 0})}t.makeDiscreteCDFTopBranches=function(e){var t,n=e.viewState,i=e.graphInfo,a=e.compiled,o=e.bounds,u=e.maxOverride,c=e.showPoint,l=o[0],p=o[1],d=[];l=Math.ceil(l),p=Math.floor(p);var f,h,y,m,v,g=void 0!==u?u:1/0;if(l===-1/0&&p>=g)t=s({bounds:[l,g],included:!0,viewState:n,graphInfo:i,compiled:a,showPoint:c}),d.push(t);else if(l===-1/0&&p<1/0)t=s({bounds:[l,p],included:!0,viewState:n,graphInfo:i,compiled:a,showPoint:c}),d.push(t),d.push(s({bounds:[p+1,g],included:!1,viewState:n,graphInfo:i,compiled:a,showPoint:c}));else if(l>-1/0&&p>=g)t=s({bounds:[l,g],included:!0,viewState:n,graphInfo:i,compiled:a,showPoint:c}),d.push(s({bounds:[-1/0,l-1],included:!1,viewState:n,graphInfo:i,compiled:a,showPoint:c})),d.push(t);else{t=s({bounds:[l,p],included:!0,viewState:n,graphInfo:i,compiled:a,showPoint:c});var b=s({bounds:[-1/0,l-1],included:!1,viewState:n,graphInfo:i,compiled:a,showPoint:c}),x=s({bounds:[p+1,g],included:!1,viewState:n,graphInfo:i,compiled:a,showPoint:c});d.push(t);var S=void 0;b&&x&&(h=x,y=(f=b).segments[0],m=h.segments[0],v=[r.__spreadArray(r.__spreadArray([],y),m)],S=r.__assign(r.__assign({},f),{segments:v}),d.push(S))}return{cdfTopBranch:t,topBranches:d}};t.makeContinuousCDFTopBranches=function(e){var t=e.viewState,r=e.graphInfo,s=e.compiled,u=e.derivative,c=e.bounds;return{cdfTopBranch:function(e){var t=e.viewState,r=e.graphInfo,s=e.compiled,u=e.derivative,c=e.bounds,l=n.default(r),p=a.intersectDomains(r.domainBound,a.knownDomain(c));if("known"===p.type)return l.domainBound=p,l.lineStyle=o.LineStyle.SOLID,i.default.computeGraphData({graphInfo:l,viewState:t,compiled:s,derivative:u})}({bounds:[c[0],c[1]],viewState:t,graphInfo:r,compiled:s,derivative:u}),topBranches:[i.default.computeGraphData({viewState:t,graphInfo:r,compiled:s,derivative:u})]}}});r("core/types/opacity",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HIGH=t.DEFAULT=t.LOW=void 0,t.LOW=.2,t.DEFAULT=.4,t.HIGH=.8});r("core/types/slider-loop-modes",["require","exports"],function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.getSliderIcon=t.SliderLoopMode=void 0,function(e){e.LOOP_FORWARD_REVERSE="LOOP_FORWARD_REVERSE",e.LOOP_FORWARD="LOOP_FORWARD",e.PLAY_ONCE="PLAY_ONCE",e.PLAY_INDEFINITELY="PLAY_INDEFINITELY"}(r=t.SliderLoopMode||(t.SliderLoopMode={})),t.getSliderIcon=function(e){switch(e){case r.LOOP_FORWARD:return"dcg-icon-arrow-one-way";case r.LOOP_FORWARD_REVERSE:return"dcg-icon-arrow-two-way";case r.PLAY_ONCE:return"dcg-icon-arrow-once";case r.PLAY_INDEFINITELY:return"dcg-icon-arrow-infinite"}}});r("core/types/label-sizes",["require","exports"],function(e,t){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.maybeMigrateLabelSizeEnumToLatex=t.LabelSize=void 0,function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large"}(r=t.LabelSize||(t.LabelSize={})),t.maybeMigrateLabelSizeEnumToLatex=function(e){return e===r.SMALL?".85":e===r.MEDIUM?"1":e===r.LARGE?"1.35":void 0}});r("core/types/label-orientations",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LabelOrientation=void 0,function(e){e.DEFAULT="default",e.CENTER="center",e.CENTER_AUTO="center_auto",e.AUTO_CENTER="auto_center",e.ABOVE="above",e.ABOVE_LEFT="above_left",e.ABOVE_RIGHT="above_right",e.ABOVE_AUTO="above_auto",e.BELOW="below",e.BELOW_LEFT="below_left",e.BELOW_RIGHT="below_right",e.BELOW_AUTO="below_auto",e.LEFT="left",e.AUTO_LEFT="auto_left",e.RIGHT="right",e.AUTO_RIGHT="auto_right"}(t.LabelOrientation||(t.LabelOrientation={}))});r("core/lib/default-spec",["require","exports","underscore","core/lib/deepCopy"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.populateDefaults=t.stripDefaultsAndMaybeReturnUndefined=t.stripDefaults=void 0,t.stripDefaults=function(e,t){var n={};for(var i in t)t.hasOwnProperty(i)&&(r.isEqual(e[i],t[i])||(n[i]=t[i]));return n},t.stripDefaultsAndMaybeReturnUndefined=function(e,t){var n=void 0,i={};for(var a in t)t.hasOwnProperty(a)&&(r.isEqual(e[a],t[a])||(i[a]=t[a],n=i));return n},t.populateDefaults=function(e,t){t||(t={});var r={};for(var i in e)e.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(r[i]=n.default(e[i]));for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r}});r("core/lib/copy-properties",["require","exports","core/lib/deepCopy"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeTrueMap=t.extractPropertiesLike=t.copyAllProperties=t.copyProperties=void 0,t.copyProperties=function(e){var t=e.from,n=e.to,i=e.props;for(var a in i)i[a]&&t.hasOwnProperty(a)&&(n[a]=r.default(t[a]))},t.copyAllProperties=function(e,t){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])},t.extractPropertiesLike=function(e,t){var r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]=e[n]);return r},t.makeTrueMap=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=!0);return t}});r("core/graphing-calc/json/expression",["require","exports","tslib","core/types/opacity","core/types/styles","core/lib/dragmode","core/types/slider-loop-modes","core/types/label-sizes","core/types/label-orientations","core/lib/default-spec","../../lib/copy-properties"],function(e,t,r,n,i,a,o,s,u,c,l){"use strict";var p;function d(e){return l.extractPropertiesLike(e,t.DEFAULTS_DYNAMIC)}Object.defineProperty(t,"__esModule",{value:!0}),t.computeParsableState=t.areDynamicPropertiesStrictEqual=t.extractDynamicProperties=t.stripDefaults=t.inflateDefaults=t.SLIDER_DEFAULTS=t.DEFAULTS=t.DEFAULTS_DYNAMIC=t.DEFAULT_SLIDER_PERIOD=t.EditableLabelMode=t.CLICKABLEINFO_DEFAULTS=t.VIZ_DEFAULTS=t.CDF_DEFAULTS=void 0,t.CDF_DEFAULTS={show:!1,min:"",max:""},t.VIZ_DEFAULTS={breadth:"",axisOffset:"",alignedAxis:"x",showBoxplotOutliers:!0,binAlignment:"center",dotplotXMode:"exact",histogramMode:""},t.CLICKABLEINFO_DEFAULTS={enabled:!1,description:"",latex:""},function(e){e.None="NONE",e.Math="MATH",e.Text="TEXT"}(p=t.EditableLabelMode||(t.EditableLabelMode={})),t.DEFAULT_SLIDER_PERIOD=4e3,t.DEFAULTS_DYNAMIC={polarDomain:{min:"",max:""},parametricDomain:{min:"",max:""},cdf:t.CDF_DEFAULTS,colorLatex:"",fillOpacity:""+n.DEFAULT,lineOpacity:"",pointOpacity:"",pointSize:"",lineWidth:"",labelAngle:"",vizProps:t.VIZ_DEFAULTS,clickableInfo:t.CLICKABLEINFO_DEFAULTS},t.DEFAULTS=r.__assign(r.__assign({folderId:"",latex:"",color:"",showLabel:!1,label:"",hidden:!1,secret:!1,dragMode:a.DragMode.AUTO,labelSize:s.LabelSize.MEDIUM,labelOrientation:u.LabelOrientation.DEFAULT,suppressTextOutline:!1,interactiveLabel:!1,editableLabelMode:p.None,residualVariable:"",isLogModeRegression:!1,pointStyle:i.PointStyle.POINT,lineStyle:i.LineStyle.SOLID,regressionParameters:{},displayEvaluationAsFraction:!1,slider:{}},t.DEFAULTS_DYNAMIC),{points:void 0,lines:void 0,fill:void 0}),t.SLIDER_DEFAULTS={hardMin:!1,hardMax:!1,animationPeriod:t.DEFAULT_SLIDER_PERIOD,loopMode:o.SliderLoopMode.LOOP_FORWARD_REVERSE,playDirection:1,isPlaying:!1,min:"-10",max:"10",step:""},t.inflateDefaults=function(e){return r.__assign(r.__assign(r.__assign({},t.DEFAULTS),e),{slider:r.__assign(r.__assign({},t.SLIDER_DEFAULTS),e.slider),cdf:r.__assign(r.__assign({},t.CDF_DEFAULTS),e.cdf),vizProps:r.__assign(r.__assign({},t.VIZ_DEFAULTS),e.vizProps),clickableInfo:r.__assign(r.__assign({},t.CLICKABLEINFO_DEFAULTS),e.clickableInfo)})},t.stripDefaults=function(e){var n=c.stripDefaults(t.DEFAULTS,r.__assign(r.__assign({},e),{slider:c.stripDefaults(t.SLIDER_DEFAULTS,e.slider)})),i=c.stripDefaultsAndMaybeReturnUndefined(t.CDF_DEFAULTS,e.cdf);void 0===i?delete n.cdf:n.cdf=i;var a=c.stripDefaultsAndMaybeReturnUndefined(t.VIZ_DEFAULTS,e.vizProps);void 0===a?delete n.vizProps:n.vizProps=a;var o=c.stripDefaultsAndMaybeReturnUndefined(t.CLICKABLEINFO_DEFAULTS,e.clickableInfo);return void 0===o?delete n.clickableInfo:n.clickableInfo=o,n},t.extractDynamicProperties=d,t.areDynamicPropertiesStrictEqual=function(e,r){for(var n in t.DEFAULTS_DYNAMIC)if(t.DEFAULTS_DYNAMIC.hasOwnProperty(n)&&e[n]!==r[n])return!1;return!0},t.computeParsableState=function(e){var t=s.maybeMigrateLabelSizeEnumToLatex(e.labelSize),n=t||e.labelSize;return r.__assign({type:"statement",id:e.id,latex:e.latex,label:e.label,color:e.color,fill:e.fill,points:e.points,lines:e.lines,pointStyle:e.pointStyle,lineStyle:e.lineStyle,dragMode:e.dragMode,labelSize:n,labelOrientation:e.labelOrientation,suppressTextOutline:e.suppressTextOutline,interactiveLabel:e.interactiveLabel,editableLabelMode:e.editableLabelMode,residualVariable:e.residualVariable,regressionParameters:e.regressionParameters,isLogModeRegression:e.isLogModeRegression,showLabel:e.showLabel,shouldGraph:e.hidden,slider:{min:e.slider.hardMin?e.slider.min:"",max:e.slider.hardMax?e.slider.max:"",softMin:e.slider.hardMin?"":e.slider.min,softMax:e.slider.hardMax?"":e.slider.max,step:e.slider.step,isPlayingOnce:e.slider.isPlaying&&e.slider.loopMode===o.SliderLoopMode.PLAY_ONCE}},d(e))}});r("core/math/features/getListIdx",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getListIdxFromBranchIdx=void 0,t.getListIdxFromBranchIdx=function(e,t){var r;switch(t){case"solvedEquation":r=2;break;case"baseComparator":r=4;break;default:r=1}return Math.floor(e/r)}});r("core/types/point-size",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOTPLOT_DEFAULT=t.DEFAULT=void 0,t.DEFAULT=9,t.DOTPLOT_DEFAULT=14});r("core/math/features/graph",["require","exports","parsenodes","core/math/comparators","core/math/parsenode/irexpression","tslib","core/math/errormsg","core/math/builtin","core/math/plotter","core/types/graphmode","core/lib/dragmode","core/math/expression-types","core/math/cdf-branches","core/math/copy-defined-pois","core/math/distribution-spec","core/graphing-calc/json/expression","core/types/opacity","core/lib/color-helpers","core/types/styles","core/math/types","../ir/opcodes","core/math/ir/features/as-value","./getListIdx","core/types/point-size"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f,h,y,m,v,g,b,x,S,T,w){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=r.List;function I(e,t,r){for(var n=1/0,i=0,a=t;i<a.length;i++){var o=e[a[i]];Array.isArray(o)&&o.length<n&&(n=o.length)}var s=1;return"solvedEquation"===r?s=2:"baseComparator"===r&&(s=4),s*n}function E(e,t,r){return Array.isArray(e)?e[T.getListIdxFromBranchIdx(t,r)]:e}function C(e,t){for(var r=1/0,n=-1/0,i=1/0,a=-1/0,o=0,s=t;o<s.length;o++)for(var u=s[o],c=0;c<u.length;c+=2){var l=u[c],p=u[c+1];l<r&&(r=l),l>n&&(n=l),p<i&&(i=p),p>a&&(a=p)}if(isFinite(r)&&isFinite(i))return{type:e,xmin:r,ymin:i,xmax:n,ymax:a}}function M(e,t){if(void 0!==e&&"binomialdist"===e.symbol&&t instanceof i){var r=t._chunk,n=r.getInstruction(r.returnIndex);if(n.type===x.NativeFunction&&"binompdf"===n.symbol)return S.asValue(r,n.args[1])}}function k(e,t,r){var n={};r-=.5*t;for(var i=e.length-1;i>=0;i--){var a=e[i],o=Math.floor((a-r)/t);n[o]?n[o].data.push(a):n[o]={id:o,data:[a],min:o*t+r,max:o*t+r+t,center:o*t+r+t/2}}return n}r.Base.prototype._graph=function(e,t,n,o,l){var m=this;if(t instanceof r.SolvedEquation)return this._graph(e,t._expression,n,o,2===t.branchMultiplier?"solvedEquation":void 0);function g(e){var t=e.editableLabelMode;return t===y.EditableLabelMode.Text||t===y.EditableLabelMode.Math}var w=t.getExpressionType(o.graphMode,t.valueType),C=p.getReconciledExpressionProps(w,{points:this.userData.points,lines:this.userData.lines,fill:this.userData.fill});switch(o.graphMode){case c.XYPOINT_MOVABLE:var k=u.default.dropUndefinedPoints([t.asValue()]),P=k.points,O=k.droppedIndices,L=this.userData.shouldGraph&&C.points,A=this.userData.showLabel&&!L;return L?[{segments:[P],graphMode:o.graphMode,droppedIndices:O,color:v.getDisplayColor(this.userData,this.metaData),style:this.userData.pointStyle,showLabel:!!this.userData.showLabel,labelSize:this.metaData.computedLabelSize,labelAngle:this.metaData.computedLabelAngle,labelOrientation:this.userData.labelOrientation,pointOpacity:this.metaData.computedPointOpacity,suppressTextOutline:this.userData.suppressTextOutline,editableLabel:g(this.userData),labels:this.computedLabels||[],poi:f.default(P),movablePointInfo:[]}]:A?[{segments:[P],graphMode:c.XYPOINT,color:v.getDisplayColor(this.userData,this.metaData),style:this.userData.pointStyle,showLabel:!!this.userData.showLabel,nakedLabel:!0,labelSize:this.metaData.computedLabelSize,labelAngle:this.metaData.computedLabelAngle,labelOrientation:this.userData.labelOrientation,pointOpacity:this.metaData.computedPointOpacity,suppressTextOutline:this.userData.suppressTextOutline,editableLabel:g(this.userData),labels:this.computedLabels||[],poi:f.default(P),showPoint:!1}]:[];case c.XYPOINT:var D=[],R=this.userData.shouldGraph&&C.points,F=this.userData.shouldGraph&&C.lines,q=["colorLatexValue"];R&&q.push("computedPointOpacity","computedPointSize"),(this.userData.showLabel||R)&&q.push("computedLabelSize","computedLabelAngle");var B=I(this.metaData,q,l),V=_.wrap(t).asValue();V.length>B&&(V.length=B);var z=this.userData.showLabel&&!R&&!F,j=u.default.dropUndefinedPoints(V);return(this.userData.showLabel||R)&&D.push({segments:[j.points],graphMode:o.graphMode,droppedIndices:j.droppedIndices,color:this.metaData.colorLatexValue||this.userData.color,style:this.userData.pointStyle,showLabel:!!this.userData.showLabel,showPoint:R,labelSize:this.metaData.computedLabelSize,labelAngle:this.metaData.computedLabelAngle,labelOrientation:this.userData.labelOrientation,pointSize:this.metaData.computedPointSize,pointOpacity:this.metaData.computedPointOpacity,suppressTextOutline:this.userData.suppressTextOutline,interactiveLabel:!!this.userData.interactiveLabel,editableLabel:g(this.userData),nakedLabel:z,labels:this.computedLabels||[],poi:f.default(V)}),F&&D.push({segments:N(V),graphMode:c.PARAMETRIC,color:v.getDisplayColor(this.userData,this.metaData),style:this.userData.lineStyle,lineWidth:this.metaData.computedLineWidth,lineOpacity:this.metaData.computedLineOpacity,poi:{}}),D;case c.PARAMETRIC:case c.PARAMETRIC_CURVE_3D:var U=this.userData,G=this.metaData,W=[];q=["colorLatexValue"];C.lines&&q.push("computedLineOpacity","computedLineWidth"),C.fill&&q.push("computedFillOpacity");var K=I(this.metaData,q,l);D=_.wrap(t).mapElements(function(t,r){if(r>=K)return{segments:[],poi:{},graphMode:c.X,color:""};var i=T.getListIdxFromBranchIdx(r,l),a=E(m.metaData.computedLineWidth,r,l),s=E(m.metaData.computedLineOpacity,r,l),p=m.metaData.colorLatexValue?E(m.metaData.colorLatexValue,r,l):m.userData.color;if(0===t.getDependencies().length){var d=u.default.dropUndefinedPoints([t.asValue()]),h=d.points,y=d.droppedIndices;return{segments:[h],graphMode:c.XYPOINT,droppedIndices:y,color:v.getDisplayColor(U,G),style:U.lineStyle,lineWidth:a,lineOpacity:s,poi:f.default(h)}}var g=t.getCompiledFunction(),b=m.getGraphInfo(e,t);return b.graphMode=o.graphMode,b.domain={min:m.metaData.evaluatedDomainMin,max:m.metaData.evaluatedDomainMax},b.style=m.userData.lineStyle,b.lineWidth=a,b.lineOpacity=s,b.color=p,b.listIndex=i,u.default.computeGraphData({viewState:n,graphInfo:b,compiled:g})});if(C.fill){if(D.forEach(function(e,t){t>=K||W.push({segments:e.segments,color:m.metaData.colorLatexValue?E(m.metaData.colorLatexValue,t,l):m.userData.color,fillOpacity:E(m.metaData.computedFillOpacity,t,l),listIndex:T.getListIdxFromBranchIdx(t,l),graphMode:c.POLYGONFILL,poi:{}})}),!C.lines)return W;D=D.concat(W)}return D;case c.X:case c.Y:case c.IMPLICIT:case c.POLAR:case c.Z_3D:var H=[],J=t.valueType===b.Number,Y=I(this.metaData,["computedLineOpacity","computedLineWidth","colorLatexValue","fillOpacity"],l);return _.wrap(t).eachElement(function(t,r){if(!(r>=Y)){var p,f=o.graphMode===c.IMPLICIT||o.graphMode===c.Z_3D?t.getCompiledFunction(["x","y"]):t.getCompiledFunction(),y=h.getFunctionSpecFromTree(m),v=y&&y.discrete,g=function(e,t){if(!e)return;if(!(t instanceof i))return;var r=t._chunk,n=r.getInstruction(r.returnIndex);if(n.type!==x.NativeFunction)return;var a=e.discrete?"discreteDistribution":"continuousDistribution";if("binomialdist"===e.symbol&&"binompdf"===n.symbol){var o=S.asValue(r,n.args[1]),u=S.asValue(r,n.args[2]);return{type:a,xmin:0,xmax:o,ymin:0,ymax:p=s.binompdf(u*o,o,u)}}if("poissondist"===e.symbol&&"poissonpdf"===n.symbol){return{type:a,xmin:0,xmax:2.5*(c=S.asValue(r,n.args[1])),ymin:0,ymax:p=Math.max(s.poissonpdf(Math.floor(c),c),s.poissonpdf(Math.ceil(c),c))}}if("normaldist"===e.symbol&&"normalpdf"===n.symbol){var c=S.asValue(r,n.args[1]),l=S.asValue(r,n.args[2]),p=s.normalpdf(c,c,l);return{type:a,xmin:c-2*Math.abs(l),xmax:c+2*Math.abs(l),ymin:0,ymax:p}}if("uniformdist"===e.symbol&&"uniformpdf"===n.symbol){var d=S.asValue(r,n.args[1]),f=S.asValue(r,n.args[2]),h=(c=(d+f)/2,f-d);return{type:a,xmin:d-h/3,xmax:f+h/3,ymin:0,ymax:p=s.uniformpdf(c,d,f)}}if("tdist"===e.symbol&&"tpdf"===n.symbol){var y=S.asValue(r,n.args[1]);return{type:a,xmin:-3,xmax:3,ymin:0,ymax:p=s.tpdf(0,y)}}return}(y,t);try{p=t.getCompiledDerivative()}catch(e){}var b=m.getGraphInfo(e,t);b.listIndex=T.getListIdxFromBranchIdx(r,l),b.graphMode=o.graphMode,b.style=m.userData.lineStyle,b.lineWidth=E(m.metaData.computedLineWidth,r,l),b.lineOpacity=E(m.metaData.computedLineOpacity,r,l);var w=E(m.metaData.computedFillOpacity,r,l);b.fillOpacity=w,o.graphMode===c.POLAR&&(b.domain={min:m.metaData.evaluatedDomainMin,max:m.metaData.evaluatedDomainMax,isExplicit:m.metaData.isExplicitDomain});var _=m.metaData.colorLatexValue?E(m.metaData.colorLatexValue,r,l):m.userData.color;b.color=_;var I=m.metaData.evaluatedCDFMin,C=m.metaData.evaluatedCDFMax;if(isNaN(I)||isNaN(C)||!J)if(v){var k=u.default.computeDiscreteGraphData({viewState:n,graphInfo:b,compiled:f,showPoint:m.userData.shouldGraph,maxOverride:M(y,t)});g&&(k.boundingBox=g),H.push(k)}else{var P=void 0===m.userData.lines||m.userData.lines,O={viewState:n,graphInfo:b,compiled:f,derivative:p};k=u.default.computeGraphData(O);if(g&&(k.boundingBox=g),k.fillSegments){k.fillSegments;var L=a.__rest(k,["fillSegments"]);P||(L.lineWidth=0),H.push(L)}else P||(k.lineWidth=0),H.push(k);b.graphMode===c.IMPLICIT&&"="!==b.operator&&H.push({graphMode:c.POLYGONFILL,segments:k.fillSegments,poi:{},listIndex:b.listIndex,color:_,fillOpacity:w})}else if(v){var N={viewState:n,graphInfo:b,compiled:f,bounds:[I,C],maxOverride:M(y,t),showPoint:m.userData.shouldGraph},A=(R=d.makeDiscreteCDFTopBranches(N)).cdfTopBranch;if((F=R.topBranches).forEach(function(e){e&&g&&(e.boundingBox=g)}),F.every(function(e){return void 0!==e})&&(H=F,A&&A.segments[0].length)){var D=[];A.segments[0].forEach(function(e){isNaN(e[0])||isNaN(e[1])||D.push([e[0],0,e[0],e[1]])}),H.push({graphMode:c.PARAMETRIC,segments:D,boundingBox:g,poi:{},color:_})}}else{var R,F;N={viewState:n,graphInfo:b,compiled:f,derivative:p,bounds:[I,C]},A=(R=d.makeContinuousCDFTopBranches(N)).cdfTopBranch;if((F=R.topBranches).forEach(function(e){e&&g&&(e.boundingBox=g)}),H=F,A&&A.segments.length){for(var q=void 0,B=void 0,V=0;V<A.segments.length;V++){if((z=A.segments[V]).length>=4){q=z[0];break}}for(V=A.segments.length-1;V>=0;V--){var z;if((z=A.segments[V]).length>=4){B=z[z.length-2];break}}if(void 0!==q&&void 0!==B&&isFinite(q)&&isFinite(B)){var j=u.default.polygonsFromSegments(A.segments,[[q,0,B,0]],A.graphMode);H.push({graphMode:c.POLYGONFILL,segments:j,poi:{},color:_})}}}}}),H;case c.POLYGON:D=[];var $=void 0===this.userData.lines||this.userData.lines,X=void 0===this.userData.fill||this.userData.fill;if(!X&&!$)return D;B=I(this.metaData,["computedLineOpacity","computedLineWidth","colorLatexValue","fillOpacity"],l);var Z=t.asValue();b.isList(t.valueType)||(Z=[Z]);for(var Q=0;Q<Z.length;Q++)if(!(Q>B-1)){var ee=Z[Q];if(ee.length){var te=this.getGraphInfo(e,t),re=T.getListIdxFromBranchIdx(Q,l),ne=E(this.metaData.computedLineWidth,Q,l),ie=E(this.metaData.computedLineOpacity,Q,l),ae=E(this.metaData.computedFillOpacity,Q,l),oe=this.metaData.colorLatexValue?E(this.metaData.colorLatexValue,Q,l):this.userData.color,se=N(ee=a.__spreadArray(a.__spreadArray([],ee),[ee[0]]));se.length&&(X&&D.push({segments:se,graphMode:c.POLYGONFILL,poi:{},color:oe,fillOpacity:ae,style:te.style,listIndex:re}),$&&D.push({segments:se,graphMode:c.PARAMETRIC,poi:{},color:oe,style:this.userData.lineStyle,lineWidth:ne,lineOpacity:ie,listIndex:re}))}}return D;case c.POLYGONFILL:case c.VISUALIZATION:case c.OBJECT3D:case c.NONE:case c.ERROR:return!1;default:var ue=o.graphMode;throw new Error("Unexpected graphMode: "+ue)}},r.Base.prototype.tryGraph=function(e,t,n){try{return this.graph(e,t,n)}catch(e){var i=e instanceof r.Error?e.getError():o.parseError().getError();return[u.errorBranch(i)]}},r.Base.prototype.graph=function(e,t,r){var n=this.getGraphInfo(e,t);return this._graph(e,t,r,n)},r.BaseComparator.prototype.graph=function(e,t,i){var a=this.getGraphInfo(e,t),o=a.graphMode,s="baseComparator",l=void 0===this.userData.lines||this.userData.lines;if(o===c.IMPLICIT)return this._graph(e,t,i,a);if(o===c.NONE)return!1;if(!(t instanceof r.SolvedEquation))return!1;var p=this.getOperator(),d=[],f=[],h=!0;t._expression.eachElement(function(e){d.push(e.getCompiledFunction());try{f.push(e.getCompiledDerivative())}catch(e){h=!1}}),h||(f=void 0);for(var y=[],m=[-1,0,0,1],v=I(this.metaData,["computedLineWidth","computedLineOpacity","computedFillOpacity","colorLatexValue"],s),g=Math.min(d.length,v),b=0;b<g;b++){var x=this.getGraphInfo(e,t._expression.args[b]);x.graphMode=o,x.listIndex=T.getListIdxFromBranchIdx(b,s),x.style=this.userData.lineStyle,x.color=this.metaData.colorLatexValue?E(this.metaData.colorLatexValue,b,s):this.userData.color,a.graphMode===c.POLAR&&(x.domain={min:this.metaData.evaluatedDomainMin,max:this.metaData.evaluatedDomainMax,isExplicit:this.metaData.isExplicitDomain});var S=u.default.computeGraphData({viewState:i,graphInfo:x,compiled:d[b],derivative:f?f[b]:void 0});S.lineWidth=E(this.metaData.computedLineWidth,b,s),S.lineOpacity=E(this.metaData.computedLineOpacity,b,s),S.fillOpacity=E(this.metaData.computedFillOpacity,b,s),S.operator=n.get(n.table[p].inclusive,m[b%4]),l||(S.lineWidth=0),y.push(S)}for(b=0;b<g;b+=4){var w=u.default.polygonsFromSegments(y[b+1].segments,y[b+2].segments,o);y.push({graphMode:c.POLYGONFILL,listIndex:y[b].listIndex,segments:w,poi:{},fillOpacity:y[b].fillOpacity,color:y[b].color})}return y},r.DoubleInequality.prototype.graph=function(e,t,r){var i=this,a=this.getGraphInfo(e,t);if(a.graphMode===c.NONE)return!1;var o=[],s=n.get(n.table[this._operators[0]].inclusive,0),l=n.get(n.table[this._operators[1]].inclusive,0),p=this.userData,d=this.metaData,f=void 0===p.lines||p.lines,h=["colorLatexValue","computedFillOpacity"];f&&h.push("computedLineWidth","computedLineOpacity");var y=I(d,h);return _.eachArgs(t._expressions,function(t,n){if(!(n>=y)){t[0].userData=t[1].userData=p,t[0].metaData=t[1].metaData=d;var h=i.metaData.colorLatexValue?E(d.colorLatexValue,n):p.color,m=E(d.computedLineWidth,n),v=E(d.computedLineOpacity,n),g=E(d.computedFillOpacity,n),b=i._graph(e,t[0],r,a)[0];b.listIndex=n,b.operator=s,b.color=h,b.lineWidth=m,b.lineOpacity=v,o.push(b);var x=i._graph(e,t[1],r,a)[0];x.listIndex=n,x.operator=l,x.color=h,x.lineWidth=m,x.lineOpacity=v,o.push(x);var S=u.default.polygonsFromSegments(b.segments,x.segments,b.graphMode);f||(b.lineWidth=0,x.lineWidth=0),o.push({graphMode:c.POLYGONFILL,listIndex:b.listIndex,segments:S,lineOpacity:v,fillOpacity:g,poi:{},color:h})}}),o},r.Regression.prototype.graph=function(e,t,r){var n=this.getGraphInfo(e,t);return this._graph(e,t.model,r,n)};var P=function(e){var t=[];return _.wrap(e).eachElement(function(e){t.push(e.args.map(function(e){return e.asValue()}))}),t};function O(e){return Array.prototype.concat.apply([],e)}function L(e,t,r){return!!e&&(0===t&&0===r?"none"!==e[2].type||"none"!==e[3].type:0!==t&&0!==r?"none"!==e[0].type&&"none"!==e[1].type:0!==t?"none"!==e[0].type:0!==r&&"none"!==e[1].type)}function N(e){for(var t=[],r=[],n=0,i=e;n<i.length;n++){var a=i[n],o=a[0],s=a[1];isNaN(o)||isNaN(s)?(t.length>=4&&r.push(t),t=[]):t.push(o,s)}return t.length>=4&&r.push(t),r}r.Object3D.prototype.graph=function(e,t,r){var n=this.getGraphInfo(e,t);return[{segments:[P(t)],color:n.color,objectName:this._symbol,graphMode:c.OBJECT3D}]},r.Histogram.prototype.graph=function(e,t,r){var n=this.getGraphInfo(e,t),i=t.args[0].asValue(),a=t.args[1].asValue(),o=k(i,a,this.userData.vizProps&&"left"===this.userData.vizProps.binAlignment?a/2:0),s=1;this.userData.vizProps&&"density"===this.userData.vizProps.histogramMode?s=1/(i.length*a):this.userData.vizProps&&"relative"===this.userData.vizProps.histogramMode&&(s=1/i.length);var u=[],l=[];for(var p in o){var d=o[p],f=d.data.length;l.push([d.min,0*s,d.min,f*s,d.max,f*s,d.max,0*s]);var h=0;o[d.id+1]&&(h=o[d.id+1].data.length);var y=[d.min,0*s,d.min,f*s,d.max,f*s];h<f&&y.push(d.max,h*s),u.push(y)}var v=C("histogram",l);return v&&a&&(v.binWidth=a),[{segments:l,graphMode:c.POLYGONFILL,boundingBox:v,poi:{},color:n.color,fillOpacity:m.DEFAULT},{segments:u,graphMode:c.Y,poi:{zeros:{x:[],y:[]},extrema:{x:[],y:[]},intercept:{x:[],y:[]}},color:n.color}]},r.DotPlot.prototype.graph=function(e,t,r){var n,i=this.getGraphInfo(e,t),a=t.args[1].asValue(),o=this.userData.vizProps&&"left"===this.userData.vizProps.binAlignment?a/2:0,s=k(t.args[0].asValue(),a,o),u=!1,l=[];for(var p in s)for(var d=(y=s[p]).data.length-1;d>=0;d--)y.center!==y.data[d]&&(u=!0);if(this.userData.vizProps&&"exact"===this.userData.vizProps.dotplotXMode)for(var p in s){(n=(y=s[p]).data).reverse();for(var h=0;h<n.length;h++)l.push([n[h],h+1])}else for(var p in s){var y;n=(y=s[p]).data;for(h=0;h<n.length;h++)l.push([y.center,h+1])}var m=C("dotplot",l);m&&a&&(m.ymin=0,m.xmin-=.5*a,m.xmax+=.5*a,m.binWidth=a);var v=this.metaData,g=v.computedPointOpacity,b=v.computedPointSize,x=E(g,0),S=this.userData.pointSize?E(b,0):w.DOTPLOT_DEFAULT;return[{segments:[l],graphMode:c.XYPOINT,boundingBox:m,poi:f.default(l),color:i.color,style:this.userData.pointStyle,pointSize:S,pointOpacity:x,showPoint:!0,needsDotplotXMode:u}]},r.BoxPlot.prototype.graph=function(e,t,r){var n=this.getGraphInfo(e,t),i=this.metaData.evaluatedAxisOffset,a=this.metaData.evaluatedBreadth,o=t.args[0].asValue();if(isNaN(a)||isNaN(i))return!1;var u=Math.min.apply(null,o),l=Math.max.apply(null,o),p=s.quartile(o,1),d=s.quartile(o,2),h=s.quartile(o,3),y=i,m=y-a/2,v=y+a/2,b=a/10,x=[];if(this.userData.vizProps.showBoxplotOutliers){var S=h-p,T=p-1.5*S,w=h+1.5*S;u=1/0,l=-1/0,o.forEach(function(e){T<=e&&e<u&&(u=e),l<e&&e<=w&&(l=e),(e<T||e>w)&&x.push([e,y])})}var _=[[p,m,h,m,h,v,p,v,p,m],[d,m,d,v],[p,y,u,y],[h,y,l,y],[u,y-b,u,y+b],[l,y-b,l,y+b]];if(this.userData.vizProps&&"y"===this.userData.vizProps.alignedAxis){for(var I=0,E=_;I<E.length;I++)for(var M=E[I],k=0;k<M.length;k+=2){var P=M[k];M[k]=M[k+1],M[k+1]=P}for(var O=0,L=x;O<L.length;O++){var N=L[O];P=N[0];N[0]=N[1],N[1]=P}}var A=[{segments:_,graphMode:c.PARAMETRIC,boundingBox:C("boxplot",_.concat(x)),poi:{},color:n.color}];return x.length&&A.push({segments:[x],graphMode:c.XYPOINT,color:n.color,style:g.PointStyle.OPEN,showPoint:!0,poi:f.default(x)}),A},r.Table.prototype.isValueDraggable=function(e,t,r){if(!e.columns[t].isIndependent)return!1;var n=this.columns[t].values,i=n&&n[r];return!(!i||!isFinite(i.asValue())||0!==i.getDependencies().length)},r.Table.prototype.graph=function(e,t,r){var n={};if(t.columns[0].isError)return n;for(var i=t.columns[0],a=i.values,o=1;o<this.columns.length;o++){var s=t.columns[o];if(!s.isError){var u=this.columns[o].header.userData,p=this.columns[o].header.metaData;if(!u.hidden){for(var d=I(p,["colorLatexValue","computedPointSize","computedPointOpacity"]),h=u.dragMode,y=h===l.DragMode.X||h===l.DragMode.XY,m=h===l.DragMode.Y||h===l.DragMode.XY,g=!!u.points,b=!!u.lines,x=s.isDiscrete(i),S=b&&x,T=b&&!x,w=[],_=[],E=[],C=[],M=[],k=[],P=1/0,L=-1/0,N=1/0,A=-1/0,D={},R=0;R<a.length;R++){var F=a[R],q=s.values[R];if(F&&q&&isFinite(F.asValue())&&isFinite(q.asValue())){var B=F.asValue(),V=q.asValue();if(g){if(R>=d)continue;var z=y&&this.isValueDraggable(t,0,R),j=m&&this.isValueDraggable(t,o,R);z||j?(E.push([B,V]),C.push({index:R,dragX:z,dragY:j})):_.push([B,V])}S&&k.push([B,V]),B<P&&(P=B),B>L&&(L=B),V<N&&(N=V),V>A&&(A=V)}else D[R]=!0,S&&(k.length>1&&M.push(k),k=[])}var U={type:"table",xmin:P,xmax:L,ymin:N,ymax:A};if(E.length&&w.push({graphMode:c.XYPOINT_MOVABLE,segments:[E],color:p.colorLatexValue||u.color,tableId:u.tableId,poi:f.default(E),movablePointInfo:C,boundingBox:U,pointOpacity:p.computedPointOpacity}),_.length&&w.push({segments:[_],droppedIndices:D,graphMode:c.XYPOINT,showPoint:!0,poi:f.default(_),color:p.colorLatexValue||u.color,pointSize:p.computedPointSize,pointOpacity:p.computedPointOpacity,style:u.pointStyle,tableId:u.tableId,boundingBox:U}),(M.length||k.length)&&(M.push(k),w.push({segments:M.map(O),graphMode:c.PARAMETRIC,poi:{},color:v.getDisplayColor(u,p),style:u.lineStyle,lineWidth:Array.isArray(p.computedLineWidth)?p.computedLineWidth[0]:p.computedLineWidth,lineOpacity:Array.isArray(p.computedLineOpacity)?p.computedLineOpacity[0]:p.computedLineOpacity,tableId:u.tableId,boundingBox:U})),T){var G=this.columns[o].header.graph(e,t.columns[o].continuousConcreteTree,r);G.length&&Array.prototype.push.apply(w,G)}w.length&&(n[u.id]=w)}}}return n},r.Image.prototype.graph=function(e,t,r){var n=[];if(!(t.center.valueType===b.Point&&0===t.center.getDependencies().length&&t.radianAngle.isConstant&&t.width.isConstant&&t.height.isConstant&&t.opacity.isConstant))return n;for(var i=[],a=[],o=t.width.asValue()/2,s=t.height.asValue()/2,u=t.radianAngle.asValue(),l=-1;l<=1;l++)for(var p=-1;p<=1;p++){var d=t.center.asValue(),h=d[0],y=d[1],m=[h+l*o*Math.cos(u)+p*s*Math.sin(u),y-l*o*Math.sin(u)+p*s*Math.cos(u)];L(t.moveStrategy,l,p)&&(i.push(m),a.push([l,p]))}return n.push({segments:[i],scaleFactors:[a],graphMode:c.XYPOINT_MOVABLE,color:v.getDisplayColor(this.userData,this.metaData),style:this.userData.style,poi:f.default(i),movablePointInfo:[],pointOpacity:1}),n}});r("core/math/features/elementAt",["require","parsenodes"],function(e){"use strict";var t=e("parsenodes");t.List.prototype.elementAt=function(e){return(e=Math.floor(e))>=0&&e<this.args.length?this.args[e]:t.Constant(NaN)},t.List.prototype.eachElement=function(e){for(var t=0;t<this.length;t++)e(this.elementAt(t),t)},t.List.prototype.mapElements=function(e){for(var t=[],r=0;r<this.length;r++)t.push(e(this.elementAt(r),r));return t},t.ParenSeq.prototype.elementAt=function(e){return e<0||e>this.args.length-1?t.Constant(NaN):this.args[e]}});r("core/math/features/printLatex",["require","parsenodes","core/lib/label","core/lib/number-to-latex"],function(e){"use strict";var t=e("parsenodes"),r=e("core/lib/label"),n=e("core/lib/number-to-latex").default;function i(e){switch(e){case">":return">";case"<":return"<";case">=":return"\\ge ";case"<=":return"\\le ";case"=":return"="}}function a(e){return e.printLatex()}function o(e){return e.isConstant&&!0===e.asValue()}t.Identifier.prototype.printLatex=function(){return r.identifierToLatex(this._symbol)+" "},t.Constant.prototype.printLatex=function(){return n(this.asValue())},t.Ticker.prototype.printLatex=function(){return"\\ticker\\left("+this.args.map(a).join(", ")+"\\right)"},t.Negative.prototype.printLatex=function(){return"-\\left("+this.args[0].printLatex()+"\\right)"},t.Add.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)+\\left("+this.args[1].printLatex()+"\\right)"},t.PercentOf.prototype.printLatex=function(){return this.args[0].printLatex()+" \\% \\operatorname{of} "+this.args[1].printLatex()},t.Subtract.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)-\\left("+this.args[1].printLatex()+"\\right)"},t.Multiply.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)*\\left("+this.args[1].printLatex()+"\\right)"},t.Divide.prototype.printLatex=function(){return"\\frac{"+this.args[0].printLatex()+"}{"+this.args[1].printLatex()+"}"},t.Exponent.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)^{"+this.args[1].printLatex()+"}"},t.Assignment.prototype.printLatex=function(){return r.identifierToLatex(this._symbol)+"="+this._expression.printLatex()},t.Equation.prototype.printLatex=function(){return this._lhs.printLatex()+"="+this._rhs.printLatex()},t.BaseComparator.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)"+i(this.operator)+"\\left("+this.args[1].printLatex()+"\\right)"},t.DoubleInequality.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)"+i(this.args[1])+this.args[2].printLatex()+i(this.args[3])+"\\left("+this.args[4].printLatex()+"\\right)"},t.And.prototype.printLatex=function(){if(!(this.args[0]instanceof t.BaseComparator&&this.args[1]instanceof t.BaseComparator))throw new Error("Not implemented");if(this.args[0].args[1].printLatex()!==this.args[1].args[0].printLatex())throw new Error("Not implemented");return"\\left("+this.args[0].args[0].printLatex()+"\\right)"+i(this.args[0].operator)+"\\left("+this.args[0].args[1].printLatex()+"\\right)"+i(this.args[1].operator)+"\\left("+this.args[1].args[1].printLatex()+"\\right)"},t.FunctionCall.prototype.printLatex=function(){switch(this._symbol){case"sqrt":return"\\sqrt{"+this.args[0].printLatex()+"}";case"nthroot":return"\\sqrt["+this.args[1].printLatex()+"]{"+this.args[0].printLatex()+"}";case"logbase":return"\\log_{"+this.args[1].printLatex()+"}\\left("+this.args[0].printLatex()+"\\right)";default:return r.identifierToLatex(this._symbol)+"\\left("+this.args.map(a).join(", ")+"\\right)"}},t.SeededFunctionCall.prototype.printLatex=function(){return r.identifierToLatex(this._symbol)+"\\left("+this.args.slice(1).map(a).join(", ")+"\\right)"},t.DotAccess.prototype.printLatex=function(){return"("+this.args[0].printLatex()+").("+this.args[1].printLatex()+")"},t.Prime.prototype.printLatex=function(){switch(this.args[0]._symbol){case"logbase":return"\\log_{"+this.args[0].args[1].printLatex()+"}"+Array(this.order+1).join("'")+"\\left("+this.args[0].args[0].printLatex()+"\\right)";default:return r.identifierToLatex(this.args[0]._symbol)+Array(this.order+1).join("'")+"\\left("+this.args[0].args.map(a).join(", ")+"\\right)"}},t.List.prototype.printLatex=function(){return"\\left["+this.args.map(a).join(", ")+"\\right]"},t.Range.prototype.printLatex=function(){return"\\left["+this.args[0].args.map(a).join(", ")+" ... "+this.args[1].args.map(a).join(", ")+"\\right]"},t.UpdateRule.prototype.printLatex=function(){return this.args[0].printLatex()+"\\to("+this.args[1].printLatex()+")"},t.ListAccess.prototype.printLatex=function(){return"\\left("+this.args[0].printLatex()+"\\right)\\left["+this.args[1].printLatex()+"\\right]"},t.ParenSeq.prototype.printLatex=function(){return"\\left("+this.args.map(a).join(", ")+"\\right)"},t.BareSeq.prototype.printLatex=function(){return this.args.map(a).join(", ")},t.Sum.prototype.printLatex=function(){return"\\sum_{"+this.args[0].printLatex()+"="+this.args[1].printLatex()+"}^{"+this.args[2].printLatex()+"}\\left("+this.args[3].printLatex()+"\\right)"},t.Product.prototype.printLatex=function(){return"\\prod_{"+this.args[0].printLatex()+"="+this.args[1].printLatex()+"}^{"+this.args[2].printLatex()+"}\\left("+this.args[3].printLatex()+"\\right)"},t.Integral.prototype.printLatex=function(){return"\\int_{"+this.args[1].printLatex()+"}^{"+this.args[2].printLatex()+"}\\left("+this.args[3].printLatex()+"\\right)d"+this.args[0].printLatex()},t.FunctionExponent.prototype.printLatex=function(){return this.args[0].printLatex()+"\\left("+this.args[1].printLatex()+"\\right)^{"+this.args[2].printLatex()+"}"},t.FunctionFactorial.prototype.printLatex=function(){return this.args[0].printLatex()+"\\left("+this.args[1].printLatex()+"\\right)!"},t.Piecewise.prototype.printLatex=function(){var e=this;if(o(e.args[0]))return e.args[1].printLatex();for(var r,n=["\\left\\{"];;){if(o(e.args[0])){n.push(e.args[1].printLatex());break}if(n.push(e.args[0].printLatex(),": "),(r=e.args[2]).isConstant&&r.isNaN()){n.push(e.args[1].printLatex());break}if(n.push(e.args[1].printLatex(),", "),!(e.args[2]instanceof t.Piecewise)){n.push(e.args[2].printLatex());break}e=e.args[2]}return n.push("\\right\\}"),n.join("")},t.FunctionDefinition.prototype.printLatex=function(){return r.identifierToLatex(this._symbol)+"\\left("+this._argSymbols.map(r.identifierToLatex).join(", ")+"\\right) = "+this._expression.printLatex()},t.Derivative.prototype.printLatex=function(){return"\\frac{d}{d"+r.identifierToLatex(this._symbol)+"}\\left("+this.args[0].printLatex()+"\\right)"},t.Regression.prototype.printLatex=function(){return"\\left("+this._lhs.printLatex()+"\\right)\\sim\\left("+this._rhs.printLatex()+"\\right)"},t.Histogram.prototype.printLatex=function(){return"\\histogram\\left("+this.args.map(a).join(", ")+"\\right)"},t.Object3D.prototype.printLatex=function(){return"\\"+this._symbol+"\\left("+this.args.map(a).join(", ")+"\\right)"},t.DotPlot.prototype.printLatex=function(){return"\\dotplot\\left("+this.args.map(a).join(", ")+"\\right)"},t.BoxPlot.prototype.printLatex=function(){return"\\boxplot\\left("+this.args.map(a).join(", ")+"\\right)"},t.TTest.prototype.printLatex=function(){return"\\TTest\\left("+this.args.map(a).join(", ")+"\\right)"},t.IndependentTTest.prototype.printLatex=function(){return"\\IndependentTTest\\left("+this.args.map(a).join(", ")+"\\right)"},t.Stats.prototype.printLatex=function(){return"\\Stats\\left("+this.args.map(a).join(", ")+"\\right)"},t.AssignmentExpression.prototype.printLatex=function(){return r.identifierToLatex(this._symbol)+"="+this.args[1].printLatex()},t.ListComprehension.prototype.printLatex=function(){return"\\left["+this._body.printLatex()+"\\operatorname{for}"+this._inputLists.map(a).join(", ")+"\\right]"}});r("core/math/features/getExpressionType",["require","parsenodes","core/types/graphmode","core/math/expression-types","core/math/types"],function(e){"use strict";var t=e("parsenodes"),r=e("core/types/graphmode"),n=e("core/math/expression-types").ExpressionType,i=e("core/math/types");t.Base.prototype.getExpressionType=function(e,t){return e===r.X||e===r.Y?n.X_OR_Y:e===r.XYPOINT||e===r.XYPOINT_MOVABLE?t===i.Point?n.SINGLE_POINT:n.POINT_LIST:e===r.PARAMETRIC||e===r.PARAMETRIC_CURVE_3D?n.PARAMETRIC:e===r.POLAR?n.POLAR:e===r.IMPLICIT?n.IMPLICIT:i.isTypeOrListOfType(t,i.Polygon)?n.POLYGON:n.X_OR_Y},t.Histogram.prototype.getExpressionType=function(e,t){return n.HISTOGRAM},t.Object3D.prototype.getExpressionType=function(e,t){return n.CUBE},t.DotPlot.prototype.getExpressionType=function(e,t){return n.DOTPLOT},t.BoxPlot.prototype.getExpressionType=function(e,t){return n.BOXPLOT}});r("parser",["require","core/math/baseparser","core/math/features/getConcreteTree","core/math/features/buildIRExpression","core/math/features/typeCheck","core/math/features/repr","core/math/features/substitute","core/math/features/simpleFunctionExpression","core/math/features/analyze","core/math/features/analyzeFourFunction","core/math/features/analyzeScientific","core/math/features/analyzeSingleExpressionScientific","core/math/features/getgraphmode","core/math/features/getgraphinfo","core/math/features/getMoveStrategy","core/math/features/getDefaultDragMode","core/math/features/tableinfo","core/math/features/tableerror","core/math/features/graph","core/math/features/elementAt","core/math/features/printLatex","core/math/features/getExpressionType"],function(e){"use strict";var t=e("core/math/baseparser");return e("core/math/features/getConcreteTree"),e("core/math/features/buildIRExpression"),e("core/math/features/typeCheck"),e("core/math/features/repr"),e("core/math/features/substitute"),e("core/math/features/simpleFunctionExpression"),e("core/math/features/analyze"),e("core/math/features/analyzeFourFunction"),e("core/math/features/analyzeScientific"),e("core/math/features/analyzeSingleExpressionScientific"),e("core/math/features/getgraphmode"),e("core/math/features/getgraphinfo"),e("core/math/features/getMoveStrategy"),e("core/math/features/getDefaultDragMode"),e("core/math/features/tableinfo"),e("core/math/features/tableerror"),e("core/math/features/graph"),e("core/math/features/elementAt"),e("core/math/features/printLatex"),e("core/math/features/getExpressionType"),t});r("core/math/finddependencyorder",["require","exports","core/math/builtinframe","underscore"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findDependencyOrder=void 0,t.findDependencyOrder=function(e,t,i){var a=[],o={},s={},u={},c={},l={},p=0,d=[],f=[];if(!i)for(var h in i=[],t)t.hasOwnProperty(h)&&i.push(h);for(var h in t)if(t.hasOwnProperty(h)){for(var y=t[h].exportPenalty||0;a.length<y+1;)a.push([]);a[y].push(h)}for(var m=0,v=a;m<v.length;m++){for(var g={},b=0,x=v[m];b<x.length;b++){h=x[b];for(var S=0,T=t[h].getLegalExports(e);S<T.length;S++){var w=T[S];r[w]||(o[w]||(g[w]=g[w]||[],g[w].push(h),g[w].length>1&&(!s[w]&&t[h].isTable&&(u[w]=!0),s[w]=!0)))}}for(var w in g)u[w]||(o[w]=g[w])}for(var _=0,I=i;_<I.length;_++){w=I[_];l.hasOwnProperty(w)||E(w)}function E(r){l[r]=l[r]||{};var i,a=l[r];a.id=r,a.index=p,a.lowlink=p,d.push(a),a.instack=!0,p++;for(var s=0,u=t[r].getDependencies();s<u.length;s++){var h=u[s];if(o.hasOwnProperty(h))for(var y=0,m=o[h];y<m.length;y++){var v=m[y];l.hasOwnProperty(v)?(i=l[v]).instack&&(a.lowlink=Math.min(a.lowlink,i.index)):(E(v),i=l[v],a.lowlink=Math.min(a.lowlink,i.lowlink))}}if(a.lowlink===a.index)if((i=d.pop()).instack=!1,i===a)!function(e){f.push(e.id)}(a);else{for(var g=[i];(i=d.pop()).instack=!1,g.push(i),i!==a;);!function(r){for(var i=[],a=r.length-1;a>=0;a--){var o=r[a],s=t[o.id].getLegalExports(e);Array.prototype.push.apply(i,s),i.push(s[0]),f.push(o.id)}(i=n.unique(i)).sort();for(var u=0,l=i;u<l.length;u++){var p=l[u];c[p]=i}}(g)}}return{resolved:f,multiplyDefined:s,multiplyDefinedByTables:u,cyclicallyDefined:c}}});r("core/math/findIntersections",["require","core/types/graphmode","./plotter","parsenodes","core/math/distance"],function(e){"use strict";var t=e("core/types/graphmode"),r=e("./plotter").default,n=e("parsenodes"),i=e("core/math/distance");function a(e){for(var t=[],r=0;r<e;r++)t[r]={x:[],y:[],intersects:[]};return t}function o(e,r,n,i){return n===t.X&&i===t.X||n===t.Y&&i===t.Y?function(t){return r(t)-e(t)}:(n===t.X&&i===t.Y||n===t.Y&&i===t.X)&&function(t){return t-r(e(t))}}function s(e,t){t instanceof n.SolvedEquation?t=t._expression:t instanceof n.OptimizedRegression&&(t=t.model);var r=[],i=[];return t instanceof n.DoubleInequality?n.List.eachArgs(t._expressions,function(e){r.push(e[0].getCompiledFunction()),i.push(e[0].isConstant&&e[1].isNaN()),r.push(e[1].getCompiledFunction()),i.push(e[1].isConstant&&e[1].isNaN())}):n.List.wrap(t).eachElement(function(e){r.push(e.getCompiledFunction()),i.push(e.isConstant&&e.isNaN())}),{functions:r,skipIntersecting:i}}function u(e,t){e.intersects=Array(e.x.length);for(var r=0;r<e.x.length;r++)e.intersects[r]=t}function c(e,r){if(r===t.X){var n=e.y;e.y=e.x,e.x=n}}function l(e,t){Array.prototype.push.apply(e.x,t.x),Array.prototype.push.apply(e.y,t.y),Array.prototype.push.apply(e.intersects,t.intersects)}function p(e,t,n){var a=r.sampleXY(e,t),o=a.poi.zeros,s=a.poi.extrema,u=[],c=0,l=0;for(c=0;c<o.x.length;c++){for(;l<s.x.length&&s.x[l]<o.x[c];l++)i.approx(s.y[l],0)&&u.push(s.x[l]);u.push(o.x[c])}for(;l<s.x.length;l++)i.approx(s.y[l],0)&&u.push(s.x[l]);return{x:u,y:u.map(n)}}return{findIntersections:function(e,t,n){var i,d,f,h=e[n],y=h.getGraphInfo(),m=h.getGraphMode();try{d=a((i=s(h.policy,h.concreteTree)).functions.length),f=function(e,t){var r=[];for(var n in e)if(e.hasOwnProperty(n)&&String(n)!==String(t)&&e[n].shouldIntersect()){var i=e[n],a=s(i.policy,i.concreteTree);r.push({id:n,graphMode:i.getGraphMode(),functions:a.functions,skipIntersecting:a.skipIntersecting})}return r}(e,n)}catch(e){return a(0)}if(!f)return d;for(var v=0,g=0;g<f.length;g++)for(var b=f[g],x=0;x<i.functions.length;x++)if(!i.skipIntersecting[x])for(var S=i.functions[x].fn,T=r.computeDomain(t,y,S),w=0;w<b.functions.length;w++)if(!f[g].skipIntersecting[w]){var _=o(S,b.functions[w].fn,m,b.graphMode);if(_){var I=p(_,T,S);if((v+=I.x.length)>100)return a(i.functions.length);u(I,b.id),c(I,m),l(d[x],I)}}return d},findIndicatorZeros:p}});r("core/math/policyFourFunction",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolicySingleExpressionFourFunction=t.PolicyFourFunction=void 0;var r=function(){function e(e){this.singleExpression=e.singleExpression}return e.prototype.assignmentForbidden=function(e){return"ans"!==e.slice(0,3)},e.prototype.isValidSlider=function(e){return!1},e.prototype.sliderVariables=function(){return[]},e.prototype.graphingEnabled=function(){return!1},e.prototype.ansEnabled=function(){return!this.singleExpression},e.prototype.disabledFeatures=function(){return["Sum","Product","Integral","List","Derivative","Piecewise","Exponent","PercentOf"]},e}();t.PolicyFourFunction=new r({singleExpression:!1}),t.PolicySingleExpressionFourFunction=new r({singleExpression:!0})});r("core/math/policyScientific",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolicySingleExpressionScientific=t.PolicyScientific=void 0;var r=function(){function e(e){this.singleExpression=e.singleExpression}return e.prototype.assignmentForbidden=function(e){return this.singleExpression?"ans"!==e.slice(0,3):"tmp"===e.slice(0,3)},e.prototype.isValidSlider=function(e){return!1},e.prototype.sliderVariables=function(){return[]},e.prototype.graphingEnabled=function(){return!1},e.prototype.ansEnabled=function(){return!this.singleExpression},e.prototype.disabledFeatures=function(){return this.singleExpression?["Sum","Product","Integral","Derivative","Piecewise","PercentOf"]:["Sum","Product","Integral","Derivative","Piecewise"]},e}();t.PolicyScientific=new r({singleExpression:!1}),t.PolicySingleExpressionScientific=new r({singleExpression:!0})});r("core/math/policyGraphing",["require","exports","./builtinframe","core/types/graphmode"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PolicyGraphing3D=t.PolicyGraphing=void 0;var i=function(){function e(){}return e.prototype.dimensions=function(){return 2},e.prototype.assignmentForbidden=function(e){return"x"===e||"y"===e||"theta"===e||"index"===e||"dt"===e||"tmp"===e.slice(0,3)||r.hasOwnProperty(e)},e.prototype.isValidSlider=function(e){return"x"===e||"y"===e||"ans"!==e.slice(0,3)&&!this.assignmentForbidden(e)},e.prototype.sliderVariables=function(e){var t=this;return-1!==e.indexOf("theta")&&(e=e.filter(function(e){return"r"!==e})),e.filter(function(e){return!t.assignmentForbidden(e)&&("ans"!==e.slice(0,3)&&"_"!==e[0])})},e.prototype.graphingEnabled=function(){return!0},e.prototype.ansEnabled=function(){return!1},e.prototype.validRegressionParameter=function(e){return"x"!==e&&"y"!==e},e.prototype.validLHS=function(e){return"theta"!==e},e.prototype.unplottablePolarFunction=function(e,t){return"theta"===e&&-1!==t.indexOf("r")},e.prototype.validDoubleInequalitySymbol=function(e){return"x"===e||"y"===e},e.prototype.validDoubleInequalityVariables=function(e){return!(e.length>2)&&e.every(this.validDoubleInequalitySymbol)},e.prototype.validExpressionVariables=function(e){return 1===e.length&&"x"===e[0]},e.prototype.validSolvedVariable=function(e){return"x"===e||"y"===e||"r"===e},e.prototype.validImplicitVariables=function(e){switch(e.length){case 0:return!0;case 1:return"x"===e[0]||"y"===e[0]||"r"===e[0];case 2:return"x"===e[0]&&"y"===e[1]||"y"===e[0]&&"x"===e[1]||"r"===e[0]&&"theta"===e[1]||"theta"===e[0]&&"r"===e[1];default:return!1}},e.prototype.graphableListVariables=function(e,t){return"x"===e||"y"===e||"r"===e||"x"===t||"y"===t},e.prototype.validParametricVariable=function(e){return"t"===e},e.prototype.validParametricVariables=function(e){return 1===e.length&&this.validParametricVariable(e[0])},e.prototype.validInequalityVariables=function(e){switch(e.length){case 1:return"x"===e[0]||"y"===e[0]||"r"===e[0];case 2:return this.validImplicitVariables(e);default:return!1}},e.prototype.validFirstColumnVariable=function(e){return"y"!==e&&"r"!==e&&"theta"!==e&&!e.match(/y_(\d+)/)},e.prototype.validActionVariable=function(e){return"dt"===e||"index"===e},e.prototype.complicatedPolarImplicit=function(e,t){return"theta"===e||"r"===e&&1!==t},e.prototype.constantGraphMode=function(e){return"x"===e?n.X:"r"===e?n.POLAR:n.Y},e.prototype.graphMode=function(e,t){var r=t[0];return"y"===r||"x"===e?n.X:"r"===e&&"theta"===r?n.POLAR:n.Y},e.prototype.tableableAsConstant=function(e){return"x"!==e&&("r"!==e&&"theta"!==e)},e.prototype.implicitIndependent=function(e){return"x"},e.prototype.implicitDependency=function(e){return 1!==e.length?"y":"y"===e[0]?"x":"theta"===e[0]?"r":"y"},e.prototype.graphableAsConstant=function(e){return"y"===e||"x"===e||"r"===e},e.prototype.disabledFeatures=function(){return[]},e}(),a=function(){function e(){}return e.prototype.dimensions=function(){return 3},e.prototype.assignmentForbidden=function(e){return"x"===e||"y"===e||"z"===e||"tmp"===e.slice(0,3)||r.hasOwnProperty(e)},e.prototype.isValidSlider=function(e){return"x"===e||"y"===e||"z"===e||"ans"!==e.slice(0,3)&&!this.assignmentForbidden(e)},e.prototype.sliderVariables=function(e){var t=this;return e.filter(function(e){return!t.assignmentForbidden(e)&&"ans"!==e.slice(0,3)})},e.prototype.graphingEnabled=function(){return!0},e.prototype.ansEnabled=function(){return!1},e.prototype.validRegressionParameter=function(e){return!1},e.prototype.validLHS=function(e){return!0},e.prototype.unplottablePolarFunction=function(e,t){return!1},e.prototype.validDoubleInequalitySymbol=function(e){return!1},e.prototype.validDoubleInequalityVariables=function(e){return!1},e.prototype.validExpressionVariables=function(e){var t=e.join("");return"x"===t||"y"===t||"xy"===t||"yx"===t},e.prototype.validSolvedVariable=function(e){return"x"===e||"y"===e||"z"===e},e.prototype.validImplicitVariables=function(e){return!1},e.prototype.graphableListVariables=function(e,t){return"x"===e||"y"===e||"x"===t||"y"===t},e.prototype.validParametricVariable=function(e){return"t"===e},e.prototype.validParametricVariables=function(e){return 1===e.length&&this.validParametricVariable(e[0])},e.prototype.validInequalityVariables=function(e){return!1},e.prototype.validFirstColumnVariable=function(e){return!1},e.prototype.validActionVariable=function(e){return"dt"===e||"index"===e},e.prototype.complicatedPolarImplicit=function(e,t){return!1},e.prototype.constantGraphMode=function(e){return n.Z_3D},e.prototype.graphMode=function(e,t){return"z"===e&&this.validExpressionVariables(t)?n.Z_3D:n.NONE},e.prototype.tableableAsConstant=function(e){return"x"!==e&&"r"!==e},e.prototype.implicitIndependent=function(e){return"x"},e.prototype.implicitDependency=function(e){if(2!==e.length)return"z";var t=e[0]<e[1]?e[0]+e[1]:e[1]+e[0];return"xy"===t?"z":"xz"===t?"y":"yz"===t?"x":"z"},e.prototype.graphableAsConstant=function(e){return"z"===e},e.prototype.disabledFeatures=function(){return[]},e}();t.PolicyGraphing=new i,t.PolicyGraphing3D=new a});r("core/math/frameFourFunction",["require","core/math/builtinframe"],function(e){"use strict";var t=e("core/math/builtinframe");return{getFrame:function(e){var r={};return e.additionalFunctions&&-1!==e.additionalFunctions.indexOf("sqrt")&&(r.sqrt=t.sqrt),r}}});r("core/math/frameScientific",["require","core/math/builtinframe"],function(e){"use strict";var t=e("core/math/builtinframe"),r=["pi","e","trigAngleMultiplier"],n=["sqrt","nthroot","abs","ln","sin","cos","tan","log","arcsin","arccos","arctan","mean","round","stdev","stdevp","nCr","nPr","exp","factorial"];function i(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(!t.hasOwnProperty(n))throw new Error("Programming Error: key '"+n+"' does not exist in table. Must be one of:\n"+Object.keys(t).join("\n"))}}return i(r,t),i(n,t),{getFrame:function(e){var i={};return r.forEach(function(e){i[e]=t[e]}),n.forEach(function(r){e.replaceRoundWithReciprocal&&"round"===r||(i[r]=t[r])}),e.trigAngleMultiplier&&(i.trigAngleMultiplier=e.trigAngleMultiplier),i}}});r("core/math/frameSingleExpressionScientific",["require","core/math/builtinframe"],function(e){"use strict";var t=e("core/math/builtinframe"),r=["pi","e","trigAngleMultiplier"],n=["sqrt","nthroot","abs","ln","sin","cos","tan","log","arcsin","arccos","arctan","exp","factorial"];function i(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(!t.hasOwnProperty(n))throw new Error("Programming Error: key '"+n+"' does not exist in table. Must be one of:\n"+Object.keys(t).join("\n"))}}return i(r,t),i(n,t),{getFrame:function(e){var i={};return r.forEach(function(e){i[e]=t[e]}),n.forEach(function(e){i[e]=t[e]}),e.trigAngleMultiplier&&(i.trigAngleMultiplier=e.trigAngleMultiplier),i}}});r("core/math/frameGraphing",["require","core/math/builtinframe"],function(e){"use strict";var t=e("core/math/builtinframe"),r=["csc","sec","cot","arccsc","arcsec","arccot","csch","sech","coth","arccsch","arcsech","arccoth","mad","cov","distance","midpoint"],n=["erf","ttest","tscore","ittest","normaldist","tdist","poissondist","binomialdist","pdf","cdf","random","histogram","dotplot","boxplot"],i=["distance","midpoint"],a=["det","inv","transpose","rref","trace"];function o(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(!t.hasOwnProperty(n))throw new Error("Programming Error: key '"+n+"' does not exist in table. Must be one of:\n"+Object.keys(t).join("\n"))}}return o(r,t),o(n,t),{getFrame:function(e){var o,s={};for(o in t)t.hasOwnProperty(o)&&(!0!==e.restrictedFunctions||-1===r.indexOf(o)||!0===e.forceEnableGeometryFunctions&&-1!==i.indexOf(o))&&(!1===e.distributions&&-1!==n.indexOf(o)||-1===a.indexOf(o)&&(s[o]=t[o]));return e.trigAngleMultiplier&&(s.trigAngleMultiplier=e.trigAngleMultiplier),e.globalRandomSeed&&(s.globalRandomSeed=e.globalRandomSeed),e.initialEvaluation&&(s.initialEvaluation=e.initialEvaluation),e.globalEventCount&&(s.globalEventCount=e.globalEventCount),s}}});r("core/math/interpolatedlabel",["require","exports","parsenodes","core/lib/label","./policy","core/math/types"],function(e,t,r,n,i,a){"use strict";function o(e){if(e.length<2)return"text";var t=e.split("`").length-1;return t<2?"text":2===t&&"`"===e[0]&&"`"===e[e.length-1]?"latex":"mixed"}function s(e){if(0===e.length)return[""];for(var t=[],r=e.split(/(`)/),n=!1,i="",a=0;a<r.length;a++){var o=r[a];o.length&&("`"===o?(i+="`",(n=!n)||(t.push(i),i="")):(i+=o,n||(t.push(i),i="")))}return i.length&&t.push(i),t}function u(e){for(var t,r="\\$({"+["[a-zA-Z][0-9]*","[a-zA-Z]_[a-zA-Z0-9]+","[a-zA-Z]_\\{[a-zA-Z0-9]+\\}","\\\\[a-zA-Z]+","\\\\[a-zA-Z]+_{[a-zA-Z0-9]+}","\\\\[a-zA-Z]+_[a-zA-Z0-9]+"].join("})|\\$({")+"})",n=new RegExp(r,"g"),i=[],a=0,o=0;t=n.exec(e);){(o=t.index)>a&&i.push(e.substr(a,o-a));var s=t[0],u=s.replace(/[{}\$]/g,"").replace(/^([a-zA-Z])([0-9]+)$/,"$1_$2");i.push({symbol:u,str:s}),a=t.index+s.length}return a<e.length&&i.push(e.substr(a)),{raw:e,parts:i}}function c(e,t){return t?"{"+n.truncatedLatexLabel(e,{bigCutoff:1e7,digits:8})+"}":n.truncatedPlainmathLabel(e,{bigCutoff:1e7,digits:8})}Object.defineProperty(t,"__esModule",{value:!0}),t.interpolate=t.parse=t.chunkLabel=t.classifyLabelText=void 0,t.classifyLabelText=o,t.chunkLabel=s,t.parse=function(e){return s(e).map(u)},t.interpolate=function(e,t,n){return e.map(function(e){return function(e,t,n){for(var s=[],u="latex"===o(e.raw),l=0,p=e.parts;l<p.length;l++){var d=p[l];if("string"==typeof d)s.push(d);else{var f=r.Identifier(d.symbol).tryGetConcreteTree(i.defaultPolicy,t);if(f.valueType===a.Number&&0===f.getDependencies().length){if("number"==typeof(h=f.asValue())){s.push(c(h,u));continue}}else if(f.valueType===a.ListOfNumber&&n<f.length&&0===f.getDependencies().length){var h;if("number"==typeof(h=f.elementAt(n).asValue())){s.push(c(h,u));continue}}u?s.push("{?}"):s.push("?")}}return s.join("")}(e,t,n)}).join("")}});r("core/math/getCLSymbolMap",["require","exports","underscore","core/lib/label"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCLSymbolMap=void 0,t.getCLSymbolMap=function(){var e={},t={},i={},a=[];for(var o in this.statements){if(this.statements.hasOwnProperty(o))switch((f=this.statements[o]).type){case"Error":break;case"Regression":i[o]=[],a.push(o);break;default:var s=f.getLegalExports(this.policy);if(s){for(var u=0,c=s;u<c.length;u++){var l=c[u];f.exportPenalty>0?t[l]=o:e[l]=o}i[o]=r.difference(f.getDependencies(),f.getDummyDependencies(),s)}}}for(var p=0,d=a;p<d.length;p++){o=d[p];var f=this.statements[o],h=n.latexToIdentifier(f.userData.residualVariable);h&&(t[h]=o);var y=f.getDependencies().slice(),m={};for(l=void 0;l=y.pop();)if(!m[l]){m[l]=!0;var v=e[l]||t[l];v?(y.push.apply(y,i[v]),i[o].push(l)):t[l]=o}}return{exportMap:e,weakExportMap:t,dependencyMap:i}}});r("core/types/line-width",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.THICK=t.DEFAULT=t.THIN=void 0,t.THIN=1,t.DEFAULT=2.5,t.THICK=5});r("core/types/point-opacity",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT=void 0,t.DEFAULT=.9});r("core/math/context",["require","exports","parser","parsenodes","./finddependencyorder","./workerconfig","./findIntersections","core/vendor/d3-color","./policyFourFunction","./policyScientific","./policyGraphing","./frameFourFunction","./frameScientific","./frameSingleExpressionScientific","./frameGraphing","tslib","core/math/errormsg","core/math/finddependencyorder","underscore","./plotter","core/types/graphmode","./interpolatedlabel","./expression-types","./getCLSymbolMap","./distribution-spec","./maybe-rational","core/lib/label","./functions","core/types/line-width","core/types/point-opacity","core/types/point-size","./evaluationstate","core/math/types","./cache-stats","./parsenode-from-value","./ir/features/action-to-latex"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f,h,y,m,v,g,b,x,S,T,w,_,I,E,C,M,k,P,O,L,N,A,D){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var R="undefined"!=typeof performance?function(){return performance.now()}:function(){return Date.now()},F=n.Constant,q=n.Seed,B=n.FunctionCall,V=n.Image,z=n.Slider,j=n.Table,U=n.TableColumn,G=o.findIntersections,W={fourFunction:u.PolicyFourFunction,scientific:c.PolicyScientific,singleExpressionScientific:c.PolicySingleExpressionScientific,singleExpressionFourFunction:u.PolicySingleExpressionFourFunction,graphing:l.PolicyGraphing,graphing_3d:l.PolicyGraphing3D},K={fourFunction:p,singleExpressionFourFunction:p,scientific:d,singleExpressionScientific:f,graphing:h,graphing_3d:h};function H(e,t){var i=r.parse(e,t);return i.isError||i instanceof n.Expression?i:m.parseError()}function J(e){var t=e.rawTree.userData,r=e.rawTree.metaData;return!!(t.cdf&&t.cdf.show&&r.distributionSpec)}function Y(e){var t=e.evaluationState.expression_type,r=e.rawTree.userData;return!(!r.clickableInfo||!r.clickableInfo.enabled)&&(!!e.rawTree.isImage||e.getGraphMode()!==x.XYPOINT_MOVABLE&&T.isClickableExpressionType(t))}function $(e,t){for(var r="id"+e,n=0,i=t||[];n<i.length;n++){var a=i[n];r+="::"+a[0]+a[1]}return r}var X=F(I.maybeRational(0,1)),Z=F(I.maybeRational(1,1)),Q=F(NaN);function ee(e,t){return e?"0"===e?X:"1"===e?Z:H(e,t):Q}function te(e,t){if(e)return H(e,t)}function re(e){return"ans"!==e.slice(0,3)}function ne(e,t){var r=e.multiplyDefined,n=e.multiplyDefinedByTables,i=e.cyclicallyDefined;for(var a in r)r.hasOwnProperty(a)&&(t[a]=n[a]?m.multiplyDefinedByTables(a):m.multiplyDefined(a));for(var a in i)i.hasOwnProperty(a)&&(t[a]=m.cycle(i[a].filter(re)))}function ie(e,t,r){for(var n=0,i=r;n<i.length;n++){var a=i[n];e[a]||(e[a]=[]),e[a].push(t)}}function ae(e,t,r){if(r.extraDepNodes)for(var n=0,i=r.extraDepNodes;n<i.length;n++){var a=i[n];a&&ie(e,t,a.getDependencies())}r.clickHandler&&ie(e,t,r.clickHandler.getDependencies())}function oe(e,t,r){var n=e.evaluationState,i=e.rawTree,a=i.metaData.cdfMin,o=i.metaData.cdfMax,s={},u=NaN,c=NaN,l="Assignment"===i.type?i._expression:i,p=l&&l.metaData&&l.metaData.distributionSpec;if(a){var d=a.tryGetConcreteTree(t,r);d.isConstant&&(u=+d.asValue());for(var f=0,h=d.getDependencies();f<h.length;f++){s[h[f]]=!0}}else u=-1/0;if(o){var y=o.tryGetConcreteTree(t,r);y.isConstant&&(c=+y.asValue());for(var v=0,g=y.getDependencies();v<g.length;v++){s[g[v]]=!0}}else c=1/0;var b=!0,x=!0;if(isNaN(u)&&(b=!1,u=NaN),isNaN(c)&&(x=!1,c=NaN),b?x?u>c&&(b=!1,x=!1,n.error=m.cdfMaxLessThanMin().getError()):n.error=m.cdfMaxInvalid().getError():n.error=m.cdfMinInvalid().getError(),b&&x){var S=B("cdf",[l,F(u),F(c)]);n.cdf_evaluation=+S.tryGetConcreteTree(t,r).asValue()}var T=-1/0,w=1/0;if(p&&(p.discrete&&(T=0),"binomialdist"===p.symbol&&l.args&&l.args[0])){var _=+l.args[0].asValue();isFinite(_)&&(w=_)}i.metaData.evaluatedCDFMin=u,i.metaData.evaluatedCDFMax=c,n.cdf_min_valid=b,n.cdf_max_valid=x,n.cdf_min_default=T,n.cdf_max_default=w,n.is_single_identifier=!1,O.addSliderPrompts(n,t,s)}var se={lineWidth:{parseNode:"lineWidth",valueOutputProp:"computedLineWidth",formulaOutputProp:"",validOutputProp:"line_width_valid",default:function(){return M.DEFAULT},transform:void 0,shouldEvaluate:void 0,seed:"lw"},lineOpacity:{parseNode:"lineOpacity",valueOutputProp:"computedLineOpacity",formulaOutputProp:"",validOutputProp:"line_opacity_valid",default:void 0,transform:void 0,shouldEvaluate:void 0,seed:"lo"},pointOpacity:{parseNode:"pointOpacity",valueOutputProp:"computedPointOpacity",formulaOutputProp:"",validOutputProp:"point_opacity_valid",default:function(e,t,r){return e&&t&&e.getGraphMode(r,t)===x.XYPOINT_MOVABLE?1:k.DEFAULT},transform:void 0,shouldEvaluate:void 0,seed:"po"},pointSize:{parseNode:"pointSize",valueOutputProp:"computedPointSize",formulaOutputProp:"",validOutputProp:"point_size_valid",default:function(){return P.DEFAULT},shouldEvaluate:void 0,transform:void 0,seed:"ps"},fillOpacity:{parseNode:"fillOpacity",valueOutputProp:"computedFillOpacity",formulaOutputProp:"",validOutputProp:"fill_opacity_valid",default:void 0,transform:void 0,shouldEvaluate:function(e){if(!e)return!1;var t=e.evaluationState,r=t.expression_type,n=t.is_inequality;return!(r!==T.ExpressionType.POLYGON&&r!==T.ExpressionType.PARAMETRIC&&!n)},seed:"fo"},labelSize:{parseNode:"labelSize",valueOutputProp:"computedLabelSize",formulaOutputProp:"",validOutputProp:"label_size_valid",transform:void 0,default:function(){return 1},shouldEvaluate:void 0,seed:"ls"},labelAngle:{parseNode:"labelAngle",valueOutputProp:"computedLabelAngle",formulaOutputProp:"label_angle_value",validOutputProp:"label_angle_valid",default:function(){return 0},transform:function(e){return"-\\trigAngleMultiplier*("+e+")"},shouldEvaluate:void 0,seed:"la"}};function ue(e,t,r,n,i,a){var o,s=se[a];e&&(o=e.tryGetConcreteTree(n,i));var u=s.default&&s.default(e,o,n),c=function(e,t,r,n){var i,a={},o=!0,s=NaN,u=!1;if(r){var c=r.tryGetConcreteTree(e,t);i=0===c.getDependencies().length?c.asValue():NaN,s=(u=Array.isArray(i))?i:+i;for(var l=0,p=c.getDependencies();l<p.length;l++)a[p[l]]=!0}if(u)for(var d=0,f=s;d<f.length;d++){var h=f[d];if(!isFinite(+h)){o=!1,s=NaN;break}}else isFinite(+s)||(o=!1,s=NaN);return r||(o=!0,void 0!==n&&(s=n)),{value:s,valid:o,missingVarsMap:a}}(n,i,r[s.parseNode],u);r[s.valueOutputProp]=c.value,s.formulaOutputProp&&(t[s.formulaOutputProp]=c.value),t[s.validOutputProp]=c.valid,O.addSliderPrompts(t,n,c.missingVarsMap)}function ce(e,t,r,n){var i,a;if(e.rawTree.isTable&&e.evaluationState.column_data&&e.rawTree.columns)for(var o=0;o<e.evaluationState.column_data.length;o++)i=e.evaluationState.column_data[o],ue((a=e.rawTree.columns[o].header.metaData)[n],i,a,t,r,n);else i=e.evaluationState,ue((a=e.rawTree.metaData)[n],i,a,t,r,n)}function le(e){return s.rgb(e[0],e[1],e[2]).formatHex()}function pe(e,t,r,n,i){var a;if(e){var o=e.tryGetConcreteTree(n,i),s=o.getDependencies().length>0?void 0:o.asValue(),u=o.valueType;if(a=!(!s||u!==L.RGBColor&&u!==L.ListOfColor)){var c=o&&o.valueType===L.RGBColor?le(s):s.map(le);t.colorLatexValue=c,r.color_latex_value=c}}else a=!0;r.color_latex_valid=a}function de(e,t,r){var n,i;if(e.rawTree.isTable&&e.evaluationState.column_data&&e.rawTree.columns)for(var a=0;a<e.evaluationState.column_data.length;a++)n=e.evaluationState.column_data[a],pe((i=e.rawTree.columns[a].header.metaData).colorLatex,i,n,t,r);else n=e.evaluationState,pe((i=e.rawTree.metaData).colorLatex,i,n,t,r)}function fe(e,t,r){var n=e.evaluationState,i=e.rawTree,a=i.userData,o={},s=i.metaData.clickHandler;if(s){var u=s.tryGetConcreteTree(t,r);u.isError||u.valueType===L.Action||(u=m.eventHandlerTypeError(L.prettyPrint(u.valueType)));for(var c=0,l=u.getDependencies();c<l.length;c++){var p=l[c];t.validActionVariable(p)||(o[p]=!0)}var d=Object.keys(o);if(d.length>0&&(u=m.tooManyVariables(d).setDependencies(u.getDependencies())),u.isError&&!O.isErrorExportableActionDefinition(t,u)?n.click_handler={status:"error",error:u.getError()}:u.isEmptyAction?n.click_handler={status:"empty"}:n.click_handler={status:"maybe-valid"},O.addSliderPrompts(n,t,o),a.clickableInfo.description&&""!==a.clickableInfo.description){n.computed_description=[];var f=1;e.concreteTree.isList?f=e.concreteTree.length:n.dimensions&&n.dimensions.x&&Array.isArray(n.dimensions.x)&&(f=n.dimensions.x.length);for(var h=0;h<f;h++)n.computed_description.push(S.interpolate(S.parse(a.clickableInfo.description),r,h))}}}function he(e,t,r){var n=e.evaluationState,i=e.rawTree,a=n.expression_type===T.ExpressionType.POLAR?i.metaData.polarDomainMin:i.metaData.parametricDomainMin,o=n.expression_type===T.ExpressionType.POLAR?i.metaData.polarDomainMax:i.metaData.parametricDomainMax,s={},u=NaN,c=NaN,l=!1;if(a){l=!0;var p=a.tryGetConcreteTree(t,r);p.isConstant&&(u=+p.asValue());for(var d=0,f=p.getDependencies();d<f.length;d++){s[f[d]]=!0}}else u=0;if(o){l=!0;var h=o.tryGetConcreteTree(t,r);h.isConstant&&(c=+h.asValue());for(var y=0,v=h.getDependencies();y<v.length;y++){s[v[y]]=!0}}else n.expression_type===T.ExpressionType.PARAMETRIC?c=1:n.expression_type===T.ExpressionType.POLAR&&(c=12*Math.PI/+r.trigAngleMultiplier.asValue());var g=!0,b=!0;isFinite(u)||(g=!1,u=NaN),isFinite(c)||(b=!1,c=NaN),g?b?u>c&&(g=!1,b=!1,n.error=m.domainMaxLessThanMin().getError()):n.error=m.domainMaxInvalid().getError():n.error=m.domainMinInvalid().getError(),i.metaData.evaluatedDomainMin=u,i.metaData.evaluatedDomainMax=c,n.expression_type===T.ExpressionType.POLAR&&(i.metaData.isExplicitDomain=l),n.domain_min_number=u,n.domain_max_number=c,n.domain_min_valid=g,n.domain_max_valid=b,n.expression_type===T.ExpressionType.PARAMETRIC&&(delete s.t,O.addSliderPrompts(n,t,s))}function ye(e,t,r){var n=e.evaluationState,i=e.rawTree,a=i.metaData.vizAxisOffset,o=i.metaData.vizBreadth,s={},u=NaN,c=NaN;if(a){var l=a.tryGetConcreteTree(t,r);l.isConstant&&(u=+l.asValue());for(var p=0,d=l.getDependencies();p<d.length;p++){s[d[p]]=!0}}else u=1;if(o){var f=o.tryGetConcreteTree(t,r);f.isConstant&&(c=+f.asValue());for(var h=0,y=f.getDependencies();h<y.length;h++){s[y[h]]=!0}}else c=1;var v=!0,g=!0;isFinite(u)||(v=!1,u=NaN),isFinite(c)||(g=!1,c=NaN),v?g||(n.error=m.boxplotBreadthInvalid().getError()):n.error=m.boxplotOffsetInvalid().getError(),i.metaData.evaluatedAxisOffset=u,i.metaData.evaluatedBreadth=c,n.viz_values={axisOffset:u,breadth:c},n.viz_valids={axisOffset:v,breadth:g},O.addSliderPrompts(n,t,s)}function me(e,t,r){if(!e.isError&&!e.getDependencies().length&&e.valueType===L.Action){var i=e.asValue();if(i)for(var a in i.updateRules){t[a]=D.actionLatexForSymbol(i,a);var o=i.updateRules[a],s=o.value,u=o.valueType;r[a]=n.Assignment(a,A.parseNodeFromValue(u,s))}}}var ve=function(){function e(){this.getCLSymbolMap=w.getCLSymbolMap,this.statements={},this.analysis={},this.currentStatus={},this.currentLabel={},this.unpublishedIds={},this.intersectId=void 0,this.dirtyExportedSymbolRoots={},this.dirtyStatementRoots={},this.markedRegressionDirty=!1,this.use_degrees=!1,this.initialEvaluation=!1,this.globalEventCount=0,this.actions=!0,this.setEvaluationMode("graphing"),this.setRestrictedFunctions(!1),this.setForceEnableGeometryFunctions(!1),this.setFunctionDefinition(!0),this.setReplaceRoundWithReciprocal(!1),this.setDistributions(!0),this.invalidate()}return e.prototype.invalidate=function(){for(var e in this.statements)this.statements.hasOwnProperty(e)&&this.markAsDirtyRoot(e);this.currentStatus={},this.analysis={},this.parent_frame=K[this.evaluationMode].getFrame({restrictedFunctions:this.restrictedFunctions,forceEnableGeometryFunctions:this.forceEnableGeometryFunctions,replaceRoundWithReciprocal:this.replaceRoundWithReciprocal,distributions:this.distributions,additionalFunctions:this.additionalFunctions,trigAngleMultiplier:F(this.use_degrees?Math.PI/180:I.maybeRational(1,1)),initialEvaluation:F(this.initialEvaluation?1:0),globalEventCount:F(0),globalRandomSeed:q(this.globalRandomSeedString||"")}),this.frame=Object.create(this.parent_frame),this.lastFrame=Object.create(this.parent_frame),this.regressionFrame=Object.create(this.parent_frame),this.lastClockTickTime=void 0},e.prototype.processChangeSet=function(e){var t=R(),r={cacheWrites:0,cacheReads:0,cacheHits:0,cacheMisses:0};N.setCacheStatStore(r);var n={intersections:{},graphs:{}};e.isCompleteState&&(this.invalidate(),this.statements={},this.currentLabel={});var i=!!e.isCompleteState&&!e.isUndoRedoState;i!==this.initialEvaluation&&(this.initialEvaluation=i,this.invalidate()),e.viewState&&this.setViewState(e.viewState),e.hasOwnProperty("degreeMode")&&this.setDegreeMode(e.degreeMode),e.hasOwnProperty("globalRandomSeed")&&this.setGlobalRandomSeed(e.globalRandomSeed),e.hasOwnProperty("evaluationMode")&&this.setEvaluationMode(e.evaluationMode),e.hasOwnProperty("additionalFunctions")&&this.setAdditionalFunctions(e.additionalFunctions),e.hasOwnProperty("restrictedFunctions")&&this.setRestrictedFunctions(e.restrictedFunctions),e.hasOwnProperty("forceEnableGeometryFunctions")&&this.setForceEnableGeometryFunctions(e.forceEnableGeometryFunctions),e.hasOwnProperty("distributions")&&this.setDistributions(e.distributions),e.hasOwnProperty("functionDefinition")&&this.setFunctionDefinition(e.functionDefinition),e.hasOwnProperty("replaceRoundWithReciprocal")&&this.setReplaceRoundWithReciprocal(e.replaceRoundWithReciprocal),e.hasOwnProperty("pointsOfInterest")&&this.setWorkerConfigProperty("pointsOfInterest",e.pointsOfInterest),e.hasOwnProperty("plotSingleVariableImplicitEquations")&&this.setWorkerConfigProperty("plotSingleVariableImplicitEquations",e.plotSingleVariableImplicitEquations),e.hasOwnProperty("plotImplicits")&&this.setWorkerConfigProperty("plotImplicits",e.plotImplicits),e.hasOwnProperty("plotInequalities")&&this.setWorkerConfigProperty("plotInequalities",e.plotInequalities),e.hasOwnProperty("sliders")&&this.setWorkerConfigProperty("sliders",e.sliders),e.hasOwnProperty("actions")&&this.setActions(!!e.actions),e.hasOwnProperty("intersectId")&&(this.intersectId=e.intersectId);var a=R();this.processStatements(e,n);var o=R();r.processStatements=o-a,a=o,this.updateAnalysis(),o=R(),r.updateAnalysis=o-a,a=o,e.hasOwnProperty("intersectId")&&this._updateIntersections(e.intersectId,n),o=R(),r.updateIntersections=o-a,a=o;var s=this._publishAllStatuses();o=R(),r.publishAllStatuses=o-a,a=o,this._computeAllLabels(),o=R(),r.computeAllLabels=o-a,a=o,this._graphAllChanged(n),o=R(),r.graphAllChanges=o-a;var u=this.processEvents(e.events);return this.unpublishedIds={},r.timeInWorker=o-t,{syncId:e.syncId,isCompleteState:e.isCompleteState,intersectionChanges:n.intersections,statusChanges:s,graphChanges:n.graphs,timingData:r,eventUpdates:u}},e.prototype.processStatements=function(e,t){if(e.removes)for(var r in e.removes){var n=void 0;if(!e.isCompleteState&&this.statements.hasOwnProperty(r)&&(n=this.statements[r].getAllIds()),this.removeStatement(r,t),!e.isCompleteState&&n)for(var i=0,a=n;i<a.length;i++){var o=a[i];t.graphs[o]=void 0}}if(e.statements)for(var r in e.statements){var s=e.statements[r];null===s||this.addStatement(s,t)}},e.prototype.setViewState=function(e){if(!g.isEqual(e,this.viewState))for(var t in this.viewState=e,this.statements)this.statements.hasOwnProperty(t)&&(this.unpublishedIds[t]=!0)},e.prototype.getViewState=function(){if(this.viewState){var e=Object.create(this.viewState);return this.parent_frame&&this.parent_frame.trigAngleMultiplier?e.trigAngleMultiplier=this.parent_frame.trigAngleMultiplier.asValue():e.trigAngleMultiplier=1,e}},e.prototype.setDegreeMode=function(e){this.use_degrees=e,this.invalidate()},e.prototype.setGlobalRandomSeed=function(e){this.globalRandomSeedString=e,this.parent_frame.globalRandomSeed=q(e),this.dirtyExportedSymbolRoots.globalRandomSeed=!0},e.prototype.setEvaluationMode=function(e){this.evaluationMode=e,this.policy=W[e],this.invalidate()},e.prototype.setAdditionalFunctions=function(e){this.additionalFunctions=e,this.invalidate()},e.prototype.setRestrictedFunctions=function(e){this.restrictedFunctions=e,this.invalidate()},e.prototype.setForceEnableGeometryFunctions=function(e){this.forceEnableGeometryFunctions=e,this.invalidate()},e.prototype.setDistributions=function(e){this.distributions=e,this.invalidate()},e.prototype.setFunctionDefinition=function(e){this.functionDefinition=e,this.invalidate()},e.prototype.setReplaceRoundWithReciprocal=function(e){this.replaceRoundWithReciprocal=e,this.invalidate()},e.prototype.setActions=function(e){e!==this.actions&&(this.actions=e,this.invalidate())},e.prototype.setWorkerConfigProperty=function(e,t){t!==a[e]&&(a[e]=t,this.invalidate())},e.prototype._publishAllStatuses=function(){var e={},t=this.currentStatus;for(var r in this.currentStatus={},this.unpublishedIds)if(this.analysis.hasOwnProperty(r)){var n=this.analysis[r].evaluationState;g.isEqual(n,t[r])||(e[r]=n),this.currentStatus[r]=n}return e},e.prototype._computeAllLabels=function(){for(var e in this.currentLabel){var t=this.statements[e];if(t){var r=t.tryGetConcreteTree(this.policy,this.frame),n=1;r.valueType===L.ListOfPoint&&(n=r.length);for(var i=[],a=0;a<n;a++)i.push(S.interpolate(this.currentLabel[e],this.frame,a));g.isEqual(i,t.computedLabels)||(t.computedLabels=i,this.unpublishedIds[e]=!0)}}},e.prototype._graphAllChanged=function(e){var t=this.getViewState(),r=!1;if(b.default.validateViewState(t)){for(var n in this.unpublishedIds)if(this.analysis.hasOwnProperty(n)){var i=this.analysis[n],a=i.evaluationState.expression_type,o=a===T.ExpressionType.SINGLE_POINT||a===T.ExpressionType.POINT_LIST;if(i.rawTree.isTable)for(var s=i.graph(t),u=0,c=i.rawTree.getAllIds();u<c.length;u++){var l=c[u];s[l]?this._notifyGraphComputed(l,s[l],e):this._notifyGraphRemoved(l,e)}else i.evaluationState.is_graphable&&(i.rawTree.userData.shouldGraph||i.rawTree.userData.showLabel&&o)?(this._notifyGraphComputed(n,i.graph(t),e),this.intersectId===n&&(r=!0)):this._notifyGraphRemoved(n,e)}g.keys(this.unpublishedIds).length&&void 0!==this.intersectId&&(this.unpublishedIds.hasOwnProperty(this.intersectId)||(r=!0)),r&&this._updateIntersections(this.intersectId,e)}},e.prototype._notifyGraphRemoved=function(e,t){t.graphs[e]=void 0},e.prototype._notifyGraphComputed=function(e,t,r){C.dehydrateGraphData(t),r.graphs[e]=t},e.prototype._updateIntersections=function(e,t){if(this.viewState)if(this.analysis[e]&&this.analysis[e].shouldIntersect()){var r=G(this.analysis,this.viewState,e);t.intersections[e]=r}else t.intersections[e]=[]},e.prototype.getDisabledFeatures=function(){var e=this.policy.disabledFeatures();!1===this.functionDefinition&&(e=e.concat("FunctionDefinition")),!1===this.actions&&(e=e.concat("UpdateRule"));var t=this.additionalFunctions||[];return e=e.filter(function(e){return("Exponent"!==e||-1===t.indexOf("exponent"))&&("PercentOf"!==e||-1===t.indexOf("percent"))})},e.prototype.areFractionsDisallowed=function(){var e=this.evaluationMode;return("fourFunction"===e||"singleExpressionFourFunction"===e)&&(!this.additionalFunctions||-1===this.additionalFunctions.indexOf("fraction"))},e.prototype.addStatement=function(e,t){var i=this;if(e){var a=e.id;this.markExportsDirty(a),this.markAsDirtyRoot(a);var o={index:this.policy.ansEnabled()?e.index:void 0,disabledFeatures:this.getDisabledFeatures(),disallowFrac:this.areFractionsDisallowed(),seedPrefix:$(a)},s={extraDepNodes:[]};switch(e.type){case"table":var u=[];this.statements.hasOwnProperty(a)&&(u=this.statements[a].getAllIds()),e.shouldGraph=!0;for(var c=e.columns,l=[],p=0,d=0,f=c;d<f.length;d++){var h=f[d];p=Math.max(h.values.length,p)}for(var m=0;m<c.length;m++){var v,g=void 0,b=void 0;h=c[m];v=r.parse(h.latex,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["tr",0],["tc",m]])})),g=[];for(var x=-1,T=0;T<c[m].values.length;T++)h.values[T].replace(/\\space/g,"").match(/\S/)?(g.push(r.parse(h.values[T],y.__assign(y.__assign({},o),{seedPrefix:$(a,[["tr",T+1],["tc",m]])}))),x=T):g.push(F(NaN));if(g=g.slice(0,x+1),(b=U(v,p,g)).id=h.id,b.header){if(b.header.userData=h,b.header.metaData={extraDepNodes:[]},h.colorLatex){var w=H(h.colorLatex,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["tr",0],["tc",m],["cl",m]])}));b.header.metaData.colorLatex=w,b.header.metaData.extraDepNodes.push(w)}if(h.pointSize){var I=H(h.pointSize,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["tr",0],["tc",m],["ps",m]])}));b.header.metaData.pointSize=I,b.header.metaData.extraDepNodes.push(I)}if(h.pointOpacity){var E=H(h.pointOpacity,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["tr",0],["tc",m],["po",m]])}));b.header.metaData.pointOpacity=E,b.header.metaData.extraDepNodes.push(E)}if(h.lineWidth){var C=H(h.lineWidth,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["tr",0],["tc",m],["lw",m]])}));b.header.metaData.lineWidth=C,b.header.metaData.extraDepNodes.push(C)}if(h.lineOpacity){var M=H(h.lineOpacity,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["tr",0],["tc",m],["lo",m]])}));b.header.metaData.lineOpacity=M,b.header.metaData.extraDepNodes.push(M)}}l.push(b)}this.statements[a]=j(l);var k=this.statements[a].getAllIds();u.forEach(function(e){-1===k.indexOf(e)&&i._notifyGraphRemoved(e,t)});break;case"image":var P="-\\trigAngleMultiplier*("+e.angle+")",O=H(e.center,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["ic",a]])})),L=H(P,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["ia",a]])})),N=H(e.width,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["iw",a]])})),A=H(e.height,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["ih",a]])})),D=H(e.opacity,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["io",a]])}));this.statements[a]=V({center:O,radianAngle:L,width:N,height:A,opacity:D});break;case"ticker":this.statements[a]=n.Ticker({handler:H(e.handlerLatex,y.__assign(y.__assign({},o),{allowDt:!0})),minStep:H(e.minStepLatex||"0",o)});break;default:for(var R in e=e,this.statements[a]=r.parse(e.latex,o),se){var q=R;if(e[q]){var B=se[q],G=e[q];B.transform&&(G=B.transform(G));var W=ee(G,y.__assign(y.__assign({},o),{seedPrefix:$(a,[[B.seed,a]])}));s[q]=W,s.extraDepNodes.push(W)}}if(e.colorLatex){W=te(e.colorLatex,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["ac",a]])}));s.colorLatex=W,s.extraDepNodes.push(W)}if(e.polarDomain&&e.polarDomain.min&&(s.polarDomainMin=ee(e.polarDomain.min,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["lm",a]])})),s.extraDepNodes.push(s.polarDomainMin)),e.polarDomain&&e.polarDomain.max&&(s.polarDomainMax=ee(e.polarDomain.max,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["lM",a]])})),s.extraDepNodes.push(s.polarDomainMax)),e.parametricDomain&&e.parametricDomain.min&&(s.parametricDomainMin=ee(e.parametricDomain.min,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["lm",a]])})),s.extraDepNodes.push(s.parametricDomainMin)),e.parametricDomain&&e.parametricDomain.max&&(s.parametricDomainMax=ee(e.parametricDomain.max,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["lM",a]])})),s.extraDepNodes.push(s.parametricDomainMax)),e.vizProps&&(e.vizProps.axisOffset&&(s.vizAxisOffset=ee(e.vizProps.axisOffset,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["vo",a]])})),s.extraDepNodes.push(s.vizAxisOffset)),e.vizProps.breadth&&(s.vizBreadth=ee(e.vizProps.breadth,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["vb",a]])})),s.extraDepNodes.push(s.vizBreadth))),e.cdf&&e.cdf.show){var K=_.parseToplevelFunction(e.latex);K&&"distribution"===K.type&&(s.distributionSpec=K,s.cdfMin=te(e.cdf.min,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["lm",a]])})),s.extraDepNodes.push(s.cdfMin),s.cdfMax=te(e.cdf.max,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["lM",a]])})),s.extraDepNodes.push(s.cdfMax))}if(this.statements[a].shouldPromoteToSlider(this.policy)){var J=e.slider,Y=!(!J||!J.isPlayingOnce),X=te(J&&J.softMin,o),Z=te(J&&J.softMax,o),Q=te(J&&J.min,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["lm",a]])})),re=te(J&&J.max,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["lM",a]])})),ne=te(J&&J.step,y.__assign(y.__assign({},o),{seedPrefix:$(a,[["ls",a]])}));this.statements[a]=z(this.statements[a],{sliderMin:Q,sliderMax:re,sliderStep:ne,sliderIsPlayingOnce:Y,sliderSoftMin:X,sliderSoftMax:Z})}}var ie=e.clickableInfo;ie&&ie.enabled&&ie.latex&&(s.clickHandler=H(ie.latex,y.__assign(y.__assign({},o),{allowIndex:!0}))),this.statements[a].userData=e,this.statements[a].metaData=s;var ae=e.label;if(ae){var oe=this.currentLabel[a];oe&&oe.raw===ae||(this.currentLabel[a]=S.parse(ae))}else delete this.currentLabel[a]}},e.prototype.removeStatement=function(e,t){var r=this.statements[e];if(r){if(this.markExportsDirty(e),r.isTable){var n=this;r.getAllIds().forEach(function(e){n._notifyGraphRemoved(e,t)})}else this._notifyGraphRemoved(e,t);delete this.currentLabel[e],delete this.statements[e],delete this.analysis[e],delete this.currentStatus[e]}},e.prototype.markExportsDirty=function(e){if(this.statements[e]){this.statements[e].isRegression&&(this.markedRegressionDirty=!0);for(var t=0,r=this.statements[e].getLegalExports(this.policy);t<r.length;t++){var n=r[t];this.dirtyExportedSymbolRoots[n]=!0}}},e.prototype.markAsDirtyRoot=function(e){this.dirtyStatementRoots[e]=!0},e.prototype.getFrame=function(){return this.updateAnalysis(),this.frame},e.prototype.getAnalysis=function(){return this.updateAnalysis(),this.analysis},e.prototype.getEvaluationState=function(e){if(this.updateAnalysis(),this.analysis[e])return this.analysis[e].evaluationState},e.prototype._updateRegressions=function(e){var t=this.frame,r=this.lastFrame,n=this.regressionFrame,i=[];for(var a in e)e.hasOwnProperty(a)&&e[a].isRegression&&i.push(a);var o=this;i.sort(function(e,t){var r=o.statements[e].userData&&o.statements[e].userData.residualVariable,n=o.statements[t].userData&&o.statements[t].userData.residualVariable;return r&&!n?-1:n&&!r?1:0});var s=v.findDependencyOrder(this.policy,e,i);ne(s,n);for(var u={},c=0,l=s.resolved;c<l.length;c++){a=l[c];if(this.statements[a].isRegression)this.analysis[a]=e[a].analyze(this.policy,n,t,r,u),this.analysis[a].exportTo(this.policy,t),delete e[a];else{var p=e[a].tryGetConcreteTree(this.policy,n);e[a].exportTo(this.policy,p,n),u[a]={rawTree:e[a],concreteTree:p}}}},e.prototype.buildSymbolToExpressionDirtyMap=function(){var e={};for(var t in this.statements)if(this.statements.hasOwnProperty(t)){var r=this.statements[t],n=r.metaData;if(ie(e,t,r.getDependencies()),ie(e,t,r.getLegalExports(this.policy)),r.isRegression&&r.userData&&r.userData.residualVariable&&ie(e,t,[E.latexToIdentifier(r.userData.residualVariable)]),ae(e,t,n),r.isTable&&r.columns)for(var i=0;i<r.columns.length;i++){var a=r.columns[i];a.header&&a.header.metaData&&ae(e,t,a.header.metaData)}}return e},e.prototype.getDirtyIdsAndSymbols=function(e){var t={},r={},n=this.markedRegressionDirty,i=[],a=[];for(var o in this.dirtyStatementRoots)this.dirtyStatementRoots[o]&&(r[o]=!0,i.push(o));for(var s in this.dirtyExportedSymbolRoots)this.dirtyExportedSymbolRoots[s]&&(t[s]=!0,a.push(s));for(;i.length||a.length;){for(;i.length;){o=i.pop();var u=this.statements[o];if(u){u.isRegression&&(n=!0);for(var c=0,l=u.getLegalExports(this.policy);c<l.length;c++){t[s=l[c]]||(t[s]=!0,a.push(s))}}}for(;a.length;){var p=e[s=a.pop()];if(p)for(var d=0,f=p;d<f.length;d++){r[o=f[d]]||(r[o]=!0,i.push(o))}}}return{ids:r,symbols:t,hasDirtyRegression:n}},e.prototype.updateAnalysis=function(){var e=this.buildSymbolToExpressionDirtyMap(),t=this.getDirtyIdsAndSymbols(e),r={};if(t.hasDirtyRegression){for(var n in this.statements)this.statements[n]&&(r[n]=this.statements[n]);this.frame=Object.create(this.parent_frame),this.regressionFrame=Object.create(this.parent_frame)}else{var i=t.ids;for(var n in i)this.statements[n]&&(r[n]=this.statements[n]);var a=t.symbols;for(var o in a)a[o]&&(delete this.frame[o],delete this.regressionFrame[o])}for(var n in r)r[n]&&(this.unpublishedIds[n]=!0);this.markedRegressionDirty=!1,this.dirtyExportedSymbolRoots={},this.dirtyStatementRoots={};var s=this.analysis,u=this.frame;"graphing"===this.evaluationMode&&this._updateRegressions(r);var c=v.findDependencyOrder(this.policy,r);ne(c,u);for(var l=c.resolved,p=0,d=l;p<d.length;p++){n=d[p];switch(this.evaluationMode){case"fourFunction":case"singleExpressionFourFunction":s[n]=this.statements[n].analyzeFourFunction(this.policy,u,s),s[n].exportTo(this.policy,u);break;case"scientific":s[n]=this.statements[n].analyzeScientific(this.policy,u,s),s[n].exportTo(this.policy,u);break;case"singleExpressionScientific":s[n]=this.statements[n].analyzeSingleExpressionScientific(this.policy,u,s),s[n].exportTo(this.policy,u);break;case"graphing":case"graphing_3d":if(u.r){var f=Object.create(u);if(f.r=void 0,s[n]=this.statements[n].analyze(this.policy,f,s),s[n].getGraphMode()===x.POLAR){s[n].exportTo(this.policy,u);continue}}s[n]=this.statements[n].analyze(this.policy,u,s),s[n].exportTo(this.policy,u)}}if("graphing"===this.evaluationMode||"graphing_3d"===this.evaluationMode)for(var h=0,y=l;h<y.length;h++){n=y[h];var m=s[n],g=m.evaluationState.expression_type;for(var b in se){var S=b,w=se[S];w.shouldEvaluate&&!w.shouldEvaluate(m)||ce(m,this.policy,u,S)}de(m,this.policy,u),this.actions&&Y(m)&&fe(m,this.policy,u),g===T.ExpressionType.PARAMETRIC||g===T.ExpressionType.POLAR?he(m,this.policy,u):g===T.ExpressionType.BOXPLOT?ye(m,this.policy,u):J(m)&&oe(m,this.policy,u)}for(var o in function(e){return e.globalRandomSeed||[]}(e).forEach(function(e){s[e].evaluationState.depends_on_random_seed=!0}),this.lastFrame=Object.create(this.parent_frame),u)u.hasOwnProperty(o)&&(this.lastFrame[o]=u[o])},e.prototype.processEvents=function(e){if(e&&this.actions){for(var t,r=Object.create(this.frame),i={},a=!1,o=!1,s=0,u=e;s<u.length;s++){var c=u[s];switch(this.globalEventCount+=1,r.globalEventCount=n.Constant(this.globalEventCount),c.type){case"step":if(!(l=this.statements[c.expressionId]))continue;o=!0,me(l.tryGetConcreteTree(this.policy,r),i,r);break;case"click":var l;if(!(l=this.statements[c.expressionId])||!l.metaData.clickHandler)continue;r.index=n.Constant(c.indexVar+1),o=!0,a=!0,me(l.metaData.clickHandler.tryGetConcreteTree(this.policy,r),i,r);break;case"clock-tick":(void 0===t||c.isFirstTick&&!t.isFirstTick)&&(t=c);break;default:return c}}if(t)if((l=this.statements[t.id])&&l instanceof n.Ticker){var p=l.minStep.tryGetConcreteTree(this.policy,r).asValue();if("number"==typeof p&&p>=0&&isFinite(p)){var d=this.lastClockTickTime;if(this.lastClockTickTime=Date.now(),!t.isFirstTick&&void 0!==d)r.dt=n.Constant(this.lastClockTickTime-d),me(l.handler.tryGetConcreteTree(this.policy,r),i,r)}}return{objectClicked:a,userAction:o,updates:i}}},e}();t.Context=ve});r("core/graphing-calc/migrations/0",["require"],function(e){"use strict";var t={expression:!0,table:!0,image:!0,folder:!0,text:!0};function r(e){return e.replace(/\\(total|length|mean|median|quantile|stdev|stddev|stdDev|stdevp|stddevp|stdDevP|var|variance|cov|corr|ceil|floor|round|abs|mod|lcm|mcm|mcd|nCr|nPr|signum|sign|arcsinh|arccosh|arctanh|arccsch|arcsech|arccoth|arccsc|arcsec|arccot)/g,"\\operatorname{$1}")}function n(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]="latex"===n?r(e[n]):"values"===n?e[n].map(r):e[n]);return t}function i(e){var i,a=function(e){if(e.type){if(t.hasOwnProperty(e.type))return e.type;throw new Error("Invalid item type: '"+e.type+"'.")}return void 0!==e.text?"text":void 0!==e.columns||void 0!==e.headings?"table":"expression"}(e),o={};switch(a){case"expression":for(i in e)e.hasOwnProperty(i)&&(o[i]="latex"===i?r(e[i]):e[i]);return o.type=a,o;case"table":for(i in e)e.hasOwnProperty(i)&&(o[i]="columns"===i?e[i].map(n):e[i]);return o.type=a,o;case"image":for(i in e)e.hasOwnProperty(i)&&(o[i]="width"===i||"height"===i||"x"===i||"y"===i?r(e[i]):e[i]);return o.type=a,o;case"text":case"folder":for(i in e)e.hasOwnProperty(i)&&(o[i]=e[i]);return o.type=a,o}}var a={none:"NONE",both:"BOTH",positive:"POSITIVE"};return function(e){if(e.version)throw new Error("Unexpected version: "+e.version);var t={};return t.graph=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&"xAxisArrows"!==r&&"yAxisArrows"!==r&&(t[r]=e[r]);return t.xAxisArrowMode=a[e.xAxisArrows||"none"],t.yAxisArrowMode=a[e.yAxisArrows||"none"],t}(e.graph),t.expressions={list:e.expressions.list.map(i)},t.version=0,t}});r("core/graphing-calc/migrations/1",["require"],function(e){"use strict";function t(e){return e.replace(/\\(sech|csch)/g,"\\operatorname{$1}")}function r(e){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]="latex"===n?t(e[n]):"values"===n?e[n].map(t):e[n]);return r}function n(e){var n,i=e.type,a={};switch(i){case"expression":for(n in e)e.hasOwnProperty(n)&&(a[n]="latex"===n?t(e[n]):e[n]);return a;case"table":for(n in e)e.hasOwnProperty(n)&&(a[n]="columns"===n?e[n].map(r):e[n]);return a;case"image":for(n in e)e.hasOwnProperty(n)&&(a[n]="width"===n||"height"===n||"x"===n||"y"===n?t(e[n]):e[n]);return a;case"text":case"folder":for(n in e)e.hasOwnProperty(n)&&(a[n]=e[n]);return a;default:throw new Error("Unexpected expression type: "+i)}}return function(e){if(e.version)throw new Error("Unexpected version: "+e.version);var t={};return t.graph=e.graph,t.expressions={list:e.expressions.list.map(n)},t.version=1,t}});r("core/graphing-calc/migrations/2",["require","core/lib/color-helpers"],function(e){"use strict";var t=e("core/lib/color-helpers").colors;function r(e){switch(e){case"#C0504D":return t.RED;case"#4F81BD":return t.BLUE;case"#9BBB59":return t.GREEN;case"#8064A2":return t.PURPLE;case"#F79646":return t.ORANGE;case"#000000":return t.BLACK;default:return e}}function n(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]="color"===n?r(e[n]):e[n]);return t}function i(e){var t,i=e.type,a={};switch(i){case"expression":for(t in e)e.hasOwnProperty(t)&&(a[t]="color"===t?r(e[t]):e[t]);return a;case"table":for(t in e)e.hasOwnProperty(t)&&(a[t]="columns"===t?e[t].map(n):e[t]);return a;case"image":case"text":case"folder":for(t in e)e.hasOwnProperty(t)&&(a[t]=e[t]);return a;default:throw new Error("Unexpected expression type: "+i)}}return function(e){if(e.version>1)throw new Error("Unexpected version: "+e.version);var t={};return t.graph=e.graph,t.expressions={list:e.expressions.list.map(i)},t.version=2,t}});r("core/graphing-calc/migrations/3",["require"],function(e){"use strict";function t(e){if("string"==typeof e)return e;if(void 0===e)return"";var t=e+"";return t=(t=t.replace(/1e\+?([-\d]+)/,"10^{$1}")).replace(/([-\d\.]+)e\+?([-\d]+)/,"$1\\cdot 10^{$2}")}function r(e){var r,n=e.type,i={};switch(n){case"expression":for(r in e)e.hasOwnProperty(r)&&(i[r]="sliderMax"===r||"sliderMin"===r||"sliderInterval"===r?t(e[r]):"domain"===r?{max:t(e[r].max),min:t(e[r].min)}:e[r]);return i.hasOwnProperty("sliderMin")&&void 0===i.sliderInterval&&(i.sliderInterval=""),i;case"image":case"table":case"text":case"folder":for(r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);return i;default:throw new Error("Unexpected expression type: "+n)}}return function(e){if(e.version>2)throw new Error("Unexpected version: "+e.version);var t={};return t.graph=e.graph,t.expressions={list:e.expressions.list.map(r)},t.version=3,t}});r("core/graphing-calc/migrations/4",["require"],function(e){"use strict";function t(e){switch(e){case"point":return"POINT";case"cross":return"CROSS";case"open":return"OPEN";case"normal":return"SOLID";case"dashed":return"DASHED";case"dotted":return"DOTTED";default:return e}}function r(e){var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]="style"===n?t(e[n]):e[n]);return r}function n(e){var n,i=e.type,a={};switch(i){case"expression":for(n in e)e.hasOwnProperty(n)&&(a[n]="style"===n?t(e[n]):e[n]);return a;case"table":for(n in e)e.hasOwnProperty(n)&&(a[n]="columns"===n?e[n].map(r):e[n]);return a;case"image":case"text":case"folder":for(n in e)e.hasOwnProperty(n)&&(a[n]=e[n]);return a;default:throw new Error("Unexpected expression type: "+i)}}return function(e){if(3!==e.version)throw new Error("Unexpected version: "+e.version);var t={};return t.graph=e.graph,t.expressions={list:e.expressions.list.map(n)},t.version=4,t}});r("core/graphing-calc/validate-state",["require","exports","core/lib/deepCopy"],function(e,t,r){"use strict";function n(e){e.slider&&function(e){"number"==typeof e.min&&(e.min=""+e.min),"number"==typeof e.max&&(e.max=""+e.max),"number"==typeof e.step&&(e.step=""+e.step)}(e.slider),"string"!=typeof e.id&&(e.id=""+e.id)}function i(e){for(var t,r,i=function(e){for(var t=0,r=0,n=e;r<n.length;r++){var i=n[r];if(t=a(t,i.id),"table"===i.type)for(var o=0,s=i.columns;o<s.length;o++){a(t,s[o].id)}}return t}(e)+1,o={},s=0,u=e;s<u.length;s++){var c=u[s];if(n(c),"folder"===c.type)t=c.id,o[c.id]&&(c.id=""+i,i+=1),r=c.id,o[c.id]=!0,c.hasOwnProperty("folderId")&&delete c.folderId;else{if(void 0!==t&&c.folderId===t?c.folderId=r:(c.folderId&&(c.folderId=""),t=void 0,r=void 0),"table"===c.type)for(var l=0,p=c.columns;l<p.length;l++){var d=p[l];o[d.id]&&(d.id=""+i,i+=1),o[d.id]=!0}o[c.id]&&(c.id=""+i,i+=1),o[c.id]=!0}}}function a(e,t){var r=parseFloat(t);return r!==Math.floor(r)?e:Math.max(e,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.validateState=void 0,t.validateState=function(e){var t=r.default(e);return i(t.expressions.list),t}});r("core/graphing-calc/migrations/5",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.migrateState=void 0;function r(e){var t,r={};for(var n in e)if(e.hasOwnProperty(n))switch(t=e[n],n){case"showAxes":r.showXAxis=t,r.showYAxis=t;break;case"showLabels":r.xAxisNumbers=t,r.yAxisNumbers=t,r.polarNumbers=t;break;case"labelXMode":r.xAxisStep="pi"===t?Math.PI:0;break;case"labelYMode":r.yAxisStep="pi"===t?Math.PI:0;break;default:r[n]=t}return r}function n(e){var t={};for(var r in e)e.hasOwnProperty(r)&&"showPoints"!==r&&"showLine"!==r&&(t[r]=e[r]);return void 0===e.showPoints&&void 0===e.showLine||(e.showPoints&&e.showLine?t.columnMode="POINTS_AND_LINES":e.showPoints?t.columnMode="POINTS":e.showLine?t.columnMode="LINES":(t.hidden=!0,t.columnMode="POINTS")),t}function i(e){var t,r=e.type,i={};switch(r){case"expression":for(t in void 0===e.hidden?e.hasOwnProperty("graphed")?i.hidden=!e.graphed:e.hasOwnProperty("userRequestedGraphing")?i.hidden="never"===e.userRequestedGraphing:i.hidden=!1:i.hidden=e.hidden,e)e.hasOwnProperty(t)&&"graphed"!==t&&"userRequestedGraphing"!==t&&"hidden"!==t&&"slider"!==t&&("color"!==t?"style"!==t?"sliderInterval"!==t?i[t]=e[t]:i.sliderInterval="undefined"===e.sliderInterval?"":e.sliderInterval:i.style="normal"===e.style?"SOLID":e.style:"object"==typeof e.color?i.color=e.color.value:i.color=e.color);return i;case"table":if(e.headings||e.columns){var a=e.headings?e.headings:e.columns;if(i.columns=a.map(n),e.rows)for(var o=0;o<i.columns.length;o++){var s=i.columns[o];s.values=[];for(var u=0;u<e.rows.length;u++)s.values.push(e.rows[u][o])}}for(t in e)e.hasOwnProperty(t)&&"rows"!==t&&"headings"!==t&&"columns"!==t&&(i[t]=e[t]);return i;case"image":case"text":case"folder":for(t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);return i;default:throw new Error("Unexpected expression type: "+r)}}t.migrateState=function(e){if(4!==e.version)throw new Error("Unexpected version: "+e.version);return{version:5,graph:r(e.graph),expressions:{list:e.expressions.list.map(i)}}}});r("core/math/evaluate-single-expression",["require","exports","parser","core/math/builtinframe","core/math/parsenode/constant","core/math/policy"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(/^\s*(\-|\+)?([0-9]+(\.[0-9]+)?)\s*$/.test(e))return parseFloat(e);var o=Object.create(n);return o.trigAngleMultiplier=i(t?Math.PI/180:1),+r.parse(e).tryGetConcreteTree(a.defaultPolicy,o).asValue()}});r("core/graphing-calc/migrations/6",["require","exports","core/lib/deepCopy","underscore","core/math/sliders","core/math/evaluate-single-expression"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.migrateState=void 0;function o(e){var t={};for(var r in e)if(e.hasOwnProperty(r)&&"style"!==r)if("values"===r&&(t[r]=e[r].map(function(e){return e?""+e:""})),"columnMode"!==r||e.hasOwnProperty("points")||e.hasOwnProperty("lines"))t[r]=e[r];else switch(e[r]){case"LINES":t.points=!1,t.lines=!0;break;case"POINTS_AND_LINES":t.points=!0,t.lines=!0;break;default:t.points=!0,t.lines=!1}return t.hasOwnProperty("pointStyle")||(t.pointStyle="POINT"),t.hasOwnProperty("lineStyle")||(t.lineStyle="SOLID"),t.id=""+t.id,t}var s={sliderMin:"min",sliderMax:"max",sliderInterval:"step",sliderHardMin:"hardMin",sliderHardMax:"hardMax",sliderAnimationPeriod:"animationPeriod",sliderLoopMode:"loopMode",sliderPlayDirection:"playDirection",sliderIsPlaying:"isPlaying"};function u(e){var t=function(e){if(function(e){return!(e.length<2)&&"`"===e[0]&&"`"===e[e.length-1]}(e))return{raw:e,parts:[e]};for(var t,r="({"+["[a-zA-Z][0-9]*","[a-zA-Z]_[a-zA-Z0-9]+","[a-zA-Z]_\\{[a-zA-Z0-9]+\\}"].join("})|({")+"})",n=new RegExp(r,"g"),i=[],a=0,o=0;t=n.exec(e);){(o=t.index)>a&&i.push(e.substr(a,o-a));var s=t[0],u=s.replace(/[{}\$]/g,"").replace(/^([a-zA-Z])([0-9]+)$/,"$1_$2");i.push({symbol:u,str:s}),a=t.index+s.length}return a<e.length&&i.push(e.substr(a)),{raw:e,parts:i}}(e),r="";return n.each(t.parts,function(e){r+="object"==typeof e&&e.str?"$"+e.str:e}),r}function c(e,t,r,c){var l,p=e.type,d={};switch(p){case"folder":for(l in e)e.hasOwnProperty(l)&&("memberIds"===l||(d[l]=e[l]));break;case"expression":for(l in e)if(e.hasOwnProperty(l))if("style"!==l||e.hasOwnProperty("pointStyle")||e.hasOwnProperty("lineStyle"))s.hasOwnProperty(l)?(d.slider=d.slider||{},d.slider[s[l]]=e[l]):d[l]=e[l],e.label&&(d.label=u(e.label));else{var f=e[l];n.contains(["POINT","OPEN","CROSS"],f)?(d.pointStyle=f,d.lineStyle="SOLID"):n.contains(["SOLID","DASHED","DOTTED"],f)?(d.pointStyle="POINT",d.lineStyle=f):(d.pointStyle="POINT",d.lineStyle="SOLID")}d.latex&&d.slider&&!d.slider.isPlaying&&function(e,t){var r=e.latex.split("=");if(2===r.length){var n=a.default(r[1],t);if(isFinite(n)){var o=e.slider.hardMin?a.default(e.slider.min||"-10",t):void 0,s=e.slider.hardMax?a.default(e.slider.max||"10",t):void 0,u=e.slider.step?a.default(e.slider.step,t):void 0,c=i.determineWhichLimitsAreCompatibleWithValue({target:n,step:u,hardMin:o,hardMax:s});c.min||(delete e.slider.hardMin,delete e.slider.min),c.max||(delete e.slider.hardMax,delete e.slider.max),c.step||delete e.slider.step}}}(d,c),d.hasOwnProperty("fillOpacity")||(d.fillOpacity=.4),!1===d.label&&(d.label=""),d.labelSize||(d.labelSize="medium"),d.labelOrientation||(d.labelOrientation="default"),d.verticalLabel||(d.verticalLabel=!1),d.interactiveLabel||(d.interactiveLabel=!1);break;case"image":for(l in e)e.hasOwnProperty(l)&&"x"!==l&&"y"!==l&&(d[l]=e[l]);d.center="\\left("+(e.x||"0")+","+(e.y||"0")+"\\right)",d.angle=e.angle||"0",d.foreground=!!d.foreground;break;case"text":for(l in e)e.hasOwnProperty(l)&&(d[l]=e[l]);break;case"table":for(l in e)e.hasOwnProperty(l)&&(d[l]="columns"===l?e[l].map(o):e[l]);break;default:throw new Error("Unexpected expression type: "+p)}if(d.id=""+d.id,"folder"===e.type)t.folderId=d.id,t.memberIds=e.memberIds,d.folderId="";else{var h=r[d.id];t.memberIds&&t.memberIds[h]?d.folderId=t.folderId:(d.folderId="",t.folderId=void 0,t.memberIds=void 0)}return d}t.migrateState=function(e){if(5!==e.version)throw new Error("Unexpected version: "+e.version);var t=!(!e.graph||!e.graph.degreeMode),n=e.expressions.list,i=-1,a={},o={},s={};return{version:6,graph:e.graph,expressions:{list:n.map(function(e){return a[e.id]?(-1===i&&(i=function(e){for(var t=0,r=/^[0-9]+$/,n=e.length-1;n>=0;n--){var i,a=e[n],o=a.id;if(r.test(o)&&(i=parseInt(o,10))>t&&(t=i),"table"===a.type&&a.columns)for(var s=a.columns.length-1;s>=0;s--)o=a.columns[s].id,r.test(o)&&(i=parseInt(o,10))>t&&(t=i)}return t+1}(n)),o[i]=e.id,(e=r.default(e)).id=i+"",i+=1):o[e.id]=e.id,a[e.id]=!0,c(e,s,o,t)})}}}});r("core/graphing-calc/migrations/7",["require","exports","tslib"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(6!==e.version)throw new Error("Unexpected version: "+e.version);var t=e.expressions.list.map(function(e){if("expression"===e.type&&e.domain){var t=r.__assign(r.__assign({},e),{parametricDomain:{min:e.domain.min,max:e.domain.max}});return delete t.domain,t}return e});return{version:7,randomSeed:e.randomSeed,graph:e.graph,expressions:{list:t}}}});r("core/lib/random-seed",["require","exports","core/lib/md5"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=new Uint8Array(16);if("undefined"!=typeof crypto)crypto.getRandomValues(e);else{if("undefined"==typeof msCrypto)return r(Date.now().toString()+Math.random().toString());msCrypto.getRandomValues(e)}return Array.prototype.slice.call(e).map(function(e){return function(e){return 1===e.length?"0"+e:e}(e.toString(16))}).join("")}});r("core/graphing-calc/migrations/8",["require","exports","tslib","core/lib/random-seed","core/lib/deepCopy"],function(e,t,r,n,i){"use strict";function a(e){var t=e.split("_");return 2===t.length&&t[1]&&1===t[1].length?t[0]+"_{"+t[1]+"}":e}function o(e){return(e=i.default(e)).rules||!e.assignment&&!e.expression||(e.rules=[{id:"1",assignment:e.assignment||"",expression:e.expression||""}]),delete e.assignment,delete e.expression,e}function s(e){return e.replace(/\\operatorname(?:\{stdev\}p|\{stddev\}p|\{stdDev\}P|\{var\}iance)/g,function(e){switch(e){case"\\operatorname{stdev}p":return"\\operatorname{stdevp}";case"\\operatorname{stddev}p":return"\\operatorname{stddevp}";case"\\operatorname{stdDev}P":return"\\operatorname{stdDevP}";case"\\operatorname{var}iance":return"\\operatorname{variance}";default:return""}})}function u(e){var t=e.latex,n=e.values,i=r.__assign({},e);return t&&(i.latex=s(t),i.latex=a(i.latex)),n&&(i.values=n.map(function(e){return e?s(e):""})),i}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(7!==e.version)throw new Error("Unexpected version: "+e.version);var t=e.expressions.list.map(function(e){if("image"===e.type){var t=r.__assign(r.__assign({},e),{opacity:""});for(var n in e.hasOwnProperty("stringOpacity")?t.opacity=e.stringOpacity:e.hasOwnProperty("opacity")?t.opacity=e.opacity+"":delete t.opacity,e.clickableInfo&&(t.clickableInfo=o(e.clickableInfo)),delete t.stringOpacity,e)if("x"===n||"y"===n||"width"===n||"height"===n){var c=e[n];c&&(t[n]=s(c))}return t}if("expression"===e.type){t=r.__assign(r.__assign({},e),{fillOpacity:"",lineStyle:"SOLID"});if("SINGLE_PIXEL"===e.lineStyle?t.lineWidth="1":e.hasOwnProperty("lineStyle")?t.lineStyle=e.lineStyle:delete t.lineStyle,t.hasOwnProperty("lineWidth")||(t.lineWidth=""),t.hasOwnProperty("lineOpacity")||(t.lineOpacity=""),t.hasOwnProperty("pointOpacity")||(t.pointOpacity=""),t.hasOwnProperty("pointSize")||(t.pointSize=""),t.hasOwnProperty("colorLatex")||(t.colorLatex=""),"string"==typeof e.latex&&(t.latex=s(e.latex)),e.latex&&(t.latex=s(e.latex)),e.hasOwnProperty("stringFillOpacity")?t.fillOpacity=e.stringFillOpacity:e.hasOwnProperty("fillOpacity")?t.fillOpacity=e.fillOpacity+"":delete t.fillOpacity,t.slider&&e.slider&&e.slider.newLoopMode&&(t.slider=i.default(t.slider),t.slider.loopMode=e.slider.newLoopMode,delete t.slider.newLoopMode),t.residualVariable&&(t.residualVariable=a(t.residualVariable)),t.regressionParameters)for(var l in t.regressionParameters={},e.regressionParameters){var p=a(l),d=e.regressionParameters[l];t.regressionParameters[p]=d}return e.clickableInfo&&(t.clickableInfo=o(e.clickableInfo)),t}return"table"===e.type?(f=e).columns?r.__assign(r.__assign({},f),{columns:f.columns.map(u)}):f:e;var f});return{version:8,randomSeed:e.randomSeed||n.default(),graph:e.graph,expressions:{list:t}}}});r("core/graphing-calc/json/ticker",["require","exports","tslib","core/lib/default-spec"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inflateDefaults=t.stripDefaults=t.DEFAULTS=void 0,t.DEFAULTS={handlerLatex:"",minStepLatex:"",open:!1,playing:!1},t.stripDefaults=function(e){return n.stripDefaultsAndMaybeReturnUndefined(t.DEFAULTS,e)},t.inflateDefaults=function(e){return r.__assign(r.__assign({},t.DEFAULTS),e)}});r("core/graphing-calc/migrations/9",["require","exports","tslib","core/lib/random-seed","../json/ticker"],function(e,t,r,n,i){"use strict";function a(e,t,r){if(e.verticalLabel)switch(delete t.verticalLabel,t.labelAngle=r?"90":"\\frac{\\pi}{2}",e.labelOrientation){case"above":t.labelOrientation="right";break;case"below":t.labelOrientation="left";break;case"left":t.labelOrientation="above";break;case"right":t.labelOrientation="below"}e.extendedLabelOrientation&&(t.labelOrientation=e.extendedLabelOrientation,delete t.extendedLabelOrientation)}function o(e,t){if(e.vizProps)switch(e.vizProps.dotplotSize){case"small":t.pointSize="9";break;case"large":t.pointSize="20"}if(e.vizProps){var n=r.__assign({},e.vizProps);delete n.dotplotSize,Object.keys(n).length?t.vizProps=n:delete t.vizProps}}function s(e){return e.filter(function(e){var t=e.assignment,r=e.expression;return!!t&&!!r})}function u(e){return e.map(function(e){return e.assignment+"\\to "+e.expression}).join(",")||""}function c(e){for(var t,r=JSON.stringify(e),n=/_(\d)|_\{(\d+)\}/g,i={};null!==(t=n.exec(r));){i[void 0!==t[1]?t[1]:t[2]]=!0}return i}function l(e,t){for(var r=t+1;;r++)if(!e[r])return r}function p(e){for(var t,r=JSON.stringify(e),n=/"(\d+)"/g,i={};null!==(t=n.exec(r));){i[void 0!==t[1]?t[1]:t[2]]=!0}return i}function d(e,t){for(var r=t+1;;r++)if(!e[r])return r}function f(e,t){var r={handlerLatex:e,playing:!0,open:!0};return void 0!==t&&(r.minStepLatex=function(e){if(/^\d+$/.test(e)){var t=parseInt(e,10);return 0===t?"\\infty":""+Math.round(1e3/t)}return"\\frac{1000}{"+e+"}"}(t)),r}Object.defineProperty(t,"__esModule",{value:!0}),t.rulesToLatex=t.filterEmptyRules=void 0,t.filterEmptyRules=s,t.rulesToLatex=u,t.default=function(e){if(8!==e.version)throw new Error("Unexpected version: "+e.version);var t=!1;e.graph&&e.graph.degreeMode&&(t=!0);for(var h,y,m=e.expressions.ticker||i.DEFAULTS,v=0,g=0,b=[],x=0,S=e.expressions.list;x<S.length;x++){var T=S[x];switch(T.type){case"expression":a(T,k=r.__assign({},T),t),o(T,k);var w=void 0;if(T.clickableInfo&&T.clickableInfo.rules){var _=T.clickableInfo,I=_.rules,E=r.__rest(_,["rules"]),C=u(O=s(I));if(O.length>1){h||(h=c(e)),v=l(h,v),y||(y=p(e)),g=d(y,g);var M="A_{"+v+"}";E.latex=M,w={type:"expression",id:""+g,latex:M+"="+C},void 0!==T.folderId&&(w.folderId=T.folderId)}else E.latex=C;k.clickableInfo=E}k.clickableInfo&&k.clickableInfo.enabled&&k.hidden&&(k.clickableInfo.enabled=!1),b.push(k),w&&b.push(w);break;case"image":if(T.clickableInfo&&T.clickableInfo.rules){var k=r.__assign({},T),P=T.clickableInfo;I=P.rules,E=r.__rest(P,["rules"]),C=u(O=s(I)),w=void 0;if(O.length>1){h||(h=c(e)),v=l(h,v),y||(y=p(e)),g=d(y,g);M="A_{"+v+"}";E.latex=M,w={type:"expression",id:""+g,latex:M+"="+C},void 0!==T.folderId&&(w.folderId=T.folderId)}else E.latex=C;k.clickableInfo=E,b.push(k),w&&b.push(w)}else b.push(T);break;case"simulation":var O,L=void 0;if(T.clickableInfo&&T.clickableInfo.rules)L=u(O=s(T.clickableInfo.rules));else L="";if(T.isPlaying&&""!==L)h||(h=c(e)),L=(M="A_{"+(v=l(h,v))+"}")+"="+L,m=f(M,T.fps);k={type:"expression",id:T.id,latex:L};void 0!==T.folderId&&(k.folderId=T.folderId),b.push(k);break;default:b.push(T)}}return{version:9,randomSeed:e.randomSeed||n.default(),graph:e.graph,expressions:{list:b,ticker:m}}}});r("core/graphing-calc/migrate-state",["require","exports","./migrations/0","./migrations/1","./migrations/2","./migrations/3","./migrations/4","core/graphing-calc/validate-state","./migrations/5","./migrations/6","./migrations/7","./migrations/8","./migrations/9"],function(e,t,r,n,i,a,o,s,u,c,l,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.migrateToPersisted=t.migrateToLatest=t.currentVersion=t.persistedVersion=void 0;var f=[r,n,i,a,o,u.migrateState,c.migrateState,l.default,p.default,d.default];function h(e){if(e.version>t.currentVersion)return"undefined"!=typeof console&&console.warn&&console.warn("Loading saved state with version "+e.version+" but last known version is "+t.currentVersion+". States saved in a newer version of the calculator may not load correctly in an older version of the calculator."),s.validateState(e);if(e.hasOwnProperty("version")&&!f[e.version])return"undefined"!=typeof console&&console.warn&&console.warn("State has invalid version "+e.version+". If a version is present, it should be a non-negative integer less than or equal to "+t.currentVersion+"."),s.validateState(e);for(e.hasOwnProperty("version")||(e=f[0](e));e.version<t.currentVersion;)e=f[e.version+1](e);return s.validateState(e)}t.persistedVersion=9,t.currentVersion=9,t.migrateToLatest=h,t.migrateToPersisted=function(e){return h(e)}});r("core/graphing-calc/json/table",["require","exports","tslib","core/lib/default-spec","core/types/styles","core/lib/dragmode"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeParsableState=t.stripDefaults=t.inflateDefaults=t.COLUMN_DEFAULTS=t.DEFAULTS=void 0,t.DEFAULTS={folderId:"",secret:!1,columns:[]},t.COLUMN_DEFAULTS={latex:"",color:"",hidden:!1,values:[],points:!0,lines:!1,dragMode:a.DragMode.NONE,pointStyle:i.PointStyle.POINT,lineStyle:i.LineStyle.SOLID,colorLatex:"",lineOpacity:"",lineWidth:"",pointOpacity:"",pointSize:""},t.inflateDefaults=function(e){var n=r.__assign(r.__assign({},t.DEFAULTS),e);return n.columns=n.columns.map(function(e){return r.__assign(r.__assign({},t.COLUMN_DEFAULTS),e)}),n},t.stripDefaults=function(e){return e=r.__assign(r.__assign({},e),{columns:e.columns.map(function(e){return n.stripDefaults(t.COLUMN_DEFAULTS,e)})}),n.stripDefaults(t.DEFAULTS,e)},t.computeParsableState=function(e){return{type:"table",id:e.id,columns:e.columns.map(function(t){return r.__assign(r.__assign({},t),{tableId:e.id})})}}});r("core/cl-calculator",["require","exports","core/graphing-calc/migrate-state","core/graphing-calc/json/expression","core/graphing-calc/json/table"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLCalculator=void 0,t.CLCalculator=function(e){var t=r.migrateToLatest(e),a={},o=t.graph.degreeMode,s=t.randomSeed;function u(e){switch(e.type){case void 0:case"expression":var t=n.computeParsableState(n.inflateDefaults(e));a[t.id]=t;break;case"table":t=i.computeParsableState(i.inflateDefaults(e));a[t.id]=t;break;case"folder":case"text":case"image":break;default:return e}}for(var c=0,l=t.expressions.list;c<l.length;c++){u(l[c])}return{setExpression:function(e){u(e)},getChangeSet:function(){return{statements:a,isCompleteState:!0,degreeMode:o,globalRandomSeed:s}}}}});r("core/math/tree-queries/count-numbers",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countNumbers=void 0,t.countNumbers=function e(t,r){switch(t.type){case"Mul":case"Div":case"Prime":case"Call":case"ImplicitCall":case"Dot":case"Pipes":case"Sqrt":case"Nthroot":case"Frac":case"Derivative":case"Integral":case"EmptyIntegral":case"Sum":case"Product":case"Piecewise":case"Paren":case"Juxt":case"Superscript":case"Bang":case"Index":case"Equals":case"Inequality":case"Tilde":case"Pos":case"Neg":case"Add":case"Sub":case"List":case"Seq":case"Colon":case"Ellipsis":case"PercentOf":case"RightArrow":case"For":for(var n=0,i=0,a=t.args;i<a.length;i++){n+=e(a[i],r)}return n;case"Decimal":return void 0===r||parseFloat(t.val)===r?1:0;case"MixedNumber":if(void 0===r)return 3;n=0;return parseFloat(t.whole)===r&&(n+=1),parseFloat(t.num)===r&&(n+=1),parseFloat(t.den)===r&&(n+=1),n;case"Letter":case"EmptyPiecewise":case"Cmd":case"EmptyRangeEnd":return 0;case"Subscript":return e(t.args[0],r);case"InequalityChain":n=0;n+=e(t.first,r);for(var o=0,s=t.chain;o<s.length;o++){n+=e(s[o].args[0],r)}return n;default:throw"Unexpected surface node "+t.type+"."}}});r("core/graphing-calc/diffs/longest-subsequence",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.findLongestSubsequence=void 0,t.findLongestSubsequence=function(e){for(var t=e.length,r=new Array(t),n=new Array(t+1),i=0,a=0;a<t;a++){var o=void 0;if(e[n[i]]<e[a])o=i+1;else{for(var s=1,u=i-1;s<=u;){var c=Math.ceil((s+u)/2);e[n[c]]<e[a]?s=c+1:u=c-1}o=s}r[a]=n[o-1],n[o]=a,o>i&&(i=o)}var l=new Array(i),p=n[i];for(a=i-1;a>=0;a--)l[a]=e[p],p=r[p];return l}});r("core/graphing-calc/diffs/calculate-diff",["require","exports","underscore","./longest-subsequence"],function(e,t,r,n){"use strict";var i;function a(e,t,r){var n={};for(var i in e)if(e.hasOwnProperty(i))if(t.hasOwnProperty(i)){var a=o(e[i],t[i],r,i);a&&(n[i]=a)}else n[i]={d:1};for(var i in t)t.hasOwnProperty(i)&&!e.hasOwnProperty(i)&&(n[i]={s:t[i]});return n}function o(e,t,o,u){if(r.isArray(e)&&r.isArray(t)){if(o===i.EXPRESSIONS&&"list"===u||o===i.TABLE_EXPRESSION&&"columns"===u)return function(e,t){for(var o={},u={},c=0;c<e.length;c++){if(void 0!==u[e[c].id])return{s:t};u[e[c].id]=c}var l={};for(c=0;c<t.length;c++){if(void 0!==l[t[c].id])return{s:t};l[t[c].id]=c}for(var p=function(e,t,r){for(var i={},a=t.filter(function(e){return void 0!==r[e.id]}).map(function(e){return r[e.id]}),o=n.findLongestSubsequence(a),s=0,u=o;s<u.length;s++){i[e[u[s]].id]=!0}return i}(e,t,u),d=0,f=0;f<e.length;f++){var h=e[f];if(p[h.id]){var y=l[h.id],m=t[y],v={};if(d!==y&&(v.a=t.slice(d,y).map(function(t){return s(e,u,t)})),!r.isEqual(h,m)){var g="table"===h.type&&"table"===m.type;v.e=a(h,m,g?i.TABLE_EXPRESSION:i.OTHER)}r.isEmpty(v)||(o[f]=v),d=y+1}else o[f]={d:1}}d<t.length&&(o[e.length]={a:t.slice(d,t.length).map(function(t){return s(e,u,t)})});if(!r.isEmpty(o))return{l:o};return}(e,t);if(!r.isEqual(e,t))return{s:t}}else if(r.isObject(e)&&r.isObject(t)){var c=a(e,t,function(e,t){return e===i.ROOT&&"expressions"===t?i.EXPRESSIONS:i.OTHER}(o,u));if(!r.isEmpty(c))return{e:c}}else if(!r.isEqual(e,t))return{s:t}}function s(e,t,n){if(t[n.id]){var o=e[t[n.id]],s={f:t[n.id]};return r.isEqual(o,n)||(s.e=a(o,n,i.OTHER)),{m:s}}return{s:n}}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateDiff=void 0,function(e){e[e.ROOT=0]="ROOT",e[e.EXPRESSIONS=1]="EXPRESSIONS",e[e.TABLE_EXPRESSION=2]="TABLE_EXPRESSION",e[e.OTHER=3]="OTHER"}(i||(i={})),t.calculateDiff=function(e,t){return a(e,t,i.ROOT)}});r("core/graphing-calc/diffs/apply-diff",["require","exports","underscore","../../lib/deepCopy"],function(e,t,r,n){"use strict";function i(e,t){for(var n=0,o=r.keys(t);n<o.length;n++){var p=o[n],d=t[p];s(d)?e[p]=d.s:u(d)?delete e[p]:c(d)?e[p]=a(e[p],d.l):l(d)&&(e[p]=i(e[p],d.e))}return e}function a(e,t){for(var r=[],n=0;n<e.length;n++){var a=t[n];a&&a.a&&r.push.apply(r,o(e,a.a)),a&&a.e?r.push(i(e[n],a.e)):a&&a.d||r.push(e[n])}var s=t[e.length];return s&&s.a&&r.push.apply(r,o(e,s.a)),r}function o(e,t){for(var r=[],n=0,a=t;n<a.length;n++){var o=a[n];if(o.hasOwnProperty("s"))r.push(o.s);else if(p(o)){var s=e[o.m.f];o.m.e?r.push(i(s,o.m.e)):r.push(s)}}return r}function s(e){return e.hasOwnProperty("s")}function u(e){return e.hasOwnProperty("d")}function c(e){return e.hasOwnProperty("l")}function l(e){return e.hasOwnProperty("e")}function p(e){return e.hasOwnProperty("m")}Object.defineProperty(t,"__esModule",{value:!0}),t.applyDiff=void 0,t.applyDiff=function(e,t){return i(n.default(e),t)}});r("core/graphing-calc/translation/common",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mutateString=t.deserializeTranslationKey=t.serializeTranslationKey=void 0,t.serializeTranslationKey=function(e){return"expression"===e.location||"object"===e.location?e.location+":"+e.id+":"+e.path:e.location+":"+e.path},t.deserializeTranslationKey=function(e){var t=function(){return new Error("Invalid key: "+e)},r=e.split(":"),n=r[0];if(!n)throw t();if("expression"!=n&&"settings"!=n&&"object"!=n)throw t();if("settings"==n){if(2!=r.length)throw t();return{location:n,path:r[1]}}if(3!=r.length)throw t();return{location:n,id:r[1],path:r[2]}},t.mutateString=function(e,t,r){if(e)for(var n=t.split("."),i=e,a=0;a<n.length;a++){var o=n[a];if(!i[o])break;a==n.length-1&&"string"==typeof i[o]?i[o]=r:i=i[o]}}});r("core/graphing-calc/translation/translator",["require","exports","tslib","../../lib/deepCopy","./common"],function(e,t,r,n,i){"use strict";function a(e,t){return function(n,a,o,s){if(n){var u=i.serializeTranslationKey(r.__assign(r.__assign({},t),{path:a}));e[u]={value:n,type:o,context:s}}}}function o(e){var t,r,n,i,o={},s=a(o,{location:"expression",id:e.id});switch(e.type){case"expression":s(e.label,"label","interpolated-string","expression-list-expression-label"),s(null===(t=e.clickableInfo)||void 0===t?void 0:t.description,"clickableInfo.description","string","expression-list-expression-clickable-description");break;case"image":s(e.image_url,"image_url","image","expression-list-image-url"),s(null===(r=e.clickableInfo)||void 0===r?void 0:r.description,"clickableInfo.description","string","expression-list-image-clickable-description"),s(null===(n=e.clickableInfo)||void 0===n?void 0:n.hoveredImage,"clickableInfo.hoveredImage","image","expression-list-image-clickable-hovered"),s(null===(i=e.clickableInfo)||void 0===i?void 0:i.depressedImage,"clickableInfo.depressedImage","image","expression-list-image-clickable-depressed");break;case"text":s(e.text,"text","string","expression-list-note-text");break;case"folder":s(e.title,"title","string","expression-list-folder-title")}return o}Object.defineProperty(t,"__esModule",{value:!0}),t.applyLocalizationMap=t.extractLocalizationMap=void 0,t.extractLocalizationMap=function(e){var t,r,n,i={};if("graph"==e.type){for(var s=0,u=e.graphState.expressions.list;s<u.length;s++){var c=o(u[s]);for(var l in c)i[l]=c[l]}var p=function(e){var t={},r=a(t,{location:"settings"});return r(e.graph.xAxisLabel,"xAxisLabel","string","settings-xaxis-label"),r(e.graph.yAxisLabel,"yAxisLabel","string","settings-yaxis-label"),t}(e.graphState);for(var l in p)i[l]=p[l]}else{var d=e.geometryState.objects;for(var f in d){var h=(t=d[f],r=void 0,n=void 0,(n=a(r={},{location:"object",id:t.id}))(t.label,"label","string","geometry-object-label"),"image"===t.type&&n(t.url,"url","image","geometry-object-image-url"),r);for(var l in h)i[l]=h[l]}}return i},t.applyLocalizationMap=function(e,t,r){var a,o,s=n.default(e);if("graph"===r){for(var u={},c=0,l=null!==(o=null===(a=s.expressions)||void 0===a?void 0:a.list)&&void 0!==o?o:[];c<l.length;c++){var p=l[c];u[p.id]=p}for(var d in t){"expression"==(f=i.deserializeTranslationKey(d)).location?i.mutateString(u[f.id],f.path,t[d].value):i.mutateString(s.graph,f.path,t[d].value)}}else if(s.objects)for(var d in t){var f;"object"==(f=i.deserializeTranslationKey(d)).location&&i.mutateString(s.objects[f.id],f.path,t[d].value)}return s}});r("core/mathtools",["require","exports","parser","core/math/builtinframe","parsenodes","tslib","core/math/context","core/cl-calculator","core/math/parser/latex-parser","core/math/parser/expression-parser","core/math/tree-queries/count-numbers","core/lib/color-helpers","core/math/policyGraphing","core/math/policyScientific","core/math/policyFourFunction","./math/parser/surface-node-error","core/lib/label","core/graphing-calc/diffs/calculate-diff","core/graphing-calc/diffs/apply-diff","core/graphing-calc/migrate-state","core/math/types","core/graphing-calc/translation/translator","./math/parser/input-span","core/lib/number-to-latex","core/lib/number-to-latex"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f,h,y,m,v,g,b,x,S,T,w,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.numberToLatex=t.numberToDecimalString=t.applyLocalizationMap=t.extractLocalizationMap=t.migrateToLatest=t.applyDiff=t.calculateDiff=t.CLCalculator=t.colorHelpers=t.policies=t.parseNodes=t.types=t.builtInFrame=t.context=t.treeQueries=t.expressionParser=t.parser=t.Label=void 0,Object.defineProperty(t,"CLCalculator",{enumerable:!0,get:function(){return s.CLCalculator}}),t.colorHelpers=p,t.Label=m,Object.defineProperty(t,"calculateDiff",{enumerable:!0,get:function(){return v.calculateDiff}}),Object.defineProperty(t,"applyDiff",{enumerable:!0,get:function(){return g.applyDiff}}),Object.defineProperty(t,"migrateToLatest",{enumerable:!0,get:function(){return b.migrateToLatest}}),Object.defineProperty(t,"extractLocalizationMap",{enumerable:!0,get:function(){return S.extractLocalizationMap}}),Object.defineProperty(t,"applyLocalizationMap",{enumerable:!0,get:function(){return S.applyLocalizationMap}}),Object.defineProperty(t,"numberToDecimalString",{enumerable:!0,get:function(){return w.numberToDecimalString}}),t.numberToLatex=_.default,t.parser={parse:function(e,t){return null==e&&(e=""),r.parse(e,t)}},t.expressionParser={parse:function(e){if(null!=e)try{var r=u.parse(e);return c.parse(r)}catch(r){var n=r instanceof t.parseNodes.Base?r.getInputSpan():T.Span(e,0,e.length),i=a.__assign(a.__assign({},y.UnexpectedParseError()),{originalError:r});return y.Err(n,i)}}},t.treeQueries={countNumbers:l.countNumbers},t.context=o.Context,t.builtInFrame=n,t.types=x,t.parseNodes=i,t.policies={graphing:d.PolicyGraphing,scientific:f.PolicyScientific,fourFunction:h.PolicyFourFunction}});return t("core/mathtools")});define("core/components/shared/calculator-state-helpers",["require","exports","core/lib/copydata","core/lib/mathtools"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.updateGraphAssetUrls=t.getGraphAssetUrls=void 0;function i(e){var t=[];var r=n.migrateToLatest(e);var i=r.expressions.list||[];for(var a=0,o=i;a<o.length;a++){var s=o[a];if(s&&s.type==="image"&&!!s.image_url){t.push(s.image_url)}}return t}t.getGraphAssetUrls=i;function a(e,t){var n=r.copydata(e);var i=n.expressions.list||[];for(var a=0,o=i;a<o.length;a++){var s=o[a];if(s&&s.type==="image"&&!!s.image_url){s.image_url=t(s.image_url)}}return n}t.updateGraphAssetUrls=a});define("core/components/cardsort/index",["require","exports","./group-tools","../shared/calculator-state-helpers","core/lib/copydata"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(e){var t=e.config.answerKey;if(t){if(e.response&&e.response.groupIds){return r.responseMatchesKey(e.response,t)?"correct":"incorrect"}else{return"incomplete"}}else{return"ungraded"}},getComponentState:function(e){var t=e.response,r=e.config;var n=t&&t.groupIds||[];var i=t&&t.groups||{};return{groupIds:n,groups:i,answerKey:r.answerKey}},hasResponse:function(e){return!!e&&!!e.groupIds},getAssetUrls:function(e){var t=[];for(var r=0,i=Object.keys(e.cards);r<i.length;r++){var a=i[r];var o=e.cards[a];if(o.type==="image"&&o.img){t.push(o.img)}else if(o.type==="graph"){if(o.img){t.push(o.img)}if(o.calculatorState){t.push.apply(t,n.getGraphAssetUrls(o.calculatorState))}}}return t},rewriteAssetUrls:function(e,t){var r=i.copydata(e);for(var a=0,o=Object.keys(r.cards);a<o.length;a++){var s=o[a];var u=r.cards[s];if(u.type==="image"&&u.img){u.img=t(u.img)}else if(u.type==="graph"){if(u.img){u.img=t(u.img)}if(u.calculatorState){u.calculatorState=n.updateGraphAssetUrls(u.calculatorState,t)}}}return r}}});define("core/components/image-exhibit/index",["require","exports","core/lib/copydata"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(e){var t=e.config;return{src:t.img,alt:t.alt!==""?t.alt:undefined}},hasResponse:function(){return false},getAssetUrls:function(e){if(e.img){return[e.img]}return[]},rewriteAssetUrls:function(e,t){var n=r.copydata(e);if(n.img){n.img=t(n.img)}return n}}});define("core/prosemirror/prosemirror-helpers",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.clipboardTextSerializer=t.splitOnRegex=void 0;var r=function(e,t){var r=[];var n=0;var i;while(i=t.exec(e)){var a=i.index;var o=a+i[0].length;if(a>n){r.push({matched:false,text:e.substr(n,a-n),start:n,end:a})}r.push({matched:true,text:e.substr(a,o-a),start:a,end:o});n=o}if(n<e.length){r.push({matched:false,text:e.substr(n),start:n,end:e.length})}return r};t.splitOnRegex=r;function n(e){var t=-1;var r=e.content.size;var n="\n\n";var i="";var a=true;e.content.descendants(function(e,o){if(e.isText){i+=e.text.slice(Math.max(t,o)-o,r-o)}else{switch(e.type.name){case"paragraph":if(!a){i+=n}a=false;break;case"mq":case"interp":i+=e.type.spec.toDOM(e).toString();return false}}return true});return i}t.clipboardTextSerializer=n});define("orderedmap",["require","exports","module"],function(e,t,r){function n(e){this.content=e}n.prototype={constructor:n,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return t==-1?undefined:this.content[t+1]},update:function(e,t,r){var i=r&&r!=e?this.remove(r):this;var a=i.find(e),o=i.content.slice();if(a==-1){o.push(r||e,t)}else{o[a+1]=t;if(r)o[a]=r}return new n(o)},remove:function(e){var t=this.find(e);if(t==-1)return this;var r=this.content.slice();r.splice(t,2);return new n(r)},addToStart:function(e,t){return new n([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var r=this.remove(e).content.slice();r.push(e,t);return new n(r)},addBefore:function(e,t,r){var i=this.remove(t),a=i.content.slice();var o=i.find(e);a.splice(o==-1?a.length:o,0,t,r);return new n(a)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){e=n.from(e);if(!e.size)return this;return new n(e.content.concat(this.subtract(e).content))},append:function(e){e=n.from(e);if(!e.size)return this;return new n(this.subtract(e).content.concat(e.content))},subtract:function(e){var t=this;e=n.from(e);for(var r=0;r<e.content.length;r+=2)t=t.remove(e.content[r]);return t},get size(){return this.content.length>>1}};n.from=function(e){if(e instanceof n)return e;var t=[];if(e)for(var r in e)t.push(r,e[r]);return new n(t)};r.exports=n});define("prosemirror-model/index",["require","exports","module","orderedmap"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});function n(e){return e&&typeof e==="object"&&"default"in e?e["default"]:e}var i=n(e("orderedmap"));function a(e,t,r){for(var n=0;;n++){if(n==e.childCount||n==t.childCount){return e.childCount==t.childCount?null:r}var i=e.child(n),o=t.child(n);if(i==o){r+=i.nodeSize;continue}if(!i.sameMarkup(o)){return r}if(i.isText&&i.text!=o.text){for(var s=0;i.text[s]==o.text[s];s++){r++}return r}if(i.content.size||o.content.size){var u=a(i.content,o.content,r+1);if(u!=null){return u}}r+=i.nodeSize}}function o(e,t,r,n){for(var i=e.childCount,a=t.childCount;;){if(i==0||a==0){return i==a?null:{a:r,b:n}}var s=e.child(--i),u=t.child(--a),c=s.nodeSize;if(s==u){r-=c;n-=c;continue}if(!s.sameMarkup(u)){return{a:r,b:n}}if(s.isText&&s.text!=u.text){var l=0,p=Math.min(s.text.length,u.text.length);while(l<p&&s.text[s.text.length-l-1]==u.text[u.text.length-l-1]){l++;r--;n--}return{a:r,b:n}}if(s.content.size||u.content.size){var d=o(s.content,u.content,r-1,n-1);if(d){return d}}r-=c;n-=c}}var s=function e(t,r){this.content=t;this.size=r||0;if(r==null){for(var n=0;n<t.length;n++){this.size+=t[n].nodeSize}}};var u={firstChild:{configurable:true},lastChild:{configurable:true},childCount:{configurable:true}};s.prototype.nodesBetween=function e(t,r,n,i,a){if(i===void 0)i=0;for(var o=0,s=0;s<r;o++){var u=this.content[o],c=s+u.nodeSize;if(c>t&&n(u,i+s,a,o)!==false&&u.content.size){var l=s+1;u.nodesBetween(Math.max(0,t-l),Math.min(u.content.size,r-l),n,i+l)}s=c}};s.prototype.descendants=function e(t){this.nodesBetween(0,this.size,t)};s.prototype.textBetween=function e(t,r,n,i){var a="",o=true;this.nodesBetween(t,r,function(e,s){if(e.isText){a+=e.text.slice(Math.max(t,s)-s,r-s);o=!n}else if(e.isLeaf&&i){a+=i;o=!n}else if(!o&&e.isBlock){a+=n;o=true}},0);return a};s.prototype.append=function e(t){if(!t.size){return this}if(!this.size){return t}var r=this.lastChild,n=t.firstChild,i=this.content.slice(),a=0;if(r.isText&&r.sameMarkup(n)){i[i.length-1]=r.withText(r.text+n.text);a=1}for(;a<t.content.length;a++){i.push(t.content[a])}return new s(i,this.size+t.size)};s.prototype.cut=function e(t,r){if(r==null){r=this.size}if(t==0&&r==this.size){return this}var n=[],i=0;if(r>t){for(var a=0,o=0;o<r;a++){var u=this.content[a],c=o+u.nodeSize;if(c>t){if(o<t||c>r){if(u.isText){u=u.cut(Math.max(0,t-o),Math.min(u.text.length,r-o))}else{u=u.cut(Math.max(0,t-o-1),Math.min(u.content.size,r-o-1))}}n.push(u);i+=u.nodeSize}o=c}}return new s(n,i)};s.prototype.cutByIndex=function e(t,r){if(t==r){return s.empty}if(t==0&&r==this.content.length){return this}return new s(this.content.slice(t,r))};s.prototype.replaceChild=function e(t,r){var n=this.content[t];if(n==r){return this}var i=this.content.slice();var a=this.size+r.nodeSize-n.nodeSize;i[t]=r;return new s(i,a)};s.prototype.addToStart=function e(t){return new s([t].concat(this.content),this.size+t.nodeSize)};s.prototype.addToEnd=function e(t){return new s(this.content.concat(t),this.size+t.nodeSize)};s.prototype.eq=function e(t){if(this.content.length!=t.content.length){return false}for(var r=0;r<this.content.length;r++){if(!this.content[r].eq(t.content[r])){return false}}return true};u.firstChild.get=function(){return this.content.length?this.content[0]:null};u.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};u.childCount.get=function(){return this.content.length};s.prototype.child=function e(t){var r=this.content[t];if(!r){throw new RangeError("Index "+t+" out of range for "+this)}return r};s.prototype.maybeChild=function e(t){return this.content[t]};s.prototype.forEach=function e(t){for(var r=0,n=0;r<this.content.length;r++){var i=this.content[r];t(i,n,r);n+=i.nodeSize}};s.prototype.findDiffStart=function e(t,r){if(r===void 0)r=0;return a(this,t,r)};s.prototype.findDiffEnd=function e(t,r,n){if(r===void 0)r=this.size;if(n===void 0)n=t.size;return o(this,t,r,n)};s.prototype.findIndex=function e(t,r){if(r===void 0)r=-1;if(t==0){return l(0,t)}if(t==this.size){return l(this.content.length,t)}if(t>this.size||t<0){throw new RangeError("Position "+t+" outside of fragment ("+this+")")}for(var n=0,i=0;;n++){var a=this.child(n),o=i+a.nodeSize;if(o>=t){if(o==t||r>0){return l(n+1,o)}return l(n,i)}i=o}};s.prototype.toString=function e(){return"<"+this.toStringInner()+">"};s.prototype.toStringInner=function e(){return this.content.join(", ")};s.prototype.toJSON=function e(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null};s.fromJSON=function e(t,r){if(!r){return s.empty}if(!Array.isArray(r)){throw new RangeError("Invalid input for Fragment.fromJSON")}return new s(r.map(t.nodeFromJSON))};s.fromArray=function e(t){if(!t.length){return s.empty}var r,n=0;for(var i=0;i<t.length;i++){var a=t[i];n+=a.nodeSize;if(i&&a.isText&&t[i-1].sameMarkup(a)){if(!r){r=t.slice(0,i)}r[r.length-1]=a.withText(r[r.length-1].text+a.text)}else if(r){r.push(a)}}return new s(r||t,n)};s.from=function e(t){if(!t){return s.empty}if(t instanceof s){return t}if(Array.isArray(t)){return this.fromArray(t)}if(t.attrs){return new s([t],t.nodeSize)}throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(s.prototype,u);var c={index:0,offset:0};function l(e,t){c.index=e;c.offset=t;return c}s.empty=new s([],0);function p(e,t){if(e===t){return true}if(!(e&&typeof e=="object")||!(t&&typeof t=="object")){return false}var r=Array.isArray(e);if(Array.isArray(t)!=r){return false}if(r){if(e.length!=t.length){return false}for(var n=0;n<e.length;n++){if(!p(e[n],t[n])){return false}}}else{for(var i in e){if(!(i in t)||!p(e[i],t[i])){return false}}for(var a in t){if(!(a in e)){return false}}}return true}var d=function e(t,r){this.type=t;this.attrs=r};d.prototype.addToSet=function e(t){var r,n=false;for(var i=0;i<t.length;i++){var a=t[i];if(this.eq(a)){return t}if(this.type.excludes(a.type)){if(!r){r=t.slice(0,i)}}else if(a.type.excludes(this.type)){return t}else{if(!n&&a.type.rank>this.type.rank){if(!r){r=t.slice(0,i)}r.push(this);n=true}if(r){r.push(a)}}}if(!r){r=t.slice()}if(!n){r.push(this)}return r};d.prototype.removeFromSet=function e(t){for(var r=0;r<t.length;r++){if(this.eq(t[r])){return t.slice(0,r).concat(t.slice(r+1))}}return t};d.prototype.isInSet=function e(t){for(var r=0;r<t.length;r++){if(this.eq(t[r])){return true}}return false};d.prototype.eq=function e(t){return this==t||this.type==t.type&&p(this.attrs,t.attrs)};d.prototype.toJSON=function e(){var t={type:this.type.name};for(var r in this.attrs){t.attrs=this.attrs;break}return t};d.fromJSON=function e(t,r){if(!r){throw new RangeError("Invalid input for Mark.fromJSON")}var n=t.marks[r.type];if(!n){throw new RangeError("There is no mark type "+r.type+" in this schema")}return n.create(r.attrs)};d.sameSet=function e(t,r){if(t==r){return true}if(t.length!=r.length){return false}for(var n=0;n<t.length;n++){if(!t[n].eq(r[n])){return false}}return true};d.setFrom=function e(t){if(!t||t.length==0){return d.none}if(t instanceof d){return[t]}var r=t.slice();r.sort(function(e,t){return e.type.rank-t.type.rank});return r};d.none=[];function f(e){var t=Error.call(this,e);t.__proto__=f.prototype;return t}f.prototype=Object.create(Error.prototype);f.prototype.constructor=f;f.prototype.name="ReplaceError";var h=function e(t,r,n){this.content=t;this.openStart=r;this.openEnd=n};var y={size:{configurable:true}};y.size.get=function(){return this.content.size-this.openStart-this.openEnd};h.prototype.insertAt=function e(t,r){var n=v(this.content,t+this.openStart,r,null);return n&&new h(n,this.openStart,this.openEnd)};h.prototype.removeBetween=function e(t,r){return new h(m(this.content,t+this.openStart,r+this.openStart),this.openStart,this.openEnd)};h.prototype.eq=function e(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd};h.prototype.toString=function e(){return this.content+"("+this.openStart+","+this.openEnd+")"};h.prototype.toJSON=function e(){if(!this.content.size){return null}var t={content:this.content.toJSON()};if(this.openStart>0){t.openStart=this.openStart}if(this.openEnd>0){t.openEnd=this.openEnd}return t};h.fromJSON=function e(t,r){if(!r){return h.empty}var n=r.openStart||0,i=r.openEnd||0;if(typeof n!="number"||typeof i!="number"){throw new RangeError("Invalid input for Slice.fromJSON")}return new h(s.fromJSON(t,r.content),r.openStart||0,r.openEnd||0)};h.maxOpen=function e(t,r){if(r===void 0)r=true;var n=0,i=0;for(var a=t.firstChild;a&&!a.isLeaf&&(r||!a.type.spec.isolating);a=a.firstChild){n++}for(var o=t.lastChild;o&&!o.isLeaf&&(r||!o.type.spec.isolating);o=o.lastChild){i++}return new h(t,n,i)};Object.defineProperties(h.prototype,y);function m(e,t,r){var n=e.findIndex(t);var i=n.index;var a=n.offset;var o=e.maybeChild(i);var s=e.findIndex(r);var u=s.index;var c=s.offset;if(a==t||o.isText){if(c!=r&&!e.child(u).isText){throw new RangeError("Removing non-flat range")}return e.cut(0,t).append(e.cut(r))}if(i!=u){throw new RangeError("Removing non-flat range")}return e.replaceChild(i,o.copy(m(o.content,t-a-1,r-a-1)))}function v(e,t,r,n){var i=e.findIndex(t);var a=i.index;var o=i.offset;var s=e.maybeChild(a);if(o==t||s.isText){if(n&&!n.canReplace(a,a,r)){return null}return e.cut(0,t).append(r).append(e.cut(t))}var u=v(s.content,t-o-1,r);return u&&e.replaceChild(a,s.copy(u))}h.empty=new h(s.empty,0,0);function g(e,t,r){if(r.openStart>e.depth){throw new f("Inserted content deeper than insertion position")}if(e.depth-r.openStart!=t.depth-r.openEnd){throw new f("Inconsistent open depths")}return b(e,t,r,0)}function b(e,t,r,n){var i=e.index(n),a=e.node(n);if(i==t.index(n)&&n<e.depth-r.openStart){var o=b(e,t,r,n+1);return a.copy(a.content.replaceChild(i,o))}else if(!r.content.size){return _(a,E(e,t,n))}else if(!r.openStart&&!r.openEnd&&e.depth==n&&t.depth==n){var s=e.parent,u=s.content;return _(s,u.cut(0,e.parentOffset).append(r.content).append(u.cut(t.parentOffset)))}else{var c=C(r,e);var l=c.start;var p=c.end;return _(a,I(e,l,p,t,n))}}function x(e,t){if(!t.type.compatibleContent(e.type)){throw new f("Cannot join "+t.type.name+" onto "+e.type.name)}}function S(e,t,r){var n=e.node(r);x(n,t.node(r));return n}function T(e,t){var r=t.length-1;if(r>=0&&e.isText&&e.sameMarkup(t[r])){t[r]=e.withText(t[r].text+e.text)}else{t.push(e)}}function w(e,t,r,n){var i=(t||e).node(r);var a=0,o=t?t.index(r):i.childCount;if(e){a=e.index(r);if(e.depth>r){a++}else if(e.textOffset){T(e.nodeAfter,n);a++}}for(var s=a;s<o;s++){T(i.child(s),n)}if(t&&t.depth==r&&t.textOffset){T(t.nodeBefore,n)}}function _(e,t){if(!e.type.validContent(t)){throw new f("Invalid content for node "+e.type.name)}return e.copy(t)}function I(e,t,r,n,i){var a=e.depth>i&&S(e,t,i+1);var o=n.depth>i&&S(r,n,i+1);var u=[];w(null,e,i,u);if(a&&o&&t.index(i)==r.index(i)){x(a,o);T(_(a,I(e,t,r,n,i+1)),u)}else{if(a){T(_(a,E(e,t,i+1)),u)}w(t,r,i,u);if(o){T(_(o,E(r,n,i+1)),u)}}w(n,null,i,u);return new s(u)}function E(e,t,r){var n=[];w(null,e,r,n);if(e.depth>r){var i=S(e,t,r+1);T(_(i,E(e,t,r+1)),n)}w(t,null,r,n);return new s(n)}function C(e,t){var r=t.depth-e.openStart,n=t.node(r);var i=n.copy(e.content);for(var a=r-1;a>=0;a--){i=t.node(a).copy(s.from(i))}return{start:i.resolveNoCache(e.openStart+r),end:i.resolveNoCache(i.content.size-e.openEnd-r)}}var M=function e(t,r,n){this.pos=t;this.path=r;this.depth=r.length/3-1;this.parentOffset=n};var k={parent:{configurable:true},doc:{configurable:true},textOffset:{configurable:true},nodeAfter:{configurable:true},nodeBefore:{configurable:true}};M.prototype.resolveDepth=function e(t){if(t==null){return this.depth}if(t<0){return this.depth+t}return t};k.parent.get=function(){return this.node(this.depth)};k.doc.get=function(){return this.node(0)};M.prototype.node=function e(t){return this.path[this.resolveDepth(t)*3]};M.prototype.index=function e(t){return this.path[this.resolveDepth(t)*3+1]};M.prototype.indexAfter=function e(t){t=this.resolveDepth(t);return this.index(t)+(t==this.depth&&!this.textOffset?0:1)};M.prototype.start=function e(t){t=this.resolveDepth(t);return t==0?0:this.path[t*3-1]+1};M.prototype.end=function e(t){t=this.resolveDepth(t);return this.start(t)+this.node(t).content.size};M.prototype.before=function e(t){t=this.resolveDepth(t);if(!t){throw new RangeError("There is no position before the top-level node")}return t==this.depth+1?this.pos:this.path[t*3-1]};M.prototype.after=function e(t){t=this.resolveDepth(t);if(!t){throw new RangeError("There is no position after the top-level node")}return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize};k.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};k.nodeAfter.get=function(){var e=this.parent,t=this.index(this.depth);if(t==e.childCount){return null}var r=this.pos-this.path[this.path.length-1],n=e.child(t);return r?e.child(t).cut(r):n};k.nodeBefore.get=function(){var e=this.index(this.depth);var t=this.pos-this.path[this.path.length-1];if(t){return this.parent.child(e).cut(0,t)}return e==0?null:this.parent.child(e-1)};M.prototype.marks=function e(){var t=this.parent,r=this.index();if(t.content.size==0){return d.none}if(this.textOffset){return t.child(r).marks}var n=t.maybeChild(r-1),i=t.maybeChild(r);if(!n){var a=n;n=i;i=a}var e=n.marks;for(var o=0;o<e.length;o++){if(e[o].type.spec.inclusive===false&&(!i||!e[o].isInSet(i.marks))){e=e[o--].removeFromSet(e)}}return e};M.prototype.marksAcross=function e(t){var r=this.parent.maybeChild(this.index());if(!r||!r.isInline){return null}var n=r.marks,i=t.parent.maybeChild(t.index());for(var a=0;a<n.length;a++){if(n[a].type.spec.inclusive===false&&(!i||!n[a].isInSet(i.marks))){n=n[a--].removeFromSet(n)}}return n};M.prototype.sharedDepth=function e(t){for(var r=this.depth;r>0;r--){if(this.start(r)<=t&&this.end(r)>=t){return r}}return 0};M.prototype.blockRange=function e(t,r){if(t===void 0)t=this;if(t.pos<this.pos){return t.blockRange(this)}for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--){if(t.pos<=this.end(n)&&(!r||r(this.node(n)))){return new N(this,t,n)}}};M.prototype.sameParent=function e(t){return this.pos-this.parentOffset==t.pos-t.parentOffset};M.prototype.max=function e(t){return t.pos>this.pos?t:this};M.prototype.min=function e(t){return t.pos<this.pos?t:this};M.prototype.toString=function e(){var t="";for(var r=1;r<=this.depth;r++){t+=(t?"/":"")+this.node(r).type.name+"_"+this.index(r-1)}return t+":"+this.parentOffset};M.resolve=function e(t,r){if(!(r>=0&&r<=t.content.size)){throw new RangeError("Position "+r+" out of range")}var n=[];var i=0,a=r;for(var o=t;;){var s=o.content.findIndex(a);var u=s.index;var c=s.offset;var l=a-c;n.push(o,u,i+c);if(!l){break}o=o.child(u);if(o.isText){break}a=l-1;i+=c+1}return new M(r,n,a)};M.resolveCached=function e(t,r){for(var n=0;n<P.length;n++){var i=P[n];if(i.pos==r&&i.doc==t){return i}}var a=P[O]=M.resolve(t,r);O=(O+1)%L;return a};Object.defineProperties(M.prototype,k);var P=[],O=0,L=12;var N=function e(t,r,n){this.$from=t;this.$to=r;this.depth=n};var A={start:{configurable:true},end:{configurable:true},parent:{configurable:true},startIndex:{configurable:true},endIndex:{configurable:true}};A.start.get=function(){return this.$from.before(this.depth+1)};A.end.get=function(){return this.$to.after(this.depth+1)};A.parent.get=function(){return this.$from.node(this.depth)};A.startIndex.get=function(){return this.$from.index(this.depth)};A.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(N.prototype,A);var D=Object.create(null);var R=function e(t,r,n,i){this.type=t;this.attrs=r;this.content=n||s.empty;this.marks=i||d.none};var F={nodeSize:{configurable:true},childCount:{configurable:true},textContent:{configurable:true},firstChild:{configurable:true},lastChild:{configurable:true},isBlock:{configurable:true},isTextblock:{configurable:true},inlineContent:{configurable:true},isInline:{configurable:true},isText:{configurable:true},isLeaf:{configurable:true},isAtom:{configurable:true}};F.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};F.childCount.get=function(){return this.content.childCount};R.prototype.child=function e(t){return this.content.child(t)};R.prototype.maybeChild=function e(t){return this.content.maybeChild(t)};R.prototype.forEach=function e(t){this.content.forEach(t)};R.prototype.nodesBetween=function e(t,r,n,i){if(i===void 0)i=0;this.content.nodesBetween(t,r,n,i,this)};R.prototype.descendants=function e(t){this.nodesBetween(0,this.content.size,t)};F.textContent.get=function(){return this.textBetween(0,this.content.size,"")};R.prototype.textBetween=function e(t,r,n,i){return this.content.textBetween(t,r,n,i)};F.firstChild.get=function(){return this.content.firstChild};F.lastChild.get=function(){return this.content.lastChild};R.prototype.eq=function e(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)};R.prototype.sameMarkup=function e(t){return this.hasMarkup(t.type,t.attrs,t.marks)};R.prototype.hasMarkup=function e(t,r,n){return this.type==t&&p(this.attrs,r||t.defaultAttrs||D)&&d.sameSet(this.marks,n||d.none)};R.prototype.copy=function e(t){if(t===void 0)t=null;if(t==this.content){return this}return new this.constructor(this.type,this.attrs,t,this.marks)};R.prototype.mark=function e(t){return t==this.marks?this:new this.constructor(this.type,this.attrs,this.content,t)};R.prototype.cut=function e(t,r){if(t==0&&r==this.content.size){return this}return this.copy(this.content.cut(t,r))};R.prototype.slice=function e(t,r,n){if(r===void 0)r=this.content.size;if(n===void 0)n=false;if(t==r){return h.empty}var i=this.resolve(t),a=this.resolve(r);var o=n?0:i.sharedDepth(r);var s=i.start(o),u=i.node(o);var c=u.content.cut(i.pos-s,a.pos-s);return new h(c,i.depth-o,a.depth-o)};R.prototype.replace=function e(t,r,n){return g(this.resolve(t),this.resolve(r),n)};R.prototype.nodeAt=function e(t){for(var r=this;;){var n=r.content.findIndex(t);var i=n.index;var a=n.offset;r=r.maybeChild(i);if(!r){return null}if(a==t||r.isText){return r}t-=a+1}};R.prototype.childAfter=function e(t){var r=this.content.findIndex(t);var n=r.index;var i=r.offset;return{node:this.content.maybeChild(n),index:n,offset:i}};R.prototype.childBefore=function e(t){if(t==0){return{node:null,index:0,offset:0}}var r=this.content.findIndex(t);var n=r.index;var i=r.offset;if(i<t){return{node:this.content.child(n),index:n,offset:i}}var a=this.content.child(n-1);return{node:a,index:n-1,offset:i-a.nodeSize}};R.prototype.resolve=function e(t){return M.resolveCached(this,t)};R.prototype.resolveNoCache=function e(t){return M.resolve(this,t)};R.prototype.rangeHasMark=function e(t,r,n){var i=false;if(r>t){this.nodesBetween(t,r,function(e){if(n.isInSet(e.marks)){i=true}return!i})}return i};F.isBlock.get=function(){return this.type.isBlock};F.isTextblock.get=function(){return this.type.isTextblock};F.inlineContent.get=function(){return this.type.inlineContent};F.isInline.get=function(){return this.type.isInline};F.isText.get=function(){return this.type.isText};F.isLeaf.get=function(){return this.type.isLeaf};F.isAtom.get=function(){return this.type.isAtom};R.prototype.toString=function e(){if(this.type.spec.toDebugString){return this.type.spec.toDebugString(this)}var t=this.type.name;if(this.content.size){t+="("+this.content.toStringInner()+")"}return B(this.marks,t)};R.prototype.contentMatchAt=function e(t){var r=this.type.contentMatch.matchFragment(this.content,0,t);if(!r){throw new Error("Called contentMatchAt on a node with invalid content")}return r};R.prototype.canReplace=function e(t,r,n,i,a){if(n===void 0)n=s.empty;if(i===void 0)i=0;if(a===void 0)a=n.childCount;var o=this.contentMatchAt(t).matchFragment(n,i,a);var u=o&&o.matchFragment(this.content,r);if(!u||!u.validEnd){return false}for(var c=i;c<a;c++){if(!this.type.allowsMarks(n.child(c).marks)){return false}}return true};R.prototype.canReplaceWith=function e(t,r,n,i){if(i&&!this.type.allowsMarks(i)){return false}var a=this.contentMatchAt(t).matchType(n);var o=a&&a.matchFragment(this.content,r);return o?o.validEnd:false};R.prototype.canAppend=function e(t){if(t.content.size){return this.canReplace(this.childCount,this.childCount,t.content)}else{return this.type.compatibleContent(t.type)}};R.prototype.check=function e(){if(!this.type.validContent(this.content)){throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50))}this.content.forEach(function(e){return e.check()})};R.prototype.toJSON=function e(){var t={type:this.type.name};for(var r in this.attrs){t.attrs=this.attrs;break}if(this.content.size){t.content=this.content.toJSON()}if(this.marks.length){t.marks=this.marks.map(function(e){return e.toJSON()})}return t};R.fromJSON=function e(t,r){if(!r){throw new RangeError("Invalid input for Node.fromJSON")}var n=null;if(r.marks){if(!Array.isArray(r.marks)){throw new RangeError("Invalid mark data for Node.fromJSON")}n=r.marks.map(t.markFromJSON)}if(r.type=="text"){if(typeof r.text!="string"){throw new RangeError("Invalid text node in JSON")}return t.text(r.text,n)}var i=s.fromJSON(t,r.content);return t.nodeType(r.type).create(r.attrs,i,n)};Object.defineProperties(R.prototype,F);var q=function(e){function t(t,r,n,i){e.call(this,t,r,null,i);if(!n){throw new RangeError("Empty text nodes are not allowed")}this.text=n}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={textContent:{configurable:true},nodeSize:{configurable:true}};t.prototype.toString=function e(){if(this.type.spec.toDebugString){return this.type.spec.toDebugString(this)}return B(this.marks,JSON.stringify(this.text))};r.textContent.get=function(){return this.text};t.prototype.textBetween=function e(t,r){return this.text.slice(t,r)};r.nodeSize.get=function(){return this.text.length};t.prototype.mark=function e(r){return r==this.marks?this:new t(this.type,this.attrs,this.text,r)};t.prototype.withText=function e(r){if(r==this.text){return this}return new t(this.type,this.attrs,r,this.marks)};t.prototype.cut=function e(t,r){if(t===void 0)t=0;if(r===void 0)r=this.text.length;if(t==0&&r==this.text.length){return this}return this.withText(this.text.slice(t,r))};t.prototype.eq=function e(t){return this.sameMarkup(t)&&this.text==t.text};t.prototype.toJSON=function t(){var r=e.prototype.toJSON.call(this);r.text=this.text;return r};Object.defineProperties(t.prototype,r);return t}(R);function B(e,t){for(var r=e.length-1;r>=0;r--){t=e[r].type.name+"("+t+")"}return t}var V=function e(t){this.validEnd=t;this.next=[];this.wrapCache=[]};var z={inlineContent:{configurable:true},defaultType:{configurable:true},edgeCount:{configurable:true}};V.parse=function e(t,r){var n=new j(t,r);if(n.next==null){return V.empty}var i=G(n);if(n.next){n.err("Unexpected trailing text")}var a=ee(X(i));te(a,n);return a};V.prototype.matchType=function e(t){for(var r=0;r<this.next.length;r+=2){if(this.next[r]==t){return this.next[r+1]}}return null};V.prototype.matchFragment=function e(t,r,n){if(r===void 0)r=0;if(n===void 0)n=t.childCount;var i=this;for(var a=r;i&&a<n;a++){i=i.matchType(t.child(a).type)}return i};z.inlineContent.get=function(){var e=this.next[0];return e?e.isInline:false};z.defaultType.get=function(){for(var e=0;e<this.next.length;e+=2){var t=this.next[e];if(!(t.isText||t.hasRequiredAttrs())){return t}}};V.prototype.compatible=function e(t){for(var r=0;r<this.next.length;r+=2){for(var n=0;n<t.next.length;n+=2){if(this.next[r]==t.next[n]){return true}}}return false};V.prototype.fillBefore=function e(t,r,n){if(r===void 0)r=false;if(n===void 0)n=0;var i=[this];function a(e,o){var u=e.matchFragment(t,n);if(u&&(!r||u.validEnd)){return s.from(o.map(function(e){return e.createAndFill()}))}for(var c=0;c<e.next.length;c+=2){var l=e.next[c],p=e.next[c+1];if(!(l.isText||l.hasRequiredAttrs())&&i.indexOf(p)==-1){i.push(p);var d=a(p,o.concat(l));if(d){return d}}}}return a(this,[])};V.prototype.findWrapping=function e(t){for(var r=0;r<this.wrapCache.length;r+=2){if(this.wrapCache[r]==t){return this.wrapCache[r+1]}}var n=this.computeWrapping(t);this.wrapCache.push(t,n);return n};V.prototype.computeWrapping=function e(t){var r=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){var i=n.shift(),a=i.match;if(a.matchType(t)){var o=[];for(var s=i;s.type;s=s.via){o.push(s.type)}return o.reverse()}for(var u=0;u<a.next.length;u+=2){var c=a.next[u];if(!c.isLeaf&&!c.hasRequiredAttrs()&&!(c.name in r)&&(!i.type||a.next[u+1].validEnd)){n.push({match:c.contentMatch,type:c,via:i});r[c.name]=true}}}};z.edgeCount.get=function(){return this.next.length>>1};V.prototype.edge=function e(t){var r=t<<1;if(r>=this.next.length){throw new RangeError("There's no "+t+"th edge in this content match")}return{type:this.next[r],next:this.next[r+1]}};V.prototype.toString=function e(){var t=[];function r(e){t.push(e);for(var n=1;n<e.next.length;n+=2){if(t.indexOf(e.next[n])==-1){r(e.next[n])}}}r(this);return t.map(function(e,r){var n=r+(e.validEnd?"*":" ")+" ";for(var i=0;i<e.next.length;i+=2){n+=(i?", ":"")+e.next[i].name+"->"+t.indexOf(e.next[i+1])}return n}).join("\n")};Object.defineProperties(V.prototype,z);V.empty=new V(true);var j=function e(t,r){this.string=t;this.nodeTypes=r;this.inline=null;this.pos=0;this.tokens=t.split(/\s*(?=\b|\W|$)/);if(this.tokens[this.tokens.length-1]==""){this.tokens.pop()}if(this.tokens[0]==""){this.tokens.unshift()}};var U={next:{configurable:true}};U.next.get=function(){return this.tokens[this.pos]};j.prototype.eat=function e(t){return this.next==t&&(this.pos++||true)};j.prototype.err=function e(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")};Object.defineProperties(j.prototype,U);function G(e){var t=[];do{t.push(W(e))}while(e.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function W(e){var t=[];do{t.push(K(e))}while(e.next&&e.next!=")"&&e.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function K(e){var t=$(e);for(;;){if(e.eat("+")){t={type:"plus",expr:t}}else if(e.eat("*")){t={type:"star",expr:t}}else if(e.eat("?")){t={type:"opt",expr:t}}else if(e.eat("{")){t=J(e,t)}else{break}}return t}function H(e){if(/\D/.test(e.next)){e.err("Expected number, got '"+e.next+"'")}var t=Number(e.next);e.pos++;return t}function J(e,t){var r=H(e),n=r;if(e.eat(",")){if(e.next!="}"){n=H(e)}else{n=-1}}if(!e.eat("}")){e.err("Unclosed braced range")}return{type:"range",min:r,max:n,expr:t}}function Y(e,t){var r=e.nodeTypes,n=r[t];if(n){return[n]}var i=[];for(var a in r){var o=r[a];if(o.groups.indexOf(t)>-1){i.push(o)}}if(i.length==0){e.err("No node type or group '"+t+"' found")}return i}function $(e){if(e.eat("(")){var t=G(e);if(!e.eat(")")){e.err("Missing closing paren")}return t}else if(!/\W/.test(e.next)){var r=Y(e,e.next).map(function(t){if(e.inline==null){e.inline=t.isInline}else if(e.inline!=t.isInline){e.err("Mixing inline and block content")}return{type:"name",value:t}});e.pos++;return r.length==1?r[0]:{type:"choice",exprs:r}}else{e.err("Unexpected token '"+e.next+"'")}}function X(e){var t=[[]];i(a(e,0),r());return t;function r(){return t.push([])-1}function n(e,r,n){var i={term:n,to:r};t[e].push(i);return i}function i(e,t){e.forEach(function(e){return e.to=t})}function a(e,t){if(e.type=="choice"){return e.exprs.reduce(function(e,r){return e.concat(a(r,t))},[])}else if(e.type=="seq"){for(var o=0;;o++){var s=a(e.exprs[o],t);if(o==e.exprs.length-1){return s}i(s,t=r())}}else if(e.type=="star"){var u=r();n(t,u);i(a(e.expr,u),u);return[n(u)]}else if(e.type=="plus"){var c=r();i(a(e.expr,t),c);i(a(e.expr,c),c);return[n(c)]}else if(e.type=="opt"){return[n(t)].concat(a(e.expr,t))}else if(e.type=="range"){var l=t;for(var p=0;p<e.min;p++){var d=r();i(a(e.expr,l),d);l=d}if(e.max==-1){i(a(e.expr,l),l)}else{for(var f=e.min;f<e.max;f++){var h=r();n(l,h);i(a(e.expr,l),h);l=h}}return[n(l)]}else if(e.type=="name"){return[n(t,null,e.value)]}}}function Z(e,t){return t-e}function Q(e,t){var r=[];n(t);return r.sort(Z);function n(t){var i=e[t];if(i.length==1&&!i[0].term){return n(i[0].to)}r.push(t);for(var a=0;a<i.length;a++){var o=i[a];var s=o.term;var u=o.to;if(!s&&r.indexOf(u)==-1){n(u)}}}}function ee(e){var t=Object.create(null);return r(Q(e,0));function r(n){var i=[];n.forEach(function(t){e[t].forEach(function(t){var r=t.term;var n=t.to;if(!r){return}var a=i.indexOf(r),o=a>-1&&i[a+1];Q(e,n).forEach(function(e){if(!o){i.push(r,o=[])}if(o.indexOf(e)==-1){o.push(e)}})})});var a=t[n.join(",")]=new V(n.indexOf(e.length-1)>-1);for(var o=0;o<i.length;o+=2){var s=i[o+1].sort(Z);a.next.push(i[o],t[s.join(",")]||r(s))}return a}}function te(e,t){for(var r=0,n=[e];r<n.length;r++){var i=n[r],a=!i.validEnd,o=[];for(var s=0;s<i.next.length;s+=2){var u=i.next[s],c=i.next[s+1];o.push(u.name);if(a&&!(u.isText||u.hasRequiredAttrs())){a=false}if(n.indexOf(c)==-1){n.push(c)}}if(a){t.err("Only non-generatable nodes ("+o.join(", ")+") in a required position")}}}function re(e){var t=Object.create(null);for(var r in e){var n=e[r];if(!n.hasDefault){return null}t[r]=n.default}return t}function ne(e,t){var r=Object.create(null);for(var n in e){var i=t&&t[n];if(i===undefined){var a=e[n];if(a.hasDefault){i=a.default}else{throw new RangeError("No value supplied for attribute "+n)}}r[n]=i}return r}function ie(e){var t=Object.create(null);if(e){for(var r in e){t[r]=new se(e[r])}}return t}var ae=function e(t,r,n){this.name=t;this.schema=r;this.spec=n;this.groups=n.group?n.group.split(" "):[];this.attrs=ie(n.attrs);this.defaultAttrs=re(this.attrs);this.contentMatch=null;this.markSet=null;this.inlineContent=null;this.isBlock=!(n.inline||t=="text");this.isText=t=="text"};var oe={isInline:{configurable:true},isTextblock:{configurable:true},isLeaf:{configurable:true},isAtom:{configurable:true}};oe.isInline.get=function(){return!this.isBlock};oe.isTextblock.get=function(){return this.isBlock&&this.inlineContent};oe.isLeaf.get=function(){return this.contentMatch==V.empty};oe.isAtom.get=function(){return this.isLeaf||this.spec.atom};ae.prototype.hasRequiredAttrs=function e(){for(var t in this.attrs){if(this.attrs[t].isRequired){return true}}return false};ae.prototype.compatibleContent=function e(t){return this==t||this.contentMatch.compatible(t.contentMatch)};ae.prototype.computeAttrs=function e(t){if(!t&&this.defaultAttrs){return this.defaultAttrs}else{return ne(this.attrs,t)}};ae.prototype.create=function e(t,r,n){if(this.isText){throw new Error("NodeType.create can't construct text nodes")}return new R(this,this.computeAttrs(t),s.from(r),d.setFrom(n))};ae.prototype.createChecked=function e(t,r,n){r=s.from(r);if(!this.validContent(r)){throw new RangeError("Invalid content for node "+this.name)}return new R(this,this.computeAttrs(t),r,d.setFrom(n))};ae.prototype.createAndFill=function e(t,r,n){t=this.computeAttrs(t);r=s.from(r);if(r.size){var i=this.contentMatch.fillBefore(r);if(!i){return null}r=i.append(r)}var a=this.contentMatch.matchFragment(r).fillBefore(s.empty,true);if(!a){return null}return new R(this,t,r.append(a),d.setFrom(n))};ae.prototype.validContent=function e(t){var r=this.contentMatch.matchFragment(t);if(!r||!r.validEnd){return false}for(var n=0;n<t.childCount;n++){if(!this.allowsMarks(t.child(n).marks)){return false}}return true};ae.prototype.allowsMarkType=function e(t){return this.markSet==null||this.markSet.indexOf(t)>-1};ae.prototype.allowsMarks=function e(t){if(this.markSet==null){return true}for(var r=0;r<t.length;r++){if(!this.allowsMarkType(t[r].type)){return false}}return true};ae.prototype.allowedMarks=function e(t){if(this.markSet==null){return t}var r;for(var n=0;n<t.length;n++){if(!this.allowsMarkType(t[n].type)){if(!r){r=t.slice(0,n)}}else if(r){r.push(t[n])}}return!r?t:r.length?r:d.empty};ae.compile=function e(t,r){var n=Object.create(null);t.forEach(function(e,t){return n[e]=new ae(e,r,t)});var i=r.spec.topNode||"doc";if(!n[i]){throw new RangeError("Schema is missing its top node type ('"+i+"')")}if(!n.text){throw new RangeError("Every schema needs a 'text' type")}for(var a in n.text.attrs){throw new RangeError("The text node type should not have attributes")}return n};Object.defineProperties(ae.prototype,oe);var se=function e(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default");this.default=t.default};var ue={isRequired:{configurable:true}};ue.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(se.prototype,ue);var ce=function e(t,r,n,i){this.name=t;this.schema=n;this.spec=i;this.attrs=ie(i.attrs);this.rank=r;this.excluded=null;var a=re(this.attrs);this.instance=a&&new d(this,a)};ce.prototype.create=function e(t){if(!t&&this.instance){return this.instance}return new d(this,ne(this.attrs,t))};ce.compile=function e(t,r){var n=Object.create(null),i=0;t.forEach(function(e,t){return n[e]=new ce(e,i++,r,t)});return n};ce.prototype.removeFromSet=function e(t){for(var r=0;r<t.length;r++){if(t[r].type==this){return t.slice(0,r).concat(t.slice(r+1))}}return t};ce.prototype.isInSet=function e(t){for(var r=0;r<t.length;r++){if(t[r].type==this){return t[r]}}};ce.prototype.excludes=function e(t){return this.excluded.indexOf(t)>-1};var le=function e(t){this.spec={};for(var r in t){this.spec[r]=t[r]}this.spec.nodes=i.from(t.nodes);this.spec.marks=i.from(t.marks);this.nodes=ae.compile(this.spec.nodes,this);this.marks=ce.compile(this.spec.marks,this);var n=Object.create(null);for(var a in this.nodes){if(a in this.marks){throw new RangeError(a+" can not be both a node and a mark")}var o=this.nodes[a],s=o.spec.content||"",u=o.spec.marks;o.contentMatch=n[s]||(n[s]=V.parse(s,this.nodes));o.inlineContent=o.contentMatch.inlineContent;o.markSet=u=="_"?null:u?pe(this,u.split(" ")):u==""||!o.inlineContent?[]:null}for(var c in this.marks){var l=this.marks[c],p=l.spec.excludes;l.excluded=p==null?[l]:p==""?[]:pe(this,p.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this);this.markFromJSON=this.markFromJSON.bind(this);this.topNodeType=this.nodes[this.spec.topNode||"doc"];this.cached=Object.create(null);this.cached.wrappings=Object.create(null)};le.prototype.node=function e(t,r,n,i){if(typeof t=="string"){t=this.nodeType(t)}else if(!(t instanceof ae)){throw new RangeError("Invalid node type: "+t)}else if(t.schema!=this){throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(r,n,i)};le.prototype.text=function e(t,r){var n=this.nodes.text;return new q(n,n.defaultAttrs,t,d.setFrom(r))};le.prototype.mark=function e(t,r){if(typeof t=="string"){t=this.marks[t]}return t.create(r)};le.prototype.nodeFromJSON=function e(t){return R.fromJSON(this,t)};le.prototype.markFromJSON=function e(t){return d.fromJSON(this,t)};le.prototype.nodeType=function e(t){var r=this.nodes[t];if(!r){throw new RangeError("Unknown node type: "+t)}return r};function pe(e,t){var r=[];for(var n=0;n<t.length;n++){var i=t[n],a=e.marks[i],o=a;if(a){r.push(a)}else{for(var s in e.marks){var u=e.marks[s];if(i=="_"||u.spec.group&&u.spec.group.split(" ").indexOf(i)>-1){r.push(o=u)}}}if(!o){throw new SyntaxError("Unknown mark type: '"+t[n]+"'")}}return r}var de=function e(t,r){var n=this;this.schema=t;this.rules=r;this.tags=[];this.styles=[];r.forEach(function(e){if(e.tag){n.tags.push(e)}else if(e.style){n.styles.push(e)}})};de.prototype.parse=function e(t,r){if(r===void 0)r={};var n=new Se(this,r,false);n.addAll(t,null,r.from,r.to);return n.finish()};de.prototype.parseSlice=function e(t,r){if(r===void 0)r={};var n=new Se(this,r,true);n.addAll(t,null,r.from,r.to);return h.maxOpen(n.finish())};de.prototype.matchTag=function e(t,r){for(var n=0;n<this.tags.length;n++){var i=this.tags[n];if(_e(t,i.tag)&&(i.namespace===undefined||t.namespaceURI==i.namespace)&&(!i.context||r.matchesContext(i.context))){if(i.getAttrs){var a=i.getAttrs(t);if(a===false){continue}i.attrs=a}return i}}};de.prototype.matchStyle=function e(t,r,n){for(var i=0;i<this.styles.length;i++){var a=this.styles[i];if(a.style.indexOf(t)!=0||a.context&&!n.matchesContext(a.context)||a.style.length>t.length&&(a.style.charCodeAt(t.length)!=61||a.style.slice(t.length+1)!=r)){continue}if(a.getAttrs){var o=a.getAttrs(r);if(o===false){continue}a.attrs=o}return a}};de.schemaRules=function e(t){var r=[];function n(e){var t=e.priority==null?50:e.priority,n=0;for(;n<r.length;n++){var i=r[n],a=i.priority==null?50:i.priority;if(a<t){break}}r.splice(n,0,e)}var i=function(e){var r=t.marks[e].spec.parseDOM;if(r){r.forEach(function(t){n(t=Ee(t));t.mark=e})}};for(var a in t.marks)i(a);var o=function(e){var r=t.nodes[s].spec.parseDOM;if(r){r.forEach(function(e){n(e=Ee(e));e.node=s})}};for(var s in t.nodes)o();return r};de.fromSchema=function e(t){return t.cached.domParser||(t.cached.domParser=new de(t,de.schemaRules(t)))};var fe={address:true,article:true,aside:true,blockquote:true,canvas:true,dd:true,div:true,dl:true,fieldset:true,figcaption:true,figure:true,footer:true,form:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,header:true,hgroup:true,hr:true,li:true,noscript:true,ol:true,output:true,p:true,pre:true,section:true,table:true,tfoot:true,ul:true};var he={head:true,noscript:true,object:true,script:true,style:true,title:true};var ye={ol:true,ul:true};var me=1,ve=2,ge=4;function be(e){return(e?me:0)|(e==="full"?ve:0)}var xe=function e(t,r,n,i,a,o,s){this.type=t;this.attrs=r;this.solid=a;this.match=o||(s&ge?null:t.contentMatch);this.options=s;this.content=[];this.marks=n;this.activeMarks=d.none;this.pendingMarks=i};xe.prototype.findWrapping=function e(t){if(!this.match){if(!this.type){return[]}var r=this.type.contentMatch.fillBefore(s.from(t));if(r){this.match=this.type.contentMatch.matchFragment(r)}else{var n=this.type.contentMatch,i;if(i=n.findWrapping(t.type)){this.match=n;return i}else{return null}}}return this.match.findWrapping(t.type)};xe.prototype.finish=function e(t){if(!(this.options&me)){var r=this.content[this.content.length-1],n;if(r&&r.isText&&(n=/[ \t\r\n\u000c]+$/.exec(r.text))){if(r.text.length==n[0].length){this.content.pop()}else{this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-n[0].length))}}}var i=s.from(this.content);if(!t&&this.match){i=i.append(this.match.fillBefore(s.empty,true))}return this.type?this.type.create(this.attrs,i,this.marks):i};xe.prototype.applyPending=function e(t){for(var r=0,n=this.pendingMarks;r<n.length;r++){var i=n[r];if((this.type?this.type.allowsMarkType(i.type):Ce(i.type,t))&&!i.isInSet(this.activeMarks)){this.activeMarks=i.addToSet(this.activeMarks);this.pendingMarks=i.removeFromSet(this.pendingMarks)}}};var Se=function e(t,r,n){this.parser=t;this.options=r;this.isOpen=n;var i=r.topNode,a;var o=be(r.preserveWhitespace)|(n?ge:0);if(i){a=new xe(i.type,i.attrs,d.none,d.none,true,r.topMatch||i.type.contentMatch,o)}else if(n){a=new xe(null,null,d.none,d.none,true,null,o)}else{a=new xe(t.schema.topNodeType,null,d.none,d.none,true,null,o)}this.nodes=[a];this.open=0;this.find=r.findPositions;this.needsBlock=false};var Te={top:{configurable:true},currentPos:{configurable:true}};Te.top.get=function(){return this.nodes[this.open]};Se.prototype.addDOM=function e(t){if(t.nodeType==3){this.addTextNode(t)}else if(t.nodeType==1){var r=t.getAttribute("style");var n=r?this.readStyles(Ie(r)):null,i=this.top;if(n!=null){for(var a=0;a<n.length;a++){this.addPendingMark(n[a])}}this.addElement(t);if(n!=null){for(var o=0;o<n.length;o++){this.removePendingMark(n[o],i)}}}};Se.prototype.addTextNode=function e(t){var r=t.nodeValue;var n=this.top;if((n.type?n.type.inlineContent:n.content.length&&n.content[0].isInline)||/[^ \t\r\n\u000c]/.test(r)){if(!(n.options&me)){r=r.replace(/[ \t\r\n\u000c]+/g," ");if(/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){var i=n.content[n.content.length-1];var a=t.previousSibling;if(!i||a&&a.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text)){r=r.slice(1)}}}else if(!(n.options&ve)){r=r.replace(/\r?\n|\r/g," ")}if(r){this.insertNode(this.parser.schema.text(r))}this.findInText(t)}else{this.findInside(t)}};Se.prototype.addElement=function e(t){var r=t.nodeName.toLowerCase();if(ye.hasOwnProperty(r)){we(t)}var n=this.options.ruleFromNode&&this.options.ruleFromNode(t)||this.parser.matchTag(t,this);if(n?n.ignore:he.hasOwnProperty(r)){this.findInside(t)}else if(!n||n.skip){if(n&&n.skip.nodeType){t=n.skip}var i,a=this.top,o=this.needsBlock;if(fe.hasOwnProperty(r)){i=true;if(!a.type){this.needsBlock=true}}else if(!t.firstChild){this.leafFallback(t);return}this.addAll(t);if(i){this.sync(a)}this.needsBlock=o}else{this.addElementByRule(t,n)}};Se.prototype.leafFallback=function e(t){if(t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent){this.addTextNode(t.ownerDocument.createTextNode("\n"))}};Se.prototype.readStyles=function e(t){var r=d.none;for(var n=0;n<t.length;n+=2){var i=this.parser.matchStyle(t[n],t[n+1],this);if(!i){continue}if(i.ignore){return null}r=this.parser.schema.marks[i.mark].create(i.attrs).addToSet(r)}return r};Se.prototype.addElementByRule=function e(t,r){var n=this;var i,a,o,s;if(r.node){a=this.parser.schema.nodes[r.node];if(!a.isLeaf){i=this.enter(a,r.attrs,r.preserveWhitespace)}else if(!this.insertNode(a.create(r.attrs))){this.leafFallback(t)}}else{o=this.parser.schema.marks[r.mark];s=o.create(r.attrs);this.addPendingMark(s)}var u=this.top;if(a&&a.isLeaf){this.findInside(t)}else if(r.getContent){this.findInside(t);r.getContent(t,this.parser.schema).forEach(function(e){return n.insertNode(e)})}else{var c=r.contentElement;if(typeof c=="string"){c=t.querySelector(c)}else if(typeof c=="function"){c=c(t)}if(!c){c=t}this.findAround(t,c,true);this.addAll(c,i)}if(i){this.sync(u);this.open--}if(s){this.removePendingMark(s,u)}};Se.prototype.addAll=function e(t,r,n,i){var a=n||0;for(var o=n?t.childNodes[n]:t.firstChild,s=i==null?null:t.childNodes[i];o!=s;o=o.nextSibling,++a){this.findAtPoint(t,a);this.addDOM(o);if(r&&fe.hasOwnProperty(o.nodeName.toLowerCase())){this.sync(r)}}this.findAtPoint(t,a)};Se.prototype.findPlace=function e(t){var r,n;for(var i=this.open;i>=0;i--){var a=this.nodes[i];var o=a.findWrapping(t);if(o&&(!r||r.length>o.length)){r=o;n=a;if(!o.length){break}}if(a.solid){break}}if(!r){return false}this.sync(n);for(var s=0;s<r.length;s++){this.enterInner(r[s],null,false)}return true};Se.prototype.insertNode=function e(t){if(t.isInline&&this.needsBlock&&!this.top.type){var r=this.textblockFromContext();if(r){this.enterInner(r)}}if(this.findPlace(t)){this.closeExtra();var n=this.top;n.applyPending(t.type);if(n.match){n.match=n.match.matchType(t.type)}var i=n.activeMarks;for(var a=0;a<t.marks.length;a++){if(!n.type||n.type.allowsMarkType(t.marks[a].type)){i=t.marks[a].addToSet(i)}}n.content.push(t.mark(i));return true}return false};Se.prototype.enter=function e(t,r,n){var i=this.findPlace(t.create(r));if(i){this.enterInner(t,r,true,n)}return i};Se.prototype.enterInner=function e(t,r,n,i){this.closeExtra();var a=this.top;a.applyPending(t);a.match=a.match&&a.match.matchType(t,r);var o=i==null?a.options&~ge:be(i);if(a.options&ge&&a.content.length==0){o|=ge}this.nodes.push(new xe(t,r,a.activeMarks,a.pendingMarks,n,null,o));this.open++};Se.prototype.closeExtra=function e(t){var r=this.nodes.length-1;if(r>this.open){for(;r>this.open;r--){this.nodes[r-1].content.push(this.nodes[r].finish(t))}this.nodes.length=this.open+1}};Se.prototype.finish=function e(){this.open=0;this.closeExtra(this.isOpen);return this.nodes[0].finish(this.isOpen||this.options.topOpen)};Se.prototype.sync=function e(t){for(var r=this.open;r>=0;r--){if(this.nodes[r]==t){this.open=r;return}}};Te.currentPos.get=function(){this.closeExtra();var e=0;for(var t=this.open;t>=0;t--){var r=this.nodes[t].content;for(var n=r.length-1;n>=0;n--){e+=r[n].nodeSize}if(t){e++}}return e};Se.prototype.findAtPoint=function e(t,r){if(this.find){for(var n=0;n<this.find.length;n++){if(this.find[n].node==t&&this.find[n].offset==r){this.find[n].pos=this.currentPos}}}};Se.prototype.findInside=function e(t){if(this.find){for(var r=0;r<this.find.length;r++){if(this.find[r].pos==null&&t.nodeType==1&&t.contains(this.find[r].node)){this.find[r].pos=this.currentPos}}}};Se.prototype.findAround=function e(t,r,n){if(t!=r&&this.find){for(var i=0;i<this.find.length;i++){if(this.find[i].pos==null&&t.nodeType==1&&t.contains(this.find[i].node)){var a=r.compareDocumentPosition(this.find[i].node);if(a&(n?2:4)){this.find[i].pos=this.currentPos}}}}};Se.prototype.findInText=function e(t){if(this.find){for(var r=0;r<this.find.length;r++){if(this.find[r].node==t){this.find[r].pos=this.currentPos-(t.nodeValue.length-this.find[r].offset)}}}};Se.prototype.matchesContext=function e(t){var r=this;if(t.indexOf("|")>-1){return t.split(/\s*\|\s*/).some(this.matchesContext,this)}var n=t.split("/");var i=this.options.context;var a=!this.isOpen&&(!i||i.parent.type==this.nodes[0].type);var o=-(i?i.depth+1:0)+(a?0:1);var s=function(e,t){for(;e>=0;e--){var u=n[e];if(u==""){if(e==n.length-1||e==0){continue}for(;t>=o;t--){if(s(e-1,t)){return true}}return false}else{var c=t>0||t==0&&a?r.nodes[t].type:i&&t>=o?i.node(t-o).type:null;if(!c||c.name!=u&&c.groups.indexOf(u)==-1){return false}t--}}return true};return s(n.length-1,this.open)};Se.prototype.textblockFromContext=function e(){var t=this.options.context;if(t){for(var r=t.depth;r>=0;r--){var n=t.node(r).contentMatchAt(t.indexAfter(r)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs){return n}}}for(var i in this.parser.schema.nodes){var a=this.parser.schema.nodes[i];if(a.isTextblock&&a.defaultAttrs){return a}}};Se.prototype.addPendingMark=function e(t){this.top.pendingMarks=t.addToSet(this.top.pendingMarks)};Se.prototype.removePendingMark=function e(t,r){for(var n=this.open;n>=0;n--){var i=this.nodes[n];var a=i.pendingMarks.lastIndexOf(t);if(a>-1){i.pendingMarks=t.removeFromSet(i.pendingMarks)}else{i.activeMarks=t.removeFromSet(i.activeMarks)}if(i==r){break}}};Object.defineProperties(Se.prototype,Te);function we(e){for(var t=e.firstChild,r=null;t;t=t.nextSibling){var n=t.nodeType==1?t.nodeName.toLowerCase():null;if(n&&ye.hasOwnProperty(n)&&r){r.appendChild(t);t=r}else if(n=="li"){r=t}else if(n){r=null}}}function _e(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function Ie(e){var t=/\s*([\w-]+)\s*:\s*([^;]+)/g,r,n=[];while(r=t.exec(e)){n.push(r[1],r[2].trim())}return n}function Ee(e){var t={};for(var r in e){t[r]=e[r]}return t}function Ce(e,t){var r=t.schema.nodes;var n=function(n){var i=r[n];if(!i.allowsMarkType(e)){return}var a=[],o=function(e){a.push(e);for(var r=0;r<e.edgeCount;r++){var n=e.edge(r);var i=n.type;var s=n.next;if(i==t){return true}if(a.indexOf(s)<0&&o(s)){return true}}};if(o(i.contentMatch)){return{v:true}}};for(var i in r){var a=n(i);if(a)return a.v}}var Me=function e(t,r){this.nodes=t||{};this.marks=r||{}};Me.prototype.serializeFragment=function e(t,r,n){var i=this;if(r===void 0)r={};if(!n){n=Pe(r).createDocumentFragment()}var a=n,o=null;t.forEach(function(e){if(o||e.marks.length){if(!o){o=[]}var t=0,n=0;while(t<o.length&&n<e.marks.length){var s=e.marks[n];if(!i.marks[s.type.name]){n++;continue}if(!s.eq(o[t])||s.type.spec.spanning===false){break}t+=2;n++}while(t<o.length){a=o.pop();o.pop()}while(n<e.marks.length){var u=e.marks[n++];var c=i.serializeMark(u,e.isInline,r);if(c){o.push(u,a);a.appendChild(c.dom);a=c.contentDOM||c.dom}}}a.appendChild(i.serializeNode(e,r))});return n};Me.prototype.serializeNode=function e(t,r){if(r===void 0)r={};var n=Me.renderSpec(Pe(r),this.nodes[t.type.name](t));var i=n.dom;var a=n.contentDOM;if(a){if(t.isLeaf){throw new RangeError("Content hole not allowed in a leaf node spec")}if(r.onContent){r.onContent(t,a,r)}else{this.serializeFragment(t.content,r,a)}}return i};Me.prototype.serializeNodeAndMarks=function e(t,r){if(r===void 0)r={};var n=this.serializeNode(t,r);for(var i=t.marks.length-1;i>=0;i--){var a=this.serializeMark(t.marks[i],t.isInline,r);if(a){(a.contentDOM||a.dom).appendChild(n);n=a.dom}}return n};Me.prototype.serializeMark=function e(t,r,n){if(n===void 0)n={};var i=this.marks[t.type.name];return i&&Me.renderSpec(Pe(n),i(t,r))};Me.renderSpec=function e(t,r,n){if(n===void 0)n=null;if(typeof r=="string"){return{dom:t.createTextNode(r)}}if(r.nodeType!=null){return{dom:r}}var i=r[0],a=i.indexOf(" ");if(a>0){n=i.slice(0,a);i=i.slice(a+1)}var o=null,s=n?t.createElementNS(n,i):t.createElement(i);var u=r[1],c=1;if(u&&typeof u=="object"&&u.nodeType==null&&!Array.isArray(u)){c=2;for(var l in u){if(u[l]!=null){var p=l.indexOf(" ");if(p>0){s.setAttributeNS(l.slice(0,p),l.slice(p+1),u[l])}else{s.setAttribute(l,u[l])}}}}for(var d=c;d<r.length;d++){var f=r[d];if(f===0){if(d<r.length-1||d>c){throw new RangeError("Content hole must be the only child of its parent node")}return{dom:s,contentDOM:s}}else{var h=Me.renderSpec(t,f,n);var y=h.dom;var m=h.contentDOM;s.appendChild(y);if(m){if(o){throw new RangeError("Multiple content holes")}o=m}}}return{dom:s,contentDOM:o}};Me.fromSchema=function e(t){return t.cached.domSerializer||(t.cached.domSerializer=new Me(this.nodesFromSchema(t),this.marksFromSchema(t)))};Me.nodesFromSchema=function e(t){var r=ke(t.nodes);if(!r.text){r.text=function(e){return e.text}}return r};Me.marksFromSchema=function e(t){return ke(t.marks)};function ke(e){var t={};for(var r in e){var n=e[r].spec.toDOM;if(n){t[r]=n}}return t}function Pe(e){return e.document||window.document}t.ContentMatch=V;t.DOMParser=de;t.DOMSerializer=Me;t.Fragment=s;t.Mark=d;t.MarkType=ce;t.Node=R;t.NodeRange=N;t.NodeType=ae;t.ReplaceError=f;t.ResolvedPos=M;t.Schema=le;t.Slice=h});define("prosemirror-model",["prosemirror-model/index"],function(e){return e});define("core/prosemirror/prosemirror-serialize",["require","exports","./prosemirror-helpers","prosemirror-model"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.stringToBlockNodes=t.stringToNodes=t.stringToNode=t.stringToSerializedNode=t.serializedNodeToString=t.nodeToString=t.hasNonWhitespaceContentJSON=t.hasNonWhitespaceContent=t.MD_LINK_REGEX=t.RAW_LINK_REGEX=t.INTERP_REGEX=t.MQ_REGEX=void 0;t.MQ_REGEX=/`[^`]*`/gi;t.INTERP_REGEX=/\$\{[^\}]*\}/gi;t.RAW_LINK_REGEX=/(\bhttps?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|])/gi;t.MD_LINK_REGEX=/\[([^\[\]]+)\]\((https?:\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[A-Z0-9+&@#\/%=~_|])\)/gi;function i(e){if(e.text&&e.text.trim().length>0)return true;if(e.isLeaf)return false;for(var t=0;t<e.childCount;t++){if(i(e.child(t)))return true}return false}t.hasNonWhitespaceContent=i;function a(e,t){if(t===void 0){t={}}if(e.text&&e.text.trim().length>0)return true;if(!!t.includeInterpNodesAsContent&&e.type==="interp"){return true}if(!e.content)return false;for(var r=0;r<e.content.length;r++){var n=e.content[r];if(n&&a(n,t))return true}return false}t.hasNonWhitespaceContentJSON=a;var o=function(e){if(e.isLeaf){return e.textContent}else{var r=[];e.content.forEach(function(e){r.push(t.nodeToString(e))});var n=void 0;if(e.type.name=="doc"){n=r.join("\n")}else{n=r.join("")}if(e.type.name=="mq"&&n.length){n="`"+n+"`"}return n}};t.nodeToString=o;var s=function(e){if(e.text){return e.text}else{var r=[];if(!e.content)return"";e.content.forEach(function(e){r.push(t.serializedNodeToString(e))});var n=void 0;if(e.type=="doc"){n=r.join("\n")}else{n=r.join("")}if(e.type=="mq"&&n.length){n="`"+n+"`"}if(e.type=="list_item"){n="   "+n}if(e.type==="bullet_list"){n=n.split("").join("\n").trim()}return n}};t.serializedNodeToString=s;var u=function(e,n){if(n===void 0){n=true}var i=e.split("\n").map(function(e){var i=[];r.splitOnRegex(e,t.MQ_REGEX).forEach(function(e){if(e.matched&&n){var t=void 0;if(e.text.length>2){t={type:"text",text:e.text.substr(1,e.text.length-2)};i.push({type:"mq",content:[t]})}}else{i.push({type:"text",text:e.text})}});return{type:"paragraph",content:i}});return{type:"doc",content:i}};t.stringToSerializedNode=u;var c=function(e,r){return n.Node.fromJSON(r,t.stringToSerializedNode(e,!!r.nodes.mq))};t.stringToNode=c;function l(e,t,n){var i=[[]];var a=0;e.forEach(function(e){if(e.isText&&e.text.indexOf("\n")!==-1){r.splitOnRegex(e.text,/\n/g).forEach(function(e){if(e.matched){i.push([]);a++}else{i[a].push(t.text(e.text))}})}else{i[a].push(e)}});var o=[];for(var s=0,u=i;s<u.length;s++){var c=u[s];var l=n?n.type:"paragraph";var p=t.nodes[l].create(undefined,c);if(n){p.attrs=n.attrs}o.push(p)}return o}function p(e,t){var r;if(e.length>2){r=t.text(e.substr(1,e.length-2))}return t.nodes.mq.create(undefined,r)}function d(e,t){var r=e.slice(2,e.length-1);return t.nodes.interp.create({interpExpr:r})}function f(e,t){var r=e.split("](");var n=r[0].slice(1);var i=r[1].slice(0,-1);var a=t.marks["link"].create({href:i});return t.text(n).mark([a])}function h(e,t){var r=t.marks["link"].create({href:e});return t.text(e).mark([r])}var y=function(e,n,i){if(!i){i=n}var a=[{name:"mq",regex:t.MQ_REGEX,create:p}];if(i.nodes.interp){a.push({name:"interp",regex:t.INTERP_REGEX,create:d})}if(!!i.marks["link"]){a.push({name:"link",regex:t.MD_LINK_REGEX,create:f});a.push({name:"link",regex:t.RAW_LINK_REGEX,create:h})}function o(e,t){if(t===void 0){t=0}var i=[];r.splitOnRegex(e,a[t].regex).forEach(function(e){if(e.matched){try{i.push(a[t].create(e.text,n))}catch(e){throw new Error("Could not serialize "+a[t].name+" as it is not on the outputSchema")}}else{if(t+1<a.length){i=i.concat(o(e.text,t+1))}else{i.push(n.text(e.text))}}});return i}return o(e)};t.stringToNodes=y;var m=function(e,r,n,i){var a=t.stringToNodes(e,r,n);return l(a,r,i)};t.stringToBlockNodes=m});define("core/components/text-exhibit/index",["require","exports","core/computation-layer/helpers","core/prosemirror/prosemirror-serialize"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(e){var t=e.config,i=e.sinks;var a;var o=i.content&&i.content[0];if(o){a=n.stringToSerializedNode(o.value?r.synthesizeStringForContent(o.value):"")}else if(t.doc){a=JSON.parse(t.doc)}else if(t.text){a=n.stringToSerializedNode(t.text)}else{a=n.stringToSerializedNode("")}return{content:a}},hasResponse:function(){return false},getAssetUrls:function(){return[]},rewriteAssetUrls:function(e){return e}}});define("core/components/geometry/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(e){return!!(e&&e.imgData)},getAssetUrls:function(){return[]},rewriteAssetUrls:function(e){return e}}});define("core/computation-layer/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.convertSinkList=t.ComponentSinkSpecification=t.NewSinkSpec=void 0;var r=function(){function e(e,t,r,n,i,a){this.name=e;this.analyzeValueType=t;this.params=r;this.description=n;this.deprecated=i;this.internal=a}return e}();t.NewSinkSpec=r;var n=function(){function e(){this.sinkMap={}}e.prototype.registerSinkSpec=function(e){this.sinkMap[e.name]=e;return this};e.prototype.registerSinksFrom=function(e){for(var t in e.sinkMap){this.registerSinkSpec(e.sinkMap[t])}return this};e.prototype.getSinkSpec=function(e){return this.sinkMap[e]};e.prototype.getAvailableSinksMessage=function(){var e=this.getAvailableSinks();return e.length==0?"There's no way to control this component with CL yet.":"Valid sinks: "+e.join(", ")};e.prototype.getAvailableSinks=function(){return Object.keys(this.sinkMap)};return e}();t.ComponentSinkSpecification=n;function i(e){var t=new n;for(var i in e){var a=e[i];t.registerSinkSpec(new r(i,a.analyzeValueType.type=="concrete"?{type:"concrete",validator:a.analyzeValueType.valueType}:a.analyzeValueType,a.params||[],a.description,a.deprecated,a.internal))}return t}t.convertSinkList=i});define("core/computation-layer/cl-types",["require","exports","tslib"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.assertType=t.Types=t.getComponentScriptType=t.ComponentScriptType=t.getComponentType=t.ComponentType=t.getFunctionType=t.FunctionType=t.CLType=t.reinflateSinkTypes=t.reinflateType=t.makeDummyNamedTypeForTestsOnly=void 0;function n(e){return s.create(e)}t.makeDummyNamedTypeForTestsOnly=n;function i(e){if(!e){return true}return Object.keys(e).length==0}function a(e){var r=e.type,n=e.params;if(t.Types.hasOwnProperty(r)&&i(n))return t.Types[r];if(r=="function"){return c(n)}if(r=="component"){return p(n)}if(r=="componentScript"){return f(n)}throw new Error("Asked to inflate unexpected type "+r+" with params "+JSON.stringify(n))}t.reinflateType=a;function o(e){var t={};for(var n in e){t[n]=[];for(var i=0,o=e[n];i<o.length;i++){var s=o[i];t[n].push(r.__assign(r.__assign({},s),{valueType:a(s.valueType)}))}}return t}t.reinflateSinkTypes=o;var s=function(){function e(e){this.type=e}e.prototype.matches=function(t){if(t==undefined)throw new Error("Cannot type-check against undefined");if(!(t instanceof e))throw new Error("Cannot type-check against non CLType object"+JSON.stringify(t,null,2));return this===t};e.prototype.toString=function(){if(this.params==undefined)return this.type;return this.type+"<"+JSON.stringify(this.params)+">"};e.create=function(t){if(!this.typeCache[t]){this.typeCache[t]=new e(t)}return this.typeCache[t]};e.typeCache={};return e}();t.CLType=s;var u=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"function")||this;r.params=t;return r}t.get=function(e){var r=e.numVars;if(this.functionTypeCache[r]==undefined){this.functionTypeCache[r]=new t(e)}return this.functionTypeCache[r]};t.functionTypeCache={1:new t({numVars:1}),2:new t({numVars:2})};return t}(s);t.FunctionType=u;function c(e){return u.get(e)}t.getFunctionType=c;var l=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"component")||this;r.params=t;return r}t.get=function(e){var r=e.componentId;if(this.componentTypeCache[r]==undefined){this.componentTypeCache[r]=new t(e)}return this.componentTypeCache[r]};t.componentTypeCache={};return t}(s);t.ComponentType=l;function p(e){return l.get(e)}t.getComponentType=p;var d=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"componentScript")||this;r.params=t;return r}t.get=function(e){var r=e.componentId;if(this.componentScriptTypeCache[r]==undefined){this.componentScriptTypeCache[r]=new t(e)}return this.componentScriptTypeCache[r]};t.componentScriptTypeCache={};return t}(s);t.ComponentScriptType=d;function f(e){return d.get(e)}t.getComponentScriptType=f;t.Types={number:s.create("number"),string:s.create("string"),latex:s.create("latex"),bounds:s.create("bounds"),boundsStrategy:s.create("boundsStrategy"),layer:s.create("layer"),xyLine:s.create("xyLine"),orderedPair:s.create("orderedPair"),equation:s.create("equation"),inequality:s.create("inequality"),boolean:s.create("boolean"),color:s.create("color"),colorPalette:s.create("colorPalette"),colorList:s.create("colorList"),sketch:s.create("sketch"),numberList:s.create("numberList"),function1:c({numVars:1}),function2:c({numVars:2}),calculatorStateWithSinkValues:s.create("calculatorStateWithSinkValues"),randomGenerator:s.create("randomGenerator"),response:s.create("response"),sketchTool:s.create("sketchTool"),sketchTools:s.create("sketchTools"),buttonStyle:s.create("buttonStyle"),buttonStyles:s.create("buttonStyles"),patternLibrary:s.create("patternLibrary"),numberPattern:s.create("numberPattern"),numberPatternMatch:s.create("numberPatternMatch"),mixedNumberPattern:s.create("mixedNumberPattern"),mixedNumberPatternMatch:s.create("mixedNumberPatternMatch"),literalPattern:s.create("literalPattern"),literalPatternMatch:s.create("literalPatternMatch"),expressionPattern:s.create("expressionPattern"),expressionPatternMatch:s.create("expressionPatternMatch"),orPattern:s.create("orPattern"),orPatternMatch:s.create("orPatternMatch"),scientificPattern:s.create("scientificPattern"),scientificPatternMatch:s.create("scientificPatternMatch"),partialInterpolation:s.create("partialInterpolation"),calculatorPopulatedFrame:s.create("calculatorPopulatedFrame"),score:s.create("score"),scores:s.create("scores")};function h(e,t,r){if(e.matches(t))return;throw new Error(r||"Expected "+e.toString()+", but got "+t.toString())}t.assertType=h});define("core/components/shared/reset-on-change-sink",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.componentWasReset=t.resetOnChangeSink=void 0;t.resetOnChangeSink=n.convertSinkList({resetOnChange:{description:function(){return r.i18n.s("cl-docs-description-reset-on-change")},analyzeValueType:{type:"concrete",valueType:i.Types.string}}});function a(e){return!!e&&!!e.wasReset}t.componentWasReset=a});define("core/components/expression-input/index",["require","exports","../component-helpers","../shared/reset-on-change-sink"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(e){if(e.clCorrectness===undefined||e.clCorrectness&&!!e.config.explainResponse){return"ungraded"}if(!i(e.response)){return"incomplete"}if(e.clCorrectness){return"correct"}return"incorrect"},componentWasReset:n.componentWasReset,getComponentState:function(e){var t,n;var i=e.response,a=e.config,o=e.sinks;var s=i!=undefined?i.latex:undefined;var u=o.initialLatex;var c=s!=undefined?s:u&&((n=(t=u[0])===null||t===void 0?void 0:t.value)===null||n===void 0?void 0:n.latex)||"";var l={content:c};if(!a.explainResponse){return l}var p=i!=undefined?i.explainText:undefined;l.explainContent=r.getResponseOrInitialText(p,o.initialText);return l},hasResponse:i,getAssetUrls:function(){return[]},rewriteAssetUrls:function(e){return e}};function i(e){if(!e)return false;for(var t in e["expression-history"]){if(e["expression-history"][t].length)return true}for(var t in e.history){if(e.history[t].length)return true}return!!(e.latex&&e.latex.trim().length)}});define("core/components/shared/correctness-sinks",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getHasResponseSink=t.hasReponseSink=t.correctnessSinks=void 0;t.correctnessSinks=n.convertSinkList({correct:{description:function(){return r.i18n.s("cl-docs-description-correctness-correct")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean}},warning:{description:function(){return r.i18n.s("cl-docs-description-correctness-warning")},analyzeValueType:{type:"concrete",valueType:i.Types.string}},readOnly:{description:function(){return r.i18n.s("cl-docs-description-correctness-read-only")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean}},export:{description:function(){return r.i18n.raw("Data to include in CSV export to summarize this component")},analyzeValueType:{type:"concrete",valueType:i.Types.string},internal:true,params:[{name:"heading",type:i.Types.string}]}});t.hasReponseSink=n.convertSinkList({hasResponse:{analyzeValueType:{type:"concrete",valueType:i.Types.boolean},description:function(){return r.i18n.s("cl-docs-description-graph-has-response")},internal:true}});function a(e){if(e["hasResponse"]&&e["hasResponse"][0]){return e["hasResponse"][0].value}return undefined}t.getHasResponseSink=a});define("core/components/graph-input/index",["require","exports","core/lib/copydata","../shared/calculator-state-helpers","../shared/correctness-sinks"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(e){if(e.clCorrectness===undefined)return"ungraded";if((!e.response||!e.response.calculatorState)&&!e.hasResponseOverride)return"incomplete";if(e.clCorrectness)return"correct";return"incorrect"},getComponentState:function(){return{}},hasResponse:function(e,t){var r=i.getHasResponseSink(t);if(r!==undefined){return r}return!!e&&(!!e.calculatorState||!!e.calculatorStateDiff)},getAssetUrls:function(e){var t=[];if(e.img){t.push(e.img)}if(e.calculatorState){t.push.apply(t,n.getGraphAssetUrls(e.calculatorState))}return t},rewriteAssetUrls:function(e,t){var i=r.copydata(e);if(i.img){i.img=t(i.img)}if(i.calculatorState){i.calculatorState=n.updateGraphAssetUrls(i.calculatorState,t)}return i}}});define("core/components/text-input/has-response",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.hasResponse=void 0;function r(e){var t,r;return!!(e===null||e===void 0?void 0:e.audio)||!!((t=e===null||e===void 0?void 0:e.images)===null||t===void 0?void 0:t.length)||!!((r=e===null||e===void 0?void 0:e.response)===null||r===void 0?void 0:r.trim().length)}t.hasResponse=r});define("core/components/text-input/index",["require","exports","../component-helpers","./has-response"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(e){var t=e.response,n=e.sinks;var i=t!=undefined?t.response:undefined;var a=r.getResponseOrInitialText(i,n.initialText);return{content:a}},hasResponse:n.hasResponse,getAssetUrls:function(){return[]},rewriteAssetUrls:function(e){return e}}});define("core/components/marbleslides/index",["require","exports","core/lib/copydata","../shared/calculator-state-helpers"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(e){if(!e.response||!e.response.calculatorState){return"incomplete"}if(e.config.stars.length===0)return"correct";if(e.response.score!==undefined&&e.config.stars.length===e.response.score){return"correct"}return"incorrect"},getComponentState:function(){},hasResponse:function(e){return!!e&&!!e.calculatorState},getAssetUrls:function(e){var t=[];if(e.img){t.push(e.img)}if(e.calculatorState){t.push.apply(t,n.getGraphAssetUrls(e.calculatorState))}return t},rewriteAssetUrls:function(e,t){var i=r.copydata(e);if(i.img){i.img=t(i.img)}if(i.calculatorState){i.calculatorState=n.updateGraphAssetUrls(i.calculatorState,t)}return i}}});define("core/components/multiple-choice/helpers",["require","exports","core/computation-layer/helpers"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.answersEqual=t.getCalculatorStateFromChoice=t.getMultipleChoiceOptionsState=t.configHasExplanation=t.isSimpleWithExplanation=t.types=void 0;t.types={MULTI:"multi",SIMPLE:"simple",EXPLAIN:"explain"};function n(e){return e.multipleChoiceType===t.types.EXPLAIN||e.multipleChoiceType===t.types.SIMPLE&&!!e.showExplanation}t.isSimpleWithExplanation=n;function i(e){return n(e)||!!e.defaultPolygraphIQ&&!!e.showExplanation}t.configHasExplanation=i;function a(e,t,n){if(n===void 0){n=[]}var i={};for(var a=0,o=n;a<o.length;a++){var s=o[a];var u=s.params[0]-1;i[e.choiceIds[u]]=s.value?r.synthesizeStringForContent(s.value):""}var c=[];var l=e.answerKey;var p=undefined;var d=t&&t.selection;var f=[];e.choiceIds.forEach(function(t,r){var n,a;var o=e.choices[t];if(o.card){if(o.card.type==="image"){c.push({type:"image",src:(n=o.card.img)!==null&&n!==void 0?n:"",content:o.text,alt:o.card.alt})}else if(o.card.type==="graph"){c.push({type:"graph",src:(a=o.card.img)!==null&&a!==void 0?a:"",content:o.text})}}else{c.push({type:"text",content:i[t]||o.text})}if(l!=undefined&&!!l.choiceIds[t]){if(!p){p=[]}p.push(r)}if(d!=undefined&&!!d.choiceIds[t]){f.push(r)}});return{answerKey:p,selectedOptions:f,options:c}}t.getMultipleChoiceOptionsState=a;function o(e,t,r){var n;var i=e.choiceIds[r]&&e.choices[e.choiceIds[r]];if(!i){throw new Error("Choice with index "+r+" does not exist on component "+t+".")}else if(((n=i.card)===null||n===void 0?void 0:n.type)!=="graph"){throw new Error("Choice with index "+r+" does not contain a graph on component "+t+".")}return i.card.calculatorState}t.getCalculatorStateFromChoice=o;function s(e,t){for(var r in e){if(!!e[r]!==!!t[r]){return false}}for(var r in t){if(!!e[r]!==!!t[r]){return false}}return true}t.answersEqual=s});define("core/components/multiple-choice/index",["require","exports","./helpers","underscore","../component-helpers","../shared/calculator-state-helpers","../shared/reset-on-change-sink","core/lib/copydata"],function(e,t,r,n,i,a,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(e){if((e.config.answerKey===undefined||e.config.answerKey===null)&&e.clCorrectness===undefined)return"ungraded";var t=!!(e.response&&e.response.selection&&e.config.answerKey&&r.answersEqual(e.config.answerKey.choiceIds,e.response.selection.choiceIds))||e.clCorrectness;if(!e.response||!e.response.selection||n.isEmpty(e.response.selection.choiceIds)){return"incomplete"}if(t)return"correct";return"incorrect"},componentWasReset:o.componentWasReset,getComponentState:function(e){var t=e.response,n=e.config,a=e.sinks;var o=r.getMultipleChoiceOptionsState(n,t,a.choiceContent),s=o.answerKey,u=o.selectedOptions,c=o.options;var l={multiSelect:n.multipleChoiceType==="multi",options:c,selectedOptions:u};if(s!=undefined){l.answerKey=s}if(n.showExplanation){var p=t!=undefined?t.explainText:undefined;l.explainContent=i.getResponseOrInitialText(p,a.initialText)}return l},hasResponse:function(e){return!!(e&&e.selection&&!n.isEmpty(e.selection.choiceIds))},getAssetUrls:function(e){var t=[];for(var r=0,n=Object.keys(e.choices);r<n.length;r++){var i=n[r];var o=e.choices[i];if(o.card){if(o.card.img){t.push(o.card.img)}if(o.card.type==="graph"&&o.card.calculatorState){t.push.apply(t,a.getGraphAssetUrls(o.card.calculatorState))}}}return t},rewriteAssetUrls:function(e,t){var r=s.copydata(e);for(var n=0,i=Object.keys(r.choices);n<i.length;n++){var o=i[n];var u=r.choices[o];if(u.card){if(u.card.img){u.card.img=t(u.card.img)}if(u.card.type==="graph"&&u.card.calculatorState){u.card.calculatorState=a.updateGraphAssetUrls(u.card.calculatorState,t)}}}return r}}});define("core/components/penny-dragging-widget/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(){return false},getAssetUrls:function(){return[]},rewriteAssetUrls:function(e){return e}}});define("core/components/reorder/helpers",["require","exports","underscore"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.hasAnswerKey=t.shouldRandomize=t.getResponseOrder=t.getItemIdsFromInitialOrder=void 0;function n(e,t){var n=t.value;if(!n)return e;return r.sortBy(e,function(e,t){return n[t]!==undefined?n[t]:Infinity})}t.getItemIdsFromInitialOrder=n;function i(e,t,r){if(t&&t.order)return t.order;if(r){return n(e.itemIds,r)}if(t&&t.randomizedItemIds)return t.randomizedItemIds;return e.itemIds}t.getResponseOrder=i;function a(e){return!!e.hasAnswerKey||!!e.randomize}t.shouldRandomize=a;function o(e){return!!e.hasAnswerKey&&e.itemIds.length>2}t.hasAnswerKey=o});define("core/components/reorder/index",["require","exports","./helpers","underscore"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(e){if(e.clCorrectness===undefined){if(r.hasAnswerKey(e.config)){if(!e.response||!e.response.order)return"incomplete";return n.isEqual(e.response.order,e.config.itemIds)?"correct":"incorrect"}return"ungraded"}if(e.clCorrectness)return"correct";return"incorrect"},getComponentState:function(e){var t=e.config,i=e.response,a=e.sinks;var o=a.initialOrder&&a.initialOrder[0];var s={items:t.items};if(!n.isEmpty(i)||o){s.order=r.getResponseOrder(t,i,o)}if(t.topString!==undefined){s.topLabel=t.topString}if(t.bottomString!==undefined){s.bottomLabel=t.bottomString}if(r.hasAnswerKey(t)){s.answerKey=t.itemIds}return s},hasResponse:function(e){return!!(e&&e.order)},getAssetUrls:function(){return[]},rewriteAssetUrls:function(e){return e}}});define("core/components/sketch/helpers",["require","exports","tslib"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getMigratedEnabledTools=t.getDefaultSketchData=t.DEFAULT_SKETCH_TOOLS=void 0;t.DEFAULT_SKETCH_TOOLS={points:false,line:true,pencil:true,math:true,text:true};function n(){return{points:[],strokes:[]}}t.getDefaultSketchData=n;function i(e){if(e.enabledTools)return e.enabledTools;if(e.toolset==="points")return{points:true,text:false,math:false,line:false,pencil:false};if(e.disableText)return{points:false,line:true,pencil:true,math:false,text:false};return r.__assign({},t.DEFAULT_SKETCH_TOOLS)}t.getMigratedEnabledTools=i});define("core/components/sketch/index",["require","exports","../shared/calculator-state-helpers","../shared/reset-on-change-sink","underscore","./helpers","core/lib/copydata"],function(e,t,r,n,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;var s=function(e){return!!e&&!!e.sketchData&&!i.isEqual(e.sketchData,a.getDefaultSketchData())};t.index={checkCorrectness:function(e){if(e.clCorrectness===undefined){return"ungraded"}if(!s(e.response)){return"incomplete"}if(e.clCorrectness)return"correct";return"incorrect"},getComponentState:function(){return{}},hasResponse:s,getAssetUrls:function(e){var t;var n=[];if(e.img){n.push(e.img)}switch((t=e.background)===null||t===void 0?void 0:t.type){case"image":case"pattern":if(e.background.img){n.push(e.background.img)}break;case"graph":if(e.calculatorState){n.push.apply(n,r.getGraphAssetUrls(e.calculatorState))}break;default:break}return n},rewriteAssetUrls:function(e,t){var n;var i=o.copydata(e);if(i.img){i.img=t(i.img)}switch((n=i.background)===null||n===void 0?void 0:n.type){case"image":case"pattern":if(i.background.img){i.background.img=t(i.background.img)}break;case"graph":if(i.calculatorState){i.calculatorState=r.updateGraphAssetUrls(i.calculatorState,t)}break;default:break}return i},componentWasReset:n.componentWasReset}});define("core/lib/simpleevaluator",["require","exports","underscore","core/lib/mathtools"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.SimpleEvaluator=void 0;var i=function(){function e(){this.cache={};this.context=new n.context}e.prototype.analyze=function(e){var t=e.latex,r=e.vars,n=e.degreeMode;var i=this.cacheKey({latex:t,vars:r,degreeMode:n});if(!!this.cache[i]){return this.cache[i]}var o={};var s=0;var u=a(t);o[""+s]={id:""+s,latex:u};s++;for(var c in r){if(r.hasOwnProperty(c)){o[""+s]={id:""+s,latex:c+" = "+r[c]};s++}}var l=this.context.processChangeSet({isCompleteState:true,statements:o,degreeMode:n});var p=l.statusChanges[0];if(!p){p={error:"Unable to analyze."}}this.cache[i]=p;return p};e.prototype.cacheKey=function(e){return JSON.stringify(e)};e.prototype.evaluate=function(e){var t=this.analyze(e);if(t.error){return new Error(t.error)}else if(r.isNumber(t.constant_value)){return t.constant_value}else{return new Error("unknown error")}};e.prototype.isEvaluable=function(e){return!!this.analyze(e).is_evaluable};return e}();t.SimpleEvaluator=i;function a(e){if(/\\%$/.test(e)){var t=n.expressionParser.parse(e.slice(0,-2));if(t.type=="Err")return e;if(o(t)){return e+"\\operatorname{of}1"}}return e}function o(e){while((e===null||e===void 0?void 0:e.type)==="Neg"||(e===null||e===void 0?void 0:e.type)==="Pos"){if(e.args[0]===e)break;e=e.args[0]}return(e===null||e===void 0?void 0:e.type)==="Decimal"||(e===null||e===void 0?void 0:e.type)==="MixedNumber"}});define("core/lib/log",["require","exports","tslib"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.log=t.err=t.warn=t.init=void 0;var n;var i;var a;function o(e,t,r){n=e;i=t;a=r}t.init=o;function s(e,t){if(n){n(e,t)}}t.warn=s;function u(e,t){if(i){i(e,t)}}t.err=u;function c(e){var t=[];for(var n=1;n<arguments.length;n++){t[n-1]=arguments[n]}if(a){a.apply(void 0,r.__spreadArrays([e],t))}}t.log=c});define("core/lib/evaluator-helpers",["require","exports","./simpleevaluator","./log"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.computeNumericValueFromLatex=t.evaluateRawLatex=void 0;var i=function(e){e=e.replace(/(.*?)([\\ ]*)$/,"$1");e=e.replace(/(.*?)([a-z]+)([\\ ]*)$/,"$1");e=e.replace(/(.*?)([a-z]+)\^([\d\-\.]+)$/,"$1");e=e.replace(/(.*?)\\frac\{([a-z]+)\}\{([a-z]+)\}$/,"$1");e=e.replace(/^\\\$/,"");return e};var a=function(e,t,r){if(e&&typeof e!="string"){n.err("evaluateRawLatex","Expected latex to be string | undefined but it was "+typeof e)}if(!e||typeof e!="string"){return undefined}var a={latex:e,vars:{},degreeMode:r};var o=t.evaluate(a);if(typeof o!="number"||!isFinite(o)){e=i(e);a.latex=e;o=t.evaluate(a)}if(typeof o!="number"||!isFinite(o)){e=i(e);if(e.match(/^-?\d{1,3}(,\d\d\d)*(\.\d+)?$/)){e=e.replace(/,/g,"")}a.latex=e;o=t.evaluate(a)}if(typeof o!="number"||!isFinite(o)){return undefined}return o};t.evaluateRawLatex=a;var o=undefined;function s(e,n){if(e===undefined)return NaN;o=o||new r.SimpleEvaluator;var i=t.evaluateRawLatex(e,o,n);return i==null?NaN:i}t.computeNumericValueFromLatex=s});define("core/components/table/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true})});define("core/components/table/helpers",["require","exports","tslib","core/lib/simpleevaluator","core/computation-layer/helpers","core/lib/evaluator-helpers","underscore","core/lib/log","core/components/table/types","../component-helpers"],function(e,t,r,n,i,a,o,s,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getTableCellState=t.getTableCellType=t.getTableSinkMap=t.getCellType=t.getEditorCellContent=t.getStudentCellContent=t.hasRowHeaders=t.hasColumnHeaders=t.getCellIdFromCoordinates=t.changeColumnType=t.getRowIdForCoordinate=t.getColumnType=t.findCoordinatesForCellId=t.getColumnCoordinateForId=t.getRowCoordinateForId=t.getLastColumnCoordinate=t.getColumnCount=t.getLastRowCoordinate=t.removeColumn=t.getDataTruncatedToRowCoordinate=t.addNewColumn=t.addRowHeaderColumn=t.addColumnHeaderRow=t.addNewRow=t.cellIdx=t.rowIdx=t.columnTypes=t.TableData=t.TableCellContent=t.CellData=t.TableStructure=t.ColumnType=void 0;Object.defineProperty(t,"ColumnType",{enumerable:true,get:function(){return u.ColumnType}});Object.defineProperty(t,"TableStructure",{enumerable:true,get:function(){return u.TableStructure}});Object.defineProperty(t,"CellData",{enumerable:true,get:function(){return u.CellData}});Object.defineProperty(t,"TableCellContent",{enumerable:true,get:function(){return u.TableCellContent}});Object.defineProperty(t,"TableData",{enumerable:true,get:function(){return u.TableData}});var l=new n.SimpleEvaluator;t.columnTypes={MATH:0,TEXT:1};function p(e,t){return N(e)?t:t-1}t.rowIdx=p;function d(e,t){return A(e)?t:t-1}t.cellIdx=d;function f(e){return e+"-"}function h(e,t){var r=f(e);return""+r+t}function y(e,t,r,n){return v(e,p(e,t),r,n)}t.addNewRow=y;function m(e,t){var r=v(e,0,t);e.columnHeaders=true;return r}t.addColumnHeaderRow=m;function v(e,t,r,n){var i=e.rows;var a=e.cells;if(n===undefined){var o=e.rows[e.rowIds[0]];n=o?o.length:0}var s=[];for(var u=0;u<n;u++){var c=h(r,u);s.push(c);a[c]={content:""}}i[r]=s;e.rowIds.splice(t,0,r);return r}function g(e){x(e,0);e.rowHeaders=true}t.addRowHeaderColumn=g;var b=function(e,t){return x(e,d(e,t))};t.addNewColumn=b;function x(e,r){var n=e.rowIds;var i=e.rows;var a=e.cells;for(var u=0;u<n.length;u++){var l=n[u];var p=f(l);var d=c.getNextUniqueIdNum(i[l],p);var y=h(l,d);i[l].splice(r,0,y);a[y]={content:""}}if(!e.columnTypes){s.err("TableDataInvariantViolation",'Missing "columnTypes" in table data.');e.columnTypes=o.range(_(e)).map(function(){return t.columnTypes.MATH})}else{e.columnTypes.splice(r,0,t.columnTypes.MATH)}e.rows=i;e.cells=a}function S(e,t){if(w(e)>t){var n=p(e,t)+1;return r.__assign(r.__assign({},e),{rowIds:e.rowIds.slice(0,n)})}else{return e}}t.getDataTruncatedToRowCoordinate=S;function T(e,t){var r=[];var n=d(e,t);for(var i=0,a=e.rowIds;i<a.length;i++){var s=a[i];var u=e.rows[s];var c=u[n];e.rows[s]=o.without(u,c);r.push(c)}e.cells=o.omit(e.cells,r);return r}t.removeColumn=T;function w(e){return N(e)?e.rowIds.length-1:e.rowIds.length}t.getLastRowCoordinate=w;function _(e){var t=e.rowIds[0];var r=e.rows[t];if(!r)return 0;return r.length}t.getColumnCount=_;function I(e){var t=e.rowIds[0];var r=e.rows[t];if(!r)return-1;return A(e)?r.length-1:r.length}t.getLastColumnCoordinate=I;function E(e,t){var r=e.rowIds.indexOf(t);if(r<0)return-1;return N(e)?r:r+1}t.getRowCoordinateForId=E;function C(e,t,r){var n=e.rows[t];if(!n)return-1;var i=n.indexOf(r);if(i<0)return-1;return A(e)?i:i+1}t.getColumnCoordinateForId=C;function M(e,t){for(var r in e.rows){var n=C(e,r,t);if(n>-1){return{row:E(e,r),column:n}}}return undefined}t.findCoordinatesForCellId=M;function k(e,r){var n=e.columnTypes?e.columnTypes[d(e,r)]:undefined;if(typeof n!=="number")return t.columnTypes.MATH;return n}t.getColumnType=k;function P(e,t){return e.rowIds[p(e,t)]}t.getRowIdForCoordinate=P;var O=function(e,r,n){if(!e.columnTypes){s.err("TableDataInvariantViolation",'Missing "columnTypes" in table data.');e.columnTypes=o.range(_(e)).map(function(){return t.columnTypes.MATH})}e.columnTypes[d(e,r)]=n};t.changeColumnType=O;function L(e,t,r){var n=e.rowIds[p(e,t)];if(!n)return undefined;return e.rows[n][d(e,r)]}t.getCellIdFromCoordinates=L;function N(e){var t=e.columnHeaders;if(t!==undefined)return t;return true}t.hasColumnHeaders=N;function A(e){var t=e.rowHeaders;if(t!==undefined)return t;return false}t.hasRowHeaders=A;function D(e){var r=e.cellContentSink,n=e.initialCellContentSink,o=e.cellEditableSink,s=e.cellErrorMessageSink,u=e.cellDisableEvaluationSink,c=e.cellSuffixSink,p=e.configurationData,d=e.studentData,f=e.columnType,h=e.fullyEditable,y=e.isHeader,m=e.degreeMode;if(f===undefined)f=t.columnTypes.MATH;var v=F(p)||"";var g=F(d);var b;if(o){b=!!o.value}else if(y){b=!r&&v===""}else{b=!r&&(h||v===""||!!n)}var x;if(r&&!b){var S=r.value;if(S){x=S.latex!=undefined?S.latex:i.synthesizeStringForContent(S)}else{x=undefined}}else if(g!==undefined){x=g}else if(n){var S=n.value;if(S){x=S.latex!=undefined?S.latex:i.synthesizeStringForContent(S)}else{x=undefined}}else{x=v}return{content:x||"",cellType:q(y,f,b),numericValue:a.evaluateRawLatex(x,l,m),allowStudentEditing:b,cellErrorMessage:s&&s.value?i.synthesizeStringForContent(s.value):"",disableEvaluation:u?!!u.value:false,cellSuffix:c&&c.value?i.synthesizeStringForContent(c.value):""}}t.getStudentCellContent=D;function R(e){var r=e.hasCellContentSink,n=e.hasInitialCellContentSink,i=e.configurationData,a=e.columnType,o=e.fullyEditable,s=e.isHeader;if(a===undefined)a=t.columnTypes.MATH;if(r)return{content:"cellContent",cellType:"cl-override-warning",allowStudentEditing:false,cellErrorMessage:"",disableEvaluation:false,cellSuffix:""};if(n)return{content:"initialCellContent",cellType:"cl-override-warning",allowStudentEditing:true,cellErrorMessage:"",disableEvaluation:false,cellSuffix:""};var u=F(i)||"";var c=s&&u==="";var l=s?c:o||u==="";return{content:u,cellType:q(s,a,true),allowStudentEditing:l,cellErrorMessage:"",disableEvaluation:false,cellSuffix:""}}t.getEditorCellContent=R;function F(e){if(!e)return undefined;if(e.content!==undefined)return e.content;if(e.latex!==undefined)return e.latex;if(e.text!==undefined)return e.text;return undefined}function q(e,r,n){if(e){r=t.columnTypes.TEXT}if(r===t.columnTypes.TEXT)return n?"editable-text":"readonly-text";if(r===t.columnTypes.MATH)return n?"editable-math":"readonly-math";throw new Error("Unexpected column type")}t.getCellType=q;function B(e,t){var r={};for(var n=0,i=["cellContent","initialCellContent","cellEditable","cellSuffix","cellErrorMessage","cellDisableEvaluation"];n<i.length;n++){var a=i[n];var o=t[a];if(!o)continue;for(var s=0,u=o;s<u.length;s++){var c=u[s];var l=c.params,p=l[0],d=l[1];var f=L(e,p,d);if(!f)continue;if(!r[f])r[f]={};r[f][a]=c}}return r}t.getTableSinkMap=B;function V(e,r,n){if(e==0||r==0){return t.columnTypes.TEXT}return k(n,r)}t.getTableCellType=V;function z(e,t,n,i,a){var o=r.__assign(r.__assign({},n),i);var s=M(o,e);if(!s){throw new Error("Unable to find cell with id "+e+" in table.")}var u=t[e]||{};var c=k(n,s.column);var l={cellContentSink:u["cellContent"],initialCellContentSink:u["initialCellContent"],cellEditableSink:u["cellEditable"],cellErrorMessageSink:u["cellErrorMessage"],cellDisableEvaluationSink:u["cellDisableEvaluation"],cellSuffixSink:u["cellSuffix"],configurationData:n.cells[e],studentData:!!i&&i.cells?i.cells[e]:undefined,columnType:c,fullyEditable:n.fullyEditable,isHeader:s.row===0||s.column===0,degreeMode:!!(a===null||a===void 0?void 0:a.degreeMode)};var p=D(l);var d=p.content,f=p.numericValue,h=p.allowStudentEditing,y=p.cellErrorMessage,m=p.cellSuffix;var v={content:d,studentEditable:h,warning:y,suffixContent:m,columnType:c,coords:s};if(f!==undefined){v.numericValue=f}return v}t.getTableCellState=z});define("core/components/table/index",["require","exports","tslib","./helpers","../shared/reset-on-change-sink"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(e){if(e.clCorrectness===undefined){return"ungraded"}if(!e.response||!e.response.updated){return"incomplete"}if(e.clCorrectness)return"correct";return"incorrect"},getComponentState:function(e){var t=e.response,i=e.config,a=e.sinks,o=e.options;var s=t!=undefined?r.__assign(r.__assign({},i),t):i;var u=n.getTableSinkMap(s,a);var c=a.maxRows&&a.maxRows[0];var l=c&&c.value!=undefined?c.value:Infinity;var p=n.getDataTruncatedToRowCoordinate(s,l);var d=p.rowIds.map(function(e){var r=s.rows[e];return r.map(function(e){return n.getTableCellState(e,u,i,t,{degreeMode:!!(o===null||o===void 0?void 0:o.degreeMode)})})});return{cellContent:d,rowHeaders:!!i.rowHeaders,columnHeaders:i.columnHeaders===undefined?true:i.columnHeaders,rowIds:p.rowIds}},hasResponse:function(e){return!!(e&&e.updated)},getAssetUrls:function(){return[]},rewriteAssetUrls:function(e){return e},componentWasReset:i.componentWasReset}});define("core/components/transform/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(e){var t=!!e.response&&!!e.response.transforms&&e.response.transforms.length>0;var r=!!e.response&&!!e.response.unsubmittedTransform;if(!(e.response&&(t||r))){return"incomplete"}if(!!e.response){if(!!e.response.hitTarget)return"correct";return"incorrect"}return"ungraded"},getComponentState:function(e){var t=e.response;return{transforms:(t===null||t===void 0?void 0:t.transforms)||[]}},hasResponse:function(e){return!!(e&&(e.transforms&&e.transforms.length||!!e.unsubmittedTransform))},getAssetUrls:function(){return[]},rewriteAssetUrls:function(e){return e}}});define("core/components/video/index",["require","exports","tslib","core/lib/copydata"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(e){var t;var r=e.config;var n=((t=r.videoConfig)===null||t===void 0?void 0:t.sources)||[];return{sources:n.map(function(e){return{src:e.url}}),description:r.videoDescription}},hasResponse:function(){return false},getAssetUrls:function(e){var t=[];if(e.videoConfig){if(e.videoConfig.thumb){t.push(e.videoConfig.thumb)}for(var r=0,n=e.videoConfig.sources||[];r<n.length;r++){var i=n[r];t.push(i.url)}}return t},rewriteAssetUrls:function(e,t){var i;var a=n.copydata(e);if(a.videoConfig){if(a.videoConfig.thumb){a.videoConfig.thumb=t(a.videoConfig.thumb)}if((i=a.videoConfig)===null||i===void 0?void 0:i.sources){a.videoConfig.sources=a.videoConfig.sources.map(function(e){return r.__assign(r.__assign({},e),{url:t(e.url)})})}}return a}}});define("core/components/challenge/index",["require","exports","underscore","core/components/component-helpers","../index","core/lib/copydata"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(e){return!!(e&&(e.challenges&&e.challenges.length>0||e.responses&&r.values(e.responses).length>0))},getAssetUrls:function(e){var t=[];for(var r=0,a=e.activityConfig.steps;r<a.length;r++){var o=a[r];n.forEachComponent(o,function(e){var r=n.componentKey(e);var a=n.traverseComponentKey(e);var o=i.nameToComponent(r);t.push.apply(t,o.getAssetUrls(a))})}return t},rewriteAssetUrls:function(e,t){var r=a.copydata(e);for(var o=0,s=r.activityConfig.steps;o<s.length;o++){var u=s[o];n.forEachComponent(u,function(e){var r=n.componentKey(e);var a=n.traverseComponentKey(e);var o=i.nameToComponent(r);e[r]=o.rewriteAssetUrls(a,t)})}return r}}});define("core/components/student-survey/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(e){return!!(e&&(e.survey_feeling!=undefined||e.survey_understanding!=undefined))},getAssetUrls:function(){return[]},rewriteAssetUrls:function(e){return e}}});define("core/components/polygraph/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(e){return!!e},getAssetUrls:function(){return[]},rewriteAssetUrls:function(e){return e}}});define("core/components/custom/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.index=void 0;t.index={checkCorrectness:function(){return"ungraded"},getComponentState:function(){},hasResponse:function(){return false},getAssetUrls:function(){return[]},rewriteAssetUrls:function(e){return e}}});define("core/components/index",["require","exports","./action-button/index","./cardsort/index","./image-exhibit/index","./text-exhibit/index","./geometry/index","./expression-input/index","./graph-input/index","./text-input/index","./marbleslides/index","./multiple-choice/index","./penny-dragging-widget/index","./reorder/index","./sketch/index","./table/index","./transform/index","./video/index","./challenge/index","./student-survey/index","./polygraph/index","./custom/index"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f,h,y,m,v,g,b,x,S){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.componentWasReset=t.nameToComponent=t.COMPONENT_NAMES=void 0;var T={"action-button":r.index,cardsort:n.index,challenge:g.index,"custom-component":S.index,"exhibit/image":i.index,"exhibit/text":a.index,geometry:o.index,"input/expression":s.index,"input/graph":u.index,"input/text":c.index,marbleslides:l.index,"multiple-choice":p.index,"penny-dragging-widget":d.index,polygraph:x.index,sketch:h.index,table:y.index,transform:m.index,video:v.index,"student-survey":b.index,reorder:f.index};t.COMPONENT_NAMES=Object.keys(T);function w(e){return T[e]}t.nameToComponent=w;function _(e,t){return!!e.componentWasReset&&e.componentWasReset(t)}t.componentWasReset=_});define("core/components/component-helpers",["require","exports","core/lib/uuid","core/computation-layer/helpers","core/components/index"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.isComponentKey=t.generatePrefixId=t.getNextUniqueIdNum=t.getResponseOrInitialText=t.getSubscreenParentConfig=t.findFirstComponentByType=t.newScreen=t.componentsForLesson=t.forEachComponent=t.componentsForStep=t.updateComponentConfig=t.traverseComponentKey=t.componentKey=void 0;var a=function(e){var t;for(var r in e){if(t)throw new Error("Expected to get a component with a single key, but got "+JSON.stringify(e));t=r}if(!t)throw new Error("Expected to get a component with a single key, but got {}");return t};t.componentKey=a;var o=function(e){return e[t.componentKey(e)]};t.traverseComponentKey=o;function s(e,t,r){e[t]=r}t.updateComponentConfig=s;var u=function(e){var t=[];c(e,function(e){return t.push(e)});return t};t.componentsForStep=u;function c(e,t){for(var r=0,n=e.root.linearlayout.components;r<n.length;r++){var i=n[r];for(var a=0,o=i.linearlayout.components;a<o.length;a++){var s=o[a];t(s)}}}t.forEachComponent=c;function l(e){var r=[];return r.concat.apply(r,e.steps.map(t.componentsForStep))}t.componentsForLesson=l;var p=function(){return{type:"two-column",id:r.uuid(),teacherTips:{},root:{linearlayout:{mainType:"columns",components:[]}}}};t.newScreen=p;function d(e,t){var r=t.root.linearlayout.components;for(var n=0,i=r;n<i.length;n++){var a=i[n];var o=a.linearlayout.components;for(var s=0,u=o;s<u.length;s++){var c=u[s];if(c[e]){return c[e]}}}return undefined}t.findFirstComponentByType=d;function f(e){return d("challenge",e)}t.getSubscreenParentConfig=f;function h(e,t){if(t===void 0){t=[]}if(e!=undefined){return e}else if(t[0]&&t[0].value){return n.synthesizeStringForContent(t[0].value)}return""}t.getResponseOrInitialText=h;function y(e,t){var r=-1;for(var n=0,i=e;n<i.length;n++){var a=i[n];var o=a.indexOf(t)===0?parseInt(a.replace(t,"")):-1;if(!isNaN(o)&&o>r){r=o}}return r+1}t.getNextUniqueIdNum=y;function m(e,t){return""+e+t}t.generatePrefixId=m;function v(e){return!!i.nameToComponent(e)}t.isComponentKey=v});define("core/lib/assert-unreachable",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.assertNonNullable=t.isDefined=t.assertDefined=t.assertUnreachable=void 0;var r=function(e,t){if(!t){t="Exhaustive case failed! "+JSON.stringify(e)}throw new Error(t)};t.assertUnreachable=r;function n(e,t){if(e===undefined){throw new Error("Expected "+t+" to be defined.")}}t.assertDefined=n;function i(e){return e!==undefined}t.isDefined=i;function a(e,t){if(e===undefined||e===null){throw new Error("Expected "+t+" to be non-nullable.")}}t.assertNonNullable=a});define("core/computation-layer/runtime-node",["require","exports","underscore","core/lib/assert-unreachable"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.RuntimeNode=void 0;var i=function(){function e(e){this.blockedOn=[];this.runtime=e.runtime;this.analysis=e.analysis;this.nodeId=e.nodeId;this.dependents=[];switch(this.analysis.type){case"constant":this.value=this.analysis.value}this.blockedOn=this.getDependencies()}e.prototype.registerDependent=function(e){if(r.contains(this.dependents,e)){return}this.dependents.push(e)};e.prototype.resolveDependency=function(e){this.blockedOn=r.without(this.blockedOn,e);if(this.blockedOn.length===0){this.compute()}};e.prototype.blockOn=function(e){if(r.contains(this.blockedOn,e)){return}this.blockedOn.push(e);if(this.blockedOn.length==1){this.blockDependents()}};e.prototype.blockDependents=function(){for(var e=0,t=this.dependents;e<t.length;e++){var r=t[e];this.runtime.nodes[r].blockOn(this.nodeId)}};e.prototype.resolveValue=function(e){this.value=e;for(var t=0,r=this.dependents;t<r.length;t++){var n=r[t];this.runtime.nodes[n].resolveDependency(this.nodeId)}};e.prototype.getDependencies=function(){switch(this.analysis.type){case"constant":case"controllerSource":case"responseSource":case"component":case"component-script":case"importNumber":case"importString":case"importNumberList":return[];case"function":return this.analysis.dependencies;case"placeholder-source":throw new Error("Unexpected placeholder-source node found at runtime");default:return n.assertUnreachable(this.analysis)}};e.prototype.compute=function(){var e;var t=this;if(this.analysis.type!="function")return;var r=this.analysis.dependencies.map(function(e){return t.runtime.nodes[e].value});this.resolveValue((e=this.analysis).fn.apply(e,r))};return e}();t.RuntimeNode=i});define("core/computation-layer/parser/context",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.setContext=t.getContext=void 0;var r={componentId:"",stepId:""};function n(){return r}t.getContext=n;function i(e){r=e}t.setContext=i});define("core/computation-layer/parser/helpers",["require","exports","./context"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ParseError=t.join=t.token2pos=void 0;function n(e,t){var n=r.getContext();if(t){return{componentId:n.componentId,stepId:n.stepId,first_line:e.line,last_line:t.line,first_column:e.first_column,last_column:t.last_column}}else{return{componentId:n.componentId,stepId:n.stepId,first_line:e.line,last_line:e.line,first_column:e.first_column,last_column:e.last_column}}}t.token2pos=n;function i(e,t){return{componentId:e.componentId,stepId:e.stepId,first_line:e.first_line,last_line:t.last_line,first_column:e.first_column,last_column:t.last_column}}t.join=i;var a=function(){function e(e,t){this.message=e;this.pos=t}return e}();t.ParseError=a});define("core/computation-layer/string-stream",["require"],function(e){var t=function(e,t,r){this.pos=this.start=0;this.string=e;this.tabSize=t||8;this.lastColumnPos=this.lastColumnValue=0;this.lineStart=0;this.lineOracle=r};t.prototype.eol=function(){return this.pos>=this.string.length};t.prototype.sol=function(){return this.pos==this.lineStart};t.prototype.peek=function(){return this.string.charAt(this.pos)||undefined};t.prototype.next=function(){if(this.pos<this.string.length){return this.string.charAt(this.pos++)}};t.prototype.eat=function(e){var t=this.string.charAt(this.pos);var r;if(typeof e=="string"){r=t==e}else{r=t&&(e.test?e.test(t):e(t))}if(r){++this.pos;return t}};t.prototype.eatWhile=function(e){var t=this.pos;while(this.eat(e)){}return this.pos>t};t.prototype.eatSpace=function(){var e=this;var t=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++e.pos}return this.pos>t};t.prototype.skipToEnd=function(){this.pos=this.string.length};t.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1){this.pos=t;return true}};t.prototype.backUp=function(e){this.pos-=e};t.prototype.column=function(){if(this.lastColumnPos<this.start){this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue);this.lastColumnPos=this.start}return this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)};t.prototype.indentation=function(){return countColumn(this.string,null,this.tabSize)-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)};t.prototype.match=function(e,t,r){if(typeof e=="string"){var n=function(e){return r?e.toLowerCase():e};var i=this.string.substr(this.pos,e.length);if(n(i)==n(e)){if(t!==false){this.pos+=e.length}return true}}else{var a=this.string.slice(this.pos).match(e);if(a&&a.index>0){return null}if(a&&t!==false){this.pos+=a[0].length}return a}};t.prototype.current=function(){return this.string.slice(this.start,this.pos)};t.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}};t.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)};t.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)};return{StringStream:t}});define("core/computation-layer/lexer",["require","exports","./string-stream"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getToken=t.keywords=t.getTokens=void 0;function n(e){var t=[];var n={line:1,stack:["default"]};for(var a=0,o=e.split("\n");a<o.length;a++){var s=o[a];var u=new r.StringStream(s);while(!u.eol()){var c=i(u,n);if(c!=undefined){t.push(c)}if(u.start==u.pos){throw new Error("getToken failed to advance stream at position "+u.pos+" in string "+u.string)}u.start=u.pos}if(n.stack[n.stack.length-1]=="string"){t.push({type:"STRING_CHARACTERS",line:n.line,first_column:u.start,last_column:u.pos,text:"\n"})}n.line+=1}return t}t.getTokens=n;t.keywords=["WHEN","OTHERWISE","AND","OR","TRUE","FALSE"];function i(e,t){switch(t.stack[t.stack.length-1]){case"latex":return s(e,t);case"string":return u(e,t);case"stringInterpolation":return c(e,t);case"latexInterpolation":return l(e,t);default:return o(e,t)}}t.getToken=i;function a(e,t){return function r(n){return{type:n,first_column:e.start,last_column:e.pos,line:t.line,text:e.current()}}}function o(e,r){var n=a(e,r);if(e.eatSpace()){return undefined}if(e.match(/\(/)){return n("(")}if(e.match(/\)/)){return n(")")}if(e.match(/\./)){return n(".")}if(e.match(/:/)){return n(":")}if(e.match(/=/)){return n("=")}if(e.match(/,/)){return n(",")}if(e.match(/>=/)){return n(">=")}if(e.match(/<=/)){return n("<=")}if(e.match(/>/)){return n(">")}if(e.match(/</)){return n("<")}if(e.match(/[a-zA-Z_][a-zA-Z0-9_]*/)){for(var i=0,o=t.keywords;i<o.length;i++){var s=o[i];if(e.current()==s||e.current()==s.toLowerCase()){return n(s)}}return n("IDENTIFIER")}if(e.match(/-?[0-9]+(\.[0-9]+)?/)){return n("NUMBER")}if(e.match(/"/)){r.stack.push("string");return n("BEGIN_STRING")}if(e.match(/`/)){r.stack.push("latex");return n("BEGIN_LATEX")}if(e.match(/#/)){if(!e.match(/\n/)){e.match(/.*/)}return n("COMMENT")}e.next();return n("ERROR")}function s(e,t){var r=a(e,t);if(e.match(/\${/)){t.stack.push("latexInterpolation");return r("BEGIN_LATEX_INTERPOLATION")}if(e.match(/`/)){t.stack.pop();return r("END_LATEX")}e.next();var n=e.peek();if(n){return r("LATEX_CHARACTERS")}else{t.stack.pop();return r("UNEXPECTED_EOL")}}function u(e,t){var r=a(e,t);if(e.match(/\${/)){t.stack.push("stringInterpolation");return r("BEGIN_STRING_INTERPOLATION")}if(e.match(/"/)){t.stack.pop();return r("END_STRING")}if(e.match(/\\n/)){if(e.match(/(u|e|eq|parallel)(?![a-zA-Z])/)){var n=r("STRING_CHARACTERS");return n}var i=r("STRING_CHARACTERS");i.text="\n";return i}if(e.match(/\\([{}% ]|[a-z]{2,})/)){var i=r("STRING_CHARACTERS");return i}if(e.match(/\\./)){var i=r("STRING_CHARACTERS");i.text=i.text[1];return i}if(e.match(/./)){return r("STRING_CHARACTERS")}e.next();return r("ERROR")}function c(e,t){var r=a(e,t);if(e.match(/}/)){t.stack.pop();return r("END_STRING_INTERPOLATION")}return o(e,t)}function l(e,t){var r=a(e,t);if(e.match(/}/)){t.stack.pop();return r("END_LATEX_INTERPOLATION")}return o(e,t)}});define("core/computation-layer/parser/token-stream",["require","exports","../lexer","./helpers"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.TokenStream=void 0;var i=function(){function e(e){this.pos=0;this.tokens=r.getTokens(e).filter(function(e){return e.type!="COMMENT"})}e.prototype.consume=function(){var e=this.tokens[this.pos];if(e){this.pos+=1}return e};e.prototype.peek=function(){return this.tokens[this.pos]};e.prototype.last=function(){return this.tokens[this.pos-1]};e.prototype.expectToken=function(e){var t=this.consume();if(!t){throw new n.ParseError("Expected _"+e+"_ token but found none.",n.token2pos(this.last()))}if(t.type!=e){throw new n.ParseError("Expected _"+e+"_ token but found _"+t.type+"_.",n.token2pos(t))}return t};return e}();t.TokenStream=i});define("core/computation-layer/parser/ast",["require","exports","tslib","core/computation-layer/cl-types","core/lib/assert-unreachable","underscore","core/lib/mathtools"],function(e,t,r,n,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.nodeListsEqual=t.nodesEqual=t.synthesizeScript=t.CalculatorReferenceNode=t.FunctionNode=t.InterpolationNode=t.ChooseNode=t.BinaryOperationNode=t.IdentifierNode=t.VariableAssignmentNode=t.SinkAssignmentNode=t.LatexNode=t.StringNode=t.BooleanNode=t.NumberNode=t.ConstantNode=void 0;var s=function(){function e(){}return e}();var u=function(e){r.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.getChildren=function(){return[]};return t}(s);t.ConstantNode=u;var c=function(e){r.__extends(t,e);function t(t,r){var i=e.call(this)||this;i.value=t;i.pos=r;i.type="Number";i.valueType=n.Types.number;return i}t.prototype.synthesize=function(){return o.numberToDecimalString(this.value)};return t}(u);t.NumberNode=c;var l=function(e){r.__extends(t,e);function t(t,r){var i=e.call(this)||this;i.value=t;i.pos=r;i.type="Boolean";i.valueType=n.Types.boolean;return i}t.prototype.synthesize=function(){if(this.value){return"true"}else{return"false"}};return t}(u);t.BooleanNode=l;var p=function(e){r.__extends(t,e);function t(t,r){var i=e.call(this)||this;i.pos=r;i.type="String";i.valueType=n.Types.string;i.value=t;return i}t.prototype.synthesize=function(){return'"'+T(this.value)+'"'};return t}(u);t.StringNode=p;var d=function(e){r.__extends(t,e);function t(t,r){var i=e.call(this)||this;i.value=t;i.pos=r;i.type="Latex";i.valueType=n.Types.latex;return i}t.prototype.synthesize=function(){return"`"+this.value.latex+"`"};return t}(u);t.LatexNode=d;var f=function(e){r.__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.left=t;i.right=r;i.pos=n;i.type="SinkAssignment";return i}t.prototype.getChildren=function(){return[this.left,this.right]};t.prototype.synthesize=function(){return this.left.synthesize()+": "+this.right.synthesize()};return t}(s);t.SinkAssignmentNode=f;var h=function(e){r.__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.left=t;i.right=r;i.pos=n;i.type="VariableAssignment";return i}t.prototype.getChildren=function(){return[this.left,this.right]};t.prototype.synthesize=function(){return this.left.synthesize()+" = "+this.right.synthesize()};return t}(s);t.VariableAssignmentNode=h;var y=function(e){r.__extends(t,e);function t(t,r){var n=e.call(this)||this;n.value=t;n.pos=r;n.type="Identifier";return n}t.prototype.getChildren=function(){return[]};t.prototype.synthesize=function(){return this.value};return t}(s);t.IdentifierNode=y;var m=function(e){r.__extends(t,e);function t(t,r,n,i){var a=e.call(this)||this;a.operator=t;a.left=r;a.right=n;a.pos=i;a.type="BinaryOperation";return a}t.prototype.getChildren=function(){return[this.left,this.right]};t.prototype.synthesize=function(){var e=this.operator=="."?"":" ";return"("+this.left.synthesize()+e+this.operator+e+this.right.synthesize()+")"};return t}(s);t.BinaryOperationNode=m;var v=function(e){r.__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.cases=t;i.otherwise=r;i.pos=n;i.type="Choose";return i}t.prototype.getChildren=function(){var e=[];for(var t=0,r=this.cases;t<r.length;t++){var n=r[t],i=n.predicate,a=n.consequent;e.push(i);e.push(a)}e.push(this.otherwise);return e};t.prototype.synthesize=function(){var e="(";for(var t=0,r=this.cases;t<r.length;t++){var n=r[t];e+="when "+n.predicate.synthesize()+" "+n.consequent.synthesize()+" "}e+="otherwise "+this.otherwise.synthesize();e+=")";return e};return t}(s);t.ChooseNode=v;var g=function(e){r.__extends(t,e);function t(t,r){var n=e.call(this)||this;n.parts=t;n.pos=r;n.type="Interpolation";return n}t.prototype.getChildren=function(){return this.parts.map(function(e){return e.node})};t.prototype.synthesize=function(){var e='"';for(var t=0,r=this.parts;t<r.length;t++){var n=r[t];if(n.type=="string"){e+=T(n.node.value)}else{e+="${"+n.node.synthesize()+"}"}}e+='"';return e};return t}(s);t.InterpolationNode=g;var b=function(e){r.__extends(t,e);function t(t,r){var n=e.call(this)||this;n.args=t;n.pos=r;n.type="Function";return n}t.prototype.getChildren=function(){return this.args};t.prototype.synthesize=function(){var e=this.args,t=e[0],r=e.slice(1);var n=t.synthesize();n+="("+r.map(function(e){return e.synthesize()}).join(", ")+")";return n};return t}(s);t.FunctionNode=b;var x=function(e){r.__extends(t,e);function t(t,r){var n=e.call(this)||this;n.componentId=t;n.pos=r;n.type="CalculatorReference";return n}t.prototype.getChildren=function(){return[]};t.prototype.synthesize=function(){throw new Error("This is a fake node, used only as a placeholder, and should never be synthesized.")};return t}(s);t.CalculatorReferenceNode=x;function S(e){return e.map(function(e){return e.synthesize()}).join("\n")}t.synthesizeScript=S;function T(e){return e.replace(/\\([\s\S])|(")/g,"\\$1$2")}function w(e,t){switch(e.type){case"Boolean":case"Number":case"String":case"Latex":case"Identifier":return t.type==e.type&&a.isEqual(t.value,e.value);case"Interpolation":{var r=e.parts;if(t.type!="Interpolation"){return false}var n=t.parts;if(r.length!=n.length){return false}for(var o=0;o<r.length;o+=1){var s=r[o];var u=n[o];if(!(s.type==u.type&&w(s.node,u.node))){return false}}return true}case"BinaryOperation":return t.type=="BinaryOperation"&&e.operator==t.operator&&w(e.left,t.left)&&w(e.right,t.right);case"SinkAssignment":case"VariableAssignment":return t.type==e.type&&w(e.left,t.left)&&w(e.right,t.right);case"Choose":case"Function":return t.type==e.type&&_(e.getChildren(),t.getChildren());case"CalculatorReference":throw new Error("No calc reference nodes allowed");default:return i.assertUnreachable(e)}}t.nodesEqual=w;function _(e,t){if(e.length!=t.length){return false}for(var r=0;r<e.length;r+=1){if(!w(e[r],t[r])){return false}}return true}t.nodeListsEqual=_});define("core/computation-layer/parser/parselet",["require","exports","tslib","./ast","./helpers"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.FunctionParselet=t.BinaryOperatorParselet=t.WhenParselet=t.BracketParselet=t.StringParselet=t.LatexParselet=t.BooleanParselet=t.NumberParselet=t.IdentifierParselet=t.InfixParselet=void 0;var a=function(){function e(e,t){this.tokenType=e;this.associativity=t}return e}();t.InfixParselet=a;var o=function(){function e(){}e.prototype.parse=function(e,t,r){return new n.IdentifierNode(r.text,i.token2pos(r))};return e}();t.IdentifierParselet=o;var s=function(){function e(){}e.prototype.parse=function(e,t,r){return new n.NumberNode(parseFloat(r.text),i.token2pos(r))};return e}();t.NumberParselet=s;var u=function(){function e(e){this.value=e}e.prototype.parse=function(e,t,r){return new n.BooleanNode(this.value,i.token2pos(r))};return e}();t.BooleanParselet=u;var c=function(){function e(){}e.prototype.parse=function(e,t,r){var a=[];var o={text:"",start:r};while(true){var s=t.consume();if(!s){throw new i.ParseError("Unterminated latex.",i.token2pos(t.last()))}if(s.type=="LATEX_CHARACTERS"){o.text=o.text+s.text;continue}if(s.type=="END_LATEX"){if(a.length){if(o.text.length){a.push(new n.LatexNode({latex:o.text},i.token2pos(o.start,s)))}return new n.FunctionNode([new n.IdentifierNode("latexConcat",i.token2pos(r))].concat(a),i.token2pos(r,s))}else{if(o.text.length){return new n.LatexNode({latex:o.text},i.token2pos(o.start,s))}else{return new n.LatexNode({latex:""},i.token2pos(o.start,s))}}}if(s.type=="BEGIN_LATEX_INTERPOLATION"){if(o.text.length){a.push(new n.LatexNode({latex:o.text},i.token2pos(o.start,s)))}a.push(e.parseTokenStream(t,0));var u=t.expectToken("END_LATEX_INTERPOLATION");o={text:"",start:u};continue}throw new i.ParseError("Expected latex characters or interpolation, but found "+s.type,i.token2pos(s))}};return e}();t.LatexParselet=c;var l=function(){function e(){}e.prototype.parse=function(e,t,r){var a=[];var o={text:"",start:r};while(true){var s=t.consume();if(!s){throw new i.ParseError("Unterminated string.",i.token2pos(t.last()))}if(s.type=="STRING_CHARACTERS"){o.text=o.text+s.text;continue}if(s.type=="END_STRING"){if(a.length){if(o.text.length){a.push({type:"string",node:new n.StringNode(o.text,i.token2pos(o.start,s))})}return new n.InterpolationNode(a,i.token2pos(r,s))}else{if(o.text.length){return new n.StringNode(o.text,i.token2pos(o.start,s))}else{return new n.StringNode("",i.token2pos(o.start,s))}}}if(s.type=="BEGIN_STRING_INTERPOLATION"){if(o.text.length){a.push({type:"string",node:new n.StringNode(o.text,i.token2pos(o.start,s))})}a.push({type:"expr",node:e.parseTokenStream(t,0)});var u=t.expectToken("END_STRING_INTERPOLATION");o={text:"",start:u};continue}throw new i.ParseError("Expected a string or interpolation, but found "+s.text,i.token2pos(s))}};return e}();t.StringParselet=l;var p=function(){function e(){}e.prototype.parse=function(e,t,r){var n=e.parseTokenStream(t,0);t.expectToken(")");return n};return e}();t.BracketParselet=p;var d=function(){function e(){}e.prototype.parse=function(e,t,r){var a=[];while(true){var o=e.parseTokenStream(t,0);var s=e.parseTokenStream(t,0);a.push({predicate:o,consequent:s});var u=t.peek();if(!(u&&u.type=="WHEN")){break}t.consume()}t.expectToken("OTHERWISE");var c=e.parseTokenStream(t,0);return new n.ChooseNode(a,c,i.token2pos(r,t.last()))};return e}();t.WhenParselet=d;var f=function(e){r.__extends(t,e);function t(t,r){var n=e.call(this,t,r)||this;n.tokenType=t;return n}t.prototype.parse=function(e,t,r,a){var o=e.bindingPower(this.tokenType);if(!t.peek()&&this.tokenType=="."){e.partialExpressions.push(new n.BinaryOperationNode(this.tokenType,r,new n.IdentifierNode("",{componentId:r.pos.componentId,stepId:r.pos.stepId,first_line:r.pos.last_line,last_line:a.line,first_column:a.last_column,last_column:a.last_column}),i.join(r.pos,i.token2pos(a))))}var s=e.parseTokenStream(t,this.associativity=="left"?o:o-1);return new n.BinaryOperationNode(this.tokenType,r,s,i.join(r.pos,i.token2pos(t.last())))};return t}(a);t.BinaryOperatorParselet=f;var h=function(e){r.__extends(t,e);function t(){return e.call(this,"(","left")||this}t.prototype.parse=function(e,t,r,a){var o=[r];var s=t.peek();if(s&&s.type==")"){t.consume();return new n.FunctionNode(o,i.join(r.pos,i.token2pos(t.last())))}while(true){o.push(e.parseTokenStream(t,0));var u=t.consume();if(!u){throw new i.ParseError("Unterminated function invocation.",i.token2pos(t.last()))}if(u.type==","){continue}if(u.type==")"){break}throw new i.ParseError('Expected ")" or "," but got '+u.text,i.token2pos(u))}return new n.FunctionNode(o,i.join(r.pos,i.token2pos(t.last())))};return t}(a);t.FunctionParselet=h});define("core/computation-layer/parser/parser",["require","exports","tslib","./parselet","./ast","./helpers"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.TopLevelParser=t.ExpressionParser=t.Parser=void 0;var o=function(){function e(){this.partialExpressions=[];this.bindingPowers={};var e=this.bindingClasses();for(var t=0;t<e.length;t++){for(var r=0,n=e[t];r<n.length;r++){var i=n[r];this.bindingPowers[i]=10*t+9}}for(var a=0,o=Object.keys(this.infixMap);a<o.length;a++){var i=o[a];if(this.bindingPowers[i]==undefined){throw new Error("Token "+i+" defined in infixMap has no associated binding power.\n          Make sure it is also listed in bindingClasses.")}}}e.prototype.bindingPower=function(e){if(this.bindingPowers[e]!=undefined){return this.bindingPowers[e]}else{throw new Error("Tried to parse token type "+e+" with a parser that does not have it defined.")}};e.prototype.parseTokenStream=function(e,t){var r=e.consume();if(!r){throw new a.ParseError("Unexpected end of tokens.",a.token2pos(e.last()))}var n=this.prefixMap()[r.type];if(!n){throw new a.ParseError('Unexpected token "'+r.text+'".',a.token2pos(r))}var i=n.parse(this,e,r);while(true){var o=e.peek();if(!o){break}if(o.type=="("&&o.first_column!=e.last().last_column){break}var s=this.infixMap()[o.type];if(!s){break}if(t>=this.bindingPower(o.type)){break}e.consume();try{i=s.parse(this,e,i,o)}catch(e){this.partialExpressions.push(i);throw e}}this.partialExpressions.push(i);return i};return e}();t.Parser=o;var s={IDENTIFIER:new n.IdentifierParselet,NUMBER:new n.NumberParselet,TRUE:new n.BooleanParselet(true),FALSE:new n.BooleanParselet(false),WHEN:new n.WhenParselet,BEGIN_STRING:new n.StringParselet,BEGIN_LATEX:new n.LatexParselet,"(":new n.BracketParselet};var u={"=":new n.BinaryOperatorParselet("=","left"),">":new n.BinaryOperatorParselet(">","left"),"<":new n.BinaryOperatorParselet("<","left"),">=":new n.BinaryOperatorParselet(">=","left"),"<=":new n.BinaryOperatorParselet("<=","left"),AND:new n.BinaryOperatorParselet("AND","left"),OR:new n.BinaryOperatorParselet("OR","left"),"(":new n.FunctionParselet,".":new n.BinaryOperatorParselet(".","left")};var c=[["AND","OR"],["="],[">","<",">=","<="],["("],["."]];var l=function(e){r.__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.prefixMap=function(){return s};t.prototype.infixMap=function(){return u};t.prototype.bindingClasses=function(){return c};return t}(o);t.ExpressionParser=l;var p={"(":new n.FunctionParselet,".":new n.BinaryOperatorParselet(".","left")};var d=[["("],["."]];var f=function(e){r.__extends(t,e);function t(){var t=e!==null&&e.apply(this,arguments)||this;t.expressionParser=new l;return t}t.prototype.prefixMap=function(){return s};t.prototype.infixMap=function(){return p};t.prototype.bindingClasses=function(){return d};t.prototype.parse=function(e){var t=e.consume();if(!t){throw new a.ParseError("Unexpected end of tokens.",a.token2pos(e.last()))}var r=this.prefixMap()[t.type];if(!r){throw new a.ParseError('Unexpected token "'+t.text+'".',a.token2pos(t))}var n=r.parse(this,e,t);while(true){var o=e.peek();if(!o){break}if(o.type=="("&&o.first_column!=e.last().last_column){break}if(o.type==":"){e.consume();var s=this.expressionParser.parseTokenStream(e,0);return new i.SinkAssignmentNode(n,s,a.join(n.pos,a.token2pos(e.last())))}if(o.type=="="){e.consume();var s=this.expressionParser.parseTokenStream(e,0);return new i.VariableAssignmentNode(n,s,a.join(n.pos,a.token2pos(e.last())))}var u=this.infixMap()[o.type];if(!u){break}e.consume();n=u.parse(this,e,n,o)}throw new a.ParseError("Toplevel declarations must be variable or sink assignments.",a.token2pos(e.last()))};return t}(o);t.TopLevelParser=f});define("core/computation-layer/parser/main",["require","exports","./helpers","./context","./token-stream","./parser"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.parseExpressionForHint=t.parse=void 0;function o(e,t){var o=n.getContext();n.setContext(t);var s=[];var u=new i.TokenStream(e);var c=new a.TopLevelParser;while(u.peek()){try{s.push(c.parse(u))}catch(e){if(e instanceof r.ParseError){return{nodes:s,errors:[{msg:"Syntax Error: "+e.message,componentId:t.componentId,pos:e.pos}]}}else{var l=u.last();var p=l?{first_line:l.line,last_line:l.line,first_column:l.first_column,last_column:l.last_column,componentId:t.componentId}:{first_line:1,last_line:1,first_column:0,last_column:0,componentId:t.componentId};return{nodes:s,errors:[{msg:"Unexpected error: "+e.message,componentId:t.componentId,pos:p}]}}}}n.setContext(o);return{nodes:s,errors:[]}}t.parse=o;function s(e,t){return(e.first_line<t.first_line||e.first_line==t.first_line&&e.first_column<=t.first_column)&&(e.last_line>t.last_line||e.last_line==t.last_line&&e.last_column>=t.last_column)}function u(e,t){if(!s(e.pos,t)){return undefined}if(e.type=="BinaryOperation"&&e.operator=="."){return e}for(var r=0,n=e.getChildren();r<n.length;r++){var i=n[r];var a=u(i,t);if(a){return a}}return undefined}function c(e,t){var r;for(var n=0,i=e;n<i.length;n++){var a=i[n];var o=u(a,t);if(o&&(!r||s(o.pos,r.pos))){r=o}}return r}function l(e,t){var r=n.getContext();n.setContext(t);var o=[];var s=new i.TokenStream(e);var u=new a.ExpressionParser;while(s.peek()){try{o.push(u.parseTokenStream(s,0))}catch(e){o.push.apply(o,u.partialExpressions)}}n.setContext(r);var l=e.split("\n");var p=l.length-1;var d=l[p].length-1;return c(o,{componentId:t.componentId,stepId:t.stepId,first_line:p+1,last_line:p+1,first_column:d,last_column:d})}t.parseExpressionForHint=l});define("core/computation-layer/analyze/types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ComponentError=t.CircularDependencyError=t.StatementError=t.ErrorRecorded=void 0;var r=function(){function e(){this.isError=true}return e}();t.ErrorRecorded=r;var n=function(){function e(e,t){this.message=e;this.errRef=t;this.isError=true}return e}();t.StatementError=n;var i=function(){function e(e){this.errRef=e;this.isError=true;this.message="This statement is part of a circular dependency"}return e}();t.CircularDependencyError=i;var a=function(){function e(e,t){this.message=e;this.componentId=t;this.isError=true}return e}();t.ComponentError=a});define("core/computation-layer/mangle",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.unmangle=t.mangleStatementReference=t.mangleSourceSymbol=t.mangleSinkSymbol=t.mangleVariableSymbol=void 0;function r(e){return JSON.stringify({componentId:e.componentId,symbol:e.symbol})}t.mangleVariableSymbol=r;function n(e){return JSON.stringify({componentId:e.componentId,sinkName:e.sinkName,params:e.params})}t.mangleSinkSymbol=n;function i(e){return JSON.stringify({componentId:e.componentId,sourceName:e.sourceName,params:e.params})}t.mangleSourceSymbol=i;function a(e){return JSON.stringify({componentId:e.componentId,statementIndex:e.statementIndex})}t.mangleStatementReference=a;function o(e){return JSON.parse(e)}t.unmangle=o});define("core/computation-layer/analyze/exports",["require","exports","../parser/ast","../mangle","core/lib/assert-unreachable","./types","../helpers"],function(e,t,r,n,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.analyzeExports=void 0;function s(e){var t={};var r=[];var i={};for(var o in e){var s=e[o];for(var c=0;c<s.length;c++){var l={componentId:o,statementIndex:c};var p=s[c];try{var d=u(p);if(!d){r.push(l)}else{if(!t[d])t[d]=[];t[d].push(l)}}catch(e){if(e instanceof a.StatementError){i[n.mangleStatementReference(l)]=e}else{throw e}}}}var f={};for(var d in t){var h=t[d];if(h.length==1){var y=h[0];f[d]=y;r.push(y)}else{for(var m=0,v=h;m<v.length;m++){var l=v[m];var g=n.unmangle(d);var b=e[l.componentId][l.statementIndex];if(g.symbol){i[n.mangleStatementReference(l)]=new a.StatementError("You can't define "+g.symbol+" in two places",b)}else{i[n.mangleStatementReference(l)]=new a.StatementError("Duplicate definition",b)}}}}return{validExportMap:f,validStatements:r,invalidStatements:i}}t.analyzeExports=s;function u(e){if(e.type=="VariableAssignment"){var t=e.left;if(t.type=="Identifier"){return n.mangleVariableSymbol({componentId:t.pos.componentId,symbol:t.value})}return undefined}if(e.type=="SinkAssignment"){var s=e.left;switch(s.type){case"Identifier":return n.mangleSinkSymbol({componentId:s.pos.componentId,sinkName:s.value,params:[]});case"Function":{var u=s.args,c=u[0],l=u.slice(1);if(c.type!="Identifier")throw new a.StatementError("Expected identifier",e);var p=l.map(function(t){if(!(t instanceof r.ConstantNode)){throw new a.StatementError("All function parameters must be constants.",e)}return o.isCLStringType(t.value)?o.synthesizeStringInternal(t.value):o.isCLLatexType(t.value)?t.value.latex:t.value});return n.mangleSinkSymbol({componentId:s.pos.componentId,sinkName:c.value,params:p})}default:throw new a.StatementError("Unhandled sink type",e)}}return i.assertUnreachable(e)}});define("core/computation-layer/library/patterns.matching",["require","exports","tslib","core/lib/assert-unreachable","core/lib/mathtools","core/lib/evaluator-helpers"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.latexEqual=t.matchPattern=void 0;function o(e,t,r){if(!e||!t){return undefined}if(t.type=="Err"){return undefined}var i=L(r,e);var a=s(t.span);while(t.type=="Paren"){if(i.rejectParens)return undefined;t=t.args[0]}switch(e.type){case"number":return b(e,a,t,i.degreeMode);case"sum":return h(e,a,t,i);case"exponent":return x(e,a,t,i);case"fraction":return S(e,a,t,i);case"division":return T(e,a,t,i);case"negative":return _(e,a,t,i);case"radical":return w(e,a,t,i);case"difference":return I(e,a,t,i);case"product":return y(e,a,t,i);case"contains":return m(e,a,t,i);case"literal":return C(e,a,t);case"expression":return M(e,a,t);case"or":return g(e,a,t,i);case"scientific":return O(e,a,t);case"mixedNumber":return P(e,a,t);default:throw n.assertUnreachable(e)}}t.matchPattern=o;function s(e){return e.input.slice(e.start,e.end)}function u(e,t){var r=JSON.stringify(e,function(e,t){return e=="span"?undefined:t});var n=JSON.stringify(t,function(e,t){return e=="span"?undefined:t});return r==n}function c(e,t,r){var n=[];for(var i=0;i<t.length;i++){var a=t[i];if(a.type=="repeated"){var s={type:"repeated",matches:[]};var u=a.min||0;var c=a.max||Infinity;for(var l=0;l<e.length;l++){var p=e[l];var d=o(a.pattern,p,r);if(d){e.splice(l,1);l--;s.matches.push(d);if(s.matches.length>=c){break}}else if(r.strictOrder){break}}if(s.matches.length<u)return undefined;n.push(s)}else{var f=false;for(var l=0;l<e.length;l++){var p=e[l];var d=o(a,p,r);if(d){f=true;e.splice(l,1);n.push(d);break}if(r.strictOrder)break}if(!f)return undefined}}if(e.length>0){return undefined}return n}function l(e,t){if(e.type=="Paren"&&!t.rejectParens){return l(e.args[0],t)}if(e.type=="Add"){return r.__spreadArrays(l(e.args[0],t),l(e.args[1],t))}return[e]}function p(e){var t=[];for(var r=0,n=D(e.terms)||[];r<n.length;r++){var i=n[r];if(i.type=="sum"){t.push.apply(t,p(i))}else{t.push(i)}}return t}function d(e){switch(e.type){case"Paren":return d(e.args[0]);case"Mul":case"Juxt":case"Call":return r.__spreadArrays(d(e.args[0]),d(e.args[1]));case"Superscript":{var t=e.args[0];if(t.type!=="Call")return[e];return r.__spreadArrays(d(t.args[0]),d({type:"Superscript",args:[t.args[1],e.args[1]],span:{input:t.args[0].span.input,start:t.args[0].span.end,end:e.args[1].span.end}}))}default:return[e]}}function f(e){var t=[];for(var r=0,n=e.terms||[];r<n.length;r++){var i=n[r];if(i.type=="product"){t.push.apply(t,f(i))}else{t.push(i)}}return t}function h(e,t,n,i){if(!n)return undefined;var a=c(l(n,i),p(e),r.__assign(r.__assign({},i),{strictOrder:!!e.strictOrder}));return a?{type:"sum",latex:t,terms:A(a)}:undefined}function y(e,t,n,i){if(!n)return undefined;var a=c(d(n),f(e),r.__assign(r.__assign({},i),{strictOrder:!!e.strictOrder}));return a?{type:"product",latex:t,terms:A(a)}:undefined}function m(e,t,r,n){var i=v(R(e.terms[0]),r,n);return i?{type:"contains",latex:t,terms:[N(i)]}:undefined}function v(e,t,r){if(t==undefined)return undefined;var n=o(e,t,r);if(n)return n;if(t.type=="Letter"||t.type=="Decimal"||t.type=="MixedNumber"||t.type==="EmptyRangeEnd"){return}if(t.type=="InequalityChain"||t.type=="EmptyPiecewise"||t.type=="Cmd"){return}else{for(var i=0,a=t.args||[];i<a.length;i++){var s=a[i];if(s.type=="Alphanumeric")return;var u=v(e,s,r);if(u)return u}}return undefined}function g(e,t,r,n){for(var i=0,a=e.options;i<a.length;i++){var s=a[i];if(o(R(s),r,n)){return{type:"or",latex:t}}}return undefined}function b(e,t,r,n){if(r.type=="Neg"){r=r.args[0]}if(r.type=="Decimal"||r.type=="MixedNumber"){if(e.integerOnly||e.conditions){var o=a.computeNumericValueFromLatex(t,n);if(e.integerOnly&&o%1!=0)return undefined;if(e.conditions){for(var s=0,u=e.conditions;s<u.length;s++){var c=u[s];var l=new i.context;l.processChangeSet({statements:[{id:"condition",latex:"f(x)=\\{"+c+"\\}"}],degreeMode:n});var p=i.parser.parse("f("+t+")");var d=p.tryGetConcreteTree(i.policies.graphing,l.frame);var f=d.asValue();if(f!=1)return undefined}}}return{type:"number",latex:t}}return undefined}function x(e,t,r,n){if(r.type=="Superscript"){var i=o(R(e.base),r.args[0],n);var a=o(R(e.power),r.args[1],n);return i&&a?{type:"exponent",base:N(i),power:N(a),latex:t}:undefined}return undefined}function S(e,t,r,n){if(r.type=="Frac"){var i=o(R(e.numerator),r.args[0],n);var a=o(R(e.denominator),r.args[1],n);return i&&a?{type:"fraction",numerator:N(i),denominator:N(a),latex:t}:undefined}return undefined}function T(e,t,r,n){if(r.type=="Div"){var i=o(R(e.dividend),r.args[0],n);var a=o(R(e.divisor),r.args[1],n);return i&&a?{type:"division",divisor:N(a),dividend:N(i),latex:t}:undefined}return undefined}function w(e,t,r,n){if(e.degree){if(r.type!="Nthroot")return undefined;var i=o(R(e.degree),r.args[0],n);var a=o(R(e.radicand),r.args[1],n);return a&&i?{type:"radical",latex:t,radicand:N(a),degree:N(i)}:undefined}else{if(r.type!="Sqrt")return undefined;var a=o(R(e.radicand),r.args[0],n);return a?{type:"radical",latex:t,radicand:N(a)}:undefined}}function _(e,t,r,n){if(r.type!="Neg")return undefined;var i=o(R(e.negated),r.args[0],n);return i?{type:"negative",latex:t,negated:N(i)}:undefined}function I(e,t,r,n){if(r.type=="Sub"){var i=o(R(e.minuend),r.args[0],n);var a=o(R(e.subtrahend),r.args[1],n);return a&&i?{type:"difference",subtrahend:N(a),minuend:N(i),latex:t}:undefined}return undefined}function E(e,t){var r=i.expressionParser.parse(e);var n=i.expressionParser.parse(t);if(r.type=="Err"||n.type=="Err"){return false}return u(r,n)}t.latexEqual=E;function C(e,t,r){var n=i.expressionParser.parse(e.text);if(n.type=="Err"){return undefined}if(u(n,r)){return{type:"literal",latex:t}}return undefined}function M(e,t,r){if(r.type=="Err")return undefined;return{type:"expression",latex:t}}function k(e){var t=1;if(e.type=="Neg"){e=e.args[0];t=-1}if(e.type!="Decimal")return undefined;var r=parseFloat(s(e.span));if(r<1)return undefined;if(r>=10)return undefined;return r*t}function P(e,t,r){if(r.type!="MixedNumber")return undefined;return{type:"mixedNumber",latex:t,whole:+r.whole,numerator:+r.num,denominator:+r.den}}function O(e,t,r){if(r.type!="Mul")return undefined;var n=r.args[1];if(n.type!="Superscript")return undefined;var i=k(r.args[0]);if(i==undefined)return undefined;var a=n.args[0];if(a.type!="Decimal")return undefined;if(parseFloat(s(a.span))!=10)return undefined;var o=n.args[1];var u=1;if(o.type=="Neg"){u=-1;o=o.args[0]}if(o.type!="Decimal")return undefined;var c=parseFloat(s(o.span));if(c!=Math.round(c))return undefined;return{type:"scientific",latex:t,coefficient:i,exponent:c*u}}function L(e,t){var n={};if("rejectParens"in t){n.rejectParens=!!t.rejectParens}if("strictOrder"in t){n.strictOrder=!!t.strictOrder}return r.__assign(r.__assign({},e),n)}function N(e){return e}function A(e){return e}function D(e){return e}function R(e){return e}});define("core/computation-layer/library/builtin",["require","exports","underscore","core/lib/i18n","../helpers","./patterns.matching","core/computation-layer/cl-types"],function(e,t,r,n,i,a,o){"use strict";var s,u;Object.defineProperty(t,"__esModule",{value:true});t.castStringToLatex=t.castLatexToString=t.library=t.INTERPOLATE_FN_NAME=t.STRING_INTERP_FN_NAME=t.STRING_CONCAT_FN_NAME=void 0;t.STRING_CONCAT_FN_NAME="stringConcat";t.STRING_INTERP_FN_NAME="stringInterpolation";t.INTERPOLATE_FN_NAME="interpolate";t.library={functions:(s={copy:{internal:true,version:"v2",description:function(){return n.EMPTY},lookup:function(e){if(e.length!==1){throw Error("Copy function only accepts one argument")}return{valueType:e[0].type,body:function(e){return e}}}}},s[t.STRING_CONCAT_FN_NAME]={internal:true,description:function(){return n.EMPTY},version:"v2",lookup:function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if(!(o.Types.string.matches(n.type)||o.Types.number.matches(n.type)||o.Types.latex.matches(n.type))){throw Error("Unexpected type in string: "+n.type)}}return{valueType:o.Types.string,body:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r=[];for(var n=0,a=e;n<a.length;n++){var o=a[n];if(i.isCLStringType(o)){r.push.apply(r,o.parts)}else{r.push(o)}}return{type:"string",parts:r}}}}},s[t.STRING_INTERP_FN_NAME]={internal:true,description:function(){return n.EMPTY},version:"v2",lookup:function(e){for(var r=0,n=e;r<n.length;r++){var a=n[r];if(!(o.Types.string.matches(a.type)||o.Types.number.matches(a.type))){throw Error("Unexpected type in "+t.STRING_INTERP_FN_NAME+": "+a.type)}}return{valueType:o.Types.partialInterpolation,body:function(){var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}var n=[];for(var a=0,o=e;a<o.length;a++){var s=o[a];if(i.isCLStringType(s)){if(!(s.parts.length==1&&typeof s.parts[0]=="string")){throw new Error("stringInterpolation expects only plain strings")}n.push(s.parts[0])}else if(typeof s=="number"){if(s<0||s%1!=0){throw new Error("stringInterpolation expects positive integers, but got "+s)}n.push(s)}else{throw new Error("Unexpected value in "+t.STRING_INTERP_FN_NAME+": "+s)}}return{parts:n}}}}},s.latexConcat={internal:true,description:function(){return n.EMPTY},version:"v2",lookup:function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if(!(o.Types.number.matches(n.type)||o.Types.latex.matches(n.type))){throw Error("Unexpected type in latex interpolation: "+n.type)}}return{valueType:o.Types.latex,body:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r="";for(var n=0,a=e;n<a.length;n++){var o=a[n];if(o==undefined||typeof o=="number"&&isNaN(o)){r+="undefined"}else if(i.isCLStringType(o)){r+=i.synthesizeStringInternal(o)}else if(i.isCLLatexType(o)){r+=o.latex}else{r+=o}}return{latex:r}}}}},s.choose={internal:true,version:"v2",description:function(){return n.EMPTY},lookup:function(e){var t;if(e.length<3)throw new Error("Incomplete when/otherwise clause");var n=(t=r.partition(e,function(t,r){return!!(r%2)||r+1===e.length}),t[0]),i=t[1];for(var a=0,s=i;a<s.length;a++){var u=s[a];if(!o.Types.boolean.matches(u.type)){throw new Error("Every 'when' must be followed by a boolean condition")}}var c=n[0].type;if(c.matches(o.Types.latex)&&r.any(n,function(e){return e.type.matches(o.Types.string)})){c=o.Types.string}var l=[];for(var p=0,d=n;p<d.length;p++){var f=d[p];if(!c.matches(f.type)){if(c.matches(o.Types.string)&&f.type.matches(o.Types.latex)){}else{throw Error("Mismatched types in choose - "+c.toString()+" and "+f.toString()+" differ")}}}return{valueType:c,warnings:l,desiredArgTypes:r.range(e.length).map(function(t){if(!!(t%2)||t+1==e.length){return c}else{return o.Types.boolean}}),body:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r,n,i,a,o;o=e.slice(0,-1);for(n=i=0,a=o.length;i<a;n=i+=2){r=o[n];if(r){return e[n+1]}}return e[e.length-1]}}}},s.and={version:"v3",internal:true,description:function(){return n.i18n.s("cl-docs-description-lib-and")},argTypes:[o.Types.boolean,o.Types.boolean],outputType:o.Types.boolean,value:function(e,t){return e&&t}},s.or={version:"v3",internal:true,description:function(){return n.i18n.s("cl-docs-description-lib-or")},argTypes:[o.Types.boolean,o.Types.boolean],outputType:o.Types.boolean,value:function(e,t){return e||t}},s.not={version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-not")},argTypes:[o.Types.boolean],outputType:o.Types.boolean,noUndefinedArgs:true,value:function(e){return!e}},s.isDefined={version:"v2",description:function(){return n.i18n.s("cl-docs-description-lib-is-defined")},lookup:function(e){if(e.length!==1){throw Error("isDefined takes a 1 argument.  I got "+e.length)}return{valueType:o.Types.boolean,body:function(e){return e!=null&&!r.isNaN(e)}}}},s.isUndefined={version:"v2",description:function(){return n.i18n.s("cl-docs-description-lib-is-undefined")},lookup:function(e){if(e.length!==1){throw Error("isUndefined takes a 1 argument.  I got "+e.length)}return{valueType:o.Types.boolean,body:function(e){return!(e!=null)||r.isNaN(e)}}}},s.firstDefinedValue={version:"v2",description:function(){return n.i18n.s("cl-docs-description-lib-first-defined-value")},lookup:function(e){if(e.length==0){throw new Error("firstDefinedValue requires at least one argument.")}var t=e[0].type;if(r.any(e,function(e){return e.type.matches(o.Types.string)})){t=o.Types.string}var n=[];for(var i=0,a=e;i<a.length;i++){var s=a[i];if(!t.matches(s.type)){if(t.matches(o.Types.string)&&s.type.matches(o.Types.latex)){}else{throw new Error("All arguments to firstDefinedValue must be the same type"+(t.type+" doesn't match "+s.type.type))}}}return{valueType:t,warnings:n,desiredArgTypes:r.range(e.length).map(function(){return t}),body:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var n,i,a;for(n=0,i=e.length;n<i;n++){a=e[n];if(a!=null&&!r.isNaN(a)){return a}}return void 0}}}},s.eq={version:"v2",description:function(){return n.EMPTY},internal:true,lookup:function(e){var t,r;if(e.length!==2){throw Error("Equality test requires two objects.  I got "+e.length)}t=e[0].type;r=e[1].type;var n=t;if(!(t.matches(o.Types.number)||t.matches(o.Types.string)||t.matches(o.Types.latex))){throw Error("Equality checks only work for numbers, strings and latex right now")}if(n.matches(o.Types.latex)){n=o.Types.string}var s=[];for(var u=0,c=e;u<c.length;u++){var l=c[u];var p=l.type;if(!p.matches(n)){if(p.matches(o.Types.latex)&&n.matches(o.Types.string)){}else{throw Error("Objects of different types are never equal (in this case "+t+" and "+r)}}}return{valueType:o.Types.boolean,warnings:s,desiredArgTypes:[t,r],body:function(e,t){if(e==undefined||t==undefined){return false}if(i.isCLLatexType(e)&&i.isCLLatexType(t)){return a.latexEqual(e.latex,t.latex)}var r=i.isCLStringType(e)?i.synthesizeStringInternal(e):i.isCLLatexType(e)?e.latex:e;var n=i.isCLStringType(t)?i.synthesizeStringInternal(t):i.isCLLatexType(t)?t.latex:t;return r===n}}}},s.isBlank={version:"v2",description:function(){return n.i18n.s("cl-docs-description-lib-is-blank")},lookup:function(e){if(e.length!=1){throw new Error("isBlank expects a single parameter")}if(!(o.Types.string.matches(e[0].type)||o.Types.latex.matches(e[0].type))){throw new Error("isBlank accepts a string or latex, but got "+e[0].type)}return{valueType:o.Types.boolean,body:function(e){if(e==undefined){return true}var t;if(i.isCLLatexType(e)){t=e.latex.trim()}else if(i.isCLStringType(e)){t=i.synthesizeStringInternal(e).trim()}else{throw new Error("Internal error. isBlank expected argument of string or latex type but got "+e)}return t.length==0}}}},s),types:{partialInterpolation:{internal:true,description:function(){return n.EMPTY},attributes:(u={},u[t.INTERPOLATE_FN_NAME]={internal:true,version:"v2",description:function(){return n.EMPTY},lookup:function(e){var t=e.map(function(e){return e.type}).slice(1).slice(0);for(var r=0,n=t;r<n.length;r++){var a=n[r];if(!(o.Types.string.matches(a)||o.Types.number.matches(a)||o.Types.latex.matches(a))){throw Error("Unexpected type in partialInterpolation.interpolate: "+a)}}return{valueType:o.Types.string,body:function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}var n=[];for(var a=0,o=e.parts;a<o.length;a++){var s=o[a];if(typeof s=="string"){n.push(s)}else if(typeof s=="number"){var u=t[s-1];if(i.isCLStringType(u)){n.push.apply(n,u.parts)}else{n.push(u)}}else{throw new Error("Unexpected part type in partialInterpolation: "+typeof s)}}return{type:"string",parts:n}}}}},u)}},constants:{}};function c(e,r,i){t.library.functions[e]={internal:true,version:"v2",description:function(){return n.EMPTY},lookup:function(e){if(e.length!==2){throw Error(r+" operator requires two objects.  I got "+e.length)}var t=e[0].type;var n=e[1].type;if(!(o.Types.number.matches(t)&&o.Types.number.matches(n))){throw Error(r+" operator can only compare numbers. I see '"+t+" "+r+" "+n+"'")}return{valueType:o.Types.boolean,body:i}}}}c("gt",">",function(e,t){return e>t});c("gte",">=",function(e,t){return e>=t});c("lt","<",function(e,t){return e<t});c("lte","<=",function(e,t){return e<=t});function l(e){return e?{type:"string",parts:[e]}:undefined}t.castLatexToString=l;function p(e){return e?{latex:i.synthesizeStringInternal(e)}:undefined}t.castStringToLatex=p});define("core/computation-layer/analyze/helpers",["require","exports","underscore","../parser/ast","./types","../cl-types","../helpers"],function(e,t,r,n,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.enforceNoUndefinedArgs=t.isMemberAccess=t.analyzeParams=void 0;function s(e,t,r,s){if(e.length>t.length){s({msg:"Expected "+t.length+" parameters but got "+e.length+'"',componentId:r.pos.componentId,pos:r.pos,warning:true})}var u=[];for(var c=0;c<t.length;c++){var l=e[c];var p=t[c];if(l==null){if(p.default!=null){if(o.isCLStringType(p.default)){u.push(o.synthesizeStringInternal(p.default))}else{u.push(p.default)}continue}else{throw new i.StatementError("Missing required parameter "+(c+1)+" ("+p.name+":"+p.type+")",r)}}if(!(l instanceof n.ConstantNode)){throw new i.StatementError("Parameters to sinks and sources must be constants",l)}var d=void 0;if(l.valueType.matches(p.type)){d=l.value}else{if(a.Types.string.matches(l.valueType)&&a.Types.number.matches(p.type)&&l.value.match("^[0-9]+$")){s({msg:"The "+p.name+" parameter should be a number, not a string (no quotes)",componentId:l.pos.componentId,pos:l.pos,warning:true});d=parseInt(l.value)}else if(a.Types.string.matches(p.type)&&a.Types.latex.matches(l.valueType)){d=l.value.latex}else if(a.Types.latex.matches(p.type)&&a.Types.string.matches(l.valueType)){d={latex:l.value}}else{throw new i.StatementError('Expected parameter "'+p.name+'" to be a '+p.type+", but got "+l.valueType,l)}}if(p.validate){var f=void 0;switch(p.type){case a.Types.boolean:f=p.validate(d);break;case a.Types.number:f=p.validate(d);break;case a.Types.string:f=p.validate({type:"string",parts:[d]});break;case a.Types.latex:f=p.validate(d);break;default:throw new Error("Unexpected type")}switch(f.result){case"ok":break;case"warn":s({msg:f.msg,componentId:l.pos.componentId,pos:l.pos,warning:true});break;case"error":throw new i.StatementError(f.msg,l)}}u.push(d)}return u}t.analyzeParams=s;function u(e){return e.type=="BinaryOperation"&&e.operator=="."}t.isMemberAccess=u;function c(e){return function(){var t=[];for(var n=0;n<arguments.length;n++){t[n]=arguments[n]}if(r.any(t,function(e){return e==undefined})){return undefined}return e.apply(void 0,t)}}t.enforceNoUndefinedArgs=c});define("core/computation-layer/analyze/sinks",["require","exports","../parser/ast","../cl-types","./types","./helpers","core/lib/log"],function(e,t,r,n,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.analyzeSink=t.analyzeSinks=void 0;function s(e,t,n){var a=[];for(var s in e){var c=e[s];for(var l=0;l<c.length;l++){var p={componentId:s,statementIndex:l};var d=c[l];if(d instanceof r.SinkAssignmentNode){try{var f=u(d.left,t,p,n);a.push(f)}catch(e){if(e instanceof i.StatementError){o.log("Ignoring error in analyzeSinks"+JSON.stringify(e))}else{throw e}}}}}return a}t.analyzeSinks=s;function u(e,t,r,n){var o;var s=[];var u;switch(e.type){case"Function":{var c=void 0;o=e.args,c=o[0],s=o.slice(1);if(c.type!="Identifier")throw new i.StatementError("Couldn't understand this sink declaration",e);u=c.value;break}case"Identifier":u=e.value;break;default:throw new i.StatementError("Couldn't understand this sink declaration",e)}var l=e.pos.componentId;var p=t[l];if(!p){throw{msg:"Internal CL Error.  Could not find component '"+l+"'",componentId:l}}if(!p.sinks){throw new i.StatementError("There's no way to control this component with CL yet",e)}var d=p.sinks.getSinkSpec(u);if(d==null){throw new i.StatementError('Could not find sink "'+u+'". '+p.sinks.getAvailableSinksMessage(),e)}var f=d.params||[];var h=a.analyzeParams(s,f,e,n);return{componentId:l,sinkName:u,paramValues:h,ref:r,sinkSpec:d}}function c(e,t,r){var o;var s;var u=r.nodes[t];if(!u){throw new Error("Internal error - node "+t+" not found")}var c=[];switch(e.type){case"Function":{var p=void 0;o=e.args,p=o[0],c=o.slice(1);if(p.type!="Identifier"){throw new i.StatementError("Couldn't understand this sink declaration",e)}s=p.value;break}case"Identifier":s=e.value;break;default:throw new i.StatementError("Couldn't understand this sink declaration",e)}var d=r.components[e.pos.componentId];if(!d){throw new i.ComponentError("Internal CL Error.  Could not find component '"+e.pos.componentId+"'",e.pos.componentId)}if(!d.sinks){throw new i.StatementError("There's no way to control this component with CL yet",e)}var f=d.sinks.getSinkSpec(s);if(f==null){throw new i.StatementError('Could not find sink "'+s+'". '+d.sinks.getAvailableSinksMessage(),e)}var h=f.params||[];var y=a.analyzeParams(c,h,e,function(e){return r.error(e)});var m=t;var v=l(f,y,d.config||{});if(!v.matches(u.valueType)){if(v.matches(n.Types.latex)&&n.Types.string.matches(u.valueType)){m=r.castStringToLatex(t)}else if(v.matches(n.Types.string)&&n.Types.latex.matches(u.valueType)){m=r.castLatexToString(t)}else{throw new i.StatementError('Sink "'+f.name+'" expects a '+v+" but got a "+u.valueType,e)}}var g=r.sinks[e.pos.componentId];if(!g){g=r.sinks[e.pos.componentId]={}}var b=g[s];if(!b){b=g[s]=[]}b.push({componentId:e.pos.componentId,sinkName:s,validator:v,params:y,dependencies:[m]});return}t.analyzeSink=c;function l(e,t,r){if(e.analyzeValueType.type=="concrete"){return e.analyzeValueType.validator}else{return e.analyzeValueType.analyze(t,r).valueType}}});define("core/random-seed",["require","exports","tslib"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.bypassRandomSeed=t.populateRandomSeed=t.RandomSeed=void 0;var n=function(){function e(e){this.seed=e}e.prototype.toString=function(){return this.seed};e.fromString=function(t){return new e(t)};return e}();t.RandomSeed=n;function i(e,t){if(!e){return undefined}var n=e.randomSeed;var i=t.toString();if(n&&n.substr(n.length-i.length)==i){throw new Error("Attempted to repeatedly apply random seed.")}return r.__assign(r.__assign({},e),{randomSeed:n+":"+i})}t.populateRandomSeed=i;function a(e){return e}t.bypassRandomSeed=a});define("core/computation-layer/analyze/source",["require","exports","tslib","./types","./helpers","core/random-seed","underscore","../cl-types","../helpers"],function(e,t,r,n,i,a,o,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.registerControllerSource=t.registerResponseSource=t.analyzeCalculatorReference=t.analyzeSource=void 0;function c(e,t,r,a){if(t.type!="Identifier"){throw new n.StatementError("The value after the dot must be the name of a source - this looks more complicated",t)}var s=t.value;var u=a.components[e];var c=u&&u.alias;if(e==null){var h=o.keys(a.componentAliasMap);var y=h.length===0?"To refer to data from other components, you need to give them\n    a name.  You haven't named any components yet.":"The components you've named so far are\n    "+JSON.stringify(h)+".";throw new n.StatementError('Could not find component "'+c+'". '+y,t)}var v=a.components[e];if(v==null){throw new n.StatementError("Internal CL error- could not find component for id",t)}var b=v.sources&&v.sources[s];if(b==null){var x=m(v);var S=x.length===0?"It actually doesn't have any sources at all.  Sorry about that.":"Your options are "+JSON.stringify(x)+".";throw new n.StatementError('Component "'+c+'" has no source "'+s+'".  '+S,t)}var T=i.analyzeParams(r,b.params||[],t,function(e){return a.error(e)});var w=d(b,T,e,a);var _=b.computeFromResponse,I=b.analyzeSinkSourceDependencies;var E=b.publishedBy&&a.env.publishersAvailable.indexOf(b.publishedBy)>=0;if(_&&!E){return l({componentId:e,sourceName:s,sourceComponent:v,valueType:w,paramValues:T,sourceSpec:b,analysis:a})}else if(I&&!E){return p({componentId:e,sourceName:s,sourceNode:t,paramValues:T,sourceSpec:b,analysis:a,valueType:w})}else{if(I){f({componentId:e,sourceSpec:b,sourceNode:t,paramValues:T,analysis:a,valueType:w})}return g({type:"controllerSource",sourceName:s,componentId:e,params:T,valueType:w},a)}}t.analyzeSource=c;function l(e){var t=e.analysis,r=e.componentId,n=e.paramValues,i=e.sourceComponent,o=e.sourceName,s=e.sourceSpec,c=e.valueType;var l=y(r,o,t);var p=i.config||{};return t.registerNode({type:"function",name:o+JSON.stringify(n),hash:r+":"+o+":"+JSON.stringify(n),fn:function(e,t,r){return s.computeFromResponse(r,{config:p,params:n,valueType:c,randomSeed:a.RandomSeed.fromString(u.synthesizeStringInternal(e)),degreeMode:t})},valueType:c,dependencies:["randomSeedNodeId","degreeModeNodeId",l]})}function p(e){var t=e.analysis,n=e.componentId,i=e.paramValues,o=e.sourceName,s=e.sourceNode,c=e.sourceSpec,l=e.valueType;var p=y(n,o,t);var d=f({componentId:n,sourceSpec:c,sourceNode:s,paramValues:i,analysis:t,valueType:l}),h=d.sinkDependencies,m=d.sourceFunction,v=d.sinkNodeIds;if(typeof m==="function"){return t.registerNode({type:"function",name:o+JSON.stringify(i),hash:n+":"+o+":"+JSON.stringify(i),fn:function(e,r,n){var i=[];for(var o=3;o<arguments.length;o++){i[o-3]=arguments[o]}var s={};for(var c=0;c<h.length;c++){var l=h[c];var p=i[c];var d=l.sinkName;if(s[d]==undefined)s[d]=[];s[d].push({value:p,params:l.paramValues,valueType:t.nodes[v[c]].valueType})}return m({randomSeed:a.RandomSeed.fromString(u.synthesizeStringInternal(e)),response:n,sinks:s,degreeMode:r})},valueType:l,dependencies:r.__spreadArrays(["randomSeedNodeId","degreeModeNodeId",p],v)})}else{var g=t.registerNode({type:"placeholder-source",valueType:l,sourceName:o,componentId:n,params:i,responseSourceNodeId:p,sinkDependencies:h.map(function(e,t){return{sinkSummary:e,nodeId:v[t]}}),analysisData:m.componentLevelAnalysisData});t.placeholderSourceNodes[n]=t.placeholderSourceNodes[n]||[];t.placeholderSourceNodes[n].push(g);return g}}function d(e,t,r,n){if(e.analyzeValueType.type=="concrete"){return e.analyzeValueType.valueType}else{var i=n.components[r];var a=e.analyzeValueType.analyze(t,i.config||{});return a.valueType}}function f(e){var t=e.analysis,r=e.componentId,i=e.sourceSpec,a=e.sourceNode,s=e.paramValues,u=e.valueType;var c=[];var l=t.sinkSummaries.filter(function(e){return e.componentId==r}).map(function(e){return{name:e.sinkName,params:e.paramValues,registerDependency:function(){c.push(e)}}});var p=t.components[r];var d=i.analyzeSinkSourceDependencies;if(!d){throw new Error("analyzeSourceNoController called with a source that does not define analyzeSinkSourceDependencies")}var f=d({sinks:l,params:s,config:p.config||{},valueType:u,warn:function(e){return t.error({msg:e,componentId:a.pos.componentId,pos:a.pos,warning:true})}});for(var h=0,y=c;h<y.length;h++){var m=y[h];try{t.analyzeStatement(m.ref)}catch(e){}}var v=[];for(var g=0,b=c;g<b.length;g++){var x=b[g];var S=false;var T=t.sinks[x.componentId];if(T){var w=T[x.sinkName];if(w){for(var _=0,I=w;_<I.length;_++){var E=I[_];if(o.isEqual(E.params,x.paramValues)){v.push(E.dependencies[0]);S=true}}}}if(!S){var C=void 0;if(x.paramValues.length>1)C=x.sinkName+"("+x.paramValues.map(function(e){return JSON.stringify(e)}).join(", ")+")";else C=x.sinkName;throw new n.StatementError("This source depends on sink "+C+", which has an error",a)}}return{sourceFunction:f,sinkDependencies:c,sinkNodeIds:v}}function h(e,t){var r=e.componentId;var i=t.components[r];if(i==undefined){throw new n.StatementError("Unable to find component "+r+" from rawSource",e)}var a="calculatorState";var o=i.sources&&i.sources[a];if(o==undefined)throw new n.StatementError("Unable to find source "+a+" from rawSource",e);return p({componentId:r,sourceName:a,sourceNode:e,paramValues:[],valueType:s.Types.calculatorStateWithSinkValues,sourceSpec:o,analysis:t})}t.analyzeCalculatorReference=h;function y(e,t,r){var n=r.responseSources[e];if(n)return n;var i=r.registerNode({type:"responseSource",componentId:e,valueType:s.Types.response});r.responseSources[e]=i;v(e,t,r);return i}t.registerResponseSource=y;function m(e){var t=[];if(e.sources==undefined)return t;for(var r in e.sources){if(e.sources[r].internal)continue;t.push(r)}return t}function v(e,t,r){if(!r.sourcesUsed[e]){r.sourcesUsed[e]={}}r.sourcesUsed[e][t]=true}function g(e,t){var r=t.registerNode(e);if(t.controllerSources.indexOf(r)<0){t.controllerSources.push(r)}v(e.componentId,e.sourceName,t);return r}t.registerControllerSource=g});define("core/computation-layer/analyze/expression",["require","exports","tslib","../parser/ast","./source","../cl-types","./types","../library/builtin","underscore","core/lib/assert-unreachable","./helpers"],function(e,t,r,n,i,a,o,s,u,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.analyzeExpression=void 0;function p(e,t){switch(e.type){case"Number":case"Boolean":case"String":case"Latex":return d(e,t);case"Interpolation":return b(e,t);case"BinaryOperation":return v(e,t);case"Identifier":return w(e,t);case"Function":return I(e,t);case"Choose":return f(e,t);case"CalculatorReference":return i.analyzeCalculatorReference(e,t);default:return c.assertUnreachable(e)}}t.analyzeExpression=p;function d(e,t){if(e.type=="Latex"){var n=void 0;var i=/\\\\/g;while((n=i.exec(e.value.latex))!=undefined){t.error({msg:"Escaping slashes in latex string literals is no longer necessary or supported.",componentId:e.pos.componentId,pos:r.__assign(r.__assign({},e.pos),{first_column:e.pos.first_column+n.index+1,last_column:e.pos.first_column+n.index+3}),warning:true})}}var a;if(e.type=="String"){a={type:"string",parts:[e.value]}}else{a=e.value}var o=t.registerNode({type:"constant",valueType:e.valueType,value:a});if(e.type=="String"){t.registerTranslationNode({nodeId:o,pos:e.pos})}return o}function f(e,t){var r=t.library.functions["choose"];if(r==null){throw new o.StatementError("CL error - choose not found in standard library",e)}var n=[];for(var i=0,a=e.cases;i<a.length;i++){var s=a[i],u=s.predicate,c=s.consequent;n.push(u,c)}n.push(e.otherwise);return x("choose",e,r,n,t)}function h(e,t){if(e.args.length!=2){throw new o.StatementError("Aggregations require a single argument.",e)}var r=p(e.args[1],t);var n=t.nodes[r];var s=n.valueType;if(!a.Types.number.matches(s)){throw new o.StatementError("Right now we can only aggregate numbers",e)}var u=t.locationManager.registerLocation({type:"aggregate",scriptId:e.pos.componentId,first_line:e.pos.first_line,first_column:e.pos.first_column});var c=t.sinks["aggregate"];if(!c){c=t.sinks["aggregate"]={}}var l=c["aggregateSink"];if(!l){l=c["aggregateSink"]=[]}l.push({componentId:"aggregate",sinkName:"aggregateSink",validator:a.Types.numberList,params:[u],dependencies:[r]});return i.registerControllerSource({type:"controllerSource",componentId:"aggregate",sourceName:"aggregateSource",valueType:a.Types.numberList,params:[u]},t)}function y(e,t,r){if(e.args.length!=2){throw new o.StatementError("imports require a single argument.",e)}var i=e.args[1];if(!i){throw new o.StatementError("Missing required import key.",e)}if(!(i instanceof n.ConstantNode&&a.Types.string.matches(i.valueType))){throw new o.StatementError("imports require an importKey parameter that is a contstant string",i)}var s=i.value;var u=t.importSources[s];if(u){var l=t.nodes[u];if(r!=l.type){throw new o.StatementError("importKey "+s+" was used to import different types of values.",i)}return u}var p;switch(r){case"importNumber":p=t.registerNode({type:"importNumber",importKey:s,valueType:a.Types.number});break;case"importString":p=t.registerNode({type:"importString",importKey:s,valueType:a.Types.string});break;case"importNumberList":p=t.registerNode({type:"importNumberList",importKey:s,valueType:a.Types.numberList});break;default:return c.assertUnreachable(r)}t.importSources[s]=p;return p}var m={".":undefined,"=":"eq","<":"lt",">":"gt","<=":"lte",">=":"gte",AND:"and",OR:"or"};function v(e,t){if(e.operator=="."){var r=p(e.left,t);return g(r,e.right,[],t)}var n=m[e.operator];var i=n&&t.library.functions[n];if(!i||!n){throw new o.StatementError("Operator "+e.operator+" is not mapped to a library function.",e)}return x(n,e,i,[e.left,e.right],t)}function g(e,t,r,n){if(t.type!="Identifier"){throw new o.StatementError('Only identifiers can follow a ".", this looks more complicated',t)}var a=n.nodes[e];if(!a){throw new Error("Unexpected nodeId "+e)}if(a.valueType.type=="component"){var s=a.valueType.params.componentId;if(t.value=="script"){if(r.length>0){throw new o.StatementError("The .script call doesn't take any arguments.",t)}return n.resolveComponentScript(s)}return i.analyzeSource(s,t,r,n)}if(a.valueType.type=="componentScript"){var s=a.valueType.params.componentId;var u=n.resolveVariable(t.value,s,t);if(!u){var c=n.components[s];var l=c&&c.alias;throw new o.StatementError("Unable to find variable "+t.value+(l?" in component "+l:""),t)}else{return u}}var p=n.library.types[a.valueType.type];if(p==null){throw new o.StatementError("There are no supported members of type "+a.valueType,t)}var d=p.attributes[t.value];if(d==null){throw new o.StatementError("Type "+a.valueType+" has no member "+t.value,t)}var f=[e];f.push.apply(f,r);return x(t.value,t,d,f,n,true)}function b(e,t){var r=t.library.functions[s.STRING_CONCAT_FN_NAME];if(!r){throw new Error("Expected "+s.STRING_CONCAT_FN_NAME+" function to exist.")}var n=e.parts.map(function(e){return e.node});var i=S(s.STRING_CONCAT_FN_NAME,e,r,n,t);var a=t.registerNode(i);t.registerTranslationNode({nodeId:a,pos:e.pos});return a}function x(e,t,r,n,i,a){var o=S(e,t,r,n,i,a);var u=i.registerNode(o);if(o.name==s.STRING_CONCAT_FN_NAME){i.registerTranslationNode({nodeId:u,pos:t.pos})}return u}function S(e,t,n,i,s,u){var d=[];var f=[];for(var h=0,y=i;h<y.length;h++){var m=y[h];var v=void 0;if(typeof m=="string"){v=m}else{v=p(m,s)}d.push(v);var g=s.nodes[v];f.push(g.valueType)}switch(n.version){case undefined:case"v3":try{if(n.argTypes.length!=f.length){throw new Error("Expected "+n.argTypes.length+" arguments but got "+f.length+".")}for(var b=0;b<n.argTypes.length;b++){var x=n.argTypes[b];var S=f[b];if(!x.matches(S)){if(x.matches(a.Types.latex)&&S.matches(a.Types.string)){}else if(x.matches(a.Types.string)&&S.matches(a.Types.latex)){}else{if(u){if(b==0){throw new Error("Expected this method to be called on "+n.argTypes[0]+", but got "+f[0])}else{var w=n.argTypes.slice(1).join(", ");var _=f.slice(1).join(", ");throw Error("Expected "+(n.argTypes.length-1)+" arguments of types ["+w+"], got ["+_+"]")}}else{var w=n.argTypes.join(", ");var _=f.join(", ");throw Error("Expected "+n.argTypes.length+" arguments of types ["+w+"], got ["+_+"]")}}}}}catch(e){throw new o.StatementError(e.message,t)}return{type:"function",name:e,fn:n.noUndefinedArgs?l.enforceNoUndefinedArgs(n.value):n.value,valueType:n.outputType,dependencies:r.__spreadArrays(n.prependGlobalConstants||[],T(d,n.argTypes,s))};case"v2":{var I=[];for(var b=0;b<i.length;b++){var m=i[b];I.push({type:f[b],pos:typeof m=="string"?t.pos:m.pos})}var E={registerLocation:function(e){return s.locationManager.registerLocation({type:e,scriptId:t.pos.componentId,first_line:t.pos.first_line,first_column:t.pos.first_column})},resolveLocation:function(e){return s.locationManager.resolveLocationToken(e)}};var C=void 0;try{C=n.lookup(I,E)}catch(e){throw new o.StatementError(e.message,t)}if(C.warnings){for(var M=0,k=C.warnings;M<k.length;M++){var P=k[M];s.error(P)}}var O=d;if(C.desiredArgTypes){O=T(O,C.desiredArgTypes,s)}if(C.prependGlobalConstants){O=r.__spreadArrays(C.prependGlobalConstants,O)}return{type:"function",name:e,fn:n.noUndefinedArgs?l.enforceNoUndefinedArgs(C.body):C.body,valueType:C.valueType,dependencies:O}}default:return c.assertUnreachable(n,"Expected function to have version but it was "+n.version)}}function T(e,t,r){if(e.length!=t.length){throw new Error("Expected the args & expected types to have the same length.")}var n=[];for(var i=0;i<e.length;i++){var o=e[i];var s=t[i];var u=r.nodes[o];if(!u){throw new Error("Expected analysis to contain node with id "+o)}var c=u.valueType;if(s.matches(c)){n.push(o)}else{if(s.matches(a.Types.latex)&&c.matches(a.Types.string)){n.push(r.castStringToLatex(o))}else if(s.matches(a.Types.string)&&c.matches(a.Types.latex)){n.push(r.castLatexToString(o))}else{throw new Error("Expected to be able to cast type "+c+" to type "+s)}}}return n}function w(e,t){var r=e.value;var n=e.pos.componentId;var i=t.resolveVariable(r,n,e);if(i)return i;var a=t.resolveComponent(r,e);if(a.result=="error")throw a.error;if(a.result=="resolved")return a.nodeId;var o=t.resolveConstant(r);if(o)return o;return _(t,e)}function _(e,t){var r=u.keys(e.componentAliasMap.aliases);if(r.length){throw new o.StatementError("Unable to find component or variable "+t.value+". The components you've named so far are "+JSON.stringify(r)+".",t)}else{throw new o.StatementError("Unable to find component or variable "+t.value+". To refer to data from other components, you need to give them a name.\nYou haven't named any components yet",t)}}function I(e,t){var r=e.args,n=r[0],i=r.slice(1);if(n.type=="Identifier"){if(n.value=="aggregate"){return h(e,t)}if(n.value=="importNumber"||n.value=="importString"||n.value==="importNumberList"){return y(e,t,n.value)}var a=t.library.functions[n.value];if(a==null){throw new o.StatementError("Unknown function '"+n.value+"'",e)}return x(n.value,e,a,i,t)}if(l.isMemberAccess(n)){var s=p(n.left,t);return g(s,n.right,i,t)}throw new o.StatementError("Attempt to call unknown type of function or source",n)}});define("core/computation-layer/aggregator",["require","exports","./types","./cl-types","core/lib/i18n"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.isAggregateId=t.generateAggregateId=t.listSinks=t.listSources=void 0;t.listSources={aggregateSource:{description:function(){return i.i18n.raw("Internal implementation of aggregation")},publishedBy:"aggregate",params:[{name:"key",type:n.Types.string}],analyzeValueType:{type:"concrete",valueType:n.Types.numberList}}};t.listSinks=r.convertSinkList({aggregateSink:{description:function(){return i.i18n.raw("Internal implementation of aggregation")},analyzeValueType:{type:"concrete",valueType:n.Types.number}}});function a(e){return"aggregate-"+e.componentId+"-"+e.first_line+"-"+e.first_column}t.generateAggregateId=a;function o(e){return/aggregate-.*/.test(e)||/:aggregate:/.test(e)}t.isAggregateId=o});define("core/computation-layer/analyze/location-manager",["require","exports","tslib","underscore","../aggregator"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.LocationManager=t.isLocationId=void 0;function a(e){return e!=undefined&&e.isLocationId}t.isLocationId=a;var o=function(){function e(e){if(e===void 0){e={}}this.options=e;this.locations={aggregate:{},randomFloat:{},randomGenerator:{},randomInt:{}}}e.prototype.registerLocation=function(e){var t=n.uniqueId("cl_location_");if(!this.locations[e.type][e.scriptId]){this.locations[e.type][e.scriptId]={}}var r=this.locations[e.type][e.scriptId];var i=0;for(var a in r){var o=r[a];switch(s(o.loc,e)){case"lt":i+=1;break;case"gt":o.ord+=1;break;default:throw new Error("Attempted to insert two equal tokens "+JSON.stringify(e)+".")}}r[t]={ord:i,loc:e};return{isLocationId:true,type:e.type,scriptId:e.scriptId,id:t}};e.prototype.mergeLocationManager=function(e){for(var t in this.locations){this.locations[t]=r.__assign(r.__assign({},this.locations[t]),e.locations[t])}};e.prototype.resolveLocationTokenLegacy=function(e){var t=this.getLocationEntry(e).loc;switch(t.type){case"randomFloat":case"randomGenerator":case"randomInt":return t.scriptId+":"+t.first_line+":"+t.first_column;case"aggregate":return i.generateAggregateId({componentId:t.scriptId,first_line:t.first_line,first_column:t.first_column})}};e.prototype.resolveLocationToken=function(e){var t=this.getLocationEntry(e);var r=e.scriptId+":"+e.type+":"+t.ord;if(this.options.overrideMap){var n=this.options.overrideMap[r];if(!n){throw new Error("Provided location override map did not have a value for ordinal location "+r)}return n}else if(this.options.useLegacyLocations){return this.resolveLocationTokenLegacy(e)}else{return r}};e.prototype.getLocationEntry=function(e){var t=e.type,r=e.scriptId,n=e.id;var i=this.locations[t][r][n];if(!i){throw new Error("Unexpected Error: Unable to resolve locationId "+JSON.stringify(e))}return i};return e}();t.LocationManager=o;function s(e,t){if(e.first_line<t.first_line){return"lt"}else if(e.first_line>t.first_line){return"gt"}else{if(e.first_column<t.first_column){return"lt"}else if(e.first_column>t.first_column){return"gt"}else{return"eq"}}}});define("core/computation-layer/analyze/component",["require","exports","tslib","core/random-seed","../helpers","./source"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.analyzeComponent=void 0;function o(e,t,o){var l,p,d;if((l=t.componentAnalysis)===null||l===void 0?void 0:l.analyzeSources){var f=[];var h=[];for(var y=0,m=(p=o.placeholderSourceNodes[e])!==null&&p!==void 0?p:[];y<m.length;y++){var v=m[y];var g=o.nodes[v];h.push(new s(o,e,v,g))}var b={};var x=o.sinks[e]||{};for(var S in x){for(var T=0,w=x[S]||[];T<w.length;T++){var _=w[T];b[c(S,_.params)]=_.dependencies[0]}}var I={};var E=[];for(var C=0,M=o.sinkSummaries.filter(function(t){return t.componentId===e});C<M.length;C++){var k=M[C];var P=b[c(k.sinkName,k.paramValues)];if(P){if(!I[P]){I[P]=[]}I[P].push(k)}E.push({nodeId:P,sinkSummary:k})}t.componentAnalysis.analyzeSources({sinks:E,placeholderSources:h,config:t.config,warn:function(t){return o.error({msg:t,componentId:e,warning:true})},registerIntermediateComputation:function(s){var c;var l=s.params,p=s.sinkNodeIds;var d=(c=t.componentAnalysis)===null||c===void 0?void 0:c.intermediateComputation;if(!d){throw new Error("Could not find intermediate computation in component "+e+" CL spec")}var h=a.registerResponseSource(e,"IC:"+d.name,o);var y=o.registerNode({type:"function",name:"IC:"+d.name,hash:e+":IC:"+d.name+":"+f.length,fn:function(e,r,a){var s=[];for(var c=3;c<arguments.length;c++){s[c-3]=arguments[c]}var f=[];var h=[];p.forEach(function(e,t){var r=s[t];for(var n=0,i=I[e];n<i.length;n++){var a=i[n];f.push({nodeId:e,sinkSummary:a});h.push(r)}});return d.computeFromResponse({params:l,randomSeed:n.RandomSeed.fromString(i.synthesizeStringInternal(e)),response:a,sinks:u(f,h,o),config:t.config,degreeMode:r})},valueType:d.valueType,dependencies:r.__spreadArrays(["randomSeedNodeId","degreeModeNodeId",h],p)});f.push(y);return y}});var O=h.filter(function(e){return!e.isImplemented()});if(O.length>0){throw new Error("Component "+e+" failed to implement some placeholder sources: "+O.map(function(e){return e.nodeId}).join(", ")+".")}delete o.placeholderSourceNodes[e]}else{if(((d=o.placeholderSourceNodes[e])===null||d===void 0?void 0:d.length)>0){throw new Error("Component "+e+" defined placeholder source nodes, but did not provide componentAnalysis.analyzeSources to implement them.")}}}t.analyzeComponent=o;var s=function(){function e(e,t,r,n){this.analysis=e;this.componentId=t;this.nodeId=r;this.placeholder=n;this.implemented=false}e.prototype.isImplemented=function(){return this.implemented};e.prototype.implementWithICDependency=function(e,t){var a;var o=this;var s=t.icNodeDependency,c=t.fn;var l=this.analysis.nodes[s];if((l===null||l===void 0?void 0:l.type)!=="function"){throw new Error('Expected IC node of type "function" for id '+s+", but found "+(l===null||l===void 0?void 0:l.type)+" instead.")}var p=(a={},a[this.placeholder.responseSourceNodeId]=true,a.randomSeedNodeId=true,a.degreeModeNodeId=true,a);for(var d=0,f=this.placeholder.sinkDependencies;d<f.length;d++){var h=f[d];p[h.nodeId]=true}for(var y=0,m=l.dependencies;y<m.length;y++){var v=m[y];if(!p[v]){var g="Placeholder dependencies:\n"+Object.keys(p).sort()+".\nIC dependencies:\n"+r.__spreadArrays(l.dependencies).sort();throw new Error("Placeholder source "+this.nodeId+" cannot depend on IC node "+s+", because the IC node's dependencies are not a subset of the source's. "+g)}}this.implementSource(e,{type:"function",name:this.placeholder.sourceName+JSON.stringify(this.placeholder.params),hash:this.componentId+":"+this.placeholder.sourceName+":"+JSON.stringify(this.placeholder.params),fn:function(e,t,r,a){var s=[];for(var l=4;l<arguments.length;l++){s[l-4]=arguments[l]}return c({randomSeed:n.RandomSeed.fromString(i.synthesizeStringInternal(e)),response:r,icValue:a,sinks:u(o.placeholder.sinkDependencies,s,o.analysis),degreeMode:t})},valueType:this.placeholder.valueType,dependencies:r.__spreadArrays(["randomSeedNodeId","degreeModeNodeId",this.placeholder.responseSourceNodeId,s],this.placeholder.sinkDependencies.map(function(e){return e.nodeId}))})};e.prototype.implementWithoutICDependency=function(e,t){var a=this;this.implementSource(e,{type:"function",name:this.placeholder.sourceName+JSON.stringify(this.placeholder.params),hash:this.componentId+":"+this.placeholder.sourceName+":"+JSON.stringify(this.placeholder.params),fn:function(e,r,o){var s=[];for(var c=3;c<arguments.length;c++){s[c-3]=arguments[c]}return t({randomSeed:n.RandomSeed.fromString(i.synthesizeStringInternal(e)),response:o,sinks:u(a.placeholder.sinkDependencies,s,a.analysis),degreeMode:r})},valueType:this.placeholder.valueType,dependencies:r.__spreadArrays(["randomSeedNodeId","degreeModeNodeId",this.placeholder.responseSourceNodeId],this.placeholder.sinkDependencies.map(function(e){return e.nodeId}))})};e.prototype.implementSource=function(e,t){if(this.implemented){throw new Error("Placeholder source "+this.nodeId+" was already implemented.")}this.implemented=true;var r=this.analysis.nodes[this.nodeId];if((r===null||r===void 0?void 0:r.type)!=="placeholder-source"){throw new Error("Expected to find a placeholder-source node at nodeId "+this.nodeId+", but found "+(r===null||r===void 0?void 0:r.type)+" instead.")}if(!e.matches(r.valueType)){throw new Error("Expected implementation of type "+r.valueType+" for source "+r.sourceName+", but the provided implementation had type "+e+" instead.")}this.analysis.nodes[this.nodeId]=t};return e}();function u(e,t,r){if(e.length!==t.length){throw new Error("Expected sinkDependencies and sinkValues to have the same length.")}var n={};for(var i=0;i<e.length;i++){var a=e[i],o=a.sinkSummary,s=a.nodeId;var u=t[i];var c=o.sinkName;if(n[c]==undefined)n[c]=[];n[c].push({value:u,params:o.paramValues,valueType:r.nodes[s].valueType})}return n}function c(e,t){return e+":"+JSON.stringify(t)}});define("core/computation-layer/analyze/main",["require","exports","tslib","core/lib/i18n","../parser/main","core/lib/assert-unreachable","../parser/ast","../types","../cl-types","./types","./exports","../library/builtin","./sinks","./expression","./location-manager","../mangle","underscore","./component"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f,h,y,m,v){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.Analysis=void 0;var g=function(){function e(e,t,n){var i=this;this.components=e;this.library=t;this.env=n;this.errors=[];this.sinks={};this.controllerSources=[];this.placeholderSourceNodes={};this.responseSources={};this.importSources={};this.nodes={};this.variables={};this.constants={};this.componentNodes={};this.componentScriptNodes={};this.dependencyMap={};this.sourcesUsed={};this.nodeCache={};this.translationNodes={};this.stringToLatexCasts={};this.latexToStringCasts={};this.resolvedStatements={};this.pendingStatements={};this.invalidStatements={};this.locationManager=new h.LocationManager({useLegacyLocations:!!n.useLegacyLocations,overrideMap:n.locationOverrideMap});this.componentAliasMap=this.computeAliasMap();this.ast=this.computeAST();if(n.insertThumbnailComponent){this.insertThumbnailComponent()}var a=this.ast;var o=l.analyzeExports(a),s=o.validExportMap,u=o.validStatements,c=o.invalidStatements;this.invalidStatements=r.__assign(r.__assign({},this.invalidStatements),c);for(var p=0,f=m.values(c);p<f.length;p++){var y=f[p];this.errors.push({msg:y.message,componentId:y.errRef.pos.componentId,pos:y.errRef.pos})}this.declarations=s;this.sinkSummaries=d.analyzeSinks(a,this.components,function(e){return i.error(e)});var g=function(e){b.tryAndRecord(function(){i.analyzeStatement(e)})};var b=this;for(var x=0,S=u;x<S.length;x++){var T=S[x];g(T)}for(var w in this.components){var _=this.components[w];if(!_)continue;v.analyzeComponent(w,_,this)}var I=Object.keys(this.placeholderSourceNodes);if(I.length>0){throw new Error("Expected all placeholder sources to be implemented after component-level analysis, but found remaining placeholder sources: "+I)}}e.prototype.mergeAnalysis=function(e){this.errors=r.__spreadArrays(this.errors,e.errors);this.locationManager.mergeLocationManager(e.locationManager);this.mergeSinks(e.sinks);this.mergeASTs(e.ast);this.controllerSources=r.__spreadArrays(this.controllerSources,e.controllerSources);this.responseSources=r.__assign(r.__assign({},this.responseSources),e.responseSources);this.importSources=r.__assign(r.__assign({},this.importSources),e.importSources);this.nodes=r.__assign(r.__assign({},this.nodes),e.nodes);this.variables=r.__assign(r.__assign({},this.variables),e.variables);this.sourcesUsed=r.__assign(r.__assign({},this.sourcesUsed),e.sourcesUsed);this.components=r.__assign(r.__assign({},this.components),e.components);this.dependencyMap=r.__assign(r.__assign({},this.dependencyMap),e.dependencyMap);this.declarations=r.__assign(r.__assign({},this.declarations),e.declarations);this.constants=r.__assign(r.__assign({},this.constants),e.constants);this.componentNodes=r.__assign(r.__assign({},this.componentNodes),e.componentNodes);this.componentScriptNodes=r.__assign(r.__assign({},this.componentScriptNodes),e.componentScriptNodes);this.placeholderSourceNodes=r.__assign(r.__assign({},this.placeholderSourceNodes),e.placeholderSourceNodes);this.sinkSummaries=r.__spreadArrays(this.sinkSummaries,e.sinkSummaries);this.componentAliasMap={aliases:r.__assign(r.__assign({},this.componentAliasMap.aliases),e.componentAliasMap.aliases),duplicates:r.__assign(r.__assign({},this.componentAliasMap.duplicates),e.componentAliasMap.duplicates)}};e.prototype.mergeSinks=function(e){var t=this;var n=function(r,n){var i;var a=t.sinks[r];var o=e[r];if(o&&o[n]){if(!a){a=o}else if(!a[n]){a[n]=o[n]}else{a[n]=(i=a[n])===null||i===void 0?void 0:i.concat.apply(i,o[n])}}return a};var i=n("aggregate","aggregateSink");var a=n("thumbnail","thumbnail");this.sinks=r.__assign(r.__assign({},this.sinks),e);if(i){this.sinks["aggregate"]=i}if(a){this.sinks["thumbnail"]=a}};e.prototype.mergeASTs=function(e){var t;var n=(t=this.ast["thumbnail"]||[]).concat.apply(t,e["thumbnail"]||[]);this.ast=r.__assign(r.__assign({},this.ast),e);if(n.length>0){this.ast["thumbnail"]=n}};e.prototype.analyzeStatement=function(e){var t=y.mangleStatementReference(e);if(this.resolvedStatements[t]){return}var r=this.ast[e.componentId];var n=r&&r[e.statementIndex];if(!n){throw new Error("Expected "+JSON.stringify(e)+" to resolve to a top node but it did not.")}var i=this.invalidStatements[t];if(!!i){throw i}if(this.pendingStatements[t]){for(var o in this.pendingStatements){var s=y.unmangle(o);var u=this.ast[s.componentId];var l=u&&u[s.statementIndex];if(!l){throw new Error("Expected "+JSON.stringify(e)+" to resolve to a top node but it did not.")}this.invalidStatements[o]=new c.CircularDependencyError(l)}throw this.invalidStatements[t]}this.pendingStatements[t]=true;try{switch(n.type){case"VariableAssignment":{var p=n.left;if(p.type=="Identifier"){var h=f.analyzeExpression(n.right,this);this.registerVariable(p.value,p.pos.componentId,h)}else{throw new c.StatementError("The left side of an assignment (=) must be an identifier. This looks different.Did you mean to use a sink (:) instead?",p)}break}case"SinkAssignment":{var h=f.analyzeExpression(n.right,this);d.analyzeSink(n.left,h,this);break}default:return a.assertUnreachable(n)}}catch(e){delete this.pendingStatements[t];if(!this.invalidStatements[t]){this.invalidStatements[t]=e}throw this.invalidStatements[t]}delete this.pendingStatements[t];this.resolvedStatements[t]=true};e.prototype.analyzeExpressionForHint=function(e){return f.analyzeExpression(e,this)};e.prototype.insertThumbnailComponent=function(){var e={stepId:"thumbnail",sinks:s.convertSinkList({thumbnail:{description:function(){return n.i18n.raw("internal use only")},analyzeValueType:{type:"concrete",valueType:u.Types.calculatorStateWithSinkValues},params:[{name:"componentId",type:u.Types.string}]}})};var t=[];for(var r in this.components){var i=this.components[r];if(i.sources&&i.sources.calculatorState){var a={first_line:1,last_line:1,first_column:0,last_column:0,componentId:"thumbnail",stepId:"thumbnail"};var c=new o.FunctionNode([new o.IdentifierNode("thumbnail",a),new o.StringNode(r,a)],a);var l=new o.CalculatorReferenceNode(r,a);t.push(new o.SinkAssignmentNode(c,l,a))}}this.ast["thumbnail"]=t;this.components["thumbnail"]=e};e.prototype.getNodes=function(){return this.nodes};e.prototype.castStringToLatex=function(e){if(!this.stringToLatexCasts[e]){this.stringToLatexCasts[e]=this.registerNode({type:"function",name:"castStringToLatex",valueType:u.Types.latex,dependencies:[e],fn:p.castStringToLatex})}return this.stringToLatexCasts[e]};e.prototype.castLatexToString=function(e){if(!this.latexToStringCasts[e]){this.latexToStringCasts[e]=this.registerNode({type:"function",name:"castLatexToString",valueType:u.Types.string,dependencies:[e],fn:p.castLatexToString})}return this.latexToStringCasts[e]};e.prototype.computeAliasMap=function(){var e={};for(var t in this.components){var r=this.components[t];var n=r.alias;if(!n){continue}if(!e[n]){e[n]={}}if(!e[n][r.stepId]){e[n][r.stepId]=[]}e[n][r.stepId].push(t)}var i={aliases:{},duplicates:{}};for(var n in e){var a=i.aliases[n]={};for(var o in e[n]){var s=e[n][o];if(s.length===1){a[o]=s[0]}else{if(!i.duplicates[o]){i.duplicates[o]={}}for(var u=0,c=s;u<c.length;u++){var t=c[u];i.duplicates[o][n]=true;this.errors.push({msg:"Naming Collision - "+s.length+' components on this screen are named "'+n+'"',componentId:t})}}}}return i};e.prototype.computeAST=function(){var e=this;var t={};for(var r in this.components){var n=this.components[r];if(n.script!=null){var a=i.parse(n.script,{componentId:r,stepId:n.stepId}),o=a.nodes,s=a.errors;s.forEach(function(t){return e.errors.push(t)});t[r]=o}}return t};e.prototype.registerVariable=function(e,t,r){if(this.variables[t]==null){this.variables[t]={}}return this.variables[t][e]=r};e.prototype.resolveConstant=function(e){if(this.constants[e]){return this.constants[e]}var t=this.library.constants[e];if(!t){return undefined}var r=t.valueType,n=t.value;var i=this.registerNode({type:"constant",valueType:r,value:n});return this.constants[e]=i};e.prototype.resolveComponent=function(e,t){var r=this.componentAliasMap.aliases[e];var n=this.componentAliasMap.duplicates[t.pos.stepId];if(n&&n[e]){return{result:"error",error:new c.StatementError('Multiple components on this screen are named "'+e+'".',t)}}var i;if(r){if(r[t.pos.stepId]){i=r[t.pos.stepId]}else if(Object.keys(r).length==1){i=r[Object.keys(r)[0]]}else{return{result:"error",error:new c.StatementError("Naming Collision - there are "+Object.keys(r).length+' components in this activity named "'+e+'".',t)}}}if(e=="this"&&!i){i=t.pos.componentId}if(!i){return{result:"not-found"}}var a=this.componentNodes[i];if(a){return{result:"resolved",nodeId:a,componentId:i}}else{var o=this.componentNodes[i]=this.registerNode({type:"component",valueType:u.getComponentType({componentId:i})});return{result:"resolved",nodeId:o,componentId:i}}};e.prototype.resolveComponentScript=function(e){var t=this.componentScriptNodes[e];if(t){return t}else{var r=this.componentScriptNodes[e]=this.registerNode({type:"component-script",valueType:u.getComponentScriptType({componentId:e})});return r}};e.prototype.registerNode=function(e){var t=this.getCacheKey(e);var r=t&&this.nodeCache[t];if(r){return r}var n=e.type==="function"?e.name:e.type||"node";if(this.env.nodePrefix){n=this.env.nodePrefix+n}var i=m.uniqueId(n);this.nodes[i]=e;if(t){this.nodeCache[t]=i}return i};e.prototype.getCacheKey=function(e){switch(e.type){case"controllerSource":{var t=JSON.stringify(e.params);return"controllerSource:"+e.componentId+":"+e.sourceName+"<"+e.valueType+">:"+t}case"function":if(e.hash){return"function:"+e.hash+"<"+e.valueType+">:"+e.dependencies.join(",")}return undefined;default:return undefined}};e.prototype.registerTranslationNode=function(e){var t=e.nodeId,r=e.pos;var n=r.componentId;if(this.translationNodes[n]==undefined){this.translationNodes[n]={}}this.translationNodes[n][t]={first_line:r.first_line,first_column:r.first_column,last_line:r.last_line,last_column:r.last_column}};e.prototype.resolveVariable=function(e,t,r){var n=this.variables[t];var i=n&&n[e];if(i){return i}var a=this.declarations[y.mangleVariableSymbol({componentId:t,symbol:e})];if(a){try{this.analyzeStatement(a)}catch(n){var o=this.components[t];var s=o&&o.alias;throw new c.StatementError("The statement defining variable "+e+(s?" in component "+s:"")+" has an error.",r)}var u=this.variables[t];var l=u&&u[e];if(l){return l}else{throw new Error("Expected analyzing statement "+JSON.stringify(a)+" to declare variable "+e+" but it did not.")}}else{return undefined}};e.prototype.error=function(e){if(!m.find(this.errors,e)){this.errors.push(e)}};e.prototype.tryAndRecord=function(e){try{e()}catch(e){if(e instanceof c.StatementError){this.errors.push({msg:e.message,componentId:e.errRef.pos.componentId,pos:e.errRef.pos})}else if(e instanceof c.ComponentError){this.errors.push({msg:e.message,componentId:e.componentId})}else if(e instanceof c.CircularDependencyError){this.errors.push({msg:e.message,componentId:e.errRef.pos.componentId,pos:e.errRef.pos})}else{throw e}}};return e}();t.Analysis=g});define("core/computation-layer/runtime",["require","exports","tslib","./runtime-node","./analyze/main","./cl-types","core/random-seed","core/lib/assert-unreachable","core/lib/log","underscore","./analyze/location-manager"],function(e,t,r,n,i,a,o,s,u,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.Runtime=void 0;var p="randomSeedNodeId";var d="degreeModeNodeId";var f=function(){function e(e){var t=this;this.params=e;this.pendingValues={};this.sinks={};this.sources={};this.nodes={};this.updatePending=false;this.processPendingValues=function(){var e=Date.now();if(!t.updatePending){return}t.updatePending=false;var r=t.pendingValues;t.pendingValues={};for(var n in r){t.nodes[n].blockDependents()}for(var n in r){var i=r[n];t.nodes[n].resolveValue(i)}var a=Date.now();try{t.computationDidUpdate()}catch(e){u.log("computationDidUpdate",e)}finally{var o=Date.now();var s=a-e;var c=o-a;if(s>500)u.log("Slow CL computation, "+s+"ms");if(c>500)u.log("Slow dispatch, "+c+"ms")}};if(!e.runtimeConstants.dryRun){if(e.runtimeConstants.randomSeed==null)throw new Error("No random seed passed to CL runtime")}this.runtimeConstants=e.runtimeConstants;if(e.doNextTick)this.doNextTick=e.doNextTick;this.components=e.components;this.publishersAvailable=e.publishersAvailable;this.computationDidUpdate=e.computationDidUpdate;this.subscribePureSource=e.subscribePureSource;if(e.reuseAnalysisFrom!=undefined){this.analysis=e.reuseAnalysisFrom.analysis}else{this.analysis=new i.Analysis(this.components,e.library,{publishersAvailable:e.publishersAvailable,insertThumbnailComponent:!!e.insertThumbnailComponent,locationOverrideMap:e.locationOverrideMap,useLegacyLocations:e.useLegacyLocations});if(!e.runtimeConstants.dryRun)this.reportErrors(this.analysis.errors)}if(!e.runtimeConstants.dryRun){this.pendingValues={};this.allocateNodes(this.analysis);this.registerSinks(this.analysis);this.registerSources(this.analysis);this.registerResponseSources(this.analysis);this.resolveConstants(this.analysis);this.scheduleProcessPendingValues()}}e.prototype.getDegreeMode=function(){return!this.runtimeConstants.dryRun?this.runtimeConstants.degreeMode:false};e.prototype.getRandomSeed=function(){return!this.runtimeConstants.dryRun?this.runtimeConstants.randomSeed:o.RandomSeed.fromString("dryRun")};e.prototype.doNextTick=function(e){setTimeout(e,0)};e.prototype.addSiloedComponents=function(e,t){var r;if(t===void 0){t={}}for(var n in e){if(this.components[n]&&n!=="aggregate"&&n!=="thumbnail"){throw new Error('Found duplicate responseKey: "'+n+'"')}else{this.components[n]=e[n]}}var a=c.uniqueId("silo")+":";var o=(r=t.cachedSiloedAnalysis)!==null&&r!==void 0?r:new i.Analysis(e,this.params.library,{publishersAvailable:this.params.publishersAvailable,insertThumbnailComponent:!!this.params.insertThumbnailComponent,locationOverrideMap:this.params.locationOverrideMap,useLegacyLocations:this.params.useLegacyLocations,nodePrefix:a});this.analysis.mergeAnalysis(o);if(this.runtimeConstants.dryRun){return{siloedAnalysis:o}}this.reportErrors(o.errors);this.allocateNodes(o,{createGlobalConstantNodes:false});this.registerSinks(o);this.registerSources(o);this.registerResponseSources(o);this.resolveConstants(o);this.scheduleProcessPendingValues();return{siloedAnalysis:o}};e.prototype.scheduleProcessPendingValues=function(){if(this.updatePending){return}this.updatePending=true;this.doNextTick(this.processPendingValues)};e.prototype.getErrors=function(){return this.analysis.errors};e.prototype.getNodeFromVariable=function(e,t){var r;var n=(r=this.analysis.variables[e])===null||r===void 0?void 0:r[t];if(n===undefined)return;return this.nodes[n]};e.prototype.getSinks=function(e,t){if(t==null){throw new Error("sink name required")}var r=this.sinks[e];if(r){var n=r[t];if(n){return n}}return[]};e.prototype.getSinkValue=function(e,t,r){var n=this.getSinks(e,t);if(n.length>1)throw new Error("Multiple "+t+" sinks.  Inappropriate use of getSinkValue");var i=n[0];return i?i.value:r};e.prototype.getComponentSinks=function(e){var t=this.sinks[e];if(t){return t}else{return{}}};e.prototype.getSources=function(e,t){var r=this.sources[e];if(r){var n=r[t];if(n){return n}}return[]};e.prototype.getComponentSources=function(e){var t=this.sources[e];if(t){return t}else{return{}}};e.prototype.doesComponentUseSource=function(e,t){return!!(this.analysis.sourcesUsed[e]&&this.analysis.sourcesUsed[e][t])};e.prototype.reportErrors=function(e){if(!(e.length>0)){return}u.log("Computation layer running despite "+e.length+" errors",e)};e.prototype.allocateConstantNode=function(e,t,r){this.nodes[e]=new n.RuntimeNode({nodeId:e,runtime:this,analysis:{type:"constant",valueType:t,value:r}})};e.prototype.allocateNodes=function(e,t){if(t===void 0){t={createGlobalConstantNodes:true}}if(!this.nodes){this.nodes={}}if(t.createGlobalConstantNodes){this.allocateConstantNode(p,a.Types.string,{type:"string",parts:[this.getRandomSeed().toString()]});this.allocateConstantNode(d,a.Types.boolean,this.getDegreeMode())}for(var r in e.nodes){var i=e.nodes[r];this.nodes[r]=new n.RuntimeNode({nodeId:r,runtime:this,analysis:i})}for(var r in this.nodes){for(var o=0,s=this.nodes[r].getDependencies();o<s.length;o++){var u=s[o];this.nodes[u].registerDependent(r)}}};e.prototype.resolveAnalysisParams=function(e){var t=[];for(var r=0,n=e;r<n.length;r++){var i=n[r];if(l.isLocationId(i)){t.push(this.analysis.locationManager.resolveLocationToken(i))}else{t.push(i)}}return t};e.prototype.registerSinks=function(e){for(var t in e.sinks){var r=e.sinks[t];for(var n in r){var i=function(e){var t=a.nodes[e.dependencies[0]];var r={params:a.resolveAnalysisParams(e.params),valueType:t.analysis.valueType,get value(){return t.value}};if(t.analysis.type==="constant"){r.isConstant=true}var n=e.componentId,i=e.sinkName;if(a.sinks[n]==null){a.sinks[n]={}}if(a.sinks[n][i]==null){a.sinks[n][i]=[]}a.sinks[n][i].push(r)};var a=this;for(var o=0,s=r[n];o<s.length;o++){var u=s[o];i(u)}}}};e.prototype.registerResponseSources=function(e){var t=this;var r=function(r){var i=e.responseSources[r];n.subscribePureSource(r,function(e){t.updateSourceValue(i,e,{skipEqualityChecks:true})})};var n=this;for(var i in e.responseSources){r(i)}};e.prototype.registerSources=function(e){var t=this;var n=function(n){var a=e.nodes[n];var o={params:a.params,valueType:a.valueType,getValue:function(){return t.getSourceValue(n)},setValue:function(e){return t.updateSourceValue(n,e)}};var s=a.componentId,u=a.sourceName;if(i.sources[s]==null){i.sources[s]={}}if(i.sources[s][u]==null){i.sources[s][u]=[]}i.sources[s][u].push(r.__assign(r.__assign({},o),{params:i.resolveAnalysisParams(o.params)}))};var i=this;for(var a=0,o=e.controllerSources;a<o.length;a++){var s=o[a];n(s)}};e.prototype.resolveConstants=function(e){this.resolveGlobalConstant(p,e);this.resolveGlobalConstant(d,e);for(var t in e.nodes){var r=this.nodes[t];if(r.analysis.type=="constant"){r.resolveValue(r.value)}if(r.analysis.type=="function"&&r.analysis.dependencies.length==0){r.compute()}}};e.prototype.resolveGlobalConstant=function(e,t){var r=this.nodes[e];for(var n=0,i=(r===null||r===void 0?void 0:r.dependents)||[];n<i.length;n++){var a=i[n];if(t.nodes[a]){r.runtime.nodes[a].resolveDependency(e)}}};e.prototype.getSourceValue=function(e){return this.nodes[e].value};e.prototype.updateSourceValue=function(e,t,r){if(r===void 0){r={}}if(!r.skipEqualityChecks&&!this.updatePending){var n=this.pendingValues.hasOwnProperty(e);var i=this.nodes[e].hasOwnProperty("value");if(!n&&i&&c.isEqual(this.getSourceValue(e),t))return}this.pendingValues[e]=t;this.scheduleProcessPendingValues()};e.prototype.listImportSourceKeys=function(){var e=[];for(var t in this.analysis.importSources){var r=this.analysis.importSources[t];var n=this.analysis.nodes[r];e.push({importKey:t,type:n.type})}return e};e.prototype.updateImportSourceValue=function(e,t){var r=this.analysis.importSources[e];if(!r){throw new Error("No node is registered for import key "+e)}var n=this.nodes[r];var i=n.analysis;var a=t;switch(i.type){case"importNumber":if(typeof t!=="number"){throw new Error("Import key "+e+" expects a number but we got a "+typeof t)}break;case"importString":if(typeof t!=="string"){throw new Error("Import key "+e+" expects a string but we got a "+typeof t)}a={type:"string",parts:[t]};break;case"importNumberList":if(!Array.isArray(t)){throw new Error("Import key "+e+" expects an array, but we got a "+typeof t)}if(t.some(function(e){return typeof e!=="number"})){throw new Error("Import key "+e+" expects an array of numbers, but we got an array containing a non-numeric value")}break;default:s.assertUnreachable(i)}this.updateSourceValue(r,a)};return e}();t.Runtime=f});define("core/computation-layer/step-component",["require","exports","core/computation-layer/types","core/computation-layer/cl-types","core/lib/i18n"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.stepComponent=void 0;var a=r.convertSinkList({title:{description:function(){return i.i18n.s("cl-docs-description-step-title")},analyzeValueType:{type:"concrete",valueType:n.Types.string}},subtitle:{description:function(){return i.i18n.s("cl-docs-description-step-subtitle")},analyzeValueType:{type:"concrete",valueType:n.Types.string}},coverText:{description:function(){return i.i18n.s("cl-docs-description-step-cover-text")},analyzeValueType:{type:"concrete",valueType:n.Types.string}},coverButtonLabel:{description:function(){return i.i18n.s("cl-docs-description-step-cover-button-label")},analyzeValueType:{type:"concrete",valueType:n.Types.string}},export:{description:function(){return i.i18n.s("cl-docs-description-step-export")},analyzeValueType:{type:"concrete",valueType:n.Types.string},internal:true,params:[{name:"heading",type:n.Types.string}]},disableCalculatorReason:{description:function(){return i.i18n.s("cl-docs-description-step-disable-calculator-reason")},analyzeValueType:{type:"concrete",valueType:n.Types.string}},score:{description:function(){return i.i18n.s("grading-description-step-score")},internal:true,analyzeValueType:{type:"concrete",valueType:n.Types.score}}});t.stepComponent={listSinks:a}});define("core/computation-layer/library/colors",["require","exports","core/computation-layer/cl-types","core/lib/mathtools","core/lib/i18n"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.library=t.hexToRGBA=t.rgbaStringToRGBA=t.stringToColor=t.colorToString=void 0;function a(e){if(e===undefined)return 0;if(e>=0&&e<=255)return Math.round(e);if(e>255)return 255;return 0}function o(e){if(e===undefined)return 1;if(e>=0&&e<=1)return e;if(e<0)return 0;return 1}function s(e){if(e===undefined)return"black";var t=a(e.r);var r=a(e.g);var n=a(e.b);var i=o(e.a);return"rgba("+t+", "+r+", "+n+", "+i+")"}t.colorToString=s;function u(e){if(e.match(/^#[A-Fa-f0-9]{6}$/)){return p(e)}else if(e.match(/^#[A-Fa-f0-9]{3}$/)){var t=e[1];var r=e[2];var n=e[3];var i="#"+t+t+r+r+n+n;return p(i)}else if(e.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*\.*\d+)\)$/)){return l(e)}else{return undefined}}t.stringToColor=u;function c(e,t){return{version:"v3",description:function(){return i.i18n.s("cl-docs-description-lib-palette-color-getter",{name:i.i18n.raw(t)})},argTypes:[r.Types.colorPalette],outputType:r.Types.color,value:function(){return e}}}function l(e){var t=e.replace("rgba(","").replace(")","").split(",");var r=parseInt(t[0]);var n=parseInt(t[1]);var i=parseInt(t[2]);var a=parseFloat(t[3]);return{r:r,g:n,b:i,a:a}}t.rgbaStringToRGBA=l;function p(e,t){if(t===void 0){t=1}var r=a(parseInt(e.slice(1,3),16));var n=a(parseInt(e.slice(3,5),16));var i=a(parseInt(e.slice(5,7),16));return{r:r,g:n,b:i,a:t}}t.hexToRGBA=p;t.library={functions:{rgb:{version:"v3",description:function(){return i.i18n.s("cl-docs-description-lib-rgb")},argTypes:[r.Types.number,r.Types.number,r.Types.number],outputType:r.Types.color,value:function(e,t,r){return{r:a(e),g:a(t),b:a(r)}}}},types:{color:{description:function(){return i.i18n.s("cl-docs-description-type-color")},attributes:{setOpacity:{version:"v3",description:function(){return i.i18n.s("cl-docs-description-lib-set-opacity")},argTypes:[r.Types.color,r.Types.number],outputType:r.Types.color,value:function(e,t){if(e===undefined)e={r:0,g:0,b:0};return{a:o(t),r:a(e.r),g:a(e.g),b:a(e.b)}}}}},colorPalette:{description:function(){return i.i18n.s("cl-docs-description-type-color-palette")},attributes:{red:c(p(n.colorHelpers.colors.RED),"red"),blue:c(p(n.colorHelpers.colors.BLUE),"blue"),green:c(p(n.colorHelpers.colors.GREEN),"green"),purple:c(p(n.colorHelpers.colors.PURPLE),"purple"),orange:c(p(n.colorHelpers.colors.ORANGE),"orange"),black:c(p(n.colorHelpers.colors.BLACK),"black"),list:{version:"v2",description:function(){return i.i18n.s("cl-docs-description-lib-color-list")},noUndefinedArgs:true,lookup:function(e){var t=e[0],n=e.slice(1);if(n.length<1)throw new Error("Must include at least one color");for(var i=0,a=n;i<a.length;i++){var o=a[i];if(!r.Types.color.matches(o.type)){throw new Error("Expected all arguments to be colors, but got a "+o.type.type)}}return{body:function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}return t},valueType:r.Types.colorList}}}}}},constants:{colors:{valueType:r.Types.colorPalette,value:{},description:function(){return i.i18n.s("cl-docs-description-lib-palette-colors")}}}}});define("core/lib/distance",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.pointToSegment=t.closestPointOnSegment=t.pointToSegmentParameter=t.dot=t.mean=t.hypot=void 0;var r=function(e,t){if(e===0&&t===0){return 0}if(Math.abs(e)>Math.abs(t)){return Math.abs(e)*Math.sqrt(t/e*(t/e)+1)}else{return Math.abs(t)*Math.sqrt(e/t*(e/t)+1)}};t.hypot=r;var n=function(e,t){return e>0===t>0?e+.5*(t-e):.5*(e+t)};t.mean=n;var i=function(e,t,r,n){return e*r+t*n};t.dot=i;var a=function(e,r,n,i,a,o){var s=t.hypot(a-n,o-i);if(s===0)return 0;var u=t.dot((e-n)/s,(r-i)/s,(a-n)/s,(o-i)/s);return u};t.pointToSegmentParameter=a;var o=function(e,r,n,i,a,o){var s=t.pointToSegmentParameter(e,r,n,i,a,o);if(s<=0)return[n,i];if(s>=1)return[a,o];return[n+s*(a-n),i+s*(o-i)]};t.closestPointOnSegment=o;var s=function(e,r,n,i,a,o){var s=t.closestPointOnSegment(e,r,n,i,a,o);return t.hypot(e-s[0],r-s[1])};t.pointToSegment=s});define("core/lib/colors",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.hexToRGBA=t.shadeColor=t.colors=t.backgroundColors=t.strokeColors=void 0;t.strokeColors={pink:"#db5375",purple:"#9068be",orange:"#fa824c",blue:"#4781b9",green:"#1aad57",red:"#c54e4b",mediumBlue:"#27AAE1",teal:"#15b097",lightTeal:"#87CBAC",ruby:"#db3a4d",lightYellow:"#ffe37b",navy:"#336699",aqua:"#6ed3cf",lightGray:"#DDDDDD",mediumGray:"#AAAAAA"};t.backgroundColors={blue:"#32C7C7",pink:"#DB4D70",gold:"#F7A745",purple:"#9068BE",red:"#DB3A4D",orange:"#FA7639",green:"#14B363"};t.colors=Object.keys(t.strokeColors);function r(e,t){if(!e.match(/^#([A-Fa-f0-9]{6})$/g))return e;if(t>1)t=1;if(t<-1)t=-1;var r=parseInt(e.slice(1),16);var n=t<0?0:255;var i=t<0?t*-1:t;var a=r>>16;var o=r>>8&255;var s=r&255;return"#"+(16777216+(Math.round((n-a)*i)+a)*65536+(Math.round((n-o)*i)+o)*256+(Math.round((n-s)*i)+s)).toString(16).slice(1)}t.shadeColor=r;function n(e,t){e=e.replace(/#/,"");var r=0;var n=0;var i=0;if(e.length==3){r=parseInt(e.slice(0,1)+e.slice(0,1),16);n=parseInt(e.slice(1,2)+e.slice(1,2),16);i=parseInt(e.slice(2,3)+e.slice(2,3),16)}else if(e.length==6){r=parseInt(e.slice(0,2),16);n=parseInt(e.slice(2,4),16);i=parseInt(e.slice(4,6),16)}return"rgba("+r+","+n+","+i+","+t+")"}t.hexToRGBA=n});define("core/lib/url-helpers",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.isDataUrl=void 0;function r(e){return e.slice(0,5)==="data:"}t.isDataUrl=r});define("core/lib/calculator-helpers",["require","exports","tslib","underscore","core/lib/copydata","core/lib/mathtools","core/lib/colors","core/lib/log","core/computation-layer/helpers","./url-helpers"],function(e,t,r,n,i,a,o,s,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getRehydratedCalculatorState=t.getDefaultStateWithNoGrid=t.getDefaultState=t.validStrippedIdentifierRequired=t.validLatexIdentifierRequired=t.validLatexRequired=t.validStringIdentifierPreferred=t.validLatexIdentifierPreferred=t.calcStateWithoutDefinitions=t.getExportAndDependencyMapFromState=t.getLabelValueFromIdentifier=t.getIdFromIdentifier=t.numberAsLatex=t.statesEqual=t.multiplyOpacitiesByAlpha=t.isDegreeMode=t.enableDegreeMode=t.pushPointIntoState=t.clearGraphSettingsForHeadlessCalc=t.clearExpressions=t.areAnyImageUrlsMissing=t.areAxesSquare=t.extractViewport=t.filterListToIds=t.expressionsEqual=t.mergeImages=t.filterImages=t.makeStateReadable=void 0;function l(e){if(e.version==="opaque")throw new Error("Opaque state version should never actually be used.");return e}t.makeStateReadable=l;var p=function(e){var t=i.copydata(l(e));for(var r=0,n=t.expressions.list;r<n.length;r++){var a=n[r];if(a.type==="image"&&c.isDataUrl(a.image_url)){a.image_url=""}}return t};t.filterImages=p;var d=function(e,t){var r=t?l(t):undefined;var n=i.copydata(l(e));for(var a=0,o=n.expressions.list;a<o.length;a++){var u=o[a];if(u.type==="image"&&u.image_url===""){if(!r){s.warn("MergeImagesError","No screenstate provided, but needed to repopulate image URLs");return n}var c=false;for(var p=0,d=r.expressions.list;p<d.length;p++){var f=d[p];if(f.id===u.id&&f.type==="image"){u.image_url=f.image_url;c=true;break}}if(!c){s.warn("MergeImagesError","Image "+u.id+" needed, but not found in screenstate")}}}return n};t.mergeImages=d;var f=function(e,t){if(e==undefined||t==undefined){return e==t}return n.isEqual(l(e).expressions.list,l(t).expressions.list)};t.expressionsEqual=f;function h(e,t){var n=l(e);var i=r.__assign(r.__assign({},n),{expressions:{list:[]}});var a=i.expressions.list;for(var o=0,s=n.expressions.list;o<s.length;o++){var u=s[o];if(t[u.id]){a[a.length]=u}}return i}t.filterListToIds=h;function y(e){return l(e).graph.viewport}t.extractViewport=y;function m(e){var t=l(e);if(t.graph.squareAxes===undefined){return true}else{return!!t.graph.squareAxes}}t.areAxesSquare=m;function v(e){var t=l(e);for(var r=0,n=t.expressions.list;r<n.length;r++){var i=n[r];if(i.type==="image"&&!i.image_url)return true}return false}t.areAnyImageUrlsMissing=v;function g(e){return r.__assign(r.__assign({},l(e)),{expressions:{list:[]}})}t.clearExpressions=g;function b(e){return r.__assign(r.__assign({},l(e)),{graph:{}})}t.clearGraphSettingsForHeadlessCalc=b;function x(e,t){var r=l(e).expressions.list;r[r.length]={id:t.id,color:t.color,latex:"\\left("+t.x+","+t.y+"\\right)",type:"expression"}}t.pushPointIntoState=x;function S(e){var t=i.copydata(l(e));t.graph.degreeMode=true;return t}t.enableDegreeMode=S;function T(e){return!!l(e).graph.degreeMode}t.isDegreeMode=T;function w(e,t){var r=i.copydata(l(e));for(var n=0,a=r.expressions.list;n<a.length;n++){var s=a[n];if(s.type=="expression"){s.showLabel=false;if(s.color!=undefined){s.color=o.hexToRGBA(s.color,t)}}else if(s.type=="table"){if(s.columns){for(var u=0,c=s.columns;u<c.length;u++){var p=c[u];p.color=o.hexToRGBA(p.color,t)}}}}if(r.version===8||r.version===9){for(var d=0,f=r.expressions.list;d<f.length;d++){var s=f[d];if(s.type=="image"){if(s.opacity!==undefined){s.opacity="("+s.opacity+") * "+t}else{s.opacity=t+""}}}}else if(r.version===7){for(var h=0,y=r.expressions.list;h<y.length;h++){var s=y[h];if(s.type=="image"){if(s.opacity!==undefined){s.opacity=s.opacity*t}else{s.opacity=t}if(s.stringOpacity!==undefined){s.stringOpacity="("+s.stringOpacity+") * "+t}}}}else{for(var m=0,v=r.expressions.list;m<v.length;m++){var s=v[m];if(s.type=="image"){if(s.opacity!=undefined){s.opacity=s.opacity*t}else{s.opacity=t}}}}return r}t.multiplyOpacitiesByAlpha=w;var _=function(e,t){return n.isEqual(e,t)};t.statesEqual=_;var I=function(e){var t,r;if(n.isFinite(e)){r=e.toString();t=r.split("e");if(t.length===1){return t[0]}return t[0]+"*10^{0"+t[1]+"}"}if(e===Infinity){return"1/0"}if(e===-Infinity){return"-1/0"}return"0/0"};t.numberAsLatex=I;function E(e,t){for(var r=0,n=l(e).expressions.list;r<n.length;r++){var i=n[r];var o=i;if(o.latex&&a.parser.parse(o.latex).getExports()[0]===t){return i.id}}return null}t.getIdFromIdentifier=E;function C(e,t){for(var r=0,n=l(e).expressions.list;r<n.length;r++){var i=n[r];var o=i;if(o.latex&&a.parser.parse(o.latex).getExports()[0]===t){return o.label}}return undefined}t.getLabelValueFromIdentifier=C;var M=new WeakMap;function k(e){if(e==undefined){return{exportMap:{},dependencyMap:{},weakExportMap:{}}}var t=l(e);var r=M.get(t.expressions.list);if(r)return r;var n=a.CLCalculator(t);var i=new a.context;var o=n.getChangeSet().statements;for(var s in o){i.addStatement(o[s])}var u=i.getCLSymbolMap();M.set(t.expressions.list,u);return u}t.getExportAndDependencyMapFromState=k;function P(e,t){var r=i.copydata(l(e));if(t.length==0||!(r&&r.expressions&&r.expressions.list)){return e}t=t.map(function(e){return e.replace(/[{}]/g,"")});var n=[];for(var o=0,s=r.expressions.list;o<s.length;o++){var u=s[o];var c=u;if(c.latex){var p=a.parser.parse(c.latex).getExports()[0];if(t.indexOf(p)>=0)continue}n[n.length]=u}r.expressions.list=n;return r}t.calcStateWithoutDefinitions=P;function O(e){return N(e.latex)}t.validLatexIdentifierPreferred=O;function L(e){return N(u.synthesizeStringInternal(e))}t.validStringIdentifierPreferred=L;function N(e){if(e.match(/^[a-zA-Z]$/))return{result:"ok"};if(e.match(/^[a-zA-Z]_[a-zA-Z0-9]$/))return{result:"ok"};if(e.match(/^[a-zA-Z]_{[a-zA-Z0-9]+}$/))return{result:"ok"};return{result:"warn",msg:'Invalid identifier "'+e+"\" won't get reliable dependency handling."}}function A(e){var t=a.parser.parse(e.latex);if(t.isError)return{result:"error",msg:'Could not parse "'+e.latex+'" as latex'};return{result:"ok"}}t.validLatexRequired=A;function D(e){if(e.latex.match(/^[a-zA-Z]$/))return{result:"ok"};if(e.latex.match(/^[a-zA-Z]_[a-zA-Z0-9]$/))return{result:"ok"};if(e.latex.match(/^[a-zA-Z]_{[a-zA-Z0-9]+}$/))return{result:"ok"};return{result:"error",msg:'Invalid identifier "'+e.latex+'" won\'t work here.  Try "x", "x_1", or "x_{abc}"'}}t.validLatexIdentifierRequired=D;function R(e){var t=u.synthesizeStringInternal(e);if(t.match(/^[a-zA-Z]$/))return{result:"ok"};if(t.match(/^[a-zA-Z]_[a-zA-Z0-9]+$/))return{result:"ok"};return{result:"error",msg:'Point name "'+t+"\" won't work here.  Try `x`, `x_1`, or `x_abc`"}}t.validStrippedIdentifierRequired=R;function F(e){return{expressions:{list:[]},graph:{viewport:{xmin:-10,xmax:10,ymin:-10,ymax:10},degreeMode:!!(e===null||e===void 0?void 0:e.degreeMode)}}}t.getDefaultState=F;function q(){return{expressions:{list:[]},graph:{viewport:{xmin:-10,xmax:10,ymin:-10,ymax:10},degreeMode:false,showGrid:false,showXAxis:false,showYAxis:false}}}t.getDefaultStateWithNoGrid=q;function B(e,t){if(t.calculatorStateDiff&&e){return a.applyDiff(e,t.calculatorStateDiff)}return t.calculatorState}t.getRehydratedCalculatorState=B});define("core/computation-layer/library/bounds",["require","exports","tslib","core/lib/assert-unreachable","../cl-types","core/lib/i18n"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.library=t.getMathBounds=t.applyStrategy=void 0;var o=function(e){return{version:"v3",description:function(){return a.i18n.s("cl-docs-description-lib-bounds-getter",{name:a.i18n.raw(e)})},argTypes:[i.Types.bounds],outputType:i.Types.number,noUndefinedArgs:true,value:function(t){return t[e]}}};var s=function(e,t,i){var a=i.width/i.height;var o=e.height*a;var s=e.width/a;switch(t){case"stretch":return e;case"bottom":return r.__assign(r.__assign({},e),{height:s});case"top":return r.__assign(r.__assign({},e),{bottom:e.bottom+e.height-s,height:s});case"centeredVertical":return r.__assign(r.__assign({},e),{bottom:e.bottom+e.height/2-s/2,height:s});case"left":return r.__assign(r.__assign({},e),{width:o});case"right":return r.__assign(r.__assign({},e),{left:e.left+e.width-o,width:e.height*a});case"centeredHorizontal":return r.__assign(r.__assign({},e),{left:e.left+e.width/2-o/2,width:o});default:return n.assertUnreachable(t)}};t.applyStrategy=s;var u=function(e,r){var n=e["bounds"];if(n&&n[0]){var i=n[0].value;if(r.width<=0)r.width=1;if(r.height<=0)r.height=1;var a=t.applyStrategy(i,i.strategy,r);return{top:a.bottom+a.height,left:a.left,bottom:a.bottom,right:a.left+a.width}}return undefined};t.getMathBounds=u;var c=function(){return a.i18n.s("cl-docs-warning-bounds-strategy-deprecation-notice")};var l=function(e){return{version:"v3",deprecated:c,description:function(){switch(e){case"stretch":return a.i18n.raw("Bounds strategy stretch. Use this in conjunction with bounds.setStrategy (deprecated).");case"left":return a.i18n.raw("Bounds strategy left. Use this in conjunction with bounds.setStrategy (deprecated).");case"right":return a.i18n.raw("Bounds strategy right. Use this in conjunction with bounds.setStrategy (deprecated).");case"centeredHorizontal":return a.i18n.raw("Bounds strategy centeredHorizontal. Use this in conjunction with bounds.setStrategy (deprecated).");case"bottom":return a.i18n.raw("Bounds strategy bottom. Use this in conjunction with bounds.setStrategy (deprecated).");case"top":return a.i18n.raw("Bounds strategy top. Use this in conjunction with bounds.setStrategy (deprecated).");case"centeredVertical":return a.i18n.raw("Bounds strategy centeredVertical. Use this in conjunction with bounds.setStrategy (deprecated).");default:return n.assertUnreachable(e)}},argTypes:[],outputType:i.Types.boundsStrategy,value:function(){return e}}};var p={stretch:l("stretch"),left:l("left"),right:l("right"),centeredHorizontal:l("centeredHorizontal"),bottom:l("bottom"),top:l("top"),centeredVertical:l("centeredVertical")};function d(e){return{version:"v3",description:function(){return a.i18n.s("cl-docs-description-lib-bounds-square")},argTypes:[i.Types.bounds],outputType:i.Types.bounds,noUndefinedArgs:true,value:function(t){return r.__assign(r.__assign({},t),{strategy:e})}}}t.library={functions:r.__assign({makeBounds:{version:"v3",description:function(){return a.i18n.s("cl-docs-description-lib-make-bounds")},argTypes:[i.Types.number,i.Types.number,i.Types.number,i.Types.number],outputType:i.Types.bounds,noUndefinedArgs:true,value:function(e,t,r,n){return{left:e,bottom:r,width:t-e,height:n-r,strategy:"stretch"}}}},p),types:{bounds:{description:function(){return a.i18n.s("cl-docs-description-type-bounds")},attributes:{left:o("left"),bottom:o("bottom"),height:o("height"),width:o("width"),top:{version:"v3",description:function(){return a.i18n.s("cl-docs-description-lib-bounds-top")},argTypes:[i.Types.bounds],outputType:i.Types.number,noUndefinedArgs:true,value:function(e){return e.bottom+e.height}},right:{version:"v3",description:function(){return a.i18n.s("cl-docs-description-lib-bounds-right")},argTypes:[i.Types.bounds],outputType:i.Types.number,noUndefinedArgs:true,value:function(e){return e.left+e.width}},setStrategy:{version:"v3",description:function(){return a.i18n.raw("Change these bounds to be square")},deprecated:c,argTypes:[i.Types.bounds,i.Types.boundsStrategy],outputType:i.Types.bounds,noUndefinedArgs:true,value:function(e,t){return r.__assign(r.__assign({},e),{strategy:t})}},stretch:{version:"v3",description:function(){return a.i18n.s("cl-docs-description-lib-bounds-stretch")},argTypes:[i.Types.bounds],outputType:i.Types.bounds,noUndefinedArgs:true,value:function(e){return r.__assign(r.__assign({},e),{strategy:"stretch"})}},squareLeft:d("left"),squareRight:d("right"),squareCenterHorizontal:d("centeredHorizontal"),squareBottom:d("bottom"),squareTop:d("top"),squareCenterVertical:d("centeredVertical")}}},constants:{}}});define("core/components/shared/sketch/sketch",["require","exports","core/lib/distance","core/computation-layer/library/colors","core/lib/calculator-helpers","core/computation-layer/library/bounds"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getSketchBounds=t.filterByRgbColor=t.replaceAllOpacity=t.transformCoordinates=t.getPointCoords=t.replaceAllColors=t.getXValuesAt=t.getValuesAt=t.getTotalStrokeLength=t.getComputedThickness=t.getThickness=t.getThicknessScale=t.getColor=t.normalize=void 0;var o=-10;var s=20;var u={thin:3,standard:5,thick:20};function c(e){if(e.color!=undefined){return e.coords}else{return e}}t.normalize=c;function l(e){if(e.color){return e.color}return undefined}t.getColor=l;function p(e,t){var r=e.scaleThicknessBy!==undefined&&isFinite(e.scaleThicknessBy)?e.scaleThicknessBy:1;var n=t&&t.scaleThicknessBy!==undefined?t.scaleThicknessBy:1;return r*n}t.getThicknessScale=p;function d(e){if(e.thickness){return e.thickness}return"standard"}t.getThickness=d;function f(e,t){var r=d(e.value);var n=u[r]*t;if(r==="thick"&&e.type==="point"){n*=.5}if(n===0)return 0;return Math.max(1,n)}t.getComputedThickness=f;var h=function(e){if(e==undefined)return 0;var t=0;for(var n=0,i=e.strokes;n<i.length;n++){var a=i[n];var o=c(a);for(var s=0;s<o.length-1;s++){var u=o[s];var l=o[s+1];t+=r.hypot(u.x-l.x,u.y-l.y)}}return t};t.getTotalStrokeLength=h;var y=function(e,t){var r=[];for(var n=0,i=e.strokes;n<i.length;n++){var a=i[n];var o=c(a);for(var s=0;s<o.length;s++){var u=o[s];if(u.x==t){r.push(u.y)}else{if(s<o.length-1){var l=o[s+1];if((u.x-t)*(l.x-t)<0){r.push(u.y+(t-u.x)/(l.x-u.x)*(l.y-u.y))}}}}}return r};t.getValuesAt=y;var m=function(e,t){var r=[];for(var n=0,i=e.strokes;n<i.length;n++){var a=i[n];var o=c(a);for(var s=0;s<o.length;s++){var u=o[s];if(u.y==t){r.push(u.x)}else{if(s<o.length-1){var l=o[s+1];if((u.y-t)*(l.y-t)<0){r.push(u.x+(t-u.y)/(l.y-u.y)*(l.x-u.x))}}}}}return r};t.getXValuesAt=m;function v(e,t){return{strokes:e.strokes.map(function(e){return{color:t,coords:c(e),thickness:d(e)}}),points:e.points.map(function(e){return{color:t,coords:c(e),thickness:d(e)}}),bounds:e.bounds,scaleThicknessBy:e.scaleThicknessBy}}t.replaceAllColors=v;var g=function(e){return(e.points||[]).map(function(e){return c(e)})};t.getPointCoords=g;function b(e,t){return{strokes:e.strokes.map(function(e){var r=c(e).map(t);var n=l(e);var i=d(e);return n?{color:n,coords:r,thickness:i}:r}),points:e.points.map(function(e){var r=t(c(e));var n=l(e);var i=d(e);return n?{color:n,coords:r,thickness:i}:r}),bounds:e.bounds,scaleThicknessBy:e.scaleThicknessBy}}t.transformCoordinates=b;function x(e,t){var r=l(e);if(!r){return e}var i=n.stringToColor(r);if(!i){throw new Error("Unexpected sketch color format")}i.a=t;return{color:n.colorToString(i),coords:c(e)}}function S(e,t){var r=l(e);var i=r&&n.stringToColor(r);return!!i&&i.r===t.r&&i.g===t.g&&i.b===t.b}function T(e,t){return{strokes:e.strokes.map(function(e){return x(e,t)}),points:e.points.map(function(e){return x(e,t)}),bounds:e.bounds,scaleThicknessBy:e.scaleThicknessBy}}t.replaceAllOpacity=T;function w(e,t){return{strokes:e.strokes.filter(function(e){return S(e,t)}),points:e.points.filter(function(e){return S(e,t)}),bounds:e.bounds,scaleThicknessBy:e.scaleThicknessBy}}t.filterByRgbColor=w;function _(e){var t=e.aspectRatio,r=e.calcState;if(r){var n=i.extractViewport(r);var a=n.xmin;var u=n.xmax-a;var c=void 0;var l=void 0;if(i.areAxesSquare(r)){l=u/t;c=(n.ymax+n.ymin)/2-l/2}else{c=n.ymin;l=n.ymax-c}return{left:a,width:u,height:l,bottom:c}}else{var l=s/t;return{left:o,width:s,height:l,bottom:-l/2}}}function I(e){if(e.sketchConfig.version==2){if(e.bounds!=undefined){var t=e.bounds.width;var r=t/e.aspectRatio;return a.applyStrategy(e.bounds,e.bounds.strategy,{width:t,height:r})}if(e.sketchConfig.background.type=="graph"){return _({aspectRatio:e.aspectRatio,calcState:e.sketchConfig.calculatorState})}else{var r=2/e.aspectRatio;return{left:-1,width:2,bottom:-r/2,height:r}}}else{return{left:0,bottom:0,width:1,height:1}}}t.getSketchBounds=I});define("core/computation-layer/library/math",["require","exports","tslib","underscore","core/lib/mathtools","core/lib/calculator-helpers","../cl-types","core/lib/evaluator-helpers","core/lib/i18n"],function(e,t,r,n,i,a,o,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.library=t.generateFunctionProxyVariables=void 0;function c(e){return e.input.slice(e.start,e.end)}t.generateFunctionProxyVariables=n.memoize(function(e){var t=[];for(var r=1;r<=e;r++){t.push("\\tmp_{cl"+r+"}")}return t});var l=function(e){if(e.length<2){throw new Error("You must specify the independent variables you want to use for analysis")}var r=[];for(var a=1;a<e.length;a++){if(!(o.Types.string.matches(e[a].type)||o.Types.latex.matches(e[a].type))){throw new Error("Independent variables must be latex, but argument "+a+" is a "+e[a].type.type)}if(!o.Types.latex.matches(e[a].type)){}}var s=[e[0].type];for(var a=1;a<e.length;a++){s.push(o.Types.latex)}return{valueType:o.getFunctionType({numVars:e.length-1}),warnings:r,desiredArgTypes:s,body:function(e){var r=[];for(var a=1;a<arguments.length;a++){r[a-1]=arguments[a]}var o=r;var s=o.map(function(e){return e.latex.toLowerCase()});var u="lhsGreater"in e&&!e.lhsGreater?"("+e.rhs+")-("+e.lhs+")":"("+e.lhs+")-("+e.rhs+")";var c=i.parser.parse(u);if(c.isError){return undefined}var l=n.filter(c.getDependencies(),function(e){return!i.builtInFrame.hasOwnProperty(e)});if(!c.simpleFunctionExpression)return undefined;var p=c.simpleFunctionExpression();var d={};var f=t.generateFunctionProxyVariables(o.length);var h={};for(var y=0,m=l;y<m.length;y++){var v=m[y];var g=v.toLowerCase();var b=s.indexOf(g);if(b==-1){return undefined}if(d[b])return undefined;d[b]=true;h[v]=i.parser.parse(f[b])}var x=p.substitute(h);var S=x.tryGetConcreteTree(i.policies.graphing,i.builtInFrame);if(S.valueType!==i.types.Number)return undefined;return x.printLatex()}}};var p={version:"v3",argTypes:[o.Types.xyLine],outputType:o.Types.number,prependGlobalConstants:["degreeModeNodeId"],description:function(){return u.i18n.s("cl-docs-description-lib-angle-of-line")},value:function(e,t){if(t==undefined){return 0/0}var r=t.B>0?Math.atan2(-t.A,t.B):Math.atan2(t.A,-t.B);return!e?r:r*180/Math.PI}};var d={version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-slope-of-line")},argTypes:[o.Types.xyLine],outputType:o.Types.number,value:function(e){if(e==undefined){return 0/0}return-e.A/e.B}};var f={version:"v3",argTypes:[o.Types.xyLine],outputType:o.Types.number,description:function(){return u.i18n.s("cl-docs-description-lib-y-intercept-of-line")},value:function(e){if(e==undefined){return 0/0}return-e.C/e.B}};var h={version:"v3",argTypes:[o.Types.xyLine],outputType:o.Types.number,description:function(){return u.i18n.s("cl-docs-description-lib-x-intercept-of-line")},value:function(e){if(e==undefined){return 0/0}return-e.C/e.A}};var y={version:"v3",argTypes:[o.Types.xyLine],outputType:o.Types.boolean,description:function(){return u.i18n.s("cl-docs-description-lib-is-line-horizontal")},value:function(e){return e!=undefined&&e.A===0}};var m={version:"v3",argTypes:[o.Types.xyLine],outputType:o.Types.boolean,description:function(){return u.i18n.s("cl-docs-description-lib-is-line-vertical")},value:function(e){return e!=undefined&&e.B===0}};t.library={functions:{numericValue:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-numeric-value")},argTypes:[o.Types.latex],outputType:o.Types.number,noUndefinedArgs:true,prependGlobalConstants:["degreeModeNodeId"],value:function(e,t){return s.computeNumericValueFromLatex(t.latex,e)}},simpleFunction:{version:"v2",description:function(){return u.i18n.s("cl-docs-description-lib-simple-function")},noUndefinedArgs:true,lookup:function(e){if(e.length<1){throw new Error("simpleFunction requires a latex string as a first argument")}var r=[];for(var a=0,s=e;a<s.length;a++){var u=s[a];if(!o.Types.latex.matches(u.type)){if(o.Types.string.matches(u.type)){}else{throw new Error("Function body and identifier must be latex or strings. I got ["+e.join(", ")+"].")}}}var c=Math.max(1,e.length-1);return{valueType:o.getFunctionType({numVars:c}),desiredArgTypes:n.range(e.length).map(function(){return o.Types.latex}),warnings:r,body:function(e){var r=[];for(var a=1;a<arguments.length;a++){r[a-1]=arguments[a]}var o=r.map(function(e){return e.latex.toLowerCase()});if(o.length==0){o=["x"]}var s=i.parser.parse(e.latex);if(s.isError){return undefined}var u=n.filter(s.getDependencies(),function(e){return!i.builtInFrame.hasOwnProperty(e)});if(s.type==="FunctionDefinition"){if(n.any(s._argSymbols,function(e){return o.indexOf(e.toLowerCase())==-1})){return undefined}if(n.any(u,function(e){return s._argSymbols.indexOf(e)==-1})){return undefined}}else if(s.type==="Assignment"){if(u.indexOf(s._symbol)>=0){return undefined}if(o.indexOf(s._symbol.toLowerCase())>=0){return undefined}}if(!s.simpleFunctionExpression)return undefined;var c=s.simpleFunctionExpression();var l={};var p=t.generateFunctionProxyVariables(o.length);var d={};for(var f=0,h=u;f<h.length;f++){var y=h[f];var m=y.toLowerCase();var v=o.indexOf(m);if(v==-1){return undefined}if(l[v])return undefined;l[v]=true;d[y]=i.parser.parse(p[v])}var g=c.substitute(d);var b=g.tryGetConcreteTree(i.policies.graphing,i.builtInFrame);if(b.valueType!==i.types.Number)return undefined;return g.printLatex()}}}},xyLine:{version:"v2",description:function(){return u.i18n.s("cl-docs-description-lib-xy-line")},lookup:function(e){if(e.length!==1&&e.length!==3){throw Error("xyLine takes 1 or 3 arguments but got "+e.length)}var t=[];for(var r=0,a=e;r<a.length;r++){var s=a[r];if(!(o.Types.string.matches(s.type)||o.Types.latex.matches(s.type))){throw Error("Function body and identifiers must be strings or latex. I got ["+e.join(", ")+"].")}if(!o.Types.latex.matches(s.type)){}}return{valueType:o.Types.xyLine,desiredArgTypes:n.range(e.length).map(function(){return o.Types.latex}),warnings:t,body:function(e,t,r){try{var a=void 0;var o=void 0;var s=void 0;var u=void 0;var c=void 0;var l=void 0;var p=void 0;var d=void 0;var f=void 0;var h=void 0;var y=t?t.latex:"x";var m=r?r.latex:"y";if(!e){return void 0}h=i.parser.parse(e.latex);if(h.isError){return void 0}switch(h.type){case"Assignment":p=i.parseNodes.Subtract([i.parseNodes.Identifier(h._symbol),h._expression]);break;case"Equation":p=h._difference;break;case"FunctionDefinition":p=i.parseNodes.Subtract([i.parser.parse(h.getInputString().split("=")[0]),h._expression]);break;default:l=h.getConcreteTree(i.policies.graphing,i.builtInFrame);f=l.getDependencies();if(f.length!==1){return void 0}if(f[0].toLowerCase()!==y.toLowerCase()){return void 0}if(l.valueType!==i.types.Number){return void 0}p=i.parseNodes.Subtract([h,i.parseNodes.Identifier(m)])}l=p.getConcreteTree(i.policies.graphing,i.builtInFrame);if(l.isError){return void 0}if(l.valueType!==i.types.Number){return void 0}f=l.getDependencies();if(f.length>2){return void 0}for(var v=0,g=f;v<g.length;v++){var b=g[v];if(b.toLowerCase()===y.toLowerCase()){y=b}else if(b.toLowerCase()===m.toLowerCase()){m=b}else return void 0}u=l.getPolynomialCoefficients(y);if(u.length>2){return void 0}c=u[0].getPolynomialCoefficients(m);if(c.length>2){return void 0}d=function(e){if(e==null){return 0}if(e.getDependencies().length!==0){return void 0}return+e.asValue()};a=d(u[1]);o=d(c[1]);s=d(c[0]);if(!(n.isFinite(a)&&n.isFinite(o)&&n.isFinite(s))){return void 0}if(a===0&&o===0){return void 0}return{A:a,B:o,C:s}}catch(e){return void 0}}}}},angleOfLine:r.__assign(r.__assign({},p),{deprecated:function(){return u.i18n.s("cl-docs-warning-deprecation-angle-of-line")}}),slopeOfLine:r.__assign(r.__assign({},d),{deprecated:function(){return u.i18n.s("cl-docs-warning-deprecation-slope-of-line")}}),yInterceptOfLine:r.__assign(r.__assign({},f),{deprecated:function(){return u.i18n.s("cl-docs-warning-deprecation-y-intercept-of-line")}}),xInterceptOfLine:r.__assign(r.__assign({},h),{deprecated:function(){return u.i18n.s("cl-docs-warning-deprecation-x-intercept-of-line")}}),isLineHorizontal:r.__assign(r.__assign({},y),{deprecated:function(){return u.i18n.s("cl-docs-warning-deprecation-is-line-horizontal")}}),isLineVertical:r.__assign(r.__assign({},m),{deprecated:function(){return u.i18n.s("cl-docs-warning-deprecation-is-line-vertical")}}),parseOrderedPair:{version:"v3",argTypes:[o.Types.latex],outputType:o.Types.orderedPair,description:function(){return u.i18n.s("cl-docs-description-lib-parse-ordered-pair")},noUndefinedArgs:true,value:function(e){var t=i.expressionParser.parse(e.latex);if(t.type!=="Paren")return undefined;var r=t.args[0];if(r.type!=="Seq")return undefined;if(r.args.length!==2)return undefined;return{x:c(r.args[0].span),y:c(r.args[1].span)}}},parseEquation:{version:"v3",argTypes:[o.Types.latex],outputType:o.Types.equation,description:function(){return u.i18n.s("cl-docs-description-lib-parse-equation")},noUndefinedArgs:true,value:function(e){var t=i.expressionParser.parse(e.latex);if(t.type=="Equals"){return{lhs:c(t.args[0].span),rhs:c(t.args[1].span)}}return undefined}},parseInequality:{version:"v3",argTypes:[o.Types.latex],outputType:o.Types.inequality,description:function(){return u.i18n.s("cl-docs-description-lib-parse-inequality")},noUndefinedArgs:true,value:function(e){var t=i.expressionParser.parse(e.latex);if(t.type=="Inequality"){return{lhs:c(t.args[0].span),rhs:c(t.args[1].span),lhsGreater:t.symbol==">"||t.symbol==">=",strict:t.symbol==">"||t.symbol=="<"}}return undefined}},countNumberUsage:{version:"v2",description:function(){return u.i18n.s("cl-docs-description-lib-count-number-usage")},lookup:function(e){if(e.length==0){throw new Error("Must provide at least one argument")}if(!(o.Types.latex.matches(e[0].type)||o.Types.string.matches(e[0].type))){throw new Error("First argument must be a string. This is a "+e[0].type)}var t=[];if(!o.Types.latex.matches(e[0].type)){}if(e[1]&&!o.Types.number.matches(e[1].type)){throw new Error("Second argument, the number to match, must be a number.  This is a\n                "+e[1])}if(e.length>2){throw new Error("This function accepts a maximum of 2 arguments")}var r=[o.Types.latex];if(e[1]){r.push(o.Types.number)}return{valueType:o.Types.number,desiredArgTypes:r,warnings:t,body:function(e,t){if(e===undefined)return undefined;var r=i.expressionParser.parse(e.latex);if(r.type=="Err")return undefined;return i.treeQueries.countNumbers(r,t)}}}}},types:{function:{description:function(){return u.i18n.s("cl-docs-description-type-function")},attributes:{evaluateAt:{version:"v2",description:function(){return u.i18n.s("cl-docs-description-lib-function")},lookup:function(e){var r;var s=(r=e.map(function(e){return e.type}),r[0]),u=r.slice(1);if(s.type!="function")throw new Error("EvaluateAt can only be called on a function");var c=s;if(u.length!=c.params.numVars){throw new Error("This function expects "+c.params.numVars+" arguments. "+("you can't evaluate with "+u.length+" arguments"))}for(var l=0,p=u;l<p.length;l++){var d=p[l];if(!o.Types.number.matches(d))throw new Error("All arguments to evaluateAt must be numbers")}return{valueType:o.Types.number,prependGlobalConstants:["degreeModeNodeId"],body:function(e,r){var o=[];for(var s=2;s<arguments.length;s++){o[s-2]=arguments[s]}if(r==undefined||n.any(o,function(e){return e==undefined})){return NaN}var u=o;var c=t.generateFunctionProxyVariables(u.length);var l=new i.context;l.processChangeSet({statements:[{id:"definition",latex:"f("+c.join(",")+")="+r}],isCompleteState:true,degreeMode:e});var p=i.parser.parse("f("+u.map(a.numberAsLatex).join(",")+")");var d=p.tryGetConcreteTree(i.policies.graphing,l.frame);var f=d.asValue();return typeof f==="number"?f:NaN}}}}}},orderedPair:{description:function(){return u.i18n.s("cl-docs-description-type-ordered-pair")},attributes:{x:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-ordered-pair-x")},argTypes:[o.Types.orderedPair],outputType:o.Types.latex,noUndefinedArgs:true,value:function(e){return e.x!=undefined?{latex:e.x}:undefined}},y:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-ordered-pair-y")},argTypes:[o.Types.orderedPair],outputType:o.Types.latex,noUndefinedArgs:true,value:function(e){return e.y!=undefined?{latex:e.y}:undefined}}}},inequality:{description:function(){return u.i18n.s("cl-docs-description-type-inequality")},attributes:{rhs:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-inequality-rhs")},argTypes:[o.Types.inequality],outputType:o.Types.latex,noUndefinedArgs:true,value:function(e){return e.rhs!=undefined?{latex:e.rhs}:undefined}},lhs:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-inequality-lhs")},argTypes:[o.Types.inequality],outputType:o.Types.latex,noUndefinedArgs:true,value:function(e){return e.lhs!=undefined?{latex:e.lhs}:undefined}},isStrict:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-inequality-isStrict")},argTypes:[o.Types.inequality],outputType:o.Types.boolean,noUndefinedArgs:true,value:function(e){return e.strict}},isLeftGreater:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-inequality-is-left-greater")},argTypes:[o.Types.inequality],outputType:o.Types.boolean,noUndefinedArgs:true,value:function(e){return e.lhsGreater}},differenceFunction:{version:"v2",description:function(){return u.i18n.s("cl-docs-description-lib-inequality-difference-function")},noUndefinedArgs:true,lookup:l}}},equation:{description:function(){return u.i18n.s("cl-docs-description-type-equation")},attributes:{rhs:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-equation-rhs")},argTypes:[o.Types.equation],outputType:o.Types.latex,noUndefinedArgs:true,value:function(e){return e.rhs!=undefined?{latex:e.rhs}:undefined}},lhs:{version:"v3",description:function(){return u.i18n.s("cl-docs-description-lib-equation-lhs")},argTypes:[o.Types.equation],outputType:o.Types.latex,noUndefinedArgs:true,value:function(e){return e.lhs!=undefined?{latex:e.lhs}:undefined}},differenceFunction:{version:"v2",description:function(){return u.i18n.s("cl-docs-description-lib-difference-function")},noUndefinedArgs:true,lookup:l}}},xyLine:{description:function(){return u.i18n.s("cl-docs-description-type-xy-line")},attributes:{angle:p,slope:d,yIntercept:f,xIntercept:h,isHorizontal:y,isVertical:m}}},constants:{}}});define("core/computation-layer/library/sketch",["require","exports","tslib","./colors","underscore","core/components/shared/sketch/sketch","core/computation-layer/cl-types","core/lib/mathtools","core/computation-layer/library/math","core/lib/i18n","core/lib/assert-unreachable","core/lib/copydata"],function(e,t,r,n,i,a,o,s,u,c,l,p){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.library=void 0;var d={version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-point-count")},noUndefinedArgs:true,value:function(e){if(!e.points)return;return e.points.length},argTypes:[o.Types.sketch],outputType:o.Types.number};var f={version:"v3",description:function(){return c.i18n.raw("Returns the x coordinates of points in the sketch as a list")},noUndefinedArgs:true,value:function(e){return a.getPointCoords(e).map(function(e){return e.x})},argTypes:[o.Types.sketch],outputType:o.Types.numberList};var h={version:"v3",description:function(){return c.i18n.raw("Returns the y coordinates of points in the sketch as a list")},noUndefinedArgs:true,value:function(e){return a.getPointCoords(e).map(function(e){return e.y})},argTypes:[o.Types.sketch],outputType:o.Types.numberList};var y={version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-stroke-count")},value:function(e){if(!e)return 0;if(!e.strokes)return 0;return e.strokes.length},argTypes:[o.Types.sketch],outputType:o.Types.number};var m={version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-total-stroke-length")},argTypes:[o.Types.sketch],outputType:o.Types.number,value:a.getTotalStrokeLength};var v={version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-y-values")},noUndefinedArgs:true,argTypes:[o.Types.sketch,o.Types.number],outputType:o.Types.numberList,value:a.getValuesAt};var g={version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-x-values")},argTypes:[o.Types.sketch,o.Types.number],outputType:o.Types.numberList,noUndefinedArgs:true,value:a.getXValuesAt};function b(e){var t;switch(e){case"eraser":t=function(){return c.i18n.s("cl-docs-description-lib-sketch-tool-eraser")};break;case"line":t=function(){return c.i18n.s("cl-docs-description-lib-sketch-tool-line")};break;case"pencil":t=function(){return c.i18n.s("cl-docs-description-lib-sketch-tool-pencil")};break;case"points":t=function(){return c.i18n.s("cl-docs-description-lib-sketch-tool-points")};break;case"text":t=function(){return c.i18n.s("cl-docs-description-lib-sketch-tool-text")};break;case"math":t=function(){return c.i18n.s("cl-docs-description-lib-sketch-tool-math")};break;default:t=l.assertUnreachable(e)}return{version:"v3",description:t,argTypes:[o.Types.sketchTools],outputType:o.Types.sketchTool,value:function(){return e}}}function x(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(e.length<2){throw Error("Expected at least 2 sketches.")}if(i.any(e,function(e){return e!==o.Types.sketch}))throw Error("Expected all arguments to be sketches. Got ["+e.join(", ")+"].");return o.Types.sketch}t.library={functions:{sketchStrokeCount:r.__assign(r.__assign({},y),{deprecated:function(){return c.i18n.s("cl-docs-warning-sketch-stroke-count-deprecation")}}),sketchPointCount:r.__assign(r.__assign({},d),{deprecated:function(){return c.i18n.s("cl-docs-warning-sketch-stroke-point-deprecation")}}),sketchTotalStrokeLength:r.__assign(r.__assign({},m),{deprecated:function(){return c.i18n.s("cl-docs-warning-sketch-stroke-total-stroke-length-deprecation")}}),sketchYValues:r.__assign(r.__assign({},v),{deprecated:function(){return c.i18n.s("cl-docs-warning-sketch-y-values-deprecation")}}),sketchXValues:r.__assign(r.__assign({},g),{deprecated:function(){return c.i18n.s("cl-docs-warning-sketch-x-values-deprecation")}}),mergeSketches:{version:"v2",description:function(){return c.i18n.s("cl-docs-description-lib-merge-sketches")},lookup:function(e){var t=x.apply(void 0,e.map(function(e){return e.type}));return{valueType:t,body:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}var r={strokes:[],points:[]};for(var n=0,i=e;n<i.length;n++){var a=i[n];if(!a)continue;for(var o=0,s=a.strokes;o<s.length;o++){var u=s[o];r.strokes.push(u)}for(var c=0,l=a.points;c<l.length;c++){var p=l[c];r.points.push(p)}if(a.bounds&&!r.bounds){r.bounds=a.bounds}}return r}}}}},types:{sketch:{description:function(){return c.i18n.s("cl-docs-description-type-sketch")},attributes:{filterByColor:{version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-filter-by-color")},argTypes:[o.Types.sketch,o.Types.color],outputType:o.Types.sketch,noUndefinedArgs:true,value:function(e,t){return a.filterByRgbColor(e,t)}},setColor:{version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-set-color")},argTypes:[o.Types.sketch,o.Types.color],outputType:o.Types.sketch,noUndefinedArgs:true,value:function(e,t){return a.replaceAllColors(e,n.colorToString(t))}},setOpacity:{version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-set-opacity")},argTypes:[o.Types.sketch,o.Types.number],outputType:o.Types.sketch,noUndefinedArgs:true,value:function(e,t){return a.replaceAllOpacity(e,t)}},scaleThicknessBy:{version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-scale-thickness-by")},argTypes:[o.Types.sketch,o.Types.number],outputType:o.Types.sketch,noUndefinedArgs:true,value:function(e,t){var r=p.copydata(e);r.scaleThicknessBy=r.scaleThicknessBy!==undefined?t*r.scaleThicknessBy:t;return r}},pointCount:d,strokeCount:y,totalStrokeLength:m,yValuesAt:v,xValuesAt:g,pointXValues:f,pointYValues:h,transform:{version:"v3",description:function(){return c.i18n.s("cl-docs-description-lib-sketch-transform")},argTypes:[o.Types.sketch,o.Types.function2,o.Types.function2],outputType:o.Types.sketch,noUndefinedArgs:true,prependGlobalConstants:["degreeModeNodeId"],value:function(e,t,r,n){try{var i=new s.context;var o=u.generateFunctionProxyVariables(2);i.processChangeSet({statements:[{id:"X",latex:"f("+o.join(",")+")="+r},{id:"Y",latex:"g("+o.join(",")+")="+n}],degreeMode:e});var c=function(e){e=e.replace(/\\operatorname\{(.*)\}/,"$1");return e.replace(/[{}\\]/g,"")};var l=o.map(function(e){return c(e)});var p=i.analysis.X.concreteTree.getCompiledFunction(l).fn;var d=i.analysis.Y.concreteTree.getCompiledFunction(l).fn;var f=function(e){return{x:p(e.x,e.y),y:d(e.x,e.y)}};return a.transformCoordinates(t,f)}catch(e){return undefined}}}}},sketchTools:{description:function(){return c.i18n.s("cl-docs-description-type-sketch-tools")},attributes:{pencil:b("pencil"),line:b("line"),eraser:b("eraser"),points:b("points"),math:b("math"),text:b("text")}}},constants:{sketchTools:{valueType:o.Types.sketchTools,value:{},description:function(){return c.i18n.s("cl-docs-description-lib-sketch-tools")}}}}});define("core/computation-layer/library/button-styles",["require","exports","core/computation-layer/cl-types","core/lib/i18n"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.library=void 0;function i(e){return{version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-style-getter",{styleName:n.i18n.raw(e)})},argTypes:[r.Types.buttonStyles],outputType:r.Types.buttonStyle,value:function(){return e}}}t.library={functions:{},types:{buttonStyles:{description:function(){return n.i18n.s("cl-docs-description-type-button-styles")},attributes:{red:i("red"),default:i("default"),link:i("link")}}},constants:{buttonStyles:{valueType:r.Types.buttonStyles,value:{},description:function(){return n.i18n.s("cl-docs-description-lib-button-styles")}}}}});define("core/computation-layer/library/lists",["require","exports","../cl-types","core/lib/i18n"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.library=void 0;var i={version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-length")},argTypes:[r.Types.numberList],outputType:r.Types.number,noUndefinedArgs:true,value:function(e){return e.length}};var a={version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-elementAt")},argTypes:[r.Types.numberList,r.Types.number],outputType:r.Types.number,noUndefinedArgs:true,value:function(e,t){return e[t-1]}};t.library={functions:{max:{version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-max")},argTypes:[r.Types.numberList],outputType:r.Types.number,noUndefinedArgs:true,value:function(e){return Math.max.apply(Math,e)}},min:{version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-min")},argTypes:[r.Types.numberList],outputType:r.Types.number,noUndefinedArgs:true,value:function(e){return Math.min.apply(Math,e)}},length:i},types:{numberList:{description:function(){return n.i18n.s("cl-docs-description-type-number-list")},attributes:{length:i,elementAt:a}}},constants:{}}});define("core/computation-layer/pattern-cl-types",["require","exports","tslib","./cl-types","core/lib/assert-unreachable"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.patternValidator=t.termParamsFromType=t.patternParamsFromType=t.getPatternMatchTypeFromSpec=t.getPatternTypeFromSpec=t.RepeatedTermType=t.DifferencePatternType=t.RadicalPatternType=t.NegativePatternType=t.DivisionPatternType=t.FractionPatternType=t.ExponentPatternType=t.ContainsPatternType=t.ProductPatternType=t.SumPatternType=void 0;var a=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"sumPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.sumTypeCache[r]==undefined){this.sumTypeCache[r]=new t(e)}return this.sumTypeCache[r]};t.sumTypeCache={};return t}(n.CLType);t.SumPatternType=a;var o=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"productPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.productTypeCache[r]==undefined){this.productTypeCache[r]=new t(e)}return this.productTypeCache[r]};t.productTypeCache={};return t}(n.CLType);t.ProductPatternType=o;var s=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"containsPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.containsTypeCache[r]==undefined){this.containsTypeCache[r]=new t(e)}return this.containsTypeCache[r]};t.containsTypeCache={};return t}(n.CLType);t.ContainsPatternType=s;var u=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"exponentPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.exponentTypeCache[r]==undefined){this.exponentTypeCache[r]=new t(e)}return this.exponentTypeCache[r]};t.exponentTypeCache={};return t}(n.CLType);t.ExponentPatternType=u;var c=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"fractionPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.fractionTypeCache[r]==undefined){this.fractionTypeCache[r]=new t(e)}return this.fractionTypeCache[r]};t.fractionTypeCache={};return t}(n.CLType);t.FractionPatternType=c;var l=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"divisionPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.divisionTypeCache[r]==undefined){this.divisionTypeCache[r]=new t(e)}return this.divisionTypeCache[r]};t.divisionTypeCache={};return t}(n.CLType);t.DivisionPatternType=l;var p=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"negativePattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.negativeTypeCache[r]==undefined){this.negativeTypeCache[r]=new t(e)}return this.negativeTypeCache[r]};t.negativeTypeCache={};return t}(n.CLType);t.NegativePatternType=p;var d=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"radicalPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.radicalTypeCache[r]==undefined){this.radicalTypeCache[r]=new t(e)}return this.radicalTypeCache[r]};t.radicalTypeCache={};return t}(n.CLType);t.RadicalPatternType=d;var f=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"differencePattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.differenceTypeCache[r]==undefined){this.differenceTypeCache[r]=new t(e)}return this.differenceTypeCache[r]};t.differenceTypeCache={};return t}(n.CLType);t.DifferencePatternType=f;var h=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"repeatedPattern")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.repeatedTypeCache[r]==undefined){this.repeatedTypeCache[r]=new t(e)}return this.repeatedTypeCache[r]};t.repeatedTypeCache={};return t}(n.CLType);t.RepeatedTermType=h;var y=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"sumPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.sumMatchTypeCache[r]==undefined){this.sumMatchTypeCache[r]=new t(e)}return this.sumMatchTypeCache[r]};t.sumMatchTypeCache={};return t}(n.CLType);var m=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"productPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.productMatchTypeCache[r]==undefined){this.productMatchTypeCache[r]=new t(e)}return this.productMatchTypeCache[r]};t.productMatchTypeCache={};return t}(n.CLType);var v=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"exponentPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.exponentMatchTypeCache[r]==undefined){this.exponentMatchTypeCache[r]=new t(e)}return this.exponentMatchTypeCache[r]};t.exponentMatchTypeCache={};return t}(n.CLType);var g=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"containsPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.containsMatchTypeCache[r]==undefined){this.containsMatchTypeCache[r]=new t(e)}return this.containsMatchTypeCache[r]};t.containsMatchTypeCache={};return t}(n.CLType);var b=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"fractionPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.fractionMatchTypeCache[r]==undefined){this.fractionMatchTypeCache[r]=new t(e)}return this.fractionMatchTypeCache[r]};t.fractionMatchTypeCache={};return t}(n.CLType);var x=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"divisionPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.divisionMatchTypeCache[r]==undefined){this.divisionMatchTypeCache[r]=new t(e)}return this.divisionMatchTypeCache[r]};t.divisionMatchTypeCache={};return t}(n.CLType);var S=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"negativePatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.negativeMatchTypeCache[r]==undefined){this.negativeMatchTypeCache[r]=new t(e)}return this.negativeMatchTypeCache[r]};t.negativeMatchTypeCache={};return t}(n.CLType);var T=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"radicalPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.radicalMatchTypeCache[r]==undefined){this.radicalMatchTypeCache[r]=new t(e)}return this.radicalMatchTypeCache[r]};t.radicalMatchTypeCache={};return t}(n.CLType);var w=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"differencePatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.differenceMatchTypeCache[r]==undefined){this.differenceMatchTypeCache[r]=new t(e)}return this.differenceMatchTypeCache[r]};t.differenceMatchTypeCache={};return t}(n.CLType);var _=function(e){r.__extends(t,e);function t(t){var r=e.call(this,"repeatedPatternMatch")||this;r.params=t;return r}t.get=function(e){var r=JSON.stringify(e);if(this.repeatedMatchTypeCache[r]==undefined){this.repeatedMatchTypeCache[r]=new t(e)}return this.repeatedMatchTypeCache[r]};t.repeatedMatchTypeCache={};return t}(n.CLType);function I(e){switch(e.type){case"sum":return a.get(e);case"product":return o.get(e);case"exponent":return u.get(e);case"fraction":return c.get(e);case"division":return l.get(e);case"difference":return f.get(e);case"negative":return p.get(e);case"radical":return d.get(e);case"contains":return s.get(e);case"repeated":return h.get(e);case"number":return n.Types.numberPattern;case"mixedNumber":return n.Types.mixedNumberPattern;case"literal":return n.Types.literalPattern;case"expression":return n.Types.expressionPattern;case"or":return n.Types.orPattern;case"scientific":return n.Types.scientificPattern;default:return i.assertUnreachable(e)}}t.getPatternTypeFromSpec=I;function E(e){switch(e.type){case"sum":return y.get(e);case"product":return m.get(e);case"exponent":return v.get(e);case"fraction":return b.get(e);case"division":return x.get(e);case"difference":return w.get(e);case"negative":return S.get(e);case"radical":return T.get(e);case"repeated":return _.get(e);case"contains":return g.get(e);case"literal":return n.Types.literalPatternMatch;case"number":return n.Types.numberPatternMatch;case"mixedNumber":return n.Types.mixedNumberPatternMatch;case"expression":return n.Types.expressionPatternMatch;case"or":return n.Types.orPatternMatch;case"scientific":return n.Types.scientificPatternMatch;default:return i.assertUnreachable(e)}}t.getPatternMatchTypeFromSpec=E;function C(e){if(!t.patternValidator.matches(e)){throw new Error("Expected "+t.patternValidator+", but got "+e)}switch(e.type){case"exponentPattern":case"fractionPattern":case"divisionPattern":case"differencePattern":case"radicalPattern":case"sumPattern":case"productPattern":case"containsPattern":case"negativePattern":return e.params;case"numberPattern":return{type:"number"};case"mixedNumberPattern":return{type:"mixedNumber"};case"literalPattern":return{type:"literal"};case"expressionPattern":return{type:"expression"};case"orPattern":return{type:"or"};case"scientificPattern":return{type:"scientific"};default:return i.assertUnreachable(e)}}t.patternParamsFromType=C;function M(e){if(e instanceof h){return e.params}return C(e)}t.termParamsFromType=M;t.patternValidator={matches:function(e){return e.type=="numberPattern"||e.type=="mixedNumberPattern"||e.type=="sumPattern"||e.type=="productPattern"||e.type=="exponentPattern"||e.type=="literalPattern"||e.type=="orPattern"||e.type=="expressionPattern"||e.type=="scientificPattern"||e.type=="fractionPattern"||e.type=="divisionPattern"||e.type=="negativePattern"||e.type=="differencePattern"||e.type=="radicalPattern"||e.type=="containsPattern"},toString:function(){return"A pattern of some type"}}});define("core/computation-layer/library/patterns",["require","exports","tslib","core/lib/mathtools","../cl-types","./patterns.matching","core/computation-layer/pattern-cl-types","core/lib/i18n","core/lib/evaluator-helpers"],function(e,t,r,n,i,a,o,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.library=void 0;var c={latex:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-match-latex")},noUndefinedArgs:true,lookup:function(e){if(e.length!=1)throw new Error("Expected no arguments");return{valueType:i.Types.latex,body:function(e){return e.latex!=undefined?{latex:e.latex}:undefined}}}}};function l(e){var t={};var r=function(r){var n=r+1;var i=r;t["term"+n]={version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-term-n",{termNumber:n})},validForType:function(t){var r=t.params;return r.terms&&r.terms.length>=e},noUndefinedArgs:true,lookup:function(e){if(e.length!=1)throw new Error("No arguments expected");var t=e[0].type;return{body:function(e){return e.terms[i]},valueType:o.getPatternMatchTypeFromSpec(v(t.params.terms[i]))}}}};for(var n=0;n<e;n++){r(n)}return t}function p(e,t){return{version:"v2",description:t,noUndefinedArgs:true,lookup:function(t){if(t.length!=1){throw new Error("No arguments expected")}var r=t[0].type;return{body:function(t){return t[e]},valueType:o.getPatternMatchTypeFromSpec(r.params[e])}}}}function d(){return{strictOrder:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-strict-order")},noUndefinedArgs:true,lookup:function(e){if(e.length!=1){throw new Error("strictOrder doesn't accept any arguments")}return{body:function(e){return r.__assign(r.__assign({},e),{strictOrder:true})},valueType:e[0].type}}}}}var f={rejectParens:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-reject-parens")},noUndefinedArgs:true,lookup:function(e){if(e.length!=1){throw new Error("rejectParens doesn't accept any arguments")}return{body:function(e){return r.__assign(r.__assign({},e),{rejectParens:true})},valueType:e[0].type}}},allowParens:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-allow-parens")},noUndefinedArgs:true,lookup:function(e){if(e.length!=1){throw new Error("rejectParens doesn't accept any arguments")}return{body:function(e){return r.__assign(r.__assign({},e),{rejectParens:false})},valueType:e[0].type}}}};function h(e){return{parse:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-parse")},lookup:function(t){if(t.length!=2)throw new Error("Expected latex string as only argument");var r=t[0],o=t[1];var s=[];if(!(i.Types.string.matches(o.type)||i.Types.latex.matches(o.type))){throw new Error("Expected latex, got "+o.type)}if(!i.Types.latex.matches(o.type)){}return{valueType:e(r.type),warnings:s,desiredArgTypes:[r.type,i.Types.latex],prependGlobalConstants:["degreeModeNodeId"],body:function(e,t,r){if(!t){return undefined}var i=r?n.expressionParser.parse(r.latex):undefined;var o={rejectParens:false,strictOrder:false,degreeMode:e};return a.matchPattern(t,i,o)}}}},matches:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-matches")},lookup:function(e){if(e.length!=2){throw new Error("Expected a single latex argument.")}if(!o.patternValidator.matches(e[0].type)){throw new Error("Internal error. Matches called on unexpected pattern type")}if(!(i.Types.latex.matches(e[1].type)||i.Types.string.matches(e[1].type))){throw new Error("Expected argument to be latex, but got "+e[1].type.type)}var t=[];if(!i.Types.latex.matches(e[1].type)){}return{valueType:i.Types.boolean,warnings:t,desiredArgTypes:[e[0].type,i.Types.latex],prependGlobalConstants:["degreeModeNodeId"],body:function(e,t,r){if(!t){return undefined}var i=r?n.expressionParser.parse(r.latex):undefined;var o={rejectParens:false,strictOrder:false,degreeMode:e};return!!a.matchPattern(t,i,o)}}}}}}t.library={functions:{},types:{patternLibrary:{description:function(){return s.EMPTY},attributes:{number:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-number")},argTypes:[i.Types.patternLibrary],outputType:i.Types.numberPattern,value:function(){return{type:"number"}}},integer:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-integer")},argTypes:[i.Types.patternLibrary],outputType:i.Types.numberPattern,value:function(){return{type:"number",integerOnly:true}}},mixedNumber:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-mixed-number")},argTypes:[i.Types.patternLibrary],outputType:i.Types.mixedNumberPattern,value:function(){return{type:"mixedNumber"}}},scientific:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-scientific")},argTypes:[i.Types.patternLibrary],outputType:i.Types.scientificPattern,value:function(){return{type:"scientific"}}},literal:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-literal")},argTypes:[i.Types.patternLibrary,i.Types.latex],outputType:i.Types.literalPattern,noUndefinedArgs:true,value:function(e,t){return{type:"literal",text:t.latex}}},expression:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-expression")},argTypes:[i.Types.patternLibrary],outputType:i.Types.expressionPattern,value:function(e){return{type:"expression"}}},anyOf:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-any-of")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e.slice(1);i.assertType(i.Types.patternLibrary,t.type);for(var n=0,a=r;n<a.length;n++){var s=a[n];var u=o.patternParamsFromType(s.type);if(u.type=="or"){throw new Error("Instead of nesting or terms, just put all terms in a single or()")}}return{body:function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}return{type:"or",options:t}},valueType:i.Types.orPattern}}},sum:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-sum")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e.slice(1);i.assertType(i.Types.patternLibrary,t.type);var n=r.map(function(e){var t=o.termParamsFromType(e.type);if(t.type=="sum"){throw new Error("Instead of nesting sums, just put all terms in a single sum()")}return t});return{body:function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}return{type:"sum",terms:t}},valueType:o.getPatternTypeFromSpec({type:"sum",terms:y(n)})}}},contains:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-contains")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e.slice(1);i.assertType(i.Types.patternLibrary,t.type);if(r.length!=1){throw new Error("Current implementation only accepts a single term")}return{body:function(e,t){return{type:"contains",terms:[t]}},valueType:o.getPatternTypeFromSpec({type:"contains",terms:y([o.termParamsFromType(r[0].type)])})}}},product:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-product")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e.slice(1);i.assertType(i.Types.patternLibrary,t.type);var n=r.map(function(e){var t=o.termParamsFromType(e.type);if(t.type=="product"){throw new Error("Instead of nesting products, just put all terms in a single product()")}return t});return{body:function(e){var t=[];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}return{type:"product",terms:t}},valueType:o.getPatternTypeFromSpec({type:"product",terms:y(n)})}}},exponent:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-exponent")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1],n=e[2];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t,r){return{type:"exponent",base:t,power:r}},valueType:o.getPatternTypeFromSpec({type:"exponent",base:m(o.patternParamsFromType(r.type)),power:m(o.patternParamsFromType(n.type))})}}},fraction:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-fraction")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1],n=e[2];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t,r){return{type:"fraction",numerator:t,denominator:r}},valueType:o.getPatternTypeFromSpec({type:"fraction",numerator:m(o.patternParamsFromType(r.type)),denominator:m(o.patternParamsFromType(n.type))})}}},division:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-division")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1],n=e[2];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t,r){return{type:"division",dividend:t,divisor:r}},valueType:o.getPatternTypeFromSpec({type:"division",dividend:m(o.patternParamsFromType(r.type)),divisor:m(o.patternParamsFromType(n.type))})}}},radical:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-radical")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1],n=e[2];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t,r){return{type:"radical",radicand:t,degree:r}},valueType:o.getPatternTypeFromSpec({type:"radical",radicand:m(o.patternParamsFromType(r.type)),degree:n?m(o.patternParamsFromType(n.type)):undefined})}}},negative:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-negative")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t){return{type:"negative",negated:t}},valueType:o.getPatternTypeFromSpec({type:"negative",negated:m(o.patternParamsFromType(r.type))})}}},difference:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-difference")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1],n=e[2];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t,r){return{type:"difference",subtrahend:r,minuend:t}},valueType:o.getPatternTypeFromSpec({type:"difference",subtrahend:m(o.patternParamsFromType(n.type)),minuend:m(o.patternParamsFromType(r.type))})}}},repeat:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-repeat")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t){return{type:"repeated",pattern:t}},valueType:o.RepeatedTermType.get({type:"repeated",pattern:o.patternParamsFromType(r.type)})}}},optional:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-optional")},noUndefinedArgs:true,lookup:function(e){var t=e[0],r=e[1];i.assertType(i.Types.patternLibrary,t.type);return{body:function(e,t){return{type:"repeated",min:0,max:1,pattern:t}},valueType:o.RepeatedTermType.get({type:"repeated",pattern:o.patternParamsFromType(r.type)})}}}}},numberPattern:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign(r.__assign({},h(function(){return i.Types.numberPatternMatch})),f),{satisfies:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-satisfies")},noUndefinedArgs:true,lookup:function(e){if(e.length!=2||!(i.Types.string.matches(e[1].type)||i.Types.latex.matches(e[1].type))){throw new Error("number.satisfies() requires one argument - latex like `x>0`")}var t=[];if(!i.Types.latex.matches(e[1].type)){}return{valueType:e[0].type,warnings:t,desiredArgTypes:[e[0].type,i.Types.latex],body:function(e,t){return r.__assign(r.__assign({},e),{conditions:r.__spreadArrays(e.conditions||[],[t.latex])})}}}}})},scientificPattern:{description:function(){return s.EMPTY},attributes:h(function(){return i.Types.scientificPatternMatch})},mixedNumberPattern:{description:function(){return s.EMPTY},attributes:h(function(){return i.Types.mixedNumberPatternMatch})},exponentPattern:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},h(function(e){return o.getPatternMatchTypeFromSpec(e.params)})),f)},fractionPattern:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},h(function(e){return o.getPatternMatchTypeFromSpec(e.params)})),f)},divisionPattern:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},h(function(e){return o.getPatternMatchTypeFromSpec(e.params)})),f)},negativePattern:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},h(function(e){return o.getPatternMatchTypeFromSpec(e.params)})),f)},radicalPattern:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},h(function(e){return o.getPatternMatchTypeFromSpec(e.params)})),f)},differencePattern:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},h(function(e){return o.getPatternMatchTypeFromSpec(e.params)})),f)},sumPattern:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign(r.__assign({},h(function(e){return o.getPatternMatchTypeFromSpec(e.params)})),d()),f)},productPattern:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign(r.__assign({},h(function(e){return o.getPatternMatchTypeFromSpec(e.params)})),d()),f)},containsPattern:{description:function(){return s.EMPTY},attributes:r.__assign({},h(function(e){return o.getPatternMatchTypeFromSpec(e.params)}))},literalPattern:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},h(function(){return i.Types.literalPatternMatch})),f)},expressionPattern:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},h(function(){return i.Types.expressionPatternMatch})),f)},orPattern:{description:function(){return s.EMPTY},attributes:r.__assign({},h(function(){return i.Types.orPatternMatch}))},sumPatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},c),l(10))},productPatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},c),l(10))},containsPatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},c),l(1))},expressionPatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign({},c)},exponentPatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},c),{base:p("base",function(){return s.i18n.s("cl-docs-description-lib-pattern-base")}),exponent:p("power",function(){return s.i18n.s("cl-docs-description-lib-pattern-power")})})},fractionPatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},c),{numerator:p("numerator",function(){return s.i18n.s("cl-docs-description-lib-pattern-numerator")}),denominator:p("denominator",function(){return s.i18n.s("cl-docs-description-lib-pattern-denominator")})})},divisionPatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},c),{dividend:p("dividend",function(){return s.i18n.s("cl-docs-description-lib-pattern-dividend")}),divisor:p("divisor",function(){return s.i18n.s("cl-docs-description-lib-pattern-divisor")})})},negativePatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},c),{negated:p("negated",function(){return s.i18n.s("cl-docs-description-lib-pattern-negated")})})},radicalPatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},c),{radicand:p("radicand",function(){return s.i18n.s("cl-docs-description-lib-pattern-radicand")}),degree:r.__assign(r.__assign({},p("degree",function(){return s.i18n.s("cl-docs-description-lib-pattern-degree")})),{validForType:function(e){return e.type=="radicalPatternMatch"&&!!e.params.degree}})})},differencePatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},c),{subtrahend:p("subtrahend",function(){return s.i18n.s("cl-docs-description-lib-pattern-subtrahend")}),minuend:p("minuend",function(){return s.i18n.s("cl-docs-description-lib-pattern-minuend")})})},literalPatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign({},c)},repeatedPatternMatch:{description:function(){return s.EMPTY},attributes:{n:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-repeated-n")},noUndefinedArgs:true,lookup:function(e){if(e.length!=1)throw new Error("No arguments expected");return{valueType:i.Types.number,body:function(e){return e&&e.matches.length}}}},nth:{version:"v2",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-repeated-nth")},noUndefinedArgs:true,lookup:function(e){if(e.length!=2){throw new Error("Expected a single number as an argument")}var t=e[0],r=e[1];if(!i.Types.number.matches(r.type)){throw new Error("Expected "+i.Types.number+", got "+e[1].type)}return{body:function(e,t){return e.matches[t-1]},valueType:o.getPatternMatchTypeFromSpec(t.type.params.pattern)}}}}},numberPatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},c),{numericValue:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-number-numeric-value")},argTypes:[i.Types.numberPatternMatch],outputType:i.Types.number,prependGlobalConstants:["degreeModeNodeId"],value:function(e,t){return t?u.computeNumericValueFromLatex(t.latex,e):NaN}}})},scientificPatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},c),{numericValue:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-scientific-numeric-value")},argTypes:[i.Types.scientificPatternMatch],outputType:i.Types.number,prependGlobalConstants:["degreeModeNodeId"],value:function(e,t){return t?u.computeNumericValueFromLatex(t.latex,e):NaN}},coefficient:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-scientific-coefficient")},argTypes:[i.Types.scientificPatternMatch],outputType:i.Types.number,value:function(e){return e&&e.coefficient}},exponent:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-scientific-exponent")},argTypes:[i.Types.scientificPatternMatch],outputType:i.Types.number,value:function(e){return e&&e.exponent}}})},mixedNumberPatternMatch:{description:function(){return s.EMPTY},attributes:r.__assign(r.__assign({},c),{whole:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-mixed-number-whole")},argTypes:[i.Types.mixedNumberPatternMatch],outputType:i.Types.number,value:function(e){return e&&e.whole}},numerator:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-mixed-number-numerator")},argTypes:[i.Types.mixedNumberPatternMatch],outputType:i.Types.number,value:function(e){return e&&e.numerator}},denominator:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-mixed-number-denominator")},argTypes:[i.Types.mixedNumberPatternMatch],outputType:i.Types.number,value:function(e){return e&&e.denominator}},numericValue:{version:"v3",description:function(){return s.i18n.s("cl-docs-description-lib-pattern-mixed-number-numeric-value")},argTypes:[i.Types.mixedNumberPatternMatch],outputType:i.Types.number,prependGlobalConstants:["degreeModeNodeId"],value:function(e,t){return t?u.computeNumericValueFromLatex(t.latex,e):NaN}}})}},constants:{patterns:{valueType:i.Types.patternLibrary,value:{},description:function(){return s.i18n.s("cl-docs-description-lib-patterns")},internal:true}}};function y(e){return e}function m(e){return e}function v(e){return e}});(function(e){"use strict";function t(e,t){var r=(e&65535)+(t&65535);var n=(e>>16)+(t>>16)+(r>>16);return n<<16|r&65535}function r(e,t){return e<<t|e>>>32-t}function n(e,n,i,a,o,s){return t(r(t(t(n,e),t(a,s)),o),i)}function i(e,t,r,i,a,o,s){return n(t&r|~t&i,e,t,a,o,s)}function a(e,t,r,i,a,o,s){return n(t&i|r&~i,e,t,a,o,s)}function o(e,t,r,i,a,o,s){return n(t^r^i,e,t,a,o,s)}function s(e,t,r,i,a,o,s){return n(r^(t|~i),e,t,a,o,s)}function u(e,r){e[r>>5]|=128<<r%32;e[(r+64>>>9<<4)+14]=r;var n;var u;var c;var l;var p;var d=1732584193;var f=-271733879;var h=-1732584194;var y=271733878;for(n=0;n<e.length;n+=16){u=d;c=f;l=h;p=y;d=i(d,f,h,y,e[n],7,-680876936);y=i(y,d,f,h,e[n+1],12,-389564586);h=i(h,y,d,f,e[n+2],17,606105819);f=i(f,h,y,d,e[n+3],22,-1044525330);d=i(d,f,h,y,e[n+4],7,-176418897);y=i(y,d,f,h,e[n+5],12,1200080426);h=i(h,y,d,f,e[n+6],17,-1473231341);f=i(f,h,y,d,e[n+7],22,-45705983);d=i(d,f,h,y,e[n+8],7,1770035416);y=i(y,d,f,h,e[n+9],12,-1958414417);h=i(h,y,d,f,e[n+10],17,-42063);f=i(f,h,y,d,e[n+11],22,-1990404162);d=i(d,f,h,y,e[n+12],7,1804603682);y=i(y,d,f,h,e[n+13],12,-40341101);h=i(h,y,d,f,e[n+14],17,-1502002290);f=i(f,h,y,d,e[n+15],22,1236535329);d=a(d,f,h,y,e[n+1],5,-165796510);y=a(y,d,f,h,e[n+6],9,-1069501632);h=a(h,y,d,f,e[n+11],14,643717713);f=a(f,h,y,d,e[n],20,-373897302);d=a(d,f,h,y,e[n+5],5,-701558691);y=a(y,d,f,h,e[n+10],9,38016083);h=a(h,y,d,f,e[n+15],14,-660478335);f=a(f,h,y,d,e[n+4],20,-405537848);d=a(d,f,h,y,e[n+9],5,568446438);y=a(y,d,f,h,e[n+14],9,-1019803690);h=a(h,y,d,f,e[n+3],14,-187363961);f=a(f,h,y,d,e[n+8],20,1163531501);d=a(d,f,h,y,e[n+13],5,-1444681467);y=a(y,d,f,h,e[n+2],9,-51403784);h=a(h,y,d,f,e[n+7],14,1735328473);f=a(f,h,y,d,e[n+12],20,-1926607734);d=o(d,f,h,y,e[n+5],4,-378558);y=o(y,d,f,h,e[n+8],11,-2022574463);h=o(h,y,d,f,e[n+11],16,1839030562);f=o(f,h,y,d,e[n+14],23,-35309556);d=o(d,f,h,y,e[n+1],4,-1530992060);y=o(y,d,f,h,e[n+4],11,1272893353);h=o(h,y,d,f,e[n+7],16,-155497632);f=o(f,h,y,d,e[n+10],23,-1094730640);d=o(d,f,h,y,e[n+13],4,681279174);y=o(y,d,f,h,e[n],11,-358537222);h=o(h,y,d,f,e[n+3],16,-722521979);f=o(f,h,y,d,e[n+6],23,76029189);d=o(d,f,h,y,e[n+9],4,-640364487);y=o(y,d,f,h,e[n+12],11,-421815835);h=o(h,y,d,f,e[n+15],16,530742520);f=o(f,h,y,d,e[n+2],23,-995338651);d=s(d,f,h,y,e[n],6,-198630844);y=s(y,d,f,h,e[n+7],10,1126891415);h=s(h,y,d,f,e[n+14],15,-1416354905);f=s(f,h,y,d,e[n+5],21,-57434055);d=s(d,f,h,y,e[n+12],6,1700485571);y=s(y,d,f,h,e[n+3],10,-1894986606);h=s(h,y,d,f,e[n+10],15,-1051523);f=s(f,h,y,d,e[n+1],21,-2054922799);d=s(d,f,h,y,e[n+8],6,1873313359);y=s(y,d,f,h,e[n+15],10,-30611744);h=s(h,y,d,f,e[n+6],15,-1560198380);f=s(f,h,y,d,e[n+13],21,1309151649);d=s(d,f,h,y,e[n+4],6,-145523070);y=s(y,d,f,h,e[n+11],10,-1120210379);h=s(h,y,d,f,e[n+2],15,718787259);f=s(f,h,y,d,e[n+9],21,-343485551);d=t(d,u);f=t(f,c);h=t(h,l);y=t(y,p)}return[d,f,h,y]}function c(e){var t;var r="";var n=e.length*32;for(t=0;t<n;t+=8){r+=String.fromCharCode(e[t>>5]>>>t%32&255)}return r}function l(e){var t;var r=[];r[(e.length>>2)-1]=undefined;for(t=0;t<r.length;t+=1){r[t]=0}var n=e.length*8;for(t=0;t<n;t+=8){r[t>>5]|=(e.charCodeAt(t/8)&255)<<t%32}return r}function p(e){return c(u(l(e),e.length*8))}function d(e,t){var r;var n=l(e);var i=[];var a=[];var o;i[15]=a[15]=undefined;if(n.length>16){n=u(n,e.length*8)}for(r=0;r<16;r+=1){i[r]=n[r]^909522486;a[r]=n[r]^1549556828}o=u(i.concat(l(t)),512+t.length*8);return c(u(a.concat(o),512+128))}function f(e){var t="0123456789abcdef";var r="";var n;var i;for(i=0;i<e.length;i+=1){n=e.charCodeAt(i);r+=t.charAt(n>>>4&15)+t.charAt(n&15)}return r}function h(e){return unescape(encodeURIComponent(e))}function y(e){return p(h(e))}function m(e){return f(y(e))}function v(e,t){return d(h(e),h(t))}function g(e,t){return f(v(e,t))}function b(e,t,r){if(!t){if(!r){return m(e)}return y(e)}if(!r){return g(t,e)}return v(t,e)}if(typeof define==="function"&&define.amd){define("vendor/md5",[],function(){return b})}else if(typeof module==="object"&&module.exports){module.exports=b}else{e.md5=b}})(this);define("core/computation-layer/library/random",["require","exports","vendor/md5","underscore","../cl-types","../helpers","core/lib/i18n"],function(e,t,r,n,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.library=t.Generator=void 0;Object.defineProperty(t,"Generator",{enumerable:true,get:function(){return i.Generator}});var s={version:"v2",description:function(){return o.i18n.s("cl-docs-description-lib-random-generator")},lookup:function(e,t){for(var r=0,n=e;r<n.length;r++){var o=n[r];if(!i.Types.number.matches(o.type)){throw new Error("All seeds to randomGenerator must be numbers")}}var s=t.registerLocation("randomGenerator");return{valueType:i.Types.randomGenerator,prependGlobalConstants:["randomSeedNodeId"],body:function(e){var r=[];for(var n=1;n<arguments.length;n++){r[n-1]=arguments[n]}if(!a.isCLStringType(e)){throw new Error("Internal CL Error: Expected a CL String randomSeedCLValue prepended to argument list.")}var i=t.resolveLocation(s);return{locationIdentifier:i,seeds:r,studentId:a.synthesizeStringInternal(e),plaintextBase:a.synthesizeStringInternal(e)+"::"+i+"::"+r.join(":")}}}}};var u={version:"v2",description:function(){return o.i18n.s("cl-docs-description-lib-random-int")},lookup:function(e,t){if(e.length!=3)throw new Error("int expects 2 arguments");if(e[1].type!=i.Types.number||e[2].type!=i.Types.number){throw new Error("Both arguments to int must be numbers")}var n=t.registerLocation("randomInt");return{valueType:i.Types.number,body:function(e,i,a){var o;if(i==undefined||a==undefined){return NaN}i=Math.round(i);a=Math.round(a);if(i>a)o=[a,i],i=o[0],a=o[1];if(i==a)return i;if(!(i>-2147483648))return NaN;if(!(a<2147483648))return NaN;var s=e.plaintextBase+"::"+t.resolveLocation(n);var u=0;var c=0;var l=a-i+1;var p=l*Math.floor(4294967296/l);do{var d=s+"::"+u++;var f=r(d);c=parseInt(f.slice(0,8),16)}while(c>=p);var h=c%l;return i+h}}}};var c={version:"v2",description:function(){return o.i18n.s("cl-docs-description-lib-random-float")},lookup:function(e,t){if(e.length!=3)throw new Error("float expects 2 arguments");if(e[1].type!=i.Types.number||e[2].type!=i.Types.number){throw new Error("Both arguments to float must be numbers")}var a=t.registerLocation("randomFloat");return{valueType:i.Types.number,body:function(e,i,o){var s;if(i==undefined||!n.isFinite(i))return NaN;if(o==undefined||!n.isFinite(o))return NaN;if(i==o)return i;if(i>o)s=[o,i],i=s[0],o=s[1];var u=e.plaintextBase+"::"+t.resolveLocation(a);var c=r(u);var l=parseInt(c.slice(0,8),16)&2097151;var p=parseInt(c.slice(8,16),16);var d=(l*4294967296+p)/9007199254740992;return i+d*(o-i)}}}};t.library={functions:{randomGenerator:s},types:{randomGenerator:{description:function(){return o.i18n.s("cl-docs-description-type-random-generator")},attributes:{int:u,float:c}}},constants:{}}});define("core/computation-layer/library/layer",["require","exports","../cl-types","core/lib/i18n"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.library=void 0;function i(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}if(e.length<2){throw Error("Expected at least 2 layers.")}for(var n=0;n<e.length;n++){if(e[n]!==r.Types.layer){throw Error("Expected all arguments to be layers. Got ["+e.join(", ")+"].")}}return r.Types.layer}t.library={functions:{sketchLayer:{version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-skech-layer")},argTypes:[r.Types.sketch],outputType:r.Types.layer,noUndefinedArgs:true,value:function(e){return{type:"sketch",sketch:e}}},layerStack:{version:"v2",description:function(){return n.i18n.s("cl-docs-description-lib-layer-stack")},lookup:function(e){var t=i.apply(void 0,e.map(function(e){return e.type}));return{valueType:t,body:function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return{type:"stack",layers:e.filter(function(e){return e!=undefined})}}}}},cardPair:{version:"v3",internal:true,description:function(){return n.i18n.raw("Renders 2 layers as cards, at an angle. Currently only accepts graph layers")},argTypes:[r.Types.layer,r.Types.layer],outputType:r.Types.layer,noUndefinedArgs:true,value:function(e,t){return{type:"card-pair",layers:[e,t]}}},graphLayer:{version:"v3",description:function(){return n.i18n.s("cl-docs-description-lib-graph-layer")},argTypes:[r.Types.calculatorStateWithSinkValues],outputType:r.Types.layer,noUndefinedArgs:true,value:function(e){return{type:"graph",calculatorStateWithSinkValues:e}}}},types:{},constants:{}}});define("core/computation-layer/library/scores",["require","exports","core/computation-layer/cl-types","core/lib/i18n","core/lib/assert-unreachable"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.library=void 0;function a(e){var t;switch(e){case"ungraded":t=function(){return n.i18n.s("grading-description-lib-score-ungraded")};break;case"beginning":t=function(){return n.i18n.s("grading-description-lib-score-beginning")};break;case"developing":t=function(){return n.i18n.s("grading-description-lib-score-developing")};break;case"approaching":t=function(){return n.i18n.s("grading-description-lib-score-approaching")};break;case"meeting":t=function(){return n.i18n.s("grading-description-lib-score-meeting")};break;default:t=i.assertUnreachable(e)}return{version:"v3",description:t,argTypes:[r.Types.scores],outputType:r.Types.score,value:function(){return e}}}t.library={functions:{},types:{scores:{description:function(){return n.i18n.s("grading-description-type-scores")},attributes:{ungraded:a("ungraded"),beginning:a("beginning"),developing:a("developing"),approaching:a("approaching"),meeting:a("meeting")}}},constants:{scores:{valueType:r.Types.scores,value:{},description:function(){return n.i18n.s("grading-description-lib-scores")}}}}});define("core/computation-layer/library/index",["require","exports","./builtin","./sketch","./button-styles","./colors","./lists","core/computation-layer/library/math","./patterns","./random","core/computation-layer/library/bounds","./layer","./scores"],function(e,t,r,n,i,a,o,s,u,c,l,p,d){"use strict";var f={functions:{},types:{},constants:{}};var h=function(e){if(e.functions){for(var t in e.functions){if(f.functions[t]){throw new Error("Duplicate library function declaration "+t)}f.functions[t]=e.functions[t]}}if(e.types){for(var r in e.types){if(f.types[r]){throw new Error("Duplicate library function declaration "+r)}f.types[r]=e.types[r]}}if(e.constants){for(var n in e.constants){if(f.constants[n]){throw new Error("Duplicate library constant declaration "+n)}f.constants[n]=e.constants[n]}}};h(r.library);h(n.library);h(i.library);h(a.library);h(o.library);h(s.library);h(u.library);h(c.library);h(l.library);h(p.library);h(d.library);return f});define("core/components/shared/button-sources",["require","exports","core/lib/i18n","core/computation-layer/cl-types"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ButtonSources=t.fieldNames=void 0;t.fieldNames={"action-button":{submitCount:"action-submit-count",history:"action-history"},"input/expression":{submitCount:"expression-submit-count",history:"expression-history"},table:{submitCount:"table-submit-count",history:"table-history"},legacy:{submitCount:"submitCount",history:"history"}};function i(e){return{history:{description:function(){return r.i18n.s("cl-docs-description-button-history")},analyzeValueType:{type:"concrete",valueType:n.Types.numberList},params:[{name:"key",type:n.Types.string}],computeFromResponse:function(r,n){var i=n.params;var a=i[0];var o=r[t.fieldNames[e].history];if(o==undefined){o=r.history}if(o==undefined)return[];var s=o[a];if(s==undefined)return[];return s||[]}},lastValue:{description:function(){return r.i18n.s("cl-docs-description-button-last-value")},analyzeValueType:{type:"concrete",valueType:n.Types.number},params:[{name:"key",type:n.Types.string}],computeFromResponse:function(r,n){var i=n.params;var a=i[0];var o=r[t.fieldNames[e].history];if(o==undefined){o=r.history}if(o==undefined)return NaN;var s=o[a];if(s==undefined)return NaN;var u=s[s.length-1];return u==undefined?NaN:u}},submitCount:{description:function(){return r.i18n.s("cl-docs-description-button-submit-count")},analyzeValueType:{type:"concrete",valueType:n.Types.number},computeFromResponse:function(r){var n=r[t.fieldNames[e].submitCount];if(n==undefined)n=r.submitCount;return n==undefined?0:n}}}}t.ButtonSources=i});define("core/components/shared/hidden-sink",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.hiddenSink=void 0;t.hiddenSink=n.convertSinkList({hidden:{description:function(){return r.i18n.s("cl-docs-description-hidden")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean}}})});define("core/components/action-button/cl-spec",["require","exports","tslib","core/lib/i18n","core/computation-layer/types","core/components/shared/button-sources","core/computation-layer/cl-types","core/components/shared/hidden-sink","core/components/shared/reset-on-change-sink"],function(e,t,r,n,i,a,o,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;var c=a.ButtonSources("action-button");var l={description:function(){return n.i18n.s("cl-docs-description-action-button-time-since-press")},analyzeValueType:{type:"concrete",valueType:o.Types.number},publishedBy:"playgroundController",computeFromResponse:function(e,t){var r=t.params;return e.buttonPressed?r[0]:0},params:[{name:"maxTime",type:o.Types.number,default:10}]};var p=c.history;var d=c.lastValue;var f=r.__assign(r.__assign({},c.submitCount),{description:function(){return n.i18n.s("cl-docs-description-action-button-press-count")}});t.listSources={timeSincePress:l,history:p,lastValue:d,pressCount:f};t.listSinks=i.convertSinkList({capture:{description:function(){return n.i18n.s("cl-docs-description-action-button-capture")},analyzeValueType:{type:"concrete",valueType:o.Types.number},params:[{name:"key",type:o.Types.string}]},label:{description:function(){return n.i18n.s("cl-docs-description-action-button-label")},analyzeValueType:{type:"concrete",valueType:o.Types.string}},resetLabel:{description:function(){return n.i18n.s("cl-docs-description-action-button-reset-label")},analyzeValueType:{type:"concrete",valueType:o.Types.string}},disabled:{description:function(){return n.i18n.s("cl-docs-description-action-button-disabled")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean}},style:{description:function(){return n.i18n.s("cl-docs-description-action-button-style")},analyzeValueType:{type:"concrete",valueType:o.Types.buttonStyle}}}).registerSinksFrom(s.hiddenSink).registerSinksFrom(u.resetOnChangeSink)});define("core/components/challenge/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;t.listSources={};t.listSinks=n.convertSinkList({preventSubmissionReason:{description:function(){return r.i18n.s("cl-docs-description-challenge-prevent-submission-reason")},params:[],analyzeValueType:{type:"concrete",valueType:i.Types.string}},preventChallengeCreationReason:{description:function(){return r.i18n.s("cl-docs-description-challenge-prevent-challenge-creation-reason")},params:[],analyzeValueType:{type:"concrete",valueType:i.Types.string}},challengeText:{description:function(){return r.i18n.s("cl-docs-description-challenge-text")},params:[],analyzeValueType:{type:"concrete",valueType:i.Types.string}},challengeBackground:{description:function(){return r.i18n.s("cl-docs-description-challenge-background")},params:[],analyzeValueType:{type:"concrete",valueType:i.Types.layer}},challengeBounds:{description:function(){return r.i18n.s("cl-docs-description-challenge-bounds")},analyzeValueType:{type:"concrete",valueType:i.Types.bounds}},responseText:{description:function(){return r.i18n.s("cl-docs-description-challenge-response-text")},params:[],analyzeValueType:{type:"concrete",valueType:i.Types.string}},responseBackground:{description:function(){return r.i18n.s("cl-docs-description-challenge-response-background")},params:[],analyzeValueType:{type:"concrete",valueType:i.Types.layer}},responseBounds:{description:function(){return r.i18n.s("cl-docs-description-challenge-repsonse-bounds")},analyzeValueType:{type:"concrete",valueType:i.Types.bounds}}})});define("core/components/expression-input/helpers",["require","exports","core/lib/evaluator-helpers","core/lib/simpleevaluator"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.shouldShowEvaluation=t.getLatex=t.getNumericValue=void 0;var i=new n.SimpleEvaluator;function a(e,t,n){var a=o(e,t);if(!a)return NaN;var s=r.evaluateRawLatex(a,i,n.degreeMode);if(s===undefined)return NaN;return s}t.getNumericValue=a;function o(e,t){if(e&&e.hasOwnProperty("latex"))return e.latex||"";if(t&&t.value)return t.value.latex;return""}t.getLatex=o;function s(e){return i.isEvaluable({latex:e,vars:{},degreeMode:false})}t.shouldShowEvaluation=s});define("core/components/shared/export-source",["require","exports","core/lib/i18n","core/computation-layer/cl-types","underscore"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.exportSource=void 0;t.exportSource={description:function(){return r.i18n.raw("Read data from the matching export sink")},analyzeValueType:{type:"concrete",valueType:n.Types.string},params:[{name:"key",type:n.Types.string}],internal:true,analyzeSinkSourceDependencies:function(e){var t=e.params,r=e.sinks;for(var n=0,a=r;n<a.length;n++){var o=a[n];if(o.name=="export"&&i.isEqual(o.params,t)){o.registerDependency()}}return function(e){var r=e.sinks;var n=r.export;if(!n){return undefined}for(var a=0,o=n;a<o.length;a++){var s=o[a];if(i.isEqual(s.params,t)){return s.value}}return undefined}}}});define("core/components/expression-input/cl-spec",["require","exports","tslib","core/lib/i18n","core/computation-layer/types","core/components/shared/button-sources","core/components/shared/correctness-sinks","core/components/shared/hidden-sink","core/computation-layer/cl-types","./helpers","core/components/shared/reset-on-change-sink","../shared/export-source"],function(e,t,r,n,i,a,o,s,u,c,l,p){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;var d=a.ButtonSources("input/expression");var f={description:function(){return n.i18n.s("cl-docs-description-expression-input-latex")},analyzeValueType:{type:"concrete",valueType:u.Types.latex},analyzeSinkSourceDependencies:function(e){var t=e.sinks;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i.name=="initialLatex"){i.registerDependency()}}return function e(t){var r=t.response,n=t.sinks;var i=n.initialLatex&&n.initialLatex[0];return{latex:c.getLatex(r,i)}}}};var h={description:function(){return n.i18n.s("cl-docs-description-expression-input-numeric-value")},analyzeValueType:{type:"concrete",valueType:u.Types.number},analyzeSinkSourceDependencies:function(e){var t=e.sinks;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i.name=="initialLatex"){i.registerDependency()}}return function e(t){var r=t.response,n=t.sinks,i=t.degreeMode;var a=n.initialLatex&&n.initialLatex[0];return c.getNumericValue(r,a,{degreeMode:i})}}};var y={description:function(){return n.i18n.s("cl-docs-description-expression-input-time-since-submit")},analyzeValueType:{type:"concrete",valueType:u.Types.number},publishedBy:"playgroundController",computeFromResponse:function(e,t){var r=t.params;return e.submitted?r[0]:0},params:[{name:"maxTime",type:u.Types.number,default:10}]};var m={description:function(){return n.i18n.s("cl-docs-description-expression-input-submitted")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean},computeFromResponse:function(e){return!!e.submitted}};var v={description:function(){return n.i18n.s("cl-docs-description-expression-input-explain-content")},analyzeValueType:{type:"concrete",valueType:u.Types.string},computeFromResponse:function(e){return{type:"string",parts:e.explainText?[e.explainText]:[]}}};t.listSources=r.__assign(r.__assign({latex:f,numericValue:h,timeSinceSubmit:y,submitted:m,explainContent:v},d),{export:p.exportSource});t.listSinks=i.convertSinkList({initialLatex:{description:function(){return n.i18n.s("cl-docs-description-expression-input-initial-latex")},analyzeValueType:{type:"concrete",valueType:u.Types.latex}},disableEvaluation:{description:function(){return n.i18n.s("cl-docs-description-expression-input-disable-evaluation")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean}},errorMessage:{description:function(){return n.i18n.s("cl-docs-description-expression-input-error-message")},analyzeValueType:{type:"concrete",valueType:u.Types.string}},suffix:{description:function(){return n.i18n.s("cl-docs-description-expression-input-suffix")},analyzeValueType:{type:"concrete",valueType:u.Types.string}},capture:{description:function(){return n.i18n.s("cl-docs-description-expression-input-capture")},analyzeValueType:{type:"concrete",valueType:u.Types.number},params:[{name:"key",type:u.Types.string}]},submitLabel:{description:function(){return n.i18n.s("cl-docs-description-expression-input-submit-label")},analyzeValueType:{type:"concrete",valueType:u.Types.string}},showSubmitButton:{description:function(){return n.i18n.s("cl-docs-description-expression-input-show-submit")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean}},resetLabel:{description:function(){return n.i18n.s("cl-docs-description-expression-input-reset-label")},analyzeValueType:{type:"concrete",valueType:u.Types.string}},clearOnReset:{description:function(){return n.i18n.s("cl-docs-description-expression-input-clear-on-reset")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean}},submitDisabled:{description:function(){return n.i18n.s("cl-docs-description-expression-input-submit-disabled")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean}},initialText:{description:function(){return n.i18n.s("cl-docs-description-expression-input-initial-text")},analyzeValueType:{type:"concrete",valueType:u.Types.string}},explainPrompt:{description:function(){return n.i18n.s("cl-docs-description-expression-input-explain-prompt")},analyzeValueType:{type:"concrete",valueType:u.Types.string}},showPeerResponses:{description:function(){return n.i18n.s("cl-docs-description-expression-input-show-classmates")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean}},showExplain:{description:function(){return n.i18n.s("cl-docs-description-expression-input-show-explain")},analyzeValueType:{type:"concrete",valueType:u.Types.boolean}}}).registerSinksFrom(o.correctnessSinks).registerSinksFrom(s.hiddenSink).registerSinksFrom(l.resetOnChangeSink)});define("core/components/shared/generate-graph-sinks",["require","exports","core/lib/i18n","core/computation-layer/types","core/lib/calculator-helpers","core/computation-layer/cl-types","./correctness-sinks","./hidden-sink"],function(e,t,r,n,i,a,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getGraphSinks=void 0;var u=function(){return r.i18n.s("cl-docs-warning-graph-raw-expression-deprecation")};var c=function(){return r.i18n.s("cl-docs-warning-graph-bounds-deprecation")};function l(e){var t={number:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-number-sink"):r.i18n.s("cl-docs-description-sketch-number-sink")},params:[{name:"identifier",type:a.Types.latex,validate:i.validLatexIdentifierRequired}],analyzeValueType:{type:"concrete",valueType:a.Types.number}},numberList:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-number-list-sink"):r.i18n.s("cl-docs-description-sketch-number-list-sink")},params:[{name:"identifier",type:a.Types.latex,validate:i.validLatexIdentifierRequired}],analyzeValueType:{type:"concrete",valueType:a.Types.numberList}},pointLabel:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-raw-expression-point-label"):r.i18n.s("cl-docs-description-sketch-raw-expression-point-label")},params:[{name:"identifier",type:a.Types.string,validate:i.validStrippedIdentifierRequired}],analyzeValueType:{type:"concrete",valueType:a.Types.string}},xAxisLabel:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-x-axis-label"):r.i18n.s("cl-docs-description-sketch-x-axis-label")},analyzeValueType:{type:"concrete",valueType:a.Types.string}},yAxisLabel:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-y-axis-label"):r.i18n.s("cl-docs-description-sketch-y-axis-label")},analyzeValueType:{type:"concrete",valueType:a.Types.string}},audioTraceReverseExpressions:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-audiotrace-reverse"):r.i18n.s("cl-docs-description-sketch-audiotrace-reverse")},analyzeValueType:{type:"concrete",valueType:a.Types.boolean}},trace:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-trace"):r.i18n.s("cl-docs-description-sketch-trace")},analyzeValueType:{type:"concrete",valueType:a.Types.boolean}},narration:{description:function(){return r.i18n.s("cl-docs-description-graph-narration")},params:[{name:"narrationIndex",type:a.Types.number,default:1}],analyzeValueType:{type:"concrete",valueType:a.Types.string}},bounds:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-bounds-sink"):r.i18n.s("cl-docs-description-sketch-bounds-sink")},analyzeValueType:{type:"concrete",valueType:a.Types.bounds}},background:{description:function(){return e==="input/graph"?r.i18n.s("cl-docs-description-graph-background"):r.i18n.s("cl-docs-description-sketch-background")},analyzeValueType:{type:"concrete",valueType:a.Types.layer}}};return n.convertSinkList(t)}var p={rawExpression:{description:function(){return r.i18n.s("cl-docs-description-graph-raw-expression")},params:[{name:"identifier",type:a.Types.string,default:{type:"string",parts:["undefined"]},validate:i.validStringIdentifierPreferred}],analyzeValueType:{type:"concrete",valueType:a.Types.string},deprecated:u},rawExpressionColor:{description:function(){return r.i18n.s("cl-docs-description-graph-raw-expression-color")},params:[{name:"identifier",type:a.Types.string,validate:i.validStringIdentifierPreferred}],analyzeValueType:{type:"concrete",valueType:a.Types.string},deprecated:u},rawExpressionHidden:{description:function(){return r.i18n.s("cl-docs-description-graph-raw-expression-hidden")},params:[{name:"identifier",type:a.Types.string,validate:i.validStringIdentifierPreferred}],analyzeValueType:{type:"concrete",valueType:a.Types.boolean},deprecated:u},rawExpressionStyle:{description:function(){return r.i18n.s("cl-docs-description-graph-raw-expression-style")},params:[{name:"identifier",type:a.Types.string,validate:i.validStringIdentifierPreferred}],analyzeValueType:{type:"concrete",valueType:a.Types.string},deprecated:u}};p["xmin"]={description:function(){return r.i18n.s("cl-docs-description-graph-xmin")},analyzeValueType:{type:"concrete",valueType:a.Types.number},deprecated:c};p["xmax"]={description:function(){return r.i18n.s("cl-docs-description-graph-xmax")},analyzeValueType:{type:"concrete",valueType:a.Types.number},deprecated:c};p["ymin"]={description:function(){return r.i18n.s("cl-docs-description-graph-ymin")},analyzeValueType:{type:"concrete",valueType:a.Types.number},deprecated:c};p["ymax"]={description:function(){return r.i18n.s("cl-docs-description-graph-ymax")},analyzeValueType:{type:"concrete",valueType:a.Types.number},deprecated:c};var d={matches:function(e){return e.type=="function"},toString:function(){return"function"}};var f=new n.NewSinkSpec("function",{type:"concrete",validator:d},[{name:"identifier",type:a.Types.latex,validate:i.validLatexIdentifierRequired}],function(){return r.i18n.s("cl-docs-warning-graph-function")});function h(e){return n.convertSinkList(p).registerSinksFrom(l(e)).registerSinksFrom(o.correctnessSinks).registerSinksFrom(s.hiddenSink).registerSinkSpec(f)}t.getGraphSinks=h});define("core/components/shared/cl-graph-helpers",["require","exports","underscore","core/lib/calculator-helpers","core/computation-layer/helpers","core/computation-layer/library/bounds","core/lib/log","core/computation-layer/cl-types","core/computation-layer/library/math","core/lib/assert-unreachable"],function(e,t,r,n,i,a,o,s,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.hasSources=t.omitDefinitions=t.listDefinitions=t.updateSinks=t.subscribeSourcesAndSinks=void 0;var l=function(e,t){var r=t();var n=r.sources;if(n.number!=undefined)n.number.forEach(function(t){var r=t.params[0];var n=e.HelperExpression(r);if(t.getValue()===undefined){t.setValue(n.numericValue)}n.observe("numericValue",function(){t.setValue(n.numericValue)})});if(n.numberList!=undefined)n.numberList.forEach(function(t){var r=t.params[0];var n=e.HelperExpression(r);if(t.getValue()===undefined){t.setValue(n.listValue)}n.observe("listValue",function(){t.setValue(n.listValue)})})};t.subscribeSourcesAndSinks=l;var p=function(e,t,r){f(e,t,r);h(e,t,r);if("_calc"in e&&"grapher"in e._calc&&e._calc.grapher!=undefined){y(t,e,r)}};t.updateSinks=p;var d=function(e,t){return e+JSON.stringify(t.params)};function f(e,t,i){for(var a=0,o=["number","numberList","function"];a<o.length;a++){var l=o[a];for(var p=0,f=t[l]||[];p<f.length;p++){var h=f[p];var y=h.value;var m=d(l,h);if(i.hasOwnProperty(m)&&r.isEqual(y,i[m])){continue}i[m]=y;var v=h.params[0].latex;var g=void 0;switch(l){case"number":g=v+"=1*"+n.numberAsLatex(+y);break;case"numberList":g=y==undefined?v+"=[]":v+"=["+y.map(n.numberAsLatex).join(",")+"]";break;case"function":{if(!(h.valueType instanceof s.FunctionType))throw new Error("Unexpected type "+h.valueType+" provided to function sink");var b=u.generateFunctionProxyVariables(h.valueType.params.numVars);g=v+"("+b.join(", ")+")="+(y||"0/0");break}default:return c.assertUnreachable(l)}e.setExpression({type:"expression",id:"sink-"+v,latex:g,hidden:true,secret:true})}}}function h(e,t,n){var a=function(a){var o=a;var s=o.params[0];var u=o.value?i.synthesizeStringInternal(o.value):"";var c=d("rawExpression",o);var l=r.find(t.rawExpressionColor||[],function(e){return e.params[0]==s});var p=(l===null||l===void 0?void 0:l.value)?i.synthesizeStringInternal(l.value):"#000";var f=r.find(t.rawExpressionHidden||[],function(e){return e.params[0]==s});var h=f?f.value:false;var y=r.find(t.rawExpressionStyle||[],function(e){return e.params[0]==s});var m=((y===null||y===void 0?void 0:y.value)?i.synthesizeStringInternal(y.value):"SOLID").toUpperCase();var v=false;if(u!=n[c]){n[c]=u;v=true}if(l){var g=d("rawExpressionColor",l);if(p!=n[g]){n[g]=p;v=true}}if(f){var b=d("rawExpressionHidden",f);if(h!=n[b]){n[b]=h;v=true}}if(y){var x=d("rawExpressionStyle",y);if(m!=n[x]){n[x]=m;v=true}}if(!v){return"continue"}e.setExpression({id:"sink-"+o.params[0],latex:u,secret:true,hidden:h,color:p,style:m})};for(var o=0,s=t.rawExpression||[];o<s.length;o++){var u=s[o];a(u)}}function y(e,t,s){var u;for(var l=0,p=e.pointLabel||[];l<p.length;l++){var f=p[l];var h=f.value?i.synthesizeStringForContent(f.value):"";var y=d("pointLabel",f);if(h==s[y]){continue}s[y]=h;if(u==undefined){u=t.getState()}var m=n.getIdFromIdentifier(u,f.params[0]);if(m==undefined){o.log("CL warning: There is no item with identifier "+f.params[0]+" in the graph state.");continue}t.setExpression({id:m,label:h,showLabel:h.length>0})}for(var v=0,g=e.xAxisLabel||[];v<g.length;v++){var f=g[v];var h=f.value?i.synthesizeStringForContent(f.value):undefined;var y=d("xAxisLabel",f);if(h==s[y]){continue}s[y]=h;t.updateSettings({xAxisLabel:h})}for(var b=0,x=e.yAxisLabel||[];b<x.length;b++){var f=x[b];var h=f.value?i.synthesizeStringForContent(f.value):undefined;var y=d("yAxisLabel",f);if(h==s[y]){continue}s[y]=h;t.updateSettings({yAxisLabel:h})}var S=e["bounds"];if(S&&S[0]){var T=S[0].value;if(T){var w={width:t.graphpaperBounds.pixelCoordinates.width,height:t.graphpaperBounds.pixelCoordinates.height};var y=d("bounds",S[0]);if(w.width<=0)w.width=1;if(w.height<=0)w.height=1;var _=a.applyStrategy(T,T.strategy,w);if(!r.isEqual({bounds:T,size:w},s[y])){s[y]={bounds:T,size:w};t.setMathBounds({left:_.left,bottom:_.bottom,right:_.left+_.width,top:_.bottom+_.height});t._calc.grapher.settings.setProperty("squareAxes",T.strategy!="stretch")}}}else{var I=["xmin","xmax","ymin","ymax"];var T={};var E=false;for(var C=0,M=I;C<M.length;C++){var k=M[C];for(var P=0,O=e[k]||[];P<O.length;P++){var f=O[P];var h=f.value;var y=d(k,f);switch(k){case"xmin":T.left=h;break;case"xmax":T.right=h;break;case"ymin":T.bottom=h;break;case"ymax":T.top=h;break;default:c.assertUnreachable(k)}if(h==s[y]){continue}E=true;s[y]=h}}if(E){t.setMathBounds({left:T.left,right:T.right,bottom:T.bottom,top:T.top})}}for(var L=0,N=e.audioTraceReverseExpressions||[];L<N.length;L++){var f=N[L];var h=f.value;var y=d("audioTraceReverseExpressions",f);if(h==s[y]){continue}s[y]=h;t.updateSettings({audioTraceReverseExpressions:h})}for(var A=0,D=e.trace||[];A<D.length;A++){var f=D[A];var h=f.value;var y=d("trace",f);if(h==s[y]){continue}s[y]=h;t.updateSettings({trace:h})}}var m=function(e){var t=function(t){return(e[t]||[]).map(function(e){var t;return(t=e.params[0])===null||t===void 0?void 0:t.latex})};var n=function(t){return(e[t]||[]).map(function(e){return e.params[0]})};return r.flatten([t("number"),t("numberList"),t("function"),n("rawExpression")]).filter(function(e){return e!=undefined})};t.listDefinitions=m;function v(e,r){if(!e){return e}return n.calcStateWithoutDefinitions(e,t.listDefinitions(r))}t.omitDefinitions=v;var g=function(e){return(e.number||[]).length+(e.numberList||[]).length>0};t.hasSources=g});define("core/components/shared/generate-graph-sources",["require","exports","core/lib/simpleevaluator","core/computation-layer/cl-types","core/lib/i18n","core/lib/calculator-helpers","core/lib/mathtools","core/random-seed","underscore","core/lib/copydata","core/lib/evaluator-helpers","./cl-graph-helpers","core/lib/assert-unreachable","./export-source"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getGraphComponentAnalysis=t.getGraphSources=void 0;var h=new r.SimpleEvaluator;function y(e){return{description:function(){return e==="input/graph"?i.i18n.s("cl-docs-description-graph-number-source"):i.i18n.s("cl-docs-description-sketch-number-source")},params:[{name:"latex",type:n.Types.latex,validate:a.validLatexRequired}],analyzeValueType:{type:"concrete",valueType:n.Types.number},publishedBy:"playgroundController",analyzeSinkSourceDependencies:function(t){var r=t.sinks,n=t.config,i=t.params,a=t.warn;if(e==="input/graph"&&!n.exhibitMode){a("This data comes from a full-screen graph - dependencies may not be computed correctly.")}for(var s=0,u=r;s<u.length;s++){var c=u[s];if(c.name=="rawExpression")a("This data comes from a graph that uses rawExpression - dependencies may not be computed correctly.")}var l=T(r);var p=i[0];var d=o.parser.parse(p.latex);var f=w(p.latex,l,n.calculatorState,n.alias),h=f.expressionRequired,y=f.warnings;for(var m=0,v=y;m<v.length;m++){var g=v[m];a(g)}return{componentLevelAnalysisData:{expressionIds:Object.keys(h).filter(function(e){return h[e]}),parsedLatex:d}}}}}function m(e){return{description:function(){return e==="input/graph"?i.i18n.s("cl-docs-description-graph-number-list-source"):i.i18n.s("cl-docs-description-sketch-number-list-source")},params:[{name:"latex",type:n.Types.latex,validate:a.validLatexIdentifierPreferred}],analyzeValueType:{type:"concrete",valueType:n.Types.numberList},publishedBy:"playgroundController",analyzeSinkSourceDependencies:function(t){var r=t.sinks,n=t.config,i=t.params,a=t.warn;if(e==="input/graph"&&!n.exhibitMode){a("This data comes from a full-screen graph - dependencies may not be computed correctly.")}for(var s=0,u=r;s<u.length;s++){var c=u[s];if(c.name=="rawExpression")a("This data comes from a graph that uses rawExpression - dependencies may not be computed correctly.")}var l=T(r);var p=i[0];var d=o.parser.parse(p.latex);var f=w(p.latex,l,n.calculatorState,n.alias),h=f.expressionRequired,y=f.warnings;for(var m=0,v=y;m<v.length;m++){var g=v[m];a(g)}return{componentLevelAnalysisData:{expressionIds:Object.keys(h).filter(function(e){return h[e]}),parsedLatex:d}}}}}function v(e){return{description:function(){return i.i18n.s("cl-docs-description-calculatorState-source")},analyzeValueType:{type:"concrete",valueType:n.Types.calculatorStateWithSinkValues},analyzeSinkSourceDependencies:function(t){var r=t.sinks,n=t.config;for(var i=0,a=r;i<a.length;i++){var o=a[i];o.registerDependency()}return function(t){var r=t.response,i=t.randomSeed,a=t.sinks;var o=e==="input/graph"?r.calculatorState:undefined;var u=o||p.omitDefinitions(s.populateRandomSeed(n.calculatorState,i),a);return{calculatorState:u,sinks:a}}}}}function g(e){return{description:function(){return e==="input/graph"?i.i18n.s("cl-docs-description-graph-bounds-source"):i.i18n.s("cl-docs-description-sketch-bounds-source")},analyzeValueType:{type:"concrete",valueType:n.Types.bounds},analyzeSinkSourceDependencies:function(t){var r=t.sinks,n=t.config,i=t.warn;for(var o=0,s=r;o<s.length;o++){var l=s[o];if(["xmin","xmax","ymin","ymax"].indexOf(l.name)>-1){i(l.name+" is deprecated, and cannot be used together with the bounds source.\n            Use the bounds sink instead.")}if(l.name=="bounds"){l.registerDependency()}}return function t(r){var i=r.response,o=r.sinks;var s=undefined;if(o.bounds){s=o.bounds[0].value}if(s!=undefined&&u.isFinite(s.left)&&u.isFinite(s.bottom)&&u.isFinite(s.width)&&u.isFinite(s.height)&&s.width>0&&s.height>0){return s}var l;var p;var d=e==="input/graph"?i.calculatorState:undefined;var f=d||n.calculatorState;if(f){l=c.copydata(a.extractViewport(f));if(a.areAxesSquare(f)){p="centeredVertical"}else{p="stretch"}}else{var h=e==="input/graph"?10:1;l={xmin:-1*h,xmax:h,ymin:-1*h,ymax:h};p="centeredVertical"}return{left:l.xmin,width:l.xmax-l.xmin,bottom:l.ymin,height:l.ymax-l.ymin,strategy:p}}}}}function b(e){return{description:function(){return e==="input/graph"?i.i18n.s("cl-docs-description-graph-label-text"):i.i18n.s("cl-docs-description-sketch-label-text")},analyzeValueType:{type:"concrete",valueType:n.Types.string},params:[{name:"identifier",type:n.Types.string,validate:a.validStrippedIdentifierRequired}],computeFromResponse:function(t,r){var n=r.config,i=r.params,o=r.randomSeed;var u=e==="input/graph"?t.calculatorState:undefined;var c=u||s.populateRandomSeed(n.calculatorState,o);if(c==undefined)return undefined;var l=a.getLabelValueFromIdentifier(c,i[0]);return l!=undefined?{type:"string",parts:[l]}:undefined}}}function x(e){return{description:function(){return e==="input/graph"?i.i18n.s("cl-docs-description-graph-label-latex"):i.i18n.s("cl-docs-description-sketch-label-latex")},analyzeValueType:{type:"concrete",valueType:n.Types.latex},params:[{name:"identifier",type:n.Types.string,validate:a.validStrippedIdentifierRequired}],computeFromResponse:function(t,r){var n=r.config,i=r.params,o=r.randomSeed;var u=e==="input/graph"?t.calculatorState:undefined;var c=u||s.populateRandomSeed(n.calculatorState,o);if(c==undefined)return undefined;var l=a.getLabelValueFromIdentifier(c,i[0]);if(l==undefined)return undefined;var p=l.match(/^`([^`]+)`$/);return p?{latex:p[1]}:undefined}}}function S(e){return{description:function(){return e==="input/graph"?i.i18n.s("cl-docs-description-graph-label-numeric-value"):i.i18n.s("cl-docs-description-sketch-label-numeric-value")},analyzeValueType:{type:"concrete",valueType:n.Types.number},params:[{name:"identifier",type:n.Types.string,validate:a.validStrippedIdentifierRequired}],computeFromResponse:function(t,r){var n=r.config,i=r.params,o=r.randomSeed,u=r.degreeMode;var c=e==="input/graph"?t.calculatorState:undefined;var p=c||s.populateRandomSeed(n.calculatorState,o);if(p==undefined)return NaN;var d=a.getLabelValueFromIdentifier(p,i[0]);if(d==undefined)return NaN;var f=d.match(/^`([^`]+)`$/);var y=f?l.evaluateRawLatex(f[1],h,u):l.evaluateRawLatex(d,h,u);if(y==undefined)return NaN;return y}}}function T(e){var t={};for(var r=0,n=e;r<n.length;r++){var i=n[r];if(["number","numberList","function"].indexOf(i.name)>-1){var a=i.params[0].latex;a=a.replace(/[{}]/g,"");t[a]=i}if(i.name=="rawExpression"){var a=i.params[0];a=a.replace(/[{}]/g,"");t[a]=i}}return t}function w(e,t,r,n){var i=o.builtInFrame;var s=o.parser.parse(e);var u=s.getDependencies();var c={};var l={};var p=a.getExportAndDependencyMapFromState(r);var d={};var f=[];var h;while(h=u.pop()){if(h=="globalRandomSeed"){continue}h=h.replace(/[{}]/g,"");if(c[h])continue;if(i[h])continue;var y=t[h];if(y){y.registerDependency();continue}var m=p.exportMap[h]||p.weakExportMap[h];if(m){if(!d[m]){d[m]=true;for(var v=0,g=p.dependencyMap[m]||[];v<g.length;v++){var b=g[v];u.push(b);l[b]="needed by "+h}}continue}var x=l[h];if(x){f.push("can't find variable "+h+" ("+x+") in graph "+n)}else{f.push("can't find variable "+h+" in graph "+n)}}return{expressionRequired:d,warnings:f}}function _(e){var t=e.calculatorState,r=e.sinks,n=e.expressionRequired;t=a.filterListToIds(t,n);var i=o.CLCalculator(t);p.updateSinks(i,r,{});var s=new o.context;var u=i.getChangeSet();s.setDegreeMode(u.degreeMode);if(u.hasOwnProperty("globalRandomSeed")){s.setGlobalRandomSeed(u.globalRandomSeed)}for(var c in u.statements){s.addStatement(u.statements[c])}s.updateAnalysis();return s.frame}function I(e){return{number:y(e),numberList:m(e),calculatorState:v(e),bounds:g(e),labelText:b(e),labelLatex:x(e),labelNumericValue:S(e),export:f.exportSource}}t.getGraphSources=I;function E(e){return{analyzeSources:function(e){var t=e.placeholderSources,r=e.registerIntermediateComputation;var i={};var a={};function s(e){return e.placeholder.sinkDependencies.map(function(e){return e.nodeId}).sort().join(",")}for(var u=0,c=t;u<c.length;u++){var l=c[u];var p=s(l);if(!i[p]){i[p]={params:{expressionsRequired:{}},sinkNodeIds:l.placeholder.sinkDependencies.map(function(e){var t=e.nodeId;return t})}}var f=l.placeholder.analysisData.expressionIds;for(var h=0,y=f;h<y.length;h++){var m=y[h];i[p].params.expressionsRequired[m]=true}}for(var p in i){a[p]=r(i[p])}var v=function(e){var t=s(e);var r=a[t];d.assertDefined(r,"Expected an IC node to be defined for key "+t);var i=e.placeholder.analysisData.parsedLatex;if(e.placeholder.sourceName==="number"){e.implementWithICDependency(n.Types.number,{icNodeDependency:r,fn:function(e){var t=e.icValue;var r=i.tryGetConcreteTree(o.policies.graphing,t);var n=r.asValue();return typeof n==="number"?n:NaN}})}else if(e.placeholder.sourceName==="numberList"){e.implementWithICDependency(n.Types.numberList,{icNodeDependency:r,fn:function(e){var t=e.icValue;var r=i.tryGetConcreteTree(o.policies.graphing,t);if(!r.isList)return[];var n=r.getEvaluationInfo();if(n&&n[0]&&n[0].val)return n[0].val;return[]}})}};for(var g=0,b=t;g<b.length;g++){var l=b[g];v(l)}},intermediateComputation:{name:"populatedFrame",valueType:n.Types.calculatorPopulatedFrame,computeFromResponse:function(t){var r=t.config,n=t.response,i=t.sinks,a=t.randomSeed,o=t.params;var u=e==="input/graph"?n.calculatorState:undefined;var c=u||s.populateRandomSeed(r.calculatorState,a);if(c==undefined)return NaN;return _({calculatorState:c,sinks:i,expressionRequired:o.expressionsRequired})}}}}t.getGraphComponentAnalysis=E});define("core/components/graph-input/cl-spec",["require","exports","tslib","core/computation-layer/types","../shared/generate-graph-sinks","../shared/generate-graph-sources","core/lib/i18n","core/computation-layer/cl-types","../shared/correctness-sinks"],function(e,t,r,n,i,a,o,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=t.componentAnalysis=t.SourceAnalysisData=void 0;Object.defineProperty(t,"SourceAnalysisData",{enumerable:true,get:function(){return a.SourceAnalysisData}});t.componentAnalysis=a.getGraphComponentAnalysis("input/graph");t.listSources=r.__assign(r.__assign({},a.getGraphSources("input/graph")),{animationTime:{description:function(){return o.i18n.s("cl-docs-description-graph-animation-time")},analyzeValueType:{type:"concrete",valueType:s.Types.number},publishedBy:"playgroundController",analyzeSinkSourceDependencies:function(e){var t=e.sinks;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i.name=="animationDuration"){i.registerDependency()}}return function(){return 0}}},isAnimating:{description:function(){return o.i18n.s("cl-docs-description-graph-is-animating")},analyzeValueType:{type:"concrete",valueType:s.Types.boolean},publishedBy:"playgroundController",analyzeSinkSourceDependencies:function(e){var t=e.sinks;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i.name=="animationDuration"){i.registerDependency()}}return function(){return false}}},currentX:{description:function(){return o.i18n.s("cl-docs-description-sketch-current-x")},params:[],analyzeValueType:{type:"concrete",valueType:s.Types.number},publishedBy:"playgroundController",computeFromResponse:function(){return undefined}},currentY:{description:function(){return o.i18n.s("cl-docs-description-sketch-current-y")},params:[],analyzeValueType:{type:"concrete",valueType:s.Types.number},publishedBy:"playgroundController",computeFromResponse:function(){return undefined}}});t.listSinks=n.convertSinkList({animationDuration:{analyzeValueType:{type:"concrete",valueType:s.Types.number},description:function(){return o.i18n.s("cl-docs-description-graph-animation-duration")}},animationKeyboardStepValue:{analyzeValueType:{type:"concrete",valueType:s.Types.number},description:function(){return o.i18n.s("cl-docs-description-graph-animation-keyboard-step")}},saveOnChange:{analyzeValueType:{type:"concrete",valueType:s.Types.string},description:function(){return o.i18n.s("cl-docs-description-graph-save-on-change")}},resetAnimationOnChange:{description:function(){return o.i18n.s("cl-docs-description-reset-animation-on-change")},analyzeValueType:{type:"concrete",valueType:s.Types.string}}}).registerSinksFrom(u.hasReponseSink).registerSinksFrom(i.getGraphSinks("input/graph"))});define("core/components/marbleslides/cl-spec",["require","exports","core/computation-layer/types","core/computation-layer/cl-types","core/random-seed","core/lib/i18n"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;var o={internal:true,description:function(){return a.i18n.raw("Only for internal use")},analyzeValueType:{type:"concrete",valueType:n.Types.calculatorStateWithSinkValues},analyzeSinkSourceDependencies:function(e){var t=e.config;return function(e){var r=e.randomSeed,n=e.response;var a=n.calculatorState||i.populateRandomSeed(t.calculatorState,r);return{calculatorState:a,sinks:{}}}}};t.listSources={calculatorState:o};t.listSinks=r.convertSinkList({})});define("core/components/multiple-choice/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/components/shared/correctness-sinks","core/components/shared/hidden-sink","core/computation-layer/cl-types","underscore","../shared/reset-on-change-sink","../shared/export-source","./helpers"],function(e,t,r,n,i,a,o,s,u,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;var p={description:function(){return r.i18n.s("cl-docs-description-cardsort-matches-key")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean},computeFromResponse:function(e,t){var r=t.config;if(!r.answerKey)return false;if(!e.selection)return false;return l.answersEqual(e.selection.choiceIds,r.answerKey.choiceIds)}};var d={description:function(){return r.i18n.s("cl-docs-description-mc-is-selected")},params:[{name:"choiceIndex",type:o.Types.number}],analyzeValueType:{type:"concrete",valueType:o.Types.boolean},computeFromResponse:function(e,t){var r=t.config,n=t.params;var i=n[0];var a;if(typeof i=="number"){a=i-1}else if(typeof i=="string"){a=parseInt(i)-1}else{return false}var o=r.choiceIds[a];if(o==null)return false;if(e==null||e.selection==null||e.selection.choiceIds==null)return false;return!!e.selection.choiceIds[o]}};var f={description:function(){return r.i18n.s("cl-docs-description-mc-time-since-submit")},analyzeValueType:{type:"concrete",valueType:o.Types.number},publishedBy:"playgroundController",computeFromResponse:function(e,t){var r=t.params;return e.mcSubmitted?r[0]:0},params:[{name:"maxTime",type:o.Types.number,default:10}]};var h={description:function(){return r.i18n.s("cl-docs-description-mc-choice-content-source")},analyzeValueType:{type:"concrete",valueType:o.Types.string},params:[{name:"index",type:o.Types.number}],analyzeSinkSourceDependencies:function(e){var t=e.params,r=e.sinks,n=e.config;var i=t[0];for(var a=0,o=r;a<o.length;a++){var u=o[a];if(s.contains(["choiceContent"],u.name)&&s.isEqual(u.params,t)){u.registerDependency()}}return function e(t){var r=t.sinks;if(i>n.choiceIds.length)return undefined;if(r.choiceContent){for(var a=0,o=r.choiceContent;a<o.length;a++){var s=o[a];if(s.params[0]===i){return s.value}}}var u=n.choiceIds[i-1];if(!u)return undefined;var c=n.choices[u];if(!c)return undefined;return{type:"string",parts:[c.text||""]}}}};var y={description:function(){return r.i18n.s("cl-docs-description-mc-submitted")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean},publishedBy:"playgroundController",computeFromResponse:function(e){return!!e.mcSubmitted}};var m={description:function(){return r.i18n.s("cl-docs-description-mc-explain-content")},analyzeValueType:{type:"concrete",valueType:o.Types.string},computeFromResponse:function(e){return{type:"string",parts:e.explainText?[e.explainText]:[]}}};var v={description:function(){return r.i18n.s("cl-docs-description-mc-submit-count")},analyzeValueType:{type:"concrete",valueType:o.Types.number},publishedBy:"playgroundController",computeFromResponse:function(e){if(e.mcSubmitCount==null)return 0;return e.mcSubmitCount}};t.listSources={matchesKey:p,isSelected:d,timeSinceSubmit:f,submitted:y,explainContent:m,submitCount:v,choiceContent:h,export:c.exportSource};t.listSinks=n.convertSinkList({choiceContent:{description:function(){return r.i18n.s("cl-docs-description-mc-choice-content")},analyzeValueType:{type:"concrete",valueType:o.Types.string},params:[{name:"choiceIndex",type:o.Types.number}]},choiceLayerContent:{description:function(){return r.i18n.raw("Sets the graph/image content for a given multiple choice option, indexed starting with 1.\n      (This only works if the multiple choice option at this index includes some content already.)\n      Sketch layers and layer stacks are not supported.\n      In the future this should also accept image layers.")},analyzeValueType:{type:"concrete",valueType:o.Types.layer},internal:true,params:[{name:"choiceIndex",type:o.Types.number}]},narration:{description:function(){return r.i18n.raw("Sets the alt text for a given graph or image multiple choice option, indexed starting with 1.\n      (This only works if the multiple choice option at this index includes some content already.)")},analyzeValueType:{type:"concrete",valueType:o.Types.string},internal:true,params:[{name:"choiceIndex",type:o.Types.number}]},initialText:{description:function(){return r.i18n.s("cl-docs-description-mc-initial-text")},analyzeValueType:{type:"concrete",valueType:o.Types.string}},prompt:{description:function(){return r.i18n.s("cl-docs-description-mc-prompt")},analyzeValueType:{type:"concrete",valueType:o.Types.string}},showExplain:{description:function(){return r.i18n.s("cl-docs-description-expression-input-show-explain")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean}},multiSelectHeading:{description:function(){return r.i18n.s("cl-docs-description-mc-multi-select-heading")},analyzeValueType:{type:"concrete",valueType:o.Types.string},deprecated:function(){return r.i18n.s("cl-docs-message-mc-multi-select-heading-deprecation")}},maxSelectedChoices:{description:function(){return r.i18n.s("cl-docs-description-mc-max-selected-choices")},analyzeValueType:{type:"concrete",valueType:o.Types.number}},explainPrompt:{description:function(){return r.i18n.s("cl-docs-description-mc-explain-prompt")},analyzeValueType:{type:"concrete",valueType:o.Types.string}},maxButtonsPerRow:{description:function(){return r.i18n.s("cl-docs-description-mc-max-buttons-per-row")},analyzeValueType:{type:"concrete",valueType:o.Types.number}},WOTS:{description:function(){return r.i18n.s("cl-docs-description-mc-wots")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean},internal:true},submitLabel:{description:function(){return r.i18n.s("cl-docs-description-mc-submit-label")},analyzeValueType:{type:"concrete",valueType:o.Types.string}},showSubmitButton:{description:function(){return r.i18n.s("cl-docs-description-mc-show-submit")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean}}}).registerSinksFrom(i.correctnessSinks).registerSinksFrom(a.hiddenSink).registerSinksFrom(u.resetOnChangeSink)});define("core/components/penny-dragging-widget/cl-spec",["require","exports","core/computation-layer/types","core/computation-layer/cl-types","core/lib/i18n"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;var a={description:function(){return i.i18n.s("cl-docs-description-penny-widget-count")},analyzeValueType:{type:"concrete",valueType:n.Types.number},computeFromResponse:function(e){if(e.circleData==null)return 0;if(e.circleData.pennies==null)return 0;return e.circleData.pennies.length}};var o={description:function(){return i.i18n.s("cl-docs-description-penny-widget-size")},analyzeValueType:{type:"concrete",valueType:n.Types.number},computeFromResponse:function(e){if(e==null)return NaN;if(e.circleData==null)return NaN;return e.circleData.size}};t.listSources={count:a,size:o};t.listSinks=r.convertSinkList({})});define("core/components/reorder/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/components/shared/correctness-sinks","core/components/shared/hidden-sink","core/computation-layer/cl-types","underscore","core/components/reorder/helpers","../shared/export-source"],function(e,t,r,n,i,a,o,s,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;var l={description:function(){return r.i18n.s("cl-docs-description-ordered-list-matches-key")},analyzeValueType:{type:"concrete",valueType:o.Types.boolean},computeFromResponse:function(e,t){var r=t.config;if(!r.hasAnswerKey)return false;return s.isEqual(r.itemIds,e.order)}};var p={description:function(){return r.i18n.s("cl-docs-description-ordered-list-order")},analyzeValueType:{type:"concrete",valueType:o.Types.numberList},analyzeSinkSourceDependencies:function(e){var t=e.sinks,r=e.config;for(var n=0,i=t;n<i.length;n++){var a=i[n];if(a.name=="initialOrder"){a.registerDependency()}}return function e(t){var n=t.response,i=t.sinks;var a=i.initialOrder&&i.initialOrder[0];var o=[];var s=u.getResponseOrder(r,n,a);for(var c=0;c<r.itemIds.length;c++){o[c]=s.indexOf(r.itemIds[c])+1}return o}}};var d={description:function(){return r.i18n.s("cl-docs-description-ordered-list-item-at-index")},analyzeValueType:{type:"concrete",valueType:o.Types.number},params:[{name:"itemIndex",type:o.Types.number}],analyzeSinkSourceDependencies:function(e){var t=e.sinks,r=e.config,n=e.params;for(var i=0,a=t;i<a.length;i++){var o=a[i];if(o.name=="initialOrder"){o.registerDependency()}}return function e(t){var i=t.response,a=t.sinks;var o=a.initialOrder&&a.initialOrder[0];var s=n[0];var c=u.getResponseOrder(r,i,o);var l=c[s-1];var p=r.itemIds.indexOf(l);if(p>=0)return p+1;return undefined}}};var f={description:function(){return r.i18n.s("cl-docs-description-ordered-list-text-at-index")},analyzeValueType:{type:"concrete",valueType:o.Types.string},params:[{name:"itemIndex",type:o.Types.number}],analyzeSinkSourceDependencies:function(e){var t=e.sinks,r=e.config,n=e.params;for(var i=0,a=t;i<a.length;i++){var o=a[i];if(o.name=="itemContent"){o.registerDependency()}}return function e(t){var i=t.response,a=t.sinks;var o=a.initialOrder&&a.initialOrder[0];var s=n[0];var c=u.getResponseOrder(r,i,o);var l=c[s-1];var p=r.itemIds.indexOf(l)+1;if(a.itemContent){for(var d=0,f=a.itemContent;d<f.length;d++){var h=f[d];if(h.params[0]===p){return h.value}}}if(r.items[l])return{type:"string",parts:[r.items[l].text]};return undefined}}};var h={description:function(){return r.i18n.s("cl-docs-description-ordered-list-index-of-item")},analyzeValueType:{type:"concrete",valueType:o.Types.number},params:[{name:"initialItemIndex",type:o.Types.number}],analyzeSinkSourceDependencies:function(e){var t=e.sinks,r=e.config,n=e.params;for(var i=0,a=t;i<a.length;i++){var o=a[i];if(o.name=="initialOrder"){o.registerDependency()}}return function e(t){var i=t.response,a=t.sinks;var o=a.initialOrder&&a.initialOrder[0];var s=n[0];var c=r.itemIds[s-1];if(!c)return undefined;var l=u.getResponseOrder(r,i,o);var p=l.indexOf(c);if(p>=0)return p+1;return undefined}}};t.listSources={matchesKey:l,order:p,itemAtIndex:d,textAtIndex:f,indexOfItem:h,export:c.exportSource};t.listSinks=n.convertSinkList({initialOrder:{description:function(){return r.i18n.s("cl-docs-description-ordered-list-initial-order")},analyzeValueType:{type:"concrete",valueType:o.Types.numberList}},itemContent:{description:function(){return r.i18n.s("cl-docs-description-ordered-list-item-content")},analyzeValueType:{type:"concrete",valueType:o.Types.string},params:[{name:"itemIndex",type:o.Types.number}]}}).registerSinksFrom(i.correctnessSinks).registerSinksFrom(a.hiddenSink)});define("core/components/sketch/cl-spec",["require","exports","tslib","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types","core/components/shared/reset-on-change-sink","../shared/generate-graph-sinks","../shared/generate-graph-sources"],function(e,t,r,n,i,a,o,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=t.componentAnalysis=void 0;var c={points:[],strokes:[],bounds:{left:0,right:1,bottom:0,top:1}};var l={description:function(){return n.i18n.s("cl-docs-description-sketch-object")},params:[],analyzeValueType:{type:"concrete",valueType:a.Types.sketch},computeFromResponse:function(e){if(e.sketchData!=null){return e.sketchData}return c}};var p={description:function(){return n.i18n.s("cl-docs-description-sketch-current-stroke")},params:[],analyzeValueType:{type:"concrete",valueType:a.Types.sketch},publishedBy:"playgroundController",computeFromResponse:function(){return undefined}};var d={description:function(){return n.i18n.s("cl-docs-description-sketch-current-x")},params:[],analyzeValueType:{type:"concrete",valueType:a.Types.number},publishedBy:"playgroundController",computeFromResponse:function(){return undefined}};var f={description:function(){return n.i18n.s("cl-docs-description-sketch-current-y")},params:[],analyzeValueType:{type:"concrete",valueType:a.Types.number},publishedBy:"playgroundController",computeFromResponse:function(){return undefined}};t.componentAnalysis=u.getGraphComponentAnalysis("sketch");t.listSources=r.__assign(r.__assign({},u.getGraphSources("sketch")),{sketch:l,currentStroke:p,currentX:d,currentY:f});t.listSinks=i.convertSinkList({smartStrokeJoining:{description:function(){return n.i18n.s("cl-docs-description-sketch-smart-stroke-joining")},analyzeValueType:{type:"concrete",valueType:a.Types.boolean}},previewCurrentStroke:{description:function(){return n.i18n.raw("This legacy sink doesn't do anything.")},analyzeValueType:{type:"concrete",valueType:a.Types.boolean},deprecated:function(){return n.i18n.raw("This sink doesn't do anything.")}},allowEraser:{description:function(){return n.i18n.s("cl-docs-description-sketch-allow-eraser")},analyzeValueType:{type:"concrete",valueType:a.Types.boolean}},disableSketch:{description:function(){return n.i18n.s("cl-docs-description-sketch-disable-sketch")},analyzeValueType:{type:"concrete",valueType:a.Types.boolean}},hideSketch:{description:function(){return n.i18n.s("cl-docs-description-sketch-hide-sketch")},analyzeValueType:{type:"concrete",valueType:a.Types.boolean}},initialTool:{description:function(){return n.i18n.s("cl-docs-description-sketch-initial-tool")},analyzeValueType:{type:"concrete",valueType:a.Types.sketchTool}},initialColor:{description:function(){return n.i18n.s("cl-docs-description-sketch-initial-color")},analyzeValueType:{type:"concrete",valueType:a.Types.color}},availableColors:{description:function(){return n.i18n.s("cl-docs-description-sketch-available-colors")},analyzeValueType:{type:"concrete",valueType:a.Types.colorList}}}).registerSinksFrom(s.getGraphSinks("sketch")).registerSinksFrom(o.resetOnChangeSink)});define("core/components/table/cl-spec",["require","exports","tslib","core/lib/i18n","core/computation-layer/types","core/components/shared/button-sources","core/components/table/helpers","core/lib/evaluator-helpers","core/lib/simpleevaluator","core/components/shared/correctness-sinks","core/components/shared/hidden-sink","underscore","core/computation-layer/cl-types","../shared/reset-on-change-sink","../shared/export-source"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f,h){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;var y=a.ButtonSources("table");var m;var v={description:function(){return n.i18n.s("cl-docs-description-table-cell-content-source")},params:[{name:"rowIndex",type:d.Types.number},{name:"columnIndex",type:d.Types.number}],analyzeValueType:{type:"dynamic",possibleValueTypes:[d.Types.string,d.Types.latex],analyze:function(e,t){var r=e,n=r[0],i=r[1];var a=o.getTableCellType(n,i,t);return a==o.columnTypes.MATH?{valueType:d.Types.latex}:{valueType:d.Types.string}}},analyzeSinkSourceDependencies:function(e){var t=e.params,n=e.sinks,i=e.config,a=e.valueType;var s=t,u=s[0],c=s[1];var l=false;for(var f=0,h=n;f<h.length;f++){var y=h[f];if(p.contains(["cellContent","initialCellContent"],y.name)&&p.isEqual(y.params,t)){if(y.name==="cellContent")l=true;y.registerDependency()}if(y.name=="maxRows"){y.registerDependency()}}for(var m=0,v=n;m<v.length;m++){var y=v[m];if(y.name==="cellEditable"&&p.isEqual(y.params,t)&&l){y.registerDependency()}}return function e(t){var n=t.response,s=t.sinks,l=t.degreeMode;var f=r.__assign(r.__assign({},i),n);var h=s.maxRows&&s.maxRows[0];var y=h&&h.value?h.value:Infinity;if(u>y){return undefined}var m=o.getCellIdFromCoordinates(f,u,c);if(!m){return undefined}var v=o.getStudentCellContent({cellContentSink:p.first(s.cellContent),initialCellContentSink:p.first(s.initialCellContent),cellEditableSink:p.first(s.cellEditable),cellErrorMessageSink:undefined,cellDisableEvaluationSink:undefined,cellSuffixSink:undefined,configurationData:i.cells[m],studentData:n.cells?n.cells[m]:undefined,columnType:o.getColumnType(i,c),fullyEditable:i.fullyEditable,isHeader:u===0,degreeMode:l});var g=v.content;if(d.Types.latex.matches(a)){return{latex:g}}else if(d.Types.string.matches(a)){return{type:"string",parts:[g]}}else{throw new Error("Internal CL Error. Expected cellContent source to be of type latex or string but found "+a.type)}}}};var g={description:function(){return n.i18n.s("cl-docs-description-table-cell-numeric-value")},params:[{name:"rowIndex",type:d.Types.number},{name:"columnIndex",type:d.Types.number}],analyzeValueType:{type:"concrete",valueType:d.Types.number},analyzeSinkSourceDependencies:function(e){var t=e.params,n=e.sinks,i=e.config;var a=t,c=a[0],l=a[1];for(var d=0,f=n;d<f.length;d++){var h=f[d];if(p.contains(["cellContent","initialCellContent","cellEditable"],h.name)&&p.isEqual(h.params,t)){h.registerDependency()}if(h.name=="maxRows"){h.registerDependency()}}return function e(t){var n=t.response,a=t.sinks,d=t.degreeMode;var f=r.__assign(r.__assign({},i),n);m=m||new u.SimpleEvaluator;var h=a.maxRows&&a.maxRows[0];var y=h&&typeof h.value==="number"?h.value:Infinity;if(c>y)return NaN;var v=o.getCellIdFromCoordinates(f,c,l);if(!v)return NaN;var g=o.getStudentCellContent({cellContentSink:p.first(a.cellContent),initialCellContentSink:p.first(a.initialCellContent),cellEditableSink:p.first(a.cellEditable),cellErrorMessageSink:undefined,cellDisableEvaluationSink:undefined,cellSuffixSink:undefined,configurationData:i.cells[v],studentData:n.cells?n.cells[v]:undefined,columnType:o.getColumnType(i,l),fullyEditable:i.fullyEditable,isHeader:c===0,degreeMode:d});var b=s.evaluateRawLatex(g.content,m,d);if(b==null)return NaN;return b}}};var b={description:function(){return n.i18n.s("cl-docs-description-table-column-numeric-value")},params:[{name:"columnIndex",type:d.Types.number}],analyzeValueType:{type:"concrete",valueType:d.Types.numberList},analyzeSinkSourceDependencies:function(e){var t=e.params,n=e.sinks,i=e.config;var a=t[0];for(var c=0,l=n;c<l.length;c++){var d=l[c];if(p.contains(["cellContent","initialCellContent","cellEditable"],d.name)&&d.params[1]==a){d.registerDependency()}if(d.name=="maxRows"){d.registerDependency()}}return function e(t){var n=t.response,c=t.sinks,l=t.degreeMode;m=m||new u.SimpleEvaluator;var d=r.__assign(r.__assign({},i),n);var f=0;var h=[];var y=p.indexBy(c.cellContent,function(e){return e.params[0]});var v=p.indexBy(c.initialCellContent,function(e){return e.params[0]});var g=p.indexBy(c.cellEditable,function(e){return e.params[0]});var b=c.maxRows&&c.maxRows[0];var x=b&&b.value?b.value:Infinity;for(var S=1;S<=o.getLastRowCoordinate(d);S++){var T=o.getCellIdFromCoordinates(d,S,a);if(!T){h[S-1]=NaN;continue}var w=o.getStudentCellContent({cellContentSink:y[S],initialCellContentSink:v[S],cellEditableSink:g[S],cellErrorMessageSink:undefined,cellDisableEvaluationSink:undefined,cellSuffixSink:undefined,configurationData:i.cells[T],studentData:n.cells?n.cells[T]:undefined,columnType:o.getColumnType(i,a),fullyEditable:i.fullyEditable,isHeader:S===0,degreeMode:l});var _=s.evaluateRawLatex(w.content,m,l);h[S-1]=_==null?NaN:_;if(p.isFinite(_))f=S}h=h.slice(0,Math.min(f,x));return h}}};var x={description:function(){return n.i18n.s("cl-docs-description-table-cell-has-focus")},params:[{name:"rowIndex",type:d.Types.number},{name:"columnIndex",type:d.Types.number}],analyzeValueType:{type:"concrete",valueType:d.Types.boolean},publishedBy:"playgroundController",computeFromResponse:function(){return false}};var S=function(){return n.i18n.s("cl-docs-warning-table-submit-button-deprecation")};var T={description:function(){return n.i18n.s("cl-docs-description-table-time-since-submit")},analyzeValueType:{type:"concrete",valueType:d.Types.number},publishedBy:"playgroundController",computeFromResponse:function(e){return e.tableSubmitted?10:0},deprecated:S};var w={description:function(){return n.i18n.s("cl-docs-description-table-submitted")},analyzeValueType:{type:"concrete",valueType:d.Types.boolean},computeFromResponse:function(e){return!!e.tableSubmitted},deprecated:S};var _=r.__assign(r.__assign({},y.history),{deprecated:S});var I=r.__assign(r.__assign({},y.lastValue),{deprecated:S});var E=r.__assign(r.__assign({},y.submitCount),{deprecated:S});t.listSources={cellContent:v,cellNumericValue:g,columnNumericValues:b,cellHasFocus:x,timeSinceSubmit:T,submitted:w,history:_,lastValue:I,submitCount:E,export:h.exportSource};t.listSinks=i.convertSinkList({submitButtonText:{description:function(){return n.i18n.s("cl-docs-description-table-submit-button-text")},analyzeValueType:{type:"concrete",valueType:d.Types.string},deprecated:S},submitButtonDisabled:{description:function(){return n.i18n.s("cl-docs-description-table-submit-button-disabled")},analyzeValueType:{type:"concrete",valueType:d.Types.boolean},deprecated:S},maxRows:{description:function(){return n.i18n.s("cl-docs-description-table-max-rows")},analyzeValueType:{type:"concrete",valueType:d.Types.number}},disableRowChanges:{description:function(){return n.i18n.s("cl-docs-description-table-disable-row-changes")},analyzeValueType:{type:"concrete",valueType:d.Types.boolean}},cellContent:{description:function(){return n.i18n.s("cl-docs-description-table-cell-content-sink")},params:[{name:"rowIndex",type:d.Types.number},{name:"columnIndex",type:d.Types.number}],analyzeValueType:{type:"dynamic",possibleValueTypes:[d.Types.latex,d.Types.string],analyze:function(e,t){var r;var n=(r=e,r[0]),i=r[1];var a=o.getTableCellType(n,i,t);return{valueType:a==o.columnTypes.MATH?d.Types.latex:d.Types.string}}}},cellSuffix:{params:[{name:"rowIndex",type:d.Types.number},{name:"columnIndex",type:d.Types.number}],description:function(){return n.i18n.s("cl-docs-description-table-cell-suffix")},analyzeValueType:{type:"concrete",valueType:d.Types.string}},cellErrorMessage:{params:[{name:"rowIndex",type:d.Types.number},{name:"columnIndex",type:d.Types.number}],description:function(){return n.i18n.s("cl-docs-description-table-cell-error-message")},analyzeValueType:{type:"concrete",valueType:d.Types.string}},initialCellContent:{description:function(){return n.i18n.s("cl-docs-description-table-initial-cell-content")},params:[{name:"rowIndex",type:d.Types.number},{name:"columnIndex",type:d.Types.number}],analyzeValueType:{type:"dynamic",possibleValueTypes:[d.Types.latex,d.Types.string],analyze:function(e,t){var r;var n=(r=e,r[0]),i=r[1];var a=o.getTableCellType(n,i,t);return{valueType:a==o.columnTypes.MATH?d.Types.latex:d.Types.string}}}},cellEditable:{description:function(){return n.i18n.s("cl-docs-description-table-cell-editable")},params:[{name:"rowIndex",type:d.Types.number},{name:"columnIndex",type:d.Types.number}],analyzeValueType:{type:"concrete",valueType:d.Types.boolean}},cellDisableEvaluation:{description:function(){return n.i18n.s("cl-docs-description-table-cell-disable-evaluation")},params:[{name:"rowIndex",type:d.Types.number},{name:"columnIndex",type:d.Types.number}],analyzeValueType:{type:"concrete",valueType:d.Types.boolean}},capture:{description:function(){return n.i18n.s("cl-docs-description-table-capture")},analyzeValueType:{type:"concrete",valueType:d.Types.number},deprecated:S,params:[{name:"key",type:d.Types.string}]}}).registerSinksFrom(c.correctnessSinks).registerSinksFrom(l.hiddenSink).registerSinksFrom(f.resetOnChangeSink)});define("core/components/text-exhibit/cl-spec",["require","exports","core/computation-layer/types","core/computation-layer/cl-types","core/components/shared/hidden-sink","core/lib/i18n"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=void 0;t.listSinks=r.convertSinkList({content:{description:function(){return a.i18n.s("cl-docs-description-note-content")},analyzeValueType:{type:"concrete",valueType:n.Types.string}}}).registerSinksFrom(i.hiddenSink)});define("core/components/text-input/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types","core/components/shared/hidden-sink"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;var o={description:function(){return r.i18n.s("cl-docs-description-text-input-content")},analyzeValueType:{type:"concrete",valueType:i.Types.string},computeFromResponse:function(e){return{type:"string",parts:e.response?[e.response]:[]}}};var s={description:function(){return r.i18n.s("cl-docs-description-text-input-time-since-submit")},analyzeValueType:{type:"concrete",valueType:i.Types.number},publishedBy:"playgroundController",computeFromResponse:function(e,t){var r=t.params;return e.submitted?r[0]:0},params:[{name:"maxTime",type:i.Types.number,default:10}]};var u={description:function(){return r.i18n.s("cl-docs-description-text-input-submitted")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean},computeFromResponse:function(e){return!!e.submitted}};t.listSources={content:o,timeSinceSubmit:s,submitted:u};t.listSinks=n.convertSinkList({initialText:{description:function(){return r.i18n.s("cl-docs-description-text-input-initial-text")},analyzeValueType:{type:"concrete",valueType:i.Types.string}},showSubmitButton:{description:function(){return r.i18n.s("cl-docs-description-text-input-show-submit")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean}},submitDisabled:{description:function(){return r.i18n.s("cl-docs-description-expression-input-submit-disabled")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean}},submitLabel:{description:function(){return r.i18n.s("cl-docs-description-text-input-submit-label")},analyzeValueType:{type:"concrete",valueType:i.Types.string}},WOTS:{description:function(){return r.i18n.s("cl-docs-description-text-input-wots")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean},internal:true}}).registerSinksFrom(a.hiddenSink)});define("core/components/video/cl-spec",["require","exports","core/computation-layer/types","core/computation-layer/cl-types","core/components/shared/hidden-sink","core/lib/i18n"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;var o={description:function(){return a.i18n.s("cl-docs-description-video-time-source")},analyzeValueType:{type:"concrete",valueType:n.Types.number},publishedBy:"playgroundController",computeFromResponse:function(){return 0}};t.listSources={time:o};t.listSinks=r.convertSinkList({time:{description:function(){return a.i18n.s("cl-docs-description-video-time-sink")},params:[],analyzeValueType:{type:"concrete",valueType:n.Types.number}}}).registerSinksFrom(i.hiddenSink)});define("core/components/image-exhibit/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types","core/components/shared/hidden-sink"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;t.listSources={};t.listSinks=n.convertSinkList({internalImagePath:{description:function(){return r.i18n.s("cl-docs-description-image-internal-image-path")},analyzeValueType:{type:"concrete",valueType:i.Types.string},internal:true},altText:{description:function(){return r.i18n.s("cl-docs-description-image-alt-text")},analyzeValueType:{type:"concrete",valueType:i.Types.string},internal:true}}).registerSinksFrom(a.hiddenSink)});define("core/components/cardsort/cl-spec",["require","exports","core/computation-layer/types","core/computation-layer/cl-types","core/components/cardsort/group-tools","core/lib/i18n"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;var o={description:function(){return a.i18n.s("cl-docs-description-cardsort-total-cards")},analyzeValueType:{type:"concrete",valueType:n.Types.number},computeFromResponse:function(e,t){var r=t.config;return r.cardIds.length}};var s={description:function(){return a.i18n.s("cl-docs-description-cardsort-total-correct")},analyzeValueType:{type:"concrete",valueType:n.Types.number},computeFromResponse:function(e,t){var r=t.config;if(!r.answerKey)return 0;return i.computeCorrectCardCount(e,r.answerKey)}};var u={description:function(){return a.i18n.s("cl-docs-description-cardsort-matches-key")},analyzeValueType:{type:"concrete",valueType:n.Types.boolean},computeFromResponse:function(e,t){var r=t.config;if(!r.answerKey)return false;return i.responseMatchesKey(e,r.answerKey)}};t.listSources={totalCards:o,totalCorrectCards:s,matchesKey:u};t.listSinks=r.convertSinkList({})});define("core/components/transform/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=void 0;t.listSinks=n.convertSinkList({readOnly:{description:function(){return r.i18n.s("cl-docs-description-transform-read-only")},analyzeValueType:{type:"concrete",valueType:i.Types.boolean}}})});define("core/components/polygraph/cl-spec",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.listSinks=t.listSources=void 0;var a={internal:true,description:function(){return r.i18n.raw("Get graph (or, in the future, image) layer from the card at provided index (1-indexed).       Currently, if the card at that index is not a graph card, returns undefined.")},params:[{name:"index",type:i.Types.number}],analyzeValueType:{type:"concrete",valueType:i.Types.layer},analyzeSinkSourceDependencies:function(e){var t=e.params,r=e.config;var n=t[0];var i=r.cards[n-1];if(!i||i.type==="image"){return function(){return undefined}}return function(){return{type:"graph",calculatorStateWithSinkValues:{calculatorState:i.calculatorState,sinks:{}}}}}};var o={internal:true,description:function(){return r.i18n.raw("Get alt text from the card at provided index (1-indexed).")},params:[{name:"index",type:i.Types.number}],analyzeValueType:{type:"concrete",valueType:i.Types.string},analyzeSinkSourceDependencies:function(e){var t=e.params,r=e.config;var n=t[0];var i=r.cards[n-1];return function(){return{type:"string",parts:[(i===null||i===void 0?void 0:i.alt)||""]}}}};t.listSources={cardAtIndex:a,narrationAtIndex:o};t.listSinks=n.convertSinkList({})});define("core/components/shared/export-sinks",["require","exports","core/lib/i18n","core/computation-layer/types","core/computation-layer/cl-types"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.exportSinks=void 0;t.exportSinks=n.convertSinkList({exportNumber:{description:function(){return r.i18n.raw("Export this value to the Player API. For Amplify Alpha use only!")},analyzeValueType:{type:"concrete",valueType:i.Types.number},internal:true,params:[{name:"key",type:i.Types.string}]},exportString:{description:function(){return r.i18n.raw("Export this value to the Player API. For Amplify Alpha use only!")},analyzeValueType:{type:"concrete",valueType:i.Types.string},internal:true,params:[{name:"key",type:i.Types.string}]},exportNumberList:{description:function(){return r.i18n.raw("Export this value to the Player API. For Amplify Alpha use only!")},analyzeValueType:{type:"concrete",valueType:i.Types.numberList},internal:true,params:[{name:"key",type:i.Types.string}]}})});define("core/computation-layer/cl-specs",["require","exports","core/components/action-button/cl-spec","core/components/challenge/cl-spec","core/components/expression-input/cl-spec","core/components/graph-input/cl-spec","core/components/marbleslides/cl-spec","core/components/multiple-choice/cl-spec","core/components/penny-dragging-widget/cl-spec","core/components/reorder/cl-spec","core/components/sketch/cl-spec","core/components/table/cl-spec","core/components/text-exhibit/cl-spec","core/components/text-input/cl-spec","core/components/video/cl-spec","core/components/image-exhibit/cl-spec","core/components/cardsort/cl-spec","core/components/transform/cl-spec","core/components/polygraph/cl-spec","core/computation-layer/types","core/components/shared/export-sinks"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f,h,y,m,v,g,b,x){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.clSpecs=void 0;t.clSpecs={"action-button":r,cardsort:m,challenge:n,"custom-component":{listSinks:b.convertSinkList({})},"exhibit/image":y,"exhibit/text":d,geometry:{listSinks:b.convertSinkList({})},"input/expression":i,"input/graph":a,"input/text":f,marbleslides:o,"multiple-choice":s,"penny-dragging-widget":u,polygraph:g,sketch:l,table:p,video:h,"student-survey":{listSinks:b.convertSinkList({})},reorder:c,transform:v};for(var S in t.clSpecs){var T=t.clSpecs[S];T.listSinks.registerSinksFrom(x.exportSinks)}});define("core/computation-layer/pure-source-controller",["require","exports","tslib"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.PureSourceController=void 0;var n=function(){function e(e,t){var r=this;this.options=e;this.studentId=t;this.subscriptions=[];this.subscribed=false;this.subscribe=function(e,t){var n=r.options.lessonQuery.getScreenIdFromComponentId(e);var i=r.options.lessonQuery.getComponentConfigById(e);var a={cb:t,componentId:e,stepId:n,componentConfig:i};r.subscriptions.push(a);r.updateSubscription(a);r.ensureSubscribed()}}e.prototype.ensureSubscribed=function(){var e=this;if(this.subscribed)return;this.subscribed=true;this.options.register(function(t){return e.handleUpdate(t)})};e.prototype.handleUpdate=function(e){if(e.type!="student-list-updated")return;for(var t=0,n=this.subscriptions;t<n.length;t++){var i=n[t];var a=r.__assign(r.__assign({},e.updated.responses[i.stepId]),e.updated.responses[i.componentId]);if(a[this.studentId]){this.updateSubscription(i)}}};e.prototype.updateSubscription=function(e){var t=this.options.responseForStudentAndComponent(this.studentId,e.componentId);if(t==null)t={};e.cb(t,e.componentConfig)};return e}();t.PureSourceController=n});(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define("flux",[],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.Flux=e()}})(function(){var e,t,r;return function e(t,r,n){function i(o,s){if(!r[o]){if(!t[o]){var u=typeof require=="function"&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[o]={exports:{}};t[o][0].call(l.exports,function(e){var r=t[o][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[o].exports}var a=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){t.exports.Dispatcher=e("./lib/Dispatcher")},{"./lib/Dispatcher":2}],2:[function(e,t,r){function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=e("./invariant");var a="ID_";var o=function(){function e(){n(this,e);this._lastID=1;this._callbacks={};this._isPending={};this._isHandled={};this._isDispatching=false;this._pendingPayload=null}e.prototype.register=function e(t){var r=a+this._lastID++;this._callbacks[r]=t;return r};e.prototype.unregister=function e(t){i(this._callbacks[t],"Dispatcher.unregister(...): `%s` does not map to a registered callback.",t);delete this._callbacks[t]};e.prototype.waitFor=function e(t){i(this._isDispatching,"Dispatcher.waitFor(...): Must be invoked while dispatching.");for(var r=0;r<t.length;r++){var n=t[r];if(this._isPending[n]){i(this._isHandled[n],"Dispatcher.waitFor(...): Circular dependency detected while "+"waiting for `%s`.",n);continue}i(this._callbacks[n],"Dispatcher.waitFor(...): `%s` does not map to a registered callback.",n);this._invokeCallback(n)}};e.prototype.dispatch=function e(t){i(!this._isDispatching,"Dispatch.dispatch(...): Cannot dispatch in the middle of a dispatch.");this._startDispatching(t);try{for(var r in this._callbacks){if(this._isPending[r]){continue}this._invokeCallback(r)}}finally{this._stopDispatching()}};e.prototype.isDispatching=function e(){return this._isDispatching};e.prototype._invokeCallback=function e(t){this._isPending[t]=true;this._callbacks[t](this._pendingPayload);this._isHandled[t]=true};e.prototype._startDispatching=function e(t){for(var r in this._callbacks){this._isPending[r]=false;this._isHandled[r]=false}this._pendingPayload=t;this._isDispatching=true};e.prototype._stopDispatching=function e(){this._pendingPayload=null;this._isDispatching=false};return e}();t.exports=o},{"./invariant":3}],3:[function(e,t,r){var n=function(e,t,r,n,i,a,o,s){if(false){if(t===undefined){throw new Error("invariant requires an error message argument")}}if(!e){var u;if(t===undefined){u=new Error("Minified exception occurred; use the non-minified dev environment "+"for the full error message and additional helpful warnings.")}else{var c=[r,n,i,a,o,s];var l=0;u=new Error("Invariant Violation: "+t.replace(/%s/g,function(){return c[l++]}))}u.framesToPop=1;throw u}};t.exports=n},{}]},{},[1])(1)});define("core/lib/flux-wrapper",["require","exports","tslib","flux","underscore"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.Dispatcher=void 0;var a;try{if(performance){a=function(){return performance.now()}}else{throw new Error("Performance not defined")}}catch(e){a=function(){return(new Date).getTime()}}var o=a();var s=function(e){r.__extends(t,e);function t(t){var r=e.call(this)||this;r.options=t;r.lastAction={type:"initialization",finished:a()};r.views={};var n=r.dispatch;r.dispatch=function(e){return n.call(r,e)};return r}t.prototype.dispatch=function(t){var n=a();if(!t.type){throw new Error("Bad action: "+JSON.stringify(t))}var i=[];e.prototype.dispatch.call(this,r.__assign(r.__assign({},t),{_onUpdateDone:function(e){return i.push(e)}}));var s=a();this.updateAll();var u=a();for(var c=0,l=i;c<l.length;c++){var p=l[c];p()}var d=a();var f=1e4;if(f<1){throw new Error("Downsample less than one will sample every dispatch")}if(this.options.logJSON&&Math.random()*f<1)this.options.logJSON("dispatch-sample",{type:t.type,w:f,times:{model:s-n,view:u-s,updateDone:d-u,timeSinceLoad:d-o},prev:{type:this.lastAction.type,dt:n-this.lastAction.finished}});this.lastAction={type:t.type,finished:d}};t.prototype.pushView=function(e){var t=i.uniqueId("viewToken_");this.views[t]=e;return t};t.prototype.removeView=function(e){delete this.views[e]};t.prototype.register=function(t){return e.prototype.register.call(this,function(e){return t(e,e._onUpdateDone)})};t.prototype.updateAll=function(){if(this.view){this.view.update()}for(var e in this.views){this.views[e].update()}};return t}(n.Dispatcher);t.Dispatcher=s});define("core/lib/typed-bind",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.bind=void 0;var r=function(e,t){return e["bind"](t)};t.bind=r});define("core/computation-layer/params",["require","exports","core/computation-layer/aggregator","core/computation-layer/step-component","core/computation-layer/library/index","core/computation-layer/cl-specs","core/computation-layer/pure-source-controller","core/lib/flux-wrapper","core/lib/typed-bind"],function(e,t,r,n,i,a,o,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.buildRuntimeParams=t.buildComponentParams=void 0;function c(e,t){var i={};function o(e,t){i[e]=t}for(var s=0,u=e;s<u.length;s++){var c=u[s];o(c,{stepId:c,sinks:n.stepComponent.listSinks,script:t.getStepConfig(c).script});for(var l=0,p=t.getComponentIdsForScreen(c);l<p.length;l++){var d=p[l];var f=t.getComponentConfigById(d);var h=t.getScreenIdFromComponentId(d);var y=t.getComponentAliasById(d);var m=a.clSpecs[y];var v=f.alias?f.alias.trim():"";if(v===""){v=void 0}o(d,{stepId:h,sinks:m.listSinks,sources:m.listSources,componentAnalysis:m.componentAnalysis,alias:v,script:f.script,config:f})}}o("aggregate",{stepId:"aggregate",sinks:r.listSinks,sources:r.listSources});return i}t.buildComponentParams=c;function l(e,t,r){var n=c(e.lessonQuery.listAllScreenIds(),e.lessonQuery);var a=undefined;var l=e.dispatcher;if(!l){l=new s.Dispatcher({})}var p=new o.PureSourceController({lessonQuery:e.lessonQuery,register:u.bind(l.register,l),responseForStudentAndComponent:e.responseForStudentAndComponent},t);a=p.subscribe;var d={noScripts:false,components:n,library:i,computationDidUpdate:function(){return e.dispatcher?e.dispatcher.dispatch({type:"computation-layer-updated"}):undefined},subscribePureSource:a,publishersAvailable:["playgroundController","aggregate"],insertThumbnailComponent:false,locationOverrideMap:e.locationOverrideMap,useLegacyLocations:e.useLegacyLocations,runtimeConstants:r};return d}t.buildRuntimeParams=l});define("core/lesson-query",["require","exports","tslib","underscore","core/lib/i18n","./components/component-helpers","core/components/component-helpers","./lib/log","./components/multiple-choice/helpers"],function(e,t,r,n,i,a,o,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.LessonQuery=t.ConditionalStep=void 0;var c=function(){function e(){}return e}();var l=function(){function e(e){this.screenId=e}e.prototype.getScreenId=function(){return this.screenId};e.prototype.containsScreenId=function(e){return e==this.screenId};return e}();var p=function(){function e(){}e.prototype.getScreenId=function(){return"unimplemented"};e.prototype.containsScreenId=function(e){return false};return e}();t.ConditionalStep=p;var d=0;var f=function(){function e(e,t,r){this.options=r;this.data=h();this.stepsConfig=[];this.editingSubscreenParentIndex={};this.hiddenScreens={};this.id=d++;this.reload(e,{realtimeEdits:t})}e.prototype.reload=function(e,t){if(t===void 0){t={}}this.data=h();var o=t.realtimeEdits;this.hiddenScreens=r.__assign({},o===null||o===void 0?void 0:o.hiddenSteps);var s=e;if(o){s=r.__spreadArrays(s);var u={};s.forEach(function(e){return u[e.id]=true});var c=function(e){if(!u[e.stepId]){var t=n.findIndex(s,function(t){return t.id===e.afterStepId})+1;s.splice(t,0,e.step)}};for(var l=0,p=o.insertedSteps;l<p.length;l++){var d=p[l];c(d)}}this.stepsConfig=s;for(var f=0;f<s.length;f++){var y=s[f];this.appendStep(y);var m=y.beginNewSection;var v=this.data.sections[this.data.sections.length-1];if(m){var g=v?v.activityNumber:0;this.data.sections.push({key:m,start:f,end:f,activityNumber:m==="im-pilot-activity"?1+g:g})}else if(v){v.end=f}}this.editingSubscreenParentIndex={};for(var f=0,b=1;f<s.length;f++){var x=s[f];var S=this.data.screens[this.data.visibleAndHiddenSteps[f].getScreenId()];var T=a.getSubscreenParentConfig(x);if(!this.hiddenScreens[S.id]){S.displayNumber=i.i18n.num(b);b+=1}if(!T||typeof T.numSteps!=="number"){continue}for(var w=0;w<T.numSteps;w++){var _=s[f+1+w];var I=this.data.screens[this.data.visibleAndHiddenSteps[f+1+w].getScreenId()];I.displayNumber=i.i18n.raw(S.displayNumber+"."+i.i18n.num(w+1));this.editingSubscreenParentIndex[_.id]=S.id}f+=T.numSteps}};e.prototype.getId=function(){return this.id};e.prototype.appendStep=function(e){var t;if(e.type!="two-column")throw new Error("Expected a two-column step type");var r={layout:[],id:e.id,displayNumber:this.hiddenScreens[e.id]?undefined:i.i18n.num(this.data.visibleSteps.length+1),title:e.title,script:e.script};if(e.id==undefined){throw new Error("Error - screen without id")}else if(this.data.screens[r.id]){throw new Error("screenId Collision")}for(var n=0,a=e.root.linearlayout.components;n<a.length;n++){var s=a[n];var u=[];for(var c=0,p=s.linearlayout.components;c<p.length;c++){var d=p[c];var f=o.componentKey(d);var h=o.traverseComponentKey(d);if(h.id==undefined){throw new Error("Error - component without id")}else if(this.data.components[h.id]){throw new Error("componentId collision")}if(((t=this.options)===null||t===void 0?void 0:t.skipTeacherTipNotes)&&f==="exhibit/text"&&h.isTeacherTips){continue}u.push(h.id);this.data.components[h.id]={type:f,config:h,screenId:r.id}}if(u.length>0){r.layout.push(u)}}this.data.screens[r.id]=r;var y=new l(r.id);this.data.visibleAndHiddenSteps.push(y);if(!this.hiddenScreens[r.id]){this.data.visibleSteps.push(y)}};e.prototype.getStepConfig=function(e){for(var t=0,r=this.stepsConfig;t<r.length;t++){var n=r[t];if(n.id==e)return n}throw new Error("Unable to find step config for screen "+e)};e.prototype.getVisibleScreenIdByIndex=function(e){return this.getStepByIndex(e,{includeHiddenScreens:false}).getScreenId()};e.prototype.getIndexForVisibleScreenId=function(e){for(var t=0;t<this.data.visibleSteps.length;t++){if(this.data.visibleSteps[t].containsScreenId(e))return t}throw new Error("Screen "+e+" not found in any visible step")};e.prototype.getFirstScreenId=function(e){return this.getStepByIndex(0,e).getScreenId()};e.prototype.getLastScreenId=function(e){var t=e.includeHiddenScreens?this.data.visibleAndHiddenSteps.length:this.data.visibleSteps.length;return this.getStepByIndex(t-1,e).getScreenId()};e.prototype.getAdjacentVisibleScreenId=function(e,t){var r=this.findIndexInFullStepList(e);var n=t==="next"?1:-1;for(var i=r+n;i>=0&&i<this.data.visibleAndHiddenSteps.length;i+=n){var a=this.getStepByIndex(i,{includeHiddenScreens:true});if(this.hiddenScreens[a.getScreenId()]){continue}return a.getScreenId()}return undefined};e.prototype.isScreenHidden=function(e){return this.hiddenScreens[e]};e.prototype.isScreenInRange=function(e,t,r){var n=this.findIndexInFullStepList(t.fromScreenId);var i=this.findIndexInFullStepList(t.toScreenId);var a=this.findIndexInFullStepList(e);if(a>n&&a<i){return true}else if(a===n){return r.inclusive==="left-only"||r.inclusive==="both"}else if(a===i){return r.inclusive==="right-only"||r.inclusive==="both"}else{return false}};e.prototype.countScreensInRange=function(e,t){var r=t.includeHiddenScreens?this.findIndexInFullStepList(e.fromScreenId):this.getIndexForVisibleScreenId(e.fromScreenId);var n=t.includeHiddenScreens?this.findIndexInFullStepList(e.toScreenId):this.getIndexForVisibleScreenId(e.toScreenId);var i=Math.abs(n-r);if(t.inclusive==="both"){return i+1}else if(t.inclusive==="neither"){return i-1}else{return i}};e.prototype.hasExplainAtEndOfLayout=function(e){var t=this.getComponentById(e);if(!(t.type==="multiple-choice"&&t.config.showExplainAtEndOfLayout&&u.configHasExplanation(t.config)))return false;return this.mcCanHaveExplainAtEndOfLayout(e)};e.prototype.mcCanHaveExplainAtEndOfLayout=function(e){var t=this;var r=this.componentIdsByColumn(this.getScreenIdFromComponentId(e));if(r.length!==2)return false;if(r[0].indexOf(e)===-1)return false;return n.every(n.flatten(r),function(r){if(r===e)return true;return t.getComponentAliasById(r)==="exhibit/text"})};e.prototype.getDisplayNumberForScreenId=function(e){var t=this.data.screens[e];if(!t)throw new Error("Screen "+e+" not found.");return t.displayNumber};e.prototype.getComponentIdsForScreen=function(e){var t=this.getScreenById(e);return n.flatten(t.layout)};e.prototype.getComponentIdLayoutByScreenId=function(e){return this.getScreenById(e).layout};e.prototype.getComponentKeysForScreen=function(e){var t=this;var r=this.getComponentIdsForScreen(e);return r.map(function(e){return t.getComponentAliasById(e)})};e.prototype.getScreenIdFromComponentId=function(e){return this.getComponentById(e).screenId};e.prototype.isComponentOnScreen=function(e){var t=e.componentId,r=e.screenId;return this.getComponentById(t).screenId==r};e.prototype.hasScreen=function(e){return this.data.screens[e]!=undefined};e.prototype.isSubscreen=function(e){return!!this.getSubscreenParentForStepWhileEditing(e)};e.prototype.componentIdsByColumn=function(e){return this.getScreenById(e).layout.map(function(e){return e.map(function(e){return e})})};e.prototype.componentKeysByColumn=function(e){var t=this;return this.getScreenById(e).layout.map(function(e){return e.map(function(e){return t.getComponentAliasById(e)})})};e.prototype.columnIdxForComponent=function(e,t){var r=this.getScreenById(e).layout;for(var n=0;n<r.length;n++){if(r[n].indexOf(t)>=0)return n}return-1};e.prototype.componentCountForScreen=function(e){return this.getComponentIdsForScreen(e).length};e.prototype.isSoloComponentScreen=function(e){return this.componentCountForScreen(e)===1};e.prototype.getImageForScreen=function(e){if(!this.hasScreen(e))return undefined;var t=this.getComponentByKeyAndScreen("exhibit/image",e);return t&&t.img};e.prototype.getNoteForScreen=function(e){var t=this.getComponentByKeyAndScreen("exhibit/text",e);if(!t)return undefined;return t.doc?{doc:t.doc}:{text:t.text}};e.prototype.getChallengeCreatorForScreen=function(e){return this.getComponentByKeyAndScreen("challenge",e)};e.prototype.getCardsortForScreen=function(e){return this.getComponentByKeyAndScreen("cardsort",e)};e.prototype.getPolygraphForScreen=function(e){return this.getComponentByKeyAndScreen("polygraph",e)};e.prototype.getParentPolygraph=function(){for(var e=0,t=this.listAllScreenIds();e<t.length;e++){var r=t[e];var n=this.getComponentByKeyAndScreen("polygraph",r);if(n){return n}}return undefined};e.prototype.getSubscreenParentForStepWhileEditing=function(e){var t=this.editingSubscreenParentIndex[e];return t?this.getStepConfig(t):undefined};e.prototype.getSubscreensForChallenge=function(e){var t=this;if(this.getChallengeCreatorForScreen(e)){return n.keys(this.editingSubscreenParentIndex).filter(function(r){return t.editingSubscreenParentIndex[r]===e})}return[]};e.prototype.getChallengeScreenId=function(){var e=n.uniq(n.values(this.editingSubscreenParentIndex));if(e.length>0){if(e.length>1){s.warn("get-challenge-screens","Expected at most one Challenge Creator for activity")}return e[0]}return undefined};e.prototype.getSubscreenSteps=function(){var e={};for(var t in this.editingSubscreenParentIndex){var r=this.editingSubscreenParentIndex[t];if(!e[r]){e[r]=[this.getStepConfig(r)]}e[r].push(this.getStepConfig(t))}return e};e.prototype.getPrimaryActivitySteps=function(){var e=this;return this.stepsConfig.filter(function(t){return!e.isSubscreen(t.id)&&!e.getComponentByKeyAndScreen("challenge",t.id)})};e.prototype.getPreviousGraphComponentId=function(e){var t;for(var r=0,n=this.data.visibleAndHiddenSteps;r<n.length;r++){var i=n[r];if(!(i instanceof l))continue;var a=i.getScreenId();for(var o=0,s=this.getComponentIdsForScreen(a);o<s.length;o++){var u=s[o];if(u==e){return t}if(this.getComponentAliasById(u)=="input/graph"){t=u}}}return undefined};e.prototype.getSourceId=function(e){var t=this.getComponentConfigById(e);if(t&&t.copyId){var r=this.getPreviousGraphComponentId(e);return r?this.getSourceId(r):t.id}else{return t?t.id:e}};e.prototype.getSourceData=function(e){return this.getComponentConfigById(this.getSourceId(e))};e.prototype.lessonUsesScripts=function(){for(var e in this.data.screens){if(this.getScreenById(e).script)return true}for(var t in this.data.components){if(this.getComponentById(t).config.script)return true}return false};e.prototype.scriptByScreenOrComponentId=function(e){var t=this.data.components[e];var r=this.data.screens[e];if(t&&r)throw new Error("Screen and component have matching ids");if(t){return t.config.script}if(r){return r.script}return undefined};e.prototype.getComponentAliasById=function(e){return this.getComponentById(e).type};e.prototype.componentAliasExists=function(e){for(var t in this.data.components){if(this.data.components[t].type==e)return true}return false};e.prototype.listAllComponentIds=function(){return n.keys(this.data.components)};e.prototype.listAllScreenIds=function(){return n.keys(this.data.screens)};e.prototype.listSteps=function(e){var t=this;return e.includeHiddenScreens?this.stepsConfig:this.stepsConfig.filter(function(e){return!t.hiddenScreens[e.id]})};e.prototype.getStepCount=function(e){var t=e.includeHiddenScreens?this.data.visibleAndHiddenSteps:this.data.visibleSteps;return t.length};e.prototype.getComponentConfigById=function(e){return this.getComponentById(e).config};e.prototype.componentExists=function(e){return this.data.components[e]!=undefined};e.prototype.screenExists=function(e){return this.data.screens[e]!=undefined};e.prototype.getSectionForStep=function(e){var t=this.findIndexInFullStepList(e);for(var r=0,n=this.data.sections;r<n.length;r++){var i=n[r];if(i.start<=t&&i.end>=t)return{key:i.key,activityNumber:i.activityNumber,isStartOfSection:i.start===t,isEndOfSection:i.end===t}}return undefined};e.prototype.isLastScreenBeforeFirstSection=function(e){return this.data.sections.length>0&&this.data.sections[0].start===1+this.findIndexInFullStepList(e)};e.prototype.hasSections=function(){return this.data.sections.length>0};e.prototype.getComponentById=function(e){var t=this.data.components[e];if(t==undefined)throw new Error("Component "+e+" not found");return t};e.prototype.getScreenById=function(e){var t=this.data.screens[e];if(t==undefined)throw new Error("Screen "+e+" not found");return t};e.prototype.getStepByIndex=function(e,t){var r=t.includeHiddenScreens?this.data.visibleAndHiddenSteps:this.data.visibleSteps;var n=r[e];if(n==undefined)throw new Error("Unable to find step with index "+e);return n};e.prototype.findIndexInFullStepList=function(e){var t=n.findIndex(this.data.visibleAndHiddenSteps,function(t){return t.containsScreenId(e)});if(t==undefined){throw new Error("Screen "+e+" not found in any step")}return t};e.prototype.getComponentByKeyAndScreen=function(e,t){for(var r=0,n=this.getComponentIdsForScreen(t);r<n.length;r++){var i=n[r];var a=this.getComponentById(i);if(a.type==e){return a.config}}return undefined};e.prototype.getComponentPosition=function(e,t){var r=this.getComponentIdLayoutByScreenId(e);if(r.length===1){return"center"}var n=this.columnIdxForComponent(e,t);if(n===0)return"left";return"right"};return e}();t.LessonQuery=f;function h(){return{components:{},screens:{},visibleAndHiddenSteps:[],visibleSteps:[],sections:[]}}});define("core/lib/combine-step-and-component-response",["require","exports","tslib","underscore"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.combineStepAndComponentResponse=void 0;function i(e,t){return r.__assign(r.__assign({},n.omit(e,"seen","coverDismissed")),t)}t.combineStepAndComponentResponse=i});define("core/computation-layer/class-runtime",["require","exports","tslib","./runtime","./params","core/lesson-query","core/lib/combine-step-and-component-response","core/random-seed","core/lib/flux-wrapper","core/lib/typed-bind"],function(e,t,r,n,i,a,o,s,u,c){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ClassRuntime=void 0;var l=function(){function e(e){this.options=e;this.runtimes={};this.students={};this.allSteps=e.steps;this.lessonQuery=new a.LessonQuery(this.allSteps);for(var t=0,r=e.studentIds;t<r.length;t++){var n=r[t];this.ensureRuntimeExists(n)}this.handleResponses(e.responses)}e.prototype.responseForStudentAndComponent=function(e,t){var r=this.students[e];if(!r){throw new Error("Tried reading data for student "+e+" but it did not exist.")}var n=r.data[t];var i=this.lessonQuery.getScreenIdFromComponentId(t);var a=r.data[i];var s=o.combineStepAndComponentResponse(a,n);return s};e.prototype.responseForStudentAndScreen=function(e){var t=this.students[e.studentId];if(!t){throw new Error("Tried reading data for student "+e.studentId+" but it did not exist.")}if(!this.lessonQuery.screenExists(e.screenId)){throw new Error("Tried reading data for screen "+e.screenId+" but it did not exist.")}return t.data[e.screenId]};e.prototype.getRuntime=function(e){this.ensureRuntimeExists(e);return this.runtimes[e]};e.prototype.getDownstreamComponentIds=function(e,t){var r=this.runtimes[e];var n={};var i={};function a(e){if(n[e]){return}n[e]=true;var t=r.nodes[e];for(var i=0,o=t.dependents;i<o.length;i++){var s=o[i];a(s)}}for(var o in t){var s=r.analysis.responseSources[o];if(s){a(s)}}for(var u in r.analysis.sinks){var c=r.analysis.sinks[u];for(var l in c){for(var p=0,d=c[l];p<d.length;p++){var f=d[p];for(var h=0,y=f.dependencies;h<y.length;h++){var m=y[h];if(n[m]){i[u]=true}}}}}return Object.keys(i)};e.prototype.handleResponses=function(e){for(var t in e){var n=this.students[t];if(!n){throw new Error("Processing response for student "+t+" before student runtime is defined")}n.data=r.__assign(r.__assign({},n.data),e[t])}var i=p(e);for(var t in this.students){this.students[t].dispatcher.dispatch({type:"student-list-updated",updated:i});this.runtimes[t].processPendingValues()}};e.prototype.onceRuntime=function(e,t,r,n){this.ensureRuntimeExists(e,t,true,r);var i=this.runtimes[e];for(var a=0,o=i.getSources("aggregate","aggregateSource");a<o.length;a++){var s=o[a];var u=s.params[0];if(!n[u]){throw new Error("Expected aggregateSource with id "+u+" but found none.")}s.setValue(n[u])}};e.prototype.ensureRuntimeExists=function(e,t,a,o){var l=this;if(this.runtimes[e])return;var p=new u.Dispatcher({});var d=p.register(function(t){var r=l.students[e];var n=l.runtimes[e];if(!r||!n){throw new Error("Tried handling dispatch for "+e+" but that student runtime no longer exists.")}switch(t.type){case"student-list-updated":l.updateAggregateSources(e,t.updated);break;case"computation-layer-updated":{var i={};var a=n.sinks;for(var o in a){var s=a[o];i[o]={};for(var u in s){var c=s[u];i[o][u]=[];for(var p=0,d=c;p<d.length;p++){var f=d[p];i[o][u].push({params:f.params,value:f.value,valueType:f.valueType})}}}l.options.onCLUpdated(e,i);if(r.once){l.destroyRuntime(e)}break}default:l.options.onUnexpectedAction(t.type)}});this.students[e]={dispatcher:p,token:d,data:t||{},once:!!a};var f=i.buildRuntimeParams({lessonQuery:this.lessonQuery,dispatcher:p,responseForStudentAndComponent:c.bind(this.responseForStudentAndComponent,this),locationOverrideMap:this.options.locationOverrideMap,useLegacyLocations:this.options.useLegacyLocations},e,{dryRun:false,randomSeed:o?s.RandomSeed.fromString(o):new s.RandomSeed(e),degreeMode:!!this.options.degreeMode}),h=f.noScripts,y=r.__rest(f,["noScripts"]);var m=r.__assign(r.__assign({noScripts:false},y),{publishersAvailable:["aggregate"],insertThumbnailComponent:true});var v;if(this.initialRuntime){v=new n.Runtime(r.__assign(r.__assign({},m),{reuseAnalysisFrom:this.initialRuntime}))}else{v=new n.Runtime(r.__assign({},m))}this.initializeAggregateSources(v);this.runtimes[e]=v;if(!this.initialRuntime)this.initialRuntime=v};e.prototype.addSiloedStep=function(e,t){this.lessonQuery.reload(this.allSteps,{realtimeEdits:{insertedSteps:[{stepId:e.id,step:e,afterStepId:t}],hiddenSteps:{}}});this.allSteps=this.lessonQuery.listSteps({includeHiddenScreens:true});var r=i.buildComponentParams([e.id],this.lessonQuery);this.addSiloedComponents(r)};e.prototype.addSiloedComponents=function(e){this.initialRuntime=undefined;var t;for(var r in this.runtimes){var n=this.runtimes[r];if(n){var i=n.addSiloedComponents(e,{cachedSiloedAnalysis:t}).siloedAnalysis;if(!t){t=i}this.initializeAggregateSources(n)}}};e.prototype.updateAggregateSources=function(e,t){var r=this.students[e];var n=this.runtimes[e];if(!r||!n){throw new Error("Tried aggregating for student "+e+" but that student is not registered.")}for(var i=0,a=n.getSources("aggregate","aggregateSource");i<a.length;i++){var o=a[i];var s=o.params[0];if(t.responses[s]){var u=[];for(var c=0,l=Object.keys(this.students).sort();c<l.length;c++){var p=l[c];var d=this.students[p].data[s];if(d&&d.computedValue!=null&&!isNaN(d.computedValue)){u.push(d.computedValue)}}o.setValue(u)}}};e.prototype.initializeAggregateSources=function(e){for(var t=0,r=e.getSources("aggregate","aggregateSource");t<r.length;t++){var n=r[t];if(n.getValue()===undefined){n.setValue([])}}};e.prototype.destroyRuntime=function(e){var t=this.students[e];var r=this.runtimes[e];if(!t||!r){throw new Error("Tried to destroy runtime for student "+e+" but it did not exist.")}t.dispatcher.unregister(t.token);delete this.students[e];delete this.runtimes[e]};return e}();t.ClassRuntime=l;function p(e){var t={};for(var r in e){for(var n in e[r]){if(!t[n]){t[n]={}}t[n][r]=true}}return{responses:t}}});define("prosemirror-schema-basic/index",["require","exports","module","prosemirror-model"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=e("prosemirror-model");var i=["p",0],a=["blockquote",0],o=["hr"],s=["pre",["code",0]],u=["br"];var c={doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:function e(){return i}},blockquote:{content:"block+",group:"block",defining:true,parseDOM:[{tag:"blockquote"}],toDOM:function e(){return a}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:function e(){return o}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:true,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function e(t){return["h"+t.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:true,defining:true,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:function e(){return s}},text:{group:"inline"},image:{inline:true,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:true,parseDOM:[{tag:"img[src]",getAttrs:function e(t){return{src:t.getAttribute("src"),title:t.getAttribute("title"),alt:t.getAttribute("alt")}}}],toDOM:function e(t){var r=t.attrs;var n=r.src;var i=r.alt;var a=r.title;return["img",{src:n,alt:i,title:a}]}},hard_break:{inline:true,group:"inline",selectable:false,parseDOM:[{tag:"br"}],toDOM:function e(){return u}}};var l=["em",0],p=["strong",0],d=["code",0];var f={link:{attrs:{href:{},title:{default:null}},inclusive:false,parseDOM:[{tag:"a[href]",getAttrs:function e(t){return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM:function e(t){var r=t.attrs;var n=r.href;var i=r.title;return["a",{href:n,title:i},0]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function e(){return l}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(e){return e.style.fontWeight!="normal"&&null}},{style:"font-weight",getAttrs:function(e){return/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}}],toDOM:function e(){return p}},code:{parseDOM:[{tag:"code"}],toDOM:function e(){return d}}};var h=new n.Schema({nodes:c,marks:f});t.marks=f;t.nodes=c;t.schema=h});define("prosemirror-schema-basic",["prosemirror-schema-basic/index"],function(e){return e});define("core/prosemirror/link-mark-spec",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.linkPreview=t.link=void 0;t.link={attrs:{href:{},title:{default:null},target:{default:"_blank"}},inclusive:false,parseDOM:[{tag:"a[href]",getAttrs:function(e){return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM:function(e){var t=e.attrs,r=t.href,n=t.title,i=t.target;return["a",{href:r,title:n,target:i,class:"blue-link",rel:"nofollow ugc"},0]}};t.linkPreview={toDOM:function(e){var t=e.attrs.title;return["span",{title:t,class:"blue-link prosemirror-link-preview"},0]}}});define("core/prosemirror/mq-schema",["require","exports","orderedmap","prosemirror-model","prosemirror-schema-basic"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.mqSchema=t.mqSpec=void 0;t.mqSpec={inline:true,group:"inline",content:"text*",selectable:true,toDOM:function(e){return"`"+e.textContent+"`"}};t.mqSchema=new n.Schema({nodes:r.from({doc:i.nodes.doc,paragraph:i.nodes.paragraph,text:i.nodes.text,mq:t.mqSpec})})});define("core/prosemirror/interp-node-spec",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.interpSpec=void 0;t.interpSpec={content:"inline*",attrs:{interpExpr:{default:""}},group:"inline",inline:true,selectable:true,toDOM:function(e){return"${"+e.attrs.interpExpr+"}"}}});define("prosemirror-transform/index",["require","exports","module","prosemirror-model"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=e("prosemirror-model");var i=65535;var a=Math.pow(2,16);function o(e,t){return e+t*a}function s(e){return e&i}function u(e){return(e-(e&i))/a}var c=function e(t,r,n){if(r===void 0)r=false;if(n===void 0)n=null;this.pos=t;this.deleted=r;this.recover=n};var l=function e(t,r){if(r===void 0)r=false;this.ranges=t;this.inverted=r};l.prototype.recover=function e(t){var r=0,n=s(t);if(!this.inverted){for(var i=0;i<n;i++){r+=this.ranges[i*3+2]-this.ranges[i*3+1]}}return this.ranges[n*3]+r+u(t)};l.prototype.mapResult=function e(t,r){if(r===void 0)r=1;return this._map(t,r,false)};l.prototype.map=function e(t,r){if(r===void 0)r=1;return this._map(t,r,true)};l.prototype._map=function e(t,r,n){var i=0,a=this.inverted?2:1,s=this.inverted?1:2;for(var u=0;u<this.ranges.length;u+=3){var l=this.ranges[u]-(this.inverted?i:0);if(l>t){break}var p=this.ranges[u+a],d=this.ranges[u+s],f=l+p;if(t<=f){var h=!p?r:t==l?-1:t==f?1:r;var y=l+i+(h<0?0:d);if(n){return y}var m=o(u/3,t-l);return new c(y,r<0?t!=l:t!=f,m)}i+=d-p}return n?t+i:new c(t+i)};l.prototype.touches=function e(t,r){var n=0,i=s(r);var a=this.inverted?2:1,o=this.inverted?1:2;for(var u=0;u<this.ranges.length;u+=3){var c=this.ranges[u]-(this.inverted?n:0);if(c>t){break}var l=this.ranges[u+a],p=c+l;if(t<=p&&u==i*3){return true}n+=this.ranges[u+o]-l}return false};l.prototype.forEach=function e(t){var r=this.inverted?2:1,n=this.inverted?1:2;for(var i=0,a=0;i<this.ranges.length;i+=3){var o=this.ranges[i],s=o-(this.inverted?a:0),u=o+(this.inverted?0:a);var c=this.ranges[i+r],l=this.ranges[i+n];t(s,s+c,u,u+l);a+=l-c}};l.prototype.invert=function e(){return new l(this.ranges,!this.inverted)};l.prototype.toString=function e(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};l.offset=function e(t){return t==0?l.empty:new l(t<0?[0,-t,0]:[0,0,t])};l.empty=new l([]);var p=function e(t,r,n,i){this.maps=t||[];this.from=n||0;this.to=i==null?this.maps.length:i;this.mirror=r};p.prototype.slice=function e(t,r){if(t===void 0)t=0;if(r===void 0)r=this.maps.length;return new p(this.maps,this.mirror,t,r)};p.prototype.copy=function e(){return new p(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};p.prototype.appendMap=function e(t,r){this.to=this.maps.push(t);if(r!=null){this.setMirror(this.maps.length-1,r)}};p.prototype.appendMapping=function e(t){for(var r=0,n=this.maps.length;r<t.maps.length;r++){var i=t.getMirror(r);this.appendMap(t.maps[r],i!=null&&i<r?n+i:null)}};p.prototype.getMirror=function e(t){if(this.mirror){for(var r=0;r<this.mirror.length;r++){if(this.mirror[r]==t){return this.mirror[r+(r%2?-1:1)]}}}};p.prototype.setMirror=function e(t,r){if(!this.mirror){this.mirror=[]}this.mirror.push(t,r)};p.prototype.appendMappingInverted=function e(t){for(var r=t.maps.length-1,n=this.maps.length+t.maps.length;r>=0;r--){var i=t.getMirror(r);this.appendMap(t.maps[r].invert(),i!=null&&i>r?n-i-1:null)}};p.prototype.invert=function e(){var t=new p;t.appendMappingInverted(this);return t};p.prototype.map=function e(t,r){if(r===void 0)r=1;if(this.mirror){return this._map(t,r,true)}for(var n=this.from;n<this.to;n++){t=this.maps[n].map(t,r)}return t};p.prototype.mapResult=function e(t,r){if(r===void 0)r=1;return this._map(t,r,false)};p.prototype._map=function e(t,r,n){var i=false,a=null;for(var o=this.from;o<this.to;o++){var s=this.maps[o],u=a&&a[o];if(u!=null&&s.touches(t,u)){t=s.recover(u);continue}var l=s.mapResult(t,r);if(l.recover!=null){var p=this.getMirror(o);if(p!=null&&p>o&&p<this.to){if(l.deleted){o=p;t=this.maps[p].recover(l.recover);continue}else{(a||(a=Object.create(null)))[p]=l.recover}}}if(l.deleted){i=true}t=l.pos}return n?t:new c(t,i)};function d(e){var t=Error.call(this,e);t.__proto__=d.prototype;return t}d.prototype=Object.create(Error.prototype);d.prototype.constructor=d;d.prototype.name="TransformError";var f=function e(t){this.doc=t;this.steps=[];this.docs=[];this.mapping=new p};var h={before:{configurable:true},docChanged:{configurable:true}};h.before.get=function(){return this.docs.length?this.docs[0]:this.doc};f.prototype.step=function e(t){var r=this.maybeStep(t);if(r.failed){throw new d(r.failed)}return this};f.prototype.maybeStep=function e(t){var r=t.apply(this.doc);if(!r.failed){this.addStep(t,r.doc)}return r};h.docChanged.get=function(){return this.steps.length>0};f.prototype.addStep=function e(t,r){this.docs.push(this.doc);this.steps.push(t);this.mapping.appendMap(t.getMap());this.doc=r};Object.defineProperties(f.prototype,h);function y(){throw new Error("Override me")}var m=Object.create(null);var v=function e(){};v.prototype.apply=function e(t){return y()};v.prototype.getMap=function e(){return l.empty};v.prototype.invert=function e(t){return y()};v.prototype.map=function e(t){return y()};v.prototype.merge=function e(t){return null};v.prototype.toJSON=function e(){return y()};v.fromJSON=function e(t,r){if(!r||!r.stepType){throw new RangeError("Invalid input for Step.fromJSON")}var n=m[r.stepType];if(!n){throw new RangeError("No step type "+r.stepType+" defined")}return n.fromJSON(t,r)};v.jsonID=function e(t,r){if(t in m){throw new RangeError("Duplicate use of step JSON ID "+t)}m[t]=r;r.prototype.jsonID=t;return r};var g=function e(t,r){this.doc=t;this.failed=r};g.ok=function e(t){return new g(t,null)};g.fail=function e(t){return new g(null,t)};g.fromReplace=function e(t,r,i,a){try{return g.ok(t.replace(r,i,a))}catch(e){if(e instanceof n.ReplaceError){return g.fail(e.message)}throw e}};var b=function(e){function t(t,r,n,i){e.call(this);this.from=t;this.to=r;this.slice=n;this.structure=!!i}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){if(this.structure&&S(t,this.from,this.to)){return g.fail("Structure replace would overwrite content")}return g.fromReplace(t,this.from,this.to,this.slice)};t.prototype.getMap=function e(){return new l([this.from,this.to-this.from,this.slice.size])};t.prototype.invert=function e(r){return new t(this.from,this.from+this.slice.size,r.slice(this.from,this.to))};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);if(n.deleted&&i.deleted){return null}return new t(n.pos,Math.max(n.pos,i.pos),this.slice)};t.prototype.merge=function e(r){if(!(r instanceof t)||r.structure!=this.structure){return null}if(this.from+this.slice.size==r.from&&!this.slice.openEnd&&!r.slice.openStart){var i=this.slice.size+r.slice.size==0?n.Slice.empty:new n.Slice(this.slice.content.append(r.slice.content),this.slice.openStart,r.slice.openEnd);return new t(this.from,this.to+(r.to-r.from),i,this.structure)}else if(r.to==this.from&&!this.slice.openStart&&!r.slice.openEnd){var a=this.slice.size+r.slice.size==0?n.Slice.empty:new n.Slice(r.slice.content.append(this.slice.content),r.slice.openStart,this.slice.openEnd);return new t(r.from,this.to,a,this.structure)}else{return null}};t.prototype.toJSON=function e(){var t={stepType:"replace",from:this.from,to:this.to};if(this.slice.size){t.slice=this.slice.toJSON()}if(this.structure){t.structure=true}return t};t.fromJSON=function e(r,i){if(typeof i.from!="number"||typeof i.to!="number"){throw new RangeError("Invalid input for ReplaceStep.fromJSON")}return new t(i.from,i.to,n.Slice.fromJSON(r,i.slice),!!i.structure)};return t}(v);v.jsonID("replace",b);var x=function(e){function t(t,r,n,i,a,o,s){e.call(this);this.from=t;this.to=r;this.gapFrom=n;this.gapTo=i;this.slice=a;this.insert=o;this.structure=!!s}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){if(this.structure&&(S(t,this.from,this.gapFrom)||S(t,this.gapTo,this.to))){return g.fail("Structure gap-replace would overwrite content")}var r=t.slice(this.gapFrom,this.gapTo);if(r.openStart||r.openEnd){return g.fail("Gap is not a flat range")}var n=this.slice.insertAt(this.insert,r.content);if(!n){return g.fail("Content does not fit in gap")}return g.fromReplace(t,this.from,this.to,n)};t.prototype.getMap=function e(){return new l([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])};t.prototype.invert=function e(r){var n=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,r.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);var a=r.map(this.gapFrom,-1),o=r.map(this.gapTo,1);if(n.deleted&&i.deleted||a<n.pos||o>i.pos){return null}return new t(n.pos,i.pos,a,o,this.slice,this.insert,this.structure)};t.prototype.toJSON=function e(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};if(this.slice.size){t.slice=this.slice.toJSON()}if(this.structure){t.structure=true}return t};t.fromJSON=function e(r,i){if(typeof i.from!="number"||typeof i.to!="number"||typeof i.gapFrom!="number"||typeof i.gapTo!="number"||typeof i.insert!="number"){throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON")}return new t(i.from,i.to,i.gapFrom,i.gapTo,n.Slice.fromJSON(r,i.slice),i.insert,!!i.structure)};return t}(v);v.jsonID("replaceAround",x);function S(e,t,r){var n=e.resolve(t),i=r-t,a=n.depth;while(i>0&&a>0&&n.indexAfter(a)==n.node(a).childCount){a--;i--}if(i>0){var o=n.node(a).maybeChild(n.indexAfter(a));while(i>0){if(!o||o.isLeaf){return true}o=o.firstChild;i--}}return false}function T(e,t,r){return(t==0||e.canReplace(t,e.childCount))&&(r==e.childCount||e.canReplace(0,r))}function w(e){var t=e.parent;var r=t.content.cutByIndex(e.startIndex,e.endIndex);for(var n=e.depth;;--n){var i=e.$from.node(n);var a=e.$from.index(n),o=e.$to.indexAfter(n);if(n<e.depth&&i.canReplace(a,o,r)){return n}if(n==0||i.type.spec.isolating||!T(i,a,o)){break}}}f.prototype.lift=function(e,t){var r=e.$from;var i=e.$to;var a=e.depth;var o=r.before(a+1),s=i.after(a+1);var u=o,c=s;var l=n.Fragment.empty,p=0;for(var d=a,f=false;d>t;d--){if(f||r.index(d)>0){f=true;l=n.Fragment.from(r.node(d).copy(l));p++}else{u--}}var h=n.Fragment.empty,y=0;for(var m=a,v=false;m>t;m--){if(v||i.after(m+1)<i.end(m)){v=true;h=n.Fragment.from(i.node(m).copy(h));y++}else{c++}}return this.step(new x(u,c,o,s,new n.Slice(l.append(h),p,y),l.size-p,true))};function _(e,t,r,n){if(n===void 0)n=e;var i=E(e,t);var a=i&&C(n,t);if(!a){return null}return i.map(I).concat({type:t,attrs:r}).concat(a.map(I))}function I(e){return{type:e,attrs:null}}function E(e,t){var r=e.parent;var n=e.startIndex;var i=e.endIndex;var a=r.contentMatchAt(n).findWrapping(t);if(!a){return null}var o=a.length?a[0]:t;return r.canReplaceWith(n,i,o)?a:null}function C(e,t){var r=e.parent;var n=e.startIndex;var i=e.endIndex;var a=r.child(n);var o=t.contentMatch.findWrapping(a.type);if(!o){return null}var s=o.length?o[o.length-1]:t;var u=s.contentMatch;for(var c=n;u&&c<i;c++){u=u.matchType(r.child(c).type)}if(!u||!u.validEnd){return null}return o}f.prototype.wrap=function(e,t){var r=n.Fragment.empty;for(var i=t.length-1;i>=0;i--){r=n.Fragment.from(t[i].type.create(t[i].attrs,r))}var a=e.start,o=e.end;return this.step(new x(a,o,a,o,new n.Slice(r,0,0),t.length,true))};f.prototype.setBlockType=function(e,t,r,i){var a=this;if(t===void 0)t=e;if(!r.isTextblock){throw new RangeError("Type given to setBlockType should be a textblock")}var o=this.steps.length;this.doc.nodesBetween(e,t,function(e,t){if(e.isTextblock&&!e.hasMarkup(r,i)&&M(a.doc,a.mapping.slice(o).map(t),r)){a.clearIncompatible(a.mapping.slice(o).map(t,1),r);var s=a.mapping.slice(o);var u=s.map(t,1),c=s.map(t+e.nodeSize,1);a.step(new x(u,c,u+1,c-1,new n.Slice(n.Fragment.from(r.create(i,null,e.marks)),0,0),1,true));return false}});return this};function M(e,t,r){var n=e.resolve(t),i=n.index();return n.parent.canReplaceWith(i,i+1,r)}f.prototype.setNodeMarkup=function(e,t,r,i){var a=this.doc.nodeAt(e);if(!a){throw new RangeError("No node at given position")}if(!t){t=a.type}var o=t.create(r,null,i||a.marks);if(a.isLeaf){return this.replaceWith(e,e+a.nodeSize,o)}if(!t.validContent(a.content)){throw new RangeError("Invalid content for node type "+t.name)}return this.step(new x(e,e+a.nodeSize,e+1,e+a.nodeSize-1,new n.Slice(n.Fragment.from(o),0,0),1,true))};function k(e,t,r,n){if(r===void 0)r=1;var i=e.resolve(t),a=i.depth-r;var o=n&&n[n.length-1]||i.parent;if(a<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount))){return false}for(var s=i.depth-1,u=r-2;s>a;s--,u--){var c=i.node(s),l=i.index(s);if(c.type.spec.isolating){return false}var p=c.content.cutByIndex(l,c.childCount);var d=n&&n[u]||c;if(d!=c){p=p.replaceChild(0,d.type.create(d.attrs))}if(!c.canReplace(l+1,c.childCount)||!d.type.validContent(p)){return false}}var f=i.indexAfter(a);var h=n&&n[0];return i.node(a).canReplaceWith(f,f,h?h.type:i.node(a+1).type)}f.prototype.split=function(e,t,r){if(t===void 0)t=1;var i=this.doc.resolve(e),a=n.Fragment.empty,o=n.Fragment.empty;for(var s=i.depth,u=i.depth-t,c=t-1;s>u;s--,c--){a=n.Fragment.from(i.node(s).copy(a));var l=r&&r[c];o=n.Fragment.from(l?l.type.create(l.attrs,o):i.node(s).copy(o))}return this.step(new b(e,e,new n.Slice(a.append(o),t,t),true))};function P(e,t){var r=e.resolve(t),n=r.index();return O(r.nodeBefore,r.nodeAfter)&&r.parent.canReplace(n,n+1)}function O(e,t){return e&&t&&!e.isLeaf&&e.canAppend(t)}function L(e,t,r){if(r===void 0)r=-1;var n=e.resolve(t);for(var i=n.depth;;i--){var a=void 0,o=void 0,s=n.index(i);if(i==n.depth){a=n.nodeBefore;o=n.nodeAfter}else if(r>0){a=n.node(i+1);s++;o=n.node(i).maybeChild(s)}else{a=n.node(i).maybeChild(s-1);o=n.node(i+1)}if(a&&!a.isTextblock&&O(a,o)&&n.node(i).canReplace(s,s+1)){return t}if(i==0){break}t=r<0?n.before(i):n.after(i)}}f.prototype.join=function(e,t){if(t===void 0)t=1;var r=new b(e-t,e+t,n.Slice.empty,true);return this.step(r)};function N(e,t,r){var n=e.resolve(t);if(n.parent.canReplaceWith(n.index(),n.index(),r)){return t}if(n.parentOffset==0){for(var i=n.depth-1;i>=0;i--){var a=n.index(i);if(n.node(i).canReplaceWith(a,a,r)){return n.before(i+1)}if(a>0){return null}}}if(n.parentOffset==n.parent.content.size){for(var o=n.depth-1;o>=0;o--){var s=n.indexAfter(o);if(n.node(o).canReplaceWith(s,s,r)){return n.after(o+1)}if(s<n.node(o).childCount){return null}}}}function A(e,t,r){var n=e.resolve(t);if(!r.content.size){return t}var i=r.content;for(var a=0;a<r.openStart;a++){i=i.firstChild.content}for(var o=1;o<=(r.openStart==0&&r.size?2:1);o++){for(var s=n.depth;s>=0;s--){var u=s==n.depth?0:n.pos<=(n.start(s+1)+n.end(s+1))/2?-1:1;var c=n.index(s)+(u>0?1:0);if(o==1?n.node(s).canReplace(c,c,i):n.node(s).contentMatchAt(c).findWrapping(i.firstChild.type)){return u==0?n.pos:u<0?n.before(s+1):n.after(s+1)}}}return null}function D(e,t,r){var i=[];for(var a=0;a<e.childCount;a++){var o=e.child(a);if(o.content.size){o=o.copy(D(o.content,t,o))}if(o.isInline){o=t(o,r,a)}i.push(o)}return n.Fragment.fromArray(i)}var R=function(e){function t(t,r,n){e.call(this);this.from=t;this.to=r;this.mark=n}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){var r=this;var i=t.slice(this.from,this.to),a=t.resolve(this.from);var o=a.node(a.sharedDepth(this.to));var s=new n.Slice(D(i.content,function(e,t){if(!t.type.allowsMarkType(r.mark.type)){return e}return e.mark(r.mark.addToSet(e.marks))},o),i.openStart,i.openEnd);return g.fromReplace(t,this.from,this.to,s)};t.prototype.invert=function e(){return new F(this.from,this.to,this.mark)};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);if(n.deleted&&i.deleted||n.pos>=i.pos){return null}return new t(n.pos,i.pos,this.mark)};t.prototype.merge=function e(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from){return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)}};t.prototype.toJSON=function e(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}};t.fromJSON=function e(r,n){if(typeof n.from!="number"||typeof n.to!="number"){throw new RangeError("Invalid input for AddMarkStep.fromJSON")}return new t(n.from,n.to,r.markFromJSON(n.mark))};return t}(v);v.jsonID("addMark",R);var F=function(e){function t(t,r,n){e.call(this);this.from=t;this.to=r;this.mark=n}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.apply=function e(t){var r=this;var i=t.slice(this.from,this.to);var a=new n.Slice(D(i.content,function(e){return e.mark(r.mark.removeFromSet(e.marks))}),i.openStart,i.openEnd);return g.fromReplace(t,this.from,this.to,a)};t.prototype.invert=function e(){return new R(this.from,this.to,this.mark)};t.prototype.map=function e(r){var n=r.mapResult(this.from,1),i=r.mapResult(this.to,-1);if(n.deleted&&i.deleted||n.pos>=i.pos){return null}return new t(n.pos,i.pos,this.mark)};t.prototype.merge=function e(r){if(r instanceof t&&r.mark.eq(this.mark)&&this.from<=r.to&&this.to>=r.from){return new t(Math.min(this.from,r.from),Math.max(this.to,r.to),this.mark)}};t.prototype.toJSON=function e(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}};t.fromJSON=function e(r,n){if(typeof n.from!="number"||typeof n.to!="number"){throw new RangeError("Invalid input for RemoveMarkStep.fromJSON")}return new t(n.from,n.to,r.markFromJSON(n.mark))};return t}(v);v.jsonID("removeMark",F);f.prototype.addMark=function(e,t,r){var n=this;var i=[],a=[],o=null,s=null;this.doc.nodesBetween(e,t,function(n,u,c){if(!n.isInline){return}var l=n.marks;if(!r.isInSet(l)&&c.type.allowsMarkType(r.type)){var p=Math.max(u,e),d=Math.min(u+n.nodeSize,t);var f=r.addToSet(l);for(var h=0;h<l.length;h++){if(!l[h].isInSet(f)){if(o&&o.to==p&&o.mark.eq(l[h])){o.to=d}else{i.push(o=new F(p,d,l[h]))}}}if(s&&s.to==p){s.to=d}else{a.push(s=new R(p,d,r))}}});i.forEach(function(e){return n.step(e)});a.forEach(function(e){return n.step(e)});return this};f.prototype.removeMark=function(e,t,r){var i=this;if(r===void 0)r=null;var a=[],o=0;this.doc.nodesBetween(e,t,function(i,s){if(!i.isInline){return}o++;var u=null;if(r instanceof n.MarkType){var c=r.isInSet(i.marks);if(c){u=[c]}}else if(r){if(r.isInSet(i.marks)){u=[r]}}else{u=i.marks}if(u&&u.length){var l=Math.min(s+i.nodeSize,t);for(var p=0;p<u.length;p++){var d=u[p],f=void 0;for(var h=0;h<a.length;h++){var y=a[h];if(y.step==o-1&&d.eq(a[h].style)){f=y}}if(f){f.to=l;f.step=o}else{a.push({style:d,from:Math.max(s,e),to:l,step:o})}}}});a.forEach(function(e){return i.step(new F(e.from,e.to,e.style))});return this};f.prototype.clearIncompatible=function(e,t,r){if(r===void 0)r=t.contentMatch;var i=this.doc.nodeAt(e);var a=[],o=e+1;for(var s=0;s<i.childCount;s++){var u=i.child(s),c=o+u.nodeSize;var l=r.matchType(u.type,u.attrs);if(!l){a.push(new b(o,c,n.Slice.empty))}else{r=l;for(var p=0;p<u.marks.length;p++){if(!t.allowsMarkType(u.marks[p].type)){this.step(new F(o,c,u.marks[p]))}}}o=c}if(!r.validEnd){var d=r.fillBefore(n.Fragment.empty,true);this.replace(o,o,new n.Slice(d,0,0))}for(var f=a.length-1;f>=0;f--){this.step(a[f])}return this};function q(e,t,r,i){if(r===void 0)r=t;if(i===void 0)i=n.Slice.empty;if(t==r&&!i.size){return null}var a=e.resolve(t),o=e.resolve(r);if(B(a,o,i)){return new b(t,r,i)}return new V(a,o,i).fit()}f.prototype.replace=function(e,t,r){if(t===void 0)t=e;if(r===void 0)r=n.Slice.empty;var i=q(this.doc,e,t,r);if(i){this.step(i)}return this};f.prototype.replaceWith=function(e,t,r){return this.replace(e,t,new n.Slice(n.Fragment.from(r),0,0))};f.prototype.delete=function(e,t){return this.replace(e,t,n.Slice.empty)};f.prototype.insert=function(e,t){return this.replaceWith(e,e,t)};function B(e,t,r){return!r.openStart&&!r.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),r.content)}var V=function e(t,r,i){this.$to=r;this.$from=t;this.unplaced=i;this.frontier=[];for(var a=0;a<=t.depth;a++){var o=t.node(a);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(a))})}this.placed=n.Fragment.empty;for(var s=t.depth;s>0;s--){this.placed=n.Fragment.from(t.node(s).copy(this.placed))}};var z={depth:{configurable:true}};z.depth.get=function(){return this.frontier.length-1};V.prototype.fit=function e(){while(this.unplaced.size){var e=this.findFittable();if(e){this.placeNodes(e)}else{this.openMore()||this.dropNode()}}var t=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth;var i=this.$from,a=t<0?this.$to:i.doc.resolve(t);if(this.close(a)){var o=this.placed,s=i.depth,u=a.depth;while(s&&u&&o.childCount==1){o=o.firstChild.content;s--;u--}var c=new n.Slice(o,s,u);if(t>-1){return new x(i.pos,t,this.$to.pos,this.$to.end(),c,r)}if(c.size||i.pos!=this.$to.pos){return new b(i.pos,a.pos,c)}}return null};V.prototype.findFittable=function e(){for(var t=1;t<=2;t++){for(var r=this.unplaced.openStart;r>=0;r--){var i=void 0,a=void 0;if(r){a=G(this.unplaced.content,r-1).firstChild;i=a.content}else{i=this.unplaced.content}var o=i.firstChild;for(var s=this.depth;s>=0;s--){var u=this.frontier[s];var c=u.type;var l=u.match;var p=void 0,d=void 0;if(t==1&&(o?l.matchType(o.type)||(d=l.fillBefore(n.Fragment.from(o),false)):c.compatibleContent(a.type))){return{sliceDepth:r,frontierDepth:s,parent:a,inject:d}}else if(t==2&&o&&(p=l.findWrapping(o.type))){return{sliceDepth:r,frontierDepth:s,parent:a,wrap:p}}if(a&&l.matchType(a.type)){break}}}}};V.prototype.openMore=function e(){var t=this.unplaced;var r=t.content;var i=t.openStart;var a=t.openEnd;var o=G(r,i);if(!o.childCount||o.firstChild.isLeaf){return false}this.unplaced=new n.Slice(r,i+1,Math.max(a,o.size+i>=r.size-a?i+1:0));return true};V.prototype.dropNode=function e(){var t=this.unplaced;var r=t.content;var i=t.openStart;var a=t.openEnd;var o=G(r,i);if(o.childCount<=1&&i>0){var s=r.size-i<=i+o.size;this.unplaced=new n.Slice(j(r,i-1,1),i-1,s?i-1:a)}else{this.unplaced=new n.Slice(j(r,i,1),i,a)}};V.prototype.placeNodes=function e(t){var r=t.sliceDepth;var i=t.frontierDepth;var a=t.parent;var o=t.inject;var s=t.wrap;while(this.depth>i){this.closeFrontierNode()}if(s){for(var u=0;u<s.length;u++){this.openFrontierNode(s[u])}}var c=this.unplaced,l=a?a.content:c.content;var p=c.openStart-r;var d=0,f=[];var h=this.frontier[i];var y=h.match;var m=h.type;if(o){for(var v=0;v<o.childCount;v++){f.push(o.child(v))}y=y.matchFragment(o)}var g=l.size+r-(c.content.size-c.openEnd);while(d<l.childCount){var b=l.child(d),x=y.matchType(b.type);if(!x){break}d++;if(d>1||p==0||b.content.size){y=x;f.push(W(b.mark(m.allowedMarks(b.marks)),d==1?p:0,d==l.childCount?g:-1))}}var S=d==l.childCount;if(!S){g=-1}if(S&&g<0&&a&&a.type==this.frontier[this.depth].type){this.closeFrontierNode()}else{this.frontier[i].match=y}for(var T=0,w=l;T<g;T++){var _=w.lastChild;this.frontier.push({type:_.type,match:_.contentMatchAt(_.childCount)});w=_.content}this.unplaced=!S?new n.Slice(j(c.content,r,d),c.openStart,c.openEnd):r==0?n.Slice.empty:new n.Slice(j(c.content,r-1,1),r-1,g<0?c.openEnd:r-1);this.placed=U(this.placed,i,n.Fragment.from(f))};V.prototype.mustMoveInline=function e(){if(!this.$to.parent.isTextblock){return-1}var t=this.frontier[this.depth],r;if(!t.type.isTextblock||!K(this.$to,this.$to.depth,t.type,t.match,false)||this.$to.depth==this.depth&&(r=this.findCloseLevel(this.$to))&&r.depth==this.depth){return-1}var n=this.$to;var i=n.depth;var a=this.$to.after(i);while(i>1&&a==this.$to.end(--i)){++a}return a};V.prototype.findCloseLevel=function e(t){e:for(var r=Math.min(this.depth,t.depth);r>=0;r--){var n=this.frontier[r];var i=n.match;var a=n.type;var o=K(t,r,a,i,false);if(!o){continue}for(var s=r-1;s>=0;s--){var u=this.frontier[s];var c=u.match;var l=u.type;var p=K(t,s,l,c,true);if(!p||p.childCount){continue e}}return{depth:r,fit:o}}};V.prototype.close=function e(t){var e=this.findCloseLevel(t);if(!e){return false}while(this.depth>e.depth){this.closeFrontierNode()}if(e.fit.childCount){this.placed=U(this.placed,e.depth,e.fit)}for(var r=e.depth+1;r<=t.depth;r++){var n=t.node(r),i=n.type.contentMatch.fillBefore(n.content,true,t.index(r));this.openFrontierNode(n.type,n.attrs,i)}return true};V.prototype.openFrontierNode=function e(t,r,i){var a=this.frontier[this.depth];a.match=a.match.matchType(t);this.placed=U(this.placed,this.depth,n.Fragment.from(t.create(r,i)));this.frontier.push({type:t,match:t.contentMatch})};V.prototype.closeFrontierNode=function e(){var t=this.frontier.pop();var r=t.match.fillBefore(n.Fragment.empty,true);if(r.childCount){this.placed=U(this.placed,this.frontier.length,r)}};Object.defineProperties(V.prototype,z);function j(e,t,r){if(t==0){return e.cutByIndex(r)}return e.replaceChild(0,e.firstChild.copy(j(e.firstChild.content,t-1,r)))}function U(e,t,r){if(t==0){return e.append(r)}return e.replaceChild(e.childCount-1,e.lastChild.copy(U(e.lastChild.content,t-1,r)))}function G(e,t){for(var r=0;r<t;r++){e=e.firstChild.content}return e}function W(e,t,r){if(t<=0){return e}var i=e.content;if(t>1){i=i.replaceChild(0,W(i.firstChild,t-1,i.childCount==1?r-1:0))}if(t>0){i=e.type.contentMatch.fillBefore(i).append(i);if(r<=0){i=i.append(e.type.contentMatch.matchFragment(i).fillBefore(n.Fragment.empty,true))}}return e.copy(i)}function K(e,t,r,n,i){var a=e.node(t),o=i?e.indexAfter(t):e.index(t);if(o==a.childCount&&!r.compatibleContent(a.type)){return null}var s=n.fillBefore(a.content,true,o);return s&&!H(r,a.content,o)?s:null}function H(e,t,r){for(var n=r;n<t.childCount;n++){if(!e.allowsMarks(t.child(n).marks)){return true}}return false}f.prototype.replaceRange=function(e,t,r){if(!r.size){return this.deleteRange(e,t)}var i=this.doc.resolve(e),a=this.doc.resolve(t);if(B(i,a,r)){return this.step(new b(e,t,r))}var o=Y(i,this.doc.resolve(t));if(o[o.length-1]==0){o.pop()}var s=-(i.depth+1);o.unshift(s);for(var u=i.depth,c=i.pos-1;u>0;u--,c--){var l=i.node(u).type.spec;if(l.defining||l.isolating){break}if(o.indexOf(u)>-1){s=u}else if(i.before(u)==c){o.splice(1,0,-u)}}var p=o.indexOf(s);var d=[],f=r.openStart;for(var h=r.content,y=0;;y++){var m=h.firstChild;d.push(m);if(y==r.openStart){break}h=m.content}if(f>0&&d[f-1].type.spec.defining&&i.node(p).type!=d[f-1].type){f-=1}else if(f>=2&&d[f-1].isTextblock&&d[f-2].type.spec.defining&&i.node(p).type!=d[f-2].type){f-=2}for(var v=r.openStart;v>=0;v--){var g=(v+f+1)%(r.openStart+1);var x=d[g];if(!x){continue}for(var S=0;S<o.length;S++){var T=o[(S+p)%o.length],w=true;if(T<0){w=false;T=-T}var _=i.node(T-1),I=i.index(T-1);if(_.canReplaceWith(I,I,x.type,x.marks)){return this.replace(i.before(T),w?a.after(T):t,new n.Slice(J(r.content,0,r.openStart,g),g,r.openEnd))}}}var E=this.steps.length;for(var C=o.length-1;C>=0;C--){this.replace(e,t,r);if(this.steps.length>E){break}var M=o[C];if(C<0){continue}e=i.before(M);t=a.after(M)}return this};function J(e,t,r,i,a){if(t<r){var o=e.firstChild;e=e.replaceChild(0,o.copy(J(o.content,t+1,r,i,o)))}if(t>i){var s=a.contentMatchAt(0);var u=s.fillBefore(e).append(e);e=u.append(s.matchFragment(u).fillBefore(n.Fragment.empty,true))}return e}f.prototype.replaceRangeWith=function(e,t,r){if(!r.isInline&&e==t&&this.doc.resolve(e).parent.content.size){var i=N(this.doc,e,r.type);if(i!=null){e=t=i}}return this.replaceRange(e,t,new n.Slice(n.Fragment.from(r),0,0))};f.prototype.deleteRange=function(e,t){var r=this.doc.resolve(e),n=this.doc.resolve(t);var i=Y(r,n);for(var a=0;a<i.length;a++){var o=i[a],s=a==i.length-1;if(s&&o==0||r.node(o).type.contentMatch.validEnd){return this.delete(r.start(o),n.end(o))}if(o>0&&(s||r.node(o-1).canReplace(r.index(o-1),n.indexAfter(o-1)))){return this.delete(r.before(o),n.after(o))}}for(var u=1;u<=r.depth&&u<=n.depth;u++){if(e-r.start(u)==r.depth-u&&t>r.end(u)&&n.end(u)-t!=n.depth-u){return this.delete(r.before(u),t)}}return this.delete(e,t)};function Y(e,t){var r=[],n=Math.min(e.depth,t.depth);for(var i=n;i>=0;i--){var a=e.start(i);if(a<e.pos-(e.depth-i)||t.end(i)>t.pos+(t.depth-i)||e.node(i).type.spec.isolating||t.node(i).type.spec.isolating){break}if(a==t.start(i)){r.push(i)}}return r}t.AddMarkStep=R;t.MapResult=c;t.Mapping=p;t.RemoveMarkStep=F;t.ReplaceAroundStep=x;t.ReplaceStep=b;t.Step=v;t.StepMap=l;t.StepResult=g;t.Transform=f;t.TransformError=d;t.canJoin=P;t.canSplit=k;t.dropPoint=A;t.findWrapping=_;t.insertPoint=N;t.joinPoint=L;t.liftTarget=w;t.replaceStep=q});define("prosemirror-transform",["prosemirror-transform/index"],function(e){return e});define("prosemirror-schema-list/index",["require","exports","module","prosemirror-transform","prosemirror-model"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=e("prosemirror-transform");var i=e("prosemirror-model");var a=["ol",0],o=["ul",0],s=["li",0];var u={attrs:{order:{default:1}},parseDOM:[{tag:"ol",getAttrs:function e(t){return{order:t.hasAttribute("start")?+t.getAttribute("start"):1}}}],toDOM:function e(t){return t.attrs.order==1?a:["ol",{start:t.attrs.order},0]}};var c={parseDOM:[{tag:"ul"}],toDOM:function e(){return o}};var l={parseDOM:[{tag:"li"}],toDOM:function e(){return s},defining:true};function p(e,t){var r={};for(var n in e){r[n]=e[n]}for(var i in t){r[i]=t[i]}return r}function d(e,t,r){return e.append({ordered_list:p(u,{content:"list_item+",group:r}),bullet_list:p(c,{content:"list_item+",group:r}),list_item:p(l,{content:t})})}function f(e,t){return function(r,a){var o=r.selection;var s=o.$from;var u=o.$to;var c=s.blockRange(u),l=false,p=c;if(!c){return false}if(c.depth>=2&&s.node(c.depth-1).type.compatibleContent(e)&&c.startIndex==0){if(s.index(c.depth-1)==0){return false}var d=r.doc.resolve(c.start-2);p=new i.NodeRange(d,d,c.depth);if(c.endIndex<c.parent.childCount){c=new i.NodeRange(s,r.doc.resolve(u.end(c.depth)),c.depth)}l=true}var f=n.findWrapping(p,e,t,c);if(!f){return false}if(a){a(h(r.tr,c,f,l,e).scrollIntoView())}return true}}function h(e,t,r,a,o){var s=i.Fragment.empty;for(var u=r.length-1;u>=0;u--){s=i.Fragment.from(r[u].type.create(r[u].attrs,s))}e.step(new n.ReplaceAroundStep(t.start-(a?2:0),t.end,t.start,t.end,new i.Slice(s,0,0),r.length,true));var c=0;for(var l=0;l<r.length;l++){if(r[l].type==o){c=l+1}}var p=r.length-c;var d=t.start+r.length-(a?2:0),f=t.parent;for(var h=t.startIndex,y=t.endIndex,m=true;h<y;h++,m=false){if(!m&&n.canSplit(e.doc,d,p)){e.split(d,p);d+=2*p}d+=f.child(h).nodeSize}return e}function y(e){return function(t,r){var a=t.selection;var o=a.$from;var s=a.$to;var u=a.node;if(u&&u.isBlock||o.depth<2||!o.sameParent(s)){return false}var c=o.node(-1);if(c.type!=e){return false}if(o.parent.content.size==0){if(o.depth==2||o.node(-3).type!=e||o.index(-2)!=o.node(-2).childCount-1){return false}if(r){var l=i.Fragment.empty,p=o.index(-1)>0;for(var d=o.depth-(p?1:2);d>=o.depth-3;d--){l=i.Fragment.from(o.node(d).copy(l))}l=l.append(i.Fragment.from(e.createAndFill()));var f=t.tr.replace(o.before(p?null:-1),o.after(-3),new i.Slice(l,p?3:2,2));f.setSelection(t.selection.constructor.near(f.doc.resolve(o.pos+(p?3:2))));r(f.scrollIntoView())}return true}var h=s.pos==o.end()?c.contentMatchAt(0).defaultType:null;var y=t.tr.delete(o.pos,s.pos);var m=h&&[null,{type:h}];if(!n.canSplit(y.doc,o.pos,2,m)){return false}if(r){r(y.split(o.pos,2,m).scrollIntoView())}return true}}function m(e){return function(t,r){var n=t.selection;var i=n.$from;var a=n.$to;var o=i.blockRange(a,function(t){return t.childCount&&t.firstChild.type==e});if(!o){return false}if(!r){return true}if(i.node(o.depth-1).type==e){return v(t,r,e,o)}else{return g(t,r,o)}}}function v(e,t,r,a){var o=e.tr,s=a.end,u=a.$to.end(a.depth);if(s<u){o.step(new n.ReplaceAroundStep(s-1,u,s,u,new i.Slice(i.Fragment.from(r.create(null,a.parent.copy())),1,0),1,true));a=new i.NodeRange(o.doc.resolve(a.$from.pos),o.doc.resolve(u),a.depth)}t(o.lift(a,n.liftTarget(a)).scrollIntoView());return true}function g(e,t,r){var a=e.tr,o=r.parent;for(var s=r.end,u=r.endIndex-1,c=r.startIndex;u>c;u--){s-=o.child(u).nodeSize;a.delete(s-1,s+1)}var l=a.doc.resolve(r.start),p=l.nodeAfter;var d=r.startIndex==0,f=r.endIndex==o.childCount;var h=l.node(-1),y=l.index(-1);if(!h.canReplace(y+(d?0:1),y+1,p.content.append(f?i.Fragment.empty:i.Fragment.from(o)))){return false}var m=l.pos,v=m+p.nodeSize;a.step(new n.ReplaceAroundStep(m-(d?1:0),v+(f?1:0),m+1,v-1,new i.Slice((d?i.Fragment.empty:i.Fragment.from(o.copy(i.Fragment.empty))).append(f?i.Fragment.empty:i.Fragment.from(o.copy(i.Fragment.empty))),d?0:1,f?0:1),d?0:1));t(a.scrollIntoView());return true}function b(e){return function(t,r){var a=t.selection;var o=a.$from;var s=a.$to;var u=o.blockRange(s,function(t){return t.childCount&&t.firstChild.type==e});if(!u){return false}var c=u.startIndex;if(c==0){return false}var l=u.parent,p=l.child(c-1);if(p.type!=e){return false}if(r){var d=p.lastChild&&p.lastChild.type==l.type;var f=i.Fragment.from(d?e.create():null);var h=new i.Slice(i.Fragment.from(e.create(null,i.Fragment.from(l.type.create(null,f)))),d?3:1,0);var y=u.start,m=u.end;r(t.tr.step(new n.ReplaceAroundStep(y-(d?3:1),m,y,m,h,1,true)).scrollIntoView())}return true}}t.addListNodes=d;t.bulletList=c;t.liftListItem=m;t.listItem=l;t.orderedList=u;t.sinkListItem=b;t.splitListItem=y;t.wrapInList=f});define("prosemirror-schema-list",["prosemirror-schema-list/index"],function(e){return e});define("core/prosemirror/underline-mark-spec",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.underline=void 0;t.underline={parseDOM:[{tag:"u"},{style:"text-decoration=underline"}],toDOM:function(){return["u",0]}}});define("core/prosemirror/color-mark-spec",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.color=t.DEFAULT_PM_COLOR=void 0;t.DEFAULT_PM_COLOR="#000000";t.color={attrs:{hex:{default:t.DEFAULT_PM_COLOR}},parseDOM:[{tag:"span",style:"color",getAttrs:function(e){var t=e.style.color;if(t==="rgb(0, 0, 0)")return false;return{hex:t}}}],toDOM:function(e){return["span",{class:"color-node",style:"color:"+e.attrs.hex},0]}}});define("core/lib/rich-text",["require","exports","orderedmap","prosemirror-model","prosemirror-schema-basic","../prosemirror/link-mark-spec","../prosemirror/mq-schema","../prosemirror/interp-node-spec","prosemirror-schema-list","../prosemirror/underline-mark-spec","../prosemirror/color-mark-spec"],function(e,t,r,n,i,a,o,s,u,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.schemas=void 0;var p=["doc","paragraph","text","heading","mq","interp","image","list","link","em","strong","underline","color"];function d(e,t){var p={doc:e};var d={};for(var f=0,h=t;f<h.length;f++){var y=h[f];switch(y){case"paragraph":case"text":case"heading":case"image":p[y]=i.nodes[y];break;case"mq":p[y]=o.mqSpec;break;case"interp":p[y]=s.interpSpec;break;case"em":case"strong":d[y]=i.marks[y];break;case"underline":d[y]=c.underline;break;case"color":d[y]=l.color;break;case"link":d[y]=a.link;break}}var m=r.from(p);if(t.indexOf("list")!==-1){m=u.addListNodes(m,"paragraph block*","block")}var v;if(Object.keys(d).length!==0){v=r.from(d)}return new n.Schema({nodes:m,marks:v})}t.schemas={document:{schema:d(i.nodes.doc,p),version:3},lesson:{schema:d(i.nodes.doc,["paragraph","text","heading","mq","image","list","link","em","strong"]),version:1},section:{schema:d(i.nodes.doc,["paragraph","text","mq","link","em","strong"]),version:1},heading:{schema:d({content:"heading"},["heading","text","mq","link","em","strong"]),version:1}}});define("core/lib/rich-text-helpers",["require","exports","tslib","../prosemirror/prosemirror-serialize","prosemirror-model","./rich-text","./log","./assert-unreachable"],function(e,t,r,n,i,a,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.sliceParagraphs=t.richTextFromLatex=t.richTextFromText=t.richTextFromNode=t.getSchemaFromRichText=t.getNodeFromRichText=t.updateRichTextVersion=void 0;function u(e){var t=a.schemas[e.schemaKey];if(e.version===t.version)return e;if(e.version>t.version){throw new Error("Loading rich text with version "+e.version+" but last known version is "+t.version+".")}var r=i.Node.fromJSON(t.schema,e.content);return p(e.schemaKey,r)}t.updateRichTextVersion=u;function c(e){return i.Node.fromJSON(l(e),e.content)}t.getNodeFromRichText=c;function l(e){return a.schemas[e.schemaKey].schema}t.getSchemaFromRichText=l;function p(e,t){return{schemaKey:e,version:a.schemas[e].version,content:t.toJSON()}}t.richTextFromNode=p;function d(e,t){var r=a.schemas[e].schema;var i;var o=e;switch(o){case"heading":i=r.nodes["heading"];break;case"document":case"section":case"lesson":i=r.nodes["paragraph"];break;default:s.assertUnreachable(o)}var u=t.trim().split("\n").map(function(e){return i.create(undefined,n.stringToNodes(e,r))});var c=r.nodes[r.spec.topNode||"doc"].create(undefined,u);return{schemaKey:e,version:a.schemas[e].version,content:c.toJSON()}}t.richTextFromText=d;function f(e){var t=e.length>0?[{type:"text",text:e}]:[];return{schemaKey:"document",version:1,content:{type:"doc",content:[{type:"mq",content:t}]}}}t.richTextFromLatex=f;function h(e,t,n){if(e.content.type!=="doc"){o.warn("RichTextParseError","Expected RichText<document> root to be of type 'doc', but found "+e.content.type+" instead");return e}var i=e.content.content||[];return r.__assign(r.__assign({},e),{content:r.__assign(r.__assign({},e.content),{content:i.slice(t,n)})})}t.sliceParagraphs=h});define("prosemirror-state/index",["require","exports","module","prosemirror-model","prosemirror-transform"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=e("prosemirror-model");var i=e("prosemirror-transform");var a=Object.create(null);var o=function e(t,r,n){this.ranges=n||[new u(t.min(r),t.max(r))];this.$anchor=t;this.$head=r};var s={anchor:{configurable:true},head:{configurable:true},from:{configurable:true},to:{configurable:true},$from:{configurable:true},$to:{configurable:true},empty:{configurable:true}};s.anchor.get=function(){return this.$anchor.pos};s.head.get=function(){return this.$head.pos};s.from.get=function(){return this.$from.pos};s.to.get=function(){return this.$to.pos};s.$from.get=function(){return this.ranges[0].$from};s.$to.get=function(){return this.ranges[0].$to};s.empty.get=function(){var e=this.ranges;for(var t=0;t<e.length;t++){if(e[t].$from.pos!=e[t].$to.pos){return false}}return true};o.prototype.content=function e(){return this.$from.node(0).slice(this.from,this.to,true)};o.prototype.replace=function e(t,r){if(r===void 0)r=n.Slice.empty;var i=r.content.lastChild,a=null;for(var o=0;o<r.openEnd;o++){a=i;i=i.lastChild}var s=t.steps.length,u=this.ranges;for(var c=0;c<u.length;c++){var l=u[c];var p=l.$from;var d=l.$to;var f=t.mapping.slice(s);t.replaceRange(f.map(p.pos),f.map(d.pos),c?n.Slice.empty:r);if(c==0){m(t,s,(i?i.isInline:a&&a.isTextblock)?-1:1)}}};o.prototype.replaceWith=function e(t,r){var n=t.steps.length,i=this.ranges;for(var a=0;a<i.length;a++){var o=i[a];var s=o.$from;var u=o.$to;var c=t.mapping.slice(n);var l=c.map(s.pos),p=c.map(u.pos);if(a){t.deleteRange(l,p)}else{t.replaceRangeWith(l,p,r);m(t,n,r.isInline?-1:1)}}};o.findFrom=function e(t,r,n){var i=t.parent.inlineContent?new c(t):y(t.node(0),t.parent,t.pos,t.index(),r,n);if(i){return i}for(var a=t.depth-1;a>=0;a--){var o=r<0?y(t.node(0),t.node(a),t.before(a+1),t.index(a),r,n):y(t.node(0),t.node(a),t.after(a+1),t.index(a)+1,r,n);if(o){return o}}};o.near=function e(t,r){if(r===void 0)r=1;return this.findFrom(t,r)||this.findFrom(t,-r)||new f(t.node(0))};o.atStart=function e(t){return y(t,t,0,0,1)||new f(t)};o.atEnd=function e(t){return y(t,t,t.content.size,t.childCount,-1)||new f(t)};o.fromJSON=function e(t,r){if(!r||!r.type){throw new RangeError("Invalid input for Selection.fromJSON")}var n=a[r.type];if(!n){throw new RangeError("No selection type "+r.type+" defined")}return n.fromJSON(t,r)};o.jsonID=function e(t,r){if(t in a){throw new RangeError("Duplicate use of selection JSON ID "+t)}a[t]=r;r.prototype.jsonID=t;return r};o.prototype.getBookmark=function e(){return c.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(o.prototype,s);o.prototype.visible=true;var u=function e(t,r){this.$from=t;this.$to=r};var c=function(e){function t(t,r){if(r===void 0)r=t;e.call(this,t,r)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={$cursor:{configurable:true}};r.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null};t.prototype.map=function r(n,i){var a=n.resolve(i.map(this.head));if(!a.parent.inlineContent){return e.near(a)}var o=n.resolve(i.map(this.anchor));return new t(o.parent.inlineContent?o:a,a)};t.prototype.replace=function t(r,i){if(i===void 0)i=n.Slice.empty;e.prototype.replace.call(this,r,i);if(i==n.Slice.empty){var a=this.$from.marksAcross(this.$to);if(a){r.ensureMarks(a)}}};t.prototype.eq=function e(r){return r instanceof t&&r.anchor==this.anchor&&r.head==this.head};t.prototype.getBookmark=function e(){return new l(this.anchor,this.head)};t.prototype.toJSON=function e(){return{type:"text",anchor:this.anchor,head:this.head}};t.fromJSON=function e(r,n){if(typeof n.anchor!="number"||typeof n.head!="number"){throw new RangeError("Invalid input for TextSelection.fromJSON")}return new t(r.resolve(n.anchor),r.resolve(n.head))};t.create=function e(t,r,n){if(n===void 0)n=r;var i=t.resolve(r);return new this(i,n==r?i:t.resolve(n))};t.between=function r(n,i,a){var o=n.pos-i.pos;if(!a||o){a=o>=0?1:-1}if(!i.parent.inlineContent){var s=e.findFrom(i,a,true)||e.findFrom(i,-a,true);if(s){i=s.$head}else{return e.near(i,a)}}if(!n.parent.inlineContent){if(o==0){n=i}else{n=(e.findFrom(n,-a,true)||e.findFrom(n,a,true)).$anchor;if(n.pos<i.pos!=o<0){n=i}}}return new t(n,i)};Object.defineProperties(t.prototype,r);return t}(o);o.jsonID("text",c);var l=function e(t,r){this.anchor=t;this.head=r};l.prototype.map=function e(t){return new l(t.map(this.anchor),t.map(this.head))};l.prototype.resolve=function e(t){return c.between(t.resolve(this.anchor),t.resolve(this.head))};var p=function(e){function t(t){var r=t.nodeAfter;var n=t.node(0).resolve(t.pos+r.nodeSize);e.call(this,t,n);this.node=r}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.map=function r(n,i){var a=i.mapResult(this.anchor);var o=a.deleted;var s=a.pos;var u=n.resolve(s);if(o){return e.near(u)}return new t(u)};t.prototype.content=function e(){return new n.Slice(n.Fragment.from(this.node),0,0)};t.prototype.eq=function e(r){return r instanceof t&&r.anchor==this.anchor};t.prototype.toJSON=function e(){return{type:"node",anchor:this.anchor}};t.prototype.getBookmark=function e(){return new d(this.anchor)};t.fromJSON=function e(r,n){if(typeof n.anchor!="number"){throw new RangeError("Invalid input for NodeSelection.fromJSON")}return new t(r.resolve(n.anchor))};t.create=function e(t,r){return new this(t.resolve(r))};t.isSelectable=function e(t){return!t.isText&&t.type.spec.selectable!==false};return t}(o);p.prototype.visible=false;o.jsonID("node",p);var d=function e(t){this.anchor=t};d.prototype.map=function e(t){var r=t.mapResult(this.anchor);var n=r.deleted;var i=r.pos;return n?new l(i,i):new d(i)};d.prototype.resolve=function e(t){var r=t.resolve(this.anchor),n=r.nodeAfter;if(n&&p.isSelectable(n)){return new p(r)}return o.near(r)};var f=function(e){function t(t){e.call(this,t.resolve(0),t.resolve(t.content.size))}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;t.prototype.replace=function t(r,i){if(i===void 0)i=n.Slice.empty;if(i==n.Slice.empty){r.delete(0,r.doc.content.size);var a=e.atStart(r.doc);if(!a.eq(r.selection)){r.setSelection(a)}}else{e.prototype.replace.call(this,r,i)}};t.prototype.toJSON=function e(){return{type:"all"}};t.fromJSON=function e(r){return new t(r)};t.prototype.map=function e(r){return new t(r)};t.prototype.eq=function e(r){return r instanceof t};t.prototype.getBookmark=function e(){return h};return t}(o);o.jsonID("all",f);var h={map:function e(){return this},resolve:function e(t){return new f(t)}};function y(e,t,r,n,i,a){if(t.inlineContent){return c.create(e,r)}for(var o=n-(i>0?0:1);i>0?o<t.childCount:o>=0;o+=i){var s=t.child(o);if(!s.isAtom){var u=y(e,s,r+i,i<0?s.childCount:0,i,a);if(u){return u}}else if(!a&&p.isSelectable(s)){return p.create(e,r-(i<0?s.nodeSize:0))}r+=s.nodeSize*i}}function m(e,t,r){var n=e.steps.length-1;if(n<t){return}var a=e.steps[n];if(!(a instanceof i.ReplaceStep||a instanceof i.ReplaceAroundStep)){return}var s=e.mapping.maps[n],u;s.forEach(function(e,t,r,n){if(u==null){u=n}});e.setSelection(o.near(e.doc.resolve(u),r))}var v=1,g=2,b=4;var x=function(e){function t(t){e.call(this,t.doc);this.time=Date.now();this.curSelection=t.selection;this.curSelectionFor=0;this.storedMarks=t.storedMarks;this.updated=0;this.meta=Object.create(null)}if(e)t.__proto__=e;t.prototype=Object.create(e&&e.prototype);t.prototype.constructor=t;var r={selection:{configurable:true},selectionSet:{configurable:true},storedMarksSet:{configurable:true},isGeneric:{configurable:true},scrolledIntoView:{configurable:true}};r.selection.get=function(){if(this.curSelectionFor<this.steps.length){this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor));this.curSelectionFor=this.steps.length}return this.curSelection};t.prototype.setSelection=function e(t){if(t.$from.doc!=this.doc){throw new RangeError("Selection passed to setSelection must point at the current document")}this.curSelection=t;this.curSelectionFor=this.steps.length;this.updated=(this.updated|v)&~g;this.storedMarks=null;return this};r.selectionSet.get=function(){return(this.updated&v)>0};t.prototype.setStoredMarks=function e(t){this.storedMarks=t;this.updated|=g;return this};t.prototype.ensureMarks=function e(t){if(!n.Mark.sameSet(this.storedMarks||this.selection.$from.marks(),t)){this.setStoredMarks(t)}return this};t.prototype.addStoredMark=function e(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))};t.prototype.removeStoredMark=function e(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))};r.storedMarksSet.get=function(){return(this.updated&g)>0};t.prototype.addStep=function t(r,n){e.prototype.addStep.call(this,r,n);this.updated=this.updated&~g;this.storedMarks=null};t.prototype.setTime=function e(t){this.time=t;return this};t.prototype.replaceSelection=function e(t){this.selection.replace(this,t);return this};t.prototype.replaceSelectionWith=function e(t,r){var i=this.selection;if(r!==false){t=t.mark(this.storedMarks||(i.empty?i.$from.marks():i.$from.marksAcross(i.$to)||n.Mark.none))}i.replaceWith(this,t);return this};t.prototype.deleteSelection=function e(){this.selection.replace(this);return this};t.prototype.insertText=function e(t,r,n){if(n===void 0)n=r;var i=this.doc.type.schema;if(r==null){if(!t){return this.deleteSelection()}return this.replaceSelectionWith(i.text(t),true)}else{if(!t){return this.deleteRange(r,n)}var a=this.storedMarks;if(!a){var s=this.doc.resolve(r);a=n==r?s.marks():s.marksAcross(this.doc.resolve(n))}this.replaceRangeWith(r,n,i.text(t,a));if(!this.selection.empty){this.setSelection(o.near(this.selection.$to))}return this}};t.prototype.setMeta=function e(t,r){this.meta[typeof t=="string"?t:t.key]=r;return this};t.prototype.getMeta=function e(t){return this.meta[typeof t=="string"?t:t.key]};r.isGeneric.get=function(){for(var e in this.meta){return false}return true};t.prototype.scrollIntoView=function e(){this.updated|=b;return this};r.scrolledIntoView.get=function(){return(this.updated&b)>0};Object.defineProperties(t.prototype,r);return t}(i.Transform);function S(e,t){return!t||!e?e:e.bind(t)}var T=function e(t,r,n){this.name=t;this.init=S(r.init,n);this.apply=S(r.apply,n)};var w=[new T("doc",{init:function e(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function e(t){return t.doc}}),new T("selection",{init:function e(t,r){return t.selection||o.atStart(r.doc)},apply:function e(t){return t.selection}}),new T("storedMarks",{init:function e(t){return t.storedMarks||null},apply:function e(t,r,n,i){return i.selection.$cursor?t.storedMarks:null}}),new T("scrollToSelection",{init:function e(){return 0},apply:function e(t,r){return t.scrolledIntoView?r+1:r}})];var _=function e(t,r){var n=this;this.schema=t;this.fields=w.concat();this.plugins=[];this.pluginsByKey=Object.create(null);if(r){r.forEach(function(e){if(n.pluginsByKey[e.key]){throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")")}n.plugins.push(e);n.pluginsByKey[e.key]=e;if(e.spec.state){n.fields.push(new T(e.key,e.spec.state,e))}})}};var I=function e(t){this.config=t};var E={schema:{configurable:true},plugins:{configurable:true},tr:{configurable:true}};E.schema.get=function(){return this.config.schema};E.plugins.get=function(){return this.config.plugins};I.prototype.apply=function e(t){return this.applyTransaction(t).state};I.prototype.filterTransaction=function e(t,r){if(r===void 0)r=-1;for(var n=0;n<this.config.plugins.length;n++){if(n!=r){var i=this.config.plugins[n];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,t,this)){return false}}}return true};I.prototype.applyTransaction=function e(t){if(!this.filterTransaction(t)){return{state:this,transactions:[]}}var r=[t],n=this.applyInner(t),i=null;for(;;){var a=false;for(var o=0;o<this.config.plugins.length;o++){var s=this.config.plugins[o];if(s.spec.appendTransaction){var u=i?i[o].n:0,c=i?i[o].state:this;var l=u<r.length&&s.spec.appendTransaction.call(s,u?r.slice(u):r,c,n);if(l&&n.filterTransaction(l,o)){l.setMeta("appendedTransaction",t);if(!i){i=[];for(var p=0;p<this.config.plugins.length;p++){i.push(p<o?{state:n,n:r.length}:{state:this,n:0})}}r.push(l);n=n.applyInner(l);a=true}if(i){i[o]={state:n,n:r.length}}}}if(!a){return{state:n,transactions:r}}}};I.prototype.applyInner=function e(t){if(!t.before.eq(this.doc)){throw new RangeError("Applying a mismatched transaction")}var r=new I(this.config),n=this.config.fields;for(var i=0;i<n.length;i++){var a=n[i];r[a.name]=a.apply(t,this[a.name],this,r)}for(var o=0;o<C.length;o++){C[o](this,t,r)}return r};E.tr.get=function(){return new x(this)};I.create=function e(t){var r=new _(t.schema||t.doc.type.schema,t.plugins);var n=new I(r);for(var i=0;i<r.fields.length;i++){n[r.fields[i].name]=r.fields[i].init(t,n)}return n};I.prototype.reconfigure=function e(t){var r=new _(t.schema||this.schema,t.plugins);var n=r.fields,i=new I(r);for(var a=0;a<n.length;a++){var o=n[a].name;i[o]=this.hasOwnProperty(o)?this[o]:n[a].init(t,i)}return i};I.prototype.toJSON=function e(t){var r={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks){r.storedMarks=this.storedMarks.map(function(e){return e.toJSON()})}if(t&&typeof t=="object"){for(var n in t){if(n=="doc"||n=="selection"){throw new RangeError("The JSON fields `doc` and `selection` are reserved")}var i=t[n],a=i.spec.state;if(a&&a.toJSON){r[n]=a.toJSON.call(i,this[i.key])}}}return r};I.fromJSON=function e(t,r,i){if(!r){throw new RangeError("Invalid input for EditorState.fromJSON")}if(!t.schema){throw new RangeError("Required config field 'schema' missing")}var a=new _(t.schema,t.plugins);var s=new I(a);a.fields.forEach(function(e){if(e.name=="doc"){s.doc=n.Node.fromJSON(t.schema,r.doc)}else if(e.name=="selection"){s.selection=o.fromJSON(s.doc,r.selection)}else if(e.name=="storedMarks"){if(r.storedMarks){s.storedMarks=r.storedMarks.map(t.schema.markFromJSON)}}else{if(i){for(var a in i){var u=i[a],c=u.spec.state;if(u.key==e.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(r,a)){s[e.name]=c.fromJSON.call(u,t,r[a],s);return}}}s[e.name]=e.init(t,s)}});return s};I.addApplyListener=function e(t){C.push(t)};I.removeApplyListener=function e(t){var r=C.indexOf(t);if(r>-1){C.splice(r,1)}};Object.defineProperties(I.prototype,E);var C=[];function M(e,t,r){for(var n in e){var i=e[n];if(i instanceof Function){i=i.bind(t)}else if(n=="handleDOMEvents"){i=M(i,t,{})}r[n]=i}return r}var k=function e(t){this.props={};if(t.props){M(t.props,this,this.props)}this.spec=t;this.key=t.key?t.key.key:O("plugin")};k.prototype.getState=function e(t){return t[this.key]};var P=Object.create(null);function O(e){if(e in P){return e+"$"+ ++P[e]}P[e]=0;return e+"$"}var L=function e(t){if(t===void 0)t="key";this.key=O(t)};L.prototype.get=function e(t){return t.config.pluginsByKey[this.key]};L.prototype.getState=function e(t){return t[this.key]};t.AllSelection=f;t.EditorState=I;t.NodeSelection=p;t.Plugin=k;t.PluginKey=L;t.Selection=o;t.SelectionRange=u;t.TextSelection=c;t.Transaction=x});define("prosemirror-state",["prosemirror-state/index"],function(e){return e});define("core/prosemirror/prosemirror-interpolation",["require","exports","prosemirror-model","core/computation-layer/helpers","core/computation-layer/library/builtin","prosemirror-state","./prosemirror-serialize","./mq-schema","core/lib/rich-text"],function(e,t,r,n,i,a,o,s,u){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.interpolateSerializedDoc=t.makeNewInterpolationState=t.getCLValueMap=t.createInterpMap=void 0;function c(e){var t={};e.descendants(function(e,r,n){if(e.type.name==="interp"){if(t[r]){throw new Error("Attempted to record a unique interpolation node at position "+r+" when one already exists.")}t[r]={from:r,to:r+e.nodeSize,interpExpr:e.attrs.interpExpr,block:{type:n.type.name,attrs:n.attrs},marks:e.marks}}});return t}t.createInterpMap=c;function l(e,t,r){var n={};for(var i in e){var a=e[i].interpExpr;if(!n[a]){n[a]=p(t,r,a)}}return n}t.getCLValueMap=l;function p(e,t,r){var a=e.getNodeFromVariable(t,r);if(a===undefined||a.value===undefined)return;var o=a.analysis.valueType.type;switch(o){case"string":return n.synthesizeStringForContent(a.value);case"number":return a.value.toString();case"latex":return n.synthesizeStringForContent(i.castLatexToString(a.value));default:return}}function d(e,t,n){var i={};var a=e.tr;var u=function(u){var c=a.mapping.map(t[u].from);var l=a.mapping.map(t[u].to);var p=t[u],d=p.interpExpr,f=p.block,h=p.marks;var y=n[d];if(!y){y=" "}var m=y.split("\n");var v=[];var g=0;var b=o.stringToNodes(m[0],e.schema,s.mqSchema);v.push.apply(v,b);g+=r.Fragment.fromArray(b).size;var x=void 0;if(m.length===2){x=e.schema.nodes[f.type].create();v.push(x)}else if(m.length>2){var S=m.slice(1,-1).join("\n");var T=o.stringToBlockNodes(S,e.schema,s.mqSchema,f);v.push.apply(v,T);g+=r.Fragment.fromArray(T).size}if(m.length>1){var w=o.stringToNodes(m[m.length-1],e.schema,s.mqSchema);v.push.apply(v,w);g+=r.Fragment.fromArray(w).size+2}a=a.replaceWith(c,l,v);if(x){var _=c+r.Fragment.fromArray(b).size;a=a.deleteRange(_,_+x.nodeSize)}l=c+g;h.forEach(function(e){a=a.addMark(c,l,e)});a.doc.nodesBetween(c,l,function(e,t){if(e.type.name==="mq"&&e.marks.length>0){h.forEach(function(r){a=a.removeMark(t,t+e.nodeSize,r)})}});var I=a.doc.childBefore(l);if(I.node&&I.node.type.name!==f.type){a=a.setBlockType(I.offset,I.offset+I.node.nodeSize,e.schema.nodes[f.type],f.attrs)}if(i[c]){throw new Error("Attempted to record a unique interpolation node at position "+c+" when one already exists.")}i[c]={from:c,to:l,interpExpr:d,block:f,marks:h}};for(var c in t){u(c)}return{newInterpMap:i,tr:a}}t.makeNewInterpolationState=d;function f(e,t,n){var i=r.Node.fromJSON(u.schemas.document.schema,e);var o=a.EditorState.create({schema:u.schemas.document.schema,doc:i});var s=c(i);var p=l(s,t,n);var f=d(o,s,p).tr;var h=o.apply(f);return h.doc.toJSON()}t.interpolateSerializedDoc=f});define("core/components/shared/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.ASPECT_RATIO=void 0;t.ASPECT_RATIO={FULLSCREEN:1.333,DEFAULT:1}});define("core/lib/deserialize-responses",["require","exports","tslib","underscore","core/lib/calculator-helpers"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.deserializeResponse=void 0;function a(e,t,r){if(t===null||t===undefined){return t}var n;if(typeof t=="string"){try{n=JSON.parse(t)}catch(t){throw new Error('Failed to parse response data as JSON for response key "'+e+'".')}}else{n=t}if(n.calculatorState||n.calculatorStateDiff){return o(e,n,r)}return n}t.deserializeResponse=a;var o=function(e,t,r){var a;if(r.componentExists(e)){a=e}else{var o=n.find(r.getComponentIdsForScreen(e),function(e){var t=r.getComponentAliasById(e);return t=="input/graph"||t=="marbleslides"});if(!o){throw new Error("could not find calculator state component on response "+e)}a=o}var u=r.getSourceData(a).calculatorState;if(!t.calculatorState&&!u){throw new s({id:"CalculatorStateDiffNoConfig",message:"Calculator state diff was found for componentId "+a+", but no config calculator state was found."})}var c=n.omit(t,"calculatorState");c.calculatorState=i.mergeImages(i.getRehydratedCalculatorState(u,t),u);return c};var s=function(e){r.__extends(t,e);function t(t){var r=e.call(this,t.message)||this;r.id=t.id;return r}return t}(Error)});define("core/components/transform/affine",["require","exports","tslib","underscore","core/lib/assert-unreachable"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.objectsCollide=t.isSeparating=t.inside=t.segmentsIntersect=t.getSegments=t.transformsToMatrix=t.transformToMatrix=t.reflectToMatrix=t.scaleToMatrix=t.rotateToMatrix=t.translateToMatrix=t.bound=t.project=t.projection=t.vec=t.dot=t.distance=t.magnitude=t.applyToPoint=t.copy=t.chain=t.mult=t.translate=t.scale=t.rotateOrigin=t.identity=t.invert=t.diff=void 0;var a=function(e,t){var r=0;for(var n=0;n<3;n++){for(var i=0;i<3;i++){r+=Math.abs(e[n][i]-t[n][i])}}return r};t.diff=a;var o=function(e){var r=t.identity();var n=e[2][2]*e[1][1]-e[2][1]*e[1][2];var i=e[2][1]*e[0][2]-e[2][2]*e[0][1];var a=e[1][2]*e[0][1]-e[1][1]*e[0][2];var o=e[0][0]*n+e[1][0]*i+e[2][0]*a;if(o===0){throw new Error("Unexpected degenerate matrix when computing inverse")}var s=1/o;r[0][0]=n*s;r[1][0]=(e[2][0]*e[1][2]-e[2][2]*e[1][0])*s;r[2][0]=(e[2][1]*e[1][0]-e[2][0]*e[1][1])*s;r[0][1]=i*s;r[1][1]=(e[2][2]*e[0][0]-e[2][0]*e[0][2])*s;r[2][1]=(e[2][0]*e[0][1]-e[2][1]*e[0][0])*s;r[0][2]=a*s;r[1][2]=(e[1][0]*e[0][2]-e[1][2]*e[0][0])*s;r[2][2]=(e[1][1]*e[0][0]-e[1][0]*e[0][1])*s;return r};t.invert=o;var s=function(){return[[1,0,0],[0,1,0],[0,0,1]]};t.identity=s;var u=function(e){var t=Math.cos(e);var r=Math.sin(e);return[[t,r,0],[-r,t,0],[0,0,1]]};t.rotateOrigin=u;var c=function(e,t){return[[e,0,0],[0,t,0],[0,0,1]]};t.scale=c;var l=function(e,t){return[[1,0,e],[0,1,t],[0,0,1]]};t.translate=l;var p=function(e,r){var n=t.identity();for(var i=0;i<3;i++){for(var a=0;a<3;a++){var o=0;for(var s=0;s<3;s++){o+=e[i][s]*r[s][a]}n[i][a]=o}}return n};t.mult=p;var d=function(){var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}return n.reduceRight(e,function(e,r){return t.mult(e,r)},t.identity())};t.chain=d;var f=function(e){return r.__assign({},e)};t.copy=f;var h=function(e,t){return{x:e[0][0]*t.x+e[0][1]*t.y+e[0][2]*1,y:e[1][0]*t.x+e[1][1]*t.y+e[1][2]*1}};t.applyToPoint=h;var y=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)};t.magnitude=y;var m=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))};t.distance=m;var v=function(e,t){return e.x*t.x+e.y*t.y};t.dot=v;var g=function(e,t){return{x:t.x-e.x,y:t.y-e.y}};t.vec=g;var b=function(e,r){return t.dot(r,e)/t.dot(r,r)};t.projection=b;var x=function(e,r){var n=t.projection(e,r);return{x:n*r.x,y:n*r.y}};t.project=x;var S=function(e,t){var r={x:e.x,y:e.y};if(r.x<t.left){r.x=t.left}if(r.x>t.left+t.width){r.x=t.left+t.width}if(r.y>t.bottom+t.height){r.y=t.bottom+t.height}if(r.y<t.bottom){r.y=t.bottom}return r};t.bound=S;var T=function(e,r){if(r===void 0){r=1}return t.translate((e.p2.x-e.p1.x)*r,(e.p2.y-e.p1.y)*r)};t.translateToMatrix=T;var w=function(e,r){if(r===void 0){r=1}return t.chain(t.translate(-e.c.x,-e.c.y),t.rotateOrigin(-(e.theta||0)*e.direction*r),t.translate(e.c.x,e.c.y))};t.rotateToMatrix=w;var _=function(e,r){if(r===void 0){r=1}var n=e.factor===undefined?1:e.factor;var i=n*r+(1*1-r);return t.chain(t.translate(-e.c.x,-e.c.y),t.scale(i,i),t.translate(e.c.x,e.c.y))};t.scaleToMatrix=_;var I=function(e,r){if(r===void 0){r=1}if(e.l1.x==e.l2.x&&e.l1.y==e.l2.y){return t.identity()}var n=(e.l1.x+e.l2.x)/2;var i=(e.l1.y+e.l2.y)/2;var a=e.l2.x-e.l1.x;var o=e.l2.y-e.l1.y;var s=Math.atan2(o,a);return t.chain(t.translate(-n,-i),t.rotateOrigin(s),t.scale(1,-1*r+1*(1-r)),t.rotateOrigin(-s),t.translate(n,i))};t.reflectToMatrix=I;var E=function(e,r){if(r===void 0){r=1}switch(e.type){case"translate":return t.translateToMatrix(e,r);case"rotate":return t.rotateToMatrix(e,r);case"scale":return t.scaleToMatrix(e,r);case"reflect":return t.reflectToMatrix(e,r);default:return i.assertUnreachable(e)}};t.transformToMatrix=E;var C=function(){var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}var n=e.map(t.transformToMatrix);return t.chain.apply(void 0,n)};t.transformsToMatrix=C;var M=function(e){if(e.length<2){return[]}var t=[];for(var r=0;r<e.length;r++){var n=e[r];var i=e[(r+1)%e.length];t.push([n,i])}return t};t.getSegments=M;var k=function(e,t){var r=e[0].x;var n=e[0].y;var i=e[1].x;var a=e[1].y;var o=t[0].x;var s=t[0].y;var u=t[1].x;var c=t[1].y;var l=i-r;var p=a-n;var d=u-o;var f=c-s;var h=-d*p+l*f;if(h!=0){var y=(-p*(r-o)+l*(n-s))/h;if(y>0&&y<1){var m=(d*(n-s)-f*(r-o))/h;return m>0&&m<1}return false}else{return false}};t.segmentsIntersect=k;var P=function(e,t){return t.left<=e.x&&e.x<=t.left+t.width&&t.bottom<=e.y&&e.y<=t.bottom+t.height};t.inside=P;var O=function(e,t,r){var i={x:e[1].y-e[0].y,y:-(e[1].x-e[0].x)};var a=t.map(function(e){return i.x*e.x+i.y*e.y});var o=r.map(function(e){return i.x*e.x+i.y*e.y});var s=n.min(a);var u=n.max(a);var c=n.min(o);var l=n.max(o);return u-c<1e-6||l-s<1e-6};t.isSeparating=O;var L=function(e,r){return!n.any([e,r],function(i){return n.any(t.getSegments(i),function(n){return t.isSeparating(n,e,r)})})};t.objectsCollide=L});define("core/migrations/lib/convert-v0-transform",["require","exports","core/components/transform/affine"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.convertTransform=void 0;var n=function(e){var t=e.t;switch(t.type){case"rotate":if(!!t.p1){var n=t.theta===0?-1:t.theta/Math.abs(t.theta);return{id:e.id,t:{type:"rotate",c:t.c,direction:n,theta:Math.abs(t.theta)}}}break;case"scale":if(!!t.p1&&!!t.p2){return{id:e.id,t:{type:"scale",c:t.c,factor:r.projection(r.vec(t.c,t.p2),r.vec(t.c,t.p1))}}}break;case"reflect":if(!!t.p1&&!!t.p2){var i=t.p1;var a=t.p2;var o=r.distance(i,a);var s=(a.x-i.x)/o;var u=(a.y-i.y)/o;var c=(a.x+i.x)/2;var l=(a.y+i.y)/2;var p=-u;var d=s;var f={x:c-p,y:l-d};var h={x:c+p,y:l+d};return{id:e.id,t:{type:"reflect",l1:f,l2:h}}}}return e};t.convertTransform=n});define("core/migrations/activity-config-v1",["require","exports","tslib","./lib/convert-v0-transform","underscore","core/components/sketch/helpers"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.migrate1To0=t.migrate0To1=void 0;function o(e){var t=false;var s;for(var u=0,c=e.steps;u<c.length;u++){var l=c[u];for(var p=0,d=l.root.linearlayout.components;p<d.length;p++){var f=d[p];for(var h=0,y=f.linearlayout.components;h<y.length;h++){var m=y[h];if(m.transform||m.challenge||m.sketch){t=true}}}}if(t){s=e.steps.map(function(e){var t=[];for(var s=0,u=e.root.linearlayout.components;s<u.length;s++){var c=u[s];var l=[];for(var p=0,d=c.linearlayout.components;p<d.length;p++){var f=d[p];if(f.sketch){var h=f.sketch,y=h.toolset,m=h.disableText,v=r.__rest(h,["toolset","disableText"]);l.push({sketch:r.__assign(r.__assign({},v),{enabledTools:a.getMigratedEnabledTools(f.sketch)})})}else if(f.transform){l.push({transform:r.__assign(r.__assign({},f.transform),{solution:f.transform.solution.map(n.convertTransform)})})}else if(f.challenge){var g=o({steps:f.challenge.steps});l.push({challenge:r.__assign(r.__assign({},i.omit(f.challenge,"steps")),{activityConfig:g})})}else if(f.polygraph){l.push({polygraph:r.__assign(r.__assign({},f.polygraph),{questions:f.polygraph.questions.map(function(e){var t=o({steps:[e]});return t.steps[0]}),enablePracticeRound:true})})}else{l.push(f)}}t.push({linearlayout:{mainType:"rows",components:l}})}return r.__assign(r.__assign({},e),{root:{linearlayout:{mainType:"columns",components:t}}})})}else{s=e.steps}return r.__assign(r.__assign({},e),{version:1,steps:s})}t.migrate0To1=o;function s(e){var t=false;var n;for(var o=0,u=e.steps;o<u.length;o++){var c=u[o];for(var l=0,p=c.root.linearlayout.components;l<p.length;l++){var d=p[l];for(var f=0,h=d.linearlayout.components;f<h.length;f++){var y=h[f];if(y.challenge||y.sketch){t=true}}}}if(t){n=e.steps.map(function(e){var t=[];for(var n=0,o=e.root.linearlayout.components;n<o.length;n++){var u=o[n];var c=[];for(var l=0,p=u.linearlayout.components;l<p.length;l++){var d=p[l];if(d.challenge){var f=s(d.challenge.activityConfig);c.push({challenge:r.__assign(r.__assign({},i.omit(d.challenge,"activityConfig")),{steps:f.steps})})}else if(d.sketch){c.push({sketch:r.__assign(r.__assign({},d.sketch),{enabledTools:i.isEqual(d.sketch.enabledTools,a.DEFAULT_SKETCH_TOOLS)?undefined:d.sketch.enabledTools})})}else if(d.polygraph){c.push({polygraph:r.__assign(r.__assign({},d.polygraph),{questions:d.polygraph.questions.map(function(e){var t=s({steps:[e],version:1});return t.steps[0]})})})}else{c.push(d)}}t.push({linearlayout:{mainType:"rows",components:c}})}return r.__assign(r.__assign({},e),{root:{linearlayout:{mainType:"columns",components:t}}})})}else{n=e.steps}return r.__assign(r.__assign({},e),{version:0,steps:n})}t.migrate1To0=s});define("core/migrate-config",["require","exports","tslib","./migrations/activity-config-v1","./lib/assert-unreachable"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.latestVersion=t.persistedVersion=t.migrateConfigToPersisted=t.migrateConfigToLatest=void 0;function a(e){if(e.version&&e.version>t.latestVersion){throw new Error("Loading activity configuration with version "+e.version+" but last known version is "+t.latestVersion+".")}if(e.hasOwnProperty("version")&&(typeof e.version!=="number"||e.version<0)){throw new Error("Activity configuration has invalid version "+e.version+".\nIf a version is present, it should be a non-negative integer less than or equal to "+t.latestVersion+".")}if(e.version===1){return e}return n.migrate0To1(e)}t.migrateConfigToLatest=a;function o(e){if(e.version===undefined||e.version===0){return r.__assign(r.__assign({},e),{version:0})}else if(e.version===1){return n.migrate1To0(e)}else{return i.assertUnreachable(e.version)}}t.migrateConfigToPersisted=o;t.persistedVersion=0;t.latestVersion=1});define("core/prosemirror/card-sort-category-schema",["require","exports","orderedmap","prosemirror-model","prosemirror-schema-basic","core/prosemirror/mq-schema"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.cardSortCategorySchema=void 0;t.cardSortCategorySchema=new n.Schema({nodes:r.from({doc:i.nodes.doc,paragraph:i.nodes.paragraph,text:i.nodes.text,mq:a.mqSpec})})});define("core/components/cardsort/helpers",["require","exports","core/lib/rich-text-helpers","core/prosemirror/card-sort-category-schema","prosemirror-model"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getCalculatorStateFromCard=t.responseToExternalCards=void 0;function a(e){var t={};for(var a in e.cards){var o=e.cards[a];if(o.type==="graph"){var s=o.type,u=o.size,c=o.img,l=o.alt;t[a]={type:s,size:u,img:c,alt:l}}else if(o.type==="text"){t[a]={type:o.type,size:o.size,text:o.text?r.richTextFromText("document",o.text):undefined}}else if(o.type==="category"){var p=o.doc&&i.Node.fromJSON(n.cardSortCategorySchema,JSON.parse(o.doc));t[a]={type:o.type,size:o.size,color:o.color,content:p?r.richTextFromNode("document",p):undefined}}else{var s=o.type,u=o.size,l=o.alt,c=o.img;t[a]={type:s,size:u,alt:l,src:c}}}return t}t.responseToExternalCards=a;function o(e,t,r){var n=e.cards[r];if(!n){throw new Error("Card with ID "+r+" does not exist on component "+t+".")}else if(n.type!=="graph"){throw new Error("Card with ID "+r+" is not a graph card on component "+t+".")}return n.calculatorState}t.getCalculatorStateFromCard=o});define("core/computation-layer/rewrite/translation",["require","exports","tslib","../parser/ast","core/computation-layer/library/builtin","core/lib/assert-unreachable"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.entryToKey=t.translatableNodeToEntry=t.emptyPos=t.extractTranslatableNodes=t.replaceTranslations=void 0;function o(e,t){switch(e.type){case"SinkAssignment":return new n.SinkAssignmentNode(e.left,c(e.right,e,t),e.pos);case"VariableAssignment":return new n.VariableAssignmentNode(e.left,c(e.right,e,t),e.pos);default:return a.assertUnreachable(e)}}t.replaceTranslations=o;function s(e){return u(e.right).map(function(t){return{context:p(e,t)||"",entry:d(t,e)}})}t.extractTranslatableNodes=s;function u(e){switch(e.type){case"Number":case"Boolean":case"Latex":case"CalculatorReference":case"Identifier":return[];case"String":return[e];case"Interpolation":{var t=[e];for(var n=0,i=e.parts;n<i.length;n++){var o=i[n];if(o.type=="expr"){t.push.apply(t,u(o.node))}}return t}case"BinaryOperation":return r.__spreadArrays(u(e.left),u(e.right));case"Choose":{var t=[];for(var s=0,c=e.cases;s<c.length;s++){var l=c[s];t.push.apply(t,u(l.predicate));t.push.apply(t,u(l.consequent))}t.push.apply(t,u(e.otherwise));return t}case"Function":{var t=[];for(var p=0,d=e.args;p<d.length;p++){var f=d[p];t.push.apply(t,u(f))}return t}default:return a.assertUnreachable(e)}}function c(e,t,o){switch(e.type){case"BinaryOperation":return new n.BinaryOperationNode(e.operator,c(e.left,t,o),c(e.right,t,o),e.pos);case"Number":case"Boolean":case"Latex":case"CalculatorReference":case"Identifier":return e;case"String":{var s=f(d(e,t));var u=o[s];if(u){if(u.value.parts.length==1&&typeof u.value.parts[0]=="string"){return new n.StringNode(u.value.parts[0],l())}else if(u.value.parts.length==0){return new n.StringNode("",l())}else{throw new Error("Internal Error: replacement does not match format expected for a string "+JSON.stringify(u))}}else{return e}}case"Choose":return new n.ChooseNode(e.cases.map(function(e){var r=e.predicate,n=e.consequent;return{predicate:c(r,t,o),consequent:c(n,t,o)}}),c(e.otherwise,t,o),e.pos);case"Function":return new n.FunctionNode(e.args.map(function(e){return c(e,t,o)}),e.pos);case"Interpolation":{var p=e.parts.map(function(e){return e.type=="string"?e:{type:"expr",node:c(e.node,t,o)}});var s=f(d(e,t));var u=o[s];if(u){var h=u.value.parts;var y=[];for(var m=0,v=p;m<v.length;m++){var g=v[m];if(g.type=="expr"){y.push(g.node)}}var b=new n.FunctionNode(r.__spreadArrays([new n.IdentifierNode(i.STRING_INTERP_FN_NAME,l())],h.map(function(e){return typeof e=="number"?new n.NumberNode(e,l()):new n.StringNode(e,l())})),l());var x=new n.FunctionNode(r.__spreadArrays([new n.IdentifierNode(i.INTERPOLATE_FN_NAME,l())],y),l());return new n.BinaryOperationNode(".",b,x,l())}else{return new n.InterpolationNode(p,e.pos)}}default:return a.assertUnreachable(e)}}function l(){return{stepId:"",componentId:"",first_line:-1,first_column:-1,last_line:-1,last_column:-1}}t.emptyPos=l;function p(e,t){if(t==e){return"*"}switch(e.type){case"SinkAssignment":{var r=p(e.right,t);if(r){return e.left.synthesize()+": "+r}return undefined}case"VariableAssignment":{var r=p(e.right,t);if(r){return e.left.synthesize()+"= "+r}return undefined}case"Boolean":case"Number":case"String":case"Latex":case"Identifier":return undefined;case"BinaryOperation":{var n=p(e.left,t);if(n){return n}var i=p(e.right,t);if(i){return i}return undefined}case"Interpolation":for(var o=0;o<e.parts.length;o+=1){var s=e.parts[o];var r=p(s.node,t);if(r){return'"${'+(o+1)+'}" > '+r}}return undefined;case"Choose":{for(var o=0;o<e.cases.length;o+=1){var u=e.cases[o],c=u.predicate,l=u.consequent;var d=p(c,t);if(d){return"when ["+o+"] > "+d}var f=p(l,t);if(f){return"when "+c.synthesize()+" > "+f}}var r=p(e.otherwise,t);if(r){return"otherwise > "+r}return undefined}case"Function":for(var o=0;o<e.args.length;o+=1){var h=e.args[o];var r=p(h,t);if(r){return e.args[0].synthesize()+"("+o+") > "+r}}return undefined;case"CalculatorReference":throw new Error("CalculatorReference should not appear in an actual AST tree.");default:return a.assertUnreachable(e)}}function d(e,t){var r;switch(e.type){case"String":r={type:"cl-string",value:{parts:[e.value]}};break;case"Interpolation":{var n=[];var i=1;for(var o=0,s=e.parts;o<s.length;o++){var u=s[o];if(u.type=="string"){n.push(u.node.value)}else{n.push(i);i+=1}}r={type:"cl-string",value:{parts:n}};break}default:return a.assertUnreachable(e)}if(t.type=="VariableAssignment"&&e==t.right){r.value.variableName=t.left.synthesize()}return r}t.translatableNodeToEntry=d;function f(e){var t=e.value.variableName?e.value.variableName+":":"";return t+JSON.stringify(e.value.parts)}t.entryToKey=f});define("core/activity-translation/cl-translator",["require","exports","./helpers","core/computation-layer/parser/main","core/computation-layer/parser/ast","core/computation-layer/rewrite/translation"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.CLTranslator=void 0;var o=function(){function e(){}e.prototype.extract=function(e){var t={};var i=n.parse(e,{stepId:"component-translation-extract",componentId:"component-translation-extract"});for(var o=0,s=i.nodes;o<s.length;o++){var u=s[o];var c=a.extractTranslatableNodes(u);for(var l=0,p=c;l<p.length;l++){var d=p[l],f=d.entry,h=d.context;t[r.createCLTranslationKey(f)]={context:{source:"cl",text:h},entry:f}}}return t};e.prototype.merge=function(e,t){var o={};for(var s in t){if(r.isCLTranslationKey(s)){o[s.slice(r.CL_KEY_PREFIX.length)]=t[s]}}var u=n.parse(e,{stepId:"component-translation-extract",componentId:"component-translation-extract"});var c=[];for(var l=0,p=u.nodes;l<p.length;l++){var d=p[l];c.push(a.replaceTranslations(d,o))}return i.synthesizeScript(c)};return e}();t.CLTranslator=o});define("core/lib/teacher-tips",["require","exports","tslib"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.migrateLegacyTeacherTips=void 0;function n(e){if(e.text){var t=r.__assign(r.__assign({},e),{teacherTips:{"teacher-moves":e.text}});delete t.text;return t}else{return r.__assign(r.__assign({},e),{teacherTips:e.teacherTips||{}})}}t.migrateLegacyTeacherTips=n});define("core/components/subscreen-helpers",["require","exports","core/lib/teacher-tips","core/components/component-helpers","core/lib/copydata"],function(e,t,r,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.updateSubscreenComponentConfigurations=t.ensureCollapsedSubscreens=t.getMaxAvailableSubscreenSteps=t.expandSubscreenSteps=void 0;function a(e){if(e.length==0)return e;var t=[];for(var i=0,a=e;i<a.length;i++){var o=a[i];t.push(o);var s=n.getSubscreenParentConfig(o);if(s!=undefined&&s.numSteps===undefined){s.numSteps=s.activityConfig.steps.length;t.push.apply(t,s.activityConfig.steps.map(function(e){return r.migrateLegacyTeacherTips(e)}));s.activityConfig=null}}return t}t.expandSubscreenSteps=a;function o(e,t){for(var r=t;r+1<e.length;r++){var i=e[r+1];if(n.getSubscreenParentConfig(i))return r-t}return e.length-1-t}t.getMaxAvailableSubscreenSteps=o;function s(e){var t=[];for(var r=0;r<e.length;r+=1){var a=e[r];if(n.getSubscreenParentConfig(a)){var s=i.copydata(a);var u=n.getSubscreenParentConfig(s);if(typeof u.numSteps=="number"){if(u.activityConfig){throw new Error("Expected config to either have a numSteps or activityConfig property but provided config had both defined.")}var c=Math.min(u.numSteps,o(e,r));u.activityConfig={version:1,steps:e.slice(r+1,r+c+1)};r=r+c;delete u.numSteps}else if(!u.activityConfig){throw new Error("Expected config to either have a numSteps or activityConfig property. Provided config had neither defined")}t.push(s)}else{t.push(a)}}return t}t.ensureCollapsedSubscreens=s;function u(e){for(var t=0;t<e.length;t++){var r=e[t];var i=n.getSubscreenParentConfig(r);if(!i)continue;if(typeof i.numSteps!=="number")throw new Error("Expected numSteps property on subscreen-containing component config");var a=o(e,t);i.numSteps=Math.min(i.numSteps,a)}}t.updateSubscreenComponentConfigurations=u});define("core/activity-translation/translator",["require","exports","tslib","core/components/component-helpers","core/lib/mathtools","core/lib/rich-text","core/prosemirror/prosemirror-serialize","./helpers","underscore","./cl-translator","core/lib/assert-unreachable","core/components/subscreen-helpers","core/lib/copydata"],function(e,t,r,n,i,a,o,s,u,c,l,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.trimContextFromActivityTranslations=t.trimContextFromTranslationMap=t.trimContextFromTranslationEntry=t.StepTranslator=t.ActivityDetailsTranslator=t.ActivityTranslator=t.getComponentTranslator=void 0;var f={"exhibit/text":function(){return new T},"multiple-choice":function(){return new b},"exhibit/image":function(){return new I},"action-button":function(){return new S},reorder:function(){return new w},table:function(){return new _},"input/graph":function(){return new k},sketch:function(){return new P},marbleslides:function(){return new O},geometry:function(){return new L},cardsort:function(){return new x},video:function(){return new E}};function h(e){var t=f[e];if(t)return t();else return undefined}t.getComponentTranslator=h;var y=function(){function e(){}e.prototype.extract=function(e,t){var r=this;var i={activity:{},components:{},steps:{}};if(!t.skipActivityDetails){i.activity=(new v).extract(e)}var a=!t.skipChallengeCreatorSubscreens?p.expandSubscreenSteps(d.copydata(e.steps)):e.steps;for(var o=0,s=a;o<s.length;o++){var u=s[o];i.steps[u.id]=(new g).extract(u,t);if(u.script){var l=(new c.CLTranslator).extract(u.script);for(var f in l||{}){i.steps[u.id][f]=l[f]}}n.forEachComponent(u,function(e){var t=n.traverseComponentKey(e);var a=n.componentKey(e);i.components[t.id]=r.extractComponent(a,e)||{};if(t.script){var o=(new c.CLTranslator).extract(t.script);for(var s in o||{}){i.components[t.id][s]=o[s]}}})}return N(i)};e.prototype.merge=function(e,t,i){var a=r.__assign(r.__assign(r.__assign({},e),(new v).merge(e,t.activity)),{steps:[]});var o=!i.skipChallengeCreatorSubscreens?p.expandSubscreenSteps(d.copydata(e.steps)):e.steps;for(var s=0,u=o;s<u.length;s++){var l=u[s];var f=r.__assign(r.__assign({},l),{root:{linearlayout:{mainType:"columns",components:[]}}});if(t.steps[l.id]){f=(new g).merge(f,t.steps[f.id]);if(l.script){var h=(new c.CLTranslator).merge(l.script,t.steps[f.id]);f.script=h}}a.steps.push(f);for(var y=0,m=l.root.linearlayout.components;y<m.length;y++){var b=m[y];var x={linearlayout:{mainType:"rows",components:[]}};f.root.linearlayout.components.push(x);for(var S=0,T=b.linearlayout.components;S<T.length;S++){var w=T[S];var _=n.traverseComponentKey(w);var I=t.components[_.id];var E=this.mergeComponent(n.componentKey(w),w,I);x.linearlayout.components.push(E)}}}if(!i.skipChallengeCreatorSubscreens){a.steps=p.ensureCollapsedSubscreens(a.steps)}return a};e.prototype.mergeComponent=function(e,t,i){var a;var o=n.traverseComponentKey(t);var s=h(e);var u=r.__assign({},o);if(s&&i){u=s.merge(o,i)}if(i&&o.script){var l=(new c.CLTranslator).merge(o.script,i);u.script=l}return a={},a[e]=u,a};e.prototype.extractComponent=function(e,t){var r=h(e);var i=n.traverseComponentKey(t);if(r){return r.extract(i)}return undefined};return e}();t.ActivityTranslator=y;var m={title:"title",blurb:"blurb",thumb:"thumb",subtitle:"subtitle",lessonPlan:"lessonPlan",learningGoals:"learningGoals",accessibilityNotes:"accessibilityNotes",iPadWarning:"iPadWarning",vocab:"vocab",linkedActivity:"activityLink"};var v=function(){function e(){this.vocabKey=function(e){return m.vocab+":"+e};this.linkedActivityKey=function(e){return m.linkedActivity+":"+e}}e.prototype.extract=function(e){var t={};var r=function(e,r,n,i){if(!!r){var a={entry:{type:n,value:r},context:{source:"config",text:i}};t[e]=a}};r(m.title,e.title,"string","Activity Title");r(m.subtitle,e.subtitle,"string","Activity Subtitle");if(e.blurb){if(typeof e.blurb==="string"){r(m.blurb,e.blurb,"string","Activity Description")}else if(e.blurb.schemaKey==="document"&&!!e.blurb.content){r(m.blurb,JSON.stringify(e.blurb.content),"rich-text","Activity Description")}}if(!e.thumbId){r(m.thumb,e.thumb,"image","Activity Thumbnail Image")}if(e.learningGoals){r(m.learningGoals,JSON.stringify(e.learningGoals.content),"rich-text","Learning Goals")}var n=e.vocab||[];for(var i=0;i<n.length;i++){var a=n[i];r(this.vocabKey(i),a,"string","Vocab List")}if(e.lessonPlan){r(m.lessonPlan,JSON.stringify(e.lessonPlan.content),"rich-text","Lesson Summary")}var o=e.linkedActivities||[];for(var i=0;i<o.length;i++){var s=o[i].title;r(this.linkedActivityKey(i),s,"string","Linked Activity Title")}r(m.accessibilityNotes,e.accessibilityNotes,"string","Accessibility Notes");r(m.iPadWarning,e.iPadWarning,"string","iPad Warning");return t};e.prototype.merge=function(e,t){var n={};var i=function(t,r){if(e[t]&&r){n[t]=r.value}};var o=function(t,r){if(e[t]&&r){if(t==="blurb"){if(r.type==="rich-text"){n[t]={schemaKey:"document",version:a.schemas.document.version,content:JSON.parse(r.value)}}else{n[t]=r.value}}else{n[t]={schemaKey:"lesson",version:a.schemas.lesson.version,content:JSON.parse(r.value)}}}};i("title",t[m.title]);i("thumb",t[m.thumb]);i("subtitle",t[m.subtitle]);o("blurb",t[m.blurb]);o("lessonPlan",t[m.lessonPlan]);o("learningGoals",t[m.learningGoals]);i("accessibilityNotes",t[m.accessibilityNotes]);i("iPadWarning",t[m.iPadWarning]);if(e.vocab){n.vocab=[];for(var s=0;s<e.vocab.length;s++){var u=t[this.vocabKey(s)];if(u){n.vocab.push(u.value)}else{n.vocab.push(e.vocab[s])}}}if(e.linkedActivities){n.linkedActivities=[];for(var s=0;s<e.linkedActivities.length;s++){var u=t[this.linkedActivityKey(s)];var c=u?u.value:e.linkedActivities[s].title;n.linkedActivities.push(r.__assign(r.__assign({},e.linkedActivities[s]),{title:c}))}}return n};return e}();t.ActivityDetailsTranslator=v;var g=function(){function e(){this.titleKey="title";this.sampleResponseKey="sample-response";this.teacherMovesKey="teacher-moves";this.studentSupportKey="student-support"}e.prototype.extract=function(e,t){if(t===void 0){t={}}var r={};if(e.title){r[this.titleKey]={context:{source:"config",text:"Step Title"},entry:{value:e.title,type:"string"}}}if(!t.skipTeacherTips){var n=e.teacherTips;var i=this.extractTeacherTips("sample-responses",n);if(i){r[this.sampleResponseKey]=i}var a=this.extractTeacherTips("teacher-moves",n);if(a){r[this.teacherMovesKey]=a}var o=this.extractTeacherTips("student-support",n);if(o){r[this.studentSupportKey]=o}}return r};e.prototype.merge=function(e,t){var n={};var i=r.__assign(r.__assign({},e),{teacherTips:n});var a=t[this.titleKey];if(e.title&&a){i.title=a.value}var o=e.teacherTips;var s=this.translateTeacherTip("sample-responses",o,t[this.sampleResponseKey]);if(s)i.teacherTips["sample-responses"]=s;var u=this.translateTeacherTip("student-support",o,t[this.studentSupportKey]);if(u)i.teacherTips["student-support"]=u;var c=this.translateTeacherTip("teacher-moves",o,t[this.teacherMovesKey]);if(c)i.teacherTips["teacher-moves"]=c;return i};e.prototype.translateTeacherTip=function(e,t,r){if(t[e]){if(r){return r.type=="string"?r.value:{schemaKey:"document",version:a.schemas.document.version,content:JSON.parse(r.value)}}else{return t[e]}}return undefined};e.prototype.extractTeacherTips=function(e,t){var r=t[e];if(!!r){if(typeof r==="string"){return{entry:{value:r,type:"string"},context:{source:"config",text:"Teacher Tip "+e}}}else if(r.schemaKey==="document"&&!!r.content){return{entry:{type:"rich-text",value:JSON.stringify(r.content)},context:{source:"config",text:"Teacher Tip "+e}}}}return undefined};return e}();t.StepTranslator=g;var b=function(){function e(){this.getChoiceKey=function(e,t){return"choice:"+t+":"+e}}e.prototype.hasGraphKeys=function(e,t){var r=new RegExp("choice:graph:"+t);return u.some(u.keys(e),function(e){return r.test(e)})};e.prototype.extract=function(e){var t={};for(var r in e.choices){var n=e.choices[r].text;var i=e.choices[r].card;if(n){t[this.getChoiceKey(r,"text")]={entry:{value:n,type:"string"},context:{source:"config",text:"Choice Text"}}}if(i){if(i.type==="image"&&i.img){t[this.getChoiceKey(r,"image")]={entry:{value:i.img,type:"image"},context:{source:"config",text:"Choice image"}}}else if(i.type==="graph"&&!!i.calculatorState){var a=new M({prefix:this.getChoiceKey(r,"graph"),expressionListVisible:false}).extract(i.calculatorState);for(var o in a){t[o]=a[o]}}if(!!i.alt){t[this.getChoiceKey(r,"alt")]={entry:{value:i.alt,type:"string"},context:{source:"config",text:"Choice alternate text"}}}}}return t};e.prototype.merge=function(e,t){var n={};for(var i in e.choices){var a=e.choices[i];var o=r.__assign({},a);var s=t[this.getChoiceKey(i,"text")];if(a.text&&s){o.text=s.value}if(a.card){var u=r.__assign({},a.card);var c=t[this.getChoiceKey(i,"alt")];if(!!c){u.alt=c.value}var l=t[this.getChoiceKey(i,"image")];if(a.card.type==="image"&&l){u.img=l.value}else if(a.card.type==="graph"){if(a.card.calculatorState&&this.hasGraphKeys(t,i)){var p=new M({prefix:this.getChoiceKey(i,"graph"),expressionListVisible:false}).merge(a.card.calculatorState,t);u=r.__assign(r.__assign({},u),{img:"",calculatorState:p})}}o.card=u}n[i]=o}return r.__assign(r.__assign({},e),{choices:n})};return e}();var x=function(){function e(){this.getCardKey=function(e,t){return"card:"+t+":"+e}}e.prototype.hasGraphKeys=function(e,t){var r=new RegExp("card:graph:"+t);return u.some(u.keys(e),function(e){return r.test(e)})};e.prototype.extract=function(e){var t={};for(var r in e.cards){var n=e.cards[r];switch(n.type){case"text":if(n.doc){t[this.getCardKey(r,"text")]={entry:{value:n.doc,type:"rich-text"},context:{source:"config",text:"Card sort text"}}}else if(n.text){t[this.getCardKey(r,"text")]={entry:{value:n.text,type:"string"},context:{source:"config",text:"Card sort text"}}}break;case"image":if(n.img){t[this.getCardKey(r,"image")]={entry:{value:n.img,type:"image"},context:{source:"config",text:"Card sort image"}}}if(n.alt){t[this.getCardKey(r,"alt")]={entry:{value:n.alt,type:"string"},context:{source:"config",text:"Card sort image alternate text"}}}break;case"graph":if(n.calculatorState){var i=new M({prefix:this.getCardKey(r,"graph"),expressionListVisible:false}).extract(n.calculatorState);for(var a in i){t[a]=i[a]}}if(n.alt){t[this.getCardKey(r,"alt")]={entry:{value:n.alt,type:"string"},context:{source:"config",text:"Card sort image alternate text"}}}break;case"category":if(n.doc){t[this.getCardKey(r,"category")]={entry:{value:n.doc,type:"rich-text"},context:{source:"config",text:"Card sort text"}}}break}}return t};e.prototype.merge=function(e,t){var n={};for(var i in e.cards){var a=e.cards[i];switch(a.type){case"text":{var s=r.__assign({},a);var u=t[this.getCardKey(i,"text")];var c=void 0,l=void 0;if(u&&u.type==="string"){c=u.value;l=JSON.stringify(o.stringToSerializedNode(u.value,true))}else if(u&&u.type==="rich-text"){l=u.value;c=o.serializedNodeToString(JSON.parse(u.value))}if(l&&s.doc){s.doc=l}if(c&&s.text){s.text=c}n[i]=s}break;case"image":{var s=r.__assign({},a);var u=t[this.getCardKey(i,"image")];if(a.img&&u){s.img=u.value}var p=t[this.getCardKey(i,"alt")];if(a.alt&&p){s.alt=p.value}n[i]=s}break;case"graph":{var s=r.__assign({},a);if(a.calculatorState&&this.hasGraphKeys(t,i)){var d=new M({prefix:this.getCardKey(i,"graph"),expressionListVisible:false}).merge(a.calculatorState,t);s=r.__assign(r.__assign({},a),{calculatorState:d,img:""})}var p=t[this.getCardKey(i,"alt")];if(a.alt&&p){s.alt=p.value}n[i]=s}break;case"category":{var s=r.__assign({},a);var u=t[this.getCardKey(i,"category")];if(a.doc&&u){s.doc=u.value}n[i]=s}break}}return r.__assign(r.__assign({},e),{cards:n})};return e}();var S=function(){function e(){this.labelKey="label"}e.prototype.extract=function(e){var t={};if(e.label){t[this.labelKey]={entry:{value:e.label,type:"string"},context:{source:"config",text:"Action Button text"}}}return t};e.prototype.merge=function(e,t){var n=r.__assign({},e);var i=t[this.labelKey];if(e.label&&i){n.label=i.value}return n};return e}();var T=function(){function e(){this.documentKey="doc"}e.prototype.extract=function(e){var t={};if(e.doc){t[this.documentKey]={entry:{value:e.doc,type:"rich-text"},context:{source:"config",text:"Note text"}}}else{t[this.documentKey]={entry:{value:JSON.stringify(o.stringToSerializedNode(e.text)),type:"rich-text"},context:{source:"config",text:"Note text"}}}return t};e.prototype.merge=function(e,t){var n=r.__assign({},e);var i=t[this.documentKey];if(i&&(e.doc||e.text)){n.doc=i.value}return n};return e}();var w=function(){function e(){this.getItemKey=function(e){return"item-"+e}}e.prototype.extract=function(e){var t={};if(e.bottomString!==undefined){t["reorder-bottomString"]={entry:{value:e.bottomString,type:"string"},context:{source:"config",text:"Reorder bottom label"}}}if(e.topString!==undefined){t["reorder-topString"]={entry:{value:e.topString,type:"string"},context:{source:"config",text:"Reorder top label"}}}for(var r in e.items){t[this.getItemKey(r)]={entry:{value:e.items[r].text,type:"string"},context:{source:"config",text:"Reorder item text"}}}return t};e.prototype.merge=function(e,t){var n={};var i=d.copydata(e);if(e.bottomString!==undefined){var a=t["reorder-bottomString"];if(a)i.bottomString=a.value}if(e.topString!==undefined){var a=t["reorder-topString"];if(a)i.topString=a.value}for(var o in e.items){var s=e.items[o];n[o]=r.__assign({},s);var a=t[this.getItemKey(o)];if(s.text&&a){n[o].text=a.value}}return r.__assign(r.__assign({},i),{items:n})};return e}();var _=function(){function e(){this.getCellKey=function(e){return"cell-"+e}}e.prototype.extract=function(e){var t={};for(var r in e.cells){var n=e.cells[r];if(n.content){t[this.getCellKey(r)]={entry:{value:n.content,type:"string"},context:{source:"config",text:"Table cell content"}}}}return t};e.prototype.merge=function(e,t){var n={};for(var i in e.cells){var a=e.cells[i];n[i]=r.__assign({},a);var o=t[this.getCellKey(i)];if(a.content&&o){n[i].content=o.value}}return r.__assign(r.__assign({},e),{cells:n})};return e}();var I=function(){function e(){this.imageKey="img";this.altKey="alt"}e.prototype.extract=function(e){var t={};if(e.alt){t[this.altKey]={entry:{value:e.alt,type:"string"},context:{source:"config",text:"Image alt text"}}}if(e.img){t[this.imageKey]={entry:{value:e.img,type:"image"},context:{source:"config",text:"Image url"}}}return t};e.prototype.merge=function(e,t){var n=r.__assign({},e);var i=t[this.imageKey];if(e.img&&i){n.img=i.value}var a=t[this.altKey];if(e.alt&&a){n.alt=a.value}return n};return e}();var E=function(){function e(){this.videoConfigKey="videoConfig";this.descriptionKey="description"}e.prototype.extract=function(e){var t;var r={};var n={type:"video",value:{}};if(e.videoConfig){n.value.config=e.videoConfig}if((t=e.captions)===null||t===void 0?void 0:t.length){n.value.captions=e.captions}if(!u.isEmpty(n.value)){r[this.videoConfigKey]={entry:n,context:{source:"config",text:"Video configuration"}}}if(e.videoDescription){r[this.descriptionKey]={entry:{type:"string",value:e.videoDescription},context:{source:"config",text:"Video description"}}}return r};e.prototype.merge=function(e,t){var n=r.__assign({},e);var i=t[this.videoConfigKey];if(i){var a=i.value.config;if(e.videoConfig&&a){n=r.__assign(r.__assign({},n),{videoConfig:a})}var o=i.value.captions;if(e.captions&&o){n=r.__assign(r.__assign({},n),{captions:o})}}var s=t[this.descriptionKey];if(e.videoDescription&&s){n.videoDescription=s.value}return n};return e}();var C={"expression-list-expression-label":"Expression label","expression-list-expression-clickable-description":"Clickable expression description","expression-list-folder-title":"Folder title","expression-list-image-url":"Image URL","expression-list-image-clickable-description":"Clickable image description","expression-list-image-clickable-depressed":"Clickable image URL (depressed)","expression-list-image-clickable-hovered":"Clickable image URL (hovered)","expression-list-note-text":"Note text","settings-xaxis-label":"X-Axis label","settings-yaxis-label":"Y-Axis label","geometry-object-label":"Geometry object label","geometry-object-image-url":"Geometry image URL"};var M=function(){function e(e){var t=this;var r=e.prefix,n=e.expressionListVisible;this.expressionListVisible=true;this.addKeyPrefix=function(e){return t.calculatorKeyPrefix+":"+e};this.calculatorKeyPrefix=r!==null&&r!==void 0?r:"calculator";if(n!=undefined){this.expressionListVisible=n}}e.prototype.removeKeyPrefix=function(e){if(e.indexOf(this.calculatorKeyPrefix+":")===0){return e.substring(this.calculatorKeyPrefix.length+1)}return undefined};e.prototype.extract=function(e){var t={};var r=i.migrateToLatest(e);var n=i.extractLocalizationMap({type:"graph",graphState:r});for(var a in n){var o=n[a];var s=o.context;if(!this.expressionListVisible&&(s=="expression-list-note-text"||s=="expression-list-folder-title")){continue}var u=void 0;switch(o.type){case"string":u={entry:{value:o.value,type:"string"},context:{source:"config",text:C[s]}};break;case"image":u={entry:{value:o.value,type:"image"},context:{source:"config",text:C[s]}};break;case"interpolated-string":u={entry:{value:o.value,type:"interpolated-string"},context:{source:"config",text:C[s]}};break;default:return l.assertUnreachable(o.type)}t[this.addKeyPrefix(a)]=u}return t};e.prototype.merge=function(e,t){var n={};for(var a in t){var o=this.removeKeyPrefix(a);if(o&&t[a]){var s=t[a];n[o]=r.__assign({},s)}}return i.applyLocalizationMap(e,n,"graph")};return e}();var k=function(){function e(){}e.prototype.extract=function(e){var t={};if(e.calculatorState){var r=new M({expressionListVisible:!e.exhibitMode}).extract(e.calculatorState);for(var n in r){t[n]=r[n]}}return t};e.prototype.merge=function(e,t){var n=r.__assign({},e);if(e.calculatorState){n.calculatorState=new M({expressionListVisible:!e.exhibitMode}).merge(e.calculatorState,t)}return n};return e}();var P=function(){function e(){this.backgroundImageKey="background"}e.prototype.extract=function(e){var t={};if(e.background.type=="graph"&&e.calculatorState){var r=new M({expressionListVisible:false}).extract(e.calculatorState);for(var n in r){t[n]=r[n]}}else if(e.background.type=="image"||e.background.type=="pattern"){t[this.backgroundImageKey]={entry:{type:"image",value:e.background.img},context:{source:"config",text:"Sketch background image"}}}return t};e.prototype.merge=function(e,t){var n=t[this.backgroundImageKey];if(e.background.type=="graph"&&e.calculatorState){var i=new M({expressionListVisible:false}).merge(e.calculatorState,t);return r.__assign(r.__assign({},e),{calculatorState:i})}else if((e.background.type=="image"||e.background.type=="pattern")&&n){return r.__assign(r.__assign({},e),{background:r.__assign(r.__assign({},e.background),{img:n.value})})}return r.__assign({},e)};return e}();var O=function(){function e(){this.calculatorTranslator=new M({expressionListVisible:true})}e.prototype.extract=function(e){var t={};if(e.calculatorState){var r=this.calculatorTranslator.extract(e.calculatorState);for(var n in r){t[n]=r[n]}}return t};e.prototype.merge=function(e,t){var n=r.__assign({},e);if(e.calculatorState){n.calculatorState=this.calculatorTranslator.merge(e.calculatorState,t)}return n};return e}();var L=function(){function e(){var e=this;this.prefix="geometry";this.addPrefix=function(t){return e.prefix+":"+t}}e.prototype.removePrefix=function(e){if(e.indexOf(this.prefix+":")===0){return e.substring(this.prefix.length+1)}return undefined};e.prototype.extract=function(e){var t={};if(e.state){var r=e.state;var n=i.extractLocalizationMap({type:"geometry",geometryState:r});for(var a in n){var o=n[a].type=="string"?{entry:{value:n[a].value,type:"string"},context:{source:"config",text:C[n[a].context]}}:{entry:{value:n[a].value,type:"image"},context:{source:"config",text:C[n[a].context]}};t[this.addPrefix(a)]=o}}return t};e.prototype.merge=function(e,t){var n=r.__assign({},e);if(e.state){var a={};for(var o in t){var s=this.removePrefix(o);if(s){var u=t[o];a[s]=r.__assign({},u)}}n.state=i.applyLocalizationMap(e.state,a,"geometry")}return n};return e}();function N(e){var t={steps:{},components:{},activity:{}};for(var r=0,n=s.listKeys(e);r<n.length;r++){var i=n[r];var a=s.getEntry(i,e);if(a&&!D(a.entry)){s.insertEntryIntoMap(i,a,t)}}return t}var A=/^\s*$/;function D(e){switch(e.type){case"string":case"image":case"interpolated-string":return A.test(e.value);case"video":return false;case"cl-string":{if(e.value.variableName){return false}if(e.value.parts.length==0){return true}if(e.value.parts.length>1){return false}var t=e.value.parts[0];return typeof t=="string"&&A.test(t)}case"rich-text":return false;default:return l.assertUnreachable(e)}}function R(e){return e.entry}t.trimContextFromTranslationEntry=R;function F(e){var t={};for(var r in e){t[r]=R(e[r])}return t}t.trimContextFromTranslationMap=F;function q(e){var t={steps:{},components:{},activity:{}};for(var r in e.steps){t.steps[r]=F(e.steps[r])}for(var n in e.components){t.components[n]=F(e.components[n])}t.activity=F(e.activity);return t}t.trimContextFromActivityTranslations=q});define("core/activity-translation/helpers",["require","exports","tslib","underscore","../lib/assert-unreachable","core/computation-layer/rewrite/translation","core/activity-translation/translator"],function(e,t,r,n,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getTranslationStatus=t.getTranslationFromEntry=t.trimContext=t.stringifyTranslationKey=t.getEntry=t.listKeys=t.createMap=t.insertEntryIntoMap=t.deflateTranslationBundle=t.inflateTranslationBundle=t.deflateTranslationMemory=t.inflateTranslationMemory=t.translateActivityDetails=t.translateActivity=t.applyBundle=t.bundle=t.isCLTranslationKey=t.createCLTranslationKey=t.CL_TRANSLATION_KEY=t.CL_KEY_PREFIX=void 0;t.CL_KEY_PREFIX="cl:";t.CL_TRANSLATION_KEY="cl-translation";function s(e){return t.CL_KEY_PREFIX+a.entryToKey(e)}t.createCLTranslationKey=s;function u(e){return e.indexOf(t.CL_KEY_PREFIX)==0}t.isCLTranslationKey=u;function c(e,t,r){var i=b(e.entries);var a=[];var o=[];var s={entries:[]};var u=x(t);for(var c=0,l=u;c<l.length;c++){var p=l[c];var d=S(p,t);var f=S(p,i);if(f&&n.isEqual(f.original,d)){if(f.skipped){s.entries.push({key:p,original:d,translation:{status:"skipped"}})}else if(f.approved){s.entries.push({key:p,original:d,translation:{status:"translated",value:f.approved.translation}})}else{var h=I(f);if(h){s.entries.push({key:p,original:d,translation:{status:"translated",value:h}})}o.push(p)}}else{a.push(p)}}if(!r.allowMissingKeys){var y="";if(a.length){y+=" Some keys were missing: "+JSON.stringify(a)+"."}if(o.length){y+=" Some keys lacked an approved/skipped value: "+JSON.stringify(o)+"."}if(y.length){throw new Error("Bundle Error."+y)}}return{translationBundle:s,missingKeys:a,pendingKeys:o}}t.bundle=c;function l(e,t,r){var a=b(t.entries);var o={steps:{},components:{},activity:{}};var s=[];for(var u=0,c=x(e);u<c.length;u++){var l=c[u];var p=S(l,e);var d=S(l,a);if(!d){s.push(l);g(l,p,o);continue}if(!n.isEqual(p,d.original)){s.push(l);g(l,p,o);continue}switch(d.translation.status){case"translated":g(l,d.translation.value,o);break;case"skipped":g(l,d.original,o);break;default:i.assertUnreachable(d.translation)}}if(!r.allowMissingKeys&&s.length){throw new Error("Error while applying bundle. Some keys were missing: "+JSON.stringify(s))}return o}t.applyBundle=l;function p(e){var t;var r=new o.ActivityTranslator;return r.merge(e.activityConfig.content,l(w(r.extract(e.activityConfig.content,e.extractOptions||{})),e.bundle,{allowMissingKeys:e.allowMissingKeys}),{skipChallengeCreatorSubscreens:(t=e.extractOptions)===null||t===void 0?void 0:t.skipChallengeCreatorSubscreens})}t.translateActivity=p;function d(e){var t=new o.ActivityDetailsTranslator;return t.merge(e.activityDetails,l(w({activity:t.extract(e.activityDetails),steps:{},components:{}}),m(e.persistedBundle),{allowMissingKeys:e.allowMissingKeys}).activity)}t.translateActivityDetails=d;function f(e){var n={entries:[]};for(var i=0,a=e.entries;i<a.length;i++){var o=a[i];if(o.key.key==t.CL_TRANSLATION_KEY){n.entries.push(r.__assign(r.__assign({},o),{key:r.__assign(r.__assign({},o.key),{key:s(o.original)})}))}else{n.entries.push(o)}}return n}t.inflateTranslationMemory=f;function h(e){if(u(e.key)){return r.__assign(r.__assign({},e),{key:t.CL_TRANSLATION_KEY})}else{return e}}function y(e){var t={entries:[]};for(var n=0,i=e.entries;n<i.length;n++){var a=i[n];t.entries.push(r.__assign(r.__assign({},a),{key:h(a.key)}))}return t}t.deflateTranslationMemory=y;function m(e){var n={entries:[]};for(var i=0,a=e.entries;i<a.length;i++){var o=a[i];if(o.key.key==t.CL_TRANSLATION_KEY){n.entries.push(r.__assign(r.__assign({},o),{key:r.__assign(r.__assign({},o.key),{key:s(o.original)})}))}else{n.entries.push(o)}}return n}t.inflateTranslationBundle=m;function v(e){var t={entries:[]};for(var n=0,i=e.entries;n<i.length;n++){var a=i[n];t.entries.push(r.__assign(r.__assign({},a),{key:h(a.key)}))}return t}t.deflateTranslationBundle=v;function g(e,t,r){switch(e.loc){case"step":if(!r.steps[e.stepId]){r.steps[e.stepId]={}}r.steps[e.stepId][e.key]=t;break;case"component":if(!r.components[e.componentId]){r.components[e.componentId]={}}r.components[e.componentId][e.key]=t;break;case"activity":r.activity[e.key]=t;break;default:i.assertUnreachable(e)}}t.insertEntryIntoMap=g;function b(e){var t={steps:{},components:{},activity:{}};for(var r=0,n=e;r<n.length;r++){var i=n[r];var a=i.key;g(a,i,t)}return t}t.createMap=b;function x(e){var t=[];for(var r in e.steps){for(var n in e.steps[r]){t.push({loc:"step",stepId:r,key:n})}}for(var i in e.components){for(var n in e.components[i]){t.push({loc:"component",componentId:i,key:n})}}for(var n in e.activity){t.push({loc:"activity",key:n})}return t}t.listKeys=x;function S(e,t){var r,n;switch(e.loc){case"step":return(r=t.steps[e.stepId])===null||r===void 0?void 0:r[e.key];case"component":return(n=t.components[e.componentId])===null||n===void 0?void 0:n[e.key];case"activity":return t.activity[e.key];default:i.assertUnreachable(e)}return undefined}t.getEntry=S;function T(e){switch(e.loc){case"step":return"step:"+e.stepId+":"+e.key;case"component":return"component:"+e.componentId+":"+e.key;case"activity":return"activity:"+e.key;default:return i.assertUnreachable(e)}}t.stringifyTranslationKey=T;function w(e){var t={activity:{},steps:{},components:{}};t.activity=_(e.activity);for(var r in e.steps){t.steps[r]=_(e.steps[r])}for(var n in e.components){t.components[n]=_(e.components[n])}return t}t.trimContext=w;function _(e){var t;var r={};for(var n in e){r[n]=(t=e[n])===null||t===void 0?void 0:t.entry}return r}function I(e){var t,r;if(e.skipped){return undefined}return e.pending||((t=e.proposed[0])===null||t===void 0?void 0:t.translation)||((r=e.approved)===null||r===void 0?void 0:r.translation)}t.getTranslationFromEntry=I;function E(e,t){var r=0;var n=0;var i=0;var a=0;for(var o=0,s=x(e);o<s.length;o++){var u=s[o];var c=S(u,t);r+=1;if(c===null||c===void 0?void 0:c.skipped){n+=1}else if(c===null||c===void 0?void 0:c.approved){a+=1}else if((c===null||c===void 0?void 0:c.proposed)&&(c===null||c===void 0?void 0:c.proposed.length)>0){i+=1}}return{isComplete:a+n===r,numSkipped:n,numProposed:i,numApproved:a,numTotal:r}}t.getTranslationStatus=E});define("core/components/marbleslides/helpers",["require","exports","core/lib/calculator-helpers","core/lib/copydata"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.makeScreenshotState=void 0;function i(e,t,i){if(!e){return undefined}var a=n.copydata(e);var o=0;for(var s=0,u=t?t:[];s<u.length;s++){var c=u[s],l=c.x,p=c.y;r.pushPointIntoState(a,{x:l,y:p,id:"start"+o,color:"#83629e"});o+=1}for(var d=0,f=i?i:[];d<f.length;d++){var h=f[d],l=h.x,p=h.y;r.pushPointIntoState(a,{x:l,y:p,id:"star"+o,color:"#f5c617"});o+=1}return a}t.makeScreenshotState=i});define("core/components/reorder/external-state",["require","exports","core/lib/rich-text-helpers"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.internalToExternalReorderState=void 0;function n(e){var t={};for(var n in e.items){t[n]={text:r.richTextFromText("document",e.items[n].text)}}var i={items:t};if(e.order){i.order=e.order}if(e.answerKey){i.answerKey=e.answerKey}if(e.topLabel){i.topLabel=r.richTextFromText("document",e.topLabel)}if(e.bottomLabel){i.bottomLabel=r.richTextFromText("document",e.bottomLabel)}return i}t.internalToExternalReorderState=n});define("core/components/transform/external-state",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getExternalTransformState=void 0;function r(e){return{transforms:e.transforms.map(n)}}t.getExternalTransformState=r;function n(e){var t;switch(e.t.type){case"translate":{t={type:"translate",from:e.t.p1,to:e.t.p2};break}case"rotate":{t={type:"rotate",center:e.t.c,theta:e.t.theta,direction:e.t.direction===-1?"clockwise":"counterclockwise"};break}case"scale":{t={type:"scale",center:e.t.c,factor:e.t.factor};break}case"reflect":{t={type:"reflect",l1:e.t.l1,l2:e.t.l1};break}}return{id:e.id,t:t}}});define("core/analysis-engine/helpers",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getExternalKey=t.getInternalKey=void 0;function r(e){switch(e){case"note":return"exhibit/text";case"text-input":return"input/text";case"expression-input":return"input/expression";case"image":return"exhibit/image";case"graph":return"input/graph";default:return e}}t.getInternalKey=r;function n(e){switch(e){case"exhibit/text":return"note";case"input/text":return"text-input";case"input/expression":return"expression-input";case"exhibit/image":return"image";case"input/graph":return"graph";default:return e}}t.getExternalKey=n});define("core/lib/semver",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.checkConfigVersion=t.versionRegex=void 0;t.versionRegex=/^(\d+)\.(\d+)\.(\d+)$/;var r=function(){function e(e){var r=t.versionRegex.exec(e);if(!r){throw new Error('Could not parse semver version from "'+e+'".')}this.major=parseInt(r[1]);this.minor=parseInt(r[2]);this.patch=parseInt(r[3])}e.prototype.isNewerThan=function(e){if(this.major>e.major){return true}else if(this.major<e.major){return false}else if(this.minor>e.minor){return true}else if(this.minor<e.minor){return false}else if(this.patch>e.patch){return true}else if(this.patch<e.patch){return false}return false};return e}();function n(e,t,n){var i=e.content.editorVersion;if(!t||!i||!n){return}try{var a=new r(t);var o=new r(i);if(o.isNewerThan(a)){n({level:"WARN",message:"This activity configuration was edited with a newer version of the API ("+i+") "+("than the current version ("+t+").")})}}catch(e){n({level:"WARN",message:e&&e.message||""})}}t.checkConfigVersion=n});define("core/lib/api-helpers",["require","exports","tslib","core/components/component-helpers","core/components/index","core/migrate-config"],function(e,t,r,n,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.rewriteAssetUrls=void 0;function o(e,t){var o=a.migrateConfigToLatest(e.content);for(var s=0,u=o.steps;s<u.length;s++){var c=u[s];n.forEachComponent(c,function(e){var r=n.componentKey(e);var a=n.traverseComponentKey(e);var o=i.nameToComponent(r).rewriteAssetUrls(a,t);n.updateComponentConfig(e,r,o)})}return r.__assign(r.__assign({},e),{content:a.migrateConfigToPersisted(o)})}t.rewriteAssetUrls=o});define("core/analysis-engine/analysis-engine",["require","exports","tslib","core/components/component-helpers","core/computation-layer/class-runtime","core/lib/typed-bind","core/components/index","underscore","core/computation-layer/helpers","core/lib/rich-text-helpers","core/prosemirror/prosemirror-interpolation","core/components/shared/sketch/sketch","core/components/shared/constants","core/components/multiple-choice/helpers","core/components/table/helpers","core/lib/deserialize-responses","core/migrate-config","core/components/cardsort/group-tools","core/lib/rich-text","core/components/cardsort/helpers","core/activity-translation/helpers","core/activity-translation/translator","core/components/marbleslides/helpers","core/components/reorder/external-state","core/components/transform/external-state","./helpers","core/lib/semver","core/lib/api-helpers"],function(e,t,r,n,i,a,o,s,u,c,l,p,d,f,h,y,m,v,g,b,x,S,T,w,_,I,E,C){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.fixVersionNumber=t.bundleTranslation=t.getTranslationStatus=t.StudentAnalysis=t.AnalysisContext=t.EMPTY_STUDENT_ID=t.STUDENT_META_RESPONSE_KEY=void 0;t.STUDENT_META_RESPONSE_KEY="player-api-student-meta";t.EMPTY_STUDENT_ID="empty-student-id";var M=function(){function e(e,t){if(t===void 0){t={}}this.private=new k(e,t)}e.prototype.getStudentAnalysis=function(e){if(e===void 0){e={}}return this.private.getStudentAnalysis(e)};e.version=function(){return{version:"v1.10.2-sync-03.11.2022",commit:"a6557356eb3dceb9d3dca13299cb0a05b8bfa508"}};return e}();t.AnalysisContext=M;var k=function(){function e(e,t){if(t===void 0){t={}}var o;this.inputActivityConfiguration=e;this.studentSinkValues={};var s=typeof M.version()==="object"?M.version().version:undefined;E.checkConfigVersion(e,s,t.onError);this.screenOrder=[];this.screens={};this.components={};this.onError=t.onError;var u=m.migrateConfigToLatest(e.content);if(t.activityTranslation){u=x.translateActivity({activityConfig:r.__assign(r.__assign({},e),{content:u}),bundle:x.inflateTranslationBundle(t.activityTranslation.bundle.content),allowMissingKeys:!!t.activityTranslation.allowMissingKeys,extractOptions:{skipActivityDetails:true,skipTeacherTips:true}})}for(var c=0,l=u.steps;c<l.length;c++){var p=l[c];this.screenOrder.push(p.id);var d=[];for(var f=0,h=p.root.linearlayout.components;f<h.length;f++){var y=h[f];for(var v=0,g=y.linearlayout.components;v<g.length;v++){var b=g[v];var S=n.componentKey(b);var T=n.traverseComponentKey(b);d.push(T.id);this.components[T.id]={type:S,config:T}}}this.screens[p.id]={componentIds:d}}this.degreeMode=!!((o=u.flags)===null||o===void 0?void 0:o.degreeModeEnabled);this.classRuntime=new i.ClassRuntime({steps:u.steps,studentIds:[],responses:{},onCLUpdated:a.bind(this.onCLUpdated,this),onUnexpectedAction:a.bind(this.onUnexpectedAction,this),degreeMode:this.degreeMode})}e.prototype.getStudentAnalysis=function(e){if(e.responses){var r=e.responses[t.STUDENT_META_RESPONSE_KEY]&&JSON.parse(e.responses[t.STUDENT_META_RESPONSE_KEY]);if(r){var n=r.studentId;var i=s.uniqueId(n);this.updateStudentData({studentId:i,responseData:e.responses,randomSeed:n});return new P(this,{studentId:i,randomSeed:n,onError:this.onError})}else{throw new Error("Error: responseData was provided, but the student metadata response was not present.             Did you provide all previously exported responses?")}}else{var i=s.uniqueId(t.EMPTY_STUDENT_ID);this.updateStudentData({studentId:i,responseData:{},randomSeed:t.EMPTY_STUDENT_ID});return new P(this,{studentId:i,randomSeed:t.EMPTY_STUDENT_ID})}};e.prototype.updateStudentData=function(e){var r;var n=e.studentId,i=e.responseData,a=e.randomSeed;if(typeof i!=="object"){throw new Error("Expected responseData to be an object but saw "+typeof i+".")}var o={};for(var s in i){if(!(this.screens.hasOwnProperty(s)||this.components.hasOwnProperty(s)||s==t.STUDENT_META_RESPONSE_KEY)){this.handleRecoverableError("Unexpected responseData key '"+s+"'. All response data keys must be screen or component ids for this activity.");continue}var u=i[s];if(typeof u!="string"){throw new Error("Expected content of key '"+s+"' to be of type string, but it was "+typeof u)}else{o[s]=y.deserializeResponse(s,u,this.classRuntime.lessonQuery)}}this.classRuntime.ensureRuntimeExists(n,undefined,undefined,a);var c=this.classRuntime.getDownstreamComponentIds(n,o);this.classRuntime.handleResponses((r={},r[n]=o,r));var l={};var p={};for(var d=0,f=c;d<f.length;d++){var h=f[d];if(this.classRuntime.lessonQuery.componentExists(h)){l[h]=true}else if(this.classRuntime.lessonQuery.screenExists(h)){p[h]=true}}for(var s in o){if(this.classRuntime.lessonQuery.componentExists(s)){l[s]=true}else if(this.classRuntime.lessonQuery.screenExists(s)){p[s]=true}}return{updatedComponentIds:Object.keys(l),updatedScreenIds:Object.keys(p)}};e.prototype.getCorrectness=function(e,t){var r=this.classRuntime.lessonQuery.getComponentAliasById(t);var n=this.studentSinkValues[e]&&this.studentSinkValues[e][t];var i=n&&n["correct"];var a=undefined;if(i&&i[0]){a=!!i[0].value}var u=o.nameToComponent(r);var c=this.getComponentResponse({studentId:e,componentId:t});var l=this.getComponentConfig(t);if(r==="input/expression"&&l.explainResponse&&a){return"correct"}if(r==="multiple-choice"){var p=l;var d=c;var h=!!(d&&d.selection&&s.isEqual(p.answerKey,d.selection))||a;if(f.isSimpleWithExplanation(p)&&h){return"correct"}}return u.checkCorrectness({response:c,config:l,clCorrectness:a})};e.prototype.getComponentConfig=function(e){return this.classRuntime.lessonQuery.getComponentConfigById(e)};e.prototype.getComponentResponse=function(e){var t=e.studentId,r=e.componentId;return this.classRuntime.responseForStudentAndComponent(t,r)};e.prototype.getActvityMetadata=function(){return this.inputActivityConfiguration.customMetadata};e.prototype.getScreenConfig=function(e){return this.classRuntime.lessonQuery.getStepConfig(e)};e.prototype.hasScreenBeenSeen=function(e){var t=this.classRuntime.responseForStudentAndScreen(e);return!!(t===null||t===void 0?void 0:t.seen)};e.prototype.hasResponse=function(e){var t=this.classRuntime.lessonQuery.getComponentAliasById(e.componentId);var r=o.nameToComponent(t);var n=this.getComponentResponse({studentId:e.studentId,componentId:e.componentId});var i=this.classRuntime.getRuntime(e.studentId).getComponentSinks(e.componentId);return r.hasResponse(n,i)};e.prototype.isVisible=function(e){var t;var r=e.studentId,n=e.componentId;var i=this.studentSinkValues[r]&&this.studentSinkValues[r][n];return!((t=i===null||i===void 0?void 0:i.hidden[0])===null||t===void 0?void 0:t.value)};e.prototype.getScreenIds=function(){return this.screenOrder.slice()};e.prototype.listComponentIds=function(e){return this.screens[e].componentIds};e.prototype.listCustomComponents=function(){var e=[];for(var t=0,r=this.screenOrder;t<r.length;t++){var n=r[t];for(var i=0,a=this.screens[n].componentIds;i<a.length;i++){var o=a[i];var s=this.components[o];if(s.type==="custom-component"){e.push({componentId:s.config.id,componentName:s.config.componentName,screenId:n})}}}return e};e.prototype.getComponentType=function(e){return this.components[e].type};e.prototype.listAssetUrls=function(){var e={};for(var t=0,r=Object.keys(this.components);t<r.length;t++){var n=r[t];var i=this.components[n];var a=this.getComponentAssetUrls(i.type,i.config);e[n]=a}return e};e.prototype.rewriteAssetUrls=function(e){return C.rewriteAssetUrls(this.inputActivityConfiguration,e)};e.prototype.getDegreeMode=function(){return this.degreeMode};e.prototype.getComponentAssetUrls=function(e,t){return o.nameToComponent(e).getAssetUrls(t)};e.prototype.onCLUpdated=function(e,t){if(!this.studentSinkValues[e]){this.studentSinkValues[e]={}}for(var r in t){this.studentSinkValues[e][r]=t[r]}};e.prototype.onUnexpectedAction=function(e){if(this.onError){this.onError({level:"WARN",message:"Unexpected action type in class-runtime: "+e})}};e.prototype.handleRecoverableError=function(e){if(this.onError){try{this.onError({level:"ERROR",message:e})}catch(e){}}else{throw new Error(e)}};return e}();var P=function(){function e(e,t){var r=t.studentId,n=t.randomSeed,i=t.onError;this.private=new O(e,r,n,{onError:i})}e.prototype.listScreenIds=function(){var e="listScreenIds() is deprecated. Please use getScreenIds() instead.";if(this.onError){try{this.onError({level:"WARN",message:e})}catch(e){}}else if(console&&typeof console.warn==="function"){console.warn(e)}return this.getScreenIds()};e.prototype.getScreenIds=function(){return this.private.getScreenIds()};e.prototype.listComponentIds=function(e){return this.private.listComponentIds(e)};e.prototype.listCustomComponents=function(){return this.private.listCustomComponents()};e.prototype.getComponentType=function(e){return this.private.getComponentType(e)};e.prototype.listAssetUrls=function(){return this.private.listAssetUrls()};e.prototype.rewriteAssetUrls=function(e){return this.private.rewriteAssetUrls(e)};e.prototype.getActivityMetadata=function(e){return this.private.getActivityMetadata(e)};e.prototype.getScreenMetadata=function(e,t){return this.private.getScreenMetadata(e,t)};e.prototype.getComponentMetadata=function(e,t){return this.private.getComponentMetadata(e,t)};e.prototype.updateStudentData=function(e){return this.private.updateStudentData(e)};e.prototype.getCorrectness=function(e){return this.private.getCorrectness(e)};e.prototype.getScreenTitle=function(e){return this.private.getScreenTitle(e)};e.prototype.getNoteState=function(e){return this.private.getNoteState(e)};e.prototype.getTextInputState=function(e){return this.private.getTextInputState(e)};e.prototype.getExpressionInputState=function(e){return this.private.getExpressionInputState(e)};e.prototype.getMultipleChoiceState=function(e){return this.private.getMultipleChoiceState(e)};e.prototype.getTableState=function(e){return this.private.getTableState(e)};e.prototype.getCardsortState=function(e){return this.private.getCardsortState(e)};e.prototype.getReorderState=function(e){return this.private.getReorderState(e)};e.prototype.getTransformState=function(e){return this.private.getTransformState(e)};e.prototype.getMarbleslidesResponseState=function(e){return this.private.getMarbleslidesResponseState(e)};e.prototype.getSketchSVGState=function(e){return this.private.getSketchSVGState(e)};e.prototype.getSketchSVG=function(e){return r.__awaiter(this,void 0,Promise,function(){return r.__generator(this,function(t){return[2,this.private.getSketchSVG(e)]})})};e.prototype.getGraphSVGState=function(e){return this.private.getGraphSVGState(e)};e.prototype.getGraphSVG=function(e){return r.__awaiter(this,void 0,Promise,function(){return r.__generator(this,function(t){return[2,this.private.getGraphSVG(e)]})})};e.prototype.getGeometrySVGState=function(e){return this.private.getGeometrySVGState(e)};e.prototype.getGeometrySVG=function(e){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(t){return[2,this.private.getGeometrySVG(e)]})})};e.prototype.getMarbleslidesSVGState=function(e){return this.private.getMarbleslidesSVGState(e)};e.prototype.getMarbleslidesSVG=function(e){return r.__awaiter(this,void 0,Promise,function(){return r.__generator(this,function(t){return[2,this.private.getMarbleslidesSVG(e)]})})};e.prototype.getCardsortGraphSVGState=function(e){return this.private.getCardsortGraphSVGState(e)};e.prototype.getCardsortGraphSVG=function(e){return r.__awaiter(this,void 0,Promise,function(){return r.__generator(this,function(t){return[2,this.private.getCardsortGraphSVG(e)]})})};e.prototype.getMultipleChoiceGraphSVGState=function(e){return this.private.getMultipleChoiceGraphSVGState(e)};e.prototype.getMultipleChoiceGraphSVG=function(e){return r.__awaiter(this,void 0,Promise,function(){return r.__generator(this,function(t){return[2,this.private.getMultipleChoiceGraphSVG(e)]})})};e.prototype.hasScreenBeenSeen=function(e){return this.private.hasScreenBeenSeen(e)};e.prototype.hasResponse=function(e){return this.private.hasResponse(e)};e.prototype.isVisible=function(e){return this.private.isVisible(e)};e.prototype.listExportKeys=function(){return this.private.listExportKeys()};e.prototype.listImportKeys=function(){return this.private.listImportKeys()};e.prototype.setImportKeyValue=function(e,t){this.private.setImportKeyValue(e,t)};e.prototype.getExportedValue=function(e){return this.private.getExportedValue(e)};e.prototype.getImageState=function(e){return this.private.getImageState(e)};e.prototype.getVideoState=function(e){return this.private.getVideoState(e)};return e}();t.StudentAnalysis=P;var O=function(){function e(e,t,r,n){this.context=e;this.studentId=t;this.randomSeed=r;this.onError=n.onError}e.prototype.getScreenIds=function(){return this.context.getScreenIds()};e.prototype.getRuntime=function(){return this.context.classRuntime.getRuntime(this.studentId)};e.prototype.getCorrectness=function(e){return this.context.getCorrectness(this.studentId,e)};e.prototype.hasScreenBeenSeen=function(e){return this.context.hasScreenBeenSeen({studentId:this.studentId,screenId:e})};e.prototype.hasResponse=function(e){return this.context.hasResponse({studentId:this.studentId,componentId:e})};e.prototype.isVisible=function(e){return this.context.isVisible({studentId:this.studentId,componentId:e})};e.prototype.updateStudentData=function(e){return this.context.updateStudentData({studentId:this.studentId,responseData:e,randomSeed:this.randomSeed})};e.prototype.listExportKeys=function(){return u.listExportKeys(this.getRuntime())};e.prototype.listImportKeys=function(){return this.getRuntime().listImportSourceKeys()};e.prototype.setImportKeyValue=function(e,t){var r=this.context.classRuntime.getRuntime(this.studentId);r.updateImportSourceValue(e.importKey,t);r.processPendingValues()};e.prototype.listComponentIds=function(e){return this.context.listComponentIds(e)};e.prototype.listCustomComponents=function(){return this.context.listCustomComponents()};e.prototype.listAssetUrls=function(){return this.context.listAssetUrls()};e.prototype.rewriteAssetUrls=function(e){return this.context.rewriteAssetUrls(e)};e.prototype.getComponentType=function(e){return I.getExternalKey(this.context.getComponentType(e))};e.prototype.getActivityMetadata=function(e){var t=this.context.getActvityMetadata();var r=t&&t[e];return r===null||r===void 0?void 0:r.activity};e.prototype.getScreenMetadata=function(e,t){var r=this.context.getActvityMetadata();var n=r&&r[e];return n&&n.screen&&n.screen[t]};e.prototype.getComponentMetadata=function(e,t){var r=this.context.getActvityMetadata();var n=r&&r[e];return n&&n.component&&n.component[t]};e.prototype.getExportedValue=function(e){var t=this.getRuntime().getSinks(e.componentId,e.sinkName);var r=s.find(t,function(t){return t.params[0]==e.exportKey});if(!r){return undefined}if(u.isCLStringType(r.value)){return u.synthesizeStringForContent(r.value)}return r.value};e.prototype.validateComponentType=function(e,t){var r=this.getComponentType(e);if(r!==t){throw new Error("Expected component "+e+' to have type "'+t+'", but got "'+r+'" instead.')}};e.prototype.getScreenTitle=function(e){var t=this.context.getScreenConfig(e);var r=this.getRuntime().getSinkValue(e,"title");var n=this.getRuntime().getSinkValue(e,"subtitle");var i=c.richTextFromText("document",r&&u.synthesizeStringForContent(r)||t.title||"");if(n===undefined){return{title:i}}else{return{title:i,subtitle:c.richTextFromText("document",n&&u.synthesizeStringForContent(n)||"")}}};e.prototype.getComponentState=function(e,t){var r=I.getExternalKey(t);this.validateComponentType(e,r);var n=o.nameToComponent(t);var i=this.context.getComponentConfig(e);var a=this.context.getComponentResponse({componentId:e,studentId:this.studentId});var s=this.getRuntime().getComponentSinks(e);return n.getComponentState({config:i,sinks:s,response:a,options:{degreeMode:this.context.getDegreeMode()}})};e.prototype.getNoteState=function(e){var t=this.getComponentState(e,"exhibit/text").content;var r=l.interpolateSerializedDoc(t,this.getRuntime(),e);return{content:{schemaKey:"document",version:g.schemas.document.version,content:r}}};e.prototype.getTextInputState=function(e){var t=this.getComponentState(e,"input/text");return{content:c.richTextFromText("document",t.content)}};e.prototype.getExpressionInputState=function(e){var t=this.getComponentState(e,"input/expression");var r=t.explainContent;return r!=undefined?{content:c.richTextFromLatex(t.content),explainContent:c.richTextFromText("document",r)}:{content:c.richTextFromLatex(t.content)}};e.prototype.getMultipleChoiceState=function(e){var t=this.getComponentState(e,"multiple-choice");var n=t.options.map(function(e){if(e.type==="text"){return{type:"text",content:c.richTextFromText("document",e.content||"")}}else if(e.type==="image"){return{type:"image",src:e.src,alt:e.alt,content:e.content?c.richTextFromText("document",e.content):undefined}}else{return{type:"graph",content:e.content?c.richTextFromText("document",e.content):undefined}}});var i=t.explainContent;if(i===undefined){return r.__assign(r.__assign({},s.omit(t,"explainContent")),{options:n})}return r.__assign(r.__assign({},t),{options:n,explainContent:c.richTextFromText("document",i)})};e.prototype.getTableState=function(e){var t=this.getComponentState(e,"table");var r=t.cellContent.map(function(e){return e.map(function(e){var r;if(e.columnType==h.columnTypes.MATH){if(e.coords.column===0&&t.rowHeaders||e.coords.row===0&&t.columnHeaders){r=c.richTextFromText("document",e.content)}else{r=c.richTextFromLatex(e.content)}}else{r=c.richTextFromText("document",e.content)}var n={studentEditable:e.studentEditable,content:r,warning:c.richTextFromText("document",e.warning),suffixContent:c.richTextFromText("document",e.suffixContent)};if(e.numericValue){n.numericValue=e.numericValue}return n})});return{columnHeaders:t.columnHeaders,rowHeaders:t.rowHeaders,cellContent:r}};e.prototype.getCardsortState=function(e){var t=this.getComponentState(e,"cardsort");var r=this.context.getComponentConfig(e);var n;if(t.answerKey){var i=v.responseToExternalGroups(t.answerKey);n=i.map(function(e){return{cardIds:e.cardIds}})}return{cards:b.responseToExternalCards(r),groups:v.responseToExternalGroups(t),answerKey:n}};e.prototype.getReorderState=function(e){var t=this.getComponentState(e,"reorder");return w.internalToExternalReorderState(t)};e.prototype.getTransformState=function(e){var t=this.getComponentState(e,"transform");return _.getExternalTransformState(t)};e.prototype.getGeometrySVGState=function(e){this.validateComponentType(e,"geometry");var t=this.context.getComponentResponse({studentId:this.studentId,componentId:e});return{imgData:t===null||t===void 0?void 0:t.imgData,version:1}};e.prototype.getGeometrySVG=function(e){var t=e.componentId,n=e.size,i=e.svgRenderer;return r.__awaiter(this,void 0,Promise,function(){var e,a;return r.__generator(this,function(o){switch(o.label){case 0:e=this.getGeometrySVGState(t);return[4,i.renderGeometrySVG(r.__assign(r.__assign({},e),{size:n}))];case 1:a=o.sent();return[2,{svg:a}]}})})};e.prototype.getMarbleslidesResponseState=function(e){var t,r;this.validateComponentType(e,"marbleslides");var n=this.context.getComponentConfig(e);var i=this.context.getComponentResponse({studentId:this.studentId,componentId:e});return{score:i===null||i===void 0?void 0:i.score,totalStars:(r=(t=n===null||n===void 0?void 0:n.stars)===null||t===void 0?void 0:t.length)!==null&&r!==void 0?r:0}};e.prototype.getSketchSVGState=function(e){this.validateComponentType(e,"sketch");var t=this.context.getComponentConfig(e);var r;if(t.background&&t.background.type==="graph"){var n=this.getRuntime().getSinks("thumbnail","thumbnail");var i=s.find(n,function(t){return t.params[0]==e});r=i&&i.value}var a=this.context.getComponentResponse({studentId:this.studentId,componentId:e});var o=a&&a.sketchData;var u=this.getRuntime().getSinks(e,"bounds");var c=this.getRuntime().getSinks(e,"background")[0];var l=this.context.classRuntime.lessonQuery;var f=l.getScreenIdFromComponentId(e);var h=l.isSoloComponentScreen(f);var y=p.getSketchBounds({aspectRatio:h?d.ASPECT_RATIO.FULLSCREEN:d.ASPECT_RATIO.DEFAULT,sketchConfig:t,bounds:u[0]&&u[0].value});return{studentId:this.randomSeed,sketchData:o,clBackground:r?undefined:c&&c.value,backgroundCalculatorState:r,config:t,bounds:y,version:1}};e.prototype.getSketchSVG=function(e){var t=e.componentId,n=e.svgRenderer,i=e.size;return r.__awaiter(this,void 0,Promise,function(){var e,a;return r.__generator(this,function(o){switch(o.label){case 0:e=this.getSketchSVGState(t);return[4,n.renderSketchSVG(r.__assign(r.__assign({},e),{size:i,version:1}))];case 1:a=o.sent();return[2,{svg:a}]}})})};e.prototype.getGraphSVGState=function(e){this.validateComponentType(e,"graph");var t=this.context.getComponentConfig(e);if(t.copyId!=undefined){this.handleRecoverableError("Copy previous is not supported in the analysis engine.")}var r=this.getRuntime().getSinks("thumbnail","thumbnail");var n=s.find(r,function(t){return t.params[0]==e});var i=n&&n.value;var a=this.getRuntime().getSinks(e,"background")[0];if(!i){throw new Error("Calculator state not found.")}return{clCalculatorState:i,clBackground:a&&a.value,version:1}};e.prototype.getGraphSVG=function(e){var t=e.componentId,n=e.svgRenderer,i=e.size;return r.__awaiter(this,void 0,Promise,function(){var e,a;return r.__generator(this,function(o){switch(o.label){case 0:e=this.getGraphSVGState(t);return[4,n.renderGraphSVG(r.__assign(r.__assign({},e),{size:i,version:1}))];case 1:a=o.sent();return[2,{svg:a}]}})})};e.prototype.getMarbleslidesSVGState=function(e){this.validateComponentType(e,"marbleslides");var t=this.context.getComponentConfig(e);var n=this.getRuntime().getSinks("thumbnail","thumbnail");var i=s.find(n,function(t){return t.params[0]==e});var a=i&&i.value;var o=this.getRuntime().getSinks(e,"background")[0];if(!a){throw new Error("Calculator state not found.")}a=r.__assign(r.__assign({},a),{calculatorState:T.makeScreenshotState(a.calculatorState,t.start,t.stars)});return{clCalculatorState:a,clBackground:o&&o.value,version:1}};e.prototype.getMarbleslidesSVG=function(e){var t=e.componentId,n=e.svgRenderer,i=e.size;return r.__awaiter(this,void 0,Promise,function(){var e,a;return r.__generator(this,function(o){switch(o.label){case 0:e=this.getMarbleslidesSVGState(t);return[4,n.renderGraphSVG(r.__assign(r.__assign({},e),{size:i,version:1}))];case 1:a=o.sent();return[2,{svg:a}]}})})};e.prototype.getCardsortGraphSVGState=function(e){var t=e.componentId,r=e.cardId;this.validateComponentType(t,"cardsort");var n=this.context.getComponentConfig(t);var i=b.getCalculatorStateFromCard(n,t,r);if(!i){return undefined}return{clCalculatorState:{calculatorState:i,sinks:{}},clBackground:undefined,version:1}};e.prototype.getCardsortGraphSVG=function(e){var t=e.componentId,n=e.cardId,i=e.svgRenderer,a=e.size;return r.__awaiter(this,void 0,Promise,function(){var e,o;return r.__generator(this,function(s){switch(s.label){case 0:e=this.getCardsortGraphSVGState({componentId:t,cardId:n});if(!e){return[2,{svg:undefined}]}return[4,i.renderGraphSVG(r.__assign(r.__assign({},e),{size:a,version:1}))];case 1:o=s.sent();return[2,{svg:o}]}})})};e.prototype.getMultipleChoiceGraphSVGState=function(e){var t=e.componentId,r=e.choiceIndex;this.validateComponentType(t,"multiple-choice");var n=this.context.getComponentConfig(t);var i=f.getCalculatorStateFromChoice(n,t,r);if(!i){return undefined}return{clCalculatorState:{calculatorState:i,sinks:{}},clBackground:undefined,version:1}};e.prototype.getMultipleChoiceGraphSVG=function(e){var t=e.componentId,n=e.choiceIndex,i=e.svgRenderer,a=e.size;return r.__awaiter(this,void 0,Promise,function(){var e,o;return r.__generator(this,function(s){switch(s.label){case 0:e=this.getMultipleChoiceGraphSVGState({componentId:t,choiceIndex:n});if(!e){return[2,{svg:undefined}]}return[4,i.renderGraphSVG(r.__assign(r.__assign({},e),{size:a,version:1}))];case 1:o=s.sent();return[2,{svg:o}]}})})};e.prototype.getImageState=function(e){return this.getComponentState(e,"exhibit/image")};e.prototype.getVideoState=function(e){return this.getComponentState(e,"video")};e.prototype.handleRecoverableError=function(e){if(this.onError){try{this.onError({level:"ERROR",message:e})}catch(e){}}else{throw new Error(e)}};return e}();function L(e,t){var r=m.migrateConfigToLatest(e.content);var n=x.inflateTranslationMemory(t.content);var i=x.createMap(n.entries);return x.getTranslationStatus((new S.ActivityTranslator).extract(r,{skipActivityDetails:true,skipTeacherTips:true,skipChallengeCreatorSubscreens:true}),i)}t.getTranslationStatus=L;function N(e,t,r){if(r===void 0){r={allowMissingKeys:false}}var n=m.migrateConfigToLatest(e.content);var i=x.inflateTranslationMemory(t.content);var a=new S.ActivityTranslator;var o=a.extract(n,{skipActivityDetails:true,skipTeacherTips:true,skipChallengeCreatorSubscreens:true});var s=x.bundle(i,x.trimContext(o),r).translationBundle;return{version:0,content:x.deflateTranslationBundle(s)}}t.bundleTranslation=N;function A(e){return r.__assign(r.__assign({},e),{content:r.__assign(r.__assign({},e.content),{version:0})})}t.fixVersionNumber=A});
    return requirejs('core/analysis-engine/analysis-engine');
  }).call(global);
  if ( typeof module === "object" && typeof module.exports === "object" ) {
    module.exports = _exports;
  } else {
    global.AnalysisEngine = _exports;
  }
})(typeof window !== 'undefined' ? window : this || {});
